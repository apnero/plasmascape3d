b4w={module:{},register:function(a,p){var h=b4w.module;if(h[a])throw Error('Module "'+a+'" already registered');h[a]=p},require:function(a){var p=b4w.require,h=b4w.module[a];if(!h)throw Error('Module "'+a+'" not found');h.$j||(h.$j={},h(h.$j,p));return h.$j},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Qk&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){return"24.12.2014 04:04:49"}a.version=function(){return"14.12"};a.type=function(){return"RELEASE"};a.date=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Qk&&b4w.module.__version(exports);
b4w.module.__config=function(a,p){function h(){return b4w.module_check(a.yb.xi)}var c=p("__print"),f=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Ut=f.ra(a.context);a.n={alpha_sort:!0,alpha_sort_threshold:.1,zp:5,$d:1E4,console_verbose:!1,do_not_load_resources:!1,Rj:!1,fv:1.5,ev:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,gf:.01,resolution_factor:1,Ai:1,Hj:3,Ug:!1,Vk:!1,oi:!0,show_hud_debug_info:!1,
hA:!0,ge:"DEPTH",anaglyph_use:!1,wj:!0,Oh:.5,jg:!0,glow:!0,yf:!0,Rf:!0,$f:!0,Jf:!0,gg:!0,Nf:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Vj:!1,Vf:!0,Eh:!0,ya:!0,Kh:!0,water_dynamic:!0,shore_smoothing:!0,ng:!0,kf:1024,zl:512,max_bones:53,hr:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,ek:!0,Ue:!1,Mw:!1,Yl:!1,fo:!1,mr:!1,Ze:!1,gp:!1,cp:!1,Jn:!1,vo:!1,Cq:!1};a.Gu=f.ra(a.n);a.Jd={ua:-1,zo:!1,Re:1};a.controls={Kw:1/120};a.ad={dir:"ASSETS=../../assets/",Fw:15,dq:!0,Bl:!1,Kk:!1};a.mt=f.ra(a.ad);
a.yb={shaders_dir:"../../shaders/",Sx:"include/",yq:"shader_texts",xi:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",px:"./",nq:["b4w.min.js","b4w.full.min.js","webplayer.min.js","src/data.js"]};a.gb={enabled:!0,$d:60,Gg:""};a.Uw=f.ra(a.gb);a.Sh={Jl:1024,Si:1024,bh:384};a.wx=f.ra(a.Sh);a.Ad={jz:!0,hj:!1,hn:!1,Fn:!1,ho:!1};a.Rx=f.ra(a.Ad);a.eh={enabled:!1,ty:"MAIN_OPAQUE",sy:0,Vx:"COLOR"};a.Cu=f.ra(a.eh);a.jt=function(){var b=a.n,c=a.gb,e=a.Sh;switch(b.quality){case a.P_ULTRA:b.ge=
"DEPTH";b.shore_smoothing=!0;b.glow=!0;b.yf=!0;b.Rf=!0;b.$f=!0;b.Jf=!0;b.wj=!0;b.Oh=1;b.jg=!0;b.Vf=!0;b.Eh=!0;b.ya=!0;b.Kh=!0;b.resolution_factor=1.75;e.Jl=2048;e.Si=2048;b.Hj=3;b.oi=!0;b.Rj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.ng=!0;b.antialiasing=!0;b.smaa=!0;b.Nf=!0;b.gg=!0;c.$d=120;break;case a.P_HIGH:b.ge="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.yf=!0;b.Rf=!0;b.$f=!0;b.Jf=!0;b.wj=!0;b.Oh=.5;b.jg=!0;b.Vf=!0;b.Eh=!0;b.ya=!0;b.Kh=!0;b.resolution_factor=1;e.Jl=1024;e.Si=1024;
b.Hj=3;b.oi=!0;b.Rj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.ng=!0;b.antialiasing=!0;b.smaa=!1;b.Nf=!0;b.gg=!0;c.$d=60;break;case a.P_LOW:b.ge="NONE",b.shore_smoothing=!1,b.glow=!1,b.yf=!1,b.Rf=!1,b.$f=!1,b.Jf=!1,b.wj=!1,b.Oh=.5,b.jg=!1,b.Vf=!1,b.Eh=!1,b.ya=!1,b.Kh=!1,b.resolution_factor=1,e.Jl=512,e.Si=512,b.Hj=2,b.oi=!1,b.Rj=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.ng=!1,b.antialiasing=!1,b.smaa=!1,b.Nf=!1,b.gg=!1,c.$d=60}};a.set=function(b,f){switch(b){case "all_objs_selectable":a.n.all_objs_selectable=
f;break;case "alpha":a.context.alpha=f;break;case "alpha_sort":a.n.alpha_sort=f;break;case "alpha_sort_threshold":a.n.alpha_sort_threshold=f;break;case "allow_cors":a.n.Ug=f;break;case "anaglyph_use":a.n.anaglyph_use=f;break;case "animation_framerate":a.Jd.ua=f;break;case "antialiasing":a.n.antialiasing=f;break;case "assets_dds_available":a.ad.Kk=f;break;case "assets_min50_available":a.ad.Bl=f;break;case "background_color":a.n.background_color=f;break;case "built_in_module_name":a.yb.xi=f;break;case "console_verbose":a.n.console_verbose=
f;break;case "context_antialias":a.context.antialias=f;break;case "debug_subs_enabled":a.eh.enabled=f;break;case "deferred_rendering":a.n.deferred_rendering=f;break;case "do_not_load_resources":a.n.do_not_load_resources=f;break;case "force_selectable":a.n.force_selectable=f;break;case "glow":a.n.glow=f;break;case "physics_enabled":a.gb.enabled=f;break;case "physics_uranium_path":a.gb.Gg=f;break;case "precision":a.n.precision=f;break;case "quality":a.n.quality=f;break;case "resolution_factor":a.n.resolution_factor=
f;break;case "sfx_mix_mode":a.Ad.hj=f;break;case "shaders_dir":a.yb.shaders_dir=f;break;case "show_hud_debug_info":a.n.show_hud_debug_info=f;break;case "smaa":a.n.smaa=f;break;case "smaa_search_texture_path":a.yb.smaa_search_texture_path=f;break;case "smaa_area_texture_path":a.yb.smaa_area_texture_path=f;break;case "wireframe_debug":a.n.wireframe_debug=f;break;case "water_wireframe_debug":a.n.Vj=f;break;default:c.error("B4W config set - property unknown: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.n.all_objs_selectable;
case "allow_cors":return a.n.Ug;case "alpha":return a.context.alpha;case "alpha_sort":return a.n.alpha_sort;case "alpha_sort_threshold":return a.n.alpha_sort_threshold;case "anaglyph_use":return a.n.anaglyph_use;case "animation_framerate":return a.Jd.ua;case "antialiasing":return a.n.antialiasing;case "assets_dds_available":return a.ad.Kk;case "assets_min50_available":return a.ad.Bl;case "background_color":return a.n.background_color;case "built_in_module_name":return a.yb.xi;case "console_verbose":return a.n.console_verbose;
case "context_antialias":return a.context.antialias;case "debug_subs_enabled":return a.eh.enabled;case "deferred_rendering":return a.n.deferred_rendering;case "do_not_load_resources":return a.n.do_not_load_resources;case "force_selectable":return a.n.force_selectable;case "glow":return a.n.glow;case "physics_enabled":return a.gb.enabled;case "physics_uranium_path":return a.gb.Gg;case "precision":return a.n.precision;case "quality":return a.n.quality;case "resolution_factor":return a.n.resolution_factor;
case "sfx_mix_mode":return a.Ad.hj;case "shaders_dir":return a.yb.shaders_dir;case "show_hud_debug_info":return a.n.show_hud_debug_info;case "smaa":return a.n.smaa;case "smaa_search_texture_path":return a.yb.smaa_search_texture_path;case "smaa_area_texture_path":return a.yb.smaa_area_texture_path;case "wireframe_debug":return a.n.wireframe_debug;case "water_wireframe_debug":return a.n.Vj;default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=f.ra(a.Ut);a.n=f.ra(a.Gu);
a.ad=f.ra(a.mt);a.gb=f.ra(a.Uw);a.Sh=f.ra(a.wx);a.Ad=f.ra(a.Rx);a.eh=f.ra(a.Cu)};a.ml=h;a.Jx=function(){var b=a.yb,f=a.gb;if(h())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path||""==f.Gg){for(var e=null,k=document.getElementsByTagName("script"),d=0;d<k.length;d++){for(var r=k[d].src,x=0;x<b.nq.length;x++)if(0<=r.indexOf(b.nq[x])){e=r;break}if(null!==e)break}e||(c.warn("Couldn't determine path to external resources, fallback to current page URL"),
e=document.location.href);k=e.indexOf("?");0<=k&&(e=e.substring(0,k));e=e.substring(0,e.lastIndexOf("/")+1)+b.px;f.Gg=f.Gg||e+"uranium.js";b.smaa_search_texture_path=b.smaa_search_texture_path||e+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||e+"smaa_area_texture.png"}};a.get_std_assets_path=function(){return a.ad.dir.replace("ASSETS=","")}};
b4w.module.__boundings=function(a,p){function h(a,b){for(var c=a[0],d=a[1],s=a[2],e=a[0],g=a[1],f=a[2],u=3;u<a.length;u+=3)var n=a[u],k=a[u+1],v=a[u+2],c=Math.max(c,n),d=Math.max(d,k),s=Math.max(s,v),e=Math.min(e,n),g=Math.min(g,k),f=Math.min(f,v);b.max_x=c;b.max_y=d;b.max_z=s;b.min_x=e;b.min_y=g;b.min_z=f;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,s=a.max_z,e=a.min_x,g=a.min_y,f=a.min_z;b[0]=e;b[1]=g;b[2]=f;b[3]=c;b[4]=g;b[5]=f;b[6]=c;b[7]=d;b[8]=f;b[9]=e;b[10]=
d;b[11]=f;b[12]=e;b[13]=g;b[14]=s;b[15]=c;b[16]=g;b[17]=s;b[18]=c;b[19]=d;b[20]=s;b[21]=e;b[22]=d;b[23]=s;return b}function f(a,b,c){k.add(b,c,a.t);k.scale(a.t,.5,a.t);a.ma=k.distance(a.t,b);return a}var b=p("__geometry"),l=p("__util"),e=p("__tsr"),k=p("vec3"),d=new Float32Array(24),r=new Float32Array(3),x=new Float32Array(3),n=new Float32Array(3);a.Rn=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.Nz=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Xc=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.mo=function(a,b){var c=a.max_y,d=a.max_z,s=a.min_x,e=a.min_y,g=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,s);a.min_y=Math.min(b.min_y,e);a.min_z=Math.min(b.min_z,g)};a.rt=h;a.pk=function(b,e,f){f||(f=a.Xc());b=c(b,d);l.ce(b,e,b);return h(b,f)};a.Vu=c;a.wB=function(b,c,d){d||
(d=a.Xc());var e=c.min_x,s=c.max_x,f=c.min_y,g=c.max_y,n=c.min_z;c=c.max_z;if(e>=b.max_x||s<=b.min_x||f>=b.max_y||g<=b.min_y||n>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,s);d.min_y=Math.max(b.min_y,f);d.max_y=Math.min(b.max_y,g);d.min_z=Math.max(b.min_z,n);d.max_z=Math.min(b.max_z,c);return d};a.zB=function(b,c,d){d||(d=a.Xc());var e=b.max_x-b.min_x,s=b.max_y-b.min_y,f=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*s;d.max_y=b.max_y+.5*(c-1)*s;d.min_z=b.min_z-.5*(c-1)*f;d.max_z=b.max_z+.5*(c-1)*f;return d};a.rk=function(b,c,d){d||(d=a.hi());k.transformMat4(b.t,c,d.t);d.ma=b.ma*l.dj(c);return d};a.qk=function(a,b,c){c||(c={Be:new Float32Array(3),Ce:new Float32Array(3),De:new Float32Array(3),t:new Float32Array([0,0,0])});e.Yh(a.t,b,c.t);k.copy(a.Be,c.Be);k.copy(a.Ce,c.Ce);k.copy(a.De,c.De);e.Ij(c.Be,b,c.Be);e.Ij(c.Ce,b,c.Ce);e.Ij(c.De,b,c.De);
return c};a.Ek=function(a,b){return{ma:a,t:new Float32Array(b)}};a.hi=function(){return{t:new Float32Array([0,0,0]),ma:0}};a.Dk=function(a,b,c,d){return{Be:new Float32Array(a),Ce:new Float32Array(b),De:new Float32Array(c),t:new Float32Array([d[0],d[1],d[2]])}};a.tt=function(){return{t:new Float32Array([0,0,0]),ma:1E12}};a.Tu=function(a,b){var c=k.subtract(b.t,a.t,k.create());0==k.length(c)&&k.set(1,0,0,c);var d=k.normalize(c,k.create()),c=k.scale(d,a.ma,k.create());k.add(c,a.t,c);var s=k.scale(d,
-a.ma,k.create());k.add(s,a.t,s);var e=k.scale(d,b.ma,k.create());k.add(e,b.t,e);var g=k.scale(d,-b.ma,k.create());k.add(g,b.t,g);c=[c,s,e,g];d=k.normalize(d,k.create());s=c[0];e=c[0];for(g=1;g<c.length;g++){var f=k.dot(c[g],d);f<k.dot(s,d)&&(s=c[g]);f>k.dot(e,d)&&(e=c[g])}d=[s,e];c=d[0];d=d[1];a.t=k.scale(k.add(c,d,k.create()),.5,k.create());a.ma=k.length(k.subtract(d,c,k.create()))/2};a.Sn=function(a,b){var c=b.max_y,d=b.min_y,s=Math.max(0,c-d-2*a);return{ma:a,height:s,t:new Float32Array([0,(c+
d)/2,0])}};a.Un=function(a,b){var c=b.max_y,d=b.min_y,s=Math.max(0,c-d);return{ma:a,height:s,t:new Float32Array([0,(c+d)/2,0])}};a.Tn=function(a,b){var c=b.max_y,d=b.min_y,s=Math.max(0,c-d);return{ma:a,height:s,t:new Float32Array([0,(c+d)/2,0])}};a.Rz=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.gx=function(a){for(var b=0,c=0,d=0,s=0,e=0,g=0,f=0,u=0,n=0;n<a.submeshes.length;n++){var k=a.submeshes[n];if(k.position.length){b=
s=k.position[0];c=e=k.position[1];d=g=k.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var k=a.submeshes[n],k=k.position,v=0;v<k.length/3;v++)var l=k[3*v],m=k[3*v+1],H=k[3*v+2],b=Math.max(l,b),c=Math.max(m,c),d=Math.max(H,d),s=Math.min(l,s),e=Math.min(m,e),g=Math.min(H,g),f=Math.max(Math.sqrt(l*l+m*m+H*H),f),u=Math.max(Math.sqrt(l*l+H*H),u);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=s;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=e;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
g;a.b4w_bounding_sphere_radius=f;a.b4w_bounding_cylinder_radius=u};a.Mv=function(c){var d=c.subarray(0,3),e=c.subarray(6,9),q=c.subarray(12,15),s=c.subarray(18,21);c=k.subtract(e,d,r);k.normalize(c,c);var l=b.Ov(d,e,q,x),l=k.cross(l,c,l);k.normalize(l,l);var g=k.create(),h=k.create();k.subtract(e,d,n);h[0]=k.dot(n,c);h[1]=k.dot(n,l);e=k.create();k.subtract(q,d,n);e[0]=k.dot(n,c);e[1]=k.dot(n,l);q=k.create();k.subtract(s,d,n);q[0]=k.dot(n,c);q[1]=k.dot(n,l);s=a.hi();q=[g,h,e,q];g=f(s,q[0],q[1]);for(s=
2;s<q.length;s++)if(k.distance(g.t,q[s])>g.ma){for(var u=g,g=q,h=q[s],e=s-1,u=f(u,h,g[0]),S=1;S<=e;S++)if(k.distance(u.t,g[S])>u.ma){for(var I=u,u=g,v=h,K=g[S],m=S-1,I=f(I,v,K),H=0;H<=m;H++)if(k.distance(I.t,u[H])>I.ma){var D=v,U=K,P=u[H],Z=k.subtract(U,P,n),Z=k.squaredLength(Z),V=k.subtract(D,P,n),M=k.squaredLength(V),V=k.subtract(D,U,n),p=k.squaredLength(V),V=Z*(M+p-Z),T=M*(p+Z-M),Z=p*(Z+M-p),M=V+T+Z;k.copy(D,I.t);k.scale(I.t,V/M,I.t);k.scaleAndAdd(I.t,U,T/M,I.t);k.scaleAndAdd(I.t,P,Z/M,I.t);I.ma=
k.distance(I.t,D)}u=I}g=u}s=g;c=k.scale(c,s.t[0],n);k.scaleAndAdd(c,l,s.t[1],c);k.add(c,d,s.t);return s}};
b4w.module.__compat=function(a,p){function h(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function c(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}var f=p("__config"),b=p("__extensions"),l=p("__print"),e=p("__util");a.Gx=function(a){var d=f.Jd,r=f.n,x=f.context,
n=f.Sh,t=f.Ad;r.kf=a.getParameter(a.MAX_TEXTURE_SIZE);r.zl=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var w=Boolean(b.Jv());h("Firefox")&&f.ml()&&(l.warn("Firefox detected for single HTML version, disable video textures."),r.vo=!0);h("Firefox/28.0")&&(h("Linux")||h("Macintosh"))&&(l.warn("Firefox 28 detected, applying depth hack"),w=!1);h("iPad")||h("iPhone")?(l.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
x.alpha||(r.background_color[3]=1),r.mr=!0,r.smaa=!1,r.yf=!1,r.precision="highp",r.gp=!0):h("Mac OS X")&&h("Safari")&&!h("Chrome")&&(l.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),t.hn=!0,t.Fn=!0);h("Windows")&&(h("Firefox/33")||h("Firefox/34"))&&(l.warn("Windows/Firefox33-34 detected. Applying procedural skydome update hack."),r.Cq=!0);h("Windows")&&(h("Chrome/40")||h("Chrome/41"))&&(l.warn("Windows/Chrome40-41 detected. Applying clear procedural skydome hack."),
r.Jn=!0);c()&&(l.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),r.Ue=!0,r.Ze=!0,h("iPad")||h("iPhone")||(l.warn("Mobile (not iOS) detected, disable playback rate for video textures."),t.ho=!0));10>a.getParameter(a.MAX_VARYING_VECTORS)&&(l.warn("Not enough varyings, disable shadows on blend objects"),r.fo=!0);if(x=b.Mo())h("Macintosh")&&-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(l.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),
w=!1,r.Ue=!0),-1<a.getParameter(x.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(l.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),w=!1,d.zo=!0),-1<a.getParameter(x.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(l.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),r.precision="highp",r.ge="NONE"),-1<a.getParameter(x.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(l.warn("Qualcomm Adreno detected, applying shader constants hack."),r.Yl=!0,-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(l.warn('Qualcomm Adreno305 detected, set "highp" precision.'),r.precision="highp"),-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(l.warn('Qualcomm Adreno330 detected, set "highp" precision.'),r.precision="highp")),-1<a.getParameter(x.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(x.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(l.warn("NVIDIA Tegra 3 detected, force low quality for LEVELS_OF_QUALITY nodes."),r.Vk=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(l.warn("Vertex textures are not allowed. Disabling vertex textures"),r.ek=!1);w||(r.deferred_rendering=!1,r.Vf=!1,r.Eh=!1,r.ya=!1,r.Kh=!1,r.water_dynamic=!1,r.shore_smoothing=!1,r.ng=!1,r.smaa=!1);r.hr=Boolean(b.No());d=e.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);r.max_bones=e.trunc((d-50)/4);r.kB=e.trunc((d-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(r.precision="mediump");!window.ActiveXObject&&"ActiveXObject"in window&&(l.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),n.bh=512,r.cp=!0);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(l.warn("Not enough fragment uniforms, force low quality for LEVELS_OF_QUALITY nodes."),r.Vk=!0)};a.detect_mobile=c};
b4w.module.__constraints=function(a,p){function h(a){var b={};b.type=a;return b}function c(a,b){a.$a&&a.$a.K&&f(a.$a.K,a);if(b.K){var c=b.K;if(-1==c.Fd.indexOf(a))c.Fd.push(a);else throw"Descendant object override is forbidden";}a.$a=b}function f(a,b){var c=a.Fd.indexOf(b);if(-1!=c)a.Fd.splice(c,1);else throw"No descendant object";}function b(a,b,c){switch(b.type){case 1:var d=a.d.quat,f=b.K.d.H;c=b.K.d.quat;b.ee?(w.copy(b.ee,d),w.multiply(c,d,d)):w.copy(c,d);t.transformMat4(b.offset,f,a.d.e);a.d.scale=
b.yj*b.K.d.scale;break;case 9:var u=a.d.e,d=a.d.quat,f=b.K.d.H;c=b.K.d.quat;w.multiply(w.invert(b.sf,b.sf),d,d);w.multiply(c,d,d);t.transformMat4(b.offset,f,u);w.copy(c,b.sf);break;case 10:u=a.d.e;d=a.d.quat;f=b.K.d.H;c=b.K.d.quat;w.multiply(w.invert(b.sf,b.sf),d,d);w.multiply(c,d,d);t.transformMat4(b.offset,f,u);w.copy(c,b.sf);var d=a.d.quat,u=b.K.d.quat,h=t.transformQuat(n.AXIS_Y,d,q),f=w.invert(u,A),I=t.transformQuat(h,f,s),p=y;p[0]=I[0];p[1]=0;p[2]=I[2];var X=t.length(p),f=-p[2]/X,f=Math.acos(f)*
n.sign(p[0]),X=X/t.length(I),X=Math.acos(X)*n.sign(I[1]),I=!1;f<-b.En&&(f=-b.En,I=!0);f>b.Gn&&(f=b.Gn,I=!0);X<-b.Hn&&(X=-b.Hn,I=!0);X>b.Dn&&(X=b.Dn,I=!0);I&&(b=Math.sin(X),X=Math.cos(X),I=Math.sin(f),f=Math.cos(f),p=s,p[0]=X*I,p[1]=b,p[2]=-X*f,t.transformQuat(p,u,p),b=w.rotationTo(h,p,A),w.multiply(b,d,d),w.normalize(d,d));"CAMERA"==a.d.type&&(b=t.transformQuat(n.AXIS_Y,c,s),k(a,b));break;case 12:u=a.d.e;d=a.d.quat;f=b.K.d.H;X=b.K.d.e;a=b.Xx;I=q;h=A;t.transformMat4(b.offset,f,I);n.smooth_v(I,u,c,
a,u);b=q;t.sub(X,u,b);t.normalize(b,b);p=d;u=v;f=u.subarray(0,3);X=u.subarray(3,6);I=u.subarray(6,9);t.copy(b,X);t.negate(X,X);t.normalize(X,X);Boolean(.999999<Math.abs(t.dot(b,n.AXIS_Y)))?(b=B.fromQuat(w.normalize(p,h),K),t.copy(b.subarray(0,3),f)):t.cross(n.AXIS_Y,X,f);t.normalize(f,f);t.cross(f,X,I);t.normalize(I,I);w.fromMat3(u,h);w.normalize(h,h);n.Eq(h,d,c,.16*a,d);break;case 2:d=a.d.quat;u=g;c=A;r(b.K,b.xt,!0,u,c);b.ee?(w.copy(b.ee,d),w.multiply(c,d,d)):w.copy(c,d);a.d.scale=b.yj*u[3];n.Yh(b.offset,
u[3],c,u,a.d.e);break;case 3:u=a.d.e;d=a.d.quat;c=b.K.d.e;l(u,d,c);"CAMERA"==a.d.type&&k(a,n.AXIS_Y);break;case 4:u=a.d.e;d=a.d.quat;c=b.target;l(u,d,c);"CAMERA"==a.d.type&&k(a,n.AXIS_Y);break;case 5:u=a.d.e;d=a.d.quat;c=b.K.d.e;d=e(u,d,c,b.wd,m);h=t.dist(u,c);if(b=d?h+b.wd:h>b.Ch?h-b.Ch:h<b.wd?h-b.wd:0)t.sub(c,u,q),t.normalize(q,q),t.scale(q,b,q),t.add(u,q,u);"CAMERA"==a.d.type&&k(a,n.AXIS_Y);break;case 6:u=a.d.e;d=a.d.quat;c=b.target;d=e(u,d,c,b.wd,m);h=t.dist(u,c);if(b=d?h+b.wd:h>b.Ch?h-b.Ch:h<
b.wd?h-b.wd:0)t.sub(c,u,q),t.normalize(q,q),t.scale(q,b,q),t.add(u,q,u);"CAMERA"==a.d.type&&k(a,n.AXIS_Y);break;case 7:f=b.K.d.H;t.transformMat4(b.offset,f,a.d.e);break;case 8:X=b.K.d.e;u=a.d.e;t.add(X,b.offset,u);break;case 13:d=a.d.quat;f=b.K.d.H;c=b.K.d.quat;b.ee?(w.copy(b.ee,d),w.multiply(c,d,d)):w.copy(c,d);t.transformMat4(b.offset,f,a.d.e);break;case 11:c=b.K.d,c=x.Of(c.e,c.scale,c.quat,S),x.multiply(c,b.br,c),u=a.d.e,u[0]=c[0],u[1]=c[1],u[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],
d[2]=c[6],d[3]=c[7]}}function l(a,b,c){var m=q;n.quat_to_dir(b,n.AXIS_MY,m);t.normalize(m,m);var d=s;t.subtract(c,a,d);t.normalize(d,d);a=g;n.sq(m,d,a);w.multiply(a,b,b)}function e(a,b,c,m,d){var e=!1,u=q;n.quat_to_dir(b,n.AXIS_MY,u);t.normalize(u,u);var f=s;t.subtract(c,a,f);a=t.length(f);t.normalize(f,f);t.dot(u,f)<Math.cos(d)&&(t.scale(f,-1,f),e=!0);a>m-.001&&(m=n.sq(u,f,g),w.multiply(m,b,b),w.normalize(b,b));return e}function k(a,b){var c=a.d.quat,m=d(c,b,A);w.multiply(m,c,c)}function d(a,b,c){a=
B.fromQuat(a,v);var m=q;m[0]=a[3];m[1]=a[4];m[2]=a[5];if(.999999<Math.abs(t.dot(b,m)))return w.identity(c),c;b=t.cross(b,m,m);t.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);m=s;m[0]=a[0];m[1]=a[1];m[2]=a[2];t.normalize(m,m);w.rotationTo(m,b,c);return c}function r(a,b,c,m,d){var s=a.d,e=s.Qe,f=s.gc[b];b=f.fh;a=a.pose.bones[f.Ol];var f=a.Um,q=g,v=s.dc,n=s.cc,k=s.Vb,h=s.Ub,l=v[4*b+1],t=v[4*b+2],r=v[4*b+3],y=n[4*b+1],C=n[4*b+2],J=n[4*b+3];q[0]=(1-e)*v[4*b]+e*n[4*b];q[1]=(1-e)*l+e*y;q[2]=(1-e)*
t+e*C;q[3]=(1-e)*r+e*J;v=A;n=u;v[0]=k[4*b];v[1]=k[4*b+1];v[2]=k[4*b+2];v[3]=k[4*b+3];n[0]=h[4*b];n[1]=h[4*b+1];n[2]=h[4*b+2];n[3]=h[4*b+3];w.slerp(v,n,e,v);e=S;x.Nx(q,e);x.Xl(v,e);c?(c=I,x.translate(f,a.Ps,c),x.multiply(e,c,e)):x.multiply(e,f,e);x.multiply(s.Tc,e,e);m[0]=e[0];m[1]=e[1];m[2]=e[2];m[3]=e[3];d&&(d[0]=e[4],d[1]=e[5],d[2]=e[6],d[3]=e[7])}var x=p("__tsr"),n=p("__util"),t=p("vec3"),w=p("quat"),B=p("mat3");p("mat4");a.uz=1;a.tz=2;a.xz=3;a.yz=4;a.oz=5;a.pz=6;a.vz=7;a.nz=8;a.sz=9;a.rz=10;a.Yc=
11;a.qz=12;a.wz=13;var q=new Float32Array(3),s=new Float32Array(3),y=new Float32Array(3),g=new Float32Array(4),A=new Float32Array(4),u=new Float32Array(4),S=new Float32Array(16),I=new Float32Array(16),v=new Float32Array(9),K=new Float32Array(9),S=new Float32Array(8),m=9*Math.PI/10;a.wr=m;a.bn=function(a,m,d,g,s){var e=h(1);e.K=m;e.offset=new Float32Array(d);e.ee=g?new Float32Array(g):null;e.yj=s;c(a,e);b(a,e,0)};a.an=function(a,m,d,g,s,e){var f=h(2);f.K=m;f.xt=d;f.offset=new Float32Array(g);f.ee=
s?new Float32Array(s):null;f.yj=e;c(a,f);b(a,f,0)};a.bt=function(a,m,d,g){var s=h(9),e=a.d.quat,f=m.d.quat;s.K=m;s.offset=new Float32Array(d);s.sf=new Float32Array(f);g&&(w.copy(g,e),w.multiply(f,e,e));c(a,s);b(a,s,0)};a.at=function(a,m,d,g,s,e,f,u){var v=h(10),q=a.d.quat,n=m.d.quat;v.K=m;v.offset=new Float32Array(d);v.sf=new Float32Array(n);v.En=s;v.Gn=e;v.Hn=f;v.Dn=u;g&&(w.copy(g,q),w.multiply(n,q,q));c(a,v);b(a,v,0)};a.$s=function(a,m,d,g){var s=h(12);s.K=m;s.offset=new Float32Array(d);s.Xx=g;
c(a,s);b(a,s,0)};a.dt=function(a,m,d,s){var g=h(13);g.K=m;g.offset=new Float32Array(d);g.yj=1;g.ee=s?new Float32Array(s):null;c(a,g);b(a,g,0)};a.ft=function(a,m){var d=h(3);d.K=m;c(a,d);b(a,d,0)};a.gt=function(a,m){var d=h(4);d.target=new Float32Array(m);c(a,d);b(a,d,0)};a.Xs=function(a,m,d,g){var s=h(5);s.K=m;s.wd=d;s.Ch=g;c(a,s);b(a,s,0)};a.Ys=function(a,m,d,s){var g=h(6);g.target=new Float32Array(m);g.wd=d;g.Ch=s;c(a,g);b(a,g,0)};a.ct=function(a,m,d){var g=h(7);g.K=m;g.offset=new Float32Array(d);
c(a,g);b(a,g,0)};a.Ws=function(a,m,d){var g=h(8);g.K=m;g.offset=new Float32Array(d);c(a,g);b(a,g,0)};a.Vs=function(a,m,d){var g=h(11);g.K=m;g.br=new Float32Array(d);c(a,g);b(a,g,0)};a.Ky=function(a,c){a.$a&&b(a,a.$a,c)};a.qx=l;a.rx=e;a.correct_up=k;a.Pz=d;a.remove=function(a){a.$a.K&&f(a.$a.K,a);a.$a=null};a.rd=function(a){return a.$a?a.$a.type:null};a.EA=function(a){return a.$a&&a.$a.K?a.$a.K:null};a.qd=function(a){return a.$a&&11==a.$a.type?a.$a.br:null};a.Cv=r};
b4w.module.__controls=function(a,p){function h(a){return{type:a,value:0,Tb:null,wl:null,vl:null,cj:null,Pd:!1,key:0,Qb:"",yk:null,Dl:!1,xk:function(){},wk:null,Kn:function(){},Nc:null,im:new Float32Array(3),Pk:new Float32Array(3),ul:!1,iq:function(){},axis:"",bc:0,Dg:new Float32Array(3),uj:new Float32Array(4),threshold:0,gq:new Float32Array(4),ri:0,qi:0,rq:0,si:0,Gh:0,jn:!1}}function c(a,b){var c;if(a.cj){c=a.wl;for(var m=a.vl,D=0;D<c.length;D++)m[D]=c[D].value;c=a.cj(m)}else c=!1;c||(a.value=Number(b))}
function f(a){a=v.indexOf(a);-1<a?v.splice(a,1):s.error("Wrong object")}function b(a,b){for(var c=0,m=0;m<b.length;m++)for(var D=b[m].xe,d=0;d<D.length;d++)for(var E=D[d].Lc,g=0;g<E.length;g++)E[g]===a&&c++;return c}function l(a,b){switch(a.type){case 80:y.remove_collision_test(a.yk,a.Qb,a.xk);a.Pd=!0;break;case 90:y.clear_collision_impulse_test(a.wk);a.Pd=!0;break;case 100:y.remove_ray_test(a.Nc,a.Qb,a.im,a.Pk,a.ul),a.Pd=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function e(a){for(var b=0;b<K.length;b++){var m=
K[b];20==m.type&&a.keyCode==m.key&&c(m,1)}G&&a.preventDefault()}function k(a){for(var b=0;b<K.length;b++){var m=K[b];20==m.type&&0==a.keyCode&&16==m.key&&c(m,0);20==m.type&&a.keyCode==m.key&&c(m,0)}G&&a.preventDefault()}function d(a){var b=!1,m=null;D=a.clientX;U=a.clientY;for(var d=0;d<K.length;d++){var s=K[d];50==s.type&&(c(s,1),s.Tb=a.which);160==s.type&&(b||(m=g.pick_object(a.clientX,a.clientY),b=!0),s.value=m==s.Nc?1:0)}fa&&a.preventDefault()}function r(a){for(var b=0;b<K.length;b++){var m=K[b];
50==m.type&&c(m,0);160==m.type&&m.jn&&(m.value=0)}fa&&a.preventDefault()}function x(a){var b=a.clientX,m=a.clientY;D=b;U=m;for(var b=b-P,m=m-Z,d=Math.sqrt(b*b+m*m),g=0;g<K.length;g++){var s=K[g];if(40===s.type)switch(s.axis){case "X":c(s,b);break;case "Y":c(s,m);break;case "XY":c(s,d)}}fa&&a.preventDefault()}function n(a){var b=a.wheelDelta||-40*a.detail,b=b*I.Kw;H+=b;for(b=0;b<K.length;b++){var m=K[b];30===m.type&&c(m,H)}da&&a.preventDefault()}function t(a){a=a.targetTouches;if(1==a.length){var b=
a[0];a=b.pageX;for(var b=b.pageY,c=!1,m=null,D=0;D<K.length;D++){var d=K[D];160==d.type&&(c||(m=g.pick_object(a,b),c=!0),d.value=m==d.Nc)}Q[0]=a;Q[1]=-1;T[0]=b;T[1]=-1}else 1<a.length&&(X=z=B(a),Q[0]=a[0].pageX,Q[1]=a[1].pageX,T[0]=a[0].pageY,T[1]=a[1].pageY);V.set(Q);M.set(T)}function w(a){var b=a.targetTouches;if(0!==b.length){if(1===b.length){V[0]=b[0].pageX;V[1]=-1;M[0]=b[0].pageY;M[1]=-1;var b=V[0]-Q[0],m=M[0]-T[0],D=Math.sqrt(b*b+m*m);if(-1!=Q[1]&&-1!=T[1]){var d=V[0]-Q[1],g=M[0]-T[1],E=Math.sqrt(d*
d+g*g);E<D&&(b=d,m=g,D=E)}for(d=0;d<K.length;d++)if(g=K[d],60===g.type)switch(g.axis){case "X":c(g,b);break;case "Y":c(g,m);break;case "XY":c(g,D)}}else if(1<b.length)for(V[0]=b[0].pageX,V[1]=b[1].pageX,M[0]=b[0].pageY,M[1]=b[1].pageY,X=B(b),b=X-z,d=0;d<K.length;d++)g=K[d],70===g.type&&c(g,b);C&&a.preventDefault()}}function B(a){var b=a[0],m=a[1];a=b.pageX;var b=b.pageY,c=m.pageX,m=m.pageY;return Math.sqrt((a-c)*(a-c)+(b-m)*(b-m))}var q=p("__config"),s=p("__print"),y=p("__physics"),g=p("__scenes"),
A=p("__util"),u=p("vec3"),S=p("quat"),I=q.controls,v=[],K=[],m={},H=0,D=0,U=0,P=0,Z=0,V=new Float32Array(2),M=new Float32Array(2),Q=new Float32Array(2),T=new Float32Array(2),X=0,z=0,ia=0,W=!1,L=0,G=!1,fa=!1,da=!1,C=!1;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(b,d){ia=b;for(var g=0;g<K.length;g++){var s=K[g],e=b,C=d;if(C)switch(s.type){case 110:var E=s.Nc,f=E.d.e,E=E.d.quat,q=u.dist(s.Dg,f),n=s.gq;S.invert(s.uj,n);S.multiply(E,n,n);S.normalize(n,n);n=Math.abs(2*
Math.acos(n[3]));q/=C;s.ri=A.smooth(q,s.ri,C,.3);s.Tb[0]=q;q=n/C;s.qi=A.smooth(q,s.qi,C,.3);s.Tb[1]=q;s.ri>=s.threshold||s.qi>=s.rq?c(s,1):c(s,0);u.copy(f,s.Dg);S.copy(E,s.uj);s.bc=e;break;case 120:E=s.Nc;f=E.d.e;E=Math.abs(f[1]-s.Dg[1])/C;s.si=A.smooth(E,s.si,C,.3);s.Tb=E;s.si>=s.threshold?c(s,1):c(s,0);u.copy(f,s.Dg);s.bc=e;break;case 130:e-s.bc>=s.Gh&&(c(s,1),s.bc=e);break;case 140:s.bc||(s.bc=e);c(s,e-s.bc);s.bc=e;break;case 150:c(s,e)}}for(g=0;g<v.length;g++)for(C=v[g],s=C.xe,e=0;e<s.length;e++)if(f=
s[e],f.er!=L){f.er=L;for(var E=f,q=E.Lc,n=E.Bx,w=0;w<q.length;w++)n[w]=q[w].value;var E=E.Aw(n),q=f,n=q.qp,k=w=void 0;switch(q.type){case a.CT_CONTINUOUS:E?k=w=1:1==n?k=w=-1:w=0;break;case a.CT_TRIGGER:E&&-1==n?k=w=1:E||1!=n?w=0:k=w=-1;break;case a.CT_SHOT:E&&-1==n?k=w=1:E||1!=n?w=0:(w=0,k=-1);break;case a.CT_LEVEL:w=q.pp!=E?1:0;break;default:A.da("Wrong sensor manifold type: "+q.type)}k&&(q.qp=k);if(q=w)if(n=C==m?null:C,W=!1,f.callback(n,f.id,q,f.Bt),f.pp=E,W){g=-1;break}}for(g=0;g<v.length;g++)for(C=
v[g],s=C.xe,e=0;e<s.length;e++)for(f=s[e],C=f.Lc,f=0;f<C.length;f++)switch(E=C[f],E.type){case 30:c(E,0);break;case 40:c(E,0);break;case 60:c(E,0);break;case 70:c(E,0);break;case 130:c(E,0)}H=0;P=D;Z=U;Q.set(V);T.set(M);z=X;L++};a.create_custom_sensor=function(a){var b=h(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=h(20);b.key=a;return b};a.create_collision_sensor=function(a,b,m){if(!a||!a.j)return s.error("Wrong collision object"),null;var D=h(80);D.yk=a;D.Qb=b||"ANY";D.Dl=m;D.xk=
function(a,b){c(D,a);a&&b&&m&&(D.Tb=D.Tb||new Float32Array(3),D.Tb[0]=b[0],D.Tb[1]=b[1],D.Tb[2]=b[2])};D.Pd=!0;return D};a.create_collision_impulse_sensor=function(a){if(!a||!a.j)return s.error("Wrong collision impulse object"),null;var b=h(90);b.wk=a;b.Kn=function(a){c(b,a)};b.Pd=!0;return b};a.create_ray_sensor=function(a,b,m,D,d){if(!a)return s.error("Wrong collision object"),null;var g=h(100);g.Nc=a;g.im=b;g.Pk=m;g.ul=D;g.Qb=d||"ANY";g.iq=function(a,b){c(g,a);a&&(g.Tb=b)};g.Pd=!0;return g};a.create_mouse_click_sensor=
function(){return h(50)};a.create_mouse_wheel_sensor=function(){return h(30)};a.create_mouse_move_sensor=function(a){var b=h(40);b.axis=a||"XY";return b};a.create_touch_move_sensor=function(a){var b=h(60);b.axis=a||"XY";return b};a.create_touch_zoom_sensor=function(){return h(70)};a.create_motion_sensor=function(a,b,m){if(!a)return s.error("Wrong collision object"),null;var c=h(110);c.Nc=a;var D=a.d.e;a=a.d.quat;c.gq=new Float32Array(4);c.Dg=new Float32Array(D);c.uj=new Float32Array(a);c.ri=0;c.qi=
0;c.threshold=b;c.rq=m;c.bc=0;c.Tb=new Float32Array([0,0]);return c};a.create_vertical_velocity_sensor=function(a,b){if(!a)return s.error("Wrong collision object"),null;var m=h(120);m.Nc=a;var c=a.d.quat;m.Dg=new Float32Array(a.d.e);m.uj=new Float32Array(c);m.si=0;m.threshold=b;m.bc=0;m.Tb=0;return m};a.create_timer_sensor=function(a){var b=h(130);b.Gh=a;b.bc=ia;return b};a.reset_timer_sensor=function(a,b,c,D){a=a||m;D=D||0;a=a.Ac;if(!a||!a[b])return s.error("reset_timer_sensor(): wrong object"),
null;b=a[b].Lc[c];if(!b)return s.error("reset_timer_sensor(): sensor not found"),null;b.bc=ia+D};a.create_elapsed_sensor=function(){var a=h(140);a.bc=0;return a};a.create_timeline_sensor=function(){return h(150)};a.create_selection_sensor=function(a,b){var m=h(160);m.Nc=a;m.jn=b;return m};a.Ax=c;a.get_sensor_value=function(a,b,c){a=a||m;a=a.Ac;return a&&a[b]?(b=a[b].Lc[c])?b.value:(s.error("get_sensor_value(): sensor not found"),null):(s.error("get_sensor_value(): wrong object"),null)};a.get_sensor_payload=
function(a,b,c){a=a||m;a=a.Ac;return a&&a[b]?(b=a[b].Lc[c])?b.Tb:(s.error("get_sensor_payload(): sensor not found"),null):(s.error("get_sensor_payload(): wrong object"),null)};a.cleanup=function(){v=[];K=[];m={};ia=0};a.check_sensor_manifold=function(a,b){a=a||m;if(!a.Ac)return!1;if(b&&a.Ac[b])return!0;if(!b)for(var c in a.Ac)return!0;return!1};a.remove_sensor_manifold=function(a,c){a=a||m;var D=a.Ac,d=a.xe;if(c){var g=D[c];if(g){for(var s=g.Lc,E=0;E<s.length;E++)1===b(s[E],v)&&l(s[E],K);delete D[c];
g=d.indexOf(g);-1<g?d.splice(g,1):A.da("Incorrect manifolds array");Object.getOwnPropertyNames(D).length||f(a)}}else{for(c in D){g=D[c];s=g.Lc;for(E=0;E<s.length;E++)1===b(s[E],v)&&l(s[E],K);delete D[c];g=d.indexOf(g);-1<g?d.splice(g,1):A.da("Incorrect manifolds array")}f(a);W=!0}};a.create_sensor_manifold=function(a,c,D,d,g,s,E){a=a||m;a.Ac=a.Ac||{};a.xe=a.xe||[];var e=a.Ac,C=a.xe,f=e[c];if(f){d=f.Lc;for(var H=0;H<d.length;H++)1===b(d[H],v)&&l(d[H],K);f=C.indexOf(f);-1<f?C.splice(f,1):A.da("Incorrect manifolds array")}D=
{id:c,type:D,Lc:d.slice(0),Aw:g,Bx:Array(d.length),callback:s,Bt:E,qp:-1,pp:0,er:-1};e[c]=D;C.push(D);-1==v.indexOf(a)&&v.push(a);a=D.Lc;for(c=0;c<a.length;c++){e=a[c];if(e.Pd){switch(e.type){case 80:y.append_collision_test(e.yk,e.Qb,e.xk,e.Dl);break;case 90:y.apply_collision_impulse_test(e.wk,e.Kn);break;case 100:y.append_ray_test(e.Nc,e.Qb,e.im,e.Pk,e.ul,e.iq)}e.Pd=!1}-1==K.indexOf(e)&&K.push(e)}W=!0};a.Mk=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.Fu=function(a){for(var b=
0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<v.length;a++){var b=v[a],c=b.Ac,b=b.xe,m;for(m in c)delete c[m];b.splice(0,b.length)}for(a=0;a<K.length;a++)l(K[a],K),a--;v.splice(0,v.length)};a.debug=function(){s.log(String(v.length)+" objects with manifolds",v);s.log(String(K.length)+" sensors",K);for(var a=[],b=[],c=0;c<K.length;c++){var m=K[c];80==m.type&&a.push(m);100==m.type&&b.push(m)}s.log(String(a.length)+" collision sensors",a);s.log(String(b.length)+
" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",e,!1);a.addEventListener("keyup",k,!1);G=b};a.register_mouse_events=function(a,b){a.addEventListener("mousedown",d,!1);a.addEventListener("mousemove",x,!1);a.addEventListener("mouseout",r,!1);a.addEventListener("mouseup",r,!1);fa=b};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",n,!1);a.addEventListener("DOMMouseScroll",n,!1);da=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",
t,!1);a.addEventListener("touchmove",w,!1);document.addEventListener("touchstart",function(){});C=b};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",e,!1);a.removeEventListener("keyup",k,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",d,!1);a.removeEventListener("mousemove",x,!1);a.removeEventListener("mouseout",r,!1);a.removeEventListener("mouseup",r,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",n,!1);a.removeEventListener("DOMMouseScroll",
n,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",t,!1);a.removeEventListener("touchmove",w,!1);document.removeEventListener("touchstart",function(){})}};
b4w.module.__curve=function(a,p){function h(a,b,c,d,f){var h=d.length;f||(f=new Float32Array(h));for(var n=h+a,t=new Float32Array(n),w=1;w<=n-1;w++)t[w-1]=b>=c[w-1]&&b<c[w+1-1]?1:0;for(var B=2;B<=a;B++)for(w=1;w<=n-B;w++)t[w-1]=(0!=t[w-1]?(b-c[w-1])*t[w-1]/(c[w+B-1-1]-c[w-1]):0)+(0!=t[w+1-1]?(c[w+B-1]-b)*t[w+1-1]/(c[w+B-1]-c[w+1-1]):0);b==c[n-1]&&(t[h-1]=1);a=0;for(w=1;w<=h;w++)a+=t[w-1]*d[w-1];for(w=1;w<=h;w++)f[w-1]=0!=a?t[w-1]*d[w-1]/a:0;return f}function c(a){a=a.aj;return a[a.length-1]}function f(a){a=
a.Zn;return a[a.length-1]}var b=p("__util");a.ru=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var d=a.order_u;b.be=d;a=a.points;var f=a.length/5,x=[],n=f+d,f=f+2;x[0]=0;for(var t=2;t<=n;t++)x[t-1]=t>d&&t<f?x[t-2]+1:x[t-2];b.aj=x;if("2D"==c.dimensions)b.Xd=!1;else if("3D"==c.dimensions)b.Xd=!0;else throw"Wrong curve dimensions";d=[];x=[];for(c=0;c<a.length;c+=5)d.push(a[c]),d.push(a[c+1]),d.push(a[c+2]),b.Xd&&d.push(a[c+3]),x.push(a[c+4]);b.Ck=
d;b.Fm=x;a=[];for(var c=b.Ck,d=b.Xd?4:3,x=b.Fm,n=b.aj,f=b.be,t=c.length/d,w=t+f,B=0,q=n[w-1]/999,s=0;1E3>s;s++){5E-6>n[w-1]-B&&(B=n[w-1]);for(var y=h(f,B,n,x),g=0;g<d;g++)for(var A=a[d*s+g]=0;A<t;A++)a[d*s+g]+=y[A]*c[d*A+g];B+=q}d=b.Xd?4:3;x=new Float32Array(1E3);x[0]=0;for(c=1;1E3>c;c+=1)n=a[(c-1)*d],f=a[(c-1)*d+1],t=a[(c-1)*d+2],w=a[c*d],B=a[c*d+1],q=a[c*d+2],x[c]=x[c-1]+Math.sqrt((w-n)*(w-n)+(B-f)*(B-f)+(q-t)*(q-t));b.Zn=x;return b};a.iy=function(a,b,f){f||(f=[]);var d=b,r=Math.max(d,0);b=Math.min(d,
c(a));var d=a.Ck,r=a.Xd?4:3,x=a.Fm,n=a.aj,t=a.be;a=d.length/r;var w=a+t;5E-6>n[w-1]-b&&(b=n[w-1]);w=new Float32Array(a);h(t,b,n,x,w);for(b=0;b<r;b++)for(x=f[b]=0;x<a;x++)f[b]+=w[x]*d[r*x+b]};a.fy=function(a,b,c){c||(c=[]);var d=a.Ck,f=a.Xd?4:3,h=a.Fm,n=a.aj,t=a.be;a=d.length/f;var w=a+t;5E-6>n[w-1]-b&&(b=n[w-1]);var w=new Float32Array(a),B=b;b=w;var q=h.length;b||(b=new Float32Array(q));var s=new Float32Array(q),y=new Float32Array(q),g=s,A=y;g||(g=new Float32Array(q));A||(A=new Float32Array(q));for(var u=
q+t,S=new Float32Array(u),I=new Float32Array(u),v=1;v<=u-1;v++)S[v-1]=B>=n[v-1]&&B<n[v+1-1]?1:0;B==n[u-1]&&(S[q-1]=1);for(var K=2;K<=t;K++)for(v=1;v<=u-K;v++){var m=0!=S[v-1]?S[v-1]/(n[v+K-1-1]-n[v-1]):0,H=0!=S[v+1-1]?-S[v+1-1]/(n[v+K-1]-n[v+1-1]):0,D=0!=I[v-1]?(B-n[v-1])*I[v-1]/(n[v+K-1-1]-n[v-1]):0,U=0!=I[v+1-1]?(n[v+K-1]-B)*I[v+1-1]/(n[v+K-1]-n[v+1-1]):0;S[v-1]=(0!=S[v-1]?(B-n[v-1])*S[v-1]/(n[v+K-1-1]-n[v-1]):0)+(0!=S[v+1-1]?(n[v+K-1]-B)*S[v+1-1]/(n[v+K-1]-n[v+1-1]):0);I[v-1]=m+H+D+U}for(v=1;v<=
q;v++)g[v-1]=S[v-1],A[v-1]=I[v-1];n=0;for(t=1;t<=q;t++)n+=s[t-1]*h[t-1];B=0;for(t=1;t<=q;t++)B+=y[t-1]*h[t-1];for(t=1;t<=q;t++)b[t-1]=0!=n?y[t-1]*h[t-1]/n+s[t-1]*h[t-1]*B/(n*n):0;for(h=0;h<f;h++)for(n=c[h]=0;n<a;n++)c[h]+=w[n]*d[f*n+h]};a.xB=c;a.hy=f;a.gy=function(a,e){if(0>=e)return 0;var h=c(a);if(e>=f(a))return h;var d=a.Zn,r=b.ui(d,e,0,d.length-1);return h*(r+(e-d[r])/(d[r+1]-d[r]))/1E3}};
b4w.module.__dds=function(a,p){function h(a,b,c,d){var f=new Uint16Array(4),e=new Uint16Array(c*d),s=0,h=0,g=0,k=0,u=0,l=0,r=0,v=c/4;d/=4;for(var K=0;K<d;K++)for(var m=0;m<v;m++)g=b+4*(K*v+m),f[0]=a[g],f[1]=a[g+1],s=f[0]&31,h=f[0]&2016,k=f[0]&63488,u=f[1]&31,l=f[1]&2016,r=f[1]&63488,f[2]=5*s+3*u>>3|5*h+3*l>>3&2016|5*k+3*r>>3&63488,f[3]=5*u+3*s>>3|5*l+3*h>>3&2016|5*r+3*k>>3&63488,s=a[g+2],h=4*K*c+4*m,e[h]=f[s&3],e[h+1]=f[s>>2&3],e[h+2]=f[s>>4&3],e[h+3]=f[s>>6&3],h+=c,e[h]=f[s>>8&3],e[h+1]=f[s>>10&
3],e[h+2]=f[s>>12&3],e[h+3]=f[s>>14],s=a[g+3],h+=c,e[h]=f[s&3],e[h+1]=f[s>>2&3],e[h+2]=f[s>>4&3],e[h+3]=f[s>>6&3],h+=c,e[h]=f[s>>8&3],e[h+1]=f[s>>10&3],e[h+2]=f[s>>12&3],e[h+3]=f[s>>14];return e}function c(a,b,c,f){var B=new Int32Array(c,0,31),q,s,y,g,A,u;if(542327876!=B[0])return e.error("Invalid magic number in DDS header"),0;if(!B[20]&4)return e.error("Unsupported format, must contain a FourCC code"),0;q=B[21];switch(q){case k:s=8;y=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case d:s=16;y=b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:
null;break;case r:s=16;y=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return e.error("Unsupported FourCC code:",l(q)),null}u=1;B[2]&131072&&!1!==f&&(u=Math.max(1,B[7]));g=B[4];A=B[3];B=B[1]+4;if(b)for(q=0;q<u;++q)f=Math.max(4,g)/4*Math.max(4,A)/4*s,b=new Uint8Array(c,B,f),a.compressedTexImage2D(a.TEXTURE_2D,q,y,g,A,0,b),B+=f,g=Math.max(.5*g,1),A=Math.max(.5*A,1);else if(q==k)Math.max(4,g),Math.max(4,A),b=new Uint16Array(c),c=h(b,B/2,g,A),a.texImage2D(a.TEXTURE_2D,0,a.RGB,g,A,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,
c),f&&a.generateMipmap(a.TEXTURE_2D);else return e.error("No manual decoder for",l(q),"and no native support"),0;return u}function f(a,b,d,f,e,q){var s=new XMLHttpRequest;s.open("GET",d,!0);s.responseType="arraybuffer";s.onload=function(){if(200==s.status){a.bindTexture(a.TEXTURE_2D,f);var d=c(a,b,s.response,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}q&&q(f)};s.send(null);return f}function b(a){return a.charCodeAt(0)+
(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var e=p("__print"),k=b("DXT1"),d=b("DXT3"),r=b("DXT5");a.jA=h;a.Wy=c;a.Ro=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Gv=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case d:case r:b=4;break;default:e.error("Unsupported FourCC code:",l(a))}return b};a.eB=f;a.dB=function(a,b,c,d){var e=a.createTexture();
f(a,b,c,e,!0,d);return e}};
b4w.module.__debug=function(a,p){function h(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a.join("\n")}function c(a,b){typeof a!=typeof b&&e.da("Structure assertion failed: incompatible types");for(var c in a)c in b||e.da("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||e.da("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&e.da("Structure assertion failed: incompatible types for key "+c)}var f=
p("__extensions"),b=p("__print"),l=p("__textures"),e=p("__util"),k=null,d={},r=!1,x={},n=[],t=-1,w=null,B=!1;a.Qm={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Xb=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var f=b[c];f in a&&(d[a[f]]=f)}k=a};a.It=function(a){if(r){var b=k.getError();if(b!=k.NO_ERROR){if(b in d)throw"B4W Error: "+b+", gl."+d[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Ft=function(){if(r)switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:break;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case k.FRAMEBUFFER_UNSUPPORTED:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:b.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.Bn=function(){if(-1!=t)return t;k.bindFramebuffer(k.FRAMEBUFFER,k.createFramebuffer());var a=l.Gi("DEBUG",l.Pg);l.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.Ab,a.Ha,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(t=!0,b.warn("B4W warning: depth-only issue was found")):t=!1;k.bindFramebuffer(k.FRAMEBUFFER,
null);return t};a.Jt=function(a,c,d){if(r&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw d=h(d),b.error("B4W Error: shader compilation failed:\n"+d+"\n"+k.getShaderInfoLog(a)+" ("+c+")"),"Engine failed: see above for error messages";};a.Kt=function(a,c,d,e,u,q){if(r&&!k.getProgramParameter(a,k.LINK_STATUS)){var n=f.Fo();n&&(u=n.getTranslatedShaderSource(d),q=n.getTranslatedShaderSource(e));u=h(u);q=h(q);b.error("B4W Error: shader linking failed:\n"+u+"\n\n\n"+q+"\n"+k.getProgramInfoLog(a)+" ("+
c+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){r=a};a.kA=function(a){x[a]=a in x?x[a]+1:1};a.update=function(){for(var a in x)b.log(a,x[a]),x[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(e.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}n.push(a)};a.msg=function(){for(var a=1,b=0;b<n.length;b++){var c=n[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],e.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);n.push(c)};var q=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var c=0,d={},f=Math.max(0,performance.now()-1E3*a),e=0;e<n.length;e++){var h=n[e];a=h[0];if(!(a<f)){var w=String(h[1]);d[w]||(d[w]=q[c++%q.length]);a=["%c"+(a/1E3).toFixed(6),d[w],w];for(w=2;w<h.length;w++)a.push(h[w]);b.log.apply(this,a)}}n.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var c={},d=Math.max(0,performance.now()-1E3*a),f=0;f<n.length;f++){var e=n[f];a=e[0];if(!(a<d))for(var q=2;q<e.length;q++){var h=String(e[1]);3<e.length&&(h+="_"+String(q-2));c[h]||(c[h]=h+"\n");c[h]+=String(a)+" "+e[q]+"\n"}}a="";for(h in c)a+=c[h]+"\n\n";b.log(a);n.splice(0)};a.Sz=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(e.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.Lz=function(a,b){typeof a!=b&&e.da("Type assertion failed: value type is not a {"+b+"}:",a)};a.Jz=c;a.Kz=function(a){B?c(a,
w):B=!0;w=a}};
b4w.module.__extensions=function(a,p){function h(a){if(a in b)return b[a];var e=f.getExtension(a)||null;b[a]=e;c.log("%cGET EXTENSION","color: #"+(e?"0a0":"a00"),a);return e}var c=p("__print"),f=null,b={};a.Xb=function(a){f=a};a.No=function(){return h("WEBGL_compressed_texture_s3tc")||h("WEBKIT_WEBGL_compressed_texture_s3tc")||h("MOZ_WEBGL_compressed_texture_s3tc")};a.Jv=function(){return h("WEBGL_depth_texture")||h("WEBKIT_WEBGL_depth_texture")||h("MOZ_WEBGL_depth_texture")};a.zv=function(){return h("EXT_texture_filter_anisotropic")||h("WEBKIT_EXT_texture_filter_anisotropic")||
h("MOZ_EXT_texture_filter_anisotropic")};a.Fo=function(){return h("WEBGL_debug_shaders")};a.Mo=function(){return h("WEBGL_debug_renderer_info")};a.Go=function(){return h("OES_element_index_uint")};a.Sv=function(){return h("OES_standard_derivatives")};a.cleanup=function(){b={}}};
b4w.module.__graph=function(a){function p(a,b,c){c||(c=null);if(h(a,b))throw"Graph already has node with given ID";a.za.push(b,c)}function h(a,b){for(var c=a.za,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function c(a,b,c,d){d||(d=null);if(h(a,b)&&h(a,c))a.sa.push(b,c,d);else throw"Wrong node IDs";}function f(a,b){if(!h(a,b))throw"Node not found";for(var c=a.za,d=0;d<c.length;d+=2)c[d]==b&&(c.splice(d,2),d-=2)}function b(a){a=a.za;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function l(a,b){for(var c=a.za,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function e(a){var b=[],c={};k(a,c);for(var g=a.za,s=0;s<g.length;s+=2)0==y(a,g[s])&&d(a,g[s],c,b);return{za:b,sa:a.sa.slice(0)}}function k(a,b){for(var c=a.za,d=0;d<c.length;d+=2)b[c[d]]=!1}function d(a,b,c,f){if(!c[b]){c[b]=!0;for(var e=0;e<s(a,b);e++)d(a,g(a,b,e),c,f);f.unshift(b,q(a,b))}}function r(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var f=0;f<s(a,b);f++){var e=g(a,b,f);r(a,e,c,d)}if(20==d||30==d)for(f=
0;f<y(a,b);f++)e=A(a,b,f),r(a,e,c,d)}}function x(a){var b=a.za;a=a.sa;for(var c=[],d=[],g=[],s=0;s<b.length;s++)g[b[2*s]]=s,c.push(s,b[2*s+1]);for(s=0;s<a.length;s+=3)d.push(g[a[s]],g[a[s+1]],a[s+2]);return{za:c,sa:d}}function n(a,b,c){if(c.Dc==c.ae){for(var d=0,f=0;d<c.ae;d++)-1!=c.gd[d]&&(a[f]=d,b[f]=c.gd[d],f++);return!0}if(c.ae>c.hg||c.me>c.ne||c.zg>c.Bg||c.yg>c.Ag)return!1;for(var f=d=-1,e=!1;!e&&t(c,K,d,f);)if(d=K[0],f=K[1],w(c,d,f)){var u;u=c;e={};e.nh=u.nh;e.oh=u.oh;e.Fl=u.Fl;e.Ki=u.Ki;e.ae=
u.ae;e.hg=u.hg;e.be=u.be;e.Dc=e.lj=u.Dc;e.yg=u.yg;e.zg=u.zg;e.me=u.me;e.Ag=u.Ag;e.Bg=u.Bg;e.ne=u.ne;e.Tg=-1;e.gd=u.gd;e.Je=u.Je;e.We=u.We;e.Xe=u.Xe;e.pf=u.pf;e.qf=u.qf;e.Bj=u.Bj;u.Bj[0]+=1;var e=u=e,v=d,q=f,h=e.nh,k=e.oh,l=e.ae,r=e.hg,I=e.gd,x=e.Je,S=e.We,p=e.Xe,da=e.pf,C=e.qf;B(v<l);B(q<r);B(e.Dc<l);B(e.Dc<r);l=++e.Dc;e.Tg=v;S[v]||(S[v]=l,e.yg++,da[v]&&e.me++);da[v]||(da[v]=l,e.zg++,S[v]&&e.me++);p[q]||(p[q]=l,e.Ag++,C[q]&&e.ne++);C[q]||(C[q]=l,e.Bg++,p[q]&&e.ne++);I[v]=q;x[q]=v;for(I=0;I<y(h,v);I++)x=
A(h,v,I),S[x]||(S[x]=l,e.yg++,da[x]&&e.me++);for(I=0;I<s(h,v);I++)x=g(h,v,I),da[x]||(da[x]=l,e.zg++,S[x]&&e.me++);for(I=0;I<y(k,q);I++)x=A(k,q,I),p[x]||(p[x]=l,e.Ag++,C[x]&&e.ne++);for(I=0;I<s(k,q);I++)x=g(k,q,I),C[x]||(C[x]=l,e.Bg++,p[x]&&e.ne++);e=n(a,b,u);B(1>=u.Dc-u.lj);B(-1!=u.Tg);x=u.nh;v=u.oh;q=u.Dc;h=u.Tg;k=u.gd;S=u.Je;l=u.We;p=u.Xe;r=u.pf;da=u.qf;if(u.lj<q){l[h]==q&&(l[h]=0);for(C=0;C<y(x,h);C++)I=A(x,h,C),l[I]==q&&(l[I]=0);r[h]==q&&(r[h]=0);for(C=0;C<s(x,h);C++)I=g(x,h,C),r[I]==q&&(r[I]=
0);x=k[h];p[x]==q&&(p[x]=0);for(C=0;C<y(v,x);C++)I=A(v,x,C),p[I]==q&&(p[I]=0);da[x]==q&&(da[x]=0);for(C=0;C<s(v,x);C++)I=g(v,x,C),da[I]==q&&(da[I]=0);k[h]=-1;S[x]=-1;u.Dc=u.lj;u.Tg=-1}}return e}function t(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var g=a.me,e=a.ne,s=a.zg,f=a.Bg,u=a.yg,q=a.Ag,v=a.Dc,h=a.ae,n=a.hg,w=a.gd,k=a.Je,l=a.We,t=a.Xe,r=a.pf,C=a.qf;if(g>v&&e>v)for(;c<h&&(-1!=w[c]||0==r[c]||0==l[c]);)c++,d=0;else if(s>v&&f>v)for(;c<h&&(-1!=w[c]||0==r[c]);)c++,d=0;else if(u>v&&q>v)for(;c<h&&(-1!=w[c]||
0==l[c]);)c++,d=0;else if(0==c&&0!=a.be){for(l=0;l<h&&-1!=w[c=a.be[l]];)l++;l==h&&(c=h)}else for(;c<h&&-1!=w[c];)c++,d=0;if(g>v&&e>v)for(;d<n&&(-1!=k[d]||0==C[d]||0==t[d]);)d++;else if(s>v&&f>v)for(;d<n&&(-1!=k[d]||0==C[d]);)d++;else if(u>v&&q>v)for(;d<n&&(-1!=k[d]||0==t[d]);)d++;else for(;d<n&&-1!=k[d];)d++;return c<h&&d<n?(b[0]=c,b[1]=d,!0):!1}function w(a,b,c){var d=a.nh,e=a.oh,f=a.hg,v=a.gd,h=a.Je,n=a.We,w=a.Xe,k=a.pf,l=a.qf;B(b<a.ae);B(c<f);B(-1==v[b]);B(-1==h[c]);if(!(0,a.Fl)(q(d,b),q(e,c)))return!1;
for(var t=f=0,r=0,I=0,K=0,x=0,da=0;da<s(d,b);da++){var C=g(d,b,da);if(-1!=v[C]){var J=v[C];if(!u(e,c,J)||!S(a.Ki,d,b,C,e,c,J))return!1}else n[C]&&r++,k[C]&&f++,n[C]||k[C]||K++}for(da=0;da<y(d,b);da++)if(C=A(d,b,da),-1!=v[C]){if(J=v[C],!u(e,J,c)||!S(a.Ki,d,C,b,e,J,c))return!1}else n[C]&&r++,k[C]&&f++,n[C]||k[C]||K++;for(da=0;da<s(e,c);da++)if(J=g(e,c,da),-1!=h[J]){if(C=h[J],!u(d,b,C))return!1}else w[J]&&I++,l[J]&&t++,w[J]||l[J]||x++;for(da=0;da<y(e,c);da++)if(J=A(e,c,da),-1!=h[J]){if(C=h[J],!u(d,C,
b))return!1}else w[J]&&I++,l[J]&&t++,w[J]||l[J]||x++;return r<=I&&f<=t&&K<=x}function B(a){if(!a)throw"Assertion failed";}function q(a,b){for(var c=a.za,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function s(a,b){for(var c=a.sa,d=0,g=0;g<c.length;g+=3)c[g]==b&&d++;return d}function y(a,b){for(var c=a.sa,d=0,g=0;g<c.length;g+=3)c[g+1]==b&&d++;return d}function g(a,b,c){a=a.sa;for(var d=0,g=0;g<a.length;g+=3)if(a[g]==b){if(d==c)return a[g+1];d++}return-1}function A(a,b,c){a=a.sa;for(var d=
0,g=0;g<a.length;g+=3)if(a[g+1]==b){if(d==c)return a[g];d++}return-1}function u(a,b,c){a=a.sa;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function S(a,b,c,d,g,e,s){for(var f=I(b,c,d),u=I(g,e,s),q=0;q<f;q++){for(var h=!1,n=0;n<u;n++)if(a(v(b,c,d,q),v(g,e,s,n))){h=!0;break}if(!h)return!1}return!0}function I(a,b,c){var d=0;a=a.sa;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&d++;return d}function v(a,b,c,d){a=a.sa;for(var g=0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c){if(g==
d)return a[e+2];g++}return null}var K=[-1,-1];a.Mm=-1;a.Az=10;a.vr=20;a.Dz=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var g=a[d];switch(g.length){case 2:b.push(g[0],g[1]);break;case 3:c.push(g[0],g[1],g[2]);break;default:throw"Wrong graph constructor params";}}return{za:b,sa:c}};a.cA=function(a,b){for(var c=[],d=[],g=0;g<a.length;g++)c.push(a[g][0],a[g][1]);for(g=0;g<b.length;g++)d.push(b[g][0],b[g][1],b[g][2]);return{za:c,sa:d}};a.hk=p;a.KA=h;a.Ae=c;a.lg=f;a.kg=function(a,
b,c,d){if(!u(a,b,c))throw"Edge not found";a=a.sa;for(var g=0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c){if(-1==d)a.splice(e,3);else{if(d==g){a.splice(e,3);break}g++}e-=3}};a.o=function(a,c){if(-1==l(a,c))p(a,b(a),c);else throw"Non-unique attribute";};a.nx=function(a,b,c,d,g){a=a.sa;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&a[e+2]==d&&(a[e+2]=g)};a.Co=b;a.Ah=l;a.i=function(a,b,d,g){b=l(a,b);d=l(a,d);if(-1!=b&&-1!=d)c(a,b,d,g);else throw"Attributes not found";};a.L=function(a,b){for(var c=a.za,
d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.oe=function(a,b){for(var c=a.sa,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.pe=function(a,b,c){for(var d=a.sa,g=0;g<d.length;g+=3)if(d[g+1]==b){var e=d[g];if(c(e,q(a,e),d[g+2]))break}};a.qe=function(a,b,c){for(var d=a.sa,g=0;g<d.length;g+=3)if(d[g]==b){var e=d[g+1];if(c(e,q(a,e),d[g+2]))break}};a.Zq=e;a.zy=function(a){a=e(a).za;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.UA=function(){};a.my=function(a,b,c){if(!h(a,b))throw"No such node";
var d={};k(a,d);r(a,b,d,c);b=[];for(var g in d)d[g]&&(g=Number(g),b.push(g,q(a,g)));a={za:b,sa:a.sa.slice(0)};d=a.sa;for(g=0;g<d.length;g+=3)b=d[g+1],h(a,d[g])&&h(a,b)||(d.splice(g,3),g-=3);return a};a.Rv=function(a){for(var b=[],c=a.za,d=0;d<c.length;d+=2){var g=c[d];y(a,g)||b.push(g)}return b};a.Po=function(a){for(var b=[],c=a.za,d=0;d<c.length;d+=2){var g=c[d];s(a,g)||b.push(g)}return b};a.match=function(a,b,c,d){var g={};g.nh=x(a);g.oh=x(b);g.Fl=c||function(a,b){return a==b};g.Ki=d||function(a,
b){return a==b};d=a.za.length/2;var e=b.za.length/2;g.ae=d;g.hg=e;g.be=0;g.Dc=g.lj=0;g.me=g.yg=g.zg=0;g.ne=g.Ag=g.Bg=0;g.Tg=-1;g.gd=Array(d);g.Je=Array(e);g.We=Array(d);g.Xe=Array(e);g.pf=Array(d);g.qf=Array(e);g.Bj=[1];for(c=0;c<d;c++)g.gd[c]=-1,g.We[c]=0,g.pf[c]=0;for(c=0;c<e;c++)g.Je[c]=-1,g.Xe[c]=0,g.qf[c]=0;e=Array(d);d=Array(d);if(n(e,d,g)){for(c=0;c<e.length;c++)e[c]=a.za[2*e[c]],d[c]=b.za[2*d[c]];return[e,d]}return null};a.Ea=q;a.ig=s;a.ep=y;a.Yf=g;a.Ni=A;a.AA=I;a.Xf=v;a.replace=function(a,
c,d){for(var g=a.sa,e=b(a),s=0;s<c.length;s++){var u=c[s];f(a,u);for(var v=0;v<g.length;v+=3)g[v]==u&&(g[v]=e),g[v+1]==u&&(g[v+1]=e),g[v]==g[v+1]&&(g.splice(v,3),v-=3)}p(a,e,d)};a.dA=function(a,b){var c=a.za,d=a.sa,g;g="digraph debug {\n    node [shape=box];\n";for(var e=0;e<c.length;e+=2){var s=c[e],f=c[e+1],f=b?b(s,f):String(s);g+="    ";g+=String(s)+' [label="'+f.replace(/\"/g,'\\"')+'"];\n'}for(e=0;e<d.length;e+=3)c=d[e],s=d[e+1],g+="    ",g+=String(c)+" -> "+String(s)+";\n";return g+"}"}};
b4w.module.__ipc=function(a){var p=a.Ar=0;a.Br=1;a.Cr=2;a.Dr=3;a.Er=4;a.Fr=5;var h=a.Hr=6,c=a.Ir=7,f=a.Jr=8;a.Kr=9;a.Gr=10;a.js=11;a.yc=12;a.Lr=13;a.Mr=14;a.Nr=15;a.Pr=16;a.Or=17;a.Qr=18;a.Rr=19;a.Sr=20;a.Tr=21;a.Ur=22;a.Vr=23;a.Wr=24;a.Xr=25;a.Yr=26;a.Zr=27;a.$r=28;a.as=29;a.bs=30;a.cs=31;a.ds=32;a.es=33;a.gs=34;a.hs=35;a.ks=36;a.Om=37;a.ls=38;a.ms=39;a.ns=40;a.os=41;a.ps=42;a.qs=43;a.rs=44;a.ss=45;a.ts=46;a.us=47;a.vs=48;a.ws=49;a.xs=50;a.Pm=51;var b=a.Ff=52;a.ys=53;a.Nm=54;a.zs=55;a.As=56;a.Bz=
57;a.fs=58;for(var l=null,e=[],k=[],d=[],r=[],x=0;59>x;x++)e.push(null),k.push(null),d.push(null),r.push(null);k[f]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};k[h]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};k[c]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};k[p]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};k[b]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};r[f]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];r[h]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];r[c]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];r[p]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];r[b]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(r[a]){for(var d=k[a],e=r[a],f=0,g=0;g<e.length;g+=2){var h=e[g],u=e[g+1];if(1==u)d[h]="msg_id"==h||"body_id"==h||"body_id_a"==h||"body_id_b"==h?c[f]|0:c[f];else for(var n=0;n<u;n++)d[h][n]=c[f+n];f+=u}c=d}b(a,c)},!1);l=a};a.cleanup=function(){l=null};a.m=function(){var a=arguments[0]|0;if(r[a]){var b=k[a],c=r[a],f=0;if(!d[a]){for(var q=0,s=1;s<c.length;s+=2)q+=c[s];d[a]=new Float32Array(q)}q=d[a];for(s=0;s<c.length;s+=2){var h=b[c[s]],g=c[s+1];1==g?q[f]=h:q.set(h,
f);f+=g}e[a]||(e[a]=q);a=e[a]}else for(b=arguments.length,e[a]||(e[a]=Array(b),e[a][0]=a),a=e[a],c=1;c<b;c++)a[c]=arguments[c];l.postMessage(a)};a.Ko=function(a){return k[a]}};
b4w.module.__hud=function(a,p){function h(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){f(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;k.L(a.d.Na,function(a,d){if("SINK"==d.type)f(" (F)",d.type);else{var e=d.type,s=Math.round(d.h.width)+"x"+Math.round(d.h.height),h=d.l.length,g=d.dh,k=d.enqueue&&d.R;k?f(" (A)",e,d.mf,s,g,"of",h):f(" (P)",e,d.mf,s,g,"of",h);d.dh=0;k&&(b+=h,c+=g)}});return[b,c]}f("No INFO")}function f(){for(var a=80+20*r[0],b=[5,
18,3,10,4,3,5],c=arguments[0],e=1;e<arguments.length;e++){for(var f="",q=0;q<b[e]-String(arguments[e]).length;q++)f+=" ";c+=f+arguments[e]}r[0]++;d.fillText(c,30,a)}function b(a,b,c){b*=a.oa;c.x=a.x+b;c.y=a.y;c.oa=a.oa-2*b;c.ha=a.ha}function l(a){return a.x+a.oa/2}function e(a){var c=d,e={x:0,y:0,oa:0,ha:0},f=c.canvas.width,c=c.canvas.height;e.x=0;e.y=0;e.oa=f;e.ha=c;b(e,.01,e);f=.02*e.ha;e.x=e.x;e.y+=f;e.oa=e.oa;e.ha-=2*f;f=e.oa/8;e.x+=f*a;e.y=e.y;e.oa=f;e.ha=e.ha;b(e,.02,e);return e}var k=p("__graph"),
d=null,r=[0,0];a.init=function(a){a=a.getContext("2d");h(a);return d=a};a.Fg=function(){d&&h(d)};a.reset=function(){var a=d;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),r[0]=0,r[1]=0)};a.Ux=function(a,b){var e=d;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";f(" FPS",(1/b).toFixed(2));r[0]++;for(var h=e=0,k=0;k<a.length;k++){var q=c(a[k]),e=e+q[0],h=h+q[1];r[0]++}f(" ---------------------------------------------");
f("    ","TOTAL ACTIVE","","",h,"of",e)}};a.print=function(){var a=d;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",f.apply(Math,arguments))};a.plot_array=function(a,b,c,f,h,q,s){var k=d;if(k){b=e(b);var g=b.ha/5;b.x=b.x;b.y+=4*g;b.oa=b.oa;b.ha=g;k.textAlign="center";k.fillStyle="#00FF00";d.fillText(a,l(b),b.y-10);k.strokeStyle="#00FF00";k.lineWidth=.5;k.beginPath();k.moveTo(b.x,b.y);k.lineTo(b.x+b.oa,b.y);k.lineTo(b.x+b.oa,b.y+b.ha);k.lineTo(b.x,b.y+b.ha);k.closePath();k.stroke();if(!q&&
!s)for(q=1E6,s=-1E6,a=0;a<c.length;a++)q=Math.min(q,c[a]),s=Math.max(s,c[a]);k.textAlign="right";d.fillText(String(q),b.x-10,b.y+b.ha);d.fillText(String(s),b.x-10,b.y);k.textAlign="center";d.fillText(String(f),b.x,b.y+b.ha+15);d.fillText(String(h),b.x+b.oa,b.y+b.ha+15);k.strokeStyle="#FF0000";k.lineWidth=1.5;k.beginPath();f=b.oa/(c.length-1);s=b.ha/(s-q);for(a=0;a<c.length;a++)h=b.x+f*a,g=b.y+b.ha-(c[a]-q)*s,0==a?k.moveTo(h,g):k.lineTo(h,g);k.stroke()}};a.draw_mixer_strip=function(a,b,c,f,h,q,s){var k=
d;if(k)for(k.textAlign="center",k.fillStyle="#00FF00",k.font="bold 12px Courier",c=e(c),d.fillText(b?"["+a+"]":a,l(c),c.y),0<=q&&d.fillText(q?"[M]":"[ ]",l(c)-15,c.y+30),0<=s&&d.fillText(s?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,oa:0,ha:0},b=0;b<f.length;b++){q=f[b];var g="VOLUME"==q[0];if(g){s=c.y+350;var r=c.oa,u=a;u.x=c.x;u.y=s;u.oa=r;u.ha=250}else{s=c.y+10+50*b;var r=c.oa,u=c.ha,S=a;S.x=c.x;S.y=s;S.oa=r;S.ha=u}s=k;var r=a,S=b==h,I=q[0],u=q[1],v=q[2],K=q[3],m=(K-v)/q[4],m=1>m?Math.floor(1/m-1E-5).toFixed(0).length:
0;q=q[5]?Math.log(u/v)/Math.log(K/v):(u-v)/(K-v);s.textAlign="center";S?s.fillText("["+I+"]",l(r),r.y):s.fillText(I,l(r),r.y);s.strokeStyle="#00FF00";s.lineWidth=g?3:1;g?(s.textAlign="right",s.fillText(K.toFixed(m),l(r)-10,r.y+15),s.textAlign="right",s.fillText(v.toFixed(m),l(r)-10,r.y+r.ha-15)):(s.textAlign="right",s.fillText(v.toFixed(m),r.x+28,r.y+15),s.textAlign="left",s.fillText(K.toFixed(m),r.x+r.oa-28,r.y+15));s.beginPath();if(g){var H=r.y+15+(r.ha-30)*(1-q);s.moveTo(l(r),r.y+15);s.lineTo(l(r),
r.y+r.ha-15);s.moveTo(l(r)-5,r.y+15);s.lineTo(l(r)+5,r.y+15);s.moveTo(l(r)-5,r.y+r.ha-15);s.lineTo(l(r)+5,r.y+r.ha-15);s.moveTo(l(r)-5,H);s.lineTo(l(r)+5,H)}else{var D=r.x+30+(r.oa-60)*q;s.moveTo(r.x+30,r.y+15);s.lineTo(r.x+r.oa-30,r.y+15);s.moveTo(r.x+30,r.y+15-5);s.lineTo(r.x+30,r.y+15+5);s.moveTo(r.x+r.oa-30,r.y+15-5);s.lineTo(r.x+r.oa-30,r.y+15+5);s.moveTo(D,r.y+15-5);s.lineTo(D,r.y+15+5)}s.stroke();"EQ_Q"==I?(q=Math.log(1+1/(2*u*u)+Math.sqrt((2+1/(u*u))*(2+1/(u*u))/4-1))/Math.log(2),g?(s.textAlign=
"left",s.fillText(u.toFixed(m),l(r)+10,H),s.textAlign="left",s.fillText("("+q.toFixed(m+1)+")",l(r)+10,H+10)):(s.textAlign="right",s.fillText(u.toFixed(m),D,r.y+30),s.textAlign="left",s.fillText("("+q.toFixed(m+1)+")",D,r.y+30))):g?(s.textAlign="left",s.fillText(u.toFixed(m),l(r)+10,H)):(s.textAlign="center",s.fillText(u.toFixed(m),D,r.y+30))}}};
b4w.module.__renderer=function(a,p){function h(a){if(a){var b=(a.aa?B.COLOR_BUFFER_BIT:0)|(a.fa?B.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=x;break;case "DEPTH":a=n;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=t;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=w;break;default:a=r.background_color}}else b=B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT,a=r.background_color;B.colorMask(!0,!0,!0,!0);B.depthMask(!0);B.clearColor(a[0],
a[1],a[2],a[3]);B.clear(b)}function c(a,b,c){B.bindBuffer(B.ARRAY_BUFFER,a.Bf);for(var d=0;d<b.length;d++){var e=b[d];B.enableVertexAttribArray(e.ff);B.vertexAttribPointer(e.ff,e.Ic,B.FLOAT,!1,0,e.pt+e.gv*c)}a.sd?(B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,a.sd),B.drawElements(a.mode,a.count,a.kl,0)):B.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],B.disableVertexAttribArray(e.ff)}function f(a){switch(a){case 0:return B.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return B.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return B.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return B.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return B.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return B.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function b(a){var b=a.Zh,c=[],d=[],e={},f;for(f in b){var q=!1;switch(f){case "u_proj_matrix":var v=function(a,b,c,d,g,e){a.uniformMatrix4fv(b,!1,e.ia)},q=!0;break;case "u_view_matrix":case "u_view_matrix_frag":v=function(a,b,c,d,g,e){a.uniformMatrix4fv(b,!1,e.ea)};q=!0;break;case "u_shadow_cast_billboard_view_matrix":v=function(a,
b,c,d,g,e){a.uniformMatrix4fv(b,!1,e.zq)};q=!0;break;case "u_view_proj_prev":v=function(a,b,c,d,g,e){a.uniformMatrix4fv(b,!1,e.ax)};q=!0;break;case "u_view_proj_inverse":v=function(a,b,c,d,g,e){a.uniformMatrix4fv(b,!1,e.Lg)};q=!0;break;case "u_sky_vp_inverse":v=function(a,b,c,d,g,e){a.uniformMatrix4fv(b,!1,e.Mc)};q=!0;break;case "u_camera_eye":case "u_camera_eye_frag":v=function(a,b,c,d,g,e){a.uniform3fv(b,e.Sd)};q=!0;break;case "u_camera_eye_last":v=function(a,b,c,d,g,e){a.uniform3fv(b,e.uo)};q=
!0;break;case "u_camera_quat":v=function(a,b,c,d,g,e){a.uniform4fv(b,e.quat)};q=!0;break;case "u_view_max_depth":v=function(a,b,c,d,g,e){a.uniform1f(b,e.La)};q=!0;break;case "u_camera_range":v=function(a,b,c,d,g,e){a.uniform2f(b,e.Fa,e.La)};break;case "u_csm_center_dists":v=function(a,b,c,d,g,e){a.uniform4fv(b,e.Xn)};break;case "u_cam_water_depth":v=function(a,b,c){a.uniform1f(b,c.tk)};q=!0;break;case "u_waves_height":v=function(a,b,c){a.uniform1f(b,c.te)};break;case "u_waves_length":v=function(a,
b,c){a.uniform1f(b,c.Ef)};break;case "u_fog_color_density":v=function(a,b,c){a.uniform4fv(b,c.Eb)};break;case "u_underwater_fog_color_density":v=function(a,b,c){a.uniform4fv(b,c.xc)};break;case "u_bloom_key":v=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":v=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":v=function(a,b,c){a.uniform1f(b,c.time)};q=!0;break;case "u_wind":v=function(a,b,c){a.uniform3fv(b,c.fi)};break;case "u_horizon_color":v=function(a,
b,c){a.uniform3fv(b,c.ic)};break;case "u_zenith_color":v=function(a,b,c){a.uniform3fv(b,c.nc)};break;case "u_environment_energy":v=function(a,b,c){a.uniform1f(b,c.Rd)};break;case "u_sky_color":v=function(a,b,c){a.uniform3fv(b,c.pg)};break;case "u_rayleigh_brightness":v=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":v=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":v=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":v=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":v=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":v=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":v=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":v=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":v=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":v=function(a,b,c){a.uniform3fv(b,c.df)};break;case "u_light_directions":v=function(a,b,c){a.uniform3fv(b,c.af)};break;case "u_light_color_intensities":v=function(a,b,c){a.uniform3fv(b,c.$e)};break;case "u_light_factors1":v=function(a,b,c){a.uniform4fv(b,c.bf)};break;case "u_light_factors2":v=function(a,b,c){a.uniform4fv(b,c.cf)};break;case "u_shadow_lamp_id":v=function(a,b,c){a.uniform1i(b,c.Aq)};break;case "u_sun_quaternion":v=function(a,b,c){a.uniform4fv(b,c.Vq)};break;
case "u_sun_intensity":v=function(a,b,c){a.uniform3fv(b,c.Uq)};break;case "u_sun_direction":v=function(a,b,c){a.uniform3fv(b,c.Gj)};break;case "u_height":v=function(a,b,c,d,g,e){a.uniform1f(b,e.height)};q=!0;break;case "u_model_matrix":v=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.H)};q=!0;break;case "u_transb":v=function(a,b,c,d){a.uniform4fv(b,d.dc)};q=!0;break;case "u_transa":v=function(a,b,c,d){a.uniform4fv(b,d.cc)};q=!0;break;case "u_quat":v=function(a,b,c,d){a.uniform4fv(b,d.quat)};q=!0;break;
case "u_quatsb":v=function(a,b,c,d){a.uniform4fv(b,d.Vb)};q=!0;break;case "u_quatsa":v=function(a,b,c,d){a.uniform4fv(b,d.Ub)};q=!0;break;case "u_frame_factor":v=function(a,b,c,d){a.uniform1f(b,d.Qe)};q=!0;break;case "au_center_pos":v=function(){};q=!0;break;case "au_wind_bending_amp":v=function(a,b,c,d){a.uniform1f(b,d.Wc)};q=!0;break;case "au_wind_bending_freq":v=function(a,b,c,d){a.uniform1f(b,d.ue)};q=!0;break;case "au_detail_bending_freq":v=function(a,b,c,d){a.uniform1f(b,d.Nd)};q=!0;break;case "au_detail_bending_amp":v=
function(a,b,c,d){a.uniform1f(b,d.Md)};q=!0;break;case "au_branch_bending_amp":v=function(a,b,c,d){a.uniform1f(b,d.Kd)};q=!0;break;case "u_anim_values":v=function(a,b,c,d){a.uniform1fv(b,d.jf)};q=!0;break;case "u_diffuse_color":v=function(a,b,c,d,g){a.uniform4fv(b,g.ob)};q=!0;break;case "u_diffuse_intensity":v=function(a,b,c,d,g){a.uniform1f(b,g.Le)};q=!0;break;case "u_diffuse_params":v=function(a,b,c,d,g){a.uniform2fv(b,g.kd)};q=!0;break;case "u_emit":v=function(a,b,c,d,g){a.uniform1f(b,g.Qd)};q=
!0;break;case "u_ambient":v=function(a,b,c,d,g){a.uniform1f(b,g.Bc)};q=!0;break;case "u_specular_color":v=function(a,b,c,d,g){a.uniform3fv(b,g.Bd)};q=!0;break;case "u_specular_alpha":v=function(a,b,c,d,g){a.uniform1f(b,g.rg)};q=!0;break;case "u_specular_params":v=function(a,b,c,d,g){a.uniform3fv(b,g.lc)};q=!0;break;case "u_reflect_factor":v=function(a,b,c,d,g){a.uniform1f(b,g.Nh)};q=!0;break;case "u_mirror_factor":v=function(a,b,c,d,g){a.uniform1f(b,g.Cl)};q=!0;break;case "u_grass_map_dim":v=function(a,
b,c,d,g){a.uniform3fv(b,g.Ib)};q=!0;break;case "u_grass_size":v=function(a,b,c,d,g){a.uniform1f(b,g.gl)};q=!0;break;case "u_scale_threshold":v=function(a,b,c,d,g){a.uniform1f(b,g.Ri)};q=!0;break;case "u_cube_fog":v=function(a,b,c,d,g){a.uniformMatrix4fv(b,!1,g.Ec)};break;case "u_jitter_amp":v=function(a,b,c,d,g){a.uniform1f(b,g.Zi)};q=!0;break;case "u_jitter_freq":v=function(a,b,c,d,g){a.uniform1f(b,g.$i)};q=!0;break;case "u_wireframe_mode":v=function(a,b,c,d,g){a.uniform1i(b,g.wireframe_mode)};break;
case "u_wireframe_edge_color":v=function(a,b,c,d,g){a.uniform3fv(b,g.wireframe_edge_color)};break;case "u_subpixel_jitter":v=function(a,b,c){a.uniform2fv(b,c.ww)};q=!0;break;case "u_subsample_indices":v=function(a,b,c){a.uniform4fv(b,c.xw)};q=!0;break;case "u_refr_bump":v=function(a,b,c,d,g){a.uniform1f(b,g.jq)};q=!0;break;case "u_lamp_light_positions":v=function(a,b,c,d,g){a.uniform3fv(b,g.ql)};break;case "u_lamp_light_directions":v=function(a,b,c,d,g){a.uniform3fv(b,g.ol)};break;case "u_lamp_light_color_intensities":v=
function(a,b,c,d,g){a.uniform3fv(b,g.nl)};break;case "u_lamp_light_factors":v=function(a,b,c,d,g){a.uniform4fv(b,g.pl)};break;case "u_halo_size":v=function(a,b,c,d,g){a.uniform1f(b,g.Xo)};q=!0;break;case "u_halo_hardness":v=function(a,b,c,d,g){a.uniform1f(b,g.Uo)};q=!0;break;case "u_halo_rings_color":v=function(a,b,c,d,g){a.uniform3fv(b,g.Wo)};q=!0;break;case "u_halo_lines_color":v=function(a,b,c,d,g){a.uniform3fv(b,g.Vo)};q=!0;break;case "u_halo_stars_blend":v=function(a,b,c,d,g){a.uniform1f(b,g.Yo)};
q=!0;break;case "u_halo_stars_height":v=function(a,b,c,d,g){a.uniform1f(b,g.Zo)};q=!0;break;case "u_fresnel_params":v=function(a,b,c,d,g){a.uniform4fv(b,g.pd)};q=!0;break;case "u_texture_scale":v=function(a,b,c,d,g){a.uniform3fv(b,g.Qc)};q=!0;break;case "u_parallax_scale":v=function(a,b,c,d,g){a.uniform1f(b,g.Fh)};q=!0;break;case "u_color_id":v=function(a,b,c,d,g){a.uniform3fv(b,g.Nn)};q=!0;break;case "u_line_points":v=function(a,b,c,d,g){a.uniform3fv(b,g.cB)};q=!0;break;case "u_diffuse_color_factor":v=
function(a,b,c,d,g){a.uniform1f(b,g.Ke)};q=!0;break;case "u_alpha_factor":v=function(a,b,c,d,g){a.uniform1f(b,g.ye)};q=!0;break;case "u_specular_color_factor":v=function(a,b,c,d,g){a.uniform1f(b,g.Gq)};q=!0;break;case "u_normal_factor":v=function(a,b,c,d,g){a.uniform1f(b,g.Ep)};q=!0;break;case "u_normalmap0_scale":v=function(a,b,c,d,g){a.uniform2fv(b,g.lf[0])};q=!0;break;case "u_normalmap1_scale":v=function(a,b,c,d,g){a.uniform2fv(b,g.lf[1])};q=!0;break;case "u_normalmap2_scale":v=function(a,b,c,
d,g){a.uniform2fv(b,g.lf[2])};q=!0;break;case "u_normalmap3_scale":v=function(a,b,c,d,g){a.uniform2fv(b,g.lf[3])};q=!0;break;case "u_foam_factor":v=function(a,b,c,d,g){a.uniform1f(b,g.foam_factor)};q=!0;break;case "u_foam_uv_freq":v=function(a,b,c,d,g){a.uniform2fv(b,g.xo)};q=!0;break;case "u_foam_mag":v=function(a,b,c,d,g){a.uniform2fv(b,g.wo)};q=!0;break;case "u_foam_scale":v=function(a,b,c,d,g){a.uniform2fv(b,g.Uk)};q=!0;break;case "u_water_norm_uv_velocity":v=function(a,b,c,d,g){a.uniform1f(b,
g.Uj)};q=!0;break;case "u_shallow_water_col":v=function(a,b,c,d,g){a.uniform3fv(b,g.shallow_water_col)};q=!0;break;case "u_shore_water_col":v=function(a,b,c,d,g){a.uniform3fv(b,g.shore_water_col)};q=!0;break;case "u_water_shallow_col_fac":v=function(a,b,c,d,g){a.uniform1f(b,g.shallow_water_col_fac)};q=!0;break;case "u_water_shore_col_fac":v=function(a,b,c,d,g){a.uniform1f(b,g.shore_water_col_fac)};q=!0;break;case "u_p_length":v=function(a,b,c,d,g){a.uniform1f(b,g.Rp)};q=!0;break;case "u_p_cyclic":v=
function(a,b,c,d,g){a.uniform1i(b,g.Np)};q=!0;break;case "u_p_max_lifetime":v=function(a,b,c,d,g){a.uniform1f(b,g.Tp)};q=!0;break;case "u_p_fade_in":v=function(a,b,c,d,g){a.uniform1f(b,g.Op)};q=!0;break;case "u_p_fade_out":v=function(a,b,c,d,g){a.uniform1f(b,g.Pp)};q=!0;break;case "u_p_size":v=function(a,b,c,d,g){a.uniform1f(b,g.Ll)};q=!0;break;case "u_p_alpha_start":v=function(a,b,c,d,g){a.uniform1f(b,g.Kp)};q=!0;break;case "u_p_alpha_end":v=function(a,b,c,d,g){a.uniform1f(b,g.Jp)};q=!0;break;case "u_p_nfactor":v=
function(a,b,c,d,g){a.uniform1f(b,g.Kl)};q=!0;break;case "u_p_gravity":v=function(a,b,c,d,g){a.uniform1f(b,g.Qp)};q=!0;break;case "u_p_mass":v=function(a,b,c,d,g){a.uniform1f(b,g.Sp)};q=!0;break;case "u_p_size_ramp":v=function(a,b,c,d,g){a.uniform2fv(b,g.Up)};q=!0;break;case "u_p_color_ramp":v=function(a,b,c,d,g){a.uniform4fv(b,g.Lp)};q=!0;break;case "u_p_wind":v=function(a,b,c,d,g){a.uniform3fv(b,g.nj)};q=!0;break;case "u_texel_size":v=function(a,b,c,d,g){a.uniform2fv(b,g.om)};q=!0;break;case "u_p_time":v=
function(a,b,c,d,g){a.uniform1f(b,g.Jc.I.time)};q=!0;break;case "u_va_frame_factor":v=function(a,b,c,d){a.uniform1f(b,d.kr)};q=!0;break;case "u_normal_offset":v=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":v=function(a,b,c,d,g,e){a.uniform4fv(b,e.sj)};break;case "u_v_light_matrix":v=function(a,b,c){a.uniformMatrix4fv(b,!1,c.jr)};q=!0;break;case "u_b_light_matrix":v=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ln)};break;case "u_p_light_matrix0":v=function(a,
b,c){a.uniformMatrix4fv(b,!1,c.rf[0])};q=!0;break;case "u_p_light_matrix1":v=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[1])};q=!0;break;case "u_p_light_matrix2":v=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[2])};q=!0;break;case "u_p_light_matrix3":v=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[3])};q=!0;break;case "u_motion_blur_exp":v=function(a,b,c){a.uniform1f(b,c.Ap)};q=!0;break;case "u_refl_plane":v=function(a,b,c){a.uniform4fv(b,c.hb)};break;case "u_radial_blur_step":v=function(a,b,c){a.uniform1f(b,
c.vj)};break;case "u_god_rays_intensity":v=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":v=function(a,b,c){a.uniform1f(b,c.ug)};break;case "u_ssao_blur_discard_value":v=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};q=!0;break;case "u_ssao_influence":v=function(a,b,c){a.uniform1f(b,c.tg)};break;case "u_ssao_dist_factor":v=function(a,b,c){a.uniform1f(b,c.sg)};break;case "u_dof_dist":v=function(a,b,c,d,g,e){a.uniform1f(b,e.dof_distance)};q=!0;break;
case "u_dof_front":v=function(a,b,c,d,g,e){a.uniform1f(b,e.dof_front)};q=!0;break;case "u_dof_rear":v=function(a,b,c,d,g,e){a.uniform1f(b,e.dof_rear)};q=!0;break;case "u_glow_intensity":v=function(a,b,c,d,g){a.uniform1f(b,g.Zf)};q=!0;break;case "u_glow_color":v=function(a,b,c){a.uniform3fv(b,c.ph)};break;case "u_draw_glow":v=function(a,b,c){a.uniform1f(b,c.Ok)};q=!0;break;case "u_brightness":v=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":v=function(a,b,c){a.uniform1f(b,c.contrast)};
break;case "u_exposure":v=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":v=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:v=null}v&&(v={name:f,$k:v,ff:b[f]},q?c.push(v):(d.push(v),e[f]=v))}a.ar=c;a.Hh=d;a.Nl=e}var l=p("__config"),e=p("__debug"),k=p("__textures"),d=p("__util"),r=l.n,x=[1,1,1,1],n=[1,1,1,1],t=[0,0,0,1],w=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var B=null,q=new Uint8Array(4);
a.Xb=function(a){var b=r.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);B=a};a.gh=function(a){if(a.R){var d=a.h;B.bindFramebuffer(B.FRAMEBUFFER,d.Td);if(a.jk){var g=d.cb;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,g.Ab,g.Ha,0)}B.viewport(0,0,d.width,d.height);h(a);a.qa?B.enable(B.BLEND):B.disable(B.BLEND);
a.wb?B.enable(B.DEPTH_TEST):B.disable(B.DEPTH_TEST);if(a.ta){for(var d=a.h,g=a.l,k=0;k<g.length;k++){var u=g[k],n=u.k,w=n.Yb;B.useProgram(w.tj);u=u.Va;w.Hh.length||b(w);for(var w=w.Hh,v=w.length;v--;){var l=w[v];l.$k(B,l.ff,a,u,n,d)}}a.ta=!1}switch(a.type){case "SHADOW_CAST":B.enable(B.POLYGON_OFFSET_FILL);B.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);B.cullFace(B.BACK);break;case "MAIN_REFLECT":B.disable(B.POLYGON_OFFSET_FILL);B.cullFace(B.FRONT);break;default:B.disable(B.POLYGON_OFFSET_FILL),
B.cullFace(B.BACK)}d=a.h;g=a.l;for(k=0;k<g.length;k++)if(u=g[k],u.R){var n=a,l=d,w=u.Va,m=u.k,u=m.Yb;B.useProgram(u.tj);for(var t=m.bb,v=m.gn,D=u.ar,U=D.length;U--;){var P=D[U];P.$k(B,P.ff,n,w,m,l)}l=m.On;B.colorMask(l,l,l,l);B.depthMask(m.N);m.ka?B.enable(B.CULL_FACE):B.disable(B.CULL_FACE);l=m.D;m=m.ac;D=u.Zh;U=l.length|0;if(0!==U)if(1===U)B.activeTexture(B.TEXTURE0),B.bindTexture(l[0].Ab,l[0].Ha);else for(P=0;P<U;P++){var x=l[P],V=m[P];B.activeTexture(B.TEXTURE0+P);B.bindTexture(x.Ab,x.Ha);B.uniform1i(D[V],
P)}if("SKY"==n.type){l=n;u=u.Zh;m=l.h.cb.Ha;D=l.Yn;for(U=0;6>U;U++)if(P=f(U),r.Jn?(x=new Uint8Array([91.8,142.8,.96*255,255]),B.bindTexture(B.TEXTURE_CUBE_MAP,m),B.texImage2D(P,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,x)):(B.uniformMatrix4fv(u.u_cube_view_matrix,!1,D[U]),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,P,m,0),c(t,v,w.vm)),l.ij&&0!=U){var P=l,x=U,M=q;B.readPixels(191,191,1,1,B.RGBA,B.UNSIGNED_BYTE,M);255!=M[0]&&255!=M[1]&&255!=M[2]||B.readPixels(191,220,1,1,B.RGBA,B.UNSIGNED_BYTE,
M);var V=M[0],p=M[1],M=M[2],V=V/255,p=p/255,M=M/255;1===x?(P.Ec[3]=V,P.Ec[7]=p,P.Ec[11]=M):(P.Ec[4*(x-2)]=V,P.Ec[4*(x-2)+1]=p,P.Ec[4*(x-2)+2]=M)}n.dh+=6}else c(t,v,w.vm),n.dh++}e.It("draw subscene: "+a.type);B.bindFramebuffer(B.FRAMEBUFFER,null)}};a.clear=h;a.dn=function(a){var b=a.gn;b.length=0;var c=a.bb;a=a.Yb;c&&a||d.da("Incomplete batch");c=c.Kb;a=a.attributes;for(var e in a){var f=c[e];b.push({ff:a[e],pt:4*f.offset,gv:1<f.frames?4*f.length:0,Ic:f.Ic})}};a.ot=b;a.fx=function(a,b,c){var e,f,q;
e||(e=1);f||(f=1);q||(q=new Uint8Array(4*e*f));q.length!=4*e*f&&d.da("read_pixels(): Wrong storage");B.bindFramebuffer(B.FRAMEBUFFER,a);B.readPixels(b,c,e,f,B.RGBA,B.UNSIGNED_BYTE,q);B.bindFramebuffer(B.FRAMEBUFFER,null);return q};a.Fy=function(a){var c=a.Yb;B.useProgram(c.tj);c.Hh.length||b(c);c=c.Nl.u_cube_fog;c.$k(B,c.ff,null,null,a,null)};a.lq=function(a,b){var c=B.createFramebuffer();B.bindFramebuffer(B.FRAMEBUFFER,c);if(a){var d=a,f=d.Ha,d=d.Ab==B.TEXTURE_CUBE_MAP?B.TEXTURE_CUBE_MAP_NEGATIVE_Z:
d.Ab;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,d,f,0)}k.lp(b)?B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,b.Ng):k.vh(b)&&(d=b,f=d.Ha,d=d.Ab,B.framebufferTexture2D(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,d,f,0));e.Ft();B.bindFramebuffer(B.FRAMEBUFFER,null);return c};a.mx=function(a,b,c,d,e){null==a?(B.bindFramebuffer(B.FRAMEBUFFER,a),B.viewport(0,0,d,e),B.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT)):(k.vh(b)&&B.deleteTexture(b.Ha),k.lp(c)?B.deleteRenderbuffer(c.Ng):
k.vh(c)&&B.deleteTexture(c.Ha),B.deleteFramebuffer(a))};a.NA=function(){};a.cleanup=function(){}};
b4w.module.__shaders=function(a,p){function h(a,b,d){var g=a.Od;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<g.length;a++)if(g[a][0]==b){g[a][1]=d;return}g.push([b,d])}function c(a,b){for(var c=a.Od,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function f(a,b){var c=a+b;if(A[c])return A[c];if(s){var d=s[b];if(!d)return null}else{d=B.Tv(a+b);if(!d)return null;d=y.$p.parse(d)}return A[c]=d}function b(a,b,c,d){function g(b){b=b.a;for(var c=0;c<b.length;c++){var u=b[c];switch(u.type){case "condition":var u=
u.a,v=0;a:for(;v<u.length;v++){var r=u[v];switch(r.type){case "if":case "elif":var t=r.c;try{var B,P=l(t,s,h,!0);B=w.$p.parse(P)}catch(x){throw"Failed to process #"+r.type+" expression: "+t.join(" ");}if(B){g(r.group);break a}break;case "else":g(r.group);break;case "ifdef":r.name in s&&g(r.group);break;case "ifndef":r.name in s||g(r.group)}}break;case "include":u=f(q.shaders_dir,q.Sx+u.file);g(u);break;case "var":case "export":case "import":break;case "define":v=u.name;s[v]=u.b;u.va&&(h[v]=u.va);
break;case "error":throw"Shader error: #error "+u.b.join(" ");case "line":break;case "pragma":e.push("#pragma "+u.name+" "+u.b.join(" "));break;case "undef":u=u.name;delete s[u];delete h[u];break;case "warning":n.warn("Shader warning: #warning "+u.b.join(" "));break;case "extension":e.push("#extension "+l(u.b,s,h,!1));break;case "#":break;case "node":k[u.name]=u.group.a;break;case "nodes_global":u=d;for(v=0;v<u.length;v++)if(r=u[v],t=k[r.id])for(var y=0,A=0;A<t.length;A++){var C=t[A];"node_param"==
C.type&&(C=C.qualifier.join(" ")+" ","vert"==a?C+=r.ei[y]:"frag"==a&&(C+=r.va[y],null!==r.pj[y]&&(C+=" = "+r.pj[y])),C+=";",e.push(C),y++)}break;case "nodes_main":u=d;v={};for(r=0;r<u.length;r++)if(C=u[r],t=k[C.id]){var J=0,ha=0,K=0;v[r]={};for(y=0;y<t.length;y++)switch(A=t[y],A.type){case "node_in":var la=C.B[J];if(null!==C.hp[J]){var Y=A.qualifier.join(" ")+" ",Y=Y+la,Y=Y+(" = "+C.hp[J]),Y=Y+";";e.push(Y)}v[r][A.name]=la;J++;break;case "node_out":la=C.Pa[ha];Y=A.qualifier.join(" ")+" ";Y+=la;Y+=
";";e.push(Y);v[r][A.name]=la;ha++;break;case "node_param":"vert"==a?la=C.ei[K]:"frag"==a&&(la=C.va[K]),v[r][A.name]=la,K++}}for(r=0;r<u.length;r++)if(C=u[r],t=k[C.id])for(y=0;y<t.length;y++)if(A=t[y],"textline"==A.type){C=[];for(J=0;J<A.b.length;J++)ha=A.b[J],ha in v[r]?C.push(v[r][ha]):C.push(ha);e.push(l(C,s,h,!1))}break;case "textline":e.push(l(u.b,s,h,!1));break;default:throw"Unknown element type: "+u.type;}}}for(var e=[],s={},u=0;u<c.length;u++)s[c[u][0]]=[c[u][1]];for(u=0;u<d.length;u++)s["USE_NODE_"+
d[u].id]=[1];var h={},k={};g(b);return e.join("\n")}function l(a,b,c,d){var g=[];e(a,b,c,d,g);return g.join(" ")}function e(a,b,c,d,g){for(var f=0;f<a.length;f++){var q=a[f];q in b?(q=b[q],0==q.length&&d?g.push(0):e(q,b,c,d,g)):g.push(q)}}function k(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);t.Jt(d,b,c);return d}function d(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return r(a);case 2:return"vec2("+r(a[0])+","+r(a[1])+")";case 3:return"vec3("+r(a[0])+","+r(a[1])+
","+r(a[2])+")";case 4:return"vec4("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+")";case 9:return"mat3("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+","+r(a[4])+","+r(a[5])+","+r(a[6])+","+r(a[7])+","+r(a[8])+")";case 16:return"mat4("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+","+r(a[4])+","+r(a[5])+","+r(a[6])+","+r(a[7])+","+r(a[8])+","+r(a[9])+","+r(a[10])+","+r(a[11])+","+r(a[12])+","+r(a[13])+","+r(a[14])+","+r(a[15])+")";default:throw"Wrong glsl value dimension";}}function r(a){return a%
1?String(a):String(a)+".0"}var x=p("__config"),n=p("__print"),t=p("__debug"),w=p("__gpp_eval"),B=p("__assets");p("__util");var q=x.yb;if(b4w.module_check(x.yb.yq))var s=p(x.yb.yq),y=null;else s=null,y=p("__gpp_parser");var g={},A={},u=[],S=null;a.Xb=function(a){S=a};a.J=h;a.Kv=c;a.VA=function(a,b){for(var c=a.Od,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Dx=function(a){a.Od=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var g=b[c],e;switch(g){case "ALPHA":case "ALPHA_CLIP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":e=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":e=1;break;case "SHADOW_TEX_RES":e=d(2048);break;case "AA_METHOD":e="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":e="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":e="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":e="POST_EFFECT_NONE";break;case "SHADOW_SRC":e="SHADOW_SRC_NONE";break;case "SHADOW_DST":e=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":e="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":e="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":e="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":e=x.n.precision;break;case "EPSILON":e="highp"==x.n.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":e="u_va_frame_factor";break;default:n.error("Unknown directive ("+a.bi+", "+a.kh+"): "+g)}h(a,g,e)}};a.GA=function(a){return a.bi};a.Ho=function(a){return a.kh};a.kw=function(a,b){for(var d=
b.Od,g=0;g<d.length;g++){var e=d[g][0],f=d[g][1];c(a,e)&&h(a,e,f)}};a.Ev=function(a,c){var d=JSON.stringify(a)+JSON.stringify(c),e=g[d];if(e)return e;var s=a.kh,e=f(q.shaders_dir,a.bi),s=f(q.shaders_dir,s);if(!e||!s)return null;var D=a.Od||[],u=b("vert",e,D,c),D=b("frag",s,D,c),e=S,h=k(e,d,u,e.VERTEX_SHADER),r=k(e,d,D,e.FRAGMENT_SHADER),s=e.createProgram();e.attachShader(s,h);e.attachShader(s,r);e.linkProgram(s);e.validateProgram(s);e.getProgramParameter(s,e.VALIDATE_STATUS)==e.zz&&n.error("B4W Error - shader program is not valid",
d);t.Kt(s,d,h,r,u,D);u={Bm:h,Bo:r,tj:s,attributes:{},Zh:{},Hh:[],Nl:{},ar:[],Xa:a};h=e.getProgramParameter(s,e.ACTIVE_ATTRIBUTES);for(D=0;D<h;D++)r=e.getActiveAttrib(s,D).name,u.attributes[r]=e.getAttribLocation(s,r);h=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(D=0;D<h;D++)r=e.getActiveUniform(s,D).name.split("[0]").join(""),u.Zh[r]=e.getUniformLocation(s,r);return g[d]=u};a.Bu=function(){return u};a.Fv=function(){return g};a.cleanup=function(){for(var a in g){var b=g[a];S.deleteProgram(b.tj);
S.deleteShader(b.Bm);S.deleteShader(b.Bo);delete g[a]}for(var c in A)delete A[c];for(var d in u)delete u[d]};a.eA=function(a){var b=a.Od;n.log("Shader: "+a.bi+" "+a.kh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.u=d;a.Cn=function(a,b){return b in a.Zh?!0:!1};a.Wv=function(a){return(S.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};
b4w.module.__geometry=function(a,p){function h(a){return 65536<a.C?S.Go()?!1:!0:!1}function c(a){return 0<a.Y.length?!0:!1}function f(a,d,e){if(!c(a))return a;e||g.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.C*(d||1)+", will use drawArrays","color: #aa0");d=a.Y;e=a.C;var m=a.A,f=a.r,s;for(s in m){var q=m[s],u=t(q,e);m[s]=b(d,q,u)}for(m=0;m<f.length;m++){var v=f[m];for(s in v)q=v[s],u=t(q,e),v[s]=b(d,q,u)}a.C=d.length;a.Y=new Uint16Array(0);return a}function b(a,b,c){if(0==
b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),g=0;g<a.length;g++)for(var e=a[g],m=0;m<c;m++)d[c*g+m]=b[c*e+m];return d}function l(a,b){var c=a.Uc,d=a.Kb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function e(b,c){var d,g;switch(c){case a.Og:case a.ii:d=H.TRIANGLES;g=H.STATIC_DRAW;break;case a.Jm:d=H.POINTS;g=H.STATIC_DRAW;break;case a.Im:d=H.TRIANGLES;g=H.DYNAMIC_DRAW;break;case a.xr:d=H.POINTS;g=H.DYNAMIC_DRAW;
break;case a.yr:d=H.LINES;g=H.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.$h=g}function k(a){a.Vd?(a.sd||(a.sd=H.createBuffer()),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.sd),H.bufferData(H.ELEMENT_ARRAY_BUFFER,a.Vd,a.$h),a.Hi=a.Vd.byteLength):a.Hi=0;a.Bf||(a.Bf=H.createBuffer());H.bindBuffer(H.ARRAY_BUFFER,a.Bf);H.bufferData(H.ARRAY_BUFFER,a.Uc,a.$h);a.bo=a.Uc.byteLength}function d(a){for(var b=u.mb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].Y.length;b.Y=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].C;b.C=c;var g=a[0],e;for(e in g.A){for(d=c=0;d<a.length;d++)c+=a[d].A[e].length;b.A[e]=new Float32Array(c)}for(e in g.r[0]){for(d=c=0;d<a.length;d++)c+=a[d].r[0][e].length;for(d=0;d<g.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][e]=new Float32Array(c)}for(g=d=c=0;g<a.length;g++){e=a[g];for(var m=e.Y,f=e.C,s=e.A,q=0;q<m.length;q++)b.Y[c+q]=m[q]+d;var c=c+m.length,v;for(v in s){var m=s[v],h=d*t(m,f);b.A[v].set(m,h)}for(q=0;q<e.r.length;q++){var s=e.r[q],k=b.r[q];for(v in s)m=
s[v],h=d*t(m,f),k[v].set(m,h)}d+=f}return b}function r(a,b,c,d,e,m){var q=u.mb("SUBMESH_"+a.name+"_"+b),h=a.submeshes[b],k=h.base_length,r=a.materials[b];q.C=k;if(x(c,"a_texcoord")){var w=null,l=a.materials[b];b=a.submeshes[b];if(l.texture_slots.length)switch(l=l.texture_slots[0],l.texture_coords){case "UV":l=a.uv_textures.indexOf(l.uv_layer);-1==l||0==l?w=new Float32Array(b.texcoord):1==l&&(w=new Float32Array(b.texcoord2));break;case "ORCO":for(var t=a.b4w_bounding_box,w=new Float32Array(2*b.base_length),
l=(t.max_x+t.min_x)/2,H=(t.max_z+t.min_z)/2,B=t.max_x-t.min_x,t=t.max_z-t.min_z,y=0,C=0;C<b.position.length;C+=3)w[y++]=(b.position[C]-l)/B+.5,w[y++]=(H-b.position[C+2])/t+.5}null===w&&(w=new Float32Array(b.texcoord));b=w}else b=new Float32Array(0);var J,w=h.group;if(x(c,"a_influence")&&d){l=new Float32Array(4*k);H=w.length/k;B=new Float32Array(H);for(t=0;t<H;t++)for(J in B[t]=-1,d)if(y=d[J],y.nr===t){B[t]=y.fh;break}C=3<H?H:4;d=new Float32Array(C);J=new Uint32Array(C);for(var t=new Float32Array(4),
y=new Float32Array(C),C=new Uint32Array(C),ha=new Float32Array(4),A=0;A<k;A++)d.set(y),J.set(C),t.set(ha),l.set(n(w,H,A,k,B,d,J,t),4*A)}else l=new Float32Array(0);J=l;d=e?u.ra(e):{};d.a_color={Se:!0};d.a_color.src=x(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,jc:7}]:[];e={a_texcoord:b,a_influence:J};J=h.vertex_colors;b=h.color;w=a.name;l=[];for(H=0;H<J.length;H++)l.push(J[H].name);for(var la in d)if(H=d[la].src,H.length){for(t=B=0;t<H.length;t++)B+=u.vf(H[t].jc);e[la]=new Float32Array(B*
k);for(t=y=0;t<H.length;t++){var Y=H[t].name,C=H[t].jc,ha=u.oq(C),ja=l.indexOf(Y);if(-1==ja)throw'B4W Error: vertex color "'+Y+'" for mesh "'+w+'" not found.';var A=J[ja].mask,E=u.vf(A);(C&A)!==C&&g.error("B4W Error: Wrong color extraction from "+Y+" to "+la+".");for(var ca=Y=0;ca<ja;ca++)Y+=u.vf(J[ca].mask);ja=Y*k;for(Y=0;Y<k;Y++)for(ca=0;3>ca;ca++)ha[ca]&&(e[la][Y*B+(y+u.Rh(C,ca))]=b[ja+Y*E+u.Rh(A,ca)]);y+=E}}else e[la]=new Float32Array(0);la=a.uv_textures;d=h.texcoord;J=h.texcoord2;b=a.name;if(m)for(var S in m){w=
la.indexOf(S);if(-1==w)throw'B4W Error: uv map "'+S+'" for mesh "'+b+'" not found';if(0==w)var ea=new Float32Array(d);else 1==w&&(ea=new Float32Array(J));e[m[S]]=ea}q.A=e;q.Y=new Uint32Array(h.indices);m=h.position.length/k/3;ea=(S=x(c,"a_normal")&&h.normal.length?!0:!1)&&x(c,"a_tangent")&&h.tangent.length?!0:!1;la=S&&r.texture_slots.length&&x(c,"a_tangent")&&"ORCO"==r.texture_slots[0].texture_coords?!0:!1;for(e=0;e<m;e++){r={};d=new Float32Array(3*k);J=new Float32Array(S?3*k:0);b=new Float32Array(ea||
la?4*k:0);w=e*k*3;l=w+3*k;d.set(h.position.subarray(w,l),0);S&&(w=e*k*3,l=w+3*k,J.set(h.normal.subarray(w,l),0));if(ea)w=e*k*4,l=w+4*k,b.set(h.tangent.subarray(w,l),0);else if(la)for(w=J,l=b,H=k,g.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),B=0;B<H;B++)t=v,y=K,t[0]=w[3*B],t[1]=w[3*B+1],t[2]=w[3*B+2],I.cross(t,u.AXIS_Z,y),0==I.length(y)&&I.cross(t,u.AXIS_X,y),I.normalize(y,y),l[4*B]=y[0],l[4*B+1]=
y[1],l[4*B+2]=y[2],l[4*B+3]=1;else if(S&&x(c,"a_tangent"))for(b=new Float32Array(4*k),e=0;e<b.length;e++)b[e]=1;r.a_position=d;r.a_normal=J;r.a_tangent=b;q.r.push(r)}if(1<m){a=q.r[0];var r={},p;for(p in a)r[p]=new Float32Array(a[p]);q.r.push(r)}x(c,"a_polyindex")&&(f(q,1,!0),q.A.a_polyindex=s(q));return q}function x(a,b){return-1<a.indexOf(b)?!0:!1}function n(a,b,c,d,g,e,m,f){for(var q=!0,s=0;s<b;s++){var u=a[s*d+c];if(-1!==u){var v=g[s];-1!==v&&(e[s]=u,m[s]=v,q=!1)}}if(q)return f;w(e,m,!1);for(s=
a=0;4>s;s++)a+=e[s];if(.01>a)return f;for(s=0;4>s;s++)e[s]/=a;if(.01>Math.abs(e[0]-1))f[0]=m[0]+1;else for(s=0;4>s;s++)f[s]=m[s]+e[s];return f}function t(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function w(a,b,c){var d=a.length,g=d,e=!1;for(c=c?-1:1;1<g||e;){1<g&&(g=Math.floor(g/1.247330950103979));for(var e=!1,m=0;g+m<d;m++)0>c*(a[m]-a[m+g])&&(e=a[m],a[m]=a[m+g],a[m+g]=e,e=b[m],
b[m]=b[m+g],b[m+g]=e,e=!0)}}function B(a,b,c){var d=[],g=[];I.subtract(b,a,d);I.subtract(c,a,g);I.normalize(d,d);I.normalize(g,g);return Math.acos(I.dot(d,g))}function q(a,b,d){b||(b=[]);d=d?a.r[0].a_normal:a.r[0].a_position;if(c(a)){a=a.Y;for(var g=a.length/3,e=0;e<g;e++){var m=new Float32Array(9),f=a[3*e];m[0]=d[3*f];m[1]=d[3*f+1];m[2]=d[3*f+2];f=a[3*e+1];m[3]=d[3*f];m[4]=d[3*f+1];m[5]=d[3*f+2];f=a[3*e+2];m[6]=d[3*f];m[7]=d[3*f+1];m[8]=d[3*f+2];b[e]=m}}else for(e=0;e<d.length;e++)m=new Float32Array(9),
m[0]=d[9*e],m[1]=d[9*e+1],m[2]=d[9*e+2],m[3]=d[9*e+3],m[4]=d[9*e+4],m[5]=d[9*e+5],m[6]=d[9*e+6],m[7]=d[9*e+7],m[8]=d[9*e+8],b[e]=m;return b}function s(a){for(var b=new Float32Array(a.C),c=0;c<a.C;c++)b[c]=c%3;return b}function y(a,b,c){var d=I.dist(a,b);a=I.dist(a,c);b=I.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var g=p("__print"),A=p("__tsr"),u=p("__util"),S=p("__extensions"),I=p("vec3"),v=new Float32Array(3),K=new Float32Array(3),m=new Float32Array(3);a.Zc=10;a.Rm=20;a.Ez=30;a.ii=10;a.Jm=
20;a.Im=30;a.xr=40;a.yr=50;a.Og=a.ii;var H=null;a.Xb=function(a){H=a};a.gA=function(a){var b=_buffers[a];H.deleteBuffer(b.sd);H.deleteBuffer(b.Bf);delete _buffers[a]};a.qy=function(b,d,g,m){h(b)&&f(b);var s=b.Y,q=b.C,u=b.r,v={},w;for(w in b.A)w in m&&!m[w].Se||(v[w]=b.A[w]);m={Vd:null,Uc:null,kl:0,count:0,Kb:{},mode:0,$h:0,Hi:0,bo:0,Bf:null,sd:null,Ui:null};if(s.length)if(w=s.length,65536>=q)var r=new Uint16Array(s),l=H.UNSIGNED_SHORT;else r=new Uint32Array(s),l=H.UNSIGNED_INT;else w=q,r=null;var n=
0,B=u.length,y;for(y in u[0])var x=u[0][y],n=n+x.length*B;for(y in v)x=v[y],n+=x.length;y=new Float32Array(n);var n=0,B={},A;for(A in v){var C=v[A];if(x=C.length)y.set(C,n),B[A]={Mz:A,Ic:t(C,q),offset:n,frames:1,length:x},n+=x}v=u.length;for(A in u[0])if(C=u[0][A],x=C.length,C=t(C,q),x){B[A]={Ic:C,offset:n,frames:v,length:x};1<v&&(B[A+"_next"]={Ic:C,offset:n+x,frames:v,length:x});for(var J=0;J<v;J++)C=u[J][A],y.set(C,n),n+=x}m.count=w;m.Vd=r;m.Uc=y;m.kl=l;m.Kb=B;e(m,g);k(m);d!=a.Zc&&c(b)&&(m.Ui={Iw:new Float32Array(s.length),
Jw:new Float32Array(s.length),Mu:new Float32Array(s.length/3),type:d});return m};a.uw=h;a.tw=c;a.lm=f;a.Hy=function(a,b,c){e(a,b);a.count=c.length;a.Vd=c;a.kl=c instanceof Uint16Array?H.UNSIGNED_SHORT:H.UNSIGNED_INT};a.Mj=function(a,b,c,d){var g=a.Uc,e=a.Kb,m=e[b];if(m){if(c&&m.Ic!=c)throw'Error: invalid num_comp for "'+b+'"';g.set(d,m.offset)}else g=g.length,m=new Float32Array(g+d.length),m.set(a.Uc),m.set(d,g),a.Uc=m,e[b]={Ic:c,offset:g};k(a)};a.Uu=l;a.hB=function(a){a.$h=H.STATIC_DRAW};a.Dw=function(a){a.$h=
H.DYNAMIC_DRAW};a.My=k;a.In=function(a){a.sd&&H.deleteBuffer(a.sd);a.Bf&&H.deleteBuffer(a.Bf)};a.$o=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Sq=function(a,b){for(var c=0;c<a.r.length;c++){var d=a.r[c].a_position;A.Eg(d,b,d,0);d=a.r[c].a_normal;0<d.length&&A.Jj(d,b,d,0);d=a.r[c].a_tangent;0<d.length&&A.$q(d,b,d,0)}(c=a.A.au_center_pos)&&c.length&&A.Eg(c,b,c,0);return a};a.oy=function(a,b){var c=a.A.au_center_pos;if(c&&c.length){var d=new Float32Array(c);A.Eg(d,b,d,0);for(var g=0;g<
a.r.length;g++)for(var e=0;e<d.length;e++)a.r[g].a_position[e]+=d[e]-c[e];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.ny=function(a,b){var c=a.C,d;for(d in b){var g=b[d].length;a.A[d]=new Float32Array(g*c);for(var e=0;e<c;e++)for(var m=0;m<g;m++)a.A[d][e*g+m]=b[d][m]}};a.py=d;a.Cw=function(a,b,c){if(!a.C)return u.mb("EMPTY");var d=c.length;65536<a.C*d&&!S.Go()&&f(a,d);var g=a.Y,e=a.C,m=a.A;a=a.r;for(var s in b){var q=b[s].length,v=q*e;m[s]=new Float32Array(v);
for(var h=0;h<e;h++)for(v=0;v<q;v++)m[s][h*q+v]=b[s][v]}b=u.mb("CLONE_"+d+"_SUBMESHES");b.C=e*d;b.Y=new Uint32Array(g.length*d);for(h=0;h<d;h++)for(q=g.length*h,s=e*h,v=0;v<g.length;v++)b.Y[q+v]=g[v]+s;for(var k in m)for(g=m[k],v=g.length*d,q=t(g,e),b.A[k]=new Float32Array(v),h=0;h<d;h++)s=e*q*h,b.A[k].set(g,s);for(k in a[0])for(h=0;h<a.length;h++)for(g=a[h][k],v=g.length*d,q=t(g,e),b.r[h]=b.r[h]||{},b.r[h][k]=new Float32Array(v),v=0;v<d;v++)switch(m=c[v],s=e*q*v,k){case "a_position":A.Eg(g,m,b.r[h][k],
s);break;case "a_normal":A.Jj(g,m,b.r[h][k],s);break;case "a_tangent":A.$q(g,m,b.r[h][k],s);break;default:throw"Wrong attribute name: "+k;}return b};a.so=r;a.Xu=function(a){var b=a.C,c=a.r[0].a_position,d=new Float32Array(12*b),g=new Float32Array(8*b);a=new Uint16Array(4*a.Y.length);for(var e=0;e<b;e++)d[12*e]=c[3*e],d[12*e+1]=c[3*e+1],d[12*e+2]=c[3*e+2],d[12*e+3]=c[3*e],d[12*e+4]=c[3*e+1],d[12*e+5]=c[3*e+2],d[12*e+6]=c[3*e],d[12*e+7]=c[3*e+1],d[12*e+8]=c[3*e+2],d[12*e+9]=c[3*e],d[12*e+10]=c[3*e+
1],d[12*e+11]=c[3*e+2],g[8*e]=-.5,g[8*e+1]=-.5,g[8*e+2]=-.5,g[8*e+3]=.5,g[8*e+4]=.5,g[8*e+5]=.5,g[8*e+6]=.5,g[8*e+7]=-.5,a[6*e]=4*e+2,a[6*e+1]=4*e+1,a[6*e+2]=4*e,a[6*e+3]=4*e+2,a[6*e+4]=4*e,a[6*e+5]=4*e+3;c=u.mb("HALO");c.r=[];c.r[0]={};c.C=4*b;c.r[0].a_position=d;c.A.a_halo_bb_vertex=g;c.Y=a;return c};a.ew=x;a.Yu=function(a){for(var b=["a_position","a_normal"],c=[],g=0;g<a.submeshes.length;g++){var e=r(a,g,b,null,null,null);e.C&&c.push(e)}return 0==c.length?u.mb("EMPTY"):1==c.length?c[0]:d(c)};a.Gy=
function(a,b,c){for(var d=a.Vd,g=l(a,"a_position"),e=a.Ui,m=e.Iw,f=e.Jw,e=e.Mu,s=d,q=s.length/3,v=0;v<q;v++){var h=s[3*v],k=s[3*v+1],w=s[3*v+2],r=g[3*h+1],n=g[3*h+2],C=g[3*k+1],J=g[3*k+2],t=g[3*w+1],B=g[3*w+2];m[3*v]=(g[3*h]+g[3*k]+g[3*w])/3;m[3*v+1]=(r+C+t)/3;m[3*v+2]=(n+J+B)/3}u.ce(m,b,f);b=m.length/3;for(g=0;g<b;g++)f=m[3*g]-c[0],s=m[3*g+1]-c[1],q=m[3*g+2]-c[2],e[g]=f*f+s*s+q*q;c=d;d=e.length;if(!(2>d))for(m=d,g=!1;1<m||g;)for(1<m&&(m=Math.floor(m/1.247330950103979)),g=!1,b=0;m+b<d;b++)0>e[b]-
e[b+m]&&(g=e[b],e[b]=e[b+m],e[b+m]=g,g=c,f=b,s=b+m,q=g[3*f],v=g[3*f+1],h=g[3*f+2],g[3*f]=g[3*s],g[3*f+1]=g[3*s+1],g[3*f+2]=g[3*s+2],g[3*s]=q,g[3*s+1]=v,g[3*s+2]=h,g=!0);d=c;H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.sd);H.bufferData(H.ELEMENT_ARRAY_BUFFER,d,H.DYNAMIC_DRAW)};a.$x=w;a.un=function(a,b,c){for(var d=b.length/3,g=a.length/3,e=[],m=Array(3),f=Array(3),s=Array(3),q=0;q<g;q++){for(var u=a[3*q],v=a[3*q+1],h=a[3*q+2],k=0;3>k;k++)m[k]=b[3*u+k],f[k]=b[3*v+k],s[k]=b[3*h+k];if(c)var k=B(m,f,s),w=B(f,
s,m),r=Math.PI-k-w;else r=w=k=1;var C=e,J;J=m;var n=s,l=[],t=[],H=[];I.subtract(f,J,l);I.subtract(n,J,t);I.cross(l,t,H);I.normalize(H,H);J=H;for(n=0;3>n;n++)l=3*v+n,t=3*h+n,C[3*u+n]=k*J[n],C[l]=w*J[n],C[t]=r*J[n]}if(c)for(var y in c)for(q=c[y],a=0;3>a;a++){b=3*q[0]+a;for(g=1;g<q.length;g++)m=3*q[g]+a,e[b]+=e[m];for(g=1;g<q.length;g++)m=3*q[g]+a,e[m]=e[b]}for(q=0;q<d;q++){c=q;y=e;a=new Float32Array(3);for(b=0;3>b;b++)g=3*c+b,a[b]=y[g];I.normalize(a,a);for(b=0;3>b;b++)g=3*c+b,y[g]=a[b]}return e};a.wn=
function(a,b,c){for(var d={},g=b.length/3,e=0;e<g;e++){var m=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);d[m]=[]}g=a.length;for(e=0;e<g;e++)b=a[e],m=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),m in d&&d[m].push(b);return d};a.al=function(a,b,c,d){var g=q(a,null,!1);if(c)var e=q(a,null,!0);var f=g.length,s=new Float32Array(f),h=v,k=K;for(a=0;a<f;a++){var w=g[a];h.set(w.subarray(0,3));k.set(w.subarray(3,6));m.set(w.subarray(6));s[a]=Math.sqrt(y(h,k,m))}h=new Float32Array(f);h[0]=s[0];for(a=
1;a<f;a++)h[a]=h[a-1]+s[a];f=h[s.length-1];s=[];for(a=0;a<b;a++){var k=f*u.kc(d),k=u.ui(h,k,0,h.length-1),w=c?e[k]:g[k],k=a,r=w,n=d,w=new Float32Array(3),l=r[0],t=r[1],H=r[2],C=r[3],J=r[4],ha=r[5],B=r[6],x=r[7],A=r[8],r=u.kc(n),n=u.kc(n);1<r+n&&(r=1-r,n=1-n);var I=1-r-n,t=I*t+r*J+n*x,H=I*H+r*ha+n*A;w[0]=I*l+r*C+n*B;w[1]=t;w[2]=H;s[k]=w}return s};a.lA=q;a.ro=s;a.DB=y;a.Ov=function(a,b,c,d){var g=b[0]-a[0],e=c[0]-a[0],m=b[1]-a[1],f=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=m*a-b*f;d[1]=e*b-g*a;d[2]=g*
f-m*e;return d};a.ux=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};
b4w.module.__objects=function(a,p){function h(a){a={type:a,jd:0,dw:[0,0],e:new Float32Array(3),quat:new Float32Array(4),Tc:new Float32Array(8),H:new Float32Array(16),ip:new Float32Array(16),Wa:new Float32Array(3),Ud:new Float32Array(3),ir:!1,T:0,xm:1,wm:1,ym:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,cr:!1,Fc:0,Pf:0,zb:!1,pb:null,Aa:null,Oa:null,lo:!0,M:null,Pi:null,mh:0,hh:0,Wk:0,yh:0,gf:0,aq:"",Qj:!1,Nb:!1,rb:!1,Ob:!1,Wb:!1,Mb:!1,uc:!1,Ge:!1,Vc:!1,Ii:!1,md:!1,ya:!1,Qf:!1,qh:!1,
bj:!1,Kc:!1,mj:!1,Yi:!1,is_visible:!1,gi:0,Wc:0,ue:0,Nd:0,Md:0,Kd:0,ud:"",xb:null,ti:!1,cd:!1,Vg:"",ok:!1,Qe:0,time:0,vm:0,kr:0,max_bones:0,lh:!1,ci:!1,uh:!1,Hd:!1,Gd:1,gk:0,fk:1,Kj:new Int8Array([-1,-1]),Dj:[],yp:[],Bq:[],Vb:null,Ub:null,dc:null,cc:null,gc:null,bq:null,jf:null,zh:null,Db:null,nk:null,lk:null,mk:null,Ia:null,rc:null,kb:null,Ee:null,Fe:null,scale:1,Zd:1E4};y.identity(a.quat);q.identity(a.Tc);A.identity(a.H);A.identity(a.ip);return a}function c(a,b,c,d){var g=a.d.va,e;for(e in g){var f=
a.name+"_"+e;e in d||(d[e]=b.length,b.push(g[e][0]));c.push(f,d[e])}}var f=p("__animation"),b=p("__batch"),l=p("__boundings"),e=p("__camera"),k=p("__config"),d=p("__constraints"),r=p("__curve"),x=p("__lights"),n=p("__nla"),t=p("__particles");p("__print");var w=p("__scenes"),B=p("__transform"),q=p("__tsr"),s=p("__util"),y=p("quat"),g=p("vec3"),A=p("mat4"),u=k.n,S=0,I=new Float32Array(4);a.Fi=h;a.um=function(a,k){var m;m=a.parent;if(!(m=m&&m.Ls)){if(!(m="ARMATURE"===a.type||"CAMERA"===a.type)&&(m="MESH"===
a.type)){var H=f.Wi(a),D=a.b4w_do_not_batch,y=a.b4w_dynamic_geometry,P=a.b4w_collision,p=a.b4w_vehicle,V=a.b4w_floating;m=a.b4w_character;var M=a.b4w_billboard,Q=t.gw(a),T=n.ap(a);if(!(H=H||D||y||P||p||V))a:{H=a.data;for(D=0;D<H.materials.length;D++)if("LENS_FLARES"===H.materials[D].name){H=!0;break a}H=!1}m=H||Q||m||M||T}!m&&(m="EMPTY"===a.type)&&(m=f.Wi(a),M=n.ap(a),m=m||M)}m=m?!0:!1;a.Ls=m;a.d=h("MESH"===a.type?m?"DYNAMIC":"STATIC":a.type);a.$a=null;a.Fd=[];a.Cb||(a.Cb=null);m=a.d;Q=a.location;
M=a.scale[0];s.cx(a.rotation_quaternion,I);B.set_translation(a,Q);B.set_rotation(a,I);B.set_scale(a,M);switch(a.type){case "ARMATURE":Q=a.pose.bones;for(M=0;M<Q.length;M++)T=Q[M],H=T.bone,D=new Float32Array(H.matrix_local),y=new Float32Array(16),A.invert(D,y),P=new Float32Array(T.matrix_basis),p=new Float32Array(3),g.subtract(H.tail_local,H.head_local,p),s.bz(p,y,p),T.Ps=p,T.Is=[T].concat(T.parent_recursive),T.Um=q.Ao(D,q.create()),T.Tm=q.Ao(P,q.create()),T.ck=q.create(),T.mi=!1;Q=f.yt(a);m.gc=Q;
Q=f.vn(a,Q);a.b4w_animation_mixing?(m.Vb=new Float32Array(Q.ja),m.Ub=new Float32Array(Q.ja),m.dc=new Float32Array(Q.e),m.cc=new Float32Array(Q.e)):(m.Vb=Q.ja,m.Ub=Q.ja,m.dc=Q.e,m.cc=Q.e);m.bq=Q;m.Qe=0;m.Hd=a.b4w_animation_mixing;break;case "MESH":m.Kc=u.all_objs_selectable||a.b4w_selectable;m.mj=a.b4w_selectable;m.cd=a.b4w_billboard;m.Vg="BASIC";m.ok="SPHERICAL"==a.b4w_billboard_geometry;m.Pi={Zv:a.b4w_glow_settings.glow_duration,aw:a.b4w_glow_settings.glow_period,bw:a.b4w_glow_settings.glow_relapses};
m.Kc&&(a.Sm=s.jv(S),S++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.ci=a.data.b4w_vertex_anim.length?!0:!1;if(M=f.get_first_armature_object(a)){Q=a.d;T=a.data.vertex_groups;if(T.length){H=M.data.bones;D=M.pose.bones;y=0;P={};for(p=0;p<H.length;p++){var V=H[p].name,X=s.keysearch("name",V,T);if(X){var z=s.el(D,"name",V);P[V]={sn:p,fh:y++,Ol:z,nr:X.index}}}Q.gc=P;Q.max_bones=y;Q.uh=!0}Q=a.d.gc;Q=f.vn(M,Q);M.b4w_animation_mixing?(m.Vb=new Float32Array(Q.ja),m.Ub=new Float32Array(Q.ja),m.dc=
new Float32Array(Q.e),m.cc=new Float32Array(Q.e)):(m.Vb=Q.ja,m.Ub=Q.ja,m.dc=Q.e,m.cc=Q.e);m.bq=Q;m.Qe=0}if(f.hl(a)){M=a.d;Q=a.data.materials;T=[];H=[];for(D=0;D<Q.length;D++)if((y=Q[D].node_tree)&&y.animation_data)for(p=y.animation_data,y={},(P=p.action)&&c(P,T,H,y),p=p.nla_tracks,V=0;V<p.length;V++)for(X=p[V].strips,z=0;z<p[V].strips.length;z++)P=X[z].action,c(P,T,H,y);M.jf=T;M.zh=H}a.P=[];m.Nb=a.b4w_shadow_cast;m.rb=a.b4w_shadow_receive;m.Ob=a.b4w_shadow_cast_only&&m.Nb;m.Wb=a.b4w_reflexible;m.Mb=
a.b4w_reflexible_only&&m.Wb;m.uc=a.b4w_reflective;m.Ge=a.b4w_caustics;m.Vc=a.b4w_wind_bending;m.gi=a.b4w_wind_bending_angle;M=b.iz(a.b4w_wind_bending_angle,b.qt(a.data.b4w_bounding_box),a.scale[0]);m.Wc=M;m.ue=a.b4w_wind_bending_freq;m.Nd=a.b4w_detail_bending_freq;m.Md=a.b4w_detail_bending_amp;m.Kd=a.b4w_branch_bending_amp;m.qh=!1;m.ud=a.b4w_main_bend_stiffness_col;M=a.b4w_detail_bend_colors;m.xb={};m.xb.sp=M.leaves_stiffness_col;m.xb.rp=M.leaves_phase_col;m.xb.Ip=M.overall_stiffness_col;m.Qf=a.b4w_do_not_cull;
m.Ii=a.b4w_disable_fogging;m.md=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";M=a.data.materials[0];m.mh=M.physics.friction;m.hh=M.physics.elasticity;m.yh=0;m.Zd=1E4;m.gf=a.b4w_lod_transition;m.bj=!0;break;case "CAMERA":e.Ct(a);e.nt(a);break;case "LAMP":x.yw(a);break;case "CURVE":if(M=r.ru(a))a.Os=M;break;case "EMPTY":m.Db=l.Xc(),M=l.hi(),m.rc=M}if(!k&&(a.parent&&"OBJECT"==a.parent_type?(Q=m.e,T=m.quat,M=m.scale,d.bn(a,a.parent,Q,T,M)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==
a.parent.type?(Q=m.e,T=m.quat,M=m.scale,d.an(a,a.parent,a.parent_bone,Q,T,M)):a.Cb&&a.Cb.b4w_group_relative?(M=q.Of(m.e,m.scale,m.quat),d.Vs(a,a.Cb,M)):a.Cb&&!a.Cb.b4w_group_relative&&(B.v(a),T=m.H,A.multiply(a.Cb.d.H,T,T),Q=s.hf(T),M=s.dj(T),T=s.matrix_to_quat(T),B.set_translation(a,Q),B.set_rotation(a,T),B.set_scale(a,M)),M=a.dupli_group))for(Q=M.objects,M=0;M<Q.length;M++)Q[M].Cb=a;a.field&&(m.Wk=a.field.strength,w.fr(a));m.Qj=a.game.use_collision_compound;m.aq=a.game.physics_type;B.v(a)};a.Py=
function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||B.v(c);c.b4w_use_default_animation&&f.Wi(c)&&(f.apply_def(c),f.play(c,null,f.SLOT_ALL))}};a.cleanup=function(){S=0}};
b4w.module.__particles=function(a,p){function h(){throw"_rand() undefined";}function c(a,b,c,e,f,g,h){var u=a.I.Nk,k=a.I.Gc,r=a.I.time;a=a.I.cq;for(var v=b?4:1,l=0;l<u.length;l+=v){var m=u[l];if(m>a&&m<=r)for(m=0;8>m;m++)k[8*l+m]=f[m];for(m=0;8>m;m++)n[m]=k[8*l+m];m=t;m[0]=c[3*l];m[1]=c[3*l+1];m[2]=c[3*l+2];d.Yh(m,n,m);g[3*l]=m[0];g[3*l+1]=m[1];g[3*l+2]=m[2];var H=t;H[0]=e[3*l];H[1]=e[3*l+1];H[2]=e[3*l+2];d.Ij(H,n,H);h[3*l]=H[0];h[3*l+1]=H[1];h[3*l+2]=H[2];if(b)for(m=1;4>m;m++)g[3*(l+m)]=g[3*l],g[3*
(l+m)+1]=g[3*l+1],g[3*(l+m)+2]=g[3*l+2],h[3*(l+m)]=H[0],h[3*(l+m)+1]=H[1],h[3*(l+m)+2]=H[2]}}function f(a){a?(k.jy(a),h=function(){return k.ex()}):h=function(){return Math.random()}}var b=p("__config"),l=p("__geometry"),e=p("__scenes"),k=p("__util"),d=p("__tsr"),r=p("vec3"),x=b.Jd,n=new Float32Array(8),t=new Float32Array(3);a.ag=function(a){return 0<a.particle_systems.length?!0:!1};a.Ti=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.IA=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.gw=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.ov=function(a,b,e,s){e.I=e.I||{};var n=l.Yu(b),g=e.settings.count,t=e.settings.frame_start/x.ua,u=e.settings.frame_end/x.ua,S=e.settings.lifetime/x.ua,I=e.settings.lifetime_random,v=e.settings.emit_from,K=
e.settings.factor_random,m=e.settings.angular_velocity_mode,H=e.settings.angular_velocity_factor,D=e.settings.b4w_randomize_emission,U=e.settings.b4w_cyclic;f(e.seed);var P=e.I.Zy="WORLD"==e.settings.b4w_coordinate_system?!0:!1;e.I.frame=0;if(b=!a.Ve){var p;p=[];for(var V=0;V<g;V++)p.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);p=new Float32Array(p);for(var V=[],M=0;M<g;M++)V.push(4*M,4*M+2,4*M+1,4*M,4*M+3,4*M+2);V=new Uint16Array(V)}switch(v){case "VERT":for(var M=n.r[0].a_position,n=n.r[0].a_normal,Q=M.length/
3,v=[],T=0;T<g;T++){var X=Math.round((Q-1)*h());v.push(X);b&&(v.push(X),v.push(X),v.push(X))}Q=[];for(T=0;T<v.length;T++)Q.push(M[3*v[T]]),Q.push(M[3*v[T]+1]),Q.push(M[3*v[T]+2]);M=new Float32Array(Q);Q=[];for(T=0;T<v.length;T++)Q.push(n[3*v[T]]),Q.push(n[3*v[T]+1]),Q.push(n[3*v[T]+2]);v=new Float32Array(Q);break;case "FACE":M=[];v=[];T=[];k.Vi(0,T);Q=l.al(n,g,!1,T);k.Vi(0,T);n=l.al(n,g,!0,T);for(T=0;T<Q.length;T++)M.push(Q[T][0],Q[T][1],Q[T][2]),b&&(M.push(Q[T][0],Q[T][1],Q[T][2]),M.push(Q[T][0],
Q[T][1],Q[T][2]),M.push(Q[T][0],Q[T][1],Q[T][2])),v.push(n[T][0],n[T][1],n[T][2]),b&&(v.push(n[T][0],n[T][1],n[T][2]),v.push(n[T][0],n[T][1],n[T][2]),v.push(n[T][0],n[T][1],n[T][2]));M=new Float32Array(M);v=new Float32Array(v);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}v=[M,v];n=v[0];v=v[1];e.I.Xw=new Float32Array(n);e.I.Pw=new Float32Array(v);e.I.Yw=new Float32Array(n.length);e.I.Qw=new Float32Array(v.length);e.I.time=0;e.I.cq=
-1;M=[];u=(u-t)/g;for(Q=0;Q<g;Q++)T=D?u*Q+10*u*(.5-h()):u*Q,U||(T+=t),M.push(T),b&&(M.push(T),M.push(T),M.push(T));t=new Float32Array(M);e.I.Nk=new Float32Array(t);e.I.co=new Float32Array(t);e.I.Gc=new Float32Array(8*t.length);for(D=0;D<8*t.length;D++)for(U=0;8>U;U++)e.I.Gc[8*D+U]=s[U];P?c(e,b,n,v,s,n,v):(d.Eg(n,s,n,0),d.Jj(v,s,v,0));e=[];s=S*I;for(I=0;I<g;I++)P=s*h(),e.push(S-P),b&&(e.push(S-P),e.push(S-P),e.push(S-P));S=new Float32Array(e);e=[];for(s=0;s<g;s++){I=[h()-.5,h()-.5,h()-.5];r.normalize(I,
I);e.push(K*I[0]);e.push(K*I[1]);e.push(K*I[2]);switch(m){case "NONE":e.push(0);break;case "SPIN":case "VELOCITY":e.push(H);break;case "RAND":e.push(2*H*(h()-.5));break;default:throw"Undefined velocity factor";}if(b)for(I=e.slice(-4),P=0;12>P;P++)e.push(I[P%4])}g=new Float32Array(e);K=k.mb("EMITTER_PARTICLES");m=k.hd();m.a_position=n;m.a_normal=v;K.r[0]=m;b?K.Y=V:(a.ld=l.Jm,K.Y=new Uint16Array(0));K.C=n.length/3;K.A.a_p_delay=t;K.A.a_p_lifetime=S;K.A.a_p_vels=g;b&&(K.A.a_p_bb_vertex=p);return K};
a.Ly=function(a){for(var b=a.P,e=0;e<b.length;e++){var f=b[e],h=b[e].Jc;if(h){var g=f.bb,k=h.I.Yw,u=h.I.Qw,n=h.I.Xw,r=h.I.Pw;h.I.Zy?c(h,!f.Ve,n,r,a.d.Tc,k,u):(f=r,h=a.d.Tc,r=u,d.Eg(n,h,k,0),d.Jj(f,h,r,0));l.Dw(g);l.Mj(g,"a_position",3,k);l.Mj(g,"a_normal",3,u)}}};a.Ex=function(a,b,c){var d=b.settings.lifetime/x.ua,f=b.settings.normal_factor,g=9.81*b.settings.effector_weights.gravity,h=b.settings.effector_weights.wind,u=b.settings.mass,k=b.settings.b4w_fade_in/x.ua,n=b.settings.b4w_fade_out/x.ua,v=
b.settings.b4w_cyclic;a.Rp=b.settings.frame_end/x.ua-b.settings.frame_start/x.ua;a.Np=v?1:0;a.Kl=f;a.Qp=g;f=e.Yv();a.nj[0]=f[0]*h;a.nj[1]=f[1]*h;a.nj[2]=f[2]*h;a.Tp=d;a.Sp=u;a.Op=k;a.Pp=n;a.Ve?(d=c.halo.size,h=c.halo.hardness,30>h?(h=.5,u=.9):40>h?(h=.1,u=1):50>h?(h=0,u=.8):(h=0,u=.5)):(d=b.settings.particle_size,u=h=1);a.Ll=d;a.Kp=h;a.Jp=u;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;
h=Math.min(2*d.length,b.length);for(u=0;u<h;u+=2)k=d[u/2],b[u]=k.position,b[u+1]=(k.color[0]+k.color[1]+k.color[2])/3;a.Vp=d.length}a.Up.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;h=Math.min(4*d.length,c.length);for(u=0;u<h;u+=4)k=d[u/4],c[u]=k.position,c[u+1]=k.color[0],c[u+2]=k.color[1],c[u+3]=k.color[2];a.Mp=d.length}a.Lp.set(c)};
a.Lx=function(a,b){a.I.cq=a.I.time;a.I.time=b};a.Zw=function(a){for(var b=a.C,c=a.r[0].a_position,d=a.A.a_texcoord,e=[],g=[],f=0;f<b;f++)g.push(c[3*f]),g.push(c[3*f+1]),e.push(c[3*f+2]);e=new Float32Array(e);g=new Float32Array(g);a.A.a_lf_dist=e;a.A.a_lf_bb_vertex=g;a.A.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.P;for(var d=0;d<a.length;d++){var e=a[d],g=e.Jc;g&&g.name==b&&(e.Ll=c)}};a.set_normal_factor=function(a,b,c){a=a.P;for(var d=0;d<a.length;d++){var e=a[d],g=e.Jc;g&&g.name==b&&(e.Kl=
c)}};a.set_factor=function(a,b,c){a=a.P;for(var d=0;d<a.length;d++){var e=a[d],g=e.Jc;if(g&&g.name==b){var f=g.I.Nk;if(1==c)g=f;else if(0==c)for(var u=!e.Ve,h=u?4:1,g=g.I.co,k=0;k<g.length;k+=h)g[k]=1E4,u&&(g[k+1]=g[k],g[k+2]=g[k],g[k+3]=g[k]);else for(var v=1/c,g=g.I.co,h=(u=!e.Ve)?4:1,n=0,k=0;k<g.length;k+=h)k>=n?(g[k]=f[k],n+=v):g[k]=1E4,u&&(g[k+1]=g[k],g[k+2]=g[k],g[k+3]=g[k]);l.Mj(e.bb,"a_p_delay",1,g)}}};a.Uy=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==
e.settings.type)for(var g=e.I.Nk,d=0;d<8*g.length;d++)e.I.Gc[8*d]=b[0],e.I.Gc[8*d+1]=b[1],e.I.Gc[8*d+2]=b[2],e.I.Gc[8*d+3]=b[3],e.I.Gc[8*d+4]=c[0],e.I.Gc[8*d+5]=c[1],e.I.Gc[8*d+6]=c[2],e.I.Gc[8*d+7]=c[3]}}};
b4w.module.__primitives=function(a,p){function h(a,b,c,f){for(var h=[],k=[],l=[],q=[],s=2*c/(a-1),y=2*f/(b-1),g=0;g<a;g++)for(var A=-c+g*s,u=0;u<b;u++)if(k.push(A,0,-f+u*y),l.push(0,1,0),q.push(g/(a-1),u/(b-1)),g&&u){var S=g*b+u,I=S-1,v=(g-1)*b+u,K=v-1;h.push(S,I,v);h.push(I,K,v)}a=e.hd();a.a_position=new Float32Array(k);a.a_normal=new Float32Array(l);l=e.mb("GRID_PLANE");l.r[0]=a;l.A.a_texcoord=new Float32Array(q);l.Y=new Uint32Array(h);l.C=k.length/3;return l}function c(a){var c=a.length;if(c%4)throw"Wrong array";
for(var f=[],h=[],k=0;k<c;k+=4){var l=a[k+1],B=a[k+2],q=a[k+3];b(a[k],h);b(l,h);b(B,h);b(q,h);f.push(k,k+1,k+2);f.push(k,k+2,k+3)}a=e.hd();a.a_position=new Float32Array(h);c=e.mb("FROM_QUADS");c.r[0]=a;c.Y=new Uint32Array(f);c.C=h.length/3;return c}function f(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function b(a,b){b.push(a[0],a[1],a[2])}var l=p("__geometry"),e=p("__util"),k=p("__config").n;a.xA=function(a){for(var b=e.mb("LINE"),c=[],f=0;f<2*a;f++)c.push(f);f=e.hd();f.a_point=new Float32Array(c);
b.r[0]=f;b.Y=new Uint32Array(c);b.C=2*a;return b};a.yA=function(a,b){var c=h(2,2,a,b);c.name="PLANE";return c};a.wA=h;a.sv=function(a,b,c){function f(a,b){return 1==a%2&&(0==b||b==q-1)||1==b%2&&(0==a||a==B-1)?!0:!1}var h=c/=Math.pow(2,a-1),w=c,B=b+1,q=b+1;b=[];c=[];for(var s=0,y=0,g=-1,A=[],u=0;u<a;u++){for(var S=2*h/(B-1),I=2*w/(q-1),v=[],K=[],m=0,H=0;H<B;H++){for(var D=-h+H*S,U=[],P=0;P<q;P++){var p=-w+P*I;if(D>-s&&D<s&&p>-y&&p<y)U.push(-1),m++;else{for(var V=null,M=0;M<A.length;M+=3)if(D==A[M]&&
p==A[M+1]){V=A[M+2];break}M=null!==V?V:g+1;f(H,P)?(U.push(-2),m++):(null==V&&(0==P||P==q-1||0==H||H==B-1?(V=u==a-1?S:2*S,v.push(D,p,M)):V=S,c.push(D,V,p),g++),U.push(M));if(H&&P)if(1==H)if(f(H-1,P)){if(1<P){var p=M-1,V=K[H-1][P+1],Q=V-1;b.push(M,p,Q)}else V=K[H-1][P+1],Q=V-1;b.push(M,Q,V)}else f(H,P)||(p=M-1,V=K[H-1][P],b.push(M,p,V));else if(H==B-1){if(!f(H,P))if(P==q-1)p=M-1,V=K[H-1][P-1],Q=K[H-2][P],b.push(M,p,V),b.push(M,V,Q);else{var p=M-1,V=K[H-1][P],Q=V-1,T=V+1;b.push(M,p,Q);b.push(M,Q,V);
b.push(M,V,T);2==P&&(T=K[H-2][P-2],b.push(p,T,Q))}}else 1==P?f(H,P-1)?(p=K[H-1][P],V=K[H-1][P-1],b.push(M,V,p)):(p=U[P-1],V=K[H-1][P],Q=K[H-2][P-1],b.push(M,p,V),b.push(p,Q,V)):P==q-1?f(H,P)||(p=U[P-1],V=K[H-1][P-1],Q=K[H-2][P],b.push(M,p,V),b.push(M,V,Q)):-1!=K[H-1][P]&&-1!=K[H-1][P-1]&&-1!=U[P-1]?(p=U[P-1],V=K[H-1][P],Q=K[H-1][P-1],b.push(M,p,V),b.push(p,Q,V),P==q-2&&f(H,P+1)&&(T=K[H-1][P+1],b.push(M,V,T))):P==q-2&&f(H,P+1)&&(V=K[H-1][P],T=K[H-1][P+1],b.push(M,V,T))}}K.push(U)}A=v;s=h;y=w;h*=2;
w*=2}2E4>s&&(a=-(2*s)/(B-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-s,a,-y),c.push(-s,a,y),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(s,a,-y),c.push(s,a,y),M=g+1,b.push(M+3,M+2,M+1,M+2,M+0,M+1,M+6,M+4,M+2,M+4,M+0,M+2,M+5,M+7,M+1,M+7,M+3,M+1,M+5,M+4,M+7,M+7,M+4,M+6));a=e.hd();a.a_position=new Float32Array(c);h=e.mb("multigrid_plane");h.r[0]=a;h.Y=new Uint32Array(b);h.C=c.length/3;k.Vj&&(l.lm(h,1,!0),a.a_polyindex=l.ro(h));return h};a.vA=function(a){var c=a.length;if(c%3)throw"Wrong array";
for(var f=[],h=[],k=0;k<c;k+=3){var l=a[k+1],B=a[k+2];b(a[k],h);b(l,h);b(B,h);f.push(k,k+1,k+2)}a=e.hd();a.a_position=new Float32Array(h);c=e.mb("FROM_TRIANGLES");c.r[0]=a;c.Y=new Uint32Array(f);c.C=h.length/3;return c};a.uA=c;a.pv=function(a){a=e.cz(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.qv=function(){var a=e.mb("BILLBOARD"),
b=e.hd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,1,2,3]);a.C=4;return a};a.Da=function(){var a=e.mb("BILLBOARD"),b=e.hd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,0,3,2]);a.C=4;return a};a.mv=function(){var a=e.mb("CUBEMAP_BOARD"),b=e.hd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,0,3,2]);a.C=4;return a};a.Do=function(a,c){var h=e.mb("UV_SPHERE"),
k,t,w=[],B=[],q=[];for(t=0;8>=t;t++)for(k=0;16>=k;k++){var s=k/16,y=t/8;B.push(-a*Math.cos(2*s*Math.PI)*Math.sin(y*Math.PI)+c[0],a*Math.cos(y*Math.PI)+c[1],a*Math.sin(2*s*Math.PI)*Math.sin(y*Math.PI)+c[2])}for(t=s=0;8>t;t++)for(k=0;16>k;k++){var y=f(B,17*t+k+1),g=f(B,17*t+k),A=f(B,17*(t+1)+k),u=f(B,17*(t+1)+k+1);Math.abs(y[1])==a+c[1]?(b(y,w),b(A,w),b(u,w),q.push(s,s+1,s+2),s+=3):Math.abs(A[1])==a+c[1]?(b(y,w),b(g,w),b(A,w),q.push(s,s+1,s+2),s+=3):(b(y,w),b(g,w),b(A,w),b(u,w),q.push(s,s+1,s+2),q.push(s,
s+2,s+3),s+=4)}k={};k.a_position=w;B=l.wn(q,B,w);k.a_normal=l.un(q,w,B);k.a_tangent=[];h.A.a_influence=[];h.A.a_color=[];h.A.a_texcoord=[];h.r[0]=k;h.Y=q;h.C=w.length/3;return h}};
b4w.module.__prerender=function(a,p){var h=p("__config"),c=p("__debug"),f=p("__geometry"),b=p("__util"),l=p("vec3"),e=h.n,k="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Pl=function(a){if(-1<k.indexOf(a.type)){for(var h=!1,x=a.l,n=0;n<x.length;n++){var t=x[n],w=t,B=a,q=w.Va,s=B.h;w.R=!0;q.is_visible=!1;if(q)if(q.qh)w.R=!1;else{var y=s.Sd,g=q.kb.t,A=q.Zd,y=Math.sqrt((g[0]-y[0])*(g[0]-y[0])+(g[1]-y[1])*(g[1]-y[1])+
(g[2]-y[2])*(g[2]-y[2])),g=q.gf*q.kb.ma;y>=q.yh&&y<A+g?(q.is_visible=!0,"GLOW_MASK"!=B.type||Boolean(w.k.Zf)?(s=s.Yk,q.Qf?q=!1:"STATIC"===q.type?(A=q.kb,q=A.t,q=b.ey(q,s,A.ma)):(A=q.Fe,q=A.t,q=b.Ru(q,s,A.Be,A.Ce,A.De)),q?w.R=!1:"WIREFRAME"==B.type&&(w.R=w.k.wireframe_mode==c.Qm.WM_DEBUG_SPHERES?w.k.Lk:!w.k.Lk)):w.R=!1):w.R=!1}else w.R=!1;t.R&&(h=!0)}switch(a.type){case "WIREFRAME":break;default:a.R="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||h?!0:!1}}if("MAIN_BLEND"==a.type&&(h=a.h.Sd,l.dist(h,a.ur)>
e.alpha_sort_threshold&&e.alpha_sort&&a.l)){for(x=0;x<a.l.length;x++)t=a.l[x],w=t.k,n=t.Va.H,w&&w.qa&&w.Ed!=f.Zc&&(w=w.bb)&&t.R&&(t=w.Ui)&&t.type==f.Rm&&f.Gy(w,n,h);a.ur.set(h)}}};
b4w.module.__print=function(a){var p=!1,h=0,c=0;a.Ox=function(a){p=a};a.log=function(){p&&console.log.apply(console,arguments)};a.error=function(){h++;console.error.apply(console,arguments)};a.warn=function(){c++;console.warn.apply(console,arguments)};a.time=function(){p&&console.time.apply(console,arguments)};a.timeEnd=function(){p&&console.timeEnd.apply(console,arguments)};a.group=function(){p&&console.group.apply(console,arguments)};a.groupCollapsed=function(){p&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){p&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Xv=function(){return c};a.Lv=function(){return h};a.clear_errors_warnings=function(){h=c=0}};b4w.module.print=b4w.module.__print;
b4w.module.__reformer=function(a,p){function h(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",c("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",c("node material",a,"specular_shader")),"specular_hardness"in a||(a.specular_hardness=50,c("node material",a,"specular_hardness")),"specular_slope"in a||(a.specular_slope=.1,c("node material",a,"specular_slope")),"specular_toon_size"in a||(a.specular_toon_size=
.5,c("node material",a,"specular_toon_size")),"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,c("node material",a,"specular_toon_smooth")),"specular_intensity"in a||(a.specular_intensity=.5,c("node material",a,"specular_intensity")),"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",c("node material",a,"diffuse_shader")),"roughness"in a||(a.roughness=.5,c("node material",a,"roughness")),"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,c("node material",a,"diffuse_fresnel")),"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,c("node material",a,"diffuse_fresnel_factor"))}}function c(a,b,c){c=c+">>"+a;c in w||(w[c]={km:[],mq:"undefined",type:a});w[c].km.push(b.name)}function f(a,b){param_id in w||(w[param_id]={km:[],mq:"deprecated",type:a});w[param_id].km.push(b.name)}function b(a,b){b||(b=a.name+"_COPY");var c=a.materials,e=a.submeshes;a.materials=null;a.submeshes=null;var g=d.Ie(a);a.materials=c;a.submeshes=e;g.name=b;g.materials=a.materials.slice(0);g.submeshes=[];for(c=0;c<e.length;c++){var f=
d.Zg(e[c]);g.submeshes.push(f)}return g}var l=p("__boundings"),e=p("__curve"),k=p("__print"),d=p("__util"),r=p("vec3"),x=p("vec4"),n=p("quat"),t=p("mat4"),w={};a.Gt=function(a){w={};var b=a.worlds;if(0==b.length){k.warn("WARNING Datablock world is missing, reexport scene");var e={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};b.push(e)}for(var b=a.worlds,
l=0;l<b.length;l++){var e=b[l],g=e.b4w_shadow_settings;"csm_resolution"in g||(c("world",e,"b4w_shadow_settings.csm_resolution"),g.csm_resolution=2048);"self_shadow_polygon_offset"in g||(c("world",e,"b4w_shadow_settings.self_shadow_polygon_offset"),g.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in g||(c("world",e,"b4w_shadow_settings.self_shadow_normal_offset"),g.self_shadow_normal_offset=.01);"b4w_enable_csm"in g||(c("world",e,"b4w_shadow_settings.b4w_enable_csm"),g.b4w_enable_csm=!1);
"csm_num"in g||(c("world",e,"b4w_shadow_settings.csm_num"),g.csm_num=1);"csm_first_cascade_border"in g||(c("world",e,"b4w_shadow_settings.csm_first_cascade_border"),g.csm_first_cascade_border=10);"first_cascade_blur_radius"in g||(c("world",e,"b4w_shadow_settings.first_cascade_blur_radius"),g.first_cascade_blur_radius=3);"csm_last_cascade_border"in g||(c("world",e,"b4w_shadow_settings.csm_last_cascade_border"),g.csm_last_cascade_border=100);"last_cascade_blur_radius"in g||(c("world",e,"b4w_shadow_settings.last_cascade_blur_radius"),
g.last_cascade_blur_radius=1.5);"fade_last_cascade"in g||(c("world",e,"b4w_shadow_settings.fade_last_cascade"),g.fade_last_cascade=!0);"blend_between_cascades"in g||(c("world",e,"b4w_shadow_settings.blend_between_cascades"),g.blend_between_cascades=!0);g=e.b4w_ssao_settings;"dist_factor"in g||(c("world",e,"b4w_ssao_settings.dist_factor"),g.dist_factor=0,g.samples=16);"hemisphere"in g||(c("world",e,"b4w_ssao_settings.hemisphere"),g.hemisphere=!1);"blur_depth"in g||(c("world",e,"b4w_ssao_settings.blur_depth"),
g.blur_depth=!1);"blur_discard_value"in g||(c("world",e,"b4w_ssao_settings.blur_discard_value"),g.blur_discard_value=1);"b4w_glow_color"in e||(e.b4w_glow_color=[1,1,1],c("object",e,"b4w_glow_color"));"b4w_glow_factor"in e||(e.b4w_glow_factor=1,c("object",e,"b4w_glow_factor"));"b4w_fog_density"in e||(c("world",e,"b4w_fog_density"),e.b4w_fog_density=0);"b4w_sky_settings"in e&&"rayleigh_brightness"in e.b4w_sky_settings||(c("world",e,"rayleigh_brightness"),e.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in e?("blur"in e.b4w_bloom_settings||(c("world",e,"b4w_bloom_settings.blur"),e.b4w_bloom_settings.blur=4),"edge_lum"in e.b4w_bloom_settings||(c("world",e,"b4w_bloom_settings.edge_lum"),e.b4w_bloom_settings.edge_lum=1)):(c("world",e,"b4w_bloom_settings"),e.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in e?("motion_blur_factor"in e.b4w_motion_blur_settings||(c("world",e,"b4w_motion_blur_settings.motion_blur_factor"),e.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in e.b4w_motion_blur_settings||(c("world",e,"b4w_motion_blur_settings.motion_blur_decay_threshold"),e.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(c("world",e,"b4w_motion_blur_settings"),e.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in e||(c("world",e,"b4w_color_correction_settings"),e.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in e.b4w_god_rays_settings||(c("world",e,"b4w_god_rays_settings.steps_per_pass"),e.b4w_god_rays_settings.steps_per_pass=10)}b=a.scenes;for(l=0;l<b.length;l++)e=b[l],"b4w_use_nla"in e||(e.b4w_use_nla=!1,c("scene",e,"b4w_use_nla")),"fps"in e||(e.fps=24,c("scene",e,"fps")),"b4w_nla_cyclic"in e||(e.b4w_nla_cyclic=!1,c("scene",
e,"b4w_nla_cyclic")),"b4w_nla_script"in e||(e.b4w_nla_script=[],c("scene",e,"b4w_nla_script")),"b4w_detect_collisions"in e&&(f("scene",e),delete e.b4w_detect_collisions),"audio_doppler_speed"in e||(e.audio_doppler_speed=343.3),"audio_doppler_factor"in e||(e.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in e||(e.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},c("scene",e,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in e||(e.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in e||(e.b4w_enable_bloom=!1,c("scene",e,"b4w_enable_bloom")),"b4w_enable_motion_blur"in e||(e.b4w_enable_motion_blur=!1,c("scene",e,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in e||(e.b4w_enable_color_correction=!1,c("scene",e,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in e||(e.b4w_enable_antialiasing=!0,c("scene",e,"b4w_enable_antialiasing"));e=a.meshes;for(l=0;l<e.length;l++)for(g=e[l],g.b4w_bounding_box||(c("mesh",g,"b4w_bounding_box"),g.b4w_bounding_box=
{max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),g.uv_textures||(c("mesh",g,"uv_textures"),g.uv_textures=[]),g.b4w_bounding_sphere_center||(g.b4w_bounding_sphere_center=[0,0,0]),g.b4w_bounding_cylinder_center||(g.b4w_bounding_cylinder_center=[0,0,0]),g.b4w_bounding_ellipsoid_center||(g.b4w_bounding_ellipsoid_center=[0,0,0]),g.b4w_bounding_ellipsoid_axes||(b=g.b4w_bounding_box,g.b4w_bounding_ellipsoid_axes=[(b.max_x-b.min_x)/2,(b.max_y-b.min_y)/2,(b.max_z-b.min_z)/2]),b=0;b<g.b4w_vertex_anim.length;b++){var n=
g.b4w_vertex_anim[b];"allow_nla"in n||(c('mesh["b4w_vertex_anim"]',g,"allow_nla"),n.allow_nla=!0)}b=a.cameras;for(l=0;l<b.length;l++)e=b[l],e.type||(e.type="PERSP",c("camera",e,"type")),"b4w_eye_target_dist"in e&&(delete e.b4w_eye_target_dist,f("camera",e)),"b4w_trans_velocity"in e||(e.b4w_trans_velocity=1,c("camera",e,"b4w_trans_velocity")),"b4w_rot_velocity"in e||(e.b4w_rot_velocity=1,c("camera",e,"b4w_rot_velocity")),"b4w_zoom_velocity"in e||(e.b4w_zoom_velocity=.1,c("camera",e,"b4w_zoom_velocity")),
"b4w_use_distance_limits"in e||(e.b4w_use_distance_limits=!1,c("camera",e,"b4w_use_distance_limits")),"b4w_distance_min"in e||(e.b4w_distance_min=1,c("camera",e,"b4w_distance_min")),"b4w_distance_max"in e||(e.b4w_distance_max=100,c("camera",e,"b4w_distance_max")),"b4w_horizontal_translation_min"in e||(e.b4w_horizontal_translation_min=-100,c("camera",e,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in e||(e.b4w_horizontal_translation_max=100,c("camera",e,"b4w_horizontal_translation_max")),
"b4w_vertical_translation_min"in e||(e.b4w_vertical_translation_min=-100,c("camera",e,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in e||(e.b4w_vertical_translation_max=100,c("camera",e,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in e||(e.b4w_use_horizontal_clamping=!1,c("camera",e,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in e||(e.b4w_rotation_left_limit=-Math.PI,c("camera",e,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in e||(e.b4w_rotation_right_limit=
Math.PI,c("camera",e,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in e||(e.b4w_horizontal_clamping_type="LOCAL",c("camera",e,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in e||(e.b4w_use_vertical_clamping=!1,c("camera",e,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in e||(e.b4w_rotation_down_limit=-Math.PI/2,c("camera",e,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in e||(e.b4w_rotation_up_limit=Math.PI/2,c("camera",e,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in
e||(e.b4w_vertical_clamping_type="LOCAL",c("camera",e,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in e||(e.b4w_hover_angle_min=Math.PI/6,c("camera",e,"b4w_hover_angle_min")),"b4w_hover_angle_max"in e||(e.b4w_hover_angle_max=Math.PI/6,c("camera",e,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in e||(e.b4w_enable_hover_hor_rotation=!0,c("camera",e,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in e||(e.b4w_use_panning=!0,c("camera",e,"b4w_use_panning"));b=a.lamps;for(l=0;l<b.length;l++)e=
b[l],"b4w_generate_shadows"in e||(e.b4w_generate_shadows=!1,c("lamp",e,"b4w_generate_shadows")),"b4w_dynamic_intensity"in e||(e.b4w_dynamic_intensity=!1,c("lamp",e,"b4w_dynamic_intensity")),"use_diffuse"in e||(e.use_diffuse=!0,c("lamp",e,"use_diffuse")),"use_specular"in e||(e.use_specular=!0,c("lamp",e,"use_specular"));b=a.speakers;for(l=0;l<b.length;l++)e=b[l],"b4w_behavior"in e||(e.b4w_behavior=e.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in e||(e.b4w_disable_doppler=
!1),"b4w_delay"in e||(e.b4w_delay=0),"b4w_delay_random"in e||(e.b4w_delay_random=0),"b4w_volume_random"in e||(e.b4w_volume_random=0),"b4w_pitch_random"in e||(e.b4w_pitch_random=0),"b4w_fade_in"in e||(e.b4w_fade_in=0),"b4w_fade_out"in e||(e.b4w_fade_out=0),"b4w_loop"in e||(e.b4w_loop=!1),"b4w_loop_count"in e||(e.b4w_loop_count=0),"b4w_loop_count_random"in e||(e.b4w_loop_count_random=0),"b4w_playlist_id"in e||(e.b4w_playlist_id="");b=a.textures;for(l=0;l<b.length;l++)e=b[l],"b4w_anisotropic_filtering"in
e||(e.b4w_anisotropic_filtering="OFF",c("texture",e,"b4w_anisotropic_filtering")),"b4w_water_foam"in e||(e.b4w_water_foam=!1,c("texture",e,"b4w_water_foam")),"b4w_foam_uv_freq"in e||(e.b4w_foam_uv_freq=[1,1],c("texture",e,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in e||(e.b4w_foam_uv_magnitude=[1,1],c("texture",e,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in e||(e.b4w_parallax_steps=5,c("material",e,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in e||(e.b4w_parallax_lod_dist=10,c("material",
e,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in e||(e.b4w_shore_dist_map=!1,c("texture",e,"b4w_shore_dist_map")),"b4w_shore_boundings"in e||(e.b4w_shore_boundings=new Float32Array(4),e.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],c("texture",e,"b4w_shore_boundings")),"b4w_max_shore_dist"in e||(e.b4w_max_shore_dist=100,c("texture",e,"b4w_max_shore_dist")),"b4w_disable_compression"in e||(e.b4w_disable_compression=!1,c("texture",e,"b4w_disable_compression")),"b4w_source_type"in e||(e.b4w_source_type="",
c("texture",e,"b4w_source_type")),"b4w_source_id"in e||(e.b4w_source_id="",c("texture",e,"b4w_source_id")),"b4w_source_size"in e||(e.b4w_source_size=1024,c("texture",e,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in e||(e.b4w_enable_canvas_mipmapping=!0,c("texture",e,"b4w_enable_canvas_mipmapping"));e=a.materials;for(l=0;l<e.length;l++){g=e[l];"b4w_node_mat_type"in g&&f("material",g);"b4w_skydome"in g&&f("material",g);"b4w_procedural_skydome"in g&&f("material",g);g.b4w_water&&("b4w_water_shore_smoothing"in
g||(g.b4w_water_shore_smoothing=!1,c("material",g,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in g||(g.b4w_water_dynamic=!1,c("material",g,"b4w_water_dynamic")),"b4w_waves_height"in g||(g.b4w_waves_height=1,c("material",g,"b4w_waves_height")),"b4w_waves_length"in g||(g.b4w_waves_length=1,c("material",g,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in g||(g.b4w_water_dst_noise_scale0=.05,c("material",g,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in g||(g.b4w_water_dst_noise_scale1=
.03,c("material",g,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in g||(g.b4w_water_dst_noise_freq0=1.3,c("material",g,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in g||(g.b4w_water_dst_noise_freq1=1,c("material",g,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in g||(g.b4w_water_dir_min_shore_fac=.4,c("material",g,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in g||(g.b4w_water_dir_freq=.5,c("material",g,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in
g||(g.b4w_water_dir_noise_scale=.05,c("material",g,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in g||(g.b4w_water_dir_noise_freq=.07,c("material",g,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in g||(g.b4w_water_dir_min_noise_fac=.5,c("material",g,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in g||(g.b4w_water_dst_min_fac=.2,c("material",g,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in g||(g.b4w_water_waves_hor_fac=5,c("material",g,"b4w_water_waves_hor_fac")),
"b4w_water_absorb_factor"in g||(g.b4w_water_absorb_factor=6,c("material",g,"b4w_water_absorb_factor")),"b4w_water_fog_color"in g||(g.b4w_water_fog_color=new Float32Array(3),g.b4w_water_fog_color=[.5,.7,.7],c("material",g,"b4w_water_fog_color")),"b4w_foam_factor"in g||(g.b4w_foam_factor=5,c("material",g,"b4w_foam_factor")),"b4w_generated_mesh"in g||(g.b4w_generated_mesh=!1,c("material",g,"b4w_generated_mesh")),"b4w_water_num_cascads"in g||(g.b4w_water_num_cascads=5,c("material",g,"b4w_water_num_cascads")),
"b4w_water_subdivs"in g||(g.b4w_water_subdivs=64,c("material",g,"b4w_water_subdivs")),"b4w_water_detailed_dist"in g||(g.b4w_water_detailed_dist=1E3,c("material",g,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in g||(g.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in g||(g.b4w_dynamic_grass_color="");"diffuse_intensity"in g||(g.diffuse_intensity=1,c("material",g,"diffuse_intensity"));"b4w_use_ghost"in g||(g.b4w_use_ghost=!1);"b4w_collision_group"in g||(g.b4w_collision_group=128,c("material",
g,"b4w_collision_group"));"b4w_collision_mask"in g||(g.b4w_collision_mask=127,c("material",g,"b4w_collision_mask"));"HALO"!=g.type||"b4w_halo_sky_stars"in g||(g.b4w_halo_sky_stars=!1,c("material",g,"b4w_halo_sky_stars"));"HALO"!=g.type||"b4w_halo_stars_blend_height"in g||(g.b4w_halo_stars_blend_height=10,c("material",g,"b4w_halo_stars_blend_height"));"HALO"!=g.type||"b4w_halo_stars_min_height"in g||(g.b4w_halo_stars_min_height=0,c("material",g,"b4w_halo_stars_min_height"));"specular_shader"in g||
(g.specular_shader="COOKTORR",c("material",g,"specular_shader"));"diffuse_shader"in g||(g.diffuse_shader="LAMBERT",c("material",g,"diffuse_shader"));"roughness"in g||(g.roughness=.5,c("material",g,"roughness"));"diffuse_fresnel"in g||(g.diffuse_fresnel=.1,c("material",g,"diffuse_fresnel"));"diffuse_fresnel_factor"in g||(g.diffuse_fresnel_factor=.5,c("material",g,"diffuse_fresnel_factor"));"specular_slope"in g||(g.specular_slope=.2,c("material",g,"specular_slope"));"specular_toon_size"in g||(g.specular_toon_size=
.5,c("material",g,"specular_toon_size"));"specular_toon_smooth"in g||(g.specular_toon_smooth=.1,c("material",g,"specular_toon_smooth"));"specular_alpha"in g||(g.specular_alpha=1,c("material",g,"specular_alpha"));"b4w_wettable"in g||(g.b4w_wettable=!1,c("material",g,"b4w_wettable"));"b4w_refractive"in g||(g.b4w_refractive=!1,c("material",g,"b4w_refractive"));"b4w_refr_bump"in g||(g.b4w_refr_bump=0,c("material",g,"b4w_refr_bump"));"b4w_shallow_water_col"in g||(g.b4w_shallow_water_col=[0,.8,.3],c("material",
g,"b4w_shallow_water_col"));"b4w_shore_water_col"in g||(g.b4w_shore_water_col=[0,.9,.2],c("material",g,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in g||(g.b4w_shallow_water_col_fac=1,c("material",g,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in g||(g.b4w_shore_water_col_fac=.5,c("material",g,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in g||(g.b4w_water_sss_strength=5.9,c("material",g,"b4w_water_sss_strength"));"b4w_water_sss_width"in g||(g.b4w_water_sss_width=.45,c("material",
g,"b4w_water_sss_width"));"b4w_render_above_all"in g||(g.b4w_render_above_all=!1,c("material",g,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in g||(g.b4w_water_norm_uv_velocity=.05,c("material",g,"b4w_water_norm_uv_velocity"));n=g.texture_slots;for(b=0;b<n.length;b++){var u=n[b];"blend_type"in u||(u.blend_type="MIX",c("texture_slot",u,"blend_type"))}if(g.node_tree)for(g=g.node_tree.nodes,b=0;b<g.length;b++)h(g[b])}e=a.node_groups;for(l=0;l<e.length;l++)for(g=e[l].node_tree.nodes,b=0;b<g.length;b++)h(g[b]);
e=a.objects;for(l=0;l<e.length;l++){g=e[l];switch(g.type){case "MESH":"b4w_dynamic_geometry"in g||(g.b4w_dynamic_geometry=!1);"b4w_reflexible"in g||(g.b4w_reflexible=!1);"b4w_reflexible_only"in g||(g.b4w_reflexible_only=!1);"b4w_reflective"in g||(g.b4w_reflective=!1);"b4w_wind_bending"in g||(g.b4w_wind_bending=!1,c("object",g,"b4w_wind_bending"));"b4w_wind_bending_angle"in g||(g.b4w_wind_bending_angle=10,g.b4w_wind_bending_freq=.25,c("object",g,"wind bending params"));"b4w_detail_bending_amp"in g||
(g.b4w_detail_bending_amp=.1,g.b4w_branch_bending_amp=.3,c("object",g,"detail bending params"));"b4w_detail_bending_freq"in g||(g.b4w_detail_bending_freq=1,c("object",g,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in g||(g.b4w_main_bend_stiffness_col="",c("object",g,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in g||(g.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},c("object",g,"b4w_detail_bend_colors"));"b4w_caustics"in g||(g.b4w_caustics=
!1);"vertex_groups"in g&&g.vertex_groups.length&&g.data&&0==g.data.vertex_groups.length&&(g.data.vertex_groups=g.vertex_groups,delete g.vertex_groups,c("object",g,"vertex_groups"));"b4w_vertex_anim"in g&&g.b4w_vertex_anim.length&&g.data&&0==g.data.b4w_vertex_anim.length&&(g.data.b4w_vertex_anim=g.b4w_vertex_anim,delete g.b4w_vertex_anim,c("object",g,"b4w_vertex_anim"));"b4w_do_not_render"in g||(g.b4w_do_not_render=!1);"use_ghost"in g.game||(g.game.use_ghost=!1);"use_sleep"in g.game||(g.game.use_sleep=
!1);"velocity_min"in g.game||(g.game.velocity_min=0);"velocity_max"in g.game||(g.game.velocity_max=0);"collision_group"in g.game||(g.game.collision_group=1);"collision_mask"in g.game||(g.game.collision_mask=255);"b4w_vehicle_settings"in g?g.b4w_vehicle_settings&&("steering_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_ratio=10),"steering_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_max=1),"inverse_control"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.inverse_control=
!1),"force_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.force_max=1500),"brake_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.brake_max=100),"speed_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in g.b4w_vehicle_settings||
(g.b4w_vehicle_settings.floating_factor=3),"floating_factor"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_rot_damp=.9)):(g.b4w_vehicle_settings=null,c("object",g,"b4w_vehicle_settings"));"b4w_floating_settings"in g?g.b4w_floating_settings&&("floating_factor"in g.b4w_floating_settings||(g.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_rot_damp=.8)):(g.b4w_floating_settings=null,c("object",g,"b4w_floating_settings"));"b4w_character_settings"in g?g.b4w_character_settings&&("walk_speed"in g.b4w_character_settings||(g.b4w_character_settings.walk_speed=4),"run_speed"in g.b4w_character_settings||(g.b4w_character_settings.run_speed=8),"step_height"in g.b4w_character_settings||
(g.b4w_character_settings.step_height=.25),"jump_strength"in g.b4w_character_settings||(g.b4w_character_settings.jump_strength=5),"waterline"in g.b4w_character_settings||(g.b4w_character_settings.waterline=0)):(g.b4w_character_settings=null,c("object",g,"b4w_character_settings"));"b4w_selectable"in g||(g.b4w_selectable=!1,c("object",g,"b4w_selectable"));"b4w_billboard"in g||(g.b4w_billboard=!1,c("object",g,"b4w_billboard"));"b4w_billboard_geometry"in g||(g.b4w_billboard_geometry="SPHERICAL",c("object",
g,"b4w_billboard_geometry"));"b4w_glow_settings"in g||(g.b4w_glow_settings={},g.b4w_glow_settings.glow_duration=1,g.b4w_glow_settings.glow_period=1,g.b4w_glow_settings.glow_relapses=0,c("object",g,"b4w_glow_settings"));"b4w_lod_transition"in g||(g.b4w_lod_transition=.01,c("object",g,"b4w_lod_transition"));"lod_levels"in g||(g.lod_levels=[],c("object",g,"lod_levels"));"b4w_animation_mixing"in g||(g.b4w_animation_mixing=!1,c("object",g,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in
g||(g.b4w_group_relative=!1,c("object",g,"b4w_group_relative"))}"b4w_anim_behavior"in g||(g.b4w_anim_behavior=g.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",c("object",g,"b4w_anim_behavior"));if(!("rotation_quaternion"in g)){b=[0,0,0,1];d.euler_to_quat(g.rotation_euler,b);var n=b,u=b[0],r=b[1],t=b[2];n[0]=b[3];n[1]=u;n[2]=r;n[3]=t;g.rotation_quaternion=b;c("object",g,"rotation_quaternion")}"webgl_do_not_batch"in g&&(g.b4w_do_not_batch=g.webgl_do_not_batch)&&f("object",g);"b4w_shadow_cast_only"in g||
(g.b4w_shadow_cast_only=!1,c("object",g,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in g||(g.b4w_correct_bounding_offset="AUTO",c("object",g,"b4w_correct_bounding_offset"));n=g.particle_systems;for(b=0;b<n.length;b++)u=n[b],r=u.settings,"use_whole_group"in r||(r.use_whole_group=!1,c("object",r,"use_whole_group")),u.transforms||(u.transforms=new Float32Array,c("particle_system",u,"transforms")),"b4w_billboard_align"in r||(r.b4w_billboard_align="VIEW",c("particle_settings",r,"b4w_billboard_align")),
"b4w_dynamic_grass"in r||(r.b4w_dynamic_grass=!1,c("object",r,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in r||(r.b4w_dynamic_grass_scale_threshold=.01,c("object",r,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in r||(r.b4w_initial_rand_rotation=!1,c("particle_settings",r,"b4w_initial_rand_rotation")),"b4w_rotation_type"in r||(r.b4w_rotation_type="Z",c("particle_settings",r,"b4w_rotation_type")),"b4w_rand_rotation_strength"in r||(r.b4w_rand_rotation_strength=1,c("particle_settings",
r,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in r||(r.b4w_hair_billboard=!1,c("particle_settings",r,"b4w_hair_billboard")),"b4w_hair_billboard_type"in r||(r.b4w_hair_billboard_type="BASIC",c("particle_settings",r,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in r||(r.b4w_hair_billboard_jitter_amp=0,c("particle_settings",r,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in r||(r.b4w_hair_billboard_jitter_freq=0,c("particle_settings",r,"b4w_hair_billboard_jitter_freq")),
"b4w_hair_billboard_geometry"in r||(r.b4w_hair_billboard_geometry="SPHERICAL",c("particle_settings",r,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in r||(r.b4w_wind_bend_inheritance="PARENT",c("particle_settings",r,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in r||(r.b4w_shadow_inheritance="PARENT",c("particle_settings",r,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in r||(r.b4w_reflection_inheritance="PARENT",c("particle_settings",r,"b4w_reflection_inheritance")),
"b4w_vcol_from_name"in r||(r.b4w_vcol_from_name="",c("particle_settings",r,"b4w_vcol_from_name")),"b4w_vcol_to_name"in r||(r.b4w_vcol_to_name="",c("particle_settings",r,"b4w_vcol_to_name")),"b4w_coordinate_system"in r||(r.b4w_coordinate_system="LOCAL",c("particle_settings",r,"b4w_coordinate_system")),"b4w_allow_nla"in r||(r.b4w_allow_nla=!0,c("particle_settings",r,"b4w_allow_nla"));"constraints"in g||(g.constraints=[],c("object",g,"constraints"));n=g.modifiers;for(b=0;b<n.length;b++){a:{u=n[b];switch(u.type){case "ARRAY":if(!("fit_type"in
u)){k.error("WARNING Incomplete modifier "+String(u.type)+' for "'+g.name+'", reexport '+(g.library?"library"+g.library.split("/").slice(-1)[0]:"main scene"));u=!1;break a}}u=!0}u||(n.splice(b,1),b--)}"animation_data"in g||(g.animation_data={action:null,nla_tracks:[]},c("object",g,"animation_data"));if(g.animation_data)for(("action"in g.animation_data)||(g.animation_data.action=null,k.warn("B4W Warning: no action in animation data "+g.name)),("nla_tracks"in g.animation_data)||(g.animation_data.nla_tracks=
[],k.warn("B4W Warning: no NLA in animation data "+g.name)),n=g.animation_data.nla_tracks,b=0;b<n.length;b++)for(u=n[b],r=0;r<u.strips.length;r++)t=u.strips[r],"action"in t||(t.action=null,k.warn("B4W Warning: no action in NLA strip "+g.name)),"action_frame_start"in t||(t.action_frame_start=0,k.warn("B4W Warning: no action_frame_start in NLA strip "+g.name)),"action_frame_end"in t||(t.action_frame_end=t.frame_end-t.frame_start,k.warn("B4W Warning: no action_frame_start in NLA strip "+g.name));"b4w_collision_id"in
g||(g.b4w_collision_id="",c("material",g,"b4w_collision_id"));b=g.scale;n=Math.abs((b[1]-b[2])/b[1]);.001>Math.abs((b[0]-b[1])/b[0])&&.001>n||k.warn("B4W Warning: non-uniform scale for object "+g.name)}for(var v in w)l=w[v],b=v.match(/.*?(?=>>|$)/i)[0],k.warn("WARNING "+String(b)+" is "+l.mq+" for "+l.type+", reexport "+a.b4w_filepath_blend)};a.it=function(a){var c;a:{c=a.modifiers;for(var f=0;f<c.length;f++){var h=c[f].type;if("ARRAY"==h||"CURVE"==h){c=!0;break a}}c=!1}if(!c)return null;c=b(a.data,
a.data.name+"_MOD");a=a.modifiers;for(f=0;f<a.length;f++){var g=a[f];switch(g.type){case "ARRAY":for(var h=c,k=g,u=0,w=0,I=0,v=new Float32Array(16),g=[],K=1;K<k.count;K++){k.use_constant_offset&&(u+=k.constant_offset_displace[0],w+=k.constant_offset_displace[1],I+=k.constant_offset_displace[2]);if(k.use_relative_offset)var m=h.b4w_bounding_box,u=u+(m.max_x-m.min_x)*k.relative_offset_displace[0],w=w+(m.max_y-m.min_y)*k.relative_offset_displace[1],I=I+(m.max_z-m.min_z)*k.relative_offset_displace[2];
d.Ay(u,w,I,v);for(var H=m=b(h),D=v,U=0;U<H.submeshes.length;U++){var P=H.submeshes[U];d.ce(P.position,D,P.position,0);d.dz(P.normal,D,P.normal);d.xy(P.tangent,D,P.tangent)}g.push(m)}for(K=0;K<g.length;K++)for(k=h,u=g[K],w=0;w<k.submeshes.length;w++){I=k.submeshes[w];v=u.submeshes[w];m=I.base_length;H=I.indices.length;I.base_length+=v.base_length;for(var p in I)if("base_length"!=p)if("indices"==p)for(I[p]=d.Dy(I[p],v[p]),D=H;D<I.indices.length;D++)I.indices[D]+=m;else I[p]=d.dv(I[p],v[p])}break;case "CURVE":for(var h=
c,K=g.object.Os,k=new Float32Array(16),w=K.Xd?4:3,u=new Float32Array(w),w=new Float32Array(w),I=new Float32Array(3),v=new Float32Array(4),m=new Float32Array(4),H=new Float32Array(3),D=new Float32Array(3),U=new Float32Array(3),P=new Float32Array(4),V=new Float32Array(4),M=0;M<h.submeshes.length;M++){var Q=h.submeshes[M],T=Q.position,X=Q.normal,Q=Q.tangent,z;a:switch(z=g.deform_axis,z){case "POS_X":case "NEG_X":z=0;break a;case "POS_Y":case "NEG_Y":z=1;break a;case "POS_Z":case "NEG_Z":z=2;break a;
default:throw"Wrong deform axis value "+z;}H[0]=0;H[1]=0;H[2]=0;H[z]=1;for(var ia=e.hy(K),W=0;W<T.length/3;W++){U[0]=T[3*W];U[1]=T[3*W+1];U[2]=T[3*W+2];var L=U[z],G=e.gy(K,L);e.iy(K,G,u);I[0]=u[0];I[1]=u[1];I[2]=u[2];e.fy(K,G,w);D[0]=w[0];D[1]=0;D[2]=w[2];r.normalize(D,D);n.rotationTo(H,D,v);0>L?(u[0]=D[0],u[1]=D[1],u[2]=D[2],r.scale(u,L,u),r.add(I,u,I)):L>ia&&(u[0]=D[0],u[1]=D[1],u[2]=D[2],r.scale(u,L-ia,u),r.add(I,u,I));t.fromRotationTranslation(v,I,k);K.Xd&&(n.setAxisAngle(H,u[3],m),r.transformQuat(U,
m,U));U[z]=0;r.transformMat4(U,k,U);T[3*W]=U[0];T[3*W+1]=U[1];T[3*W+2]=U[2];X.length&&(P[0]=X[3*W],P[1]=X[3*W+1],P[2]=X[3*W+2],P[3]=0,x.transformMat4(P,k,P),X[3*W]=P[0],X[3*W+1]=P[1],X[3*W+2]=P[2]);Q.length&&(V[0]=Q[3*W],V[1]=Q[3*W+1],V[2]=Q[3*W+2],V[3]=0,x.transformMat4(V,k,V),Q[3*W]=V[0],Q[3*W+1]=V[1],Q[3*W+2]=V[2])}}}l.gx(c)}return c};a.bA=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,
fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,
b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};
b4w.module.__scenegraph=function(a,p){function h(a){a=Ha.ra(a);a.Td=null;a.cb=null;a.hc=null;return a}function c(a,c){var d=[];O.oe(a,function(b,c,e){-1<d.indexOf(e)?O.nx(a,b,c,e,l(e)):d.push(e)});O.L(a,function(b,c){for(var e=0;e<c.Z.length;e++){var E=c.Z[e];-1<d.indexOf(E)?c.Z[e]=l(E):d.push(E)}"ANTIALIASING"==c.type&&O.pe(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.Z.length;c++){var d=b.Z[c];d.ca=ba.s;d.ba=ba.s}})});O.L(a,function(d){var e={};f(a,d,e);for(var E in e){d=e[E];if(c)for(var g=
0;g<d.length;g++){var m=d[g];if("DEPTH"==m.G){if(b(m))throw"Failed to use renderbuffer as input texture: "+m.G+"->"+m.V;m.Ig=!0}}m=d[0];for(g=0;g<d.length;g++)if(d[g].ca==ba.s){m=d[g];break}for(var J=d[0],g=0;g<d.length;g++)if(d[g].ba==ba.s){J=d[g];break}for(var h=d[0],g=0;g<d.length;g++)if(!d[g].Ig){h=d[g];break}for(g=0;g<d.length;g++)d[g].ca=m.ca,d[g].ba=J.ba,d[g].Ig=h.Ig}})}function f(a,b,c){O.pe(a,b,function(b,d,e){e.xa&&e.G==e.V&&(c[e.G]=c[e.G]||[],-1==c[e.G].indexOf(e)&&c[e.G].push(e),f(a,b,
c))});O.qe(a,b,function(a,b,d){d.xa&&(c[d.G]=c[d.G]||[],-1==c[d.G].indexOf(d)&&c[d.G].push(d))});b=O.Ea(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.Z.length;d++){var e=b.Z[d];c[e.G].push(e)}}function b(a){switch(a.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function l(a){if(a.na)throw"Failed to clone slink with attached texture";return Ha.Ie(a)}function e(a){var b=O.Zq(a),c=[];O.L(b,function(a,e){switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var E=
[];break;default:E=c}for(var g=0;g<e.Z.length;g++){var m=e.Z[g],J=n(E,m,d(m));m.na=J;e.Rc[g]=J}for(g=0;g<e.Rc.length;g++)J=e.Rc[g],x(E,J);switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":E=[]}O.qe(b,a,function(c,e,g){if((c=r(b,a,g.G))&&g.xa&&!g.na){e=E;for(var m=c,J=0;J<e.length;J++){var f=e[J];f.nm===m&&f.Mh++}}else c=n(E,g,d(g));g.na=c});O.pe(b,a,function(a,b,c){x(E,c.na)});O.qe(b,a,function(a,b,c){c.na&&"NONE"==c.V&&x(E,c.na)})})}function k(a){w(a,
function(b,c,d){b.Fg&&(pa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||pa(a,d,"ANTIALIASING"))&&(b.ke*=ab.resolution_factor)})}function d(a){a=Ha.Ie(a);delete a.V;delete a.xa;return JSON.stringify(a)}function r(a,b,c){var d=null;O.pe(a,b,function(a,b,e){if(e.xa&&e.G==e.V&&e.G==c&&e.na)return d=e.na,!0});O.qe(a,b,function(a,b,e){if(e.xa&&e.G==c&&e.na)return d=e.na,!0});return d}function x(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.nm===b&&d.Mh&&d.Mh--}}function n(a,b,
c){for(var d=null,e=0;e<a.length;e++){var E=a[e];if(E.id==c&&0===E.Mh){d=E;break}}if(d)return d.Mh++,d.nm;b=t(b);a.push({id:c,Mh:1,nm:b});return b}function t(a){var b=a.ke*a.size;switch(a.G){case "COLOR":var c=ba.Gi("COLOR",ba.Hf);ba.resize(c,b,b);ba.Aj(c,a.ca,a.ba);return c;case "DEPTH":return a.Ig?(c=ba.Gi("DEPTH_RBUF",ba.Gf),ba.resize(c,b,b)):(c=ba.Gi("DEPTH_TEX",ba.Pg),ba.resize(c,b,b),ba.Aj(c,a.ca,a.ba)),c;case "CUBEMAP":return ba.au(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.G;}}function w(a,b){var c=!1;O.oe(a,function(d,e,E){if(E&&(d=O.Ea(a,d),e=O.Ea(a,e),b(E,!1,d,e)))return c=!0});c||O.L(a,function(a,c){for(var d=0;d<c.Z.length;d++)if(b(c.Z[d],!0,c,null))return!0})}function B(a){O.L(a,function(b,c){if("SINK"!=c.type){var d=c.h;O.qe(a,b,function(a,b,c){c.xa&&c.na&&(ea.zj(d,c.G,c.na),c.G==c.V&&b.h&&ea.zj(b.h,c.G,c.na))});for(var e=0;e<c.Z.length;e++){var E=c.Z[e];E.xa&&E.G==E.V&&ea.zj(d,E.G,c.Rc[e])}!d.cb&&!d.hc||d.Td||(d.Td=Ea.lq(d.cb,d.hc))}})}function q(a,b){var c=
s("SHADOW_CAST");c.Fk=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;c.h=ea.lb(ea.Rg);return c}function s(a){return{type:a,qa:!1,Wp:!1,jk:!1,ij:!1,dh:0,time:0,h:null,Yn:null,hb:null,l:[],Z:[],Rc:[],fi:new Float32Array(3),ur:new Float32Array(3),Ib:new Float32Array(3),Eb:new Float32Array(4),Ec:new Float32Array(16),Rd:0,mf:0,Aq:0,af:null,df:null,$e:null,bf:null,cf:null,ic:new Float32Array(3),nc:new Float32Array(3),Uq:new Float32Array([0,0,0]),Gj:new Float32Array(3),Vq:new Float32Array(4),
qg:null,Qi:0,Ok:0,th:!1,ph:new Float32Array(3),re:0,Ba:null,Sj:!1,he:new Float32Array(2),ie:new Float32Array(2),og:0,fg:0,tk:0,xc:null,te:0,Ef:0,se:0,Ge:!1,yn:0,zn:new Float32Array(2),xn:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,pg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,
ug:0,tg:0,sg:0,Mq:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,eg:0,vj:0,xg:0,Fk:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,jr:null,ln:null,rf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,qn:0,po:0,ej:0,fj:0,Ap:0,Jh:"",ww:new Float32Array(2),R:!0,enqueue:!0,aa:!0,fa:!0,wb:!0,ta:!0}}function y(a,b,c,d,e){return{G:a,V:b,size:c,ke:d,Fg:e,xa:!0,na:null,Ig:!1,ca:ba.oc,ba:ba.oc}}function g(){var a=s("GRASS_MAP");a.h=ea.lb(ea.Qg);return a}
function A(a){var b=s("POSTPROCESSING");b.aa=!1;b.fa=!1;b.wb=!1;b.h=ea.lb(ea.Za);b.Jh=a;return b}function u(a){var b=s("BLOOM_BLUR");b.aa=!1;b.fa=!1;b.wb=!1;b.h=ea.lb(ea.Za);b.Jh=a;return b}function S(a,b,c,d,e,E,g,m,J){var f=s("MAIN_"+a);if("OPAQUE"===a)f.aa=!0,f.fa=c,f.qa=!1;else if("BLEND"===a)f.aa=!1,f.fa=!1,f.qa=!0;else if("XRAY"===a)f.aa=!1,f.fa=!0,f.qa=!0;else if("REFLECT"===a)f.aa=!0,f.fa=!0,f.qa=!1;else throw"wrong main subscene type";f.qa&&m&&(f.self_shadow_normal_offset=m.self_shadow_normal_offset);
f.h=b;f.ic.set(g.ic);f.nc.set(g.nc);f.Rd=g.Rd;f.qg=g.qg;f.Eb=E;d&&(f.Ba=d,d.Eb&&(f.xc=new Float32Array(d.Eb)),f.te=d.waves_height,f.Ef=d.waves_length,f.se=d.se,d.Bi&&J&&(f.Ge=!0,f.yn=d.Bi,f.zn.set(d.vk),f.xn=d.uk),d.Cj&&(f.Sj=!0,a=d.Tx,f.he[0]=(a[0]+a[1])/2,f.he[1]=(a[2]+a[3])/2,f.ie[0]=a[0]-a[1],f.ie[1]=a[2]-a[3],f.og=d.og,f.fg=d.fg));f.af=new Float32Array(3*e);f.df=new Float32Array(3*e);f.$e=new Float32Array(3*e);f.bf=new Float32Array(4*e);f.cf=new Float32Array(4*e);return f}function I(a,b){var c=
s("COLOR_PICKING");b&&(c.type+="_XRAY",c.aa=!1,c.fa=!0);c.enqueue=!1;c.h=a;return c}function v(a){var b=s("WIREFRAME");b.R=!1;b.aa=!1;b.fa=!1;b.h=a;return b}function K(a,b){var c=s("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function m(a){var b=s("DEPTH_PACK");b.aa=!1;b.fa=!1;b.h=a;return b}function H(a,b,c){var d=s("SSAO");d.aa=!1;d.fa=!1;d.wb=!1;d.h=a;d.Eb=b;d.xc=new Float32Array(b);d.ug=c.radius_increase;d.ssao_hemisphere=c.iw;d.tg=c.influence;d.sg=c.dist_factor;
d.Mq=c.sx;return d}function D(a,b){var c=s("SSAO_BLUR");c.aa=!1;c.fa=!1;c.wb=!1;c.ssao_blur_depth=b.vt;c.ssao_blur_discard_value=b.pn;c.h=a;return c}function U(){var a=s("ANTIALIASING");a.aa=!1;a.fa=!1;a.wb=!1;a.h=ea.lb(ea.Za);return a}function P(a){var b=s(a);b.aa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.fa=!1;b.wb=!1;b.h=ea.lb(ea.Za);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.xw=new Float32Array(4));return b}function Z(a,b,c,d){var e=s("COMPOSITING");e.aa=!1;e.fa=!1;
e.wb=!1;e.h=ea.lb(ea.Za);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function V(a,b){var c=s("MOTION_BLUR");c.aa=!1;c.fa=!1;c.wb=!1;c.h=ea.lb(ea.Za);c.jk=!0;c.ej=a;c.fj=b;return c}function M(a){var b=s("DOF");b.aa=!1;b.fa=!1;b.wb=!1;b.h=a;return b}function Q(a){var b=s("GLOW_MASK");b.h=a;b.wb=!1;return b}function T(a){var b=s("GLOW");b.ph.set(a.ph);b.Qi=a.Qi;b.po=5;b.qn=3;b.wb=!1;b.h=ea.lb(ea.Za);return b}function X(){var a=s("REFRACT");a.aa=!1;a.fa=!1;a.wb=!1;a.h=ea.lb(ea.Za);
return a}function z(a,b,c,d,e,E,g){var m=s("GOD_RAYS");m.aa=!1;m.fa=!1;m.wb=!1;m.ic[0]=1;m.ic[1]=1;m.ic[2]=1;m.nc[0]=1;m.nc[1]=1;m.nc[2]=1;m.Rd=1;m.Wp=d;m.re=b;m.vj=e;m.eg=c;m.xg=g;m.h=a;m.mf=E;m.af=new Float32Array(3*E);m.df=new Float32Array(3*E);m.$e=new Float32Array(3*E);m.bf=new Float32Array(4*E);m.cf=new Float32Array(4*E);return m}function ia(a,b){var c=s("GOD_RAYS_COMBINE");c.aa=!1;c.fa=!1;c.wb=!1;c.h=ea.lb(ea.Za);c.god_rays_intensity=a;c.mf=b;c.af=new Float32Array(3*b);c.df=new Float32Array(3*
b);c.$e=new Float32Array(3*b);c.bf=new Float32Array(4*b);c.cf=new Float32Array(4*b);return c}function W(a,b){var c=s("SKY");c.enqueue=!1;c.aa=!1;c.fa=!1;c.wb=!1;var d=ea.lb(ea.Za);d.width=Ka.bh;d.height=Ka.bh;c.h=d;c.Yn=Ha.nv();c.mf=a;c.af=new Float32Array(3*a);c.df=new Float32Array(3*a);c.$e=new Float32Array(3*a);c.bf=new Float32Array(4*a);c.cf=new Float32Array(4*a);c.ic[0]=1;c.ic[1]=1;c.ic[2]=1;c.nc[0]=1;c.nc[1]=1;c.nc[2]=1;c.Rd=1;c.pg.set(b.pg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=
b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function L(){var a=s("SCREEN");a.aa=!1;a.fa=!1;a.h=ea.lb(ea.Za);return a}function G(){var a=s("ANAGLYPH");
a.aa=!1;a.fa=!1;a.h=ea.lb(ea.Za);return a}function fa(){var a=s("LUMINANCE");a.aa=!1;a.fa=!1;a.h=ea.lb(ea.Za);return a}function da(){var a=s("AVERAGE_LUMINANCE");a.aa=!1;a.fa=!1;a.h=ea.lb(ea.Za);return a}function C(a,b,c,d){var e=s("LUMINANCE_TRUNCED");e.aa=!1;e.fa=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.h=d;e.af=new Float32Array(3*c);e.df=new Float32Array(3*c);e.$e=new Float32Array(3*c);e.bf=new Float32Array(4*c);e.cf=new Float32Array(4*c);return e}function J(a){var b=s("BLOOM");b.aa=!1;b.fa=!1;b.h=
ea.lb(ea.Za);b.bloom_blur=a;return b}function ha(){var a=s("SINK");a.enqueue=!1;return a}function pa(a,b,c){if(b.type===c)return!0;b=E(a,b);for(var d=0;d<b.length;d++)if(pa(a,b[d],c))return!0;return!1}function la(a,b,c){if(b.type===c)return!0;b=ja(a,b);for(var d=0;d<b.length;d++)if(la(a,b[d],c))return!0;return!1}function Y(a,b,c){if(b.type===c)return b;b=ja(a,b);for(var d=0;d<b.length;d++){var e=Y(a,b[d],c);if(e)return e}return null}function ja(a,b){var c=O.Ah(a,b);if(c==O.Mm)throw"Subscene not in graph";
for(var d=[],e=O.ep(a,c),E=0;E<e;E++){var g=O.Ni(a,c,E);g!=c&&d.push(O.Ea(a,g))}return d}function E(a,b){var c=O.Ah(a,b);if(c==O.Mm)throw"Subscene not in graph";for(var d=[],e=O.ig(a,c),E=0;E<e;E++){var g=O.Yf(a,c,E);g!=c&&d.push(O.Ea(a,g))}return d}function ca(a){var b=[],c=[];w(a,function(a){a.na&&-1==b.indexOf(a.na)&&(b.push(a.na),c.push(a.na,b.length-1))});return c}function ua(a,b){var c;c=""+(a.G+"\\n");c+="NONE"!=a.V?a.V+"\\n":"";c+="(";if(a.Fg){var d=a.ke;Math.round(d)!=d&&(d=d.toFixed(2));
d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.G){c+=" ";if(a.Ig)c+="RR";else{var d=a.ca,e=a.ba,E="";d==ba.s?E+="L":d==ba.oc&&(E+="N");e==ba.s?E+="L":e==ba.oc&&(E+="N");c+=E}for(d=0;d<b.length;d+=2)b[d]==a.na&&(c+=" "+b[d+1])}return c+")\\n"}var ea=p("__camera"),ma=p("__config"),Aa=p("__debug"),O=p("__graph"),Ea=p("__renderer"),ba=p("__textures"),Ha=p("__util");p("vec4");var Ja=ma.eh,ab=ma.n,Ka=ma.Sh;a.lu=function(a,b){var d=O.create(),E=a.M[0],g=b.rl,m=b.tr,f=b.Eb,J=b.Ba,C=
S("OPAQUE",E,!0,J,g,f,m,null,b.Dd);O.o(d,C);var u=S("BLEND",E,!0,J,g,f,m,null,null);O.o(d,u);O.i(d,C,u,y("SCREEN","NONE",1,1,!0));if(b.mc){var q=S("XRAY",E,!1,J,g,f,m,null,b.Dd);O.o(d,q);O.i(d,u,q,y("SCREEN","NONE",1,1,!0))}m=ha();O.o(d,m);ab.wireframe_debug?(E=v(E),O.o(d,E),b.mc?O.i(d,q,E,y("SCREEN","NONE",1,1,!0)):O.i(d,u,E,y("SCREEN","NONE",1,1,!0)),O.i(d,E,m,y("SCREEN","NONE",1,1,!0))):O.i(d,u,m,y("SCREEN","NONE",1,1,!0));b.zk&&(E=h(C.h),a.M.push(E),u=I(E,!1),O.o(d,u),b.mc?(E=h(C.h),a.M.push(E),
C=I(E,!0),O.o(d,C),O.i(d,u,C,y("COLOR","COLOR",1,1,!0)),O.i(d,C,m,y("COLOR","NONE",1,1,!0)),O.i(d,C,m,y("DEPTH","NONE",1,1,!0))):(O.i(d,u,m,y("COLOR","NONE",1,1,!0)),O.i(d,u,m,y("DEPTH","NONE",1,1,!0))));b.Wh.procedural_skydome&&(g=W(g,b.Wh),O.o(d,g),O.i(d,g,m,y("CUBEMAP","u_sky",Ka.bh,1,!1)));c(d,!0);1<ab.resolution_factor&&k(d);e(d);B(d);return d};a.Lt=b;a.Cy=w;a.ku=function(a,b,d){var E=O.create(),f=[],l=[],ca=[],n=[],r=[],s=[],w=[],t=[],x=[],Y=[],la=[],ja=b.rl,pa=b.Ba,ua=b.Tl,p=b.yf,ma=b.$f,Ea=
b.jg,ub=b.hx,ud=b.Jf,nd=b.gg,fc=b.Nf,qd=b.antialiasing,ad=b.tr,nc=b.Eb,Pb=b.wc,$b=b.Hw,cd=b.ut,oc=b.Dt,Bc=b.cw,ic=b.$v,Sc=b.Rf,Ba=[];if(ab.anaglyph_use&&!a){var Ib=d.M[0],rb=h(Ib);ea.xp(Ib,ea.tb);ea.xp(rb,ea.Bb);Ba.push(Ib,rb);d.M.push(rb)}else{var za=d.M[0];Ba.push(za)}if(ua){ea.Nj(Ba[0],Pb);for(var fb=Pb.csm_num,$=0;$<fb;$++){var Qa=q($,Pb);O.o(E,Qa);Y.push(Qa);var mb=Pb.csm_resolution,za=Qa.h;za.width=mb;za.height=mb;Qa.aa=!1;la.push(y("DEPTH","u_shadow_map"+$,mb,1,!1));Aa.Bn()&&Qa.Z.push(y("COLOR",
"COLOR",mb,1,!1))}}if(0<ub.length&&!a)for($=0;$<Ba.length;$++){za=h(Ba[$]);d.M.push(za);var ta=S("REFLECT",za,!1,pa,ja,nc,ad,null,b.Dd);ta.hb=ub[0];ta.h.hb=ub[0];O.o(E,ta);s.push(ta);w.push(y("COLOR","u_reflectmap",1,ab.Oh,!0));ta.Z.push(y("DEPTH","DEPTH",1,ab.Oh,!0))}f=[];l=[];if(b.ya){var qa=g();O.o(E,qa);mb=Ka.Si;qa.h.width=mb;qa.h.height=mb;var vb=y("DEPTH","u_grass_map_depth",mb,1,!1);vb.ca=ba.s;vb.ba=ba.s;var xa=y("COLOR","u_grass_map_color",mb,1,!1);xa.ca=ba.s;xa.ba=ba.s}else xa=vb=qa=null;
for($=0;$<Ba.length;$++){var za=Ba[$],gb=h(za);d.M.push(gb);if(ua){var ra=K(gb,Pb);O.o(E,ra);for(var bb=0;bb<Y.length;bb++){var Qa=Y[bb],Da=la[bb];O.i(E,Qa,ra,Da)}var nb=y("COLOR","u_color",1,1,!0),Jb=y("DEPTH","u_depth",1,1,!0);if(p){var Cc=h(za);d.M.push(Cc);var Vb=b.ky,ac=H(Cc,nc,Vb);O.o(E,ac);var pc=y("COLOR","u_ssao_mask",1,1,!0);O.i(E,ra,ac,nb);O.i(E,ra,ac,Jb);var wb=h(za);d.M.push(wb);var Mb=D(wb,Vb);O.o(E,Mb);var Wb=y("COLOR","u_shadow_mask",1,1,!0);O.i(E,ac,Mb,pc);O.i(E,ra,Mb,Jb)}var Sb=
h(gb);d.M.push(Sb);var hb=m(Sb);O.o(E,hb);O.i(E,ra,hb,y("DEPTH","u_depth",1,1,!0));ca.push(hb);var Xb=y("DEPTH","DEPTH",1,1,!0);r.push(Xb)}else ra=K(gb,Pb),O.o(E,ra),Xb=y("DEPTH","DEPTH",1,1,!0),r.push(Xb),Aa.Bn()&&ra.Z.push(y("COLOR","COLOR",1,1,!0)),Sb=h(gb),d.M.push(Sb),hb=m(Sb),O.o(E,hb),O.i(E,ra,hb,y("DEPTH","u_depth",1,1,!0)),ca.push(hb);qa&&(O.i(E,qa,ra,vb),O.i(E,qa,ra,xa));ta=S("OPAQUE",za,!1,pa,ja,nc,ad,null,b.Dd);O.o(E,ta);l.push(ta);O.i(E,ra,ta,r[$]);pc?O.i(E,Mb,ta,Wb):O.i(E,ra,ta,y("COLOR",
"u_shadow_mask",1,1,!0));var jc=y("COLOR","u_color",1,1,!0);n.push(y("COLOR","COLOR",1,1,!0));qa&&(O.i(E,qa,ta,vb),O.i(E,qa,ta,xa));s.length&&(O.i(E,s[$],ta,w[$]),ta.hb=ub[0])}f=l;l=[];if(!a&&b.zk){za=h(f[0].h);d.M.push(za);var Xa=I(za,!1);O.o(E,Xa);if(b.mc){za=h(f[0].h);d.M.push(za);var bc=I(za,!0);O.o(E,bc);O.i(E,Xa,bc,y("COLOR","COLOR",1,1,!0));O.i(E,Xa,bc,y("DEPTH","DEPTH",1,1,!0))}}else Xa=null;if(Ea&&!a)for($=0;$<Ba.length;$++){var Kb=X();O.o(E,Kb);O.i(E,f[$],Kb,jc);t.push(Kb);x.push(y("COLOR",
"u_refractmap",1,1,!0))}for(var gc=[],$=0;$<Ba.length;$++){ra=ca[$];za=h(Ba[$]);d.M.push(za);ta=S("BLEND",za,!1,pa,ja,nc,ad,Pb,b.Dd);l.push(ta);O.o(E,ta);O.i(E,f[$],ta,n[$]);O.i(E,f[$],ta,r[$]);qa&&(O.i(E,qa,ta,vb),O.i(E,qa,ta,xa));for(bb=0;bb<Y.length;bb++)Qa=Y[bb],Da=la[bb],O.i(E,Qa,ta,Da);if("DEPTH_PACK"==ra.type){var va=y("COLOR","u_scene_depth",1,1,!0);va.ca=ba.oc;va.ba=ba.oc}else va=y("DEPTH","u_scene_depth",1,1,!0),va.ca=ba.s,va.ba=ba.s;O.i(E,ra,ta,va);s.length&&(O.i(E,s[$],ta,w[$]),ta.hb=
ub[0]);t.length&&O.i(E,t[$],ta,x[$]);gc.push(ta)}f=l;l=[];if(b.mc){for($=0;$<Ba.length;$++){ra=ca[$];za=h(Ba[$]);d.M.push(za);ta=S("XRAY",za,!1,pa,ja,nc,ad,Pb,b.Dd);l.push(ta);O.o(E,ta);O.i(E,f[$],ta,n[$]);O.i(E,f[$],ta,r[$]);qa&&(O.i(E,qa,ta,vb),O.i(E,qa,ta,xa));for(bb=0;bb<Y.length;bb++)Qa=Y[bb],Da=la[bb],O.i(E,Qa,ta,Da);"DEPTH_PACK"==ra.type?(va=y("COLOR","u_scene_depth",1,1,!0),va.ca=ba.oc,va.ba=ba.oc):(va=y("DEPTH","u_scene_depth",1,1,!0),va.ca=ba.s,va.ba=ba.s);O.i(E,ra,ta,va);s.length&&(O.i(E,
s[$],ta,w[$]),ta.hb=ub[0]);t.length&&O.i(E,t[$],ta,x[$])}f=l;l=[]}if(ab.wireframe_debug){for($=0;$<Ba.length;$++){za=Ha.ra(Ba[$]);d.M.push(za);var Oa=v(za);l.push(Oa);O.o(E,Oa);O.i(E,f[$],Oa,n[$]);O.i(E,f[$],Oa,r[$]);qa&&(O.i(E,qa,Oa,vb),O.i(E,qa,Oa,xa))}f=l;l=[]}if(ma&&!a){for($=0;$<Ba.length;$++){var R=Bc.eg,N=Bc.nw,wa=Bc.xg,oa=f[$],Ua=pa?1:0,ka=y("DEPTH","u_input",1,1,!0);ka.ca=ba.s;ka.ba=ba.s;var na=y("COLOR","u_input",1,.25,!0);na.ca=ba.s;na.ba=ba.s;var Cb=R/wa,Ca=h(Ba[$]);d.M.push(Ca);var cb=
z(Ca,Ua,R,!0,Cb,ja,wa);O.o(E,cb);O.i(E,oa,cb,ka);var Cb=R/wa*.5,Pa=h(Ba[$]);d.M.push(Pa);var db=z(Pa,Ua,R,!1,Cb,ja,wa);O.o(E,db);O.i(E,cb,db,na);var Cb=R/wa*.25,$a=h(Ba[$]);d.M.push($a);var Ga=z($a,Ua,R,!1,Cb,ja,wa);O.o(E,Ga);O.i(E,db,Ga,na);s.length&&(cb.hb=ub[0],db.hb=ub[0],Ga.hb=ub[0]);var Ra=ia(N,ja);l.push(Ra);O.o(E,Ra);O.i(E,oa,Ra,y("COLOR","u_main",1,1,!0));O.i(E,Ga,Ra,y("COLOR","u_god_rays",1,1,!0))}f=l;l=[]}if(ud&&!a){for($=0;$<Ba.length;$++){var oa=f[$],ib=fa();O.o(E,ib);O.i(E,oa,ib,y("COLOR",
"u_input",1,1,!0));var Xc=da();O.o(E,Xc);Xc.h.width=1;Xc.h.height=1;var Dc=y("COLOR","u_input",1,.25,!0);Dc.ca=ba.s;Dc.ba=ba.s;var dd=y("COLOR","u_luminance",1,.25,!0);dd.ca=ba.s;dd.ba=ba.s;O.i(E,ib,Xc,Dc);var vc=cd.key,Tc=cd.Ou,xb=h(Ba[$]);d.M.push(xb);var qc=C(vc,Tc,ja,xb);O.o(E,qc);O.i(E,oa,qc,y("COLOR","u_main",1,1,!0));O.i(E,ib,qc,dd);O.i(E,Xc,qc,y("COLOR","u_average_lum",1,1,!1));var Va=y("COLOR","u_color",1,.25,!0);Va.ca=ba.s;Va.ba=ba.s;var Ec=u("X_BLUR");O.o(E,Ec);O.i(E,qc,Ec,Va);var kc=u("Y_BLUR");
O.o(E,kc);O.i(E,Ec,kc,Va);var eb=J(cd.blur);O.o(E,eb);var Ya=y("COLOR","u_bloom",1,.25,!0);Ya.ca=ba.s;Ya.ba=ba.s;O.i(E,kc,eb,Ya);O.i(E,oa,eb,y("COLOR","u_main",1,1,!0));l.push(eb)}f=l;l=[]}if(nd&&!a){for($=0;$<f.length;$++){var rc=f[$],wc=V($b.ej,$b.fj);l.push(wc);O.o(E,wc);O.i(E,rc,wc,y("COLOR","u_mb_tex_curr",1,1,!0));wc.Z.push(y("COLOR","u_mb_tex_accum",1,1,!0))}f=l;l=[]}if(Sc&&!a){for($=0;$<f.length;$++){var oa=f[$],yb=h(Ba[$]);d.M.push(yb);Va=y("COLOR","u_color",1,1,!0);Va.ca=ba.s;Va.ba=ba.s;
var Yb=A("X_BLUR");O.o(E,Yb);O.i(E,oa,Yb,Va);var Db=A("Y_BLUR");O.o(E,Db);O.i(E,Yb,Db,Va);var ra=gc[$],cc=M(yb);yb.dof_distance=d.dof_distance;yb.Me=d.Me;yb.dof_front=d.dof_front;yb.dof_rear=d.dof_rear;yb.dof_power=d.dof_power;yb.dof_on=1;l.push(cc);O.o(E,cc);O.i(E,oa,cc,y("COLOR","u_sharp",1,1,!0));O.i(E,Db,cc,y("COLOR","u_blurred",1,1,!0));O.i(E,ra,cc,y("DEPTH","u_depth",1,1,!0))}f=l;l=[]}if(!a&&b.glow){for($=0;$<Ba.length;$++){var oa=f[$],Hc=h(Ba[$]);d.M.push(Hc);var Eb=Q(Hc);O.o(E,Eb);var Yc=
A("X_EXTEND"),Zb=y("COLOR","u_color",1,1,!0),jb=y("COLOR","u_glow_mask",1,1,!0);Yc.th=!0;O.o(E,Yc);O.i(E,Eb,Yc,Zb);var lc=y("COLOR","u_color",1,.5,!0);lc.ca=ba.s;lc.ba=ba.s;var Tb=A("Y_EXTEND");Tb.th=!0;O.o(E,Tb);O.i(E,Yc,Tb,lc);Yb=A("X_BLUR");Yb.th=!0;O.o(E,Yb);O.i(E,Tb,Yb,lc);var id=y("COLOR","u_color",1,.25,!0);id.ca=ba.s;id.ba=ba.s;var Zc=y("COLOR","u_glow_mask_blurred",1,.25,!0);Zc.ca=ba.s;Zc.ba=ba.s;Db=A("Y_BLUR");Db.th=!0;O.o(E,Db);O.i(E,Yb,Db,id);var Ic=T(ic);O.o(E,Ic);O.i(E,oa,Ic,y("COLOR",
"u_glow_src",1,1,!0));O.i(E,Eb,Ic,jb);O.i(E,Db,Ic,Zc);l.push(Ic)}f=l;l=[]}if(fc&&!a){for($=0;$<f.length;$++){var oa=f[$],hd=Z(oc.brightness,oc.contrast,oc.exposure,oc.saturation);O.o(E,hd);O.i(E,oa,hd,y("COLOR","u_color",1,1,!0));l.push(hd)}f=l;l=[]}if(qd&&!a){for($=0;$<f.length;$++)if(oa=f[$],ab.smaa){var ob=y("COLOR","u_color",1,1,!0);ob.ca=ba.s;ob.ba=ba.s;var Qb=P("SMAA_EDGE_DETECTION");O.o(E,Qb);O.i(E,oa,Qb,ob);var hc=P("SMAA_BLENDING_WEIGHT_CALCULATION");O.o(E,hc);O.i(E,Qb,hc,ob);var Ub=y("COLOR",
"u_search_tex",1,1,!1),bd=y("COLOR","u_area_tex",1,1,!1);Ub.ca=ba.s;Ub.ba=ba.s;bd.ca=ba.s;bd.ba=ba.s;hc.Z.push(Ub);hc.Z.push(bd);var Nb=P("SMAA_NEIGHBORHOOD_BLENDING");O.o(E,Nb);O.i(E,oa,Nb,ob);var Nc=y("COLOR","u_blend",1,1,!0);Nc.ca=ba.s;Nc.ba=ba.s;O.i(E,hc,Nb,Nc);l.push(Nb)}else{var $c=U();O.o(E,$c);var Uc=y("COLOR","u_color",1,1,!0);Uc.ca=ba.s;Uc.ba=ba.s;O.i(E,oa,$c,Uc);if(1<ab.resolution_factor){var xc=A("NONE");O.o(E,xc);O.i(E,$c,xc,Uc);l.push(xc)}else l.push($c)}f=l;l=[]}if(ab.anaglyph_use&&
!a){var mc=G();O.o(E,mc);O.i(E,f[0],mc,y("COLOR","u_sampler_left",1,1,!0));O.i(E,f[1],mc,y("COLOR","u_sampler_right",1,1,!0));l.push(mc)}else l.push(f[0]);var Vc=O.Ah(E,f[0]),Fc=!1;O.pe(E,Vc,function(a,b,c){if(c.G==c.V)return Fc=!0});if(Fc||a){var Lc=L();O.o(E,Lc);O.i(E,f[0],Lc,y("COLOR","u_color",1,1,!0));f=l;l=[];l.push(Lc)}Xa&&(bc?l.push(bc):l.push(Xa));if(!a&&b.Wh.procedural_skydome){var Oc=W(ja,b.Wh);O.o(E,Oc);l.push(Oc)}var Pc=ha();O.o(E,Pc);if(Ja.enabled){var yc=A("NONE");O.o(E,yc)}for($=0;$<
l.length;$++)switch(l[$].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":O.i(E,l[$],Pc,y("COLOR","NONE",1,1,!0));O.i(E,l[$],Pc,y("DEPTH","NONE",1,1,!0));break;case "SKY":O.i(E,Oc,Pc,y("CUBEMAP","u_sky",Ka.bh,1,!1));break;default:O.i(E,l[$],Ja.enabled?yc:Pc,y("SCREEN","NONE",1,1,!0))}if(Ja.enabled){var zc=null,Wc=0;O.L(E,function(a,b){if(b.type==Ja.ty){if(Wc==Ja.sy)return zc=b,!0;Wc++}});if(zc){var od=O.Ah(E,zc);O.oe(E,function(a,b,c){if(a==od)return O.i(E,zc,yc,y(Ja.Vx,"u_color",c.size,c.ke,
c.Fg)),O.i(E,yc,Pc,y("SCREEN","NONE",.5,.5,!0)),!0})}}for(var Fb=O.Po(E),$=0;$<Fb.length;$++)for(var sc=Fb[$],bb=0;bb<ca.length;bb++)ra=ca[bb],O.Ea(E,sc)==ra&&O.lg(E,sc);c(E,!1);1<ab.resolution_factor&&k(E);e(E);B(E);return E};a.QA=s;a.nA=function(a){var b=null;O.L(a,function(a,c){return c.h&&null===c.h.Td?(b=c,!0):!1});return b};a.eb=function(a,b,c){a=ja(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.JA=pa;a.hw=la;a.cv=Y;a.Jo=ja;a.DA=E;a.Ma=function(a,b){var c=null;O.L(a,
function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Au=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ca(a);O.L(a,function(a,d){var e=b+="    ",E="",E=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(E+=" ("+d.Jh.replace(/_/g," ")+")");if(d.h){for(var E=E+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.cb&&(E+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.hc&&(E+="D"+c[g+1])}d.Z.length&&
(E+="\\n-----\\n");for(g=0;g<d.Z.length;g++)E+=ua(d.Z[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+E+'" color="black" style="'+(g+",bold")+'"];\n')});O.oe(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ua(e,c)+'" style="'+(e.xa?"solid":"dotted")+'"];\n'});return b+="}"};a.Wn=function(a){a=O.zy(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};
b4w.module.__textures=function(a,p){function h(){return{name:"",type:0,source:"",width:0,height:0,Bk:1,ni:!0,em:1024,ko:!1,dd:null,wa:null,Tj:!1,bg:!1,O:0,Ta:0,Xk:0,Xy:!1,ai:!1,Bp:0,Pe:0,Ab:0,Ha:null,Ng:null}}function c(b,c,d){var e=b.type,k=new Uint8Array([204,204,204,255]),m=h();switch(e){case "DATA_TEX2D":case "IMAGE":var q=g.createTexture(),l=g.TEXTURE_2D;g.bindTexture(l,q);g.texImage2D(l,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,k);b.image&&"MOVIE"==b.image.source&&(m.bg=!0,m.O=b.frame_start,m.Ta=
b.frame_offset,m.Xk=b.frame_duration,m.Xy=b.use_auto_refresh,m.ai=b.use_cyclic,m.Bp=b.movie_length,0!=m.Ta&&r.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":q=g.createTexture();l=g.TEXTURE_2D;g.bindTexture(l,q);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(d=t.keysearch("name",b.b4w_source_id,d)))m.kj=d,m.em=b.b4w_source_size,d.bk=!0,g.texImage2D(l,0,g.RGBA,1,1,
0,g.RGBA,g.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":q=g.createTexture();l=g.TEXTURE_CUBE_MAP;g.bindTexture(l,q);d="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var x=0;6>x;x++)g.texImage2D(g["TEXTURE_CUBE_MAP_"+d[x]],0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,k);break;case "VORONOI":case "BLEND":return null;default:return r.error('B4W warning: texture "'+b.name+'" has unsupported type "'+e+'"'),null}("NONE"!=e||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=e?g.texParameteri(l,g.TEXTURE_MIN_FILTER,A[w.Hj]):g.texParameteri(l,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(l,g.TEXTURE_MAG_FILTER,g.LINEAR);k=l;d=b.b4w_anisotropic_filtering;"DEFAULT"===d&&(d=c);"OFF"!==d&&w.oi&&(c=n.zv())&&(d=parseFloat(d.split("x")[0]),g.texParameterf(k,c.TEXTURE_MAX_ANISOTROPY_EXT,d));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(g.texParameteri(l,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(l,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)):
(g.texParameteri(l,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(l,g.TEXTURE_WRAP_T,g.REPEAT));m.type=a.Hf;m.width=1;m.height=1;m.Ha=q;m.Ab=l;"CANVAS"==b.b4w_source_type&&"NONE"==e?(e=b.b4w_source_id,q=b.b4w_source_size,m.ko=b.b4w_enable_canvas_mipmapping,m.name=e,m.source="CANVAS",l=document.createElement("canvas"),l.setAttribute("id",e),l.width=q,l.height=q,m.dd=l.getContext("2d"),s[e]=m,f(m)):(m.name=b.name,m.source=e,g.generateMipmap(l),g.bindTexture(l,null));return b.d=m}function f(a){if("CANVAS"!=
a.source)throw"Wrong texture";var b=a.Ab;g.bindTexture(b,a.Ha);var c=e(a),d=k(a),f=a.dd.canvas;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texImage2D(b,0,c,c,d,f);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);a.ko&&g.generateMipmap(b);g.bindTexture(b,null);a.width=f.width;a.height=f.height}function b(a){g.texParameteri(a,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(a,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(a,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(a,g.TEXTURE_MIN_FILTER,g.LINEAR)}function l(a,
b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function e(b){switch(b.type){case a.Hf:b=g.RGBA;break;case a.Zj:b=g.RGB;break;case a.ji:b=g.RGBA;break;case a.ki:b=g.RGB;break;case a.Pg:b=g.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function k(b){switch(b.type){case a.Hf:b=g.UNSIGNED_BYTE;break;case a.Zj:b=g.UNSIGNED_BYTE;break;case a.ji:b=g.FLOAT;break;case a.ki:b=g.FLOAT;break;case a.Pg:b=g.UNSIGNED_INT;break;default:throw"Wrong texture type";
}return b}var d=p("__config"),r=p("__print"),x=p("__dds"),n=p("__extensions"),t=p("__util"),w=d.n,B=d.Jd,q=d.Ad;a.oc=0;a.s=0;a.Fs=0;a.Ds=0;a.Es=0;a.Cs=0;a.Hf=10;a.Zj=20;a.ji=30;a.ki=40;a.Pg=50;a.Gf=60;var s={},y={},g=null,A;a.Xb=function(b){A=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.oc=b.NEAREST;a.s=b.LINEAR;a.Fs=b.NEAREST_MIPMAP_NEAREST;a.Ds=b.LINEAR_MIPMAP_NEAREST;a.Es=b.NEAREST_MIPMAP_LINEAR;a.Cs=b.LINEAR_MIPMAP_LINEAR;g=b};a.Dv=function(a){return a in
s?s[a].dd:null};a.Jy=function(a){return a in s?(f(s[a]),!0):!1};a.Gi=function(b,c){var d=h();d.name=b;d.type=c;d.source="NONE";if(c==a.Gf)d.Ng=g.createRenderbuffer();else{var e=g.TEXTURE_2D,f=g.createTexture();g.bindTexture(e,f);g.texParameteri(e,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(e,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.bindTexture(e,null);d.Ab=e;d.Ha=f}return d};a.au=function(b){var c=g.createTexture(),
d=g.TEXTURE_CUBE_MAP;g.bindTexture(d,c);g.texParameteri(d,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(d,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(d,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(d,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);for(var e="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),f=0;6>f;f++)g.texImage2D(g[e[f]],0,g.RGBA,b,b,0,g.RGBA,g.UNSIGNED_BYTE,
null);g.bindTexture(d,null);d=h();d.name="CUBEMAP";d.type=a.Hf;d.source="NONE";d.width=3*b;d.height=2*b;d.Bk=1;d.Ha=c;d.Ab=g.TEXTURE_CUBE_MAP;return d};a.Aj=function(b,c,d){if(b.type!=a.Gf){var e=b.Ab;g.bindTexture(e,b.Ha);c&&g.texParameteri(e,g.TEXTURE_MIN_FILTER,c);d&&g.texParameteri(e,g.TEXTURE_MAG_FILTER,d);g.bindTexture(e,null)}};a.BA=function(b){if(b.type==a.Gf)return{min:a.oc,Bw:a.oc};var c=b.Ab;g.bindTexture(c,b.Ha);b=g.getTexParameter(c,g.TEXTURE_MIN_FILTER);var d=g.getTexParameter(c,g.TEXTURE_MAG_FILTER);
g.bindTexture(c,null);return{min:b,Bw:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Gf)g.bindRenderbuffer(g.RENDERBUFFER,b.Ng),g.renderbufferStorage(g.RENDERBUFFER,g.DEPTH_COMPONENT16,c,d),g.bindRenderbuffer(g.RENDERBUFFER,null);else{var f=b.Ab;g.bindTexture(f,b.Ha);var h=e(b),m=k(b);g.texImage2D(f,0,h,c,d,0,h,m,null);g.bindTexture(f,null)}c>w.kf||d>w.kf?r.error("B4W warning: texture has unsupported size",filepath):(b.width=c,b.height=d)}};a.uu=
c;a.Vy=function(a){var b=a.Ab;g.bindTexture(b,a.Ha);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);4!=a.wa.length?g.texImage2D(b,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,a.wa):g.texImage2D(b,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,a.wa);g.bindTexture(b,null)};a.Pj=function(a,c,d,e){var f=a.source,m=a.Ab;g.bindTexture(m,a.Ha);if(4==c.length){var h=!0;c=new Uint8Array([255*c[0],255*c[1],255*c[2],255*c[3]])}if("IMAGE"==f)if(h)g.texImage2D(m,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,c),a.width=1,a.height=1;else if(d){d=x.Ro(c);
if(d.width>w.kf||d.height>w.kf){r.error("B4W warning: texture has unsupported size",e);return}x.Wy(g,n.No(),c,!0);l(d.width,d.height)&&(a.kn||r.warn("B4W warning: using NPOT texture",e),b(m));a.width=d.width;a.height=d.height;a.Bk=x.Gv(c)}else{g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);if(c.width>w.kf||c.height>w.kf){r.error("B4W warning: texture has unsupported size",e);return}a.bg?(a.wa=c,a.wa.loop=a.ai,c&&(y[a.name]=a),a.Pe=B.ua,c.duration&&(a.Pe=a.Bp/c.duration),q.ho||(c.playbackRate=B.ua/a.Pe,q.Fn&&
2<c.playbackRate&&(c.playbackRate=2))):g.texImage2D(m,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,c);a.width=c.width;a.height=c.height;l(c.width,c.height)?(a.kn||(a.bg?r.warn("B4W warning: using NPOT video texture",e):r.warn("B4W warning: using NPOT texture",e)),b(m)):a.bg||g.generateMipmap(m)}else if("ENVIRONMENT_MAP"==f)if(d=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],h){for(h=0;6>h;h++)f=d[h],g.texImage2D(g["TEXTURE_CUBE_MAP_"+f[0]],0,
g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,c);a.width=3;a.height=2}else{g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);var k=c.width/3;if(k>w.zl||k>w.zl){r.error("B4W warning: cubemap has unsupported size",e);return}for(h=0;6>h;h++){var f=d[h],s=document.createElement("canvas");s.width=k;s.height=k;var t=s.getContext("2d");"POSITIVE_Y"==f[0]||"NEGATIVE_Y"==f[0]?(t.translate(0,k),t.scale(1,-1)):(t.translate(k,0),t.scale(-1,1));t.drawImage(c,f[1]*k,f[2]*k,k,k,0,0,k,k);g.texImage2D(g["TEXTURE_CUBE_MAP_"+f[0]],0,g.RGBA,
g.RGBA,g.UNSIGNED_BYTE,s)}a.width=3*k;a.height=2*k;l(c.width/3,c.height/2)?(r.warn("B4W warning: using NPOT cube map texture",e),b(m)):g.generateMipmap(m)}else"DATA_TEX2D"==f&&(g.texImage2D(m,0,g.RGBA,c.width,c.height,0,g.RGBA,g.UNSIGNED_BYTE,c.data),a.width=c.width,a.height=c.height);g.bindTexture(m,null)};a.Iu=function(a){g.deleteTexture(a)};a.vh=function(a){return a&&a.name&&(a.Ha||a.Ng)?!0:!1};a.lp=function(a){return a&&a.name&&a.Ng?!0:!1};a.WA=function(b){return b.type==a.ji||b.type==a.ki?!0:
!1};a.Uv=function(b){var c=0;switch(b.type){case a.Hf:case a.Zj:c=4;break;case a.ji:case a.ki:c=16;break;case a.Pg:c=3;break;case a.Gf:c=2}return c};a.uv=function(a){var b=null,b={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(b,null,a);b.image={filepath:null};return b};a.cleanup=function(){s={};y={}};a.play_video=function(a){return a in y?(y[a].wa.play(),!0):null};a.reset_video=function(a){return a in y?(a=y[a],a.wa.currentTime=a.Ta/a.Pe,!0):null};
a.stop_video=function(a){return a in y?(y[a].wa.pause(),!0):null};a.pause=function(){for(var a in y)y[a].wa.paused||(y[a].wa.pause(),y[a].Tj=!0)};a.reset=function(){for(var a in y)y[a].currentTime=y[a].Ta/y[a].Pe,y[a].Tj=!1};a.play=function(a){for(var b in y)if(!a||y[b].Tj)y[b].wa.play(),y[b].Tj=!1}};
b4w.module.__assets=function(a,p){function h(){return t.ml()?p(t.yb.xi).data:null}function c(){var a={li:null,Ns:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.li=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=h();b&&a.li in b&&(a.status=200,b[a.li]&&(a.response=a.Ns(b[a.li])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function f(c){for(var g=0,f=0;f<c.length;f++){var m=c[f];20===m.state&&g++;if(g>=y.Fw)break;if(10===m.state)switch(m.state=20,g++,m.type){case a.AT_ARRAYBUFFER:b(m,"arraybuffer");break;case a.AT_JSON:b(m,"json");break;case a.AT_TEXT:b(m,"text");break;case a.AT_AUDIOBUFFER:l(m);break;case a.AT_IMAGE_ELEMENT:e(m);
break;case a.AT_AUDIO_ELEMENT:k(m);break;case a.Xj:d(m);break;default:throw"Wrong asset type: "+m.type;}}}function b(a,b){var d=h(),e=d&&a.q in d?new c:new XMLHttpRequest;e.open("GET",a.q,!0);"text"==b?(e.overrideMimeType("text/plain"),e.responseType="text"):"json"==b?(e.overrideMimeType("application/json"),e.responseType="text"):e.responseType=b;e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState){if(200==e.status||0==e.status){var c=e.response;if(c){if("json"==b&&"string"==typeof c)try{c=
JSON.parse(c)}catch(d){a.ub(null,a.uri,a.type,a.q);w.error(d+" (parsing JSON "+a.q+")");return}a.ub(c,a.uri,a.type,a.q)}else a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: empty responce when trying to get "+a.q)}else a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: "+e.status+" when trying to get "+a.q);a.state=30}};e.addEventListener("progress",function(b){b.lengthComputable&&a.bx(b.loaded/b.total)},!1);e.send(null)}function l(a){var b=h(),d=b&&a.q in b?new c:new XMLHttpRequest;d.open("GET",a.q,
!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState)if(200==d.status||0==d.status){var b=d.response;b?B.Eu(b,function(b){a.ub(b,a.uri,a.type,a.q);a.state=30},function(){a.ub(null,a.uri,a.type,a.q);w.error("B4W Error: failed to decode "+a.q);a.state=30}):(a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: empty responce when trying to get "+a.q),a.state=30)}else a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: "+d.status+" when trying to get "+a.q),a.state=
30};d.send(null)}function e(a){var b=document.createElement("img");g.Ug&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: could not load image: "+a.q),a.state=30)},!1);var c=h();if(c&&a.q in c)if(c[a.q]){var d=r(a.q);b.src="data:"+d+";base64,"+c[a.q]}else c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.q}function k(a){var b=document.createElement("audio");
g.Ug&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: could not load sound: "+a.q),a.state=30)},!1);var c=h();if(c&&a.q in c)if(c[a.q]){var d=x(a.q);b.src="data:"+d+";base64,"+c[a.q];40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)}else c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.q,g.Ze&&b.load();setTimeout(function(){b.Yx=
1},5E3)}function d(a){var b=document.createElement("video");b.muted=!0;if(g.Ug||g.Ze)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),w.error("B4W Error: could not load video: "+a.q),a.state=30)},!1);var c=h();if(c&&a.q in c)if(c[a.q]){var d=n(a.q);b.src="data:"+d+";base64,"+c[a.q];40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)}else c=new CustomEvent("error"),
b.dispatchEvent(c);else b.src=a.q,g.Ze&&b.load();setTimeout(function(){b.Yx=1},1E4)}function r(a){var b="image";switch(q.cl(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function x(a){var b="audio";switch(q.cl(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function n(a){var b="video";switch(q.cl(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+=
"/webm";break;case "m4v":b+="/mp4"}return b}var t=p("__config"),w=p("__print"),B=p("__sfx"),q=p("__util"),s=p("__version"),y=t.ad,g=t.n;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Xj=70;var A=[],u=0,S={};a.Ej=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Tv=function(a){if(S[a])return S[a];var b=y.dq?a+s.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");
c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return S[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<A.length;a++)A[a].state=40;A=[];u=0;S={}};a.enqueue=function(a,b,c,d){for(var e=0;e<a.length;e++){var g=a[e],g={uri:g[0],type:g[1],q:g[2],name:g[3],state:10,ub:b||function(){},Xp:c||function(){},bx:d||function(){},Yp:u};if(y.dq){var k=h();k&&g.q in k||(g.q+=s.timestamp())}A.push(g)}f(A);
u++};a.update=function(){f(A);for(var a=A,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.Yp===a[b].Yp?30!==e.state&&(c=!1):(c&&(a[d-1].Xp(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].Xp(),a.splice(b))}}};
b4w.module.__loader=function(a,p){function h(b,d,e,f,h){var k=q,l=t.create(),r;for(r in d){var x=c(d[r]);(f&&x.Ua||!b&&x.qb)&&n(x);t.o(l,x)}for(r in d)for(x=d[r],x.name=r,b=0;b<x.B.length;b++)t.i(l,d[x.B[b]],x,null);d=c({name:"out",Ga:a.zr,Ja:function(a,b,c,d,e){0===b.id&&(k.eq=!0);3!=b.status&&(b.status=2);h(b.id);e(b,c);w.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")}});var m=[];if(e)for(e=t.Po(l),b=0;b<e.length;b++)m.push(t.Ea(l,e[b]));else t.L(l,function(a,b){b.Sa||m.push(b)});t.o(l,
d);for(b=0;b<m.length;b++)d.B.push(m[b].name),t.i(l,m[b],d,null);return l}function c(a){a.Sa=a.Sa||!1;a.Ga||0===a.Ga||(a.Ga=a.zc);a.B=a.B||[];a.sh=a.sh||!1;a.am=a.am||!1;a.ib=a.ib||0;a.Ua=a.Ua||!1;a.qb=a.qb||!1;a.status=0;a.fB=0;a.tl=0;a.He=a.He||null;return a}function f(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];t.Ea(a.Oc,f).sh&&(t.qe(a.Oc,f,function(d){var e=!0;t.pe(a.Oc,d,function(a,b){if(!b.sh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function b(a){function b(c,d){var e=t.Ea(a.Oc,c),g=t.Ea(a.Oc,d),f=g.Ga-e.Ga;0==f&&(f=e.Sa-g.Sa);return f}var c=[],d=a.Cd,e=!1;do{var h=f(a,d);c.push.apply(c,d);0<h.length&&(e=!0);d=h}while(0<h.length);e&&c.sort(b);a.Cd=c;return a.Cd.length}function l(a,b,c){if(b.am)return b.sh=!0,k(a,b),!1;if(!b.Ja&&!b.Kf&&!b.Yg)return k(a,b),!1;if(0==b.status&&(b.status++,b.Ja))return b.Ja(c,a,b,b.He,k,d),!0;if(1==b.status){if(b.Kf)return b.Kf(c,a,b,b.He,k,d),!0;b.status++}return 2==
b.status&&(b.status++,b.Yg)?(b.Yg(c,a,b,b.He,k,d),!0):!1}function e(a){if(0==a.Fj)return 100;var b=0;t.L(a.Oc,function(c,d){a.do_not_load_resources&&d.Ua||(b+=d.tl*d.ib)});return B.trunc(100*b/a.Fj)}function k(a,b){b.sh=!0;b.status=3;r(a,b,1)}function d(a,b,c){1>c?r(a,b,c):b.status++}function r(a,b,c){var d=q;if(b.Ja||b.Kf||b.Yg)if(b.tl=c,b=e(a),a.$n!=b||1==c)a.hm(b,performance.now()-a.Yq),a.$n=b,d.xl=!0}function x(a,b){var c=null;t.L(a.Oc,function(a,d){if(d.name==b)return c=d,1});return c}function n(a){a.am=
!0;a.tl=1}var t=p("__graph"),w=p("__print"),B=p("__util");a.zc=0;a.ve=1;a.zr=2;var q=null;a.Oo=function(){return q};a.mu=function(){return q={Sc:[],Jk:0,dk:0,eq:!1,xl:!1}};a.vu=function(a,b,c,d,e,f,k,l){var n=q,m={id:n.Sc.length,status:0,q:b,nn:"",vp:l||!1,HB:f,Yq:0,$n:0,Fj:0,Ul:!1,hm:d||function(){},Pn:e||function(){},Oc:null,Cd:null,jl:!1,il:!1,ll:!1};a=h(0===m.id,a,f,k,c||function(){});m.Oc=a;b=[];c=t.Rv(a);for(d=0;d<c.length;d++)b.push(c[d]);m.Cd=b;t.L(a,function(a,b){!(b.Ja||b.Kf||b.Yg)||m.do_not_load_resources&&
b.Ua||(m.Fj+=b.ib)});n.Sc.push(m);n.dk++;return m.id};a.Ry=function(c){var d=q;if(d&&0!=q.dk)if(d.xl)d.xl=!1;else{var e=performance.now();do{var f=d.Sc[d.Jk],h=c[f.id];if(3!=f.status)if(0==f.status&&(f.status=1,f.Yq=performance.now(),f.hm(0,0)),b(f)){var k=f,n=k.Cd.length;do{var r=t.Ea(k.Oc,k.Cd[0]),w=l(k,r,h);r.Ga==a.ve&&(k.Ul=!0);r=k.Cd.shift();k.Cd.push(r);n--}while(!w&&0!=n)}else f.Pn(h,f),f.status=3,d.dk--,k=f,k.hm=null,k.Pn=null,k.Oc=null,k.Cd=null;d.eq&&(d.Jk=(d.Jk+1)%d.Sc.length);if(f.Ul){f.Ul=
!1;break}}while(16>performance.now()-e)}};a.yB=d;a.bm=function(a,b){var c=x(a,b);null!==c&&n(c)};a.yy=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=q;if(!b)return!1;a|=0;return b.Sc[a]&&(3==b.Sc[a].status||2==b.Sc[a].status)};a.cleanup=function(){q=null}};
b4w.module.__nla=function(a,p){function h(){return{type:"CLIP",O:0,X:0,zd:!1,paused:!1,Id:"",fc:0,Wm:0,Rs:0,oo:0,no:0,stop_video:!1}}function c(a,b){for(var c=a.b4w_nla_script,d=b.wf,e=0;e<c.length;e++){var g=c[e];switch(g.type){case "PLAY":d.push({type:"PLAY",O:g.frame_range[0],X:g.frame_range[1],Wd:!1});break;case "SELECT":case "SELECT_PLAY":var f=B.Oi(B.Yj,g.object,0),h=B.Qv(a),k=h.indexOf(f);if(-1==k){w.error("NLA script error: non-selectable object");return}for(var g={type:g.type,Dq:"SELECT"==
g.type?g.target_slot:e+1,Wx:e+1,fe:-1,zx:h.length,yx:k,O:g.frame_range[0],X:g.frame_range[1],Wd:!1},k=[],q=0;q<h.length;q++)k.push(n.create_selection_sensor(h[q],!0));n.create_sensor_manifold(f,"NLA_SELECT_"+e,n.CT_SHOT,k,n.Fu,function(a,c,d,e){if(!(b.Hb>=b.wf.length)&&(d=b.wf[b.Hb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Wd)){for(d=0;d<e.zx;d++)if(n.get_sensor_value(a,c,d)&&d==e.yx){e.fe=1;return}e.fe=0}},g);d.push(g);break;case "JUMP":d.push({type:"JUMP",cm:g.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
cm:g.target_slot,Qt:g.condition,Ph:g.register1,Qh:g.register2,Hl:g.number1,Il:g.number2});break;case "REGSTORE":d.push({type:"REGSTORE",ix:g.registerd,Rw:g.number1});break;case "MATH":d.push({type:"MATH",Tw:g.operation,Ph:g.register1,Qh:g.register2,Hl:g.number1,Il:g.number2,xj:g.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function f(a,c,d,e){if(a.wf.length){if(a.Hb>=a.wf.length)if(a.cyclic)a.Hb=0;else{a.Ta-=y.ua*d;return}var g=l(a,c,e,!1),m=a.wf[a.Hb];switch(m.type){case "PLAY":m.Wd?g>=
m.X&&(m.Wd=!1,a.Hb++,f(a,c,d,e)):(a.Ta+=m.O-g,m.Wd=!0,b(a,m));break;case "SELECT":case "SELECT_PLAY":-1<m.fe?"SELECT"==m.type||"SELECT_PLAY"==m.type&&0==m.fe?(a.Hb=m.fe?m.Dq:m.Wx,m.fe=-1,f(a,c,d,e)):m.Wd?g>=m.X&&(m.Wd=!1,a.Hb=m.Dq,m.fe=-1,f(a,c,d,e)):(a.Ta+=m.O-g,m.Wd=!0,b(a,m)):a.Ta-=y.ua*d;break;case "JUMP":a.Hb=m.cm;f(a,c,d,e);break;case "CONDJUMP":var g=-1==m.Ph?m.Hl:a.xd[m.Ph],h=-1==m.Qh?m.Il:a.xd[m.Qh],k=!1;switch(m.Qt){case "EQUAL":g==h&&(k=!0);break;case "NOTEQUAL":g!=h&&(k=!0);break;case "LESS":g<
h&&(k=!0);break;case "GREATER":g>h&&(k=!0);break;case "LEQUAL":g<=h&&(k=!0);break;case "GEQUAL":g>=h&&(k=!0)}k?a.Hb=m.cm:a.Hb++;f(a,c,d,e);break;case "REGSTORE":a.xd[m.ix]=m.Rw;a.Hb++;f(a,c,d,e);break;case "MATH":g=-1==m.Ph?m.Hl:a.xd[m.Ph];h=-1==m.Qh?m.Il:a.xd[m.Qh];switch(m.Tw){case "ADD":a.xd[m.xj]=g+h;break;case "MUL":a.xd[m.xj]=g*h;break;case "SUB":a.xd[m.xj]=g-h;break;case "DIV":0==h&&s.da("Division by zero in NLA script"),a.xd[m.xj]=g/h}a.Hb++;f(a,c,d,e);break;case "NOOP":a.Hb++,f(a,c,d,e)}}}
function b(a,b){for(var c=a.wf,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.fe=-1)}}function l(a,b,c,d){b=(b-c)*y.ua+a.Ta-a.O;a.cyclic&&d&&(b%=a.X-a.O+1);return b+a.O}function e(a,b){b?a.wa.pause():(a.wa.currentTime=a.Ta/y.ua,a.wa.play())}function k(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d].strips;if(e)for(var g=0;g<e.length;g++){var f=e[g],k=h();k.type=f.type;k.O=f.frame_start;k.X=f.frame_end;k.Id=f.action?f.action.name:"";k.fc=b;k.Wm=f.action_frame_start;k.Rs=f.action_frame_end;c.push(k)}}return c}
function d(a){return q.Yd(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var r=p("__animation"),x=p("__camera"),n=p("__controls"),t=p("__config");p("__loader");p("__particles");var w=p("__print"),B=p("__scenes"),q=p("__sfx"),s=p("__util"),y=t.Jd,g=[],A=-1;a.Qy=function(a,b){var e={O:a.frame_start,X:a.frame_end,Ta:0,wh:-1,cyclic:b,vd:[],D:[],wf:[],Hb:0,xd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};c(a,e);for(var f=B.la(a,"ALL",B.DATA_ID_ALL),l=0;l<f.length;l++){var m=f[l],
n=0,D=[],t=m.animation_data;if(t&&t.nla_tracks.length&&(t=t.nla_tracks,s.Ye(m)||x.is_camera(m)||s.sc(m)||s.qw(m)||q.Yd(m))){var A=k(t,n);A.length&&(D=D.concat(A),n++)}d(m)&&(t=m.data.animation_data.nla_tracks,A=k(t,n),A.length&&(D=D.concat(A),n++));if(r.hl(m))for(var y=m.data.materials,p=0;p<y.length;p++)if(A=y[p].node_tree,t=A.animation_data,A&&t){for(var t=t.nla_tracks,A=k(t,-1),M=[],Q=0;Q<A.length;Q++)t=A[Q],-1==M.indexOf(t.Id)&&M.push(t.Id),t.fc=n+M.indexOf(t.Id),D.push(t);n+=M.length}for(p=0;p<
m.particle_systems.length;p++)y=m.particle_systems[p],t=y.settings,"EMITTER"==t.type&&t.b4w_allow_nla&&(t=h(),t.type="CLIP",t.O=e.O,t.X=e.X+1,t.Id=y.name,t.fc=n,D.push(t),n++);y=n+1;if(s.sc(m)&&m.data)for(p=0;p<m.data.b4w_vertex_anim.length;p++)A=m.data.b4w_vertex_anim[p],A.allow_nla&&(n=y,t=h(),t.type="CLIP",t.O=e.O,t.X=e.X+1,t.Id=A.name,t.fc=n,D.push(t));D.length&&(m.ak=D,e.vd.push(m))}f=a.d.Kg;for(p=0;p<f.length;p++)t=h(),l=f[p].d,t.type="VIDEO",t.O=Math.min(l.O,e.X),t.X=l.ai?e.X:Math.min(l.Xk+
l.O+l.Ta,e.X),t.Id=f[p].name,l.Ms=t,e.D.push(l);p=e.O;f=e.X;for(l=0;l<e.vd.length;l++)for(m=e.vd[l],n=m.ak,D=0;D<n.length;D++)t=n[D],y=m.name+" ["+t.O+":"+t.X+"]",t.O=Math.max(p,t.O),t.X=Math.min(f+1,t.X),t.O>t.X&&(w.warn("NLA: out of scene range: "+y),n.splice(D,1),D--);for(p=0;p<e.vd.length;p++)for(f=e.vd[p].ak,l=0;l<f.length;l++){m=f[l];n=e.O;D=e.X+1;for(t=0;t<f.length;t++)y=f[t],m.fc==y.fc&&(y.X<=m.O&&(n=m.O),y.O>=m.X&&(D=Math.min(D,y.O)));m.oo=n;m.no=D}g.push(e)};a.start=function(){A=0};a.update=
function(a,b){if(!(0>A)){0==A&&(A=a);for(var c=0;c<g.length;c++){var d=g[c];f(d,a,b,A);for(var h=l(d,a,A,!0),m=0;m<d.vd.length;m++){for(var k=d.vd[m],n=k.ak,w=0;w<n.length;w++){var t=n[w];"SOUND"==t.type&&h<d.wh-1E-6&&(t.zd=!1)}for(w=0;w<n.length;w++)switch(t=n[w],t.type){case "CLIP":if(t.oo<=h&&h<t.no&&!t.zd){var s=k,x=t;r.apply(s,x.Id,x.fc);r.set_behavior(s,r.AB_FINISH_STOP,x.fc);for(s=0;s<n.length;s++)n[s]!=t&&n[s].fc==t.fc&&(n[s].zd=!1);t.zd=!0}t.zd&&(s=k,r.set_current_frame_float(s,h-t.O+t.Wm,
t.fc),r.update_object_animation(s,0,t.fc));break;case "SOUND":(h<d.wh-1E-6||d.wh<t.O)&&t.O<=h&&h<t.X&&!t.zd&&(q.play(k,(t.O-h)/y.ua,(t.X-t.O)/y.ua),t.zd=!0),d.wh<t.X&&t.X<=h&&t.zd&&(t.zd=!1)}}for(m=0;m<d.D.length;m++)t=d.D[m].Ms,t.O<=Math.round(h)&&Math.round(h)<t.X&&!t.stop_video&&(e(d.D[m],t.stop_video),t.stop_video=!0),t.X<=Math.round(h)&&t.stop_video&&(e(d.D[m],t.stop_video),t.stop_video=!1);d.wh=h}}};a.cleanup=function(){g.length=0;A=-1};a.ap=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||
d(a)||r.hl(a)?!0:!1}};
b4w.module.__camera=function(a,p){function h(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function c(b){var c={type:b,name:"",ke:1,width:0,height:0,Td:null,cb:null,hc:null,jb:0,od:0,Fa:0,La:0,left:0,right:0,top:0,bottom:0,Sd:new Float32Array(3),uo:new Float32Array(3),quat:new Float32Array(4),ea:new Float32Array(16),Oz:new Float32Array(16),ia:new Float32Array(16),
Lg:new Float32Array(16),ax:new Float32Array(16),Mc:new Float32Array(16),zq:new Float32Array(16),Df:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,dof_on:0,Yk:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Fa:new Float32Array([0,0,0,0]),La:new Float32Array([0,0,0,0])},Xh:0,Pc:0,hb:null,ah:null,Gk:null,Xn:new Float32Array(4),sj:new Float32Array(4)};if(b==a.Za)return c;switch(b){case a.pc:l(c,
40,.1,1E3);break;case a.If:l(c,2.5,.1,1E3);break;case a.we:break;case a.Qg:break;case a.Rg:break;case a.tb:case a.Bb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function f(b,c,d){if(b.type!=a.tb&&b.type!=a.Bb)throw"set_stereo_params(): wrong camera type";b.Xh=c;b.Pc=d;B(b,b.jb);if(m.W())for(c=m.get_active(),b=c.d.wc,c=c.camera.d.M,d=0;d<c.length;d++)A(c[d],b)}function b(a,b){var c=a.d,d=H.quat_to_dir(c.quat,H.AXIS_MY,Q),e=Math.asin(d[1]/
D.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?H.quat_to_dir(c.quat,H.AXIS_MZ,T):H.quat_to_dir(c.quat,H.AXIS_Z,T)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function l(b,c,d,e,g){switch(b.type){case a.pc:case a.tb:case a.Bb:b.od=c;b.jb=1;break;case a.If:b.top=c;b.jb=1;break;case a.we:delete b.od;b.od=c;b.jb=g/c;break;case a.Qg:b.top=c;b.jb=g/c;break;default:K.error("set_frustum(): Unsupported camera type: "+b.type)}b.Fa=
d;b.La=e}function e(b,c){var d=c.d.e,e=c.d.quat,g=L;V.rotateX(c.d.H,-Math.PI/2,g);V.invert(g,b.ea);if(b.hb){var g=b.hb[0],f=b.hb[1],m=b.hb[2],h=b.hb[3],k=L;k[0]=1-2*g*g;k[1]=-2*g*f;k[2]=-2*g*m;k[3]=0;k[4]=-2*g*f;k[5]=1-2*f*f;k[6]=-2*f*m;k[7]=0;k[8]=-2*g*m;k[9]=-2*f*m;k[10]=1-2*m*m;k[11]=0;k[12]=-2*g*h;k[13]=-2*f*h;k[14]=-2*m*h;k[15]=1;V.multiply(b.ea,k,b.ea);B(b,b.jb,!0);g=z;f=L;V.invert(b.ea,f);V.transpose(f,f);U.transformMat4(b.hb,f,g);f=ia;f[0]=(H.sign(g[0])+b.ia[8])/b.ia[0];f[1]=(H.sign(g[1])+
b.ia[9])/b.ia[5];f[2]=-1;f[3]=(1+b.ia[10])/b.ia[14];U.scale(g,2/(g[0]*f[0]+g[1]*f[1]+g[2]*f[2]+g[3]*f[3]),g);b.ia[2]=g[0];b.ia[6]=g[1];b.ia[10]=g[2]+1;b.ia[14]=g[3]}b.type==a.tb?b.ea[12]+=b.Pc/2:b.type==a.Bb&&(b.ea[12]-=b.Pc/2);V.multiply(b.ia,b.ea,b.Df);s(b);q(b);D.copy(b.Sd,b.uo);D.copy(d,b.Sd);P.copy(e,b.quat)}function k(b,c,d,e){V.lookAt(c,d,e,b.ea);b.type==a.tb?b.ea[12]+=b.Pc/2:b.type==a.Bb&&(b.ea[12]-=b.Pc/2);V.multiply(b.ia,b.ea,b.Df);s(b);q(b);D.copy(c,b.Sd)}function d(b){b=b.d;if(b.pb){var c=
Q;b.T==a.MS_TARGET_CONTROLS?D.subtract(b.e,b.Wa,c):H.quat_to_dir(b.quat,H.AXIS_MY,c);c[1]=0;D.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.T==a.MS_EYE_CONTROLS&&(d*=-1);b.pb.left+=d;b.pb.right+=d}}function r(b){b=b.d;if(b.Aa){var c=Q;b.T==a.MS_TARGET_CONTROLS?D.subtract(b.e,b.Wa,c):H.quat_to_dir(b.quat,H.AXIS_MY,c);D.normalize(c,c);c=Math.asin(c[1]);b.Aa.Qa+=c;b.Aa.Ka+=c}}function x(a){a=a.d;if(a.pb)if(a.Aa){var b=H.ze(a.Aa.Qa+Math.PI/2),c=H.ze(a.Aa.Ka+Math.PI/2);if(c>Math.PI)a.Aa=
{Ka:-Math.PI/2,Qa:Math.PI/2};else if(b>Math.PI||b<c)a.Aa.Qa=Math.PI/2}else a.Aa={Ka:-Math.PI/2,Qa:Math.PI/2}}function n(a){a=H.quat_to_dir(a.d.quat,H.AXIS_MY,Q);D.normalize(a,a);return-Math.asin(a[1])}function t(a,b,c){if(b==c)return c-a;a=H.ze(a);b=H.ze(b);c=H.ze(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=H.ze(c+b);a=H.ze(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function w(a,b,c){a=a.d;var d=D.subtract(a.Wa,a.e,Q);b=P.setAxisAngle(b,c,X);D.transformQuat(d,
b,d);D.subtract(a.Wa,d,a.e);P.multiply(b,a.quat,a.quat)}function B(b,c,d){switch(b.type){case a.pc:if(!c)throw"No aspect ratio";b.jb=c;case a.we:V.perspective(H.dx(b.od),b.jb,b.Fa,b.La,b.ia);break;case a.If:if(!c)throw"No aspect ratio";b.jb=c;case a.Qg:c=b.top*b.jb;V.ortho(-c,c,-b.top,b.top,b.Fa,b.La,b.ia);break;case a.Rg:V.ortho(b.left,b.right,b.bottom,b.top,b.Fa,b.La,b.ia);break;case a.tb:case a.Bb:if(!c)throw"No aspect ratio";b.jb=c;var e=Math.tan(b.od*Math.PI/360);c=b.Fa*e;var g=b.jb*b.Xh*e;b.type==
a.tb?(e=g-b.Pc/2,g+=b.Pc/2):(e=g+b.Pc/2,g-=b.Pc/2);e=-(b.Fa/b.Xh*e);g*=b.Fa/b.Xh;V.frustum(e,g,-c,c,b.Fa,b.La,b.ia);b.left=e;b.right=g;break;case a.Za:return;default:throw"Wrong camera type: "+b.type;}d||(V.multiply(b.ia,b.ea,b.Df),s(b),q(b))}function q(a){V.copy(a.ea,a.Mc);a.Mc[12]=0;a.Mc[13]=0;a.Mc[14]=0;a.Mc[15]=1;V.multiply(a.ia,a.Mc,a.Mc);V.invert(a.Mc,a.Mc)}function s(a){V.copy(a.ea,a.Lg);V.multiply(a.ia,a.Lg,a.Lg);V.invert(a.Lg,a.Lg)}function y(b,c,d,e,g){e||(e=new Float32Array(24));c||(c=
b.Fa);d||(d=b.La);var f,m,h,k,E,l,q,n;switch(b.type){case a.Za:throw"Extraction from NONE camera is not possible";case a.pc:case a.we:f=c*Math.tan(b.od*Math.PI/360);k=-f;m=f*b.jb;h=-m;E=d/c*f;n=-E;l=E*b.jb;q=-l;break;case a.If:case a.Qg:h=b.top*b.jb;f=E=b.top;m=l=h;k=n=-b.top;h=q=-h;break;case a.Rg:f=E=b.top;m=l=b.right;k=n=b.bottom;h=q=b.left;break;case a.tb:case a.Bb:E=c/b.Fa;f=c*Math.tan(b.od*Math.PI/360);k=-f;m=b.right*E;h=b.left*E;q=d/c;E=f*q;n=-E;l=m*q;q*=h;break;default:throw"Wrong camera type: "+
b.type;}e[0]=h;e[1]=k;e[2]=-c;e[3]=m;e[4]=k;e[5]=-c;e[6]=m;e[7]=f;e[8]=-c;e[9]=h;e[10]=f;e[11]=-c;e[12]=q;e[13]=n;e[14]=-d;e[15]=q;e[16]=E;e[17]=-d;e[18]=l;e[19]=E;e[20]=-d;e[21]=l;e[22]=n;e[23]=-d;g&&(c=L,V.invert(b.ea,c),H.ce(e,c,e,0));return e}function g(a){return"CAMERA"===a.type?!0:!1}function A(a,b){if(b.b4w_enable_csm){var c=b.csm_num;if(!a.ah){var d=b.csm_num;a.ah=Array(d);for(var e=0;e<d;e++)a.ah[e]=new Float32Array(3);a.Gk=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Fa:u(b,a,d-1),
g=u(b,a,d),e=y(a,e,g,G),e=I.Mv(e);a.ah[d].set(e.t);a.Gk[d]=e.ma;a.Xn[d]=D.length(e.t);a.sj[d]=S(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.sj[0]=b.first_cascade_blur_radius}function u(a,b,c){var d=a.csm_num,e=H.clamp(a.csm_first_cascade_border,b.Fa,b.La);a=H.clamp(a.csm_last_cascade_border,b.Fa,b.La);return H.clamp(S(e,a,d,c),b.Fa,b.La)}function S(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var I=p("__boundings");p("__config");
var v=p("__constraints"),K=p("__print"),m=p("__scenes"),H=p("__util"),D=p("vec3"),U=p("vec4"),P=p("quat"),Z=p("mat3"),V=p("mat4");a.Za=10;a.pc=20;a.If=30;a.we=40;a.Qg=50;a.Rg=60;a.tb=70;a.Bb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var M=new Float32Array(2),Q=new Float32Array(3),T=new Float32Array(3),X=new Float32Array(4);new Float32Array(4);var z=new Float32Array(4),ia=new Float32Array(4),W=new Float32Array(16),L=new Float32Array(16),G=new Float32Array(24);
a.Ct=function(b){var e=b.d,g=b.data;switch(g.type){case "PERSP":var f=c(a.pc);if(g.angle_y)var m=g.angle_y/Math.PI*180;l(f,m,g.clip_start,g.clip_end);break;case "ORTHO":f=c(a.If),l(f,g.ortho_scale/2,g.clip_start,g.clip_end)}f.name=b.name;e.cr=!1;e.T=h(g.b4w_move_style);e.dof_distance=b.data.dof_distance;e.Me=b.data.dof_object;e.dof_front=b.data.b4w_dof_front;e.dof_rear=b.data.b4w_dof_rear;e.dof_power=b.data.b4w_dof_power;e.lo=b.data.b4w_enable_hover_hor_rotation;e.M=[f];if(e.T==a.MS_TARGET_CONTROLS||
e.T==a.MS_EYE_CONTROLS||e.T==a.MS_HOVER_CONTROLS)e.xm=b.data.b4w_trans_velocity,e.wm=b.data.b4w_rot_velocity,e.ym=b.data.b4w_zoom_velocity;e.T==a.MS_TARGET_CONTROLS&&e.Wa.set(g.b4w_target);e=b.d;if(e.T===a.MS_TARGET_CONTROLS||e.T===a.MS_EYE_CONTROLS||e.T===a.MS_HOVER_CONTROLS)g=b.data,e.T===a.MS_TARGET_CONTROLS||e.T===a.MS_EYE_CONTROLS?(g.b4w_use_horizontal_clamping&&(e.pb={left:g.b4w_rotation_left_limit,right:g.b4w_rotation_right_limit}),g.b4w_use_vertical_clamping&&(e.Aa={Ka:g.b4w_rotation_down_limit,
Qa:g.b4w_rotation_up_limit}),"LOCAL"==g.b4w_horizontal_clamping_type&&d(b),"LOCAL"==g.b4w_vertical_clamping_type&&r(b),x(b),g.b4w_use_panning&&(e.ir=g.b4w_use_panning)):e.T===a.MS_HOVER_CONTROLS&&(g.b4w_use_horizontal_clamping&&g.b4w_horizontal_translation_min<=g.b4w_horizontal_translation_max&&(e.pb={left:g.b4w_horizontal_translation_min,right:g.b4w_horizontal_translation_max}),g.b4w_use_vertical_clamping&&g.b4w_vertical_translation_min<=g.b4w_vertical_translation_max&&(e.Aa={Ka:-g.b4w_vertical_translation_max,
Qa:-g.b4w_vertical_translation_min}),g.b4w_use_distance_limits&&g.b4w_hover_angle_min<=g.b4w_hover_angle_max&&(e.Oa={Ka:g.b4w_hover_angle_min,Qa:g.b4w_hover_angle_max})),e.zb=g.b4w_use_distance_limits&&g.b4w_distance_min<=g.b4w_distance_max,e.zb&&(e.Fc=g.b4w_distance_min,e.Pf=g.b4w_distance_max);e=b.d;if(e.T===a.MS_HOVER_CONTROLS&&e.zb)if(e.Oa){if(g=n(b),f=H.quat_to_dir(e.quat,H.AXIS_Z,Q),b=0,0<f[1]&&(b-=Math.asin(f[1]/D.len(f))),g>e.Oa.Qa?b+=g-e.Oa.Qa:g<e.Oa.Ka&&(b+=e.Oa.Ka-g),(b||0>g)&&K.warn("B4W Warning: Active hover camera has wrong orientation"),
b&&(g=H.quat_to_dir(e.quat,H.AXIS_X,T),b=P.setAxisAngle(g,-b,X),P.normalize(b,b),P.multiply(b,e.quat,e.quat)),b=H.quat_to_dir(e.quat,H.AXIS_MY,Q),g=z,g.set(H.AXIS_Y),g[3]=0,b=H.line_plane_intersect(g,0,e.e,b,e.Ud),!b||100<D.len(b))e.Ud[0]=e.e[0],e.Ud[1]=0,e.Ud[2]=e.e[2]}else e.zb=!1};a.lb=c;a.Qz=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.cb);case "DEPTH":return Boolean(a.hc);case "SCREEN":return!Boolean(a.cb)&&!Boolean(a.hc);default:throw"Wrong attachment type: "+b;}};a.zj=
function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.cb=c;break;case "DEPTH":a.hc=c;break;case "SCREEN":a.cb=null;a.hc=null;break;default:throw"Wrong attachment type: "+b;}};a.zA=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.cb;case "DEPTH":return a.hc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.xp=function(b,c){if(b.type!=a.pc||c!=a.tb&&c!=a.Bb)throw"make_stereo(): wrong camera type";b.type=c;f(b,6,.065)};a.Kx=f;a.pq=function(a,b){var c=a.d.quat,d=X,
e=Q;e[0]=0;e[1]=1;e[2]=0;P.setAxisAngle(e,b,d);P.multiply(d,c,c)};a.rB=function(a,b){var c=a.d.quat,d=X,e=Q;e[0]=1;e[1]=0;e[2]=0;P.setAxisAngle(e,b,d);P.multiply(d,c,c)};a.qB=function(a,b){var c=a.d.quat;P.invert(c,c);var d=X,e=Q;e[0]=0;e[1]=0;e[2]=1;P.setAxisAngle(e,-b,d);P.multiply(d,c,c);P.invert(c,c)};a.Vl=function(a,b){var c=a.d.quat;P.invert(c,c);var d=X,e=Q;e[0]=1;e[1]=0;e[2]=0;P.setAxisAngle(e,-b,d);P.multiply(d,c,c);P.invert(c,c)};a.get_angles=b;a.tq=l;a.Fx=function(b,c,d,e,g,f,m){switch(b.type){case a.Rg:b.left=
c;b.right=d;b.bottom=e;b.top=g;b.Fa=f;b.La=m;break;default:K.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.T};a.tB=e;a.uB=k;a.wq=function(a,b,c){var d=Q;d[0]=0;d[1]=-1;d[2]=0;D.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=T;e[0]=0;e[1]=0;e[2]=-1;D.transformQuat(e,c,e);k(a,b,d,e)};a.sB=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e.set(b);a.quat.set(c)};a.Zu=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];
d[2]=a[2];V.lookAt(a,b,c,L);V.invert(L,L);V.rotateX(L,Math.PI/2,L);Z.fromMat4(L,W);P.fromMat3(W,e)};a.dr=function(a){var b=a.d.M;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var g=b[d];e(g,a);H.qo(g.Df,g.Yk);if(g.Me)if(g.dof_on){var f=D.dist(c.e,g.Me.location);g.dof_distance=f}else g.dof_distance=0}};a.Iy=function(b){var c=b.d;if(c.T==a.MS_TARGET_CONTROLS)if(c.zb){if(v.rx(c.e,c.quat,c.Wa,c.Fc,v.wr)){var d=D.subtract(c.e,c.Wa,Q);D.scale(d,-c.Fc/D.length(d),d);D.add(c.Wa,d,c.e)}}else v.qx(c.e,
c.quat,c.Wa);c.T!=a.MS_TARGET_CONTROLS&&c.T!=a.MS_EYE_CONTROLS||v.correct_up(b,H.AXIS_Y)};a.jw=d;a.ez=r;a.zm=x;a.Mt=function(c){var d=c.d;if(d.T===a.MS_TARGET_CONTROLS||d.T===a.MS_EYE_CONTROLS){if(d.pb){var e=d.pb.left,g=d.pb.right,f=b(c,M),f=f[0],f=d.T==a.MS_TARGET_CONTROLS?f-Math.PI:-1*f;if(f=t(f,e,g))d.T==a.MS_TARGET_CONTROLS?w(c,H.AXIS_Y,f):(f=P.setAxisAngle(H.AXIS_MY,f,X),P.multiply(f,c.d.quat,c.d.quat))}d.Aa&&(e=d.Aa.Ka,g=d.Aa.Qa,f=b(c,M),f=f[1],d.T==a.MS_TARGET_CONTROLS&&(f*=-1),f=0<H.quat_to_dir(d.quat,
H.AXIS_Z,Q)[1]?H.sign(f)*Math.PI-f:f,f=t(f,e,g))&&(d.T==a.MS_TARGET_CONTROLS?(e=H.quat_to_dir(c.d.quat,H.AXIS_MX,T),w(c,e,f)):(e=f,f=c.d,g=H.quat_to_dir(f.quat,H.AXIS_X,Q),e=P.setAxisAngle(g,e,X),P.multiply(e,f.quat,f.quat)));d.T===a.MS_TARGET_CONTROLS&&d.zb&&(f=c.d,e=D.subtract(f.e,f.Wa,Q),g=D.length(e),g>f.Pf?(D.scale(e,f.Pf/g,e),D.add(f.Wa,e,f.e)):g<f.Fc&&(g=H.quat_to_dir(f.quat,H.AXIS_MY,T),D.scale(g,100*f.Fc,g),D.add(e,g,e),D.scale(e,-f.Fc/D.length(e),e),D.add(f.Wa,e,f.e)))}d.T===a.MS_HOVER_CONTROLS&&
(d=c.d,f=d.zb?d.Ud:d.e,d.pb&&(f[0]=H.clamp(f[0],d.pb.left,d.pb.right)),d.Aa&&(f[2]=H.clamp(f[2],d.Aa.Ka,d.Aa.Qa)),d=c.d,d.zb&&(e=H.quat_to_dir(d.quat,H.AXIS_Z,Q),f=0,0<e[1]&&(f=Math.asin(e[1]/D.len(e))),e=D.negate(b(c,M),M),e[1]<d.Oa.Ka?f+=e[1]-d.Oa.Ka:e[1]>d.Oa.Qa&&(f+=e[1]-d.Oa.Qa),f&&(e=H.quat_to_dir(d.quat,H.AXIS_X,T),D.normalize(e,e),f=P.setAxisAngle(e,f,X),P.normalize(f,f),P.multiply(f,d.quat,d.quat)),f=Q,c=c.d,c.zb?(e=H.quat_to_dir(c.quat,H.AXIS_MY,Q),D.normalize(e,e),c.Oa.Qa-c.Oa.Ka?(g=(-Math.asin(e[1])-
c.Oa.Ka)/(c.Oa.Qa-c.Oa.Ka),g=Math.max(g,0)):g=0,c=D.scale(e,-(g*(c.Pf-c.Fc)+c.Fc),f)):c=null,D.add(d.Ud,c,d.e)))};a.Io=n;a.XA=function(b){switch(b.type){case a.pc:case a.If:case a.tb:case a.Bb:return!0;default:return!1}};a.xv=function(b){b=b.d.M[0];switch(b.type){case a.pc:case a.we:case a.tb:case a.Bb:return Math.PI*b.od/180;default:return K.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.mg=B;a.zt=q;a.At=s;a.Wu=y;a.nt=function(a){a=a.d;var b=I.Xc();b.min_x=-1;b.max_x=1;b.min_y=-1;
b.max_y=1;b.min_z=-1;b.max_z=1;a.Db=b;var c=I.Ek(1,[0,0,0]);a.rc=c;a.lk=I.Sn(1,b);a.nk=I.Un(1,b);a.mk=I.Tn(1,b)};a.is_camera=g;a.Jb=function(b){return g(b)&&b.d&&b.d.T==a.MS_TARGET_CONTROLS?!0:!1};a.Fb=function(b){return g(b)&&b.d&&b.d.T==a.MS_HOVER_CONTROLS?!0:!1};a.rh=function(b){return g(b)&&b.d&&b.d.T==a.MS_EYE_CONTROLS?!0:!1};a.Nj=A;a.yu=u};
b4w.module.__lights=function(a,p){function h(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Lf:new Float32Array(3),Lq:0,Kq:0,tv:!1,jo:!1,Hg:!0,Jg:!0,Tf:1,distance:25,$u:"INVERSE_SQUARE"}}function c(a){a.Lf[0]=a.color[0]*a.Tf;a.Lf[1]=a.color[1]*a.Tf;a.Lf[2]=a.color[2]*a.Tf}var f=p("__util"),b=p("vec3");a.PA=h;a.yw=function(a){var e=a.data,k=h(e.type);k.name=a.name;k.Hg=e.use_diffuse;k.Jg=e.use_specular;var d=f.quat_to_dir(a.d.quat,f.AXIS_Y,[]);b.normalize(d,
d);k.direction[0]=d[0];k.direction[1]=d[1];k.direction[2]=d[2];k.color[0]=e.color[0];k.color[1]=e.color[1];k.color[2]=e.color[2];k.Tf=e.energy;c(k);k.distance=e.distance;if("POINT"===k.type||"SPOT"===k.type)k.$u=e.falloff_type;"SPOT"===k.type&&(k.Lq=e.spot_size,k.Kq=e.spot_blend);k.tv=e.b4w_generate_shadows;k.jo=e.b4w_dynamic_intensity;a.Ca=k};a.Hx=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];c(a)};a.uq=function(a,b){a.Tf=b;c(a)};a.Ny=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var b=a.Ca;b&&f.quat_to_dir(a.d.quat,f.AXIS_Y,b.direction)}};
b4w.module.__scenes=function(a,p){function h(){if(!Za)throw"no active scene";return Za}function c(){return Za?!0:!1}function f(a,b,c,d){d|=0;for(var e=null,E=0;E<b.length;E++){var g=b[E];if((c?g.origin_name:g.name)==a&&g.d.jd==d){e=g;break}}return e}function b(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function e(b){if("NONE"==Ha.ge||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==v(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=v(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var E=b[e];E.b4w_shadow_cast&&(c=!0);E.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function k(a,b,c){c=ha.Ah(a,b);ha.pe(a,c,function(a,c,d){if(d.xa){switch(d.G){case "COLOR":case "CUBEMAP":a=c.h.cb;break;case "DEPTH":a=c.h.hc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";
c=b.l;for(var e=0;e<c.length;e++){var E=c[e].k;ma.Cn(E.Yb,d.V)&&L.pi(E,a,d.V)}}}});for(a=0;a<b.Z.length;a++){var d=b.Z[a],e=b.Rc[a];switch(d.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var E=b.l,g=0;g<E.length;g++)c=E[g].k,ma.Cn(c.Yb,d.V)&&L.pi(c,e,d.V)}}}function d(a,b,c,d,e){for(var g=b.d,f=b.P,J=0;J<f.length;J++){var h=f[J];if(!(h.Ob||h.Mb||"MAIN"!=h.type&&"NODES"!=h.type&&"PARTICLES"!=h.type||B(a,h))){if("OPAQUE"===d){if(h.qa)continue;var q=ua.Ma(c,
"SHADOW_CAST")&&h.rb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!h.qa)continue;if("XRAY"==d!=h.mc)continue;if(ua.Ma(c,"SHADOW_CAST")&&h.rb)switch(Ha.ge){case "DEPTH":q="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else q="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==h.type&&h.Ts&&(b.d.Hz.push(h.Ts),b.d.Gz.push(h.Iz));var l=h.Xa,C=e.d.wc;ma.J(l,"SHADOW_SRC",q);L.ik(h,C);ma.J(l,"NUM_LIGHTS",a.mf);"special_skydome.glslf"==ma.Ho(l)&&ma.J(l,
"REFLECTION_PASS",0);ma.J(l,"SSAO_ONLY",0);a.Ba&&a.xc?ma.J(l,"WATER_EFFECTS",1):ma.J(l,"WATER_EFFECTS",0);a.Ba&&a.Ge&&g.Ge?(ma.J(l,"CAUSTICS",1),ma.J(l,"CAUST_SCALE",a.yn),ma.J(l,"CAUST_SPEED",ma.u(a.zn,2)),ma.J(l,"CAUST_BRIGHT",a.xn)):ma.J(l,"CAUSTICS",0);a.Ba&&(ma.J(l,"WAVES_HEIGHT",ma.u(a.te)),ma.J(l,"WAVES_LENGTH",ma.u(a.Ef)),ma.J(l,"WATER_LEVEL",ma.u(a.se)));h.uc&&ua.Ma(c,"MAIN_REFLECT")&&-1===h.ac.indexOf("u_mirrormap")?ma.J(l,"REFLECTIVE",1):ma.J(l,"REFLECTIVE",0);if(C=ua.Ma(c,"SKY"))if(h.fq){var u=
C.h.cb;L.pi(h,u,"u_sky")}else Ha.Kh?(h.Ec=C.Ec,ma.J(l,"PROCEDURAL_FOG",1)):ma.J(l,"PROCEDURAL_FOG",0);else ma.J(l,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){u=null;if(e.d.Wh.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)u=C.h.cb;else for(J=0;J<a.qg.length;J++)if(a.qg[J].texture.b4w_use_as_environment_lighting){u=L.Bv(a.qg[J],!1);break}u?(ma.J(l,"SKY_TEXTURE",1),L.pi(h,u,"u_sky_texture")):E.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}h.ya&&
(C=ua.Ma(c,"GRASS_MAP"))&&w(h,C,g);ua.Ma(c,"REFRACT")&&h.Rl?ma.J(l,"REFRACTIVE",1):ma.J(l,"REFRACTIVE",0);h.re&&(h.Em&&ua.Ma(c,"DEPTH")?ma.J(l,"SHORE_SMOOTHING",1):ma.J(l,"SHORE_SMOOTHING",0),h.water_dynamic&&a.Ba&&a.te?ma.J(l,"DYNAMIC",1):ma.J(l,"DYNAMIC",0));"PARTICLES"==h.type&&(ma.J(l,"SIZE_RAMP_LENGTH",h.Vp),ma.J(l,"COLOR_RAMP_LENGTH",h.Mp));for(var C=h.D,s=0;s<C.length;s++){var u=C[s],D=u.kj;if(D){var v=D.d.Na,H=null,Y=null;ha.oe(v,function(a,b,c){if("SCREEN"==c.G)return H=ha.Ea(v,a),Y=c,!0});
if(!H||!Y)throw"Failed to assign RTT";Aa.Aj(u,Aa.s,Aa.s);Y.na=u;var A=H.h;A.cb=u;A.Td=ca.lq(u,null);m(D,u.em,u.em,!0);u=ua.Wn(v);for(A=u.length-1;0<=A;A--){var la=u[A],ja=la.h;fa.mg(ja,1);"MAIN_OPAQUE"==a.type&&ja.type==fa.pc&&fa.Nj(ja,D.d.wc);e.d.uf.unshift(la)}}}if(h.cg){var C=0,y;for(y in h.cg)C++;ma.J(l,"NUM_LAMP_LIGHTS",C);h.ql=new Float32Array(3*C);h.ol=new Float32Array(3*C);h.nl=new Float32Array(3*C);h.pl=new Float32Array(4*C);for(s=0;s<e.ab.LAMP.length;s++)r(h,e.ab.LAMP[s])}t(c,a,q);L.sb(h);
q={R:!0,Va:g,k:h};x(h);a.l.push(q);k(c,a,h);n(h)}}a.l.sort(function(a,b){var c;if(a.k&&b.k){c=a.k.qa;var d=b.k.qa;(c=c==d?0:c>d?1:-1)||(c=a.k.of,d=b.k.of,c=c==d?0:c>d?1:-1)}else c=0;return c})}function r(a,b){var c=b.uuid;if(c in a.cg){c=a.cg[c];a.ql.set(b.d.e,3*c);a.ol.set(b.Ca.direction,3*c);a.nl.set(b.Ca.Lf,3*c);var d=Ia;u(b.Ca,Ma,d);a.pl.set(d,4*c)}}function x(a){var b=a.Yb.attributes,c=a.bb.Kb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==
a.type)b=ma.Wv(a.Yb.Bm),10<b&&("MAIN"==a.type&&E.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials: "'+a.tc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.Af&&(c=O.Te(a.Af)),a.Ra&&(d=O.Te(a.Ra)),E.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.tc.join(", ")+'"')))}function n(a){8<a.D.length&&E.warn("B4W Warning: too many textures used - "+a.D.length+' (max 8), materials "'+a.tc.join(", ")+'"')}function t(a,b,c){for(var d=
0,e=ua.Jo(a,b),E=0;E<e.length;E++){var g=e[E];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=ua.cv(a,g,"SHADOW_CAST").h,b.jr=g.ea,b.ln=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.rf=b.rf||[],b.rf[d]=g.ia,d++)}}function w(a,b,c){a.Ib=b.Ib;var d=b.Ib[0],e=b.Ib[1],E=b.Ib[2];c=c.Db;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);E=0==E?c:Math.max(E,c);b.Ib[2]=E;b=b.h;fa.tq(b,E/2,-e,-d,E/2);fa.mg(b);d=a.gl||0;d=0==d?c:Math.max(d,c);a.gl=d}function B(a,b){for(var c=
a.l,d=0;d<c.length;d++){var e=c[d].k;if(e&&e.id==b.id)return!0}return!1}function q(a){var b=U(a,"MAIN_OPAQUE"),c=!0;ha.L(a.d.Na,function(d,e){"SHADOW_CAST"===e.type&&(s(e,b,e.l,a,c),c=!1)})}function s(b,c,d,e,E){if(0!=d.length){var g=b.h;c=c.h;var f=v(e,"LAMP",a.DATA_ID_ALL),f=(y(f)||f[0]).d;fa.wq(g,f.e,f.quat);Ea.copy(c.Sd,g.Sd);ba.copy(c.ea,g.zq);f=uc;G.Xc(f);for(var m=0;m<d.length;m++){var h=d[m].Va;0==m?G.Rn(h.Ia,f):G.mo(f,h.Ia)}d=G.Vu(f,tc);O.ce(d,g.ea,d);if(e.d.wc.b4w_enable_csm){e=Ea.copy(c.ah[b.Fk],
Fa);f=ba.invert(c.ea,Wa);O.ce(e,f,e);O.ce(e,g.ea,e);b=c.Gk[b.Fk];if(E)for(ub=0,E=2;E<d.length;E+=3)ub=Math.min(ub,d[E]);E=uc;E.max_x=e[0]+b;E.max_y=e[1]+b;E.max_z=0;E.min_x=e[0]-b;E.min_y=e[1]-b;E.min_z=ub}else{b=E=uc;c=pb;c.set(d);e=Na/9;d=ba.identity(Wa);ba.rotate(d,e,O.AXIS_MZ,d);m=f=-1;for(h=0;10>h;h++){var J=G.rt(c,sb),k=(J.max_x-J.min_x)*(J.max_y-J.min_y);if(-1==f||k<f)f=k,m=h,G.Rn(J,b);O.ce(c,d,c)}b=m*e;0<b&&(c=ba.identity(Wa),ba.rotate(c,b,O.AXIS_MZ,c),ba.multiply(c,g.ea,g.ea));b=E.max_x-
E.min_x;c=E.max_y-E.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(E.max_y+=e,E.min_y-=e):2<c/b&&(E.max_x+=e,E.min_x-=e));E.max_x+=.005;E.max_y+=.005;E.max_z+=.005;E.min_x-=.005;E.min_y-=.005;E.min_z-=.005}fa.Fx(g,E.min_x,E.max_x,E.min_y,E.max_y,-E.max_z,-E.min_z);fa.mg(g);O.qo(g.Df,g.Yk)}}function y(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function g(a,b){for(var c=b.d,d=b.P,e="COLOR_PICKING_XRAY"==a.type,E=0;E<d.length;E++){var g=d[E];if(g.mc==e&&"COLOR_ID"==
g.type&&!B(a,g)){L.U(g,"USE_GLOW",0);L.sb(g);var f={R:!0,Va:c,k:g};x(g);a.l.push(f)}}}function A(a){var b=O.Zg(a);a.Xa=JSON.parse(JSON.stringify(a.Xa));return b}function u(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.Hg?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.Jg?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.Lq/2),c[1]=a.Kq*(1-b)}}function S(a,b){for(var c=D(b,zb),d=a.Ca,e=a.d,g=d.index,f=0;f<c.length;f++){var m=c[f];m.df.set(e.e,
3*g);m.af.set(d.direction,3*g);m.$e.set(d.Lf,3*g);var h=Ma,J=Ia;u(d,h,J);switch(d.type){case "SUN":if(m.Vq.set(e.quat),m.Uq=d.Lf,"SKY"===m.type){var k=Fa;k[0]=k[1]=k[2]=1;var l=Math.acos(Ea.dot(m.Gj,k)),k=Math.acos(Ea.dot(d.direction,k));m.ij=Math.floor(l/.025)!=Math.floor(k/.025)?!0:!1;Ea.copy(d.direction,m.Gj);I(b,m)}else Ea.copy(d.direction,m.Gj);case "HEMI":case "POINT":case "SPOT":break;default:E.error("B4W Warning: unknown light type: "+d.type)}m.bf.set(h,4*g);m.cf.set(J,4*g);m.ta=!0;for(h=
0;h<m.l.length;h++)J=m.l[h].k,J.cg&&r(J,a)}}function I(a,b){ca.gh(b);if(b.ij)for(var c=D(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].l,E=0;E<e.length;E++){var g=e[E];g.R&&(g=g.k,L.Et(g)&&ca.Fy(g))}}function v(b,c,d){if(!b.ab)throw"Access to uninitialized scene";b=b.ab[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var E=b[e];E.d.jd==d&&c.push(E)}return c}function K(b){var c=[];b=v(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,
E=0;E<e.materials.length;E++){var g=e.materials[E];-1==c.indexOf(g)&&c.push(g)}return c}function m(a,b,c,d){for(var e=a.d,E=a.camera.d.M,g=0;g<E.length;g++){var f=E[g];fa.mg(f,b/c);e.Tl&&fa.Nj(f,e.wc)}e.Tl&&(e.jj=!0,U(a,"DEPTH").ta=!0,U(a,"MAIN_BLEND").ta=!0);fa.dr(a.camera);ua.Cy(e.Na,function(e,E,g){if(d||e.Fg){var f=e.ke*b,m=e.ke*c;if(E)for(E=0;E<g.Z.length;E++)g.Z[E]==e&&Aa.resize(e.na,f,m);else Aa.vh(e.na)&&Aa.resize(e.na,f,m),e=g.h,e.width=f,e.height=m,"DOF"==g.type&&P(a,{dof_power:g.h.dof_power,
dof_on:g.h.dof_on}),H(g,1/b,1/c)}})}function H(a,b,c){a=a.l;for(var d=0;d<a.length;d++){var e=a[d].k;e&&L.Vh(e,b,c)}}function D(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ha.L(a.d.Na,function(a,b){b.type==e&&c.push(b)})}return c}function U(a,b){return ua.Ma(a.d.Na,b)}function P(a,b){var c=U(a,"DOF");if(!c)return E.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Na;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.h.dof_distance=
b.dof_distance);"number"==typeof b.dof_front&&(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;for(var e=ua.eb(d,c,"POSTPROCESSING"),d=ua.eb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var g=e[d].l[0].k;g&&(L.xf(g,c.h.dof_power),H(e[d],1/c.h.width,1/c.h.height))}}c.ta=!0}function Z(a,b){var c=U(Za,"MAIN_OPAQUE");if(!c||!c.Ba)return E.error("get_water_surface_level() - no water parameters on this scene"),
0;var d=c.te,e=c.Ef,g=c.se,f=c.Ba;if(!d||!f.Sf)return f.se;var m=Ea.length(c.fi),h=c.time;m&&(h*=m);var J=La;J[0]=20/e*(a-.25*h);J[1]=20/e*(b-.25*h);m=O.An(J);J[0]=17/e*(b+.1*h);J[1]=17/e*(a+.1*h);var J=O.An(J),m=m+J-1,k=f.dst_noise_scale0,J=f.dst_noise_scale1,l=f.dst_noise_freq0,q=f.dst_noise_freq1,n=La;n[0]=k*(a+l*h);n[1]=k*(b+l*h);k=O.dm(n);n[0]=J*(b-q*h);n[1]=J*(a-q*h);J=O.dm(n);J=J*d*k;if(c.Sj)if(q=(a-c.he[0])/c.ie[0],n=(c.he[1]+b)/c.ie[1],q+=.5,n+=.5,1<q||0>q||1<n||0>n)d=J;else var q=O.Eo(Za.d.Zl,
c.og,q,n),k=f.dir_freq,C=f.dir_noise_scale,ca=f.dir_noise_freq,l=f.dir_min_noise_fac,n=f.dst_min_fac,c=e/c.fg/Math.PI,C=[C/e*(a+ca*h),C/e*(b+ca*h)],e=Math.sqrt(q),d=d*Math.max(q,f.dir_min_shore_fac)*Math.sin(e/c+k*h)*Math.max(O.dm(C),l),f=Math.max(e,n),d=d*(1-f)+J*f,m=m*q;else d=J;return g+(d+.05*m)}function V(a,b){a.th&&"POSTPROCESSING"==a.type&&b.R!=a.R&&(a.R=b.R);b.R||"GLOW"!=a.type||(a.Ok=0)}function M(a,b,c,d){var e=ha.Ea(a,b);fa.zj(e.h,c,d);e.jk=!0;ha.qe(a,b,function(b,e,E){E.xa&&E.G==c&&ua.Lt(E)&&
Q(a,b,E.V,d)});ha.pe(a,b,function(b,e,E){E.xa&&E.G==c&&E.G==E.V&&M(a,b,c,d)})}function Q(a,b,c,d){a=ha.Ea(a,b).l;for(b=0;b<a.length;b++)L.ox(a[b].k,d,c)}function T(a){var b=U(a,"GRASS_MAP");if(b){var c=b.h,d=a.camera.d,e=d.e;a=Fa;a[0]=0;a[1]=-b.Ib[2]/2;a[2]=0;Ea.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Ta;b[0]=0;b[1]=0;b[2]=0;b[3]=1;fa.wq(c,a,b)}}function X(a,b){ha.L(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.Z[0]||!d.Rc[0])throw"Wrong MOTION_BLUR subscene";var e=d.Z[0],E=d.Rc[0];
d.Rc[0]=d.h.cb;ha.qe(a,c,function(b,c,d){d.xa&&Q(a,b,d.V,E)});M(a,c,e.G,E);Q(a,c,e.V,d.Rc[0]);d.Ap=Math.exp(-b/d.fj)}})}function z(b,c){var d=0,e=b.Ks;0==e.pm&&(e.pm=c);var E=c-e.pm;if(e.kq&&E/e.Gh>=e.kq)a.clear_glow_anim(b);else{E%=e.Gh;if(E<e.So)switch(e=E/(e.So/5),E=Math.floor(e),E){case 0:d=(e-E)/2;break;case 1:d=(e-E)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-E)/2;break;case 4:d=.5-(e-E)/2}for(e=0;e<b.P.length;e++)E=b.P[e],"COLOR_ID"==E.type&&(E.Zf=d)}}function ia(a){ha.L(a.d.Na,function(a,b){b.ta=
!0})}function W(a){if("WIND"==a.field.type){a=a.d;O.quat_to_dir(a.quat,O.AXIS_Y,Rb);Ea.normalize(Rb,Rb);Ea.scale(Rb,a.Wk,Rb);a=lb;for(var b=0;b<a.length;b++)for(var c=D(a[b],Hb),d=0;d<c.length;d++)c[d].fi.set(Rb)}}var L=p("__batch"),G=p("__boundings"),fa=p("__camera"),da=p("__config"),C=p("__debug"),J=p("__geometry"),ha=p("__graph"),pa=p("__hud"),la=p("__objects");p("__particles");var Y=p("__prerender"),ja=p("__primitives"),E=p("__print"),ca=p("__renderer"),ua=p("__scenegraph"),ea=p("__sfx"),ma=p("__shaders"),
Aa=p("__textures"),O=p("__util"),Ea=p("vec3"),ba=p("mat4"),Ha=da.n,Ja="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),ab=["ARMATURE","EMPTY","MESH","SPEAKER"],Ka="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),zb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Ab=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Hb="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),
Bb=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Za=null,lb=[],qb=[],tb,kb,Na=Math.PI/2;a.Yj=0;a.Km=1;a.Lm=2;a.DATA_ID_ALL=-1;var La=new Float32Array(2),Fa=new Float32Array(3),Ma=new Float32Array(4),Ia=new Float32Array(4),Ta=new Float32Array(4),Wa=new Float32Array(16),tc=new Float32Array(24),pb=new Float32Array(24),uc=G.Xc(),sb=G.Xc(),Rb=new Float32Array(3),ub=null;a.set_active=function(a){Za=a;ea.Cx(a)};a.$w=function(a){var b=a.d;if(!a.bk){for(var c=ua.Wn(b.Na),d=0;d<c.length;d++)b.uf.push(c[d]);
m(a,tb,kb,!1)}a=D(a,Hb);for(c=0;c<a.length;c++)a[c].fi.set(Rb);for(d=0;d<b.uf.length;d++)"SHADOW_CAST"==b.uf[d].type&&ca.gh(b.uf[d])};a.get_active=h;a.W=c;a.Mi=function(){return lb};a.Oi=function(b,c,d,e){for(var g=lb,m=null,h="",J=0;J<g.length;J++){var k=v(g[J],"ALL",a.DATA_ID_ALL);switch(b){case a.Yj:h=c;m=f(c,k,!1,d);break;case a.Km:h=d;m=null;(k=f(c,k,!1,e))&&k.dupli_group&&(m=f(d,k.dupli_group.objects,!0,e));break;case a.Lm:for(var h=c[c.length-1],m=null,q=0;q<c.length;q++)if((m=f(c[q],k,0!=
q,d))&&m.dupli_group)k=m.dupli_group.objects;else break}if(m)break}m||E.warn("get object "+h+": not found");return m};a.et=function(a,c,d){for(var e in ab){var E=ab[e],g=b(a,E),f=c.d.Kg,m=!1;for(e=0;e<d.length;e++)if(m=!0,d[e].d&&d[e].d.bg){for(var h=0;h<f.length;h++)f[h]==d[e]&&(m=!1);m&&f.push(d[e])}E in c.ab||(c.ab[E]=[]);for(h=0;h<g.length;h++)O.Ye(g[h])&&g[h].proxy||(c.ab.ALL.push(g[h]),c.ab[E].push(g[h]))}};a.Zs=function(c,d){c.ab={ALL:[]};for(var g in Ja){var f=Ja[g],m=b(c,f);c.ab[f]=[];for(var h=
0;h<m.length;h++)O.Ye(m[h])&&m[h].proxy||(c.ab.ALL.push(m[h]),c.ab[f].push(m[h]))}c.d=c.d||{};f=c.d;m=c.camera.d;g=c.world.b4w_shadow_settings;h=f.wc={};h.csm_resolution=g.csm_resolution;h.self_shadow_polygon_offset=g.self_shadow_polygon_offset;h.self_shadow_normal_offset=g.self_shadow_normal_offset;h.b4w_enable_csm=g.b4w_enable_csm;h.b4w_enable_csm?(h.csm_num=g.csm_num,h.csm_first_cascade_border=g.csm_first_cascade_border,h.first_cascade_blur_radius=g.first_cascade_blur_radius,h.csm_last_cascade_border=
g.csm_last_cascade_border,h.last_cascade_blur_radius=g.last_cascade_blur_radius,h.fade_last_cascade=g.fade_last_cascade,h.blend_between_cascades=g.blend_between_cascades):(h.csm_num=1,h.csm_first_cascade_border=g.csm_first_cascade_border,h.first_cascade_blur_radius=g.first_cascade_blur_radius,h.csm_last_cascade_border=g.csm_last_cascade_border,h.last_cascade_blur_radius=g.last_cascade_blur_radius,h.fade_last_cascade=!1,h.blend_between_cascades=!1);f.Kg=[];for(g=0;g<d.length;g++)d[g].d&&d[g].d.bg&&
f.Kg.push(d[g]);g=c.world.b4w_fog_color;f.Eb=new Float32Array([g[0],g[1],g[2],c.world.b4w_fog_density]);a:{if(c.ab)for(g=c.ab.LAMP,h=0;h<g.length;h++)if("SUN"==g[h].Ca.type){g=!0;break a}g=!1}f.Dd=g;g=f.Dd;var h={},J=c.world.b4w_sky_settings;h.procedural_skydome=J.procedural_skydome&&g;h.use_as_environment_lighting=J.use_as_environment_lighting;h.pg=J.color;h.rayleigh_brightness=J.rayleigh_brightness;h.mie_brightness=J.mie_brightness;h.spot_brightness=J.spot_brightness;h.scatter_strength=J.scatter_strength;
h.rayleigh_strength=J.rayleigh_strength;h.mie_strength=J.mie_strength;h.rayleigh_collection_power=J.rayleigh_collection_power;h.mie_collection_power=J.mie_collection_power;h.mie_distribution=J.mie_distribution;!g&&J.procedural_skydome&&E.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");f.Wh=h;var k=c.world;g=[0,0,0];var h=[0,0,0],J=k.light_settings,q=k.texture_slots;if(J.use_environment_light)if("SKY_COLOR"==J.environment_color||"SKY_TEXTURE"==J.environment_color)g=
k.horizon_color.slice(0),h=k.zenith_color.slice(0);else if("PLAIN"==J.environment_color)g=[1,1,1],h=[1,1,1];else throw"Unsupported world environment color"+J.environment_color;k={};k.Rd=J.environment_energy;k.ic=g;k.nc=h;k.qg=q;f.tr=k;f.rl=v(c,"LAMP",a.DATA_ID_ALL).length;g=K(c);h=[];J=v(c,"MESH",a.DATA_ID_ALL);for(q=0;q<g.length;q++){var l=g[q];if(l.b4w_water){for(var k={},n=0;n<J.length;n++)for(var C=J[n],ca=C.data.materials,r=0;r<ca.length;r++)ca[r]==l&&(k.se=C.location[1]);if(Ha.deferred_rendering)for(k.Eb=
l.b4w_water_fog_color.slice(0),k.Eb.push(l.b4w_water_fog_density),l.b4w_water_dynamic?(k.Sf=!0,k.waves_height=l.b4w_waves_height,k.waves_length=l.b4w_waves_length,k.dst_noise_scale0=l.b4w_water_dst_noise_scale0,k.dst_noise_scale1=l.b4w_water_dst_noise_scale1,k.dst_noise_freq0=l.b4w_water_dst_noise_freq0,k.dst_noise_freq1=l.b4w_water_dst_noise_freq1,k.dir_min_shore_fac=l.b4w_water_dir_min_shore_fac,k.dir_freq=l.b4w_water_dir_freq,k.dir_noise_scale=l.b4w_water_dir_noise_scale,k.dir_noise_freq=l.b4w_water_dir_noise_freq,
k.dir_min_noise_fac=l.b4w_water_dir_min_noise_fac,k.dst_min_fac=l.b4w_water_dst_min_fac,k.waves_hor_fac=l.b4w_water_waves_hor_fac):(k.Sf=!1,k.waves_height=0,k.waves_length=0),k.Bi=null,k.uk=null,k.vk=new Float32Array(2),k.Cj=null,l=l.texture_slots,n=0;n<l.length;n++)C=l[n].texture,"VORONOI"==C.type&&(k.Bi=C.noise_scale,k.vk.set([.3,.7]),k.uk=C.noise_intensity),!0===C.b4w_shore_dist_map&&(k.Cj=C.image,k.og=C.image.size[0],k.Tx=C.b4w_shore_boundings,k.fg=C.b4w_max_shore_dist);else k.waves_height=0,
k.waves_length=0,k.Bi=null,k.uk=null,k.vk=null,k.Eb=null,k.Sf=!1;h.push(k)}}if(0<h.length){k=h[0];if(!k.Sf)for(q=0;q<h.length;q++)h[q].Sf&&(k=h[q]);g=k}else g=null;f.Ba=g;a:{g=v(c,"MESH",a.DATA_ID_ALL);for(h=0;h<g.length;h++)if(g[h].d.Kc){g=!0;break a}g=!1}f.zk=g||Ha.force_selectable;a:{g=v(c,"MESH",a.DATA_ID_ALL);for(h=0;h<g.length;h++)for(J=g[h].data.materials,q=0;q<J.length;q++)if(k=J[q],n=k.game_settings.alpha_blend,k.b4w_render_above_all&&"OPAQUE"!=n&&"CLIP"!=n){g=!0;break a}g=!1}f.mc=g;f.Fp=
0;if(Ha.deferred_rendering){g=c.bk;f.Tl=e(c);f.qA=c.world.b4w_fog_color;a:{if(Ha.shore_smoothing)for(h=K(c),J=0;J<h.length;J++)if(q=h[J],q.b4w_water&&q.b4w_water_shore_smoothing){h=!0;break a}h=!1}f.shore_smoothing=h;if(Ha.wj&&c.b4w_render_reflections)for(h=[],J=v(c,"MESH",a.DATA_ID_ALL),q=0;q<J.length;q++){if(k=J[q],k.b4w_reflective){a:{k=k.constraints;for(n=0;n<k.length;n++)if(l=k[n],"LOCKED_TRACK"==l.type&&"REFLECTION PLANE"==l.name){n=l.target;break a}n=null}n&&(k=n.location,n=n.d.quat,l=new Float32Array(4),
O.By(k,n,O.AXIS_Y,l),h.push(l))}}else h=!1;f.hx=h;h={};J=c.world.b4w_bloom_settings;h.blur=J.blur;h.Ou=J.edge_lum;h.key=J.key;f.ut=h;h={};J=c.world.b4w_motion_blur_settings;h.ej=J.motion_blur_decay_threshold;h.fj=J.motion_blur_factor;f.Hw=h;h={};J=c.world.b4w_color_correction_settings;h.brightness=J.brightness;h.contrast=J.contrast;h.exposure=J.exposure;h.saturation=J.saturation;f.Dt=h;h={};J=c.world.b4w_god_rays_settings;h.nw=J.intensity;h.eg=J.max_ray_length;h.xg=J.steps_per_pass;f.cw=h;h={};J=
c.world;h.ph=J.b4w_glow_color;h.Qi=J.b4w_glow_factor;f.$v=h;f.Rf=Ha.Rf&&(0<m.dof_distance||m.Me);a:{if(Ha.ya)for(J=h=!1,q=v(c,"MESH",a.DATA_ID_ALL),k=0;k<q.length;k++){l=q[k];C=l.data.materials;for(n=0;n<C.length;n++)C[n].b4w_terrain&&(h=!0);l=l.particle_systems;for(n=0;n<l.length;n++)C=l[n].settings,"HAIR"==C.type&&C.b4w_dynamic_grass&&(J=!0);if(h&&J){h=!0;break a}}h=!1}f.ya=h;f.gg=Ha.gg&&c.b4w_enable_motion_blur;f.Nf=Ha.Nf&&c.b4w_enable_color_correction;f.antialiasing=Ha.antialiasing&&c.b4w_enable_antialiasing;
f.Jf=Ha.Jf&&c.b4w_enable_bloom&&f.Dd;f.yf=Ha.yf&&c.b4w_enable_ssao;h={};J=c.world.b4w_ssao_settings;h.radius_increase=J.radius_increase;h.iw=J.hemisphere;h.vt=J.blur_depth;h.pn=J.blur_discard_value;h.influence=J.influence;h.dist_factor=J.dist_factor;h.sx=J.samples;f.ky=h;f.$f=Ha.$f&&c.b4w_enable_god_rays&&f.Dd;f.jg=Ha.jg&&c.b4w_render_refractions;f.glow=Ha.glow?f.zk:!1;f.Na=ua.ku(g,f,m)}else f.Na=ua.lu(m,f);f.uf=[];f.jj=!1;f.El=!1;lb.push(c)};a.Ak=b;a.dl=function(a){return a.d.Na};a.lv=function(a){ha.L(a,
function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=L.Vn(c.Jh);break;case "SSAO":d=L.su(c);break;case "SSAO_BLUR":d=L.tu(c);L.Vh(d,1/c.h.width,1/c.h.height);break;case "DEPTH_PACK":d=L.bu();break;case "REFRACT":case "SCREEN":d=L.Vn("NONE");break;case "GOD_RAYS":ua.eb(a,c,"WIREFRAME")||ua.eb(a,c,"MAIN_BLEND")||ua.eb(a,c,"GOD_RAYS");d=L.eu(c.Wp|0,(c.hb&&c.re)|0,c.xg);break;case "GOD_RAYS_COMBINE":ua.eb(a,c,"WIREFRAME")||ua.eb(a,c,"MAIN_BLEND");ua.eb(a,c,"GOD_RAYS");d=L.fu();break;case "MOTION_BLUR":d=
L.ju(c.ej);break;case "DOF":d=L.cu();L.xf(d,c.h.dof_power);for(var e=ua.eb(a,c,"POSTPROCESSING"),E=ua.eb(a,e,"POSTPROCESSING"),g=[e,E],f=0;f<g.length;f++){var m=g[f].l;(e=m[0].k)&&L.xf(e,c.h.dof_power)}break;case "GLOW":g=ua.eb(a,c,"POSTPROCESSING");f=ua.eb(a,g,"POSTPROCESSING");e=ua.eb(a,f,"POSTPROCESSING");E=ua.eb(a,e,"POSTPROCESSING");d=L.du();g=[f,g];for(f=0;f<g.length;f++)m=g[f].l,(m=m[0].k)&&L.xf(m,c.qn);g=[E,e];for(f=0;f<g.length;f++)m=g[f].l,(m=m[0].k)&&L.xf(m,c.po*c.Qi);break;case "COMPOSITING":d=
L.$t();break;case "ANTIALIASING":d=L.Wt();break;case "LANCZOS":d=L.gu(c.bB);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=L.qu(c.type);break;case "ANAGLYPH":d=L.Vt();break;case "SKY":d=L.pu();L.Vh(d,1/c.h.width,1/c.h.height);break;case "LUMINANCE":d=L.hu();break;case "AVERAGE_LUMINANCE":d=L.Xt();break;case "LUMINANCE_TRUNCED":d=L.iu();break;case "BLOOM_BLUR":d=L.Yt(c.Jh);L.Vh(d,1/c.h.width,1/c.h.height);break;case "BLOOM":d=
ua.eb(a,c,"BLOOM_BLUR");g=[ua.eb(a,d,"BLOOM_BLUR"),d];for(f=0;f<g.length;f++)m=g[f].l,(m=m[0].k)&&L.xf(m,c.bloom_blur);d=L.Zt();break;case "VELOCITY":d=L.wu()}d&&(e={R:!0,Va:la.Fi("NONE"),k:d},x(d),c.l.push(e),k(a,c,d),n(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.Na,e=b.d;!ua.Ma(c,"SHADOW_CAST")&&e.rb&&(e.rb=!1);for(var e=D(a,Ka),E=0;E<e.length;E++){var f=e[E],m=b,h=c,J=a;switch(f.type){case "MAIN_OPAQUE":d(f,m,h,"OPAQUE",J);break;case "MAIN_BLEND":d(f,m,h,"BLEND",J);
break;case "MAIN_XRAY":d(f,m,h,"XRAY",J);break;case "MAIN_REFLECT":h=m.d;m=m.P;for(J=0;J<m.length;J++){var l=m[J],q=A(l);if(!("MAIN"!=q.type&&"NODES"!=q.type&&"PARTICLES"!=q.type||B(f,q)||q.qa)&&q.Wb){var C=q.Xa;ma.J(C,"DISABLE_FOG",0);ma.J(C,"WATER_EFFECTS",0);"special_skydome.glslf"==ma.Ho(C)&&ma.J(C,"REFLECTION_PASS",1);ma.J(C,"SHADOW_SRC","SHADOW_SRC_NONE");ma.J(C,"TEXTURE_NORM",0);L.sb(q);C={R:!0,Va:h,k:q};x(q);f.l.push(C);"MAIN"==q.type&&(l.vb||(l.vb=[]),l.vb.push(q))}}break;case "DEPTH":l=
m.d;m=m.P;for(q=0;q<m.length;q++){var ca=m[q];if("DEPTH"==ca.type&&!B(f,ca)&&!ca.Ob){if(ua.hw(h,f,"SHADOW_CAST"))if(ca.rb){switch(Ha.ge){case "DEPTH":var C="SHADOW_SRC_DEPTH",r="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}ca=L.tm(ca,C,r);L.ik(ca,J.d.wc);ua.Jo(h,f);t(h,f,C)}else ca=L.tm(ca,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else ca=L.tm(ca,"SHADOW_SRC_NONE","SHADOW_DST_NONE");ca.ya&&(C=ua.Ma(h,"GRASS_MAP"))&&w(ca,C,l);L.sb(ca);C={R:!0,Va:l,k:ca};x(ca);f.l.push(C);k(h,f,ca);n(ca)}}break;
case "SHADOW_CAST":l=!1;q=m.d;m=m.P;for(C=0;C<m.length;C++)if(ca=m[C],ca.Nb||ca.rb)if(l=!0,"DEPTH"==ca.type&&!B(f,ca)&&ca.Nb){switch(Ha.ge){case "DEPTH":r="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}ca=L.ou(ca,r);ca.ya&&(r=ua.Ma(h,"GRASS_MAP"))&&w(ca,r,q);L.U(ca,"SHADOW_TEX_RES",ma.u(J.d.wc.csm_resolution));L.sb(ca);r={R:!0,Va:q,k:ca};x(ca);f.l.push(r)}l&&s(f,ua.Ma(h,"MAIN_OPAQUE"),f.l,J,!0);break;case "COLOR_PICKING":g(f,m);break;case "COLOR_PICKING_XRAY":g(f,m);break;case "GRASS_MAP":h=
m.d;m=m.P;for(J=0;J<m.length;J++)l=m[J],"GRASS_MAP"!=l.type||B(f,l)||(L.sb(l),q={R:!0,Va:h,k:l},x(l),f.l.push(q),l=f.h,r=h.Ia,q=f.Ib[0],C=f.Ib[1],ca=f.Ib[2],0==q&&0==C?(q=r.min_y,C=r.max_y):(q=Math.min(q,r.min_y),C=Math.max(C,r.max_y)),r=1E-4*(C-q),f.Ib[0]=q-r,f.Ib[1]=C+r,fa.tq(l,ca/2,-C,-q,ca/2),fa.mg(l));break;case "GLOW_MASK":h=m.d;m=m.P;for(J=0;J<m.length;J++)l=m[J],"COLOR_ID"!=l.type||B(f,l)||(q=A(l),L.U(q,"USE_GLOW",1),L.sb(q),m.push(q),C={R:!0,Va:h,k:q},x(q),f.l.push(C),l.vb||(l.vb=[]),l.vb.push(q));
break;case "WIREFRAME":for(J=m.d,m=m.P,l=0;l<m.length;l++)q=m[l],"WIREFRAME"!=q.type||B(f,q)||(q.ya&&(C=ua.Ma(h,"GRASS_MAP"))&&w(q,C,J),L.sb(q),C={R:!0,Va:J,k:q},x(q),f.l.push(C),k(h,f,q),n(q))}}break;case "LAMP":b.Ca.index=a.d.Fp++;c=D(a,zb);for(e=0;e<c.length;e++)c[e].mf++;S(b,a)}};a.HA=B;a.Wl=function(a){a.d.jj=!0};a.Hv=function(a,b){for(var c=a.d.wc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=fa.yu(c,b,e);return d};a.hide_object=function(a){a.d.qh=!0};a.show_object=function(a){a.d.qh=
!1};a.lx=function(a,b){for(var c=b.d,d=D(a,Ka),e=0;e<d.length;e++)for(var E=d[e].l,g=E.length-1;0<=g;g--){var f=E[g];f.Va==c&&(f.k&&J.In(f.k.bb),E.splice(g,1))}};a.check_object=function(a,b){return b.ab[a.type]&&-1<b.ab[a.type].indexOf(a)?!0:!1};a.Zx=function(a){var b=a.ab.LAMP;if(b.length==a.d.Fp){for(var c=[],d=0;d<b.length;d++)c[b[d].Ca.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var E=b[c[d]].Ca,g=b[c[e]].Ca;if(g.Hg&&g.Jg&&(!E.Hg||!E.Jg)||!E.Hg&&(g.Hg||!E.Jg&&g.Jg))E=c[d],
c[d]=c[e],c[e]=E}for(d=0;d<c.length;d++)b[c[d]].Ca.index=d,S(b[c[d]],a)}};a.Oj=S;a.Sy=function(b){var c=v(b,"LAMP",a.DATA_ID_ALL);if(c=y(c)||c[0]){b=D(b,zb);for(var d=0;d<b.length;d++)b[d].Aq=c.Ca.index}};a.cleanup=function(){for(var a=0;a<lb.length;a++){var b=lb[a];ha.L(b.d.Na,function(a,b){if("SINK"!=b.type){var c=b.h;ca.mx(c.Td,c.cb,c.hc,c.width,c.height);for(var c=b.l,d=0;d<c.length;d++){var e=c[d].k;e&&L.Nt(e)}}});b.d.Na=[];b.d.uf=[]}Za=null;lb.length=0;qb.length=0;Rb[0]=0;Rb[1]=0;Rb[2]=0};a.wp=
function(a,b,c){a=fa.Wu(a,a.Fa,a.La,null,!0);var d=ja.pv(a);a=la.Fi("DYNAMIC");a.Ia=a.Db={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.kb=a.rc=G.tt();var e=a.kb.ma;a.Fe=a.Ee=G.Dk([e,0,0],[0,e,0],[0,0,e],a.kb.t);c=L.nu(d,c);b.l.push({R:!0,Va:a,k:c})};a.la=v;a.Pv=function(a){return[a.frame_start,a.frame_end]};a.xq=function(a,b){tb=a;kb=b;Za&&m(Za,a,b,!1)};a.Vh=H;a.ry=D;a.ga=U;a.get_environment_colors=function(a){a=D(a,zb)[0];var b=a.ic,c=a.nc,d=[],e=[];d[0]=b[0];d[1]=b[1];
d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Rd,d,e]};a.set_environment_colors=function(a,b,c,d){a=D(a,zb);for(var e=0;e<a.length;e++){var E=a[e];isNaN(b)||(E.Rd=b);c&&E.ic.set(c);d&&E.nc.set(d);E.ta=!0}};a.get_sky_params=function(a){if(a=U(a,"SKY")){var b={};b.color=Array(3);Ea.copy(a.pg,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=
a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=U(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=
b.use_as_environment_lighting),"object"==typeof b.color&&c.pg.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=
b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ta=!0,c.ij=!0,I(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=D(a,Ab)[0].Eb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=D(a,Ab),d=0;d<c.length;d++){var e=
c[d];e.Eb.set(b);e.ta=!0}};a.get_ssao_params=function(a){var b=U(a,"SSAO");a=U(a,"SSAO_BLUR");if(!b)return null;var c=b.l[0].k,d={};d.ssao_quality=L.fb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.pn=a.ssao_blur_discard_value;d.radius_increase=b.ug;d.influence=b.tg;d.dist_factor=b.sg;d.ssao_only=b.ssao_only;d.ssao_white=L.fb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=U(a,"SSAO"),d=U(a,"SSAO_BLUR");if(!c)return E.error("SSAO is not enabled on scene"),
0;if("string"==typeof b.ssao_quality){var e=c.l[0].k;L.U(e,"SSAO_QUALITY",b.ssao_quality);L.sb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.l[0].k,L.U(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),L.sb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.l[0].k,L.U(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),L.sb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ug&&(c.ug=b.ug);"number"==typeof b.tg&&(c.tg=b.tg);"number"==typeof b.sg&&(c.sg=
b.sg);if("number"==typeof b.ssao_only){c=U(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var g=0;g<c.l.length;g++)e=c.l[g].k,L.U(e,"SSAO_ONLY",b.ssao_only),L.sb(e,!0)}"number"==typeof b.ssao_white&&(e=c.l[0].k,L.U(e,"SSAO_WHITE",b.ssao_white),L.sb(e,!0));c.ta=!0;d.ta=!0};a.get_dof_params=function(a){a=U(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=a.h.dof_power;return b};a.set_dof_params=P;a.get_god_rays_params=function(a){var b=
D(a,["GOD_RAYS"]);a=U(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].eg;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=L.fb(b[0].l[0].k,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=D(a,["GOD_RAYS"]),d=U(a,"GOD_RAYS_COMBINE");if(!c||!d)return E.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=
b.god_rays_max_ray_length,g=0;g<c.length;g++)c[g].eg=e,c[g].vj=e/c[g].xg/(g+1),c[g].ta=!0;if("number"==typeof b.god_rays_steps)for(var f=ma.u(b.god_rays_steps,1),e=c[0].eg,g=0;g<c.length;g++){c[g].xg=f;c[g].vj=e/f/(g+1);c[g].ta=!0;var m=c[g].l[0].k;L.U(m,"STEPS_PER_PASS",f);L.sb(m,!0)}d.ta=!0};a.get_bloom_params=function(a){var b=U(a,["LUMINANCE_TRUNCED"]);a=U(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=
function(a,b){var c=U(a,"LUMINANCE_TRUNCED"),d=U(a,"BLOOM");if(!c||!d)return E.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ta=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ta=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.Na,c=ua.eb(e,d,"BLOOM_BLUR"),e=ua.eb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var g=c[e].l[0].k;g&&(L.xf(g,b.bloom_blur),H(c[e],1/d.h.width,1/d.h.height))}};a.get_wind_params=function(){var a=
Rb,b=Ea.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=v(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var g=d[e];if("EMPTY"===g.type&&g.field&&"WIND"===g.field.type)var f=g}if(!f)return E.error("There is no wind on the scene"),0;d=f.d;"number"==typeof c.wind_dir&&(Fa=[0,c.wind_dir/180*Math.PI,-Math.PI/2],O.euler_to_quat(Fa,Ta),d.quat.set(Ta),W(f));"number"==typeof c.wind_strength&&(d.Wk=c.wind_strength,
W(f));ia(b)};a.xx=function(a){a.d.El=!0};a.get_water_surface_level=Z;a.get_water_mat_params=function(a,b){var c=U(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.te,b.waves_length=c.Ef,c.xc)){b.water_fog_density=c.xc[3];var d=b.water_fog_color=[];d[0]=c.xc[0];d[1]=c.xc[1];d[2]=c.xc[2]}};a.set_water_params=function(a,b){var c=U(a,"MAIN_OPAQUE");if(!c||!c.Ba)return E.error("set_water_params() - no water parameters on this scene"),null;c=c.Ba;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);
"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);
"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Sf=b.water_dynamic);for(var d=D(a,Bb),e=0;e<d.length;e++){var g=d[e];"number"==typeof b.water_fog_density&&c.Eb&&(g.xc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Eb&&g.xc.set(b.water_fog_color);"number"==typeof b.waves_height&&(g.te=b.waves_height);
"number"==typeof b.waves_length&&(g.Ef=b.waves_length);g.ta=!0}};a.get_shore_dist=function(a,b){var c=U(Za,"MAIN_OPAQUE");if(!c.Sj)return 100;var d=c.fg,e=c.se,g=(a[0]-c.he[0])/c.ie[0],E=(c.he[1]+a[2])/c.ie[1],g=g+.5,E=E+.5;if(!(1<g||0>g||1<E||0>E))return c=d*O.Eo(Za.d.Zl,c.og,g,E),e=(e-a[1])*b,Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var c=h().camera.d,d=0;d<lb.length;d++){var e=lb[d],g=e.d.Na;if(e.d.Ba)var E=c.e[1]-Z(c.e[0],c.e[2]);for(var f=e.d.Kg,m=0;m<f.length;m++){var J=f[m].d.wa,k=f[m].d.Xk+
f[m].d.Ta;if(J){var l=f[m].d,C=Math.round(J.currentTime*l.Pe),n=l.Ta/l.Pe;if(C<l.Ta-(Ha.Ze?5:0)||f[m].d.ai&&C>k)J.currentTime=n;!f[m].d.ai&&C>k&&J.pause();2<=J.readyState&&Aa.Vy(l)}}ha.L(g,function(b,c){-1<Hb.indexOf(c.type)&&(c.time=a);-1<Bb.indexOf(c.type)&&e.d.Ba&&(c.tk=E)})}if(Ha.deferred_rendering)for(d=0;d<qb.length;d++)z(qb[d],a);for(d=0;d<lb.length;d++)if(e=lb[d],m=e.d,c=m.uf,m.jj&&(q(e),m.jj=!1),m.El&&(T(e),m.El=!1),c.length){e.b4w_enable_motion_blur&&X(m.Na,b);if(Ha.deferred_rendering&&
m.glow){for(var g=U(e,"GLOW_MASK").l,r=0,m=0;m<g.length;m++)r+=g[m].k.Zf;ha.L(e.d.Na,function(a,b){"GLOW"===b.type&&(b.Ok=r)})}g=null;for(m=0;m<c.length;m++)"GLOW_MASK"==c[m].type&&(g=m);for(m=0;m<c.length;m++)f=c[m],Y.Pl(f),null!==g&&V(f,c[g]),ca.gh(f)}Ha.show_hud_debug_info&&pa.Ux(lb,b)};a.bl=function(a){var b=[];ha.L(a.d.Na,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.Ks={pm:0,So:b,Gh:c,kq:d};-1==qb.indexOf(a)&&qb.push(a)};a.clear_glow_anim=function(a){if(a.P)for(var b=
0;b<a.P.length;b++){var c=a.P[b];"COLOR_ID"==c.type&&(c.Zf=0)}a=qb.indexOf(a);-1!=a&&qb.splice(a,1)};a.Xz=function(){qb=[]};a.get_cam_water_depth=function(){var a=U(Za,"MAIN_BLEND"),b=Za;return a||b.d.Ba?a.tk:null};a.get_object_data_id=function(a){return a.d.jd};a.gr=ia;a.Qx=function(a,b){switch(b){case "WM_NONE":a.R=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_mode=C.Qm[b];a.R=
!0}a.qa="WM_TRANSPARENT_WIREFRAME"==b;a.ta=!0};a.Px=function(a,b){for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_edge_color=b,a.ta=!0};a.Ym=function(a,b){for(var c=0;c<b.length;c++)a.ab.ALL.push(b[c]),a.ab.MESH.push(b[c])};a.fr=W;a.pick_object=function(b,d){if(!c())return E.error("No active scene"),null;var e=h(),g=U(e,"COLOR_PICKING");if(g){Y.Pl(g);ca.gh(g);var f=U(e,"COLOR_PICKING_XRAY");f?(Y.Pl(f),ca.gh(f),g=f.h):g=g.h;d=g.height-d;g=ca.fx(g.Td,b,d);e=v(e,"MESH",a.DATA_ID_ALL);for(f=0;f<e.length;f++){var m=
e[f].Sm;if(m&&5>Math.abs(255*m[0]-g[0])&&5>Math.abs(255*m[1]-g[1])&&5>Math.abs(255*m[2]-g[2]))return e[f]}}else E.error("Color picking is not available");return null};a.Yv=function(){return Rb};a.Qv=function(b){var c=[];b=v(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.Kc&&c.push(e)}return c}};
b4w.module.__physics=function(a,p){function h(a,b){for(var c=a.Fd,d=0;d<c.length;d++)c[d].d.Qj&&b.push(c[d]),h(c[d],b)}function c(a,b){if(T)switch(a){case v.Fr:S.log(b);break;case v.Cr:S.error(b);break;case v.Dr:I.fbmsg.apply(this,b.slice(1));break;case v.Jr:var c=f(b.body_id);if(c){var d=b.trans,e=b.quat,g=b.linvel,E=b.angvel,c=c.j;c.Hk=b.time;H.Uh(d,1,e,c.Ik);P.copy(g,c.tp);P.copy(E,c.$m)}break;case v.Hr:(d=f(b.chassis_hull_body_id))&&H.Uh(b.trans,1,b.quat,d.f.Lh[b.prop_ind]);break;case v.Er:if(c=
f(b[1]))d=b[4],c=c.qc.vi[b[2]],m.set_translation(c,b[3]),m.set_rotation(c,d),m.v(c);break;case v.Kr:if(c=f(b[1]))c.f.speed=b[2];break;case v.Ar:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,g=b.coll_point,d=parseInt(d),E=T.j.l,h=0;h<E.length;h++)for(var k=E[h].gb,q=0;q<k.Cc.length;q++){for(var l=k.Cc[q],C=l.oj,n=!1,r=0;r<C.length;r++){var t=C[r];if(t[0]===d&&t[1]===c){l.Zp[r]=e;n=!0;break}}if(n){C=l.Zp;for(r=n=0;r<C.length;r++)n=n||C[r];l.callback(n,g)}}break;case v.Br:if(c=f(b[1]))c=c.j,c.Di&&c.Di(b[2]);
break;case v.Ir:if(c=f(b.body_id))for(c=c.j,e=b.from,g=b.to,E=b.local,h=b.body_id_b_hit,k=b.cur_result,q=0;q<c.de.length;q++)if(C=c.de[q],D.Ci(C.G,e)&&D.Ci(C.V,g)&&C.local==E){for(d in C.yd)C.yd[d]=1;-1!=h&&(C.yd[h]=k);for(var l=C.Qb,r=C.callback,C=C.yd,n=!1,t=1,u=0;u<T.j.l.length;u++){var w=T.j.l[u].gb;if(("ANY"==l||w.id==l)&&w.F in C&&1!==C[w.F]){n=!0;t=C[w.F];break}}r(n,t)}break;case v.Gr:console.log("Physics message ping: ",performance.now()-b[1]);break;default:S.error("Wrong message: "+a)}}function f(a){return z[a]||
null}function b(){ia.body++;return ia.body}function l(a){return{F:a,yl:0,Xi:!1,je:!0,ZA:!1,is_character:!1,rw:!1,Ei:null,id:"",Zz:{},Cc:[],Di:null,de:[],Hk:0,Ik:new Float32Array([0,0,0,1,0,0,0,1]),tp:new Float32Array(3),$m:new Float32Array(3),zi:new Float32Array(3),yi:new Float32Array(4)}}function e(a,b){switch(a){case "BOX":var c=b.Db;break;case "CYLINDER":c=b.nk;break;case "CONE":c=b.mk;break;case "SPHERE":c=b.rc;break;case "CAPSULE":c=b.lk}return c}function k(a){if(!a)return null;var b={};"number"===
typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.t&&(b.center=a.t);"number"===typeof a.ma&&(b.radius=a.ma);"number"===typeof a.height&&(b.height=a.height);return b}function d(a,b,c,d){var e=a.d.e,g=b.d.H,E=new Float32Array(16);V.invert(g,E);g=new Float32Array(3);P.transformMat4(e,
E,g);switch(b.f.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Db;v.m(v.Mr,c,g,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:v.m(v.Lr,c,g,a.AB)}}function r(a){return a.j&&a.j.Ei?!0:!1}function x(a,b,c,d,e,g,E,f,m,h){var k;ia.Qn++;k=ia.Qn.toString(16);v.m(v.Tr,k,a,f,b.j.F,c,d,e.j.F,g,E,m,h);b.j.Ei=k}function n(a){var b=a.j;if(b&&(0===b.yl||!0===b.Xi||!1===b.je||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.j.zi[0]||a.d.e[1]!=a.j.zi[1]||a.d.e[2]!=a.j.zi[2]||
a.d.quat[0]!=a.j.yi[0]||a.d.quat[1]!=a.j.yi[1]||a.d.quat[2]!=a.j.yi[2])){a.j.zi.set(a.d.e);a.j.yi.set(a.d.quat);var b=a.j,c=v.Ko(v.Ff);c.msg_id=v.Ff;c.body_id=a.j.F;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=L,Z.identity(L)):c.quat=a.d.quat;v.m(v.Ff,c)}a=a.Fd;for(b=0;b<a.length;b++)n(a[b])}function t(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;P.transformQuat(e,a,e)}function w(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.j.l.length;e++){var g=b.j.l[e];
if("ANY"==a||g.gb.id==a)g=g.gb.F,c&&-1==c.indexOf(g)&&c.push(g),d&&(d[g]=0)}}function B(a,b){v.m(v.yc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],g=D.cn(e.G)+D.cn(e.V)+String(e.local);c[g]=c[g]||{G:e.G,V:e.V,local:e.local,rn:[]};var E=c[g].rn,f;for(f in e.yd)-1==E.indexOf(f)&&E.push(f)}for(g in c)d=c[g].G,e=c[g].V,f=c[g].local,E=c[g].rn,v.m(v.Om,a,d,e,f,E)}else v.m(v.Om,a,null,null,!1,null)}function q(a,b){if(b.wg){var c=a.j.F,d=b.Uf*b.yo,e=b.Wg*b.tn,g=-b.vg*b.jm*2*Math.PI/b.Oq;b.jp&&
(g*=-1);switch(b.type){case 10:v.m(v.yc,c);v.m(v.As,c,d,e,g);break;case 20:v.m(v.yc,c),v.m(v.zs,c,d,e,g)}}}function s(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function y(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function g(a){return a.b4w_character?!0:!1}function A(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}p("__camera");var u=p("__config");p("__constraints");var S=p("__print"),I=p("__debug"),v=p("__ipc");p("__renderer");
var K=p("__scenes"),m=p("__transform"),H=p("__tsr"),D=p("__util"),U=p("__version"),P=p("vec3"),Z=p("quat"),V=p("mat4"),M=u.gb,Q=u.n,T=null,X=[],z=[],ia={sr:0,body:0,Qn:0,shape:0},W=new Float32Array(3),L=new Float32Array(4),G=new Float32Array(4),fa=new Float32Array(16),da=new Float32Array(8),C=new Float32Array(8);a.lw=function(a){if(M.enabled){var b=M.Gg+U.timestamp();S.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+M.$d);b=new Worker(b);v.init(b,c);v.m(v.js,a,M.$d)}};a.en=function(a){var b;ia.sr++;
b=ia.sr;v.m(v.Yr,b);a.j={};a.j.mz=b;a.j.l=[]};a.cleanup=function(){if(M.enabled){v.m(v.ds);T=null;X.length=0;z.length=0;for(var a in ia)ia[a]=0}};a.append_object=function(a,c){T=c;v.m(v.os,c.j.mz);var f=a.d;if(!f)throw"No object render: "+a.name;if(a.parent&&f.Qj)return null;var m=[];f.Qj&&h(a,m);for(var C=a.P||[],n=0;n<C.length;n++){var E=C[n],ca;if(ca="PHYSICS"==E.type){var t;a:{for(var u=c.j.l,w=0;w<u.length;w++){var H=u[w].k;if(H&&H.id==E.id){t=!0;break a}}t=!1}ca=!t}if(ca)if(E.$b.C)if(E.re&&
c.d.Ba){var B=E;v.m(v.Xr);var U=T,I=K.ga(U,"MAIN_OPAQUE");if(I.Ba&&B.hz){var p={};p.dst_noise_scale0=B.dst_noise_scale0;p.dst_noise_scale1=B.dst_noise_scale1;p.dst_noise_freq0=B.dst_noise_freq0;p.dst_noise_freq1=B.dst_noise_freq1;p.dir_min_shore_fac=B.dir_min_shore_fac;p.dir_freq=B.dir_freq;p.dir_noise_scale=B.dir_noise_scale;p.dir_noise_freq=B.dir_noise_freq;p.dir_min_noise_fac=B.dir_min_noise_fac;p.dst_min_fac=B.dst_min_fac;p.waves_hor_fac=B.waves_hor_fac;var M=I.te,da=I.Ef,Q=I.se;I.Sj?v.m(v.Nm,
p,I.ie[0],I.ie[1],I.he[0],I.he[1],I.fg,M,da,Q,I.og,U.d.Zl):v.m(v.Nm,p,0,0,0,0,0,M,da,Q,0,null)}}else{var L;if(E.Yy){var Ab=a,W=E,Bb=b(),ia=W.$b;v.m(v.Vr,Bb,ia.r[0].a_position,ia.Y||null,Ab.d.e,W.Ln,W.Mn);var lb=l(Bb);lb.Xi=!0;L=lb}else{var qb=a,tb=E,kb=b(),Na=tb.$b;v.m(v.Wr,kb,Na.r[0].a_position,Na.Y||null,qb.d.e,tb.mh,tb.hh,tb.Ln,tb.Mn);L=l(kb)}var La=L;La.id=E.Qb;var Fa={k:E,gb:La};c.j.l.push(Fa)}else S.error("Object "+a.name+" has collision material with no assigned vertices")}if(s(a)||y(a)||g(a)||
A(a)||a.b4w_collision){var Ma=a,Ia=f.aq,Ta=Ma.d,Wa=Ma.game,tc=b();if("CAMERA"==Ma.type)var pb=Wa.use_collision_bounds?Wa.collision_bounds_type:"BOX",uc=e(pb,Ta),sb=Ta.mh,Rb=Ta.hh,sb=.5,Rb=0;else"EMPTY"==Ma.type?(pb="EMPTY",uc=null,Rb=sb=0):(pb=Wa.use_collision_bounds?Wa.collision_bounds_type:"BOX",uc=e(pb,Ta),sb=Ta.mh,Rb=Ta.hh);var ub=Ta.e,ud=Ta.quat,nd=Wa.use_ghost,fc=Wa.use_sleep,qd=Wa.mass,ad=Wa.velocity_min,nc=Wa.velocity_max,Pb=Wa.damping,$b=Wa.rotation_damping,cd=Wa.collision_group,oc=Wa.collision_mask,
Bc=Ta.rc.ma,ic=k(uc),Sc=Ma.b4w_correct_bounding_offset,Ba,Ib=pb;if(m.length){var rb=[],za={};za.quat=new Float32Array([0,0,0,1]);za.trans=new Float32Array(3);za.worker_bounding=ic;za.bounding_type=Ib;rb.push(za);V.invert(Ta.H,fa);Z.invert(Ta.quat,G);for(var fb=0;fb<m.length;fb++){var $={},Qa=m[fb],mb=Qa.game.collision_bounds_type,ta=new Float32Array(4),qa=new Float32Array(3);P.transformMat4(Qa.d.e,fa,qa);Z.multiply(G,Qa.d.quat,ta);$.trans=qa;$.quat=ta;$.bounding_type=mb;$.worker_bounding=k(e(mb,Qa.d));
rb.push($)}Ba=rb}else Ba=[];v.m(v.Pr,tc,ub,ud,Ia,nd,fc,qd,ad,nc,Pb,$b,cd,oc,pb,ic,Bc,sb,Rb,Ba,Sc);X.push(Ma);z[tc]=Ma;var vb=l(tc);vb.type=Ia;vb.yl=qd;vb.Xi=nd;La=vb;a.j=La;Fa={k:null,gb:La};c.j.l.push(Fa)}if(s(a)||y(a)){var xa=a,gb=xa.j.F;s(xa)?(xa.f.type=10,v.m(v.Qr,gb,xa.f.uy,xa.f.wy,xa.f.vy,xa.f.kz,xa.f.Gw)):y(xa)&&(xa.f.type=20,v.m(v.Or,gb,xa.f.Tk,xa.f.Cm,xa.f.Dm));if(xa.f.tf){var ra=xa.f.tf;switch(xa.f.type){case 10:d(ra[1],xa,gb,!0);d(ra[0],xa,gb,!0);d(ra[3],xa,gb,!1);d(ra[2],xa,gb,!1);break;
case 20:for(var bb=0;bb<ra.length;bb++)d(ra[bb],xa,gb,!1)}}xa.j.id=xa.b4w_vehicle_settings.name;q(a,a.f)}else if(g(a)){var Da=a.d,nb=a.j,Jb=Da.Db.max_y-Da.Db.min_y,Cc=nb.F,Vb=a.b4w_character_settings,ac=Vb.walk_speed,pc=Vb.run_speed,wb=Vb.step_height,Mb=Vb.jump_strength,Wb=Vb.waterline,Sb=D.Ku(a);v.m(v.Rr,Cc,Sb,Jb,ac,pc,wb,Mb,Wb);nb.is_character=!0}else if(A(a)){var hb=a,Xb=hb.j.F;v.m(v.Ur,Xb,hb.qc.Tk,hb.qc.Cm,hb.qc.Dm);if(hb.qc.vi)for(var jc=hb.qc.vi,Xa=0;Xa<jc.length;Xa++){var bc=jc[Xa],Kb=bc.d.e,
gc=hb.d.H,va=new Float32Array(16);V.invert(gc,va);var Oa=new Float32Array(3);P.transformMat4(Kb,va,Oa);v.m(v.Nr,Xb,Oa,bc.wt)}hb.j.rw=!0}else a.b4w_collision&&(La.id=a.b4w_collision_id);for(n=0;n<X.length;n++)if(a=X[n],a.j){var R=a;if(!r(R))for(var N=0;N<R.constraints.length;N++){var wa=R.constraints[N],oa=wa.target,Ua=wa.pivot_type;if("RIGID_BODY_JOINT"==wa.type&&oa.j){var ka=new Float32Array([wa.pivot_x,wa.pivot_y,wa.pivot_z]),na,Cb=new Float32Array([wa.axis_x,wa.axis_y,wa.axis_z]);na=D.euler_to_quat(Cb,
new Float32Array(4));var Ca=V.fromRotationTranslation(na,ka,new Float32Array(16)),cb=V.multiply(R.d.H,Ca,new Float32Array(16)),Pa=V.invert(oa.d.H,new Float32Array(16)),db=V.multiply(Pa,cb,Pa),$a=D.hf(db),Ga=D.matrix_to_quat(db),Ra=wa,ib={};ib.use_limit_x=Ra.use_limit_x;ib.use_limit_y=Ra.use_limit_y;ib.use_limit_z=Ra.use_limit_z;ib.use_angular_limit_x=Ra.use_angular_limit_x;ib.use_angular_limit_y=Ra.use_angular_limit_y;ib.use_angular_limit_z=Ra.use_angular_limit_z;ib.limit_max_x=Ra.limit_max_x;ib.limit_min_x=
Ra.limit_min_x;ib.limit_max_y=Ra.limit_max_y;ib.limit_min_y=Ra.limit_min_y;ib.limit_max_z=Ra.limit_max_z;ib.limit_min_z=Ra.limit_min_z;ib.limit_angle_max_x=Ra.limit_angle_max_x;ib.limit_angle_min_x=Ra.limit_angle_min_x;ib.limit_angle_max_y=Ra.limit_angle_max_y;ib.limit_angle_min_y=Ra.limit_angle_min_y;ib.limit_angle_max_z=Ra.limit_angle_max_z;ib.limit_angle_min_z=Ra.limit_angle_min_z;x(Ua,R,ka,na,oa,$a,Ga,ib,null,null)}}}};a.bv=f;a.update=function(){for(var a=0;a<X.length;a++){var b=X[a],c=b.j;if(c.je&&
c.Hk){var d=performance.now()/1E3-c.Hk,d=Math.min(d,10/60);Q.Mw&&(d=0);var e=da;H.mw(c.Ik,d,c.tp,c.$m,da);m.set_translation(b,H.Qo(e));m.set_rotation(b,H.Lo(e));m.v(b);n(b);if(b.f)for(var c=b,d=c.f.tf,e=c.d.Tc,g=da,E=0;E<d.length;E++){var f=d[E];H.multiply(e,c.f.Lh[E],g);m.vq(f,g);m.v(f)}b.f&&b.f.wg&&(c=b.f,d=c.wg)&&(e=b.f.Pq,f=fa,g=b.d.e,E=b.d.quat,D.rm(b.f.Qq,E,g,f),D.hf(f,d.d.e),D.matrix_to_quat(f,d.d.quat),f=L,D.sm(e,E,g,f),e=G,Z.setAxisAngle(f,-c.vg*c.jm*2*Math.PI,e),Z.multiply(e,d.d.quat,d.d.quat),
m.v(d));b.f&&b.f.gm&&(c=b.f,d=c.gm)&&(g=b.f.Iq,e=fa,E=b.d.e,f=b.d.quat,D.rm(b.f.Jq,f,E,e),D.hf(e,d.d.e),D.matrix_to_quat(e,d.d.quat),e=L,D.sm(g,f,E,e),g=G,E=Math.abs(c.speed)*c.Hq,E>c.Al&&(E=c.Al),Z.setAxisAngle(e,-E,g),Z.multiply(g,d.d.quat,d.d.quat),m.v(d));b.f&&b.f.mm&&(c=b.f,d=c.mm)&&(e=b.f.Wq,f=fa,g=b.d.e,E=b.d.quat,D.rm(b.f.Xq,E,g,f),D.hf(f,d.d.e),D.matrix_to_quat(f,d.d.quat),b=L,D.sm(e,E,g,b),e=G,Z.setAxisAngle(b,-Math.abs(c.Uf)*c.eo,e),Z.multiply(e,d.d.quat,d.d.quat),m.v(d))}}if(a=T)a=K.ga(a,
"MAIN_OPAQUE"),a.Ba&&0<a.Ba.waves_height&&(b=P.length(a.fi),v.m(v.ys,a.time*b))};a.vv=function(){return T};a.pause=function(){M.enabled&&v.m(v.ks)};a.resume=function(){M.enabled&&v.m(v.ns)};a.enable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(!a.je){var b=a.F;a.je=!0;v.m(v.hs,b)}};a.disable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(a.je){var b=a.F;a.je=!1;v.m(v.gs,b)}};a.has_physics=function(a){return a.j?!0:!1};a.has_dynamic_physics=function(a){return(a=a.j)&&
a.je&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.yl&&0==a.Xi?!0:!1};a.has_simulated_physics=function(a){return(a=a.j)&&a.je?!0:!1};a.set_gravity=function(a,b){v.m(v.xs,a.j.F,b)};a.fw=r;a.apply_constraint=x;a.clear_constraint=function(a){a=a.j;v.m(v.ms,a.Ei);a.Ei=null};a.pull_to_constraint_pivot=function(b,c,d,e,g,f){c=H.Of(c,1,d,da);g=H.Of(g,1,f,C);H.invert(c,c);H.multiply(g,c,c);m.Vv(e,g);H.multiply(g,c,c);m.vq(b,c);m.v(b);a.set_transform(b,b.d.e,b.d.quat)};a.set_transform=function(a,b,c){H.Uh(a.d.e,
1,a.d.quat,a.j.Ik);var d=v.Ko(v.Ff);d.msg_id=v.Ff;d.body_id=a.j.F;d.trans=b;d.quat=c;v.m(v.yc,a.j.F);v.m(v.Ff,d)};a.sync_transform=n;a.apply_velocity=function(a,b,c,d){t(a,b,c,d,W);a=a.j.F;v.m(v.yc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(W[0]),g=Math.abs(W[1]),E=Math.abs(W[2]);W[0]=e?W[0]/e*Math.max(e,b):0;W[1]=g?W[1]/g*Math.max(g,c):0;W[2]=E?W[2]/E*Math.max(E,d):0;v.m(v.Pm,a,W[0],W[1],W[2])};a.apply_velocity_world=function(a,b,c,d){a=a.j.F;v.m(v.yc,a);v.m(v.Pm,a,b,c,d)};a.apply_force=
function(a,b,c,d){t(a,b,c,d,W);a=a.j.F;v.m(v.yc,a);v.m(v.Zr,a,W[0],W[1],W[2])};a.apply_torque=function(a,b,c,d){t(a,b,c,d,W);a=a.j.F;v.m(v.yc,a);v.m(v.as,a,W[0],W[1],W[2])};a.set_character_move_dir=function(a,b,c){a=a.j.F;v.m(v.yc,a);v.m(v.rs,a,b,c)};a.set_character_move_type=function(a,b){v.m(v.ss,a.j.F,b)};a.set_character_walk_velocity=function(a,b){v.m(v.ws,a.j.F,b)};a.set_character_run_velocity=function(a,b){v.m(v.us,a.j.F,b)};a.set_character_fly_velocity=function(a,b){v.m(v.ps,a.j.F,b)};a.character_jump=
function(a){v.m(v.bs,a.j.F)};a.character_rotation_inc=function(a,b,c){v.m(v.cs,a.j.F,b,c)};a.set_character_rotation=function(a,b,c){v.m(v.ts,a.j.F,b,c)};a.set_character_rotation_h=function(a,b){v.m(v.qs,a.j.F,b)};a.set_character_rotation_v=function(a,b){v.m(v.vs,a.j.F,b)};a.Vz=function(){return!1};a.Uz=function(){return!1};a.check_collision=function(){S.error("check_collision() deprecated");return!1};a.Tz=function(){S.error("check_collision_any() deprecated");return!1};a.check_ray_hit=function(){S.error("check_ray_hit() deprecated");
return!1};a.FB=function(){S.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.j,g=e.F;b=b||"ANY";for(var E=0;E<e.Cc.length;E++){var f=e.Cc[E];if(f.Qb==b&&f.callback==c)return}E=[];a=a.j.F;f=[];w(b,T,f,null);for(var m=0;m<f.length;m++){var h=f[m];a<h?E.push([a,h]):a>h&&E.push([h,a])}f={Qb:b,callback:c,oj:E,Zp:new Uint8Array(E.length),Dl:d||!1};e.Cc.push(f);v.m(v.yc,g);v.m(v.Sr,E,d)};a.remove_collision_test=function(a,b,c){a=a.j;b=b||"ANY";for(var d=0;d<a.Cc.length;d++){var e=
a.Cc[d];if(e.Qb==b&&e.callback==c){a.Cc.splice(d,1);d--;for(var e=e.oj,g=T.j.l,E=0;E<g.length;E++)for(var f=g[E].gb,m=0;m<f.Cc.length;m++)for(var h=f.Cc[m],k=0;k<h.oj.length;k++)for(var q=h.oj[k],l=0;l<e.length;l++){var C=e[l];q[0]===C[0]&&q[1]===C[1]&&(e.splice(l,1),l--)}e.length&&v.m(v.ls,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.j;c?(v.m(v.$r,c.F),c.Di=b):S.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.j;b?(v.m(v.es,b.F),b.Di=null):
S.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,g){var E=a.j;if(E){a=E.F;b=b||"ANY";c={G:new Float32Array(c),V:new Float32Array(d),local:e,callback:g,Qb:b,yd:{}};w(b,T,null,c.yd);delete c.yd[a];for(var f in c.yd)c.yd[f]=1;E.de.push(c);B(a,E.de)}else S.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.j){a=b.F;for(var g=0;g<b.de.length;g++){var E=b.de[g];D.Ci(E.G,c)&&D.Ci(E.V,d)&&E.local==e&&(b.de.splice(g,1),g--)}B(a,b.de)}else S.error("Object "+
a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.f;c.Uf=b;q(a,c)};a.vehicle_steer=function(a,b){var c=a.f;c.vg=b;q(a,c)};a.vehicle_brake=function(a,b){var c=a.f;c.Wg=b;q(a,c)};a.is_vehicle_chassis=s;a.is_vehicle_hull=y;a.pw=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.ow=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.sw=
function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.np=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.mp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.op=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.f.speed};a.lz=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;
case "WHEEL_BACK_RIGHT":return 3}};a.is_character=g;a.YA=A;a.CA=function(){return 0};a.Du=function(){v.m(v.fs)};a.kx=function(a){var b=X.indexOf(a);-1!=b?(X.splice(b,1),a=z.indexOf(a),-1!=a&&z.splice(a,1)):S.error("Object ",a.name," doesn't have bounding physics")}};
b4w.module.__data=function(a,p){function h(a,b){for(var c=z(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}lb[b.id]=null;qb[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=J.Ro(a));d=a.width;a=a.height;ca.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(tb)&&c&&ca.warn("B4W Warning: image",b,"is not from app root.")}function f(a,b,c,d,e,g){d=b.q;if(!d)throw"Nothing requested";la.enqueue([[d,la.AT_JSON,
d]],function(d,g,E,f){if(d){ca.log("%cLOAD METADATA","color: #616",f);g=d.b4w_format_version;if(Number(g)<zb.zp)throw"Incompatible file version: "+g+". Required: "+zb.zp;for(var m in d)a[m]=d[m];(d=a.binaries[0].binfile)?b.nn=d:(pa.bm(b,"load_binaries"),pa.bm(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)ca.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)ca.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}},null,function(a){g(b,c,a)})}function b(a,b,c,d,e,g){d=Q(b.q)+b.nn;if(!d)throw"Binary data is missing";la.enqueue([[d,la.AT_ARRAYBUFFER,d]],function(d,g,E,f){d&&(ca.log("%cLOAD BINARY","color: #616",f),a.bin_data=d,e(b,c))},null,function(a){g(b,c,a)})}function l(a,b,c,d,g){d=a.bin_data;var E=a.binaries[0],f=a.objects,m=a.meshes;a=a.actions;for(var h=Ja.Ht(),k=["indices"],q=["normal","tangent"],l=["color","group"],J=["position","texcoord","texcoord2"],C=0;C<m.length;C++)for(var n=m[C].submeshes,
r=0;r<n.length;r++)for(var ca in n[r]){var t=n[r][ca][1];if(-1!=k.indexOf(ca)){var u=4*n[r][ca][0]+E["int"],w=n[r],s=ca,D=d;if(h)var v=new Uint32Array(D,u,t);else for(var v=new Uint32Array(t),D=new DataView(D),H=0;H<t;H++)v[H]=D.getUint32(u+4*H,!0);w[s]=v}else if(-1!=J.indexOf(ca))u=4*n[r][ca][0]+E["float"],n[r][ca]=e(d,u,t,h);else if(-1!=q.indexOf(ca)){u=2*n[r][ca][0]+E["short"];w=n[r];s=ca;D=d;v=new Float32Array(t);D=new DataView(D);for(H=0;H<t;H++)v[H]=D.getInt16(u+2*H,!0)/32767;w[s]=v}else if(-1!=
l.indexOf(ca)){u=2*n[r][ca][0]+E.ushort;w=n[r];s=ca;D=d;v=new Float32Array(t);D=new DataView(D);for(H=0;H<t;H++)v[H]=D.getUint16(u+2*H,!0)/65535;w[s]=v}}for(ca=0;ca<f.length;ca++)for(m=f[ca].particle_systems,k=0;k<m.length;k++)q=m[k],q.transforms=e(d,4*q.transforms[0]+E["float"],q.transforms[1],h);for(f=0;f<a.length;f++){ca=a[f];var m=ca.fcurves,q=ca.frame_range,k=q[0],q=q[1],l=G.Av(k,q),J=null,n=C=!1,x;for(x in m)C|=-1<x.indexOf("rotation_euler"),n|=-1<x.indexOf("rotation_quaternion");for(x in m)if(C&&
n&&-1<x.indexOf("rotation_euler"))delete m[x];else{var r=m[x],B;for(B in r)t=r[B],u=e(d,E["float"]+4*t.bin_data_pos[0],t.bin_data_pos[1],h),w=new Float32Array(l),null===J&&(J=new Int8Array(l)),G.kt(t,u,w,J,k,q),t.Pb=w;-1<x.indexOf("rotation_euler")&&G.av(m,x)}ca.Hs=J}g(b,c)}function e(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function k(a,b,c,d,e){var g=a.cameras,f=a.groups,m=a.materials,h=a.meshes,
k=a.node_groups,q=a.objects,l=a.particles,J=a.scenes,C=a.speakers,r=a.textures,u=a.worlds;k||(ca.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),k=a.node_groups=[]);for(var w="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),s={},D=0;D<w.length;D++)for(var v=a[w[D]],H=0;H<v.length;H++){var x=v[H];s[x.uuid]=x}for(var B=0;B<J.length;B++){for(var A=J[B],Y=A.objects,ha=0;ha<
Y.length;ha++)t(Y,ha,s);A.camera&&t(A,"camera",s);A.world&&t(A,"world",s)}for(B=0;B<f.length;B++)for(var y=f[B].objects,ha=0;ha<y.length;ha++)t(y,ha,s);for(B=0;B<q.length;B++){var U=q[B];U.dupli_group&&t(U,"dupli_group",s);U.parent&&t(U,"parent",s);if(U.animation_data){var la=U.animation_data;la.action&&t(la,"action",s);if(la.nla_tracks)for(ha=0;ha<la.nla_tracks.length;ha++)for(var P=la.nla_tracks[ha],K=0;K<P.strips.length;K++)P.strips[K].action&&t(P.strips[K],"action",s)}switch(U.type){case "MESH":if(!U.data)throw"mesh not found for object "+
U.name;t(U,"data",s);for(var pa=U.modifiers,ha=0;ha<pa.length;ha++){var O=pa[ha];"ARMATURE"==O.type?t(O,"object",s):"CURVE"==O.type&&t(O,"object",s)}var p=U.particle_systems;if(p)for(ha=0;ha<p.length;ha++)t(p[ha],"settings",s);break;case "ARMATURE":t(U,"data",s);for(var ea=U.pose.bones,V=U.data.bones,ha=0;ha<ea.length;ha++){var M=ea[ha];M.bone=V[M.bone];for(var Aa=M.parent_recursive,K=0;K<Aa.length;K++)Aa[K]=ea[Aa[K]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":t(U,"data",s)}var Z=
U.constraints;if(Z)for(ha=0;ha<Z.length;ha++){var da=Z[ha];da.target&&t(da,"target",s)}var Ea=U.lod_levels;if(Ea)for(ha=0;ha<Ea.length;ha++){var Q=Ea[ha];Q.object&&t(Q,"object",s)}}for(B=0;B<h.length;B++)for(var T=h[B].materials,ha=0;ha<T.length;ha++)t(T,ha,s);for(B=0;B<m.length;B++){for(var L=m[B],Ha=L.texture_slots,ha=0;ha<Ha.length;ha++)t(Ha[ha],"texture",s);var Ab=L.node_tree;Ab&&n(Ab,s)}for(B=0;B<k.length;B++)(Ab=k[B].node_tree)&&n(Ab,s);for(B=0;B<r.length;B++){var W=r[B],X=W.type;"IMAGE"!=X&&
"ENVIRONMENT_MAP"!=X||t(W,"image",s)}for(B=0;B<g.length;B++){var Hb=g[B];Hb.dof_object&&t(Hb,"dof_object",s)}for(B=0;B<C.length;B++){var tb=C[B];tb.sound&&t(tb,"sound",s);if(tb.animation_data&&(la=tb.animation_data,la.action&&t(la,"action",s),la.nla_tracks))for(ha=0;ha<la.nla_tracks.length;ha++)for(P=la.nla_tracks[ha],K=0;K<P.strips.length;K++)P.strips[K].action&&t(P.strips[K],"action",s)}for(B=0;B<l.length;B++){for(var Za=l[B],Ha=Za.texture_slots,ha=0;ha<Ha.length;ha++)t(Ha[ha],"texture",s);Za.dupli_group&&
t(Za,"dupli_group",s);Za.dupli_object&&t(Za,"dupli_object",s)}for(B=0;B<u.length;B++)if(Ha=u[B].texture_slots)for(ha=0;ha<Ha.length;ha++)t(Ha[ha],"texture",s);ua.Gt(a);kb=0===b.id;Na||(Na=a.scenes[0]);for(var fa=a.textures,R=kb?a.scenes[0].b4w_anisotropic_filtering:Na.b4w_anisotropic_filtering,N=0;N<fa.length;N++)kb||"SCENE"!=fa[N].b4w_source_type||(fa[N].b4w_source_id=""),ba.uu(fa[N],R,a.scenes);for(var lb={},qb=a.objects,Fa=0;Fa<qb.length;Fa++){var ka=qb[Fa];if("MESH"===ka.type&&!ka.particle_systems.length)for(var La=
ka.data,Cb=La.name,Ca=La.submeshes,cb=La.materials,Pa=0;Pa<Ca.length;Pa++)0!==Ca[Pa].base_length||lb[Cb]||(cb[Pa]?ca.warn('B4W Warning: material "'+cb[Pa].name+'" is not assigned to any face (object "'+ka.name+'").'):ca.warn('B4W Warning: Mesh "'+La.name+'" has no faces (object "'+ka.name+'").'),lb[Cb]=!0)}for(var db=a.meshes,$a=0;$a<db.length;$a++){var Ga=db[$a];Ga.materials.length||Ga.uv_textures.length&&ca.warn('B4W Warning: mesh "'+Ga.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var Ra=a.meshes,ib=Ja.keysearch("name","DEFAULT",a.materials),Ia=0;Ia<Ra.length;Ia++){var Ma=Ra[Ia];0==Ma.materials.length&&Ma.materials.push(ib)}for(var Wa=a.actions,tc=b.id,pb=0;pb<Wa.length;pb++){var xb=Wa[pb];xb.Js=tc;G.Us(xb)}for(var qc=a.scenes,Va=0;Va<qc.length;Va++){for(var Ec=qc[Va],kc=ma.Ak(Ec,"ALL"),eb=[],Ya=0;Ya<kc.length;Ya++)for(var rc=kc[Ya].particle_systems,wc=0;wc<rc.length;wc++){var yb=rc[wc].settings;if("HAIR"==yb.type)if("OBJECT"==yb.render_type)ja.um(yb.dupli_object,!0);else if("GROUP"==
yb.render_type){for(var Yb=yb.dupli_group,Db=ma.Ak(Ec,"EMPTY"),cc=0;cc<Db.length;cc++)Db[cc].dupli_group==Yb&&eb.push(Db[cc]);for(cc=0;cc<Yb.objects.length;cc++)ja.um(Yb.objects[cc],!0)}else ca.warn("B4W Warning: render type",yb.render_type,"not supported for particle systems ("+yb.name+").")}for(Ya=0;Ya<eb.length;Ya++)I(eb[Ya],[Ec])}ia(a,b.id);for(var Hc=a.scenes,Eb=0;Eb<Hc.length;Eb++){for(var Yc=Hc[Eb],Zb=[],jb=[],lc=Hc[Eb].objects,Tb=0;Tb<lc.length;Tb++){var id=lc[Tb];S(lc,id,Zb,jb);var Zc=id.dupli_group;
if(Zc)for(var Ic=Zc.objects,hd=0;hd<Ic.length;hd++)S(Ic,Ic[hd],Zb,jb)}for(Tb=0;Tb<jb.length;Tb++)I(jb[Tb],[Yc]);for(Tb=0;Tb<Zb.length;Tb++)Ja.ht(Zb[Tb][0],Zb[Tb][1])}ia(a,b.id);for(var ob=z(a,b.id),N=0;N<ob.length;N++){var Qb=ob[N];!kb&&Qb.parent&&-1<Ta.indexOf(Qb.parent.type)&&(Qb.parent="");ja.um(Qb,!1);Qb.d.jd=b.id}for(var hc=0;hc<ob.length;hc++){var Ub=ob[hc];if("MESH"==Ub.type){var bd=G.get_first_armature_object(Ub);if(bd){var Nb=bd.d;if(Nb.Hd){var Nc=Ub.d.gc,$c=[],Uc;for(Uc in Nc){var xc=Nc[Uc];
$c.push(4*xc.fh,4*xc.sn)}Nb.yp.push($c)}Nb.Dj.push(Ub.d)}}}for(var mc=-1,Vc=0;Vc<ob.length;Vc++){var Fc=ob[Vc],Lc=Fc.d;if(Ja.sc(Fc)&&Lc.uh){var Oc=Lc.max_bones;Oc>mc&&(mc=Oc)}}for(Vc=0;Vc<ob.length;Vc++)if(Fc=ob[Vc],Lc=Fc.d,Ja.sc(Fc)&&Lc.uh){Lc.max_bones=mc;var Pc=Fc,yc=Lc.max_bones,zc=zb.max_bones,Wc=Pc.d;yc>2*zc?Ja.da('B4W Error: too many bones for "'+Pc.name+'"'):yc>zc?(ca.warn('B4W Warning: too many bones for "'+Pc.name+'" / '+yc+" bones (max "+zc+"). Blending between frames will be disabled."),
Wc.lh=!1):Wc.lh=!0;Wc.lh=Wc.lh&&!Bb.zo}for(var od=0;od<ob.length;od++){var Fb=ob[od];if(Ja.sc(Fb)){var sc=Fb.lod_levels.length;if(sc)for(var Jc=Fb,Kc=0;Kc<sc;Kc++){var ed=Fb.lod_levels[Kc].object;if(!ed){Jc.d.bj=!0;Jc.d.Zd=Fb.lod_levels[Kc].distance;break}ed.d.gf=Fb.d.gf;Jc.d.Zd=Fb.lod_levels[Kc].distance;ed.d.yh=Fb.lod_levels[Kc].distance;if(Fb.lod_levels[Kc+1])ed.d.Zd=Fb.lod_levels[Kc+1].distance;else{ed.d.bj=!0;ed.d.Zd=1E4;break}Jc.d.bj=!1;Jc=ed}}}for(var Mc=0;Mc<ob.length;Mc++){var ya=ob[Mc];
if(ya.b4w_vehicle){var Lb=ya.b4w_vehicle_settings;if("CHASSIS"==Lb.part){ya.f={};ya.f.yo=Lb.force_max;ya.f.tn=Lb.brake_max;ya.f.uy=Lb.suspension_compression;ya.f.wy=Lb.suspension_stiffness;ya.f.vy=Lb.suspension_damping;ya.f.kz=Lb.wheel_friction;ya.f.pB=Lb.roll_influence;ya.f.Gw=Lb.max_suspension_travel_cm;ya.f.Uf=0;ya.f.Wg=1;ya.f.vg=0;ya.f.speed=0;ya.f.tf=[];ya.f.Lh=[];ya.f.wg=null;for(var fd=ya.Cb?ya.Cb.dupli_group.objects:ob,Qc=0;Qc<fd.length;Qc++){var Ob=fd[Qc];if(Ob.b4w_vehicle){var sa=Ob.b4w_vehicle_settings;
if(E.pw(Ob)&&Lb.name==sa.name){var dc=E.lz(Ob.b4w_vehicle_settings.part);ya.f.tf[dc]=Ob;ya.f.Lh[dc]=new Float32Array(8)}else if(E.np(Ob)&&Lb.name==sa.name){ya.f.wg=Ob;ya.f.jm=sa.steering_max;ya.f.Oq=sa.steering_ratio;ya.f.jp=sa.inverse_control;var Gb=Ka.invert(ya.d.H,new Float32Array(16)),gd=Ka.multiply(Gb,Ob.d.H,Gb);ya.f.Qq=gd;var Sa=new Float32Array([1,0,0,0]);ab.transformMat4(Sa,gd,Sa);ya.f.Pq=Sa}else if(E.mp(Ob)&&Lb.name==sa.name){ya.f.gm=Ob;ya.f.Hq=sa.speed_ratio;ya.f.Al=sa.max_speed_angle;var Gb=
Ka.invert(ya.d.H,new Float32Array(16)),ec=Ka.multiply(Gb,Ob.d.H,Gb);ya.f.Jq=ec;var kd=new Float32Array([1,0,0,0]);ab.transformMat4(kd,ec,kd);ya.f.Iq=kd}else if(E.op(Ob)&&Lb.name==sa.name){ya.f.mm=Ob;ya.f.eo=sa.delta_tach_angle;var Gb=Ka.invert(ya.d.H,new Float32Array(16)),Ac=Ka.multiply(Gb,Ob.d.H,Gb);ya.f.Xq=Ac;var jd=new Float32Array([1,0,0,0]);ab.transformMat4(jd,Ac,jd);ya.f.Wq=jd}}}if(4!=ya.f.tf.length)throw"Not enough wheels for chassis "+ya.name;}else if("HULL"==Lb.part){ya.f={};ya.f.tf=[];ya.f.Lh=
[];ya.f.yo=Lb.force_max;ya.f.tn=Lb.brake_max;ya.f.Tk=Lb.floating_factor;ya.f.Cm=Lb.water_lin_damp;ya.f.Dm=Lb.water_rot_damp;ya.f.Uf=0;ya.f.Wg=1;ya.f.vg=0;ya.f.speed=0;ya.f.wg=null;for(var rd=ya.Cb?ya.Cb.dupli_group.objects:ob,Qc=0;Qc<rd.length;Qc++)Ob=rd[Qc],Ob.b4w_vehicle&&(sa=Ob.b4w_vehicle_settings,E.ow(Ob)&&Lb.name==sa.name?(ya.f.tf.push(Ob),ya.f.Lh.push(new Float32Array(8))):E.np(Ob)&&Lb.name==sa.name?(ya.f.wg=Ob,ya.f.jm=sa.steering_max,ya.f.Oq=sa.steering_ratio,ya.f.jp=sa.inverse_control,Gb=
Ka.invert(ya.d.H,new Float32Array(16)),gd=Ka.multiply(Gb,Ob.d.H,Gb),ya.f.Qq=gd,Sa=new Float32Array([1,0,0,0]),ab.transformMat4(Sa,gd,Sa),ya.f.Pq=Sa):E.mp(Ob)&&Lb.name==sa.name?(ya.f.gm=Ob,ya.f.Hq=sa.speed_ratio,ya.f.Al=sa.max_speed_angle,Gb=Ka.invert(ya.d.H,new Float32Array(16)),ec=Ka.multiply(Gb,Ob.d.H,Gb),ya.f.Jq=ec,kd=new Float32Array([1,0,0,0]),ab.transformMat4(kd,ec,kd),ya.f.Iq=kd):E.op(Ob)&&Lb.name==sa.name&&(ya.f.mm=Ob,ya.f.eo=sa.delta_tach_angle,Gb=Ka.invert(ya.d.H,new Float32Array(16)),Ac=
Ka.multiply(Gb,Ob.d.H,Gb),ya.f.Xq=Ac,jd=new Float32Array([1,0,0,0]),ab.transformMat4(jd,Ac,jd),ya.f.Wq=jd))}}}for(var ld=0;ld<ob.length;ld++){var Rc=ob[ld];if(Rc.b4w_floating){var Gc=Rc.b4w_floating_settings;if("MAIN_BODY"==Gc.part){Rc.qc={};Rc.qc.Tk=Gc.floating_factor;Rc.qc.Cm=Gc.water_lin_damp;Rc.qc.Dm=Gc.water_rot_damp;Rc.qc.vi=[];for(var pd=Rc.Cb?Rc.Cb.dupli_group.objects:ob,vd=0;vd<pd.length;vd++){var sd=pd[vd];if(sd.b4w_floating){var md=sd.b4w_floating_settings;E.sw(sd)&&Gc.name==md.name&&(Rc.qc.vi.push(sd),
sd.wt=sd.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function d(a,b,c,d,e){!kb&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],ca.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==Bb.ua&&kb&&(Bb.ua=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var g=a.scenes[d];if(kb&&!g.camera)throw"Scene check failed: No camera";for(var f=ma.Ak(g,"MESH"),m=0;m<f.length;m++){var h=f[m],k=ua.it(h);k&&(a.meshes.push(k),h.data=k)}for(var m=z(a,b.id),h=a.meshes,
k=h.slice(0),q=0;q<m.length;q++){var l=m[q];"MESH"==l.type&&(l=k.indexOf(l.data),-1<l&&k.splice(l,1))}for(q=0;q<k.length;q++)h.splice(h.indexOf(k[q]),1);kb?(ma.Zs(g,a.textures),g.d.Kg.length&&(b.jl=!0),Hb.enabled&&g.b4w_enable_physics&&E.en(g),g.b4w_enable_audio&&O.fn(g),m=ma.dl(g),h=g.b4w_batch_grid_size):(ma.et(g,Na,a.textures),Hb.enabled&&g.b4w_enable_physics&&!Na.j&&E.en(Na),g.b4w_enable_audio&&!Na.g&&O.fn(Na),m=ma.dl(Na),h=Na.b4w_batch_grid_size);f=fa.rv(m,h,f,g.world,Na.d.rl);kb?(ma.Ym(g,f),
ma.lv(m)):ma.Ym(Na,f)}d=a.materials;if(Ab.Kk&&zb.hr)for(a=0;a<d.length;a++){g=d[a];h=g.texture_slots;for(f=0;f<h.length;f++)if(k=h[f],q=k.texture,"IMAGE"==q.type||"ENVIRONMENT_MAP"==q.type)m=q.image,m.ec||(-1<m.filepath.indexOf(".dds")?m.ec=!0:(m.ec=!q.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=q.type&&!q.b4w_shore_dist_map&&"MOVIE"!=m.source,m.ec&&(m.filepath+=".dds")));if(f=g.node_tree)for(h=f.nodes,f=0;f<h.length;f++)m=h[f],"TEXTURE"==m.type&&((k=m.texture)?(m=k.image)&&!m.ec&&
(m.ec=k.d.ni&&!k.b4w_disable_compression&&"MOVIE"!=m.source,m.ec&&(m.filepath+=".dds")):ca.warn("B4W Warning: material ",g.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)g=a[d],g.ec=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds"));e(b,c)}function r(a,b,c,d,e){d=a.groups;a=a.objects;for(var g={},E={},f={},m={},h=0;h<d.length;h++){var k=d[h];g[k.uuid]=k;f[k.uuid]=k}for(h=0;h<a.length;h++)k=a[h],E[k.uuid]=k,m[k.uuid]=k;x(a,null,m,f);for(var q in f)q in g||d.push(f[q]);for(q in m)q in
E||a.push(m[q]);e(b,c)}function x(a,b,c,d){for(var e=[],g=0;g<a.length;g++){var E=a[g],f=c[E.uuid];if(E=f.proxy){b&&-1==e.indexOf(E.uuid)&&e.push(E.uuid);for(var m=c[E.uuid],h=m.constraints,E=0;E<h.length;E++){var k=Ja.Ie(h[E]);k.name+="_CLONE";f.constraints.push(k)}"b4w_proxy_inherit_anim"in f&&!f.b4w_proxy_inherit_anim||(f.animation_data&&(m.animation_data=Ja.Ie(f.animation_data)),m.b4w_use_default_animation=f.b4w_use_default_animation,m.b4w_auto_skel_anim=f.b4w_auto_skel_anim,m.b4w_anim_behavior=
f.b4w_anim_behavior,m.b4w_cyclic_animation=f.b4w_cyclic_animation)}}for(g=0;g<e.length;g++)f=Ja.el(a,"uuid",e[g]),-1<f&&a.splice(f,1);e={};for(g=0;g<a.length;g++)E=a[g],f=c[E.uuid],b&&(h=Ja.Ie(f),f="origin_name"in f?f.origin_name:f.name,h.name=b+"*"+f,h.origin_name=f,h.uuid=Y.bp("Object"+h.name),c[h.uuid]=h,e[E.uuid]=h.uuid,E.uuid=h.uuid),f=c[E.uuid],f.dupli_group&&(E=f.dupli_group,h=d[E.uuid],m=Ja.Ie(h),m.name=Ja.Lj(h.name+"_CLONE"),m.uuid=Y.bp("Group"+m.name),d[m.uuid]=m,E.uuid=m.uuid,x(m.objects,
f.name,c,d));if(b)for(g=0;g<a.length;g++){E=a[g];f=c[E.uuid];f.parent&&f.parent.uuid in e?f.parent.uuid=e[f.parent.uuid]:f.parent&&(ca.warn("B4W Warning: Object's \""+f.name+'" parent is not in dupli group. Disabling parenting.'),f.parent=null);h=f.constraints;for(E=0;E<h.length;E++)b=h[E],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=f.modifiers;for(E=0;E<b.length;E++)d=b[E],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((f=f.lod_levels)&&f.length)for(E=0;E<
f.length;E++)b=f[E],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var q in e)La[q]=e[q]}function n(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&t(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in La&&(e.lamp.uuid=La[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&t(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var g=e[d],E=g,f=c,f=Ja.keysearch("name",E.from_node.name,f);E.from_node=f;E=g;f=c;f=Ja.keysearch("name",
E.to_node.name,f);E.to_node=f;w(g,"from_socket",g.from_node.outputs);w(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&t(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],g=0;g<e.strips.length;g++)e.strips[g].action&&t(e.strips[g],"action",b)}function t(a,b,c){(c=c[a[b].uuid])||ca.error("Dangling link found:",b,a);a[b]=c}function w(a,b,c){c=Ja.keysearch("identifier",a[b].identifier,c);a[b]=c}function B(a,b,d,e,g,E){if(!zb.do_not_load_resources){for(var f=
Q(b.q),m=a.images,h={},k=[],l=0;l<m.length;l++){var J=m[l],C=J.uuid;if("FILE"===J.source||"MOVIE"===J.source){var n=q(J,a.textures);if(!n.length)ca.warn("B4W Warning: image ",J.name," has no users.");else if(!(n[0].b4w_shore_dist_map||"MOVIE"===J.source&&zb.vo)){n=X(f+J.filepath);if("FILE"===J.source){var r=J.ec?la.AT_ARRAYBUFFER:la.AT_IMAGE_ELEMENT;Ab.Bl&&zb.Rj&&(n=la.Ej(n),"dds"==n[1]?(n=la.Ej(n[0]),n=n[0]+".min50."+n[1]+".dds"):n=n[0]+".min50."+n[1])}else"MOVIE"!==J.source||zb.cp||(n=la.Ej(n),
r=O.detect_video_container(n[1]),n=r!=n[1]?n[0]+".lossconv."+r:n[0]+"."+r,r=la.Xj);k.push([C,r,n,J.name]);h[C]=J}}}k.length?(e.dp=0,la.enqueue(k,function(g,f,m,l){if(g){if(m==la.Xj){m=g.videoWidth;var J=g.videoHeight;ca.log("%cLOAD VIDEO "+m+"x"+J,"color: #"+(2048<m||2048<J?"a00":1024<m||1024<J?"aa0":"0a0"),l);-1==l.indexOf(tb)&&ca.warn("B4W Warning: video",l,"is not from app root.")}else c(g,l,!0);f=h[f];l=q(f,a.textures);for(m=0;m<l.length;m++)J=l[m],ba.Pj(J.d,g,f.ec,J.image.filepath)}g=++e.dp/
k.length;E(b,d,g)},function(){ca.log("%cLOADED ALL IMAGES","color: #0a0");g(b,d)})):g(b,d)}}function q(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function s(a,b,c,d,e,g){if(!zb.do_not_load_resources){a=z(a,b.id);for(var E=Q(b.q),f=[],m={},h=0;h<a.length;h++){var k=a[h];if(y(k)){var q=k.data.sound,l=q.uuid;"BACKGROUND_MUSIC"==O.fl(k)?(l=Ja.kv(),b.il=!0):"NONE"!=O.fl(k)&&zb.gp&&(b.ll=!0);if(!(l in m)){m[l]=[];q=X(E+q.filepath);switch(O.Fq(k)){case O.Wj:var J=la.AT_AUDIOBUFFER;
break;case O.Gm:J=la.AT_AUDIO_ELEMENT}var q=la.Ej(q),n=O.detect_audio_container(q[1]);if(n!=q[1]){if(da.ml()){pa.bm(b,"load_speakers");return}q=q[0]+".lossconv."+n}else q=q[0]+"."+n;f.push([l,J,q])}m[l].push(k)}}f.length?la.enqueue(f,function(a,e,E,h){if(a)for(ca.log("%cLOAD SOUND","color: #0aa",h),-1==h.indexOf(tb)&&ca.warn("B4W Warning: sound",h,"is not from app root."),e=m[e],E=0;E<e.length;E++)O.Ty(e[E],a);a=++d.ay/f.length;g(b,c,a)},function(){ca.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,
c)}):e(b,c)}}function y(a){return O.Yd(a)&&O.Fq(a)!=O.Hm?!0:!1}function g(a,b){for(var c=ma.la(a,"SPEAKER",ma.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];O.Yd(e)&&(O.is_cyclic(e)||b)&&O.play_def(e)}}function A(a){a=a.d.Kg;for(var b=0;b<a.length;b++)a[b].d.wa&&a[b].use_auto_refresh&&a[b].d.wa.play()}function u(a,b,c,d,e){Aa.start();ca.log("%cSTART NLA","color: #0a0");e(b,c)}function S(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,g=0;g<e;g++){var E=b.lod_levels[g],f=E.object;
if(f){var m=Ja.Zg(f);m.name=b.name+"_LOD_"+String(g+1);m.uuid=Y.bp("Object"+m.name);m.lod_levels=[];c.push([a,m]);d.push(f);E.object=m}}}function I(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var g=d[e].dupli_group;g&&(g=g.objects,E=g.indexOf(a),-1<E&&g.splice(E,1))}var E=d.indexOf(a);-1<E&&d.splice(E,1)}}function v(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var g=a.scenes[d],f=kb?g.b4w_enable_physics:Na.b4w_enable_physics||g.b4w_enable_physics;kb||(g=Na);for(var m=
0;m<Wa.length;m++)for(var h=ma.la(g,Wa[m],ma.DATA_ID_ALL),k=0;k<h.length;k++){var q=h[k];q.d.jd==b.id&&Hb.enabled&&f&&(E.append_object(q,g),b.vp&&E.has_physics(q)&&E.disable_simulation(q))}}e(b,c)}function K(a,b,d,e,g){var E={};e=[];for(var f=a.scenes,m=0;m<a.scenes.length;m++){var h=f[m];if(h.d.Ba&&(h=h.d.Ba.Cj)&&"FILE"===h.source){var k=h.uuid,l=X(Q(b.q)+h.filepath);e.push([k,h.ec?la.AT_ARRAYBUFFER:la.AT_IMAGE_ELEMENT,l,h.name]);E[k]=h}}e.length?la.enqueue(e,function(b,d,e,g){if(b){c(b,g,!0);d=
E[d];g=q(d,a.textures);for(e=0;e<g.length;e++){var m=g[e];ba.Pj(m.d,b,d.ec,m.image.filepath)}for(e=0;e<f.length;e++)if(g=f[e],g.d.Ba.Cj===d){var h=b,k=d,l=document.createElement("canvas"),m=k.size[0],k=k.size[1];l.width=m;l.height=k;l=l.getContext("2d");l.drawImage(h,0,0);h=l.getImageData(0,0,m,k).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var m=m*k,k=new Float32Array(m),J=0;J<m;J++)k[J]=l[1]*h[4*J+2]+l[2]*h[4*J+3];g.d.Zl=k}}},function(){g(b,d)}):g(b,d)}function m(a,
b,d,e,g){if(zb.antialiasing&&zb.smaa){e=a.scenes[0];a=[];for(var E=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],f=0;f<E.length;f++){var m=ma.ga(e,E[f]);m&&a.push(m)}if(a.length){e=[];f=la.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",f,da.yb.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",f,da.yb.smaa_area_texture_path,"smaa_area_texture"]);for(f=0;f<a.length;f++)if(E=a[f],"SMAA_BLENDING_WEIGHT_CALCULATION"==E.type){a=E.Z;
for(f=0;f<a.length;f++)if(E=a[f],"u_search_tex"==E.V)var h=E.na;else if("u_area_tex"==E.V)var k=E.na;break}e.length?la.enqueue(e,function(a,b,d,e){a&&(c(a,e,!1),b="SEARCH_TEXTURE"==b?h:k,b.source="IMAGE",b.kn=!0,ba.Pj(b,a,-1!=e.indexOf(".dds")?1:0,e),ba.Aj(b,ba.s,ba.s))},function(){g(b,d)}):g(b,d)}else g(b,d)}else g(b,d)}function H(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];kb||(e=Na);for(var g=ma.la(e,"ALL",ma.DATA_ID_ALL),E=0;E<g.length;E++){var f=g[E];f.d.jd==b.id&&(b.vp&&ma.hide_object(f),
d.Zm.push({vx:e,obj:f}))}}}function D(a,b,c,d,e,g){a=d.Zm;var E=d.Hp;a.length?(e=a[E].obj,E=a[E].vx,ma.append_object(E,e),-1!=tc.indexOf(e.type)&&E.b4w_enable_audio&&O.append_object(e,E),d=++d.Hp/a.length):d=1;g(b,c,d)}function U(a,b,c,d,e){if(kb){for(d=0;d<a.scenes.length;d++){var g=a.scenes[d];ma.Zx(g);ma.Sy(g);(g.bk||0==d)&&ma.$w(g);g.b4w_use_nla&&Aa.Qy(g,g.b4w_nla_cyclic)}ma.set_active(a.scenes[0])}else ma.gr(Na);a=z(a,b.id);ja.Py(a);e(b,c)}function P(a,b,c,d,e){if(kb)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||
A(a.scenes[d]),g(a.scenes[d]);else a.scenes[0].b4w_use_nla||A(Na),g(Na);e(b,c);if(zb.Cq)for(a=a.scenes,d=0;d<a.length;d++)ma.set_sky_params(a[d],{})}function Z(a,b,c,d,e){zb.Ze&&(b.jl||b.il||b.ll)?Fa||V(a,e,b,c):e(b,c)}function V(a,b,c,d){var e=pb.canvas.parentElement;Ia=e.style.zIndex;e.style.zIndex="999";Fa=document.createElement("div");Fa.style.position="relative";Fa.style.height="88px";Fa.style.width="88px";var E=Math.round(pb.canvas.offsetWidth/2-44);Fa.style.top=Math.round(pb.canvas.offsetHeight/
2-44).toString()+"px";Fa.style.left=E.toString()+"px";Fa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Ma=document.createElement("div");Ma.style.position="relative";Ma.style.height=pb.canvas.offsetHeight.toString()+"px";Ma.style.width=pb.canvas.offsetWidth.toString()+"px";Ma.style.background="rgba(0, 0, 0, 0.5)";Ma.style.zIndex="999";e.appendChild(Ma);Ma.appendChild(Fa);Fa.addEventListener("click",function(){c.jl&&(ba.play(),ba.pause(),ba.reset());if(c.il){if(kb)for(var e=0;e<a.scenes.length;e++)g(a.scenes[e],!0);else g(Na,!0);O.pause()}c.ll&&O.Ww();M();b(c,d)},!1)}function M(){if(Fa){var a=pb.canvas.parentElement;
a.style.zIndex=Ia;Ma.removeChild(Fa);a.removeChild(Ma);Fa=Ma=null;Ia=0}}function Q(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function T(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function X(a){var b=a.split("://",2);return 1<
b.length?(b[1]=T(b[1]),b.join("://")):T(a)}function z(a,b){qb[b]||ia(a,b);return qb[b]}function ia(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)W(c[e].objects,0,d);qb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],g=0;g<c.length;g++)for(var E=c[g],f=0;f<E.length;f++)qb[b].push(E[f])}function W(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var g=a[e],E=L(g);d[E]=d[E]||[];(kb||-1==Ta.indexOf(g.type))&&-1==d[E].indexOf(g)&&d[E].push(g);(g=g.dupli_group)&&W(g.objects,b+1,c)}}function L(a){return(a=
a.parent||G.get_first_armature_object(a))?1+L(a):0}var G=p("__animation"),fa=p("__batch"),da=p("__config"),C=p("__controls"),J=p("__dds"),ha=p("__extensions");p("__lights");var pa=p("__loader"),la=p("__assets"),Y=p("__md5"),ja=p("__objects"),E=p("__physics"),ca=p("__print"),ua=p("__reformer"),ea=p("__renderer"),ma=p("__scenes"),Aa=p("__nla"),O=p("__sfx"),Ea=p("__shaders"),ba=p("__textures"),Ha=p("__nodemat"),Ja=p("__util"),ab=p("vec4"),Ka=p("mat4"),zb=da.n,Ab=da.ad,Hb=da.gb,Bb=da.Jd,Za=da.Ad,lb=null,
qb=null,tb="",kb=!1,Na=null,La={},Fa=null,Ma=null,Ia=0,Ta=["LAMP","CAMERA"],Wa=["MESH","CAMERA","EMPTY"],tc=["SPEAKER"],pb=null;a.is_primary_loaded=function(a){return pa.is_primary_loaded(a)};a.update=function(){pa.Ry(lb)};a.Xb=function(a){pb=a};a.Oy=function(a,b){if(Fa){Ma.style.height=b.toString()+"px";Ma.style.width=a.toString()+"px";var c=Math.round(a/2-44);Fa.style.top=Math.round(b/2-44).toString()+"px";Fa.style.left=c.toString()+"px"}};a.load=function(a,c,e,g,E){var q={load_main:{Ga:pa.ve,Sa:!1,
B:[],Ua:!1,ib:500,qb:!1,Ja:f},duplicate_objects:{Ga:pa.zc,Sa:!1,B:["load_main"],Ua:!1,ib:50,qb:!1,Ja:r},load_binaries:{Ga:pa.ve,Sa:!1,B:["load_main"],Ua:!1,ib:500,qb:!1,Ja:b},prepare_bindata:{Ga:pa.zc,Sa:!1,B:["duplicate_objects","load_binaries"],Ua:!1,ib:0,qb:!1,Ja:l},prepare_root_datablocks:{Ga:pa.zc,Sa:!1,B:["duplicate_objects","prepare_bindata"],Ua:!1,ib:150,qb:!1,Ja:k},prepare_root_scenes:{Ga:pa.zc,Sa:!1,B:["prepare_root_datablocks"],Ua:!1,ib:350,qb:!1,Ja:d},load_smaa_textures:{Ga:pa.ve,Sa:!0,
B:["prepare_root_scenes"],Ua:!1,ib:10,qb:!0,Ja:m},load_shoremap:{Ga:pa.ve,Sa:!0,B:["prepare_root_scenes"],Ua:!1,ib:10,qb:!0,Ja:K},load_textures:{Ga:pa.ve,Sa:!0,B:["prepare_root_scenes"],Ua:!0,ib:500,qb:!1,Ja:B,He:{dp:0}},add_physics_objects:{Ga:pa.zc,Sa:!1,B:["load_shoremap"],Ua:!1,ib:20,qb:!1,Ja:v},add_objects:{Ga:pa.zc,Sa:!1,B:["add_physics_objects"],Ua:!1,ib:800,qb:!1,Ja:H,Kf:D,Yg:U,He:{Zm:[],Hp:0}},load_speakers:{Ga:pa.ve,Sa:!0,B:["add_objects"],Ua:!0,ib:30,qb:!1,Ja:s,He:{ay:0}},mobile_media_start:{Ga:pa.zc,
Sa:!zb.Ze,B:["load_textures","load_speakers"],Ua:!0,ib:5,qb:!1,Ja:Z,Kf:Z},synchronize_media:{Ga:pa.zc,Sa:!0,B:["mobile_media_start"],Ua:!0,ib:70,qb:!1,Ja:P},start_nla:{Ga:pa.zc,Sa:!0,B:["mobile_media_start"],Ua:!1,ib:5,qb:!1,Ja:u}},J=pa.Oo();J||(J=pa.mu(),lb=[],qb=[],La={});lb[J.Sc.length]={};return pa.vu(q,a,c,e,h,g||Za.hn,zb.do_not_load_resources,E)};a.unload=function(a){var b=pa.Oo();if(!b||!b.Sc.length||a&&!pa.yy(b.Sc[a]))ca.error("Unable to unload data!");else{if(0==a)ca.log("%cUNLOAD ALL","color: #00a"),
G.cleanup(),O.cleanup(),Aa.cleanup(),ma.cleanup(),pa.cleanup(),E.cleanup(),ja.cleanup(),Ja.cleanup(),ea.cleanup(),Ha.cleanup(),Ea.cleanup(),C.cleanup(),ha.cleanup(),la.cleanup(),ba.cleanup(),qb=null,La={},kb=!1,lb=Na=null;else{ca.log("%cUNLOAD DATA "+a,"color: #00a");G.jx(a);for(var b=ma.Mi(),c=0;c<b.length;c++)for(var d=b[c],e=ma.la(d,"ALL",ma.DATA_ID_ALL),g=e.length-1;0<=g;g--){var f=e[g];if(f.d.jd==a){var m=d,h=f;G.is_animated(h)&&G.remove(h);ma.clear_glow_anim(h);E.has_physics(h)&&(E.disable_simulation(h),
E.kx(h));C.check_sensor_manifold(h)&&C.remove_sensor_manifold(h);ma.lx(m,h);O.Yd(h)&&O.by(h);e.splice(g,1);m=ma.la(d,f.type,ma.DATA_ID_ALL);f=m.indexOf(f);-1!=f&&m.splice(f,1)}}}M()}};a.set_debug_resources_root=function(a){tb=a}};
b4w.module.__batch=function(a,p){function h(a){a={type:a,id:0,Sl:0,nf:"",D:[],ac:[],tc:[],Gl:[],fd:[],Af:null,Ra:{},Yb:null,Xa:null,gn:[],Jc:null,bb:null,gc:null,vb:null,ao:!1,num_vertices:0,num_triangles:0,Zi:0,$i:0,Zf:0,Ri:0,gl:0,Ib:new Float32Array(3),Nn:new Float32Array(3),Ec:new Float32Array(16),qa:!1,On:!1,N:!1,mc:!1,ka:!1,zf:!1,md:!1,Nb:!1,Ob:!1,rb:!1,Wb:!1,Mb:!1,uc:!1,ya:!1,fq:!1,ld:Q.Og,Ed:Q.Zc,Cg:0,om:new Float32Array(2),p:new Float32Array(2),To:!1,Xo:0,Uo:0,Yo:0,Zo:0,Wo:new Float32Array(3),
Vo:new Float32Array(3),Ve:!1,Bc:0,Qd:0,Le:1,Nh:0,Gq:0,rg:1,Fh:0,Ke:0,ye:1,Ep:0,Cl:0,of:0,jq:0,kd:Array(2),lc:new Float32Array(3),Qc:new Float32Array(3),Bd:new Float32Array(3),ob:new Float32Array(4),pd:new Float32Array(4),cg:null,ql:null,ol:null,nl:null,pl:null,re:!1,water_dynamic:!1,Em:!1,pr:!1,qr:0,rr:0,or:0,Uj:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,xo:new Float32Array(2),wo:new Float32Array(2),Uk:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
lf:null,Rl:!1,Rp:0,Np:0,Kl:0,Qp:0,Tp:0,Sp:0,Op:0,Pp:0,Ll:0,Kp:0,Jp:0,Vp:0,Mp:0,nj:new Float32Array(3),Up:new Float32Array(8),Lp:new Float32Array(16)};a.ob[3]=1;a.On=!0;a.N=!0;a.Cg=1;return a}function c(a,c,d){for(var e=[],g=0;g<a.length;g++){var f=a[g],m=f.d,h=l(f.data.b4w_bounding_box),k=f.data.b4w_bounding_cylinder_radius,q=f.data.b4w_bounding_sphere_radius,J=f.data.b4w_bounding_sphere_center,n=f.data.b4w_bounding_ellipsoid_axes,C=f.data.b4w_bounding_ellipsoid_center;if(m.cd){var q=Math.max(Math.abs(h.max_x),
Math.abs(h.min_x)),k=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),r=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),r=Math.sqrt(q*q+k*k+r*r),q=Math.sqrt(q*q+k*k);h.max_x=h.max_y=h.max_z=r;h.min_x=h.min_y=h.min_z=-r;k=q;q=r;J[0]=J[1]=J[2]=0;n[0]=n[1]=n[2]=r;C[0]=C[1]=C[2]=0}m.Db=h;r=P.pk(h,m.H);m.Ia=r;var r=m,t=k;r.nk=P.Un(t,h);r.lk=P.Sn(k,h);r.mk=P.Tn(t,h);J=P.Ek(q,J);m.rc=J;J=P.rk(J,m.H);m.kb=J;n=P.Dk([n[0],0,0],[0,n[1],0],[0,0,n[2]],C);m.Ee=n;n=P.qk(n,m.Tc);m.Fe=n;e=e.concat(b(f,m,c,d))}return e}
function f(a,c,d,e){for(var g=[],f=[],m={},h=0;h<a.length;h++){var k=a[h],q=k.d,n=l(k.data.b4w_bounding_box),C=P.pk(n,q.H),r=P.Ek(k.data.b4w_bounding_sphere_radius,k.data.b4w_bounding_sphere_center),t=P.rk(r,q.H),u=k.data.b4w_bounding_ellipsoid_axes,u=P.Dk([u[0],0,0],[0,u[1],0],[0,0,u[2]],k.data.b4w_bounding_ellipsoid_center),w=P.qk(u,q.Tc);q.Db=n;q.Ia=C;q.rc=r;q.kb=t;q.Ee=u;q.Fe=w;n={};n.Nb=q.Nb;n.Ob=q.Ob;n.rb=q.rb;n.Kc=q.Kc;n.mj=q.mj;n.Pi=q.Pi;n.Wb=q.Wb;n.Mb=q.Mb;n.uc=q.uc;n.Ge=q.Ge;n.Vc=q.Vc;n.ud=
q.ud;n.xb=q.xb;n.cd=q.cd;n.Vg=q.Vg;n.ya=q.ya;n.Qf=q.Qf;n.Ii=q.Ii;n.md=q.md;C=q.kb.t;n.dw=0==d?[0,0]:[Math.floor(C[0]/d),Math.floor(C[2]/d)];n.Zd=q.Zd;n.yh=q.yh;n.gf=q.gf;q=JSON.stringify(n);m[q]=m[q]||[];m[q].push(k)}for(var s in m){n=JSON.parse(s);d=m[s];var k=z.Fi("STATIC"),D;for(D in n)k[D]=n[D];k.jd=a[0].d.jd;k.Wc=0;k.ue=0;k.Nd=0;k.Md=0;k.Kd=0;k.qh=!1;for(h=0;h<d.length;h++)q=d[h],0==h?(k.Ia=J.ra(q.d.Ia),k.kb=J.ra(q.d.kb),k.Ee=J.ra(q.d.Ee),k.Fe=J.ra(q.d.Fe)):(P.mo(k.Ia,q.d.Ia),P.Tu(k.kb,q.d.kb));
k.Db=J.ra(k.Ia);k.rc=J.ra(k.kb);f.push({Gb:k,vd:d})}for(a=0;a<f.length;a++)for(m=f[a].Gb,h=f[a].vd,s=0;s<h.length;s++){D=h[s];d=b(D,m,c,e);k=I(D.d)||I(m);q={};m.Vc&&(q.au_center_pos=[k[0],k[1],k[2]],q.au_wind_bending_amp=[D.d.Wc],q.au_wind_bending_freq=[D.b4w_wind_bending_freq],q.au_detail_bending_amp=[D.b4w_detail_bending_amp],q.au_detail_bending_freq=[D.b4w_detail_bending_freq],q.au_branch_bending_amp=[D.b4w_branch_bending_amp]);for(n=0;n<d.length;n++)t=d[n].Gb,C=d[n].$b,r=d[n].k,t.Yi?t.cd?Q.oy(C,
k):Q.Sq(C,k):("COLOR_ID"==r.type?(t=d[n].Gb=D.d,t.type="DYNAMIC",r.nf=D.uuid,y(r,t),v(r,J.Xg(t,0))):C=Q.Sq(C,k),Q.ny(C,q));g=g.concat(d)}return g}function b(a,b,c,d){var g=[];if(a.b4w_do_not_render)return g;for(var f=e(c,b),m=J.Xg(b,0),q=a.data,l=q.materials,n=0;n<f.length;n++)for(var C=f[n],r=0;r<l.length;r++){var t=l[r];if(("LENS_FLARES"!=t.name||0!=d)&&!Q.$o(q,r)){var u=h(C);if(k(u,t,!0)){u.ld=q.ld||Q.Og;"COLOR_ID"===C&&u.Nn.set(a.Sm);y(u,b);for(var w=u,s=a.particle_systems,D=0;D<s.length;D++){var H=
s[D].settings.b4w_vcol_from_name,x=s[D].settings.b4w_vcol_to_name;""!==H&&""!==x&&(w.Ra[H]={Se:!1,src:[{name:H,jc:7}]})}"DYNAMIC"==b.type&&(u.nf=a.uuid);v(u,m);w=Q.so(q,r,u.fd,u.gc,u.Ra,u.Af);"LENS_FLARES"==t.name&&(w=ia.Zw(w));g.push({k:u,$b:w,Sb:[t.name],Gb:b,vc:[a]})}}}f=a.particle_systems;if(0<f.length&&g.length){d=!0;for(n=0;n<f.length;n++)if(f[n].settings.use_render_emitter){d=!1;break}n=g[0].k;f=g[0].$b;q=[];l=a.particle_systems;C=a.data;for(r=0;r<l.length;r++)if(t=l[r],u=t.settings,u.count)if("EMITTER"==
u.type){if("DYNAMIC"==b.type){w=h("PARTICLES");s=C.materials;D=t.settings.material-1;D>=s.length&&(V.warn('B4W Warning: Wrong material used for rendering particle system "'+t.name+'"'),D=0);s=s[D];"HALO"===t.settings.render_type&&(w.Ve=!0);k(w,s);y(w,b);D=w;switch(t.settings.b4w_billboard_align){case "VIEW":A(D,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":A(D,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":A(D,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":A(D,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}A(D,"BILLBOARD",0);w.md=!0;w.nf=a.name+"_"+u.uuid;v(w,m);w.Jc=t;u=ia.ov(w,C,t,a.d.Tc);ia.Ex(w,t,s);q.push({k:w,$b:u,Sb:[s.name],Gb:b,vc:[a]})}}else if("HAIR"==u.type){w=J.Vi(t.seed);u.b4w_dynamic_grass&&(b.Qf=!0);if(t.transforms.length)var B=t.transforms;else for(var s=Q.al(f,u.count,!1,w),B=new Float32Array(4*s.length),Y=0;Y<s.length;Y++)D=.75+.5*J.kc(w),B[4*Y]=s[Y][0],B[4*Y+1]=s[Y][1],B[4*Y+2]=s[Y][2],B[4*Y+3]=D;s=G.Ma(c,"GRASS_MAP")?
!0:!1;if("OBJECT"==u.render_type)D=[e(c,u.dupli_object.d)],t=S(a,b,n,f,[u.dupli_object],D,[B],u,t,s,w,!1),q=q.concat(t);else if("GROUP"==u.render_type){H=u.dupli_group.objects;x=!1;D=[];for(Y=0;Y<H.length;Y++){var U=e(c,u.dupli_group.objects[Y].d);D.push(U)}if(u.use_whole_group){x=B;B=H;Y={};for(U=0;U<x.length;U+=4)for(var la=0;la<B.length;la++){var ja=ha.create();ha.scale(B[la].d.e,B[la].d.scale,ja);var P=ha.clone([x[U],x[U+1],x[U+2]]);ha.add(P,ja,P);Y[la]||(Y[la]=new Float32Array(x.length));Y[la][U]=
P[0];Y[la][U+1]=P[1];Y[la][U+2]=P[2];Y[la][U+3]=x[U+3]}B=Y;x=!0}else if(u.use_group_count){for(var P=H,I=u.dupli_weights,Y=w,U={},la=[],ja=0;ja<P.length;ja++)for(var z=P[ja],z=z.origin_name||z.name,K=0;K<I.length;K++){var pa=I[K];z==pa.name.split(": ")[0]&&la.push(pa)}I.length!=la.length&&V.error("B4W Error: dupli weights match failed");for(ja=0;ja<B.length;ja+=4){var p,I=la;p=[0];for(P=0;P<I.length;P++)p[P+1]=p[P]+I[P].count;I=p[p.length-1]*J.kc(Y);for(P=z=0;P<p.length;P++)if(I>=p[P]&&I<p[P+1]){z=
P;break}p=z;U[p]=U[p]||[];U[p].push(B[ja],B[ja+1],B[ja+2],B[ja+3])}for(p in U)U[p]=new Float32Array(U[p]);B=U}else{Y=w;U=H.length;la={};for(ja=0;ja<B.length;ja+=4){var M=Math.floor(U*J.kc(Y));la[M]=la[M]||[];la[M].push(B[ja],B[ja+1],B[ja+2],B[ja+3])}for(M in la)la[M]=new Float32Array(la[M]);B=la}t=S(a,b,n,f,H,D,B,u,t,s,w,x);q=q.concat(t)}"INSTANCE"==u.b4w_wind_bend_inheritance&&(a.d.Wc=0)}else throw"Unknown particle settings type";a=q;g=d?a:g.concat(a)}return g}function l(a){return{max_x:a.max_x,
min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function e(a,b){var c=["MAIN","NODES"];b.Kc&&(G.Ma(a,"COLOR_PICKING")||G.Ma(a,"GLOW_MASK"))&&c.push("COLOR_ID");G.Ma(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(G.Ma(a,"DEPTH")||G.Ma(a,"SHADOW_CAST"))&&c.push("DEPTH");G.Ma(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Ob||b.Mb){var d=null;b.Ob&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Mb)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?J.lt(d,
e):e;for(e=0;e<d.length;e++){var g=c.indexOf(d[e]);-1!==g&&c.splice(g,1)}}return c}function k(a,b,c){var e,f;switch(a.type){case "MAIN":if(b.b4w_collision||b.use_nodes)a=!1;else{r(a,b);var h=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.of=b.offset_z;a.Qc.set([1,1,1]);var k=b.texture_slots;pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);switch(b.name){case "LENS_FLARES":m(a,"special_lens_flares.glslv","special_lens_flares.glslf");g(a,
"a_position");g(a,"a_texcoord");var l=c?[1,1,1,0]:null,l=x(k[0],l);H(a,l);break;default:m(a,"main.glslv","main.glslf");var J=n("use_map_color_diffuse",k),C=n("use_map_color_spec",k),u=n("use_map_normal",k),s=n("use_map_mirror",k),D=n("use_stencil",k),h=J[0],C=C[0],u=u[0],s=s[0],J=J[1],k=D[0]&&n("use_rgb_to_intensity",k)[0];if(h){switch(h.blend_type){case "MIX":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l="IMAGE"==
h.texture.d.source&&c?[a.ob[0],a.ob[1],a.ob[2],1]:"ENVIRONMENT_MAP"==h.texture.d.source&&c?[.8,.8,.8,1]:null;l=x(h,l);H(a,l,"u_colormap0");a.Ke=h.diffuse_color_factor;a.ye=h.use_map_alpha?h.alpha_factor:0;a.Qc.set(h.scale)}D=h&&h==C;C&&(D||(l=c?[.5,.5,.5,1]:null,l=x(C,l),H(a,l,"u_specmap0")),a.Gq=C.specular_color_factor);if(u){g(a,"a_normal");g(a,"a_tangent");l=c?[.5,.5,1,1]:null;l=x(u,l);H(a,l,"u_normalmap0");a.Ep=u.normal_factor;var v=u.texture;if(v.b4w_use_map_parallax&&Y.Eh){var l=fa.u(v.b4w_parallax_steps),
ha=fa.u(v.b4w_parallax_lod_dist);A(a,"PARALLAX",1);A(a,"PARALLAX_STEPS",l);A(a,"PARALLAX_LOD_DIST",ha);a.Fh=v.b4w_parallax_scale}}s&&(l=c?[0,0,.5,1]:null,l=x(s,l),H(a,l,"u_mirrormap"),a.Cl=s.mirror_factor);if(v=h&&J&&k?1:0)l=c?[.8,.8,.8,1]:null,l=x(J,l),H(a,l,"u_colormap1"),l=c?[.5,.5,.5,1]:null,l=x(k,l),H(a,l,"u_stencil0");(c=h||C||u)&&a.Qc.set(c.scale);A(a,"TEXTURE_SPEC",void 0==C?0:1);A(a,"TEXTURE_MIRROR",void 0==s?0:1);A(a,"ALPHA_AS_SPEC",D?1:0);A(a,"TEXTURE_STENCIL_ALPHA_MASK",v);g(a,"a_position");
g(a,"a_normal");(h||C||u)&&g(a,"a_texcoord");if(b.b4w_water){a.re=!0;a.Em=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;m(a,"special_water.glslv","special_water.glslf");g(a,"a_position");g(a,"a_texcoord");g(a,"a_normal");g(a,"a_tangent");Y.Vj?(g(a,"a_polyindex"),a.N=!0,a.wireframe_edge_color=[0,0,0],A(a,"DEBUG_WIREFRAME",1)):A(a,"DEBUG_WIREFRAME",0);D=n("use_map_normal",c);s=n("use_map_mirror",c)[0];D.length&&(v=x(D[0]),H(a,v,"u_normalmap0"),a.Uj=b.b4w_water_norm_uv_velocity);
A(a,"NUM_NORMALMAPS",D.length);a.lf=Array(D.length);for(v=0;v<D.length;v++)a.lf[v]=new Float32Array(2),a.lf[v].set([D[v].scale[0],D[v].scale[1]]);s?(A(a,"TEXTURE_MIRROR",1),D=x(s),H(a,D,"u_mirrormap"),a.Cl=s.mirror_factor):A(a,"TEXTURE_MIRROR",0);s=null;for(v=0;v<c.length;v++)if(e=c[v],!0===e.texture.b4w_water_foam){s=e;break}s&&Y.Vf?(A(a,"FOAM",1),D=x(s),H(a,D,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.xo.set(s.texture.b4w_foam_uv_freq),a.wo.set(s.texture.b4w_foam_uv_magnitude),a.Uk[0]=s.scale[0],
a.Uk[1]=s.scale[1]):A(a,"FOAM",0);for(v=0;v<c.length;v++)if(e=c[v],!0===e.texture.b4w_shore_dist_map){f=e;break}f&&Y.ek?(f=x(f),H(a,f,"u_shore_dist_map"),A(a,"SHORE_PARAMS",1),f=e.texture.b4w_shore_boundings,A(a,"MAX_SHORE_DIST",fa.u(e.texture.b4w_max_shore_dist)),A(a,"SHORE_MAP_SIZE_X",fa.u(f[0]-f[1])),A(a,"SHORE_MAP_SIZE_Y",fa.u(f[2]-f[3])),A(a,"SHORE_MAP_CENTER_X",fa.u((f[0]+f[1])/2)),A(a,"SHORE_MAP_CENTER_Y",fa.u((f[2]+f[3])/2))):A(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&Y.deferred_rendering?
(A(a,"GENERATED_MESH",1),a.pr=!0,a.qr=b.b4w_water_num_cascads,a.rr=b.b4w_water_subdivs,a.or=b.b4w_water_detailed_dist):A(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){e=fa.u(b.b4w_water_dst_noise_scale0);f=fa.u(b.b4w_water_dst_noise_scale1);c=fa.u(b.b4w_water_dst_noise_freq0);var s=fa.u(b.b4w_water_dst_noise_freq1),D=fa.u(b.b4w_water_dir_min_shore_fac),v=fa.u(b.b4w_water_dir_freq),l=fa.u(b.b4w_water_dir_noise_scale),ha=fa.u(b.b4w_water_dir_noise_freq),y=fa.u(b.b4w_water_dir_min_noise_fac),U=fa.u(b.b4w_water_dst_min_fac),
la=fa.u(b.b4w_water_waves_hor_fac);A(a,"DST_NOISE_SCALE_0",e);A(a,"DST_NOISE_SCALE_1",f);A(a,"DST_NOISE_FREQ_0",c);A(a,"DST_NOISE_FREQ_1",s);A(a,"DIR_MIN_SHR_FAC",D);A(a,"DIR_FREQ",v);A(a,"DIR_NOISE_SCALE",l);A(a,"DIR_NOISE_FREQ",ha);A(a,"DIR_MIN_NOISE_FAC",y);A(a,"DST_MIN_FAC",U);A(a,"WAVES_HOR_FAC",la)}w(a,b);B(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;
A(a,"ABSORB",fa.u(b.b4w_water_absorb_factor));A(a,"SSS_STRENGTH",fa.u(b.b4w_water_sss_strength));A(a,"SSS_WIDTH",fa.u(b.b4w_water_sss_width));e=a.Xa;f=a.fd;a.Xa=e;a.fd=f}"HALO"===b.type&&(e=b.halo,m(a,"halo.glslv","halo.glslf"),A(a,"NUM_RINGS",e.ring_count),A(a,"NUM_LINES",e.line_count),A(a,"NUM_STARS",e.star_tip_count),A(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.fd=["a_position"],a.Xo=e.size,a.Uo=e.hardness/20,a.Wo.set(e.b4w_halo_rings_color),a.Vo.set(e.b4w_halo_lines_color),a.Yo=1/b.b4w_halo_stars_blend_height,
a.Zo=b.b4w_halo_stars_min_height,a.To=!0);A(a,"TEXCOORD",0);A(a,"NORMAL_TEXCOORD",0);h&&d(a,h,"TEXTURE_COLOR0_CO");J&&d(a,J,"TEXTURE_COLOR1_CO");k&&d(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");C&&d(a,C,"TEXTURE_SPEC_CO");u&&d(a,u,"TEXTURE_NORM_CO");A(a,"SHADELESS",b.use_shadeless?1:0);a.zf=b.use_shadeless}h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);A(a,"ALPHA_CLIP","CLIP"===h?1:0);A(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(A(a,"VERTEX_COLOR",1),
g(a,"a_color")):A(a,"VERTEX_COLOR",0);a.Bc=b.ambient;a.Le=b.diffuse_intensity;a.Qd=b.emit;a.Bd.set(b.specular_color);a.rg=b.specular_alpha;w(a,b);B(a,b);b.b4w_wettable?A(a,"WETTABLE",1):A(a,"WETTABLE",0);t(a,b);Y.Ue?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0);a.Rl=b.b4w_refractive;a.jq=b.b4w_refr_bump;a=!0}break;case "NODES":a=q(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(r(a,b),a.qa)a=!1;else{m(a,"depth.glslv","depth.glslf");g(a,"a_position");
g(a,"a_normal");h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);a.Qc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Qc.set(b.scale);A(a,"TEXTURE_COLOR",1);g(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=x(b),H(a,h,"u_colormap0");"NONE"==b.texture.d.source&&(h=x(b),H(a,h,"u_colormap0"))}else A(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.Yy=b.b4w_use_ghost,a.Qb=b.b4w_collision_id,a.Ln=b.b4w_collision_group,
a.Mn=b.b4w_collision_mask,a.mh=b.physics.friction,a.hh=b.physics.elasticity,a=!0):b.b4w_water?(a.re=!0,a.hz=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=
b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_collision||"HALO"===b.type)a=!1;else{r(a,b);a.Ed=Q.Zc;a.N=!0;a.qa=!1;h=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;m(a,"color_id.glslv","color_id.glslf");g(a,"a_position");h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);a.Qc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&
"CLIP"===h){a.Qc.set(b.scale);A(a,"TEXTURE_COLOR",1);g(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=x(b),H(a,h,"u_colormap0");"NONE"==b.texture.d.source&&(h=x(b),H(a,h,"u_colormap0"))}else A(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(r(a,b),a.qa=!1,a.Ed=Q.Zc,a.N=!0,m(a,"grass_map.glslv","grass_map.glslf"),g(a,"a_position"),h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,
a.Ra.a_grass_size={Se:!0,src:[]},h?(a.Ra.a_grass_size.src.push({name:h,jc:4}),A(a,"DYNAMIC_GRASS_SIZE",1)):A(a,"DYNAMIC_GRASS_SIZE",0),a.Ra.a_grass_color={Se:!0,src:[]},b?(a.Ra.a_grass_color.src.push({name:b,jc:7}),A(a,"DYNAMIC_GRASS_COLOR",1)):A(a,"DYNAMIC_GRASS_COLOR",0),Y.Ue?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(m(a,"wireframe.glslv","wireframe.glslf"),g(a,"a_position"),g(a,"a_normal"),
g(a,"a_polyindex"),a.N=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],Y.Ue?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":h=b.texture_slots;if(a.Ve)m(a,"particles_color.glslv","particles_color.glslf");else if(m(a,"particles_texture.glslv","particles_texture.glslf"),h=n("use_map_color_diffuse",h)[0]){A(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ke=
h.diffuse_color_factor;a.ye=h.use_map_alpha?h.alpha_factor:0;h=x(h);H(a,h)}pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Bc=b.ambient;a.Le=b.diffuse_intensity;a.Qd=b.emit;a.Bd.set(b.specular_color);a.rg=b.specular_alpha;g(a,"a_position");g(a,"a_normal");h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);A(a,"ALPHA_CLIP","CLIP"===h?1:0);A(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);w(a,b);B(a,b);r(a,b);h=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&
"OPAQUE"!=h&&"CLIP"!=h;a.of=b.offset_z;Y.Ue?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+a.type;}return a}function d(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":A(a,c,"TEXTURE_COORDS_UV_ORCO");A(a,"TEXCOORD",1);break;case "NORMAL":A(a,c,"TEXTURE_COORDS_NORMAL");A(a,"NORMAL_TEXCOORD",1);break;default:A(a,c,0)}}function r(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.qa=!0;a.Ed=Q.Rm;a.N=!0;break;case "ALPHA":a.qa=!0;a.Ed=
Q.Zc;a.N=!0;break;case "CLIP":a.qa=!1;a.Ed=Q.Zc;a.N=!0;break;case "ADD":a.qa=!0;a.Ed=Q.Zc;a.N=!1;break;case "OPAQUE":a.qa=!1;a.Ed=Q.Zc;a.N=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.ka=c.use_backface_culling}function x(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&da.Pj(d,b,c.ec,c.filepath);return d}function n(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var g=b[e];1==g[a]&&g.texture&&g.texture.d&&c.push(g)}return c}function t(a,b){var c=b.raytrace_transparency;a.pd[0]=c.fresnel;
a.pd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Nh=c.reflect_factor;a.pd[2]=c.fresnel;a.pd[3]=1-c.fresnel_factor/5}function w(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":A(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":A(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":A(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:V.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.lc[0]=b.specular_intensity;a.lc[1]=c;a.lc[2]=d}function B(a,b){switch(b.diffuse_shader){case "LAMBERT":A(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.kd[0]=0;a.kd[1]=0;break;case "OREN_NAYAR":A(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.kd[0]=b.roughness;a.kd[1]=0;break;case "FRESNEL":A(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.kd[0]=b.diffuse_fresnel;a.kd[1]=b.diffuse_fresnel_factor;break;default:V.error("B4W Error: unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.name+'")'),a.kd[0]=0,a.kd[1]=0}}function q(a,b){if(!b.use_nodes)return!1;var c=X.Ot(b.node_tree,b.uuid,!1);if(!c)return V.error('Failed to create node graph for material "'+b.name+'", disable nodes'),s(a,b),!0;m(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===d?0:1);A(a,"ALPHA_CLIP","CLIP"===d?1:0);A(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);g(a,"a_position");r(a,b);a.of=b.offset_z;d=b.game_settings.alpha_blend;
a.mc=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Qd=b.emit;a.Bc=b.ambient;t(a,b);b.b4w_wettable?A(a,"WETTABLE",1):A(a,"WETTABLE",0);a.Gl=X.Pt(c);var e=!1;T.L(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var f=d.data.name,m=d.data.value;a.Af||(a.Af={});a.Af[m]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=d.data.name;a.Ra[f]={Se:!0,src:[{name:d.data.value}]};m=0;if("GEOMETRY_VC"==
d.type)m=7;else for(var h=0;h<d.Pa.length;h++){var k="RGB".indexOf(d.Pa[h].identifier);-1<k&&(m|=1<<2-k)}a.Ra[f].src[0].jc=m;break;case "GEOMETRY_NO":g(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":f=d.data.value;g(a,"a_normal");A(a,"DIFFUSE_SHADER","DIFFUSE_"+f.Ju);A(a,"SPECULAR_SHADER","SPECULAR_"+f.dy);A(a,"SHADELESS_MAT",f.zf?1:0);a.zf=f.zf;a.rg=f.rg;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":f=d.data.name;
m=d.data.value;!1!==m.d.ni&&(m.d.ni="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);H(a,m.d,f);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "PARALLAX":A(a,"CALC_TBN_SPACE",1);g(a,"a_normal");g(a,"a_tangent");f=d.data.name;(m=d.data.value)?(m.d.ni=!1,H(a,m.d,f)):V.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.cg=d.data);break;case "REFRACTION":a.Rl=!0}});e||(a.zf=!0);Y.Ue?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",
0);return!0}function s(a,b){m(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===c?0:1);A(a,"ALPHA_CLIP","CLIP"===c?1:0);A(a,"SHADELESS",1);g(a,"a_position");g(a,"a_normal");pa.set(1,0,1,1,a.ob);A(a,"VERTEX_COLOR",0);a.of=b.offset_z;r(a,b)}function y(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Yi?A(a,"AU_QUALIFIER","attribute"):A(a,"AU_QUALIFIER","uniform"),A(a,"STATIC_BATCH",0)):(A(a,"AU_QUALIFIER","attribute"),A(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(M.Sv()?
A(a,"WIREFRAME_QUALITY",1):A(a,"WIREFRAME_QUALITY",0),a.Lk?(A(a,"DEBUG_SPHERE",1),a.ao?A(a,"DEBUG_SPHERE_DYNAMIC",1):A(a,"DEBUG_SPHERE_DYNAMIC",0)):A(a,"DEBUG_SPHERE",0),A(a,"ALPHA",1));b.Vc?(""!==b.ud?(a.Ra.a_bending_col_main={Se:!0,src:[{name:b.ud,jc:4}]},g(a,"a_bending_col_main"),""!==b.xb.sp&&""!==b.xb.rp&&""!==b.xb.Ip?(a.Ra.a_bending_col_detail={Se:!0,src:[{name:b.xb.sp,jc:4},{name:b.xb.rp,jc:2},{name:b.xb.Ip,jc:1}]},g(a,"a_bending_col_detail"),g(a,"a_normal"),A(a,"DETAIL_BEND",1)):A(a,"DETAIL_BEND",
0),A(a,"MAIN_BEND_COL",1)):A(a,"MAIN_BEND_COL",0),A(a,"WIND_BEND",1)):A(a,"WIND_BEND",0);b.ti?A(a,"BEND_CENTER_ONLY",1):A(a,"BEND_CENTER_ONLY",0);b.cd?A(a,"BILLBOARD",1):A(a,"BILLBOARD",0);b.cd&&b.Yi?A(a,"HAIR_BILLBOARD",1):A(a,"HAIR_BILLBOARD",0);b.ok?A(a,"BILLBOARD_SPHERICAL",1):A(a,"BILLBOARD_SPHERICAL",0);switch(b.Vg){case "RANDOM":A(a,"BILLBOARD_RANDOM",1);A(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":A(a,"BILLBOARD_RANDOM",0);A(a,"BILLBOARD_JITTERED",1);break;default:A(a,"BILLBOARD_RANDOM",
0),A(a,"BILLBOARD_JITTERED",0)}b.ya&&Y.ek?A(a,"DYNAMIC_GRASS",1):A(a,"DYNAMIC_GRASS",0);a.ya=b.ya;a.md=b.md;a.Nb=b.Nb;a.Ob=b.Ob;a.rb=b.rb&&!a.zf&&!(a.qa&&Y.fo);a.Wb=b.Wb;a.Mb=b.Mb;a.uc=b.uc;b.uh?(g(a,"a_influence"),A(a,"SKINNED",1),b.lh?A(a,"FRAMES_BLENDING",1):A(a,"FRAMES_BLENDING",0),A(a,"MAX_BONES",b.max_bones)):(A(a,"SKINNED",0),A(a,"FRAMES_BLENDING",0));b.ci?(A(a,"VERTEX_ANIM",1),Y.mr?A(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):A(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):A(a,"VERTEX_ANIM",
0);if(b.uh&&b.ci)throw"Skinning and vertex animation are mutually exlusive";b.Ii?A(a,"DISABLE_FOG",1):A(a,"DISABLE_FOG",0);b.gc&&(a.gc=b.gc);if(b.jf&&"NODES"==a.type){for(var c=a.Gl,d=b.zh,e=0;e<c.length;e++){var f=c[e];switch(f.id){case "ANIM_VALUE":for(var m=f.pj[1],h=0;h<d.length;h+=2)if(d[h]==m){f.pj[0]=d[h+1];break}}}A(a,"NUM_ANIM_VALUES",b.jf.length)}}}function g(a,b){var c=a.fd;-1==c.indexOf(b)&&c.push(b)}function A(a,b,c){fa.J(a.Xa,b,c)}function u(a,b){if("PHYSICS"==a.type)a.$b=b;else{var c=
a.Ed,d=a.ld;a.To&&(b=Q.Xu(b));a.pr&&(b=W.sv(a.qr,a.rr,a.or));c=Q.qy(b,c,d,a.Ra);a.md||c.Ui||(c.Vd=null,c.Uc=null);a.bb=c;c=b.r.length;a.num_vertices=b.C*c;a:switch(a.ld){case Q.Og:case Q.ii:case Q.Im:d=!0;break a;default:d=!1}d?Q.tw(b)?a.num_triangles=b.Y.length/3*c:a.num_triangles=b.C/3*c:a.num_triangles=0}}function S(a,b,c,d,e,g,f,m,q,l,n,r){var u=[],t=m.b4w_dynamic_grass;if(!l&&t)return u;for(var s="INSTANCE"==m.b4w_wind_bend_inheritance,w="INSTANCE"==m.b4w_shadow_inheritance,D="INSTANCE"==m.b4w_reflection_inheritance,
H=[],B=[],x=0;x<e.length;x++){var A=e[x],Y=J.Zg(b);Y.cd=m.b4w_hair_billboard;Y.Vg=m.b4w_hair_billboard_type;Y.ok="SPHERICAL"==m.b4w_hair_billboard_geometry;Y.ya=t;Y.Yi=!0;Y.jf=A.d.jf;Y.zh=A.d.zh;s?(Y.Vc=A.d.Vc,Y.gi=A.d.gi,Y.ue=A.d.ue,Y.Nd=A.d.Nd,Y.ud=A.d.ud,Y.Md=A.d.Md,Y.Kd=A.d.Kd,Y.Wc=A.d.Wc,Y.xb=A.d.xb,Y.ti=!1):(Y.Vc=a.d.Vc,Y.gi=a.d.gi,Y.ue=a.d.ue,Y.Nd=a.d.Nd,Y.ud=a.d.ud,Y.Md=a.d.Md,Y.Kd=a.d.Kd,Y.Wc=a.d.Wc,Y.xb=a.d.xb,Y.ti=!0);w?(Y.Nb=A.d.Nb,Y.Ob=A.d.Ob,Y.rb=A.d.rb):(Y.Nb=a.d.Nb,Y.Ob=a.d.Ob,Y.rb=
a.d.rb);D?(Y.Wb=A.d.Wb,Y.Mb=A.d.Mb,Y.uc=A.d.uc):(Y.Wb=a.d.Wb,Y.Mb=a.d.Mb,Y.uc=a.d.uc);H.push(Y);var U=f[x];U||(U=new Float32Array);r&&J.Vi(q.seed,n);for(var ja=new Float32Array(3),P=new Float32Array([0,0,0,1]),I=[],z=0;z<U.length;z+=4){ja[0]=U[z];ja[1]=U[z+1];ja[2]=U[z+2];var K=U[z+3];if(m.b4w_initial_rand_rotation){switch(m.b4w_rotation_type){case "XYZ":var p=new Float32Array([J.kc(n),J.kc(n),J.kc(n)]);ha.normalize(p,p);break;case "Z":p=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+
m.b4w_rotation_type;}la.setAxisAngle(p,m.b4w_rand_rotation_strength*(2*Math.PI*J.kc(n)-Math.PI),P)}var S=C.Of(ja,K,P);I.push(S)}B.push(I)}for(var G={},x=0;x<e.length;x++){var M=g[x],Y=H[x],Z=J.Xg(Y,0),I=B[x];if(I.length)for(var da=e[x].data,ub=da.materials,z=0;z<ub.length;z++)if(!Q.$o(da,z))for(var T=0;T<M.length;T++){var L=M[T];if("COLOR_ID"!==L){var fc=h(L),W=ub[z];if(k(fc,W,!0)){fc.ld=da.ld||Q.Og;y(fc,Y);fc.nf=m.uuid;"JITTERED"==m.b4w_hair_billboard_type&&(fc.Zi=m.b4w_hair_billboard_jitter_amp,
fc.$i=m.b4w_hair_billboard_jitter_freq);t&&(fc.Ri=m.b4w_dynamic_grass_scale_threshold);s||(delete fc.Ra.a_bending_col_main,delete fc.Ra.a_bending_col_detail);v(fc,Z);var ad=Q.so(da,z,fc.fd,fc.gc,fc.Ra,fc.Af),X=[];if(Y.Vc||Y.ya||Y.cd)X.au_wind_bending_amp=[Y.Wc],X.au_wind_bending_freq=[Y.ue],X.au_detail_bending_freq=[Y.Nd],X.au_detail_bending_amp=[Y.Md],X.au_branch_bending_amp=[Y.Kd];var ia=Q.Cw(ad,X,I),$b=ia,fa=I;$b.A.au_center_pos=new Float32Array(3*$b.C);for(var oc=fa.length,Bc=$b.C/oc,ic=0;ic<
oc;ic++)for(var Sc=fa[ic],Ba=3*Bc*ic,Ib=0;Ib<Bc;Ib++)$b.A.au_center_pos[Ba+3*Ib]=Sc[0],$b.A.au_center_pos[Ba+3*Ib+1]=Sc[1],$b.A.au_center_pos[Ba+3*Ib+2]=Sc[2];ia=$b;if(Y.ti){var rb=ia,za=a.d.H;rb.A.a_emitter_center=new Float32Array(3*rb.C);var fb=pa.fromValues(0,0,0,1);pa.transformMat4(fb,za,fb);for(var $=0;$<rb.C;$++)rb.A.a_emitter_center[3*$]=fb[0],rb.A.a_emitter_center[3*$+1]=fb[1],rb.A.a_emitter_center[3*$+2]=fb[2];ia=rb}var Qa=m.b4w_vcol_from_name,mb=m.b4w_vcol_to_name,ta=fc,qa=c,vb=!s,xa=da,
gb=[];if(""!==Qa&&""!==mb){var ra,bb=mb,Da=ta.Ra,nb=[],Jb=void 0;for(Jb in Da)for(var Cc=Da[Jb].src,Vb=0,ac=0;ac<Cc.length;ac++){var pc=Cc[ac].jc;bb==Cc[ac].name&&nb.push(Jb,pc,Vb);Vb+=J.vf(pc)}ra=nb;if(0<ra.length)for(var wb=0;wb<ra.length;wb+=3)gb.push({ih:Qa,Li:7,qj:ra[wb],rj:ra[wb+1],Ji:ra[wb+2]});else Q.ew(ta.fd,"a_color")&&mb==xa.active_vcol_name&&gb.push({ih:Qa,Li:7,qj:"a_color",rj:7,Ji:0})}vb&&("a_bending_col_main"in qa.Ra&&gb.push({ih:"a_bending_col_main",Li:4,qj:"a_bending_col_main",rj:4,
Ji:0}),"a_bending_col_detail"in qa.Ra&&gb.push({ih:"a_bending_col_detail",Li:7,qj:"a_bending_col_detail",rj:7,Ji:0}));for(var Mb=ia,Wb=I,Sb=d,hb=gb,Xb=fc.Ra,jc=!1,Xa=0;Xa<hb.length;Xa++){var bc=hb[Xa].ih,Kb=Sb.A[bc];if(Kb&&0<Kb.length){jc=!0;break}}if(jc){var gc,va=a.d.Db,Oa=Sb.r[0].a_position,R=Wb,N=G,wa=new Float32Array(3),oa=new Float32Array(3),Ua=new Uint32Array(R.length);if(!("verts_indices"in N)){N.ed=new Float32Array(3);N.bd=new Float32Array(3);N.Am=new Uint32Array(Oa.length/3);N.Bh=new Uint32Array(Oa.length/
3);N.ed[0]=(va.max_x-va.min_x)/20;N.ed[1]=(va.max_y-va.min_y)/20;N.ed[2]=(va.max_z-va.min_z)/20;N.bd[0]=va.min_x;N.bd[1]=va.min_y;N.bd[2]=va.min_z;for(var ka=0;ka<Oa.length/3;ka++){var na=J.trunc((Oa[3*ka]-N.bd[0])/N.ed[0]),Cb=J.trunc((Oa[3*ka+1]-N.bd[1])/N.ed[1]),Ca=J.trunc((Oa[3*ka+2]-N.bd[2])/N.ed[2]),na=J.clamp(na,0,19),Cb=J.clamp(Cb,0,19),Ca=J.clamp(Ca,0,19);N.Am[ka]=ka;N.Bh[ka]=Ca*Math.pow(20,2)+20*Cb+na}Q.$x(N.Bh,N.Am,!0);N.Cf=new Uint32Array(Math.pow(20,3));for(ka=0;ka<N.Bh.length;ka++)N.Cf[N.Bh[ka]]++;
delete N.Bh;for(ka=1;ka<N.Cf.length;ka++)N.Cf[ka]+=N.Cf[ka-1]}for(var cb=0;cb<R.length;cb++){wa[0]=R[cb][0];wa[1]=R[cb][1];wa[2]=R[cb][2];for(var Pa=1E10,db=-1,$a=J.trunc((wa[0]-N.bd[0])/N.ed[0]),Ga=J.trunc((wa[1]-N.bd[1])/N.ed[1]),Ra=J.trunc((wa[2]-N.bd[2])/N.ed[2]),$a=J.clamp($a,0,19),Ga=J.clamp(Ga,0,19),Ra=J.clamp(Ra,0,19),ib=Ra*Math.pow(20,2)+20*Ga+$a,Xc=N.Cf[ib],Dc=0==ib?0:N.Cf[ib-1];Dc<Xc;Dc++){var dd=N.Am[Dc];oa[0]=Oa[3*dd];oa[1]=Oa[3*dd+1];oa[2]=Oa[3*dd+2];ha.sub(oa,wa,oa);var vc=ha.sqrLen(oa);
vc<=Pa&&(Pa=vc,db=dd)}if(-1==db)for(Dc=0;Dc<Oa.length/3;Dc++)oa[0]=Oa[3*Dc],oa[1]=Oa[3*Dc+1],oa[2]=Oa[3*Dc+2],ha.sub(oa,wa,oa),vc=ha.sqrLen(oa),vc<=Pa&&(Pa=vc,db=Dc);Ua[cb]=db}gc=Ua;for(var Tc=Mb.C/Wb.length,Xa=0;Xa<hb.length;Xa++){var xb=hb[Xa].qj,qc=hb[Xa].rj,bc=hb[Xa].ih,Va=hb[Xa].Li,Kb=Sb.A[bc];switch(xb){case "a_bending_col_main":var Ec=1;break;case "a_bending_col_detail":Ec=3;break;case "a_color":Ec=3;break;default:for(var kc=Ec=0;kc<Xb[xb].src.length;kc++)Ec+=J.vf(Xb[xb].src[kc].jc)}if(Kb&&
0<Kb.length){var eb=J.vf(Va),Ya=J.vf(qc),rc=Va&qc,wc=J.oq(rc);rc!=qc&&V.error("Wrong color extraction from "+bc+" to "+xb+".");if("a_bending_col_main"==xb||"a_bending_col_detail"==xb)Mb.A[xb]=new Float32Array(Mb.C*Ya);for(kc=0;kc<Wb.length;kc++){var yb=gc[kc],Yb=yb*eb,Db=kc*Tc*Ec;if(-1!=yb)for(var cc=0;cc<Tc;cc++)for(var Hc=cc*Ec,Eb=0;Eb<wc.length;Eb++)wc[Eb]&&(Mb.A[xb][Db+Hc+(hb[Xa].Ji+J.Rh(qc,Eb))]=Kb[Yb+J.Rh(Va,Eb)])}}else Mb.A[xb]=new Float32Array(0)}}ia=Mb;u.push({k:fc,$b:ia,Sb:[W.name],Gb:Y,
vc:[a]})}}}}return u}function I(a){return C.Of(a.e,a.scale,a.quat)}function v(a,b){for(var c=null,d=null,e=null,g=0;g<a.D.length;g++){var f=a.D[g].kj;f&&(c||(c={}),c[g]=f,a.D[g].kj=null);if(f=a.D[g].dd)d||(d={}),d[g]=f,a.D[g].dd=null;if(f=a.D[g].wa)e||(e={}),e[g]=f,a.D[g].wa=null}a.id=0;a.Sl=b;a.id=J.Xg(a,b);if(c)for(g in c)a.D[g].kj=c[g];if(d)for(var m in d)a.D[m].dd=d[m];if(e)for(m in e)a.D[m].wa=e[m]}function K(a,b,c,d,e){var g=h("WIREFRAME");m(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=
0;g.Lk=!0;g.N=!0;g.nf=c;e&&(g.ao=!0);y(g,b);v(g,J.Xg(b,0));d?(b=W.Do(1,a.t),Q.ux(b,[a.Be[0],a.Ce[1],a.De[2]],a.t)):b=W.Do(a.ma,a.t);Q.lm(b,1,!0);b.A.a_polyindex=Q.ro(b);u(g,b);return g}function m(a,b,c){a.Xa={bi:b,kh:c,Od:[]};fa.Dx(a.Xa)}function H(a,b,c){1==a.D.length&&0==a.ac.length&&a.ac.push("default0");c=c||"default"+String(a.D.length);-1==a.ac.indexOf(c)&&(a.D.push(b),a.ac.push(c))}function D(a){if(!a.Xa)throw"No shaders info for batch "+a.name;a.Yb=fa.Ev(a.Xa,a.Gl);L.ot(a.Yb);L.dn(a)}function U(a,
b,c){var d=a.Xa;fa.J(d,"SHADOW_SRC",b);fa.J(d,"SHADOW_DST",c);return a}var P=p("__boundings"),Z=p("__config"),V=p("__print"),M=p("__extensions"),Q=p("__geometry"),T=p("__graph"),X=p("__nodemat"),z=p("__objects"),ia=p("__particles"),W=p("__primitives");p("__reformer");var L=p("__renderer"),G=p("__scenegraph");p("__scenes");var fa=p("__shaders"),da=p("__textures"),C=p("__tsr"),J=p("__util"),ha=p("vec3"),pa=p("vec4"),la=p("quat"),Y=Z.n,ja=["MAIN","NODES"];a.OA=h;a.rv=function(a,b,d,e,k){for(var q=[],
l=[],n=0;n<d.length;n++){var C=d[n];switch(C.d.type){case "DYNAMIC":q.push(C);break;case "STATIC":l.push(C)}}d=[];d=d.concat(c(q,a,k));b=d.concat(f(l,a,b,k));n=[];C=[];k={};for(d=0;d<b.length;d++){var l=b[d].k,r=b[d].Gb,q=null;if(l.id in k){var t=k[l.id],s=C[t].k,w=C[t].Gb,D=null,v=null;for(a=0;a<l.D.length;a++){var B=l.D[a].dd;B&&(D||(D={}),D[a]=B,l.D[a].dd=null);if(B=l.D[a].wa)v||(v={}),v[a]=B,l.D[a].wa=null}J.Rq(l,s)&&J.Rq(r,w)&&(q=C[t]);if(D)for(a in D)l.D[a].dd=D[a];if(v)for(a in v)l.D[a].wa=
v[a];if(!q){do l.id++;while(k[l.id])}}q||(q={k:l,Gb:b[d].Gb,vc:[],Tq:[],Sb:[]},k[l.id]=C.length,C.push(q));q.vc=q.vc.concat(b[d].vc);b[d].$b&&b[d].$b.C&&q.Tq.push(b[d].$b);if(q.Sb.length)for(a=0;a<b[d].Sb.length;a++)l=b[d].Sb[a],-1==q.Sb.indexOf(l)&&q.Sb.push(l);else q.Sb=b[d].Sb}for(d=0;d<C.length;d++){b=C[d].Tq;if(0==b.length)a=J.mb(J.Lj("%empty"));else if(1==b.length)a=b[0];else{k=[];for(a=0;a<b.length;a++)Q.uw(b[a])||k.push(a);if(k.length<b.length)for(a=0;a<k.length;a++)Q.lm(b[k[a]]);a=Q.py(b)}n.push({k:C[d].k,
Gb:C[d].Gb,$b:a,Sb:C[d].Sb,vc:C[d].vc})}d=n;for(n=0;n<d.length;n++)u(d[n].k,d[n].$b),d[n].k.tc=d[n].Sb;a=[];for(n=0;n<d.length;n++)if(b=d[n].k,"STATIC"==d[n].Gb.type)C=J.fp(J.Lj("%meta")),C.d=d[n].Gb,C.P=[b],a.push(C);else for(k=[],q=0;q<d[n].vc.length;q++)if(C=d[n].vc[q],-1==k.indexOf(C.name)){for(l=0;l<C.P.length;l++)if(C.P[l]==b)throw"Batch already exist in object";C.P.push(b);k.push(C.name)}if(Y.wireframe_debug){for(n=0;n<d.length;n++)b=d[n].Gb,"DYNAMIC"==b.type&&(C=d[n].vc[0],-1<ja.indexOf(d[n].k.type)&&
(b=K(b.Ee,b,C.name,!0,!0),C.P.push(b)));for(n=0;n<a.length;n++)C=a[n],b=C.d,-1<ja.indexOf(C.P[0].type)&&(b=K(b.rc,b,C.name,!1),C.P.push(b))}C=null;if(e.texture_slots)for(n=0;n<e.texture_slots.length;n++)if(e.texture_slots[n].texture.b4w_use_as_skydome){C=x(e.texture_slots[n],null);break}if(e.b4w_sky_settings.procedural_skydome||C)b=h("MAIN"),m(b,"special_skydome.glslv","special_skydome.glslf"),e.b4w_sky_settings.procedural_skydome?b.fq=!0:H(b,C,"u_sky"),e.b4w_sky_settings.reflexible&&(b.Wb=!0,e.b4w_sky_settings.reflexible_only&&
(b.Mb=!0)),g(b,"a_position"),b.of=99999,e=W.qv(),u(b,e),C=J.fp(J.Lj("%meta")),C.d=z.Fi("DYNAMIC"),C.d.Qf=!0,C.d.Db=P.Xc(),C.d.rc=P.hi(),C.d.Ia=P.Xc(),C.d.kb=P.hi(),C.P=[b],a.push(C);return a};a.iz=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.qt=l;a.Bv=x;a.ik=function(a,b){A(a,"CSM_SECTION0",0);A(a,"CSM_SECTION1",0);A(a,"CSM_SECTION2",0);A(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)A(a,
"CSM_SECTION"+String(c),1);A(a,"SHADOW_TEX_RES",fa.u(b.csm_resolution));A(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);A(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.U=A;a.fb=function(a,b){return fa.Kv(a.Xa,b)};a.pi=H;a.ox=function(a,b,c){c=a.ac.indexOf(c);-1<c&&(a.D[c]=b)};a.nu=function(a,b){var c=h("MAIN");c.qa=!0;pa.set(b[0],b[1],b[2],.5,c.ob);c.ld=Q.ii;u(c,a);m(c,"main.glslv","main.glslf");A(c,"SHADELESS",1);D(c);return c};a.sb=D;a.Et=function(a){return a.Yb.Hh.length?
a.Yb.Nl.u_cube_fog?!0:!1:!1};a.ou=function(a,b){var c=h("DEPTH");c.ka=a.ka;c.Qc.set(a.Qc);c.ya=a.ya;c.bb=a.bb;c.id=a.id;c.Sl=a.Sl;a.D.length&&(c.D[0]=a.D[0],c.ac[0]=a.ac[0]);c.fd=a.fd;c.Zi=a.Zi;c.$i=a.$i;c.Ri=a.Ri;c.num_triangles=a.num_triangles;c.num_vertices=a.num_vertices;c.nf=a.nf;for(var d=0;d<a.tc.length;d++)c.tc.push(a.tc[d]);c.Jc=a.Jc;a.vb||(a.vb=[]);a.vb.push(c);m(c,"depth.glslv","depth.glslf");fa.kw(c.Xa,a.Xa);return U(c,"SHADOW_SRC_NONE",b)};a.tm=U;a.bu=function(){var a=h("DEPTH_PACK");
a.ka=!0;a.N=!1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");D(a);return a};a.Vn=function(a){var b=h("POSTPROCESSING");m(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":A(b,"POST_EFFECT","POST_EFFECT_NONE");b.p[0]=1;b.p[1]=1;break;case "GRAYSCALE":A(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.p[0]=1;b.p[1]=1;break;case "X_BLUR":A(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.p[0]=1;b.p[1]=0;break;case "Y_BLUR":A(b,
"POST_EFFECT","POST_EFFECT_Y_BLUR");b.p[0]=0;b.p[1]=1;break;case "X_EXTEND":A(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.p[0]=1;b.p[1]=0;break;case "Y_EXTEND":A(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.p[0]=0;b.p[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.ka=!0;b.N=!1;a=W.Da();u(b,a);D(b);return b};a.aA=function(){var a=h("EDGE");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");D(a);return a};a.su=function(a){var b=
h("SSAO");b.N=!1;b.ka=!0;b.p[0]=1;b.p[1]=1;var c=W.Da();u(b,c);m(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");A(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Mq);A(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:da.uv(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=x(a,c);H(b,a,
"u_ssao_special_tex");D(b);return b};a.tu=function(a){var b=h("SSAO_BLUR");b.N=!1;b.ka=!0;b.p[0]=1;b.p[1]=1;var c=W.Da();u(b,c);m(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");A(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);D(b);return b};a.cu=function(){var a=h("DOF");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");A(a,"DEPTH_RGBA",1);D(a);return a};a.du=function(){var a=h("GLOW");a.N=!1;a.ka=!0;a.p[0]=
1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");D(a);return a};a.eu=function(a,b,c){var d=h("GOD_RAYS");d.N=!1;d.ka=!0;d.p[0]=1;d.p[1]=1;var e=W.Da();u(d,e);m(d,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");A(d,"DEPTH_RGBA",a);A(d,"WATER_EFFECTS",b);A(d,"STEPS_PER_PASS",fa.u(c,1));D(d);return d};a.fu=function(){var a=h("GOD_RAYS_COM");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv",
"postprocessing/god_rays_combine.glslf");D(a);return a};a.pu=function(){var a=h("SKY");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.mv();u(a,b);m(a,"procedural_skydome.glslv","procedural_skydome.glslf");A(a,"NUM_LIGHTS",1);A(a,"WATER_EFFECTS",1);D(a);return a};a.Wt=function(){var a=h("ANTIALIASING");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;a.Cg=1/Y.resolution_factor;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");A(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");D(a);
return a};a.qu=function(a){var b=h("SMAA"),c=W.Da();u(b,c);m(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");A(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");A(b,"SMAA_PASS",a);A(b,"SMAA_PREDICATION",0);A(b,"SMAA_REPROJECTION",0);D(b);b.N=!1;b.ka=!0;b.p[0]=1;b.p[1]=1;b.Cg=1/Y.resolution_factor;return b};a.gu=function(a){var b=h("LANCZOS");b.N=!1;b.ka=!0;b.Cg=1/Y.resolution_factor;"LANCZOS_X"==a?(b.p[0]=1,b.p[1]=0):"LANCZOS_Y"==a&&(b.p[0]=0,b.p[1]=1);a=W.Da();u(b,a);m(b,"postprocessing/postprocessing.glslv",
"postprocessing/lanczos.glslf");D(b);return b};a.$t=function(){var a=h("COMPOSITING");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");D(a);return a};a.ju=function(a){var b=h("MOTION_BLUR");b.ka=!0;b.N=!1;var c=W.Da();u(b,c);m(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");A(b,"BLUR_DECAY_THRESHOLD",fa.u(a));D(b);return b};a.Vt=function(){var a=h("ANAGLYPH");a.ka=!0;a.N=!1;var b=W.Da();u(a,
b);m(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");D(a);return a};a.hu=function(){var a=h("LUMINANCE");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");D(a);return a};a.Xt=function(){var a=h("LUMINANCE");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");D(a);return a};a.iu=function(){var a=h("LUMINANCE_X_BLUR");
a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");D(a);return a};a.Yt=function(a){var b=h("POSTPROCESSING");switch(a){case "X_BLUR":b.p[0]=1;b.p[1]=0;break;case "Y_BLUR":b.p[0]=0;b.p[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.ka=!0;b.N=!1;a=W.Da();u(b,a);m(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");D(b);return b};a.Zt=function(){var a=h("BLOOM");
a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");D(a);return a};a.wu=function(){var a=h("VELOCITY");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=W.Da();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");D(a);return a};a.Vh=function(a,b,c){var d=a.Cg;a.om[0]=b*a.p[0]*d;a.om[1]=c*a.p[1]*d};a.xf=function(a,b){a.Cg=b};a.S=function(a,b,c){a=a.P;for(var d=null,e=0;e<a.length;e++){var g=a[e];if(-1<
g.tc.indexOf(b)&&(c&&g.type==c||!c)){if(g.vb)return g;d=null===d?g:d}}return d};a.Nt=function(a){for(var b=a.D,c=0;c<b.length;c++)da.Iu(b[c].Ha);Q.In(a.bb)}};
b4w.module.__nodemat=function(a,p){function h(a,g,f){if(g in da)return da[g];for(var m=T.create(),h=a.nodes,k=a.links,q=a.animation_data,C=0;C<h.length;C++)if(!w(m,h[C],0,q))return da[g]=null;if(f&&-1==t(a,m,"GROUP_OUTPUT","group"))return null;C=H(m);if(!D(m,k,C))return null;if(f)return m;for(C=0;C<k.length;C++){f=k[C];for(var h=l(f.from_node,m),q=l(f.to_node,m),J=0;J<h.length;J++)for(var u=0;u<q.length;u++){for(var s=h[J],v=q[u],B=T.Ea(m,s),x=T.Ea(m,v),A=m,ha=x,x=[],U=f.from_socket.identifier,y=
f.to_socket.identifier,P=B.Pa,B=0;B<P.length;B++)if(P[B].identifier==U){x.push(B);break}ha=ha.B;for(B=0;B<ha.length;B++)if(ha[B].identifier==y){x.push(B);break}2==x.length&&T.Ae(A,s,v,x)}}b(m);a=t(a,m,"OUTPUT","material");if(-1==a)return da[g]=null;e(m);m=T.my(m,a,T.vr);c(m);d(m);r(m);n(m);return da[g]=m}function c(a){T.L(a,function(b,c){for(var d=c.B,e=c.Pa,g=0;g<d.length;g++)f(a,d[g],b,g,1);for(g=0;g<e.length;g++)f(a,e[g],b,g,0)})}function f(a,b,c,d,e){if(b.td){var g=!0;T.oe(a,function(a,b,f){if(!e&&
a==c&&f[0]==d||e&&b==c&&f[1]==d)g=!1});g&&(b.td=!1)}}function b(a){var b=[];T.L(a,function(c,d){switch(d.type){case "TRANSLUCENCY":T.oe(a,function(a,e,g){a==c&&"Translucency"==d.Pa[g[0]].name&&b.push(a,e,[g[0]+1,g[1]+1])})}});for(var c=0;c<b.length;c+=3)T.Ae(a,b[c],b[c+1],b[c+2])}function l(a,b){var c=[];T.L(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function e(a){var b=[];T.L(a,function(a,c){"PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=
0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("PARALLAX"==e.type){var g=k(a,d);if(-1!=g){var f=T.Ni(a,g,0);T.kg(a,g,d,-1);-1!=f&&T.kg(a,f,g,-1);d=T.Ea(a,g);e.data=d.data;e.va[0]=d.va[0];T.lg(a,g)}e.B.splice(1,1)}else if("REROUTE"==e.type){for(var e=T.Ni(a,d,0),m=T.ig(a,d),g=[],f=[],h=[],q=0;q<m;q++){var l=T.Yf(a,d,q),n=f.indexOf(l);-1!=n?h[n]+=1:(f.push(l),h.push(1),g.push(d,l))}if(-1!=e)for(m=T.Xf(a,e,d,0)[0],q=0;q<f.length;q++)for(l=0;l<h[q];l++)n=T.Xf(a,d,f[q],l)[1],T.Ae(a,e,f[q],[m,n]);for(q=0;q<
g.length;q+=2)T.kg(a,g[q],g[q+1],-1)}}}function k(a,b){for(var c=a.sa,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function d(a){var b=[];T.L(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],f=!0,m=0;m<c.length;m++){var h=c[m];if(x(g,h.pa)){f=[];m=T.ig(a,e);for(l=0;l<m;l++){var k=T.Yf(a,e,l),q=T.Xf(a,
e,k,0);f.push(e,k,q);T.Ae(a,h.id,k,q)}for(var l=0;l<f.length;l+=3)T.kg(a,f[l],f[l+1],0);T.lg(a,e);f=!1;break}}f&&(h={id:e,pa:g},c.push(h))}}function r(a){var b=[];T.L(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],f=!0,m=0;m<c.length;m++){var h=c[m];if(!(3<=h.gj.length)&&x(g,h.pa)){for(var m=[],k=T.ep(a,e),f={},q=0;q<k;q++){var l=T.Ni(a,e,q);l in f||(f[l]=0);var n=T.Xf(a,l,e,f[l]++);m.push(l,e,n)}for(var k=
[],f=T.ig(a,e),C={},q=0;q<f;q++)l=T.Yf(a,e,q),l in C||(C[l]=0),n=T.Xf(a,e,l,C[l]++),k.push(e,l,n);f=m.concat(k);for(q=0;q<f.length;q+=3)T.kg(a,f[q],f[q+1],0);T.lg(a,e);q={pa:g,Pu:m,Qu:k};h.gj.push(q);f=!1;break}}f&&(h={id:e,pa:g,gj:[]},c.push(h))}for(d=0;d<c.length;d++){h=c[d];e=h.gj.length;k=h.pa.B.length;f=h.pa.Pa.length;for(m=0;m<e;m++){n=h.gj[m];q=n.pa;g=n.Pu;C=n.Qu;h.pa.B=h.pa.B.concat(q.B);h.pa.Pa=h.pa.Pa.concat(q.Pa);for(q=0;q<h.pa.B.length;q++)h.pa.B[q].identifier+=z.trunc(q/k)+1;for(q=0;q<
h.pa.Pa.length;q++)h.pa.Pa[q].identifier+=z.trunc(q/f)+1;for(q=0;q<g.length;q+=3)l=g[q],n=g[q+2],n[1]+=(m+1)*k,T.Ae(a,l,h.id,n);for(q=0;q<C.length;q+=3)l=C[q+1],n=C[q+2],n[0]+=(m+1)*f,T.Ae(a,h.id,l,n)}switch(e){case 1:h.pa.type+="2";break;case 2:h.pa.type+="3";break;case 3:h.pa.type+="4"}T.lg(a,h.id);T.hk(a,h.id,h.pa)}}function x(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;
case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function n(a){var b=[];T.L(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],g=!1,f=[],m=[],h=[[],[],[]],k=T.ig(a,d),q=0;q<k;q++){var l=T.Yf(a,d,q);if("SEPRGB"!=T.Ea(a,l).type){g=!1;break}f.push(d,l);for(var n={},C=T.ig(a,l),g=0;g<C;g++){var J=T.Yf(a,l,g);J in n||(n[J]=0);var r=T.Xf(a,l,J,n[J]++);f.push(l,J);h[r[0]].push(d,J,r)}m.push(l);g=!0}if(g){for(q=
d=k=0;q<h.length;q++)h[q].length&&(k++,d|=1<<2-q);if(k){e.type+=k;e.Pa=[];for(q=0;q<h.length;q++)if(h[q].length)for(e.Pa.push({nb:0,identifier:"RGB"[q],td:!0,name:"RGB"[q]}),g=0;g<h[q].length;g+=3)h[q][g+2][0]=z.Rh(d,q);for(q=0;q<f.length;q+=2)T.kg(a,f[q],f[q+1],0);for(q=0;q<m.length;q++)T.lg(a,m[q]);for(q=0;q<h.length;q++)for(g=0;g<h[q].length;g+=3)T.Ae(a,h[q][g],h[q][g+1],h[q][g+2])}}}}function t(a,b,c,d){a=a.nodes;for(var e=null,g=0;g<a.length;g++){var f=a[g];f.type==c&&(e=f)}return e?l(e,b)[0]:
(Q.error('No "'+c+'" node in node '+d),-1)}function w(a,b,c,d){var e=b.name,f=b.type,k=[],l=[],n=[],r=[],t=null;switch(f){case "CAMERA":l=[];n=I(b);break;case "COMBRGB":case "COMBHSV":l=S(b);n=I(b);break;case "GEOMETRY":a:{for(var f=b.outputs,D=0;D<f.length;D++)if(f[D].is_linked){f=!0;break a}f=!1}if(!f)return!0;f=s(b,c);if(!f)return Q.error("Geometry output is not supported"),!1;switch(f){case "GEOMETRY_UV":if(!b.uv_layer)return Q.error('Missing uv layer in node "',b.name,'"'),!1;t=q("param_GEOMETRY_UV_a");
D=q("param_GEOMETRY_UV_v");k.push(v(t));k.push(v(D));n.push(g(b,"UV"));r.push(v(D));t={name:t,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return Q.error("Missing vertex color layer in node ",b.name),!1;t=q("param_GEOMETRY_VC_a");D=q("param_GEOMETRY_VC_v");k.push(v(t));k.push(v(D));n.push(g(b,"Vertex Color"));r.push(v(D));t={name:t,value:b.color_layer};break;case "GEOMETRY_NO":n.push(g(b,"Normal"));break;case "GEOMETRY_FB":n.push(g(b,"Front/Back"));break;case "GEOMETRY_VW":n.push(g(b,
"View"));break;case "GEOMETRY_GL":n.push(g(b,"Global"))}break;case "GROUP":D=b.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(D){case "LINEAR_TO_SRGB":f="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":case "VECTOR_VIEW":f="VECTOR_VIEW";break;case "SRGB_TO_LINEAR":f="SRGB_TO_LINEAR";break;case "REFLECT":f="REFLECT";break;case "REFRACTION":f="REFRACTION";break;case "PARALLAX":f="PARALLAX";if(!b.inputs[1].is_linked)return Q.error('Missing texture in node "',b.name,'"'),!1;var H=q("temp_texture");r.push(v(H));
break;case "CLAMP":f="CLAMP";break;case "TRANSLUCENCY":f="TRANSLUCENCY";break;case "TIME":f="TIME";break;case "SMOOTHSTEP":f="SMOOTHSTEP";break;default:n=b.node_group.node_tree;l={};for(H in n)if("links"==H||"nodes"==H)for(l[H]=[],t=0;t<n[H].length;t++){l[H][t]={};for(var x in n[H][t])if("links"==H){l[H][t][x]={};for(var A in n[H][t][x])l[H][t][x][A]=B(n[H][t][x][A])}else l[H][t][x]=B(n[H][t][x])}else l[H]=B(n[H]);if("REPLACE"==D||"LEVELS_OF_QUALITY"==D)n={name:"Group input",type:"GROUP_INPUT",inputs:[],
outputs:b.inputs},t={name:"Group output",type:"GROUP_OUTPUT",inputs:b.outputs,outputs:[]},H="REPLACE"==D||"LEVELS_OF_QUALITY"==D&&(ha.quality==ia.P_LOW||ha.Vk)?{from_node:n,from_socket:n.outputs[1],to_node:t,to_socket:t.inputs[0]}:{from_node:n,from_socket:n.outputs[0],to_node:t,to_socket:t.inputs[0]},l.nodes=[n,t],l.links=[H];n=b.name;t=l.nodes;H=l.links;for(x=0;x<t.length;x++)t[x].name=m(t[x].type,n,t[x].name);for(x=0;x<H.length;x++)H[x].from_node.name=m(H[x].from_node.type,n,H[x].from_node.name),
H[x].to_node.name=m(H[x].to_node.type,n,H[x].to_node.name);t={Nw:h(l,b.node_group.uuid,!0),Ow:l.links}}l=S(b);n=I(b);"TRANSLUCENCY"==D&&(D=u("TranslucencyParams","TranslucencyParams",[0,0,0,0]),D.td=n[0].td,n.push(D));break;case "LAMP":t=b.lamp;if(!t)return Q.error("There is no lamp in node: "+b.name),!1;n.push(g(b,"Color"));n.push(g(b,"Light Vector"));n.push(g(b,"Distance"));n.push(g(b,"Visibility Factor"));t.uuid in C?r.push(v(q("param_LAMP_lamp_index"),C[t.uuid],1)):(C[t.uuid]=J,r.push(v(q("param_LAMP_lamp_index"),
J++,1)));t=C;break;case "NORMAL":l=S(b);n=I(b);D=g(b,"Normal");r.push(v(q("param_NORMAL_Normal"),D.nb,3));break;case "MAPPING":D=b.vector_type;l.push(y(b,"Vector"));n.push(g(b,"Vector"));if(0!=W.length(b.translation)||0!=W.length(b.rotation)||b.use_max||b.use_min){var f="MAPPING_HEAVY",U=b.rotation;A=b.scale;H=b.translation;x=L.create();U=z.Su(U);A=new Float32Array([A[0],0,0,0,A[1],0,0,0,A[2]]);L.multiply(U,A,x);x=z.Ew(x,G.create());switch(D){case "POINT":x[12]=H[0];x[13]=H[1];x[14]=H[2];break;case "TEXTURE":x[12]=
H[0];x[13]=H[1];x[14]=H[2];x=G.invert(x,x);break;case "NORMAL":G.invert(x,x),G.transpose(x,x)}r.push(v(q("param_MAPPING_HEAVY_trs_matrix"),x,16));r.push(v(q("param_MAPPING_HEAVY_use_min"),~~b.use_min,1));r.push(v(q("param_MAPPING_HEAVY_use_max"),~~b.use_max,1));r.push(v(q("param_MAPPING_HEAVY_min_clip"),b.min,3));r.push(v(q("param_MAPPING_HEAVY_max_clip"),b.max,3))}else f="MAPPING_LIGHT",r.push(v(q("param_MAPPING_LIGHT_scale"),b.scale,3));switch(D){case "TEXTURE":r.push(v(q("param_MAPPING_vector_type"),
0,1));break;case "POINT":r.push(v(q("param_MAPPING_vector_type"),1,1));break;case "VECTOR":r.push(v(q("param_MAPPING_vector_type"),2,1));break;case "NORMAL":r.push(v(q("param_MAPPING_vector_type"),3,1))}break;case "MATERIAL":case "MATERIAL_EXT":D=y(b,"Color");D.nb.splice(3);l.push(D);(D=y(b,"Alpha"))?l.push(D):l.push(u("Alpha","Alpha",1));D=y(b,"Spec");D.nb.splice(3);l.push(D);t=y(b,"Normal");t.nb.splice(3);l.push(t);n.push(g(b,"Color"));n.push(g(b,"Alpha"));n.push(g(b,"Normal"));"MATERIAL_EXT"==
f&&((D=y(b,"Emit"))?l.push(D):l.push(u("Emit","Emit",0)),D=y(b,"Translucency"),D.nb=0,D.name="Translucency",D.identifier="Translucency",D?l.push(D):l.push(u(D.name,D.identifier,D.nb)),D=y(b,"Translucency"),D.nb=[0,0,0,0],D.name="TranslucencyParams",D.identifier="TranslucencyParams",D?l.push(D):l.push(u(D.name,D.identifier,D.nb)),(D=y(b,"Ray Mirror"))?l.push(D):l.push(u("Ray Mirror","Ray Mirror",0)),(D=y(b,"SpecTra"))?l.push(D):l.push(u("SpecTra","SpecTra",0)),n.push(g(b,"Diffuse")),n.push(g(b,"Spec")));
H=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":D=b.specular_hardness;break;case "WARDISO":D=b.specular_slope;break;case "TOON":D=b.specular_toon_size;H=b.specular_toon_smooth;break;default:Q.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),D=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":A=x=0;break;case "OREN_NAYAR":x=b.roughness;A=0;break;case "FRESNEL":x=b.diffuse_fresnel;A=b.diffuse_fresnel_factor;break;default:Q.error("B4W Error: unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.material_name+'")'),A=x=0}r.push(v(q("param_MATERIAL_diffuse"),[b.use_diffuse?1:0,x,A],3));r.push(v(q("param_MATERIAL_spec"),[b.use_specular?1:0,b.specular_intensity,D,H],4));r.push(v(q("param_MATERIAL_norm"),t.td?1:0,1));t={name:b.name,value:{dy:b.specular_shader,Ju:b.diffuse_shader,zf:b.use_shadeless,rg:b.specular_alpha}};break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";
break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f=
"MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return Q.error("Unsupported MATH operation: "+b.operation),!1}l=S(b);n=I(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;
case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return Q.error("Unsupported MIX_RGB blend type: "+
b.blend_type),!1}l=S(b);n=I(b);break;case "OUTPUT":l=S(b);n=[];break;case "RGB":D=g(b,"Color");n.push(D);r.push(v(q("param_RGB_Color"),D.nb,3));break;case "SEPRGB":case "SEPHSV":l=S(b);n=I(b);break;case "TEXTURE":if(!b.texture)return Q.error("No texture attached to node: "+b.name),!1;a:{f=b.outputs;t=!1;for(D=0;D<f.length;D++)if(H=f[D],H.is_linked)switch(H.identifier){case "Color":f="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":f="TEXTURE_NORMAL";break a;
case "Value":t=!0;break;default:throw"Unknown texture output";}f=t?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}l.push(y(b,"Vector"));if("TEXTURE_COLOR"==f||"TEXTURE_ENVIRONMENT"==f)n.push(g(b,"Color")),n.push(g(b,"Value"));"TEXTURE_NORMAL"==f&&(n.push(g(b,"Normal")),n.push(g(b,"Value")));H=q("param_TEXTURE_texture");r.push(v(H));t={name:H,value:b.texture};break;case "VALUE":a:if(d){if(f=d.action){var P=f.d.va;for(D in P)if(P=D.match(/"(.*?)"/)[1],P==b.name){H=f.name+
"_"+D;break a}}H=d.nla_tracks;for(x=0;x<H.length;x++)for(A=H[x].strips,U=0;U<H[x].strips.length;U++)for(D in f=A[U].action,P=f.d.va,P)if(P=D.match(/"(.*?)"/)[1],P==b.name){H=f.name+"_"+D;break a}H=void 0}else H=null;D=g(b,"Value");H?(f="ANIM_VALUE",x={name:q("param_ANIM_VALUE_Value"),value:"0"},r.push(x),x={name:"-1",value:H},r.push(x)):(f="VALUE",r.push(v(q("param_value_value"),D.nb,1)));n.push(D);break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";
break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return Q.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=S(b);n=I(b);break;default:l=S(b),n=I(b)}e={name:e,type:f,ei:k,B:l,Pa:n,va:r,data:t};T.hk(a,T.Co(a),e);if(e="GEOMETRY"==b.type)a:{e=b.outputs;for(r=k=0;r<e.length;r++)if(e[r].is_linked&&k++>c){e=!0;break a}e=!1}return e&&!w(a,
b,++c,d)?!1:!0}function B(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?z.Zg(a):a}function q(a){fa[a]||(fa[a]=0);var b=a+fa[a],b=b.replace(/ /g,"_").replace(/\//g,"_");fa[a]++;return b}function s(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";
default:return null}}}function y(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function g(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function A(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=z.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,td:d,nb:a}}function u(a,b,c){return{name:a,identifier:b,td:!1,nb:c}}function S(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=A(a.inputs[c]);
d.nb.length&&d.nb.splice(3);b.push(d)}return b}function I(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=A(a.outputs[c]);b.push(d)}return b}function v(a,b,c){b=null===b||void 0===b?null:X.u(b,c);if(ha.Yl&&b){c="param_MAPPING_HEAVY_trs_matrix param_MAPPING_HEAVY_min_clip param_MAPPING_HEAVY_max_clip param_MAPPING_HEAVY_use_min param_MAPPING_HEAVY_use_max param_MAPPING_LIGHT_min_clip param_MAPPING_LIGHT_max_clip param_MAPPING_LIGHT_scale param_MAPPING_vector_type".split(" ");for(var d=!1,e=0;e<c.length;e++)if(0<=
a.indexOf(c[e])){d=!0;break}d&&(b=K(b))}return{name:a,value:b}}function K(a){a=a.replace(/(,)/g,"$1 ");a=a.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3");a=a.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3");return a.replace(/\s+/g,"")}function m(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function H(a){var b=[];T.L(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function D(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Nw,
g=c[d].data.Ow;if(!e)return!1;T.L(e,function(b,c){T.hk(a,T.Co(a),c)});for(e=0;e<g.length;e++)b.push(g[e]);M(c[d],b,a)}return!0}function U(a,b,c,d,e,g){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||g.push(c)}}function P(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var g=c[e],f=null,m=0;m<b.length;m++)if(g.from_socket.identifier==b[m].to_socket.identifier){f=b[m];break}f?(g.from_node=f.from_node,
g.from_socket=f.from_socket):d.push(g)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function Z(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function V(a,b,c,d){for(var e=0;e<d.length;e++){for(var g=d[e],f,m=0;m<c.B.length;m++)if(g.from_socket.identifier==c.B[m].identifier){f=c.B[m].nb;break}for(var m=g,h=b,k=f,q=l(m.to_node,h),n=0;n<q.length;n++)for(var C=T.Ea(h,q[n]),J=0;J<C.B.length;J++)if(C.B[J].identifier==m.to_socket.identifier){C.B[J].nb=
k;break}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function M(a,b,c){for(var d=a.name,e=[],g=[],f=[],m=[],h=0;h<b.length;h++){var k=b[h];U(k.from_node,d,k,e,f,m);U(k.to_node,d,k,g,f,m)}g=P(b,g,f);e=P(b,m,e);Z(b,g);V(b,c,a,g);if(e.length){var q;T.L(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(q=b)});V(b,c,q,e)}}var Q=p("__print"),T=p("__graph"),X=p("__shaders"),z=p("__util"),ia=p("__config"),W=p("vec3");p("vec4");var L=p("mat3"),G=p("mat4"),fa={},da={},C={},J=0;new Float32Array(4);
var ha=ia.n;a.Ot=h;a.Pt=function(a){var b=[],c={};fa={};var d=T.Zq(a);T.L(d,function(a,d){var e;e=[];for(var g=[],f=[],m=[],h=[],k=[],l=0;l<d.B.length;l++){var n=d.B[l];if(n.td)e.push(null),g.push(null);else{e.push(q("in_"+d.type+"_"+n.identifier));var C=X.u(n.nb,0);ha.Yl&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==
n.identifier)&&(C=K(C));g.push(C)}}for(l=0;l<d.Pa.length;l++)n=d.Pa[l],n.td?f.push(null):f.push(q("out_"+d.type+"_"+n.identifier));for(l=0;l<d.va.length;l++)n=d.va[l],m.push(n.name),h.push(n.value);for(l=0;l<d.ei.length;l++)k.push(d.ei[l].name);e={id:d.type,B:e,hp:g,Pa:f,va:m,pj:h,ei:k};b.push(e);c[a]=e});T.oe(d,function(a,b,e){var g=T.Ea(d,a);T.Ea(d,b);var f=g.Pa[e[0]];a=c[a].Pa;b=c[b].B;g=a[e[0]]||q("out_"+g.type+"_"+f.identifier);a[e[0]]=g;b[e[1]]=g});return b};a.cleanup=function(){for(var a in da)delete da[a];
for(var b in C)delete C[b];J=0}};
b4w.module.__animation=function(a,p){function h(a,b){var c=a.w[b];c&&c.Sk&&c.jh&&(c.jh=!1,c.Sk(a))}function c(a,b,c){c=a.w[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.Rb=d;c.$c=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var g=a.data.b4w_vertex_anim[e];if(g==b)break;else d+=g.frame_end-g.frame_start+1}c.lr=d}function f(a,b,c){a=a.w[c];a.type=50;a.$c=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Jc=b}function b(a){return a.replace(/_B4W_BAKED$/,"")}function l(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:z.da("Wrong animation behavior")}}function e(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&b.push(d.action))}return b}function k(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function d(a,
b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function r(a,b,c){s(a,b,c);h(a,c);a.d.Hd&&(A(a,b),g(a,b))}function x(a,b,c){var d=b.frame_range,e=b.d,g=a.w[c];g.$c=b.name;g.Vm=d;g.Ss=e.Vw;g.Qs=e.st;g.start=d[0];g.length=d[1]-d[0];g.Rb=d[0];d=z.Te(e.wi);if(z.Ye(a)&&d){g.type=10;var f=n(a,b);f||(f=u(a,b,B(a)),a.Sg.push(b,f));g.e=f.e;g.ja=f.ja;var g=a.d,f=g.Dj,m=a.w[c],e=m.$l,h;a:{h=g.Bq;for(var k=0;k<h.length;k+=2)if(b==h[k]){h=h[k+1];break a}h=null}if(h)m.$l=h;else{for(m=0;m<f.length;m++)h=
u(a,b,f[m].gc),e.push(h);g.Bq.push(b,e)}g.Hd&&(b=g.Kj,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),t(a))}else if(Q.Yd(a)&&(e.va.volume||e.va.pitch))g.volume=e.va.volume||null,g.pitch=e.va.pitch||null,g.type=40;else if("MESH"==a.type&&q(b)){g.type=70;e=n(a,b);if(!e){e=[];m=[];h=b.d;k=a.d.zh;for(f in h.va)for(var l=b.name+"_"+f,C=0;C<k.length;C+=2)if(l==k[C]){e.push(k[C+1]);m.push(h.va[f]);break}e={$y:e,az:m};a.Sg.push(b,e)}g.Cp=e.$y;g.Dp=e.az}else if(f=e.va.tsr){g.type=20;e=n(a,b);if(!e){e=
b.d.Gp;m=[];h=[];for(k=0;k<e;k++)m.push(f.subarray(8*k,8*k+4)),h.push(f.subarray(8*k+4,8*k+8));e={e:m,ja:h};a.Sg.push(b,e)}g.e=e.e;g.ja=e.ja;P.ag(a)&&P.Uy(a,g.e,g.ja)}else V.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),g.type=60;z.Ye(a)&&!d&&w(a,c)}function n(a,b){for(var c=a.Sg,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function t(a){var b=a.d.Kj;if(-1!=b[0]&&-1!=b[1]){var c=a.w;a=c[b[1]].Rb;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Rb;
d=Math.floor(a);b.Rb=d+e}}function w(a,b){var c=a.d.Kj,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.w;0<=d;d--){var g=e[d];if(g&&10==g.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function B(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={sn:d,fh:d,Ol:z.el(a,"name",e),nr:-1}}return c}function q(a){a=a.d;for(var b in a.va)if(-1!=b.indexOf("nodes"))return!0;return!1}function s(a,b,c){if((c=a.w[c])&&(c.play||0==b)){var d=a.d,e=c.Rb,g=c.start,f=c.length,
e=e+c.speed*b*W.ua,m=c.type,h=c.speed;if(0<=h&&e>=g+f||0>h&&e<g)switch(c.jh=!0,c.behavior){case 10:e=0<=h?(e-g)%f+g:g+f-1E-6;break;case 20:e=0<=h?g:g+f-1E-6;c.play=!1;break;case 30:e=0<=h?g+f-1E-6:g,c.play=!1}c.Rb=e;switch(m){case 10:if(!d.Hd){e=y(c,e,L);b=e[0];g=e[1];e=e[2];d.Vb=c.ja[b];d.Ub=c.ja[g];d.dc=c.e[b];d.cc=c.e[g];d.Qe=e;d=d.Dj;c=c.$l;for(f=0;f<d.length;f++)m=d[f],h=c[f],m.Vb=h.ja[b],m.Ub=h.ja[g],m.dc=h.e[b],m.cc=h.e[g],m.Qe=e;T.v(a)}break;case 20:m=e=y(c,e,L);(d=G)||(d=new Float32Array(4));
var g=m[0],f=m[1],m=m[2],h=c.e,k=h[g][1],q=h[g][2],l=h[f][1],n=h[f][2];d[0]=(1-m)*h[g][0]+m*h[f][0];d[1]=(1-m)*k+m*l;d[2]=(1-m)*q+m*n;g=e;(f=da)||(f=new Float32Array(4));m=c.ja;ia.slerp(m[g[0]].subarray(0,4),m[g[1]].subarray(0,4),g[2],f);g=f;f=e[2];m=c.e;e=(1-f)*m[e[0]][3]+f*m[e[1]][3];c.qm&&(f=fa,T.get_translation(a,f),z.smooth_v(d,f,b,c.qm,d));c.Ql&&(f=C,T.get_rotation(a,f),z.Eq(g,f,b,c.Ql,g));T.set_translation(a,d);T.set_rotation(a,g);T.set_scale(a,e);T.v(a);Z.sync_transform(a);break;case 30:(a=
L)||(a=Array(3));g=e-c.start;0>g&&(g=0);g>=c.length&&(g=c.length);b=Math.floor(g);e=b+1;g-=b;10!=c.behavior&&e==c.length&&(e=b-=1,g=1);c=c.lr;a[0]=b+c;a[1]=e+c;a[2]=g;e=L;d.vm=e[0];d.kr=e[2];break;case 40:e=y(c,e,L);b=e[0];d=e[1];e=e[2];c.volume&&Q.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&Q.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:P.Lx(c.Jc,e/W.ua);break;case 70:e=y(c,e,L);b=e[0];d=e[1];e=e[2];g=c.Dp;c=c.Cp;for(f=0;f<c.length;f++)m=g[f],a.d.jf[c[f]]=(1-e)*m[b]+e*m[d];
break;case 60:break;default:throw"Unknown animation type:"+m;}}}function y(a,b,c){c||(c=Array(3));var d=a.Vm[0],e=a.Vm[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Ss;e=Math.floor(b);a=a.Qs[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function g(a,b){var c=a.d,d=c.Gd,e=c.Kj,g=e[0],e=e[1];if(-1!=e){if(-1!=g){var f=a.w[g];if(f.play||0==b)var m=y(f,f.Rb,L),h=m[0],k=m[1],m=m[2],q=f.ja[h],l=f.ja[k],h=f.e[h],k=f.e[k];else d=1}else d=1;e=a.w[e];if(e.play||0==b)var m=y(e,e.Rb,L),n=m[0],J=m[1],m=m[2];else if(-1!=g&&
f.play)d=0;else return;g=e.ja[n];f=e.ja[J];n=e.e[n];e=e.e[J];if(1==d)c.Vb.set(g),c.Ub.set(f),c.dc.set(n),c.cc.set(e);else if(0==d)c.Vb.set(q),c.Ub.set(l),c.dc.set(h),c.cc.set(k);else{for(J=0;J<q.length;J+=4){for(var r=da,t=C,D=0;4>D;D++)r[D]=q[J+D],t[D]=g[J+D];ia.slerp(r,t,d,r);for(D=0;4>D;D++)c.Vb[J+D]=r[D];for(D=0;4>D;D++)r[D]=l[J+D],t[D]=f[J+D];ia.slerp(r,t,d,r);for(D=0;4>D;D++)c.Ub[J+D]=r[D]}z.on(h,n,d,c.dc);z.on(k,e,d,c.cc)}d=c.Dj;q=c.yp;for(J=0;J<d.length;J++){l=d[J];h=q[J];for(k=0;k<h.length;k+=
2)for(n=h[k],g=h[k+1],f=0;4>f;f++)l.Vb[n+f]=c.Vb[g+f],l.Ub[n+f]=c.Ub[g+f],l.dc[n+f]=c.dc[g+f],l.cc[n+f]=c.cc[g+f];l.Qe=m}}}function A(a,b){var c=a.d,d=c.Gd,e=c.gk;if(0!=e){var d=c.fk-d,g=e*b;z.sign(d)==z.sign(e)&&Math.abs(g)<Math.abs(d)?c.Gd+=g:(c.Gd=c.fk,c.gk=0)}}function u(a,b,c){for(var d=a.pose.bones,e=[],g=[],f=b.d.Gp,m=0;m<f;m++){for(var h=0;h<d.length;h++){var k=d[h],q=X.create(),l=b.d.wi[k.name];l&&X.copy(l.subarray(8*m,8*m+8),q);k.Tm=q;k.mi=!1}h=S(a,c);e.push(h.e);g.push(h.ja)}return{e:e,
ja:g}}function S(a,b){var c=[],d=[],e=a.pose.bones,g=new Float32Array(4),f=new Float32Array(4),m;for(m in b){var h=b[m],k=h.fh,q=e[h.Ol],h=g,l=f,n=q.Is,C=n[n.length-1],r=C.ck;C.mi||X.identity(r);for(C=n.length-1;0<=C;C--){var q=n[C],D=q.ck;if(q.mi)r=D;else{var t=q.Um,u=q.Tm;X.invert(t,J);X.multiply(u,J,J);X.multiply(t,J,J);X.multiply(r,J,D);r=D;q.mi=!0}}q=q.ck;h[0]=q[0];h[1]=q[1];h[2]=q[2];h[3]=q[3];l[0]=q[4];l[1]=q[5];l[2]=q[6];l[3]=q[7];ia.normalize(l,l);for(h=0;4>h;h++)l=4*k+h,c[l]=g[h],d[l]=f[h]}c=
new Float32Array(c);d=new Float32Array(d);return{e:c,ja:d}}function I(a,b,c,d,e,g,f){var m=a+(b-a)/2,h=v(m,d,e,g,f)-c;return.02>Math.abs(h)?m:0<h?I(a,m,c,d,e,g,f):I(m,b,c,d,e,g,f)}function v(a,b,c,d,e){var g=1-a;return b*g*g*g+3*c*g*g*a+3*d*g*a*a+e*a*a*a}function K(a,b){a.w||(a.w=[null,null,null,null,null,null,null,null]);a.w[b]={type:null,$c:null,ja:null,e:null,$l:[],play:!1,behavior:20,Rb:0,start:0,length:0,qm:0,Ql:0,jh:!1,lr:null,speed:1,volume:null,pitch:null,Dp:[],Cp:[]};a.Sg=a.Sg||[];-1==ha.indexOf(a)&&
ha.push(a)}function m(a,b){T.v(a);Z.sync_transform(a);r(a,0,b)}function H(a,b,d){d=d||0;if(z.sc(a)){var e=z.keysearch("name",b,a.data.b4w_vertex_anim);if(e)return K(a,d),c(a,e,d),m(a,d),1;if((e=z.keysearch("name",b,a.particle_systems))&&"EMITTER"==e.settings.type)return K(a,d),f(a,e,d),m(a,d),1}if(e=z.keysearch("name",b,pa)||z.keysearch("name",b+"_B4W_BAKED",pa)){if(!z.Te(e.fcurves))return V.error('No fcurves in action "'+e.name+'"'),0;K(a,d);x(a,e,d);m(a,d);return 1}V.error('Unsupported object: "',
a.name,'" or animation name: "',b,'"');return 0}function D(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var U=p("__config"),P=p("__particles"),Z=p("__physics"),V=p("__print"),M=p("__scenes"),Q=p("__sfx"),T=p("__transform"),X=p("__tsr"),z=p("__util");p("mat4");var ia=p("quat");p("vec4");var W=U.Jd;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=
30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var L=Array(3),G=new Float32Array(3),fa=new Float32Array(3),da=new Float32Array(4),C=new Float32Array(4),J=new Float32Array(8);new Float32Array(16);var ha=[],pa=[];a.frame_to_sec=function(a){return a/W.ua};a.update=function(a){for(var b=
0;b<ha.length;b++){for(var c=ha[b],d=0;8>d;d++)s(c,a,d);c.d.Hd&&(A(c,a),g(c,a))}for(b=0;b<ha.length;b++)for(c=ha[b],d=0;8>d&&c.w;d++)h(c,d)};a.wv=function(){return pa};a.Iv=function(a,c){var d=a.w[c];return d&&d.$c?b(d.$c):null};a.get_anim_names=function(a){var c=[];if(z.sc(a)&&a.d.ci)for(var d=0;d<a.data.b4w_vertex_anim.length;d++)c.push(a.data.b4w_vertex_anim[d].name);var g,d=[];for(g=0;g<pa.length;g++){var f=pa[g],m=f.d;z.Te(f.d.wi)?"ARMATURE"==a.type&&d.push(f):m.va.volume||m.va.pitch?Q.Yd(a)&&
d.push(f):q(f)||d.push(f)}"MESH"==a.type&&(d=d.concat(e(a)));g=d;for(d=0;d<g.length;d++)c.push(b(g[d].name));if(P.ag(a)&&P.Ti(a))for(d=0;d<a.particle_systems.length;d++)c.push(a.particle_systems[d].name);return c};a.ly=b;a.get_anim_type=function(a,b){var c=a.w[b];return c?c.type:null};a.apply_def=function(a){var b=0,d;d=[];var g=a.animation_data;if(g&&g.action){var h=z.Te(g.action.d.wi);"ARMATURE"!=a.type&&h||d.push(g.action)}Q.Yd(a)&&a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);
"MESH"==a.type&&(d=d.concat(e(a)));for(g=0;g<d.length;g++)h=d[g],z.Te(h.fcurves)?(K(a,b),x(a,h,b),m(a,b),a.w[b].behavior=l(a.b4w_anim_behavior),b++):V.error('No fcurves in action "'+h.name+'"');h=a.particle_systems;for(g=0;g<h.length;g++){var k=h[g],q=k.settings;"EMITTER"==q.type&&(K(a,b),f(a,k,b),m(a,b),a.w[b].behavior=l(a.b4w_anim_behavior),q.b4w_cyclic&&(a.w[b].behavior=10),b++)}z.sc(a)&&a.d.ci?(K(a,b),c(a,a.data.b4w_vertex_anim[0],b),m(a,b),a.w[b].behavior=l(a.b4w_anim_behavior)):d.length||P.Ti(a)||
(K(a,0),d=a.w[0],d.type=60,d.$c=a.name+"_STATIC",g=M.Pv(M.get_active()),d.start=g[0],d.length=g[1]-g[0]+1,m(a,b))};a.get_first_armature_object=k;a.play=function(a,b,c){d(a.w,c,function(a){a.play=!0;a.Sk=b?b:null;a.jh=!1});a.d.Hd&&t(a)};a.stop=function(a,b){d(a.w,b,function(a){a.play=!1;a.Sk=null;a.jh=!1})};a.is_play=function(a,b){var c=a.w[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.w;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Rb=b,r(a,0,c))}else if(e=d[c])e.Rb=b,r(a,
0,c)};a.get_current_frame_float=function(a,b){var c=a.w[b];return c&&c.Rb?c.Rb:0};a.is_cyclic=function(a,b){var c=a.w[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){d(a.w,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.w[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,e){d(a.w,e,function(a){a.qm=b||0;a.Ql=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.w[c]=null;else a.w[b]=null;a.d.Hd&&w(a,b)};a.update_object_animation=r;a.Wi=
function(a){if("ARMATURE"==a.type||k(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||P.ag(a)&&P.Ti(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||D(a)?!0:!1};a.is_animated=function(a){return a.w?!0:!1};a.yt=B;a.vn=S;a.Us=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ia.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=
4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(g)){a=b;c=c.split('"')[1];var m=f}else-1<c.indexOf("location")?(c="tsr",m=f):-1<c.indexOf("rotation_quaternion")?(c="tsr",m=f):-1<c.indexOf("scale")?(c="tsr",m=f):m=0;if(!a[c]){b=a;var h=c;if("object"==typeof m&&m.length)for(var k=m.length,q=new Float32Array(e*k),l=0;l<e;l++)for(var n=0;n<k;n++)q[l*k+n]=m[n];else if("number"==typeof m)for(q=new Float32Array(e),l=0;l<e;l++)q[l]=m;else throw"Wrong storage default value";
b[h]=q}return a[c]}a.d={};var e=a.d;e.Vw=1/W.Re;var g=new RegExp(/pose.bones\[\".+\"\]/g),f=X.create(),m=a.fcurves,h={},k={},q=0,l;for(l in m){var n=m[l],C;for(C in n){var J=n[C].Pb;q||(q=J.length);for(var r=d(h,k,l,q),D=r.length/q,t=c(l,C|0),u=0;u<q;u++)r[u*D+t]=J[u]}}for(var s in h)"tsr"==s&&b(h[s],q);for(var w in k)b(k[w],q);e.va=h;e.wi=k;e.st=a.Hs;e.Gp=q;pa.push(a)};a.Av=function(a,b){return(b-a)*W.Re+1};a.kt=function(a,b,c,d,e,g){var f,m,h=new Float32Array(2),k=new Float32Array(2),q=new Float32Array(2),
l=new Float32Array(2),n=b[1],C=b[2],J=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var r=0,D=0,t=null;e<=g;e++)if(e<n)for(var u=0;u<W.Re;u++)c[r++]=C;else if(e>J)for(u=0;u<W.Re;u++)c[r++]=a;else{var s=b[D],w=3;0===s&&(w+=2);0===t&&(w+=2);var H=2===s?0:1;if(b[D+1]==b[D+w+1])t=s,D+=w;else{u=0;e==b[D+1]&&(H&&(d[r]=1),c[r]=b[D+2],r++,u++);if(e==J)for(;u<W.Re;u++)c[r++]=a;else for(h[0]=b[D+1],h[1]=b[D+2],0!==s?(k[0]=0,k[1]=0):0===t?(k[0]=b[D+5],k[1]=b[D+6]):(k[0]=b[D+3],k[1]=b[D+4]),0!==s?(q[0]=
0,q[1]=0):(q[0]=b[D+w+3],q[1]=b[D+w+4]),l[0]=b[D+w+1],l[1]=b[D+w+2];u<W.Re;u++){var x=e+u/W.Re;switch(s){case 0:f=h;m=k;var B=q,A=l,ha=[],U=[],y=void 0,P=void 0,z=void 0;ha[0]=f[0]-m[0];ha[1]=f[1]-m[1];U[0]=A[0]-B[0];U[1]=A[1]-B[1];z=A[0]-f[0];y=Math.abs(ha[0]);P=Math.abs(U[0]);0!=y+P&&y+P>z&&(y=z/(y+P),m[0]=f[0]-y*ha[0],m[1]=f[1]-y*ha[1],B[0]=A[0]-y*U[0],B[1]=A[1]-y*U[1]);H&&(d[r]=1);c[r]=v(I(0,1,x,h[0],k[0],q[0],l[0]),h[1],k[1],q[1],l[1]);r++;break;case 1:m=h[0];B=h[1];f=A=(l[1]-B)/(l[0]-m);m=B-
A*m;H&&(d[r]=1);c[r]=f*x+m;r++;break;case 2:H&&(d[r]=1);c[r]=b[D+2];r++;break;default:throw"Unknown keyframe intepolation mode: "+s;}}e+1==b[D+w+1]&&(t=s,D+=w)}}};a.oA=function(a){for(var b=0;b<a.length;b++)if(a[b].Fz)return a[b];return!1};a.apply=H;a.get_slot_num_by_anim=function(a,c){for(var d=a.w,e=0;e<d.length;e++){var g=d[e];if(g&&b(g.$c)==b(c))return e}return-1};a.yv=function(a,c){var d=a.w[c];return d&&d.$c?b(d.$c):null};a.remove=function(a){a.w=null;a=ha.indexOf(a);-1!=a&&ha.splice(a,1)};
a.jx=function(a){for(var b=pa.length-1;0<=b;b--)pa[b].Js==a&&pa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.w)return H(a,b,0)?0:-1;for(var c=0;c<a.w.length;c++)if(!a.w[c])return H(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.gk=(b-a.d.Gd)/c;a.d.fk=b};a.set_speed=function(a,b,c){d(a.w,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.w[b].speed};a.get_anim_start_frame=function(a,b){return a.w[b].start};a.get_anim_length=function(a,b){return a.w[b].length};a.hl=
D;a.cleanup=function(){ha.length=0;pa.length=0};a.av=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Pb.length,e=da,g=G,f=Boolean(c[0]);f||(c[0]={Pb:new Float32Array(d)});var m=Boolean(c[1]);m||(c[1]={Pb:new Float32Array(d)});var h=Boolean(c[2]);h||(c[2]={Pb:new Float32Array(d)});c[3]={Pb:new Float32Array(d)};for(var k=0;k<d;k++)g[0]=f?c[0].Pb[k]:0,g[1]=m?c[1].Pb[k]:0,g[2]=h?c[2].Pb[k]:0,z.euler_to_quat(g,e),c[0].Pb[k]=e[3],c[1].Pb[k]=e[0],c[2].Pb[k]=e[1],c[3].Pb[k]=e[2];d=b.replace("euler","quaternion");
a[d]=c;delete a[b]}};
b4w.module.__transform=function(a,p){function h(a){var q=a.d;b.Ky(a,g);f.Iy(a);"CAMERA"==a.type&&f.Mt(a);var n=q.e,t=q.scale,s=q.quat;r.Uh(n,t,s,q.Tc);var w=q.H;B.identity(w);B.fromQuat(s,w);"CAMERA"!=a.type&&x.tx(w,t,w);w[12]=n[0];w[13]=n[1];w[14]=n[2];B.invert(w,q.ip);a.w&&e.Ti(a)&&e.Ly(a);q.Db&&q.Ia&&(c.pk(q.Db,w,q.Ia),c.rk(q.rc,w,q.kb),c.qk(q.Ee,q.Tc,q.Fe),q.Nb&&k.Wl(k.get_active()));switch(a.type){case "SPEAKER":d.cy(a,g);break;case "CAMERA":f.dr(a);k.W()&&d.zw(k.get_active(),n,s,g);break;case "LAMP":l.Ny(a);
k.W()&&k.Oj(a,k.get_active());break;case "EMPTY":a.field&&k.fr(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!k.W()||(q=k.get_active(),k.Wl(q),k.xx(q));a=a.Fd;for(q=0;q<a.length;q++)h(a[q])}var c=p("__boundings"),f=p("__camera"),b=p("__constraints"),l=p("__lights"),e=p("__particles"),k=p("__scenes"),d=p("__sfx"),r=p("__tsr"),x=p("__util"),n=p("vec3"),t=p("quat"),w=p("mat3"),B=p("mat4"),q=new Float32Array(3),s=new Float32Array(4),y=new Float32Array(9),g=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){g=
a};a.set_translation=function(a,c){b.rd(a)==b.Yc?r.Mx(c,b.qd(a)):a.d.e.set(c)};a.get_translation=function(a,c){b.rd(a)==b.Yc?n.copy(r.Qo(b.qd(a)),c):n.copy(a.d.e,c)};a.set_rotation=function(a,c){b.rd(a)==b.Yc?r.Xl(c,b.qd(a)):a.d.quat.set(c)};a.get_rotation=function(a,c){b.rd(a)==b.Yc?t.copy(r.Lo(b.qd(a)),c):t.copy(a.d.quat,c)};a.set_rotation_euler=function(a,c){if(b.rd(a)==b.Yc){var d=x.euler_to_quat(c,s);r.Xl(d,b.qd(a))}else x.euler_to_quat(c,a.d.quat)};a.set_scale=function(a,c){b.rd(a)==b.Yc?r.set_scale(c,
b.qd(a)):a.d.scale=c};a.get_scale=function(a){return b.rd(a)==b.Yc?r.get_scale(b.qd(a)):a.d.scale};a.Vv=function(a,c){if(b.rd(a)==b.Yc)r.copy(b.qd(a),c);else{var d=a.d;r.Uh(d.e,d.scale,d.quat,c)}};a.vq=function(a,c){if(b.rd(a)==b.Yc)r.copy(c,b.qd(a));else{var d=a.d;d.e[0]=c[0];d.e[1]=c[1];d.e[2]=c[2];d.scale=c[3];d.quat[0]=c[4];d.quat[1]=c[5];d.quat[2]=c[6];d.quat[3]=c[7]}};a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),
b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,n.copy(b.kb.t,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,n.transformMat4(c,b.H,c));return c};a.move_local=function(a,b,c,d){a=a.d;q[0]=b;q[1]=c;q[2]=d;b=w.fromMat4(a.H,y);n.transformMat3(q,b,q);n.add(a.e,q,a.e)};a.v=h;a.distance=function(a,b){return n.dist(a.d.e,b.d.e)};a.Sw=function(a,b){return n.dist(a.d.e,
b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Ia.max_x,min_x:a.d.Ia.min_x,max_y:a.d.Ia.max_y,min_y:a.d.Ia.min_y,max_z:a.d.Ia.max_z,min_z:a.d.Ia.min_z}}};
b4w.module.__tsr=function(a,p){function h(a,b,c,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=b;e[4]=c[0];e[5]=c[1];e[6]=c[2];e[7]=c[3]}function c(a,b,c){var e=b[0],f=b[1],h=b[2],k=b[3],q=b[4],l=b[5],y=b[6];b=b[7];var g=a[0]*k,A=a[1]*k,u=a[2]*k;a=b*g+l*u-y*A;var k=b*A+y*g-q*u,p=b*u+q*A-l*g,g=-q*g-l*A-y*u;c[0]=a*b+g*-q+k*-y-p*-l;c[1]=k*b+g*-l+p*-q-a*-y;c[2]=p*b+g*-y+a*-l-k*-q;c[0]+=e;c[1]+=f;c[2]+=h;return c}var f=p("__util"),b=p("vec3"),l=p("quat");p("mat4");var e=new Float32Array(3),k=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.Of=function(a,b,c,e){e||(e=new Float32Array(8));h(a,b,c,e);return e};a.Uh=h;a.Mx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Nx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Xl=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Qo=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.Lo=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var e=a[0],f=a[1],h=a[2];k[0]=a[4];k[1]=a[5];k[2]=a[6];k[3]=a[7];l.invert(k,k);var B=k[0],q=k[1],s=k[2],y=k[3],e=e*c,f=f*c,g=h*c,h=y*e+q*g-s*f,A=y*f+s*e-B*g,u=y*g+B*f-q*e,e=-B*e-q*f-s*g;b[0]=-(h*y+e*-B+A*-s-u*-q);b[1]=-(A*y+e*-q+u*-B-h*-s);b[2]=-(u*y+e*-s+h*-q-A*-B);b[3]=c;b[4]=B;b[5]=q;b[6]=s;b[7]=y;return b};a.Ao=function(a,b){var c=f.hf(a,e),l=f.dj(a),t=f.matrix_to_quat(a,
k);h(c,l,t,b);return b};a.multiply=function(a,b,e){c(b,a,e);e[3]=a[3]*b[3];var f=a[4],h=a[5],k=a[6];a=a[7];var l=b[4],q=b[5],s=b[6];b=b[7];e[4]=f*b+a*l+h*s-k*q;e[5]=h*b+a*q+k*l-f*s;e[6]=k*b+a*s+f*q-h*l;e[7]=a*b-f*l-h*q-k*s;return e};a.Yh=c;a.Eg=function(a,b,c,e){e||(e=0);var f=a.length,h=b[0],k=b[1],q=b[2],l=b[3],y=b[4],g=b[5],A=b[6];b=b[7];for(var u=0;u<f;u+=3){var p=a[u]*l,I=a[u+1]*l,v=a[u+2]*l,K=b*p+g*v-A*I,m=b*I+A*p-y*v,H=b*v+y*I-g*p,p=-y*p-g*I-A*v;c[e+u]=K*b+p*-y+m*-A-H*-g;c[e+u+1]=m*b+p*-g+
H*-y-K*-A;c[e+u+2]=H*b+p*-A+K*-g-m*-y;c[e+u]+=h;c[e+u+1]+=k;c[e+u+2]+=q}};a.Jj=function(a,b,c,e){e||(e=0);var f=a.length,h=b[3],k=b[4],q=b[5],l=b[6];b=b[7];for(var y=0;y<f;y+=3){var g=a[y]*h,A=a[y+1]*h,u=a[y+2]*h,p=b*g+q*u-l*A,I=b*A+l*g-k*u,v=b*u+k*A-q*g,g=-k*g-q*A-l*u;c[e+y]=p*b+g*-k+I*-l-v*-q;c[e+y+1]=I*b+g*-q+v*-k-p*-l;c[e+y+2]=v*b+g*-l+p*-q-I*-k}};a.Ij=function(a,b,c){var e=b[3],f=b[4],h=b[5],k=b[6];b=b[7];var q=a[0]*e,l=a[1]*e,y=a[2]*e;a=b*q+h*y-k*l;var e=b*l+k*q-f*y,g=b*y+f*l-h*q,q=-f*q-h*l-
k*y;c[0]=a*b+q*-f+e*-k-g*-h;c[1]=e*b+q*-h+g*-f-a*-k;c[2]=g*b+q*-k+a*-h-e*-f};a.$q=function(a,b,c,e){e||(e=0);var f=a.length,h=b[3],k=b[4],q=b[5],l=b[6];b=b[7];for(var y=0;y<f;y+=4){var g=a[y]*h,A=a[y+1]*h,u=a[y+2]*h,p=b*g+q*u-l*A,I=b*A+l*g-k*u,v=b*u+k*A-q*g,g=-k*g-q*A-l*u;c[e+y]=p*b+g*-k+I*-l-v*-q;c[e+y+1]=I*b+g*-q+v*-k-p*-l;c[e+y+2]=v*b+g*-l+p*-q-I*-k;c[e+y+3]=a[y+3]}};a.translate=function(a,b,c){var e=a[3],f=a[4],h=a[5],k=a[6],q=a[7],l=b[0]*e,y=b[1]*e,g=b[2]*e;b=q*l+h*g-k*y;var e=q*y+k*l-f*g,A=
q*g+f*y-h*l,l=-f*l-h*y-k*g;c[0]=a[0]+b*q+l*-f+e*-k-A*-h;c[1]=a[1]+e*q+l*-h+A*-f-b*-k;c[2]=a[2]+A*q+l*-k+b*-h-e*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.RA=function(a,c,e,f){f||(f=new Float32Array(8));b.lerp(a.subarray(0,3),c.subarray(0,3),e,f.subarray(0,3));var h=a[3];f[3]=h+e*(c[3]-h);l.slerp(a.subarray(4),c.subarray(4),e,f.subarray(4));return f};a.mA=function(a,b,c,e){e||(e=new Float32Array(8));var f=a.subarray(0,3),h=b.subarray(0,3),k=e.subarray(0,3);k[0]=h[0]*(c+1)-f[0]*
c;k[1]=h[1]*(c+1)-f[1]*c;k[2]=h[2]*(c+1)-f[2]*c;e[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);f=e.subarray(4);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;l.normalize(f,f);return e};a.mw=function(a,b,c,e,f){var h=a.subarray(0,3),k=f.subarray(0,3);k[0]=h[0]+b*c[0];k[1]=h[1]+b*c[1];k[2]=h[2]+b*c[2];f[3]=a[3];a=a.subarray(4);f=f.subarray(4);c=e[0];h=e[1];e=e[2];var k=a[0],q=a[1],s=a[2],y=a[3];f[0]=.5*(c*y+h*s-e*q);f[1]=.5*(h*y+e*k-c*s);f[2]=.5*
(e*y+c*q-h*k);f[3]=.5*(-c*k-h*q-e*s);f[0]=a[0]+f[0]*b;f[1]=a[1]+f[1]*b;f[2]=a[2]+f[2]*b;f[3]=a[3]+f[3]*b;l.normalize(f,f)}};
b4w.module.__util=function(a,p){function h(a,b,c){for(var d=[],e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&d.push(f)}return d}function c(a,b){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:c(a[e],b);return d}function f(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=Math.sqrt(b*b+c*c+d*d),g=1/g;a[0]=b*g;a[1]=c*g;a[2]=d*g;a[3]=e*g}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return e(a,
c);case "string":return k(a,c);case "boolean":return e(a|0,c);case "function":case "undefined":return e(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=e(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var g in a)c=l(a[g],c)}else c=e(0,c)}return c}function e(a,b){var c=b;Z[0]=a;c=(c<<5)-c+V[0];c&=c;c=(c<<5)-c+V[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function d(a){return(34*a+1)*a%289}function r(a){return a-Math.floor(a)}function x(a){return n((34*a+5)*a)}function n(a){return a-289*Math.floor(a/289)}function t(a){return a-7*Math.floor(a/7)}function w(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var g in a)if(!B(a[g],b[g]))return!1;for(g in b)if(!(g in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return w(a,b);default:return!0}}var q=p("__print"),s=p("vec3"),y=p("vec4"),g=p("quat"),A=p("mat3"),u=p("mat4"),S=0,I={},v=new Float32Array(3),K=new Float32Array(3),m=new Float32Array(4),H=new Float32Array(4),
D=new Float32Array(9),U=new Float32Array(16),P=new Float32Array(16),Z=new Float64Array(1),V=new Uint32Array(Z.buffer),M=new Float32Array([0,0,0]),Q=new Float32Array([0,0,0,1]),T=new Float32Array([0,0,0,1,0,0,0,1]),X=new Float32Array([1,0,0]),z=new Float32Array([0,1,0]),ia=new Float32Array([0,0,1]),W=new Float32Array([-1,0,0]),L=new Float32Array([0,-1,0]),G=new Float32Array([0,0,-1]),fa=Math.floor(44488.07041494893);a.Gs=M;a.Bs=Q;a.Cz=T;a.AXIS_X=X;a.AXIS_Y=z;a.AXIS_Z=ia;a.AXIS_MX=W;a.AXIS_MY=L;a.AXIS_MZ=
G;a.keyfind=h;a.dv=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Dy=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Ht=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.lt=function(a,b){var c=[],d={},e=b.length,g,f;for(g=0;g<e;g++)d[b[g]]=!0;e=a.length;for(g=0;g<e;g++)f=a[g],f in d&&c.push(f);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.aB=function(a,b,c){for(var d=
c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.$A=function(a,b,c,d,e){for(var g=0;g<e.length;g++){var f=e[g];if(f[a]==b&&f[c]==d)return f}return null};a.el=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.ht=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.Wz=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==
a[d])return!1;return!0};a.nB=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.lB=function(a,b){var c=h("name",b,a);1<c.length&&q.error("obj_by_name(): name resolution ambiguity");return c};a.mB=function(a,b){var c=h("name",b,a),d=c.length;1<d&&q.error("obj_by_name(): name resolution ambiguity");if(0>=d)return[];for(var e=[],g=0;g<d;g++){var f=c[g];if("EMPTY"==f.type&&f.dupli_group)for(var f=f.dupli_group.objects,m=0;m<f.length;m++)e.push(f[m])}return c.concat(e)};
a.Ay=function(a,b,c,d){d||(d=new Float32Array(16));u.identity(d);d[12]=a;d[13]=b;d[14]=c};var da=1;a.ex=function(){da=(69069*da+5)%Math.pow(2,32);return Math.round(da/65536)%32768/32767};a.jy=function(a){da=a};a.kc=function(a){var b=a[0]%fa*48271-3399*Math.floor(a[0]/fa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Vi=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),g=Math.sin(a[1]/2),f=Math.sin(a[2]/
2),m=Math.sin(a[0]/2);b[0]=g*f*e+c*d*m;b[1]=g*d*e+c*f*m;b[2]=c*f*e-g*d*m;b[3]=c*d*e-g*f*m;return b};a.Su=function(a){var b=A.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),g=Math.sin(a[0]),f=Math.sin(a[1]);a=Math.sin(a[2]);var m=c*e,h=c*a,k=g*e,q=g*a;b[0]=d*e;b[1]=d*a;b[2]=-f;b[3]=f*k-h;b[4]=f*q+m;b[5]=d*g;b[6]=f*m+q;b[7]=f*h-k;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],f=e*e,m=c*d+e*g;.499999<m?(b[0]=0,b[1]=2*Math.atan2(c,g),b[2]=Math.PI/2):-.499999>
m?(b[0]=0,b[1]=-2*Math.atan2(c,g),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*g-2*d*e,1-2*c*c-2*f),b[1]=Math.atan2(2*d*g-2*c*e,1-2*d*d-2*f),b[2]=Math.asin(2*c*d+2*e*g));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));s.transformQuat(b,a,c);return c};a.iA=function(a,b,c){c||(c=new Float32Array(4));a=s.normalize(a,v);var d=s.dot(b,a);a=s.cross(b,a,K);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.By=function(a,b,c,d){d||
(d=new Float32Array(4));s.transformQuat(c,b,d);d[3]=-s.dot(a,d)};a.Ku=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":v[0]=0;v[1]=-1;v[2]=0;s.transformQuat(v,b,v);K[0]=0;K[1]=0;K[2]=-1;break;case "MESH":v[0]=0;v[1]=0;v[2]=1;s.transformQuat(v,b,v);K[0]=0;K[1]=0;K[2]=1;break;case "EMPTY":v[0]=0,v[1]=1,v[2]=0,s.transformQuat(v,b,v),K[0]=0,K[1]=1,K[2]=0}v[1]=0;s.normalize(v,v);a=s.dot(v,K);return Math.acos(a)*(0<-v[0]*K[2]?-1:1)};a.on=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=
(1-c)*a[e]+c*b[e]}};a.EB=function(){S++;return S.toString(16)};a.Lj=function(a){I[a]||(I[a]=0);var b=a+I[a];I[a]++;return b};a.hd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.mb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,C:0,Y:null,r:[],A:b}};a.fp=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};a.Ie=function(a){return JSON.parse(JSON.stringify(a))};
a.Yz=function(a,b){var d=[],e;for(e in b){var g=b[e];if(g)for(var f=0;f<g.length;f++)d.push(g[f])}return c(a,d)};a.ra=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ra(b[d]):b[d];return c};a.Zg=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?
new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.sc=function(a){return"MESH"===a.type?!0:!1};a.kp=function(a){return"MESH"===a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.qw=function(a){return"EMPTY"===a.type?!0:!1};a.Ye=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));A.fromMat4(a,D);var c=D[0],d=D[3],e=D[6],f=D[1],m=D[4],
h=D[7],k=D[2],q=D[5],l=D[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+m*m+h*h)||1,k=Math.sqrt(k*k+q*q+l*l)||1;D[0]/=c;D[3]/=c;D[6]/=c;D[1]/=f;D[4]/=f;D[7]/=f;D[2]/=k;D[5]/=k;D[8]/=k;g.fromMat3(D,b);return b};a.hf=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.dj=function(a){m[0]=.577350269189626;m[1]=.577350269189626;m[2]=.577350269189626;m[3]=0;y.transformMat4(m,a,m);return y.length(m)};a.qo=function(a,b){var c=b.left,d=b.right,e=b.top,g=b.bottom,m=b.Fa,h=
b.La;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];m[0]=a[3]+a[2];m[1]=a[7]+a[6];m[2]=a[11]+a[10];m[3]=a[15]+a[14];h[0]=a[3]-a[2];h[1]=a[7]-a[6];h[2]=a[11]-a[10];h[3]=a[15]-a[14];f(c);f(d);f(e);f(g);f(m);f(h)};a.ey=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||
d<-b(a,c.Fa)||d<-b(a,c.La)?!0:!1};a.Ru=function(a,c,d,e,g){f=s.dot(d,c.La);m=s.dot(e,c.La);h=s.dot(g,c.La);f=Math.sqrt(f*f+m*m+h*h);if(f<-b(a,c.Fa)||f<-b(a,c.La))return!0;var f=s.dot(d,c.left),m=s.dot(e,c.left),h=s.dot(g,c.left);if(Math.sqrt(f*f+m*m+h*h)<-b(a,c.left))return!0;f=s.dot(d,c.right);m=s.dot(e,c.right);h=s.dot(g,c.right);if(Math.sqrt(f*f+m*m+h*h)<-b(a,c.right))return!0;f=s.dot(d,c.top);m=s.dot(e,c.top);h=s.dot(g,c.top);if(Math.sqrt(f*f+m*m+h*h)<-b(a,c.top))return!0;f=s.dot(d,c.bottom);
m=s.dot(e,c.bottom);h=s.dot(g,c.bottom);return Math.sqrt(f*f+m*m+h*h)<-b(a,c.bottom)?!0:!1};a.ce=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],m=a[g+1],h=a[g+2];c[d+g]=b[0]*f+b[4]*m+b[8]*h+b[12];c[d+g+1]=b[1]*f+b[5]*m+b[9]*h+b[13];c[d+g+2]=b[2]*f+b[6]*m+b[10]*h+b[14]}};a.dz=function(a,b,c){for(var d=0,d=0,e=a.length,g=0;g<e;g+=3){var f=a[g],m=a[g+1],h=a[g+2];c[d+g]=b[0]*f+b[4]*m+b[8]*h;c[d+g+1]=b[1]*f+b[5]*m+b[9]*h;c[d+g+2]=b[2]*f+b[6]*m+b[10]*h}};a.xy=function(a,b,c){for(var d=
0,d=0,e=a.length,g=0;g<e;g+=4){var f=a[g],m=a[g+1],h=a[g+2];c[d+g]=b[0]*f+b[4]*m+b[8]*h;c[d+g+1]=b[1]*f+b[5]*m+b[9]*h;c[d+g+2]=b[2]*f+b[6]*m+b[10]*h;c[d+g+3]=a[g+3]}};a.bz=function(a,b,c){c||(c=new Float32Array(3));m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=0;y.transformMat4(m,b,m);c[0]=m[0];c[1]=m[1];c[2]=m[2]};a.pA=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var g=
0;g<d;g++)b[e*d+g]=a[e][g];return b};a.cz=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.ui=function(b,c,d,e){if(e<d)return d;var g=d+Math.floor((e-d)/2);return b[g]>c?a.ui(b,c,d,g-1):b[g]<c?a.ui(b,c,g+1,e):g};a.Ld=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Ci=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.tx=function(a,b,c){c||(c=new Float32Array(16));for(var d=
0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.rm=function(a,b,c,d){d||(d=new Float32Array(16));b=u.fromRotationTranslation(b,c,U);u.multiply(b,a,d)};a.Yh=function(a,b,c,d,e){e||(e=new Float32Array(3));c=u.fromRotationTranslation(c,d,U);1!==b&&(d=u.identity(P),b=s.set(b,b,b,v),u.scale(d,b,d),u.multiply(c,d,c));s.transformMat4(a,c,e);return e};a.sm=function(a,b,c,d){d||(d=new Float32Array(4));b=u.fromRotationTranslation(b,c,U);y.transformMat4(a,b,d)};a.SA=function(a,b,c,
d,e){e||(e=new Float32Array(3));b=u.fromRotationTranslation(c,d,U);u.invert(b,b);s.transformMat4(a,b,e);return e};a.BB=function(a,b,c){c||(c=new Float32Array(16));u.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.jB=function(b,c,d){a.hf(b,c);c[3]=a.dj(b);a.matrix_to_quat(b,d)};a.cn=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.qq=function(a,b,c,d){d||(d=new Float32Array(3));s.subtract(b,a,v);s.transformQuat(v,c,v);s.subtract(b,v,d)};
a.nv=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),g=new Float32Array(16),f=new Float32Array(16);u.lookAt(a,[-1,0,0],[0,-1,0],b);u.scale(b,[-1,1,1],b);u.scale(b,[-1,1,-1],c);u.lookAt(a,[0,-1,0],[0,0,-1],d);u.scale(d,[1,1,-1],d);u.scale(d,[1,-1,-1],e);u.lookAt(a,[0,0,-1],[0,-1,0],g);u.scale(g,[-1,1,1],g);u.scale(g,[-1,1,-1],f);return[b,c,d,e,g,f]};a.Xg=function(a,b){return l(a,b)};a.hash_code=l;a.LA=k;a.iB=function(a,
b,c){var d=b[0],e=b[1];b=b[2];var g,f,m,h,k,q,l,n,D,t,r,s;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;g=a[0];f=a[1];m=a[2];h=a[3];k=a[4];q=a[5];l=a[6];n=a[7];D=a[8];t=a[9];r=a[10];s=a[11];c[0]=g;c[1]=f;c[2]=m;c[3]=h;c[4]=k;c[5]=q;c[6]=l;c[7]=n;c[8]=D;c[9]=t;c[10]=r;c[11]=s;c[12]=g*d+k*e+D*b+a[12];c[13]=f*d+q*e+t*b+a[13];c[14]=m*d+l*e+r*b+a[14];c[15]=h*d+n*e+s*b+a[15];return c};a.Ew=function(a,
b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.dx=function(a){return a*Math.PI/180};a.fA=function(a){return 180*a/Math.PI};
a.dm=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),e=Math.floor(a[1]+b),g=.211324865405187*c+.211324865405187*e,b=a[0]-c+g;a=a[1]-e+g;var f=b>a?1:0,m=1-f,g=b+.211324865405187-f,h=a+.211324865405187-m,k=b+-.577350269189626,q=a+-.577350269189626,c=c%289,e=e%289,l=d(d(e)+c),m=d(d(e+m)+c+f),n=d(d(e+1)+c+1),c=Math.max(.5-(b*b+a*a),0),e=Math.max(.5-(g*g+h*h),0),f=Math.max(.5-(k*k+q*q),0),D=2*r(.024390243902439*l)-1,t=2*r(.024390243902439*m)-1,s=2*r(.024390243902439*
n)-1,l=Math.abs(D)-.5,m=Math.abs(t)-.5,n=Math.abs(s)-.5,D=D-Math.floor(D+.5),t=t-Math.floor(t+.5),s=s-Math.floor(s+.5);return 130*(c*c*c*c*(1.79284291400159-.85373472095314*(D*D+l*l))*(D*b+l*a)+e*e*e*e*(1.79284291400159-.85373472095314*(t*t+m*m))*(t*g+m*h)+f*f*f*f*(1.79284291400159-.85373472095314*(s*s+n*n))*(s*k+n*q))};a.An=function(a){var b=1/7,c=b/2,d=n(Math.floor(a[0])),e=n(Math.floor(a[1])),g=r(a[0]);a=r(a[1]);var f=g-.5,m=g-1.5,g=a-.5;a-=1.5;var h=x(d),k=x(d+1),q=h,d=k,h=x(h+e),k=x(k+e),q=x(q+
e+1),d=x(d+e+1),e=f+.7*(t(h)*b+c),l=m+.7*(t(k)*b+c),f=f+.7*(t(q)*b+c),m=m+.7*(t(d)*b+c),h=g+.7*(t(Math.floor(h*b))*b+c),g=g+.7*(t(Math.floor(k*b))*b+c),q=a+.7*(t(Math.floor(q*b))*b+c),b=a+.7*(t(Math.floor(d*b))*b+c);return Math.min(e*e+h*h,l*l+g*g,f*f+q*q,m*m+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=s.transformQuat(b,a,v);b=c[0];var f=c[1];c=c[2];D[0]=f*f+c*c;D[1]=-f*b;D[2]=-c*b;D[3]=-b*f;D[4]=b*b+c*c;D[5]=-c*f;D[6]=-b*c;D[7]=-f*c;D[8]=b*b+f*f;s.transformMat3(a,D,a);s.normalize(a,
a);g.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=m,d=H,c=g.setAxisAngle([0,1,0],Math.PI,g.create()),d=g.setAxisAngle([1,0,0],Math.PI/2,g.create());g.multiply(c,d,c);g.multiply(a,c,b);return b};a.cleanup=function(){S=0;I={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=
(1-c)*a[d]+c*b[d];return e};a.Eq=function(a,b,c,d,e){e||(e=new Float32Array(a.length));g.slerp(a,b,Math.exp(-c/d),e)};a.TA=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=A.fromQuat(a,D);K[0]=0;K[1]=1;K[2]=0;v[0]=c[3];v[1]=c[4];v[2]=c[5];var d=s.cross(K,v,v);s.normalize(d,d);var e=c[7];
!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);K[0]=c[0];K[1]=c[1];K[2]=c[2];s.normalize(K,K);g.rotationTo(K,d,H);g.multiply(H,a,a)};a.Eo=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var g=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),f=b-1,m=a[e*b+c],h=a[e*b+Math.min(c+1,f)],k=a[Math.min(e+1,f)*b+c];a=a[Math.min(e+1,f)*b+Math.min(c+1,f)];return(m*(1-d)+h*d)*(1-g)+(k*(1-d)+a*d)*g};a.vf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.oq=function(a){for(var b=[0,0,0],c=0;3>
c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Rh=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.kv=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Te=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));
c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];s.normalize(c,c)};a.CB=function(a,b,c){var d=a[0],e=a[1];a=a[2];var g=b[0],f=b[1],m=b[2];b=b[3];var h=f*a-m*e,k=m*d-g*a,q=g*e-f*d,l=f*q-m*k,m=m*h-g*q;c[0]=d+2*h*b+2*l;c[1]=e+2*k*b+2*m;c[2]=a+2*q*b+2*(g*k-f*h);return c};a.da=function(a){a&&q.error.apply(q,arguments);throw"panic: see above for possible error messages";};a.ze=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.cl=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Rq=function(a,b){for(var c in a){var d=
!0,e=a[c],g=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==g;break;case "object":d=w(e,g)}if(!d)return!1}return!0};a.cx=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.jv=function(a){a+=1;132651<a&&q.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;return[b/51,Math.floor(a/51)/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){m.set(a);m[3]=b;H.set(d);H[3]=0;a=y.dot(m,H);if(0==a)return null;H.set(c);H[3]=1;a=-y.dot(m,H)/a;e[0]=c[0]+
a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.$z=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.sq=function(a,b,c){var d=s.dot(a,b);-.9999999>d?(s.cross(X,a,v),1E-6>s.length(v)&&s.cross(z,a,v),s.normalize(v,v),g.setAxisAngle(v,Math.PI,c)):(s.cross(a,b,v),c.set(v),c[3]=1+d,g.normalize(c,c));return c}};
b4w.module.__sfx=function(a,p){function h(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;n.warn("B4W warning: deprecated WebAudio implementation");return null}n.warn("B4W warning: WebAudio is not supported");return null}function c(a,c,d){var g=a.g;if("NONE"!=g.behavior){d||(d=0);var f=g.loop,h=g.pitch;if(g.src&&(f||0<=d)){g.kk=Math.floor(5E4*Math.random());c=u.currentTime+c;g.Zb=c;g.state=20;var k=a.g;if(!k.Lb){var n=a.d.e,s=a.d.quat;if(B.hj){var w=u.createBiquadFilter();
w.type="peaking"}else w=null;var v=u.createGain();switch(k.behavior){case "POSITIONAL":var x=u.createPanner();x.panningModel=x.EQUALPOWER;x.distanceModel=x.INVERSE_DISTANCE;x.setPosition(n[0],n[1],n[2]);k.sl.set(n);var y=q;t.quat_to_dir(s,t.AXIS_MY,y);x.setOrientation(y[0],y[1],y[2]);k.direction.set(y);x.refDistance=k.dist_ref;x.maxDistance=k.dist_max;x.rolloffFactor=k.attenuation;x.coneInnerAngle=k.Rt;x.coneOuterAngle=k.St;x.coneOuterGain=k.Tt;y=u.createGain();y.gain.value=r(k);w?(x.connect(w),w.connect(y)):
x.connect(y);y.connect(v);k.Lb=x;if(k.Mg){var A=u.createGain();v.connect(A);A.connect(u?S.g.Lb:null)}else A=null,v.connect(u?S.g.Lb:null);break;case "BACKGROUND_SOUND":x=null;y=u.createGain();y.gain.value=r(k);w?(k.Lb=w,w.connect(y)):k.Lb=y;y.connect(v);k.Mg?(A=u.createGain(),v.connect(A),A.connect(u?S.g.Lb:null)):(A=null,v.connect(u?S.g.Lb:null));break;case "BACKGROUND_MUSIC":A=x=null,y=u.createGain(),y.gain.value=r(k),w?(k.Lb=w,w.connect(y)):k.Lb=y,y.connect(v),v.connect(u?S.g.Lb:null)}k.Dh=x;k.Hc=
w;k.Wf=y;k.Oe=v;k.hq=A}if("POSITIONAL"==g.behavior||"BACKGROUND_SOUND"==g.behavior)a=u.createBufferSource(),a.buffer=g.src,a.playbackRate.value=h,f?(g.Ya&&g.Ya.disconnect(),a.loop=!0,a.start(c),g.duration=0):(f=a.buffer?a.buffer.duration:0,d>f?(f=c+d+g.nd,a.loop=!0,a.start(c),a.stop(f),g.duration=d):(a.loop=!1,a.start(c),g.duration=f)),a.connect(g.Lb),g.Ya=a,b(g),l(g);else if("BACKGROUND_MUSIC"==g.behavior){window.clearTimeout(g.mn);d=a.g;if(f=d.src)f.volume=1,f.loop=d.cyclic,d.Ya=d.Ya||u.createMediaElementSource(f),
d.Ya.connect(d.Lb),20==d.state&&f.play();g.duration=1E6}e(g,c)}}}function f(a){var b=a.g,d=b.duration,b=b.delay+b.Hu*Math.random();c(a,b,d)}function b(a){a.Mg&&a.hq.gain.cancelScheduledValues(a.Zb);a.Ih&&a.Ya.playbackRate.cancelScheduledValues(a.Zb);a.di=a.Zb}function l(a){if(a.Mg||a.Ih){var b=a.hq,c=a.Ya,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Zb;v[0]=a.kk;for(var g=0;5>g;){var f=a.pitch+a.Ih*t.kc(v);if(e>=a.di){if(a.Mg){var h=1-t.clamp(a.Mg,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Ih&&
c.playbackRate.setValueAtTime(f,e);g++}e+=d/f}a.di=e-.001}}}function e(a,b){if(a.Rk||a.nd){var c=a.Oe;c.gain.cancelScheduledValues(b);a.Rk?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Rk)):c.gain.setValueAtTime(1,b);a.nd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.nd))}}function k(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.g;if(20==a.state||40==a.state){var b=a.Oe,c=u.currentTime;a.nd&&(b.gain.setValueAtTime(b.gain.value,
c),b.gain.linearRampToValueAtTime(0,c+a.nd));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.mn=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.nd))}else b=a.Ya,a.duration<b.buffer.duration?a.nd&&20==a.state?b.stop(c+a.nd):20==a.state&&(b.stop(0),b.disconnect()):b.disconnect(),a.Zb=0,a.Ml=0,a.sk=0;a.state=30}}function d(a){return!a.g||20!=a.g.state&&40!=a.g.state&&30!=a.g.state?!1:!0}function r(a){return a.muted?0:a.volume}var x=p("__config"),n=p("__print"),t=p("__util"),
w=p("vec3"),B=x.Ad;a.Hm=10;a.Wj=20;a.Gm=30;var q=new Float32Array(3),s=new Float32Array(3),y=new Float32Array(3),g=[],A=[],u=null,S=null,I=[],v=[1],K=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(g.push("ogg"),g.push("ogv")),""!=a.canPlayType("audio/mpeg")&&g.push("mp3"),""!=a.canPlayType("audio/mp4")&&(g.push("mp4"),g.push("m4v")),""!=a.canPlayType("audio/webm")&&g.push("webm"));b.canPlayType&&(""!=
b.canPlayType("video/ogg")&&A.push("ogv"),""!=b.canPlayType("video/mp4")&&A.push("m4v"),""!=b.canPlayType("video/webm")&&A.push("webm"));(u=B.jz?h():null)&&n.log("%cINIT WEBAUDIO: "+u.sampleRate+"Hz","color: #00a")};a.fn=function(a){var b={ef:new Float32Array(3),up:new Float32Array(3),dg:new Float32Array(3)};a.g=b;if(u){var c=u.createGain(),d=u.createGain();b.Wf=c;b.Oe=d;c.connect(d);d.connect(u.destination);if(a.b4w_enable_dynamic_compressor){var d=u.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;
d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.$g=d;b.Lb=d}else b.$g=null,b.Lb=c;c=u.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Ne=0}};a.Cx=function(a){S=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<g.indexOf(a)?a:"ogg"==a&&-1<g.indexOf("mp4")?"mp4":"mp3"==a&&-1<g.indexOf("ogg")?"ogg":"mp4"==a&&-1<g.indexOf("ogg")?"ogg":"ogv"==
a&&-1<g.indexOf("m4v")?"m4v":"webm"==a&&-1<g.indexOf("m4v")?"m4v":"m4v"==a&&-1<g.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<A.indexOf(a)?a:"ogv"==a&&-1<A.indexOf("m4v")?"m4v":"webm"==a&&-1<A.indexOf("m4v")?"m4v":"m4v"==a&&-1<A.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.g={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.g.behavior=u?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.g,d;u?(window.MediaElementAudioSourceNode?d=!0:(n.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.g.behavior="NONE");a.g.Lu=b.b4w_disable_doppler;a.g.muted=b.muted;a.g.volume=b.volume;a.g.pitch=b.pitch;a.g.attenuation=b.attenuation;a.g.dist_ref=b.distance_reference;a.g.dist_max=b.distance_max||1E4;a.g.Rt=b.cone_angle_inner;a.g.St=
b.cone_angle_outer;a.g.Tt=b.cone_volume_outer;a.g.cyclic=b.b4w_cyclic_play;a.g.loop=b.b4w_loop;a.g.delay=b.b4w_delay;a.g.Hu=b.b4w_delay_random;a.g.Mg=b.b4w_volume_random;a.g.Ih=b.b4w_pitch_random;a.g.Rk=b.b4w_fade_in;a.g.nd=b.b4w_fade_out;a.g.Zb=0;a.g.Ml=0;a.g.sk=0;a.g.duration=0;a.g.di=0;a.g.kk=1;a.g.src=null;a.g.state=10;a.g.sl=new Float32Array(3);a.g.direction=new Float32Array(3);a.g.fm=new Float32Array(3);a.g.mn=null;a.g.Ne=0;I.push(a)};a.Fq=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";
switch(b.g.behavior){case "POSITIONAL":return a.Wj;case "BACKGROUND_SOUND":return a.Wj;case "BACKGROUND_MUSIC":return a.Gm;case "NONE":return a.Hm;default:throw"Wrong speaker behavior";}};a.Ty=function(a,b){var c=a.g;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Ww=function(){var a=u.createBufferSource();a.buffer=u.createBuffer(1,22050,22050);a.connect(u.destination);a.start(0)};a.Eu=
function(a,b,c){u?u.decodeAudioData(a,b,c):c()};a.by=function(a){k(a);delete a.g;I.splice(I.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<I.length;a++){var b=I[a].g;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Ya&&b.Ya.disconnect()}S&&S.g&&(a=S.g,a.ef[0]=0,a.ef[1]=0,a.ef[2]=0,a.dg[0]=0,a.dg[1]=0,a.dg[2]=0);S=null;I.splice(0);K=null};a.update=function(a){if(u&&0!=I.length){for(var b=0;b<I.length;b++){var c=I[b],d=c.g,e=u.currentTime;!d.loop&&d.cyclic&&20==d.state&&d.duration&&u&&d.Zb+
d.duration<e&&f(c);20==d.state&&3>d.di-e&&l(d)}K&&(-1==K.xa||a>K.Xm+K.io[K.xa])&&(b=K,-1<b.xa&&k(b.le[b.xa]),-1==b.xa&&b.random?c=Math.round(Math.random()*(b.le.length-1)):b.random?(c=1+Math.round(Math.random()*(b.le.length-2)),c=(b.xa+c)%b.le.length):c=(b.xa+1)%b.le.length,f(b.le[c]),b.xa=c,b.Xm=a)}};a.play=c;a.play_def=f;a.stop=k;a.is_play=function(a){return 20==a.g.state};a.playrate=function(a,c){var e=a.g;e.pitch=c;!d(a)||"POSITIONAL"!=e.behavior&&"BACKGROUND_SOUND"!=e.behavior||(e.Ya.playbackRate.value=
c,b(e),l(e))};a.FA=function(a){return a.g.pitch};a.cyclic=function(a,b){a.g.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.g.cyclic};a.zw=function(a,b,c,d){if(u&&a.g){var e=q;e[0]=0;e[1]=-1;e[2]=0;w.transformQuat(e,c,e);s[0]=0;s[1]=0;s[2]=-1;w.transformQuat(s,c,s);c=u.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],s[0],s[1],s[2]);a.g.up.set(e);d&&(y[0]=(b[0]-a.g.ef[0])/d,y[1]=(b[1]-a.g.ef[1])/d,y[2]=(b[2]-a.g.ef[2])/d,t.smooth_v(y,a.g.dg,d,.3,y),c.setVelocity(y[0],y[1],
y[2]),a.g.dg.set(y));a.g.ef.set(b)}};a.listener_reset_speed=function(a,b){if(u&&S.g){var c=q;b?c.set(b):c.set(S.g.up);w.scale(c,a,c);u.listener.setVelocity(c[0],c[1],c[2]);S.g.dg.set(c)}};a.cy=function(a,b){var c=a.g;if(d(a)&&"POSITIONAL"==c.behavior){var e=a.d.e,g=c.Dh;g.setPosition(e[0],e[1],e[2]);var f=q;t.quat_to_dir(a.d.quat,t.AXIS_MY,f);g.setOrientation(f[0],f[1],f[2]);f=c.sl;!c.Lu&&b&&(s[0]=(e[0]-f[0])/b,s[1]=(e[1]-f[1])/b,s[2]=(e[2]-f[2])/b,t.smooth_v(s,c.fm,b,.3,s),g.setVelocity(s[0],s[1],
s[2]),c.fm.set(s));f.set(e)}};a.speaker_reset_speed=function(a,b,c){var e=a.g;if(d(a)&&"POSITIONAL"==e.behavior){var g=q;c?g.set(c):g.set(e.direction);w.scale(g,b,g);e.Dh.setVelocity(g[0],g[1],g[2]);e.fm.set(g);e.sl.set(a.d.e)}};a.Yd=function(a){return a.g?!0:!1};a.fl=function(a){return a.g.behavior};a.check_active_speakers=function(){for(var a=0;a<I.length;a++)if(d(I[a]))return!0;return!1};a.Ix=function(a){var b=S.g;b&&(b.volume=a,u&&(b.Wf.gain.value=r(b)))};a.Nv=function(){var a=S.g;return a?a.volume:
0};a.set_volume=function(a,b){var c=a.g;c.volume=b;d(a)&&(c.Wf.gain.value=r(c))};a.get_volume=function(a){return a.g.volume};a.mute=function(a,b){a.g.muted=Boolean(b);d(a)&&(a.g.Wf.gain.value=r(a.g))};a.is_muted=function(a){return a.g.muted};a.Lw=function(a){var b=S.g;b&&(b.muted=Boolean(a),u&&(b.Wf.gain.value=r(b)))};a.vw=function(){var a=S.g;return a?a.muted:!1};a.get_speaker_objects=function(){return I};a.pause=function(){for(var a=0;a<I.length;a++){var c=I[a].g;if(20==c.state){if("BACKGROUND_MUSIC"==
c.behavior){var d=c.src;d&&d.pause()}else{var e=u.currentTime;c.Ml=e;if(e>c.Zb){d=c;v[0]=d.kk;for(var g=d.Ya.buffer.duration,f=d.Zb,h=void 0;f<e;)h=d.pitch+d.Ih*t.kc(v),f+=g/h;d=(g/h-(f-e))*h}else d=0;c.sk=d;c.Ya.stop(0);c.Ya.disconnect();b(c)}c.state=40}}};a.resume=function(){for(var a=0;a<I.length;a++){var b=I[a],c=b.g;if(40==c.state){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b.g,d=u.createBufferSource();d.loop=b.Ya.loop;d.buffer=b.Ya.buffer;d.playbackRate.value=b.Ya.playbackRate.value;
b.Dh?d.connect(b.Dh):d.connect(b.Wf);b.Ya=d;b=u.currentTime;c.Zb+=b-c.Ml;c.di=b;c.Ya.start(c.Zb,c.sk);l(c);e(c,c.Zb)}c.state=20}}};a.set_compressor_params=function(a,b){if(a.g&&a.g.$g){var c=a.g.$g;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.g||!a.g.$g)return null;a=a.g.$g;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.duck=function(a,b,c){if(d(a)){a=a.g;var e=a.Oe,g=u.currentTime;e.gain.setValueAtTime(e.gain.value,g);e.gain.linearRampToValueAtTime(b,g+c);a.Ne=c}};a.unduck=function(a){if(d(a)){a=a.g;var b=a.Oe,c=u.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.Nu=function(a,b){if(u){var c=S.g,d=c.Oe,e=u.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Ne=b}};a.Ey=function(){if(u){var a=S.g,b=a.Oe,c=u.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.apply_playlist=function(a,b,c){K={xa:-1,Xm:0,random:c,le:[],io:[]};for(c=0;c<a.length;c++){var d=a[c];k(d);K.le.push(d);d=d.g;d=(d=d.src)?d.duration:0;K.io.push(d+b)}};a.clear_playlist=function(){if(K)for(var a=K.le,b=0;b<a.length;b++)k(a[b]);K=null};a.get_positional_params=function(a){return(a=a.g)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.g;
if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Dh;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.g;c&&c.Hc&&(c.Hc.frequency.value=b.freq,c.Hc.Q.value=b.Q,c.Hc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.g)&&a.Hc?{freq:a.Hc.frequency.value,Q:a.Hc.Q.value,gain:a.Hc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.g;if(!a||
!a.Hc)return null;a.Hc.getFrequencyResponse(b,c,d)}};
b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var f=new p(3);f[0]=a[0];f[1]=a[1];f[2]=a[2];return f};a.fromValues=function(a,f,b){var h=new p(3);h[0]=a;h[1]=f;h[2]=b;return h};a.copy=function(a,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f};a.set=function(a,f,b,h){h[0]=a;h[1]=f;h[2]=b;return h};a.add=function(a,f,b){b[0]=a[0]+f[0];b[1]=a[1]+f[1];b[2]=a[2]+f[2];return b};
a.subtract=function(a,f,b){b[0]=a[0]-f[0];b[1]=a[1]-f[1];b[2]=a[2]-f[2];return b};a.sub=a.subtract;a.multiply=function(a,f,b){b[0]=a[0]*f[0];b[1]=a[1]*f[1];b[2]=a[2]*f[2];return b};a.mul=a.multiply;a.divide=function(a,f,b){b[0]=a[0]/f[0];b[1]=a[1]/f[1];b[2]=a[2]/f[2];return b};a.div=a.divide;a.min=function(a,f,b){b[0]=Math.min(a[0],f[0]);b[1]=Math.min(a[1],f[1]);b[2]=Math.min(a[2],f[2]);return b};a.max=function(a,f,b){b[0]=Math.max(a[0],f[0]);b[1]=Math.max(a[1],f[1]);b[2]=Math.max(a[2],f[2]);return b};
a.scale=function(a,f,b){b[0]=a[0]*f;b[1]=a[1]*f;b[2]=a[2]*f;return b};a.scaleAndAdd=function(a,f,b,h){h[0]=a[0]+f[0]*b;h[1]=a[1]+f[1]*b;h[2]=a[2]+f[2]*b;return h};a.distance=function(a,f){var b=f[0]-a[0],h=f[1]-a[1],e=f[2]-a[2];return Math.sqrt(b*b+h*h+e*e)};a.dist=a.distance;a.squaredDistance=function(a,f){var b=f[0]-a[0],h=f[1]-a[1],e=f[2]-a[2];return b*b+h*h+e*e};a.sqrDist=a.squaredDistance;a.length=function(a){var f=a[0],b=a[1];a=a[2];return Math.sqrt(f*f+b*b+a*a)};a.len=a.length;a.squaredLength=
function(a){var f=a[0],b=a[1];a=a[2];return f*f+b*b+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,f){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};a.inverse=function(a,f){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];return f};a.normalize=function(a,f){var b=a[0],h=a[1],e=a[2],b=b*b+h*h+e*e;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=a[2]*b);return f};a.dot=function(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]};a.cross=function(a,f,b){var h=a[0],e=a[1];a=a[2];var k=f[0],d=f[1];f=f[2];b[0]=e*f-a*d;b[1]=
a*k-h*f;b[2]=h*d-e*k;return b};a.lerp=function(a,f,b,h){var e=a[0],k=a[1];a=a[2];h[0]=e+b*(f[0]-e);h[1]=k+b*(f[1]-k);h[2]=a+b*(f[2]-a);return h};a.random=function(a,f){a=a||1;var b=2*h()*Math.PI,l=2*h()-1,e=Math.sqrt(1-l*l)*a;f[0]=Math.cos(b)*e;f[1]=Math.sin(b)*e;f[2]=l*a;return f};a.transformMat4=function(a,f,b){var h=a[0],e=a[1];a=a[2];var k=f[3]*h+f[7]*e+f[11]*a+f[15],k=k||1;b[0]=(f[0]*h+f[4]*e+f[8]*a+f[12])/k;b[1]=(f[1]*h+f[5]*e+f[9]*a+f[13])/k;b[2]=(f[2]*h+f[6]*e+f[10]*a+f[14])/k;return b};a.transformMat3=
function(a,f,b){var h=a[0],e=a[1];a=a[2];b[0]=h*f[0]+e*f[3]+a*f[6];b[1]=h*f[1]+e*f[4]+a*f[7];b[2]=h*f[2]+e*f[5]+a*f[8];return b};a.transformQuat=function(a,f,b){var h=a[0],e=a[1],k=a[2];a=f[0];var d=f[1],r=f[2];f=f[3];var x=f*h+d*k-r*e,n=f*e+r*h-a*k,t=f*k+a*e-d*h,h=-a*h-d*e-r*k;b[0]=x*f+h*-a+n*-r-t*-d;b[1]=n*f+h*-d+t*-a-x*-r;b[2]=t*f+h*-r+x*-d-n*-a;return b};a.rotateX=function(a,f,b,h){var e=[],k=[];e[0]=a[0]-f[0];e[1]=a[1]-f[1];e[2]=a[2]-f[2];k[0]=e[0];k[1]=e[1]*Math.cos(b)-e[2]*Math.sin(b);k[2]=
e[1]*Math.sin(b)+e[2]*Math.cos(b);h[0]=k[0]+f[0];h[1]=k[1]+f[1];h[2]=k[2]+f[2];return h};a.rotateY=function(a,f,b,h){var e=[],k=[];e[0]=a[0]-f[0];e[1]=a[1]-f[1];e[2]=a[2]-f[2];k[0]=e[2]*Math.sin(b)+e[0]*Math.cos(b);k[1]=e[1];k[2]=e[2]*Math.cos(b)-e[0]*Math.sin(b);h[0]=k[0]+f[0];h[1]=k[1]+f[1];h[2]=k[2]+f[2];return h};a.rotateZ=function(a,f,b,h){var e=[],k=[];e[0]=a[0]-f[0];e[1]=a[1]-f[1];e[2]=a[2]-f[2];k[0]=e[0]*Math.cos(b)-e[1]*Math.sin(b);k[1]=e[0]*Math.sin(b)+e[1]*Math.cos(b);k[2]=e[2];h[0]=k[0]+
f[0];h[1]=k[1]+f[1];h[2]=k[2]+f[2];return h};a.forEach=function(){var c=a.create();return function(a,b,h,e,k,d){b||(b=3);h||(h=0);for(e=e?Math.min(e*b+h,a.length):a.length;h<e;h+=b)c[0]=a[h],c[1]=a[h+1],c[2]=a[h+2],k(c,d,c),a[h]=c[0],a[h+1]=c[1],a[h+2]=c[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var f=new p(4);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f};a.fromValues=function(a,f,b,h){var e=new p(4);e[0]=a;e[1]=f;e[2]=b;e[3]=h;return e};a.copy=function(a,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];return f};a.set=function(a,f,b,h,e){e[0]=a;e[1]=f;e[2]=b;e[3]=h;return e};a.add=function(a,f,b){b[0]=
a[0]+f[0];b[1]=a[1]+f[1];b[2]=a[2]+f[2];b[3]=a[3]+f[3];return b};a.subtract=function(a,f,b){b[0]=a[0]-f[0];b[1]=a[1]-f[1];b[2]=a[2]-f[2];b[3]=a[3]-f[3];return b};a.sub=a.subtract;a.multiply=function(a,f,b){b[0]=a[0]*f[0];b[1]=a[1]*f[1];b[2]=a[2]*f[2];b[3]=a[3]*f[3];return b};a.mul=a.multiply;a.divide=function(a,f,b){b[0]=a[0]/f[0];b[1]=a[1]/f[1];b[2]=a[2]/f[2];b[3]=a[3]/f[3];return b};a.div=a.divide;a.min=function(a,f,b){b[0]=Math.min(a[0],f[0]);b[1]=Math.min(a[1],f[1]);b[2]=Math.min(a[2],f[2]);b[3]=
Math.min(a[3],f[3]);return b};a.max=function(a,f,b){b[0]=Math.max(a[0],f[0]);b[1]=Math.max(a[1],f[1]);b[2]=Math.max(a[2],f[2]);b[3]=Math.max(a[3],f[3]);return b};a.scale=function(a,f,b){b[0]=a[0]*f;b[1]=a[1]*f;b[2]=a[2]*f;b[3]=a[3]*f;return b};a.scaleAndAdd=function(a,f,b,h){h[0]=a[0]+f[0]*b;h[1]=a[1]+f[1]*b;h[2]=a[2]+f[2]*b;h[3]=a[3]+f[3]*b;return h};a.distance=function(a,f){var b=f[0]-a[0],h=f[1]-a[1],e=f[2]-a[2],k=f[3]-a[3];return Math.sqrt(b*b+h*h+e*e+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,f){var b=f[0]-a[0],h=f[1]-a[1],e=f[2]-a[2],k=f[3]-a[3];return b*b+h*h+e*e+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var f=a[0],b=a[1],h=a[2];a=a[3];return Math.sqrt(f*f+b*b+h*h+a*a)};a.len=a.length;a.squaredLength=function(a){var f=a[0],b=a[1],h=a[2];a=a[3];return f*f+b*b+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,f){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];f[3]=-a[3];return f};a.inverse=function(a,f){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];f[3]=1/a[3];return f};a.normalize=
function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],b=b*b+h*h+e*e+k*k;0<b&&(b=1/Math.sqrt(b),f[0]=a[0]*b,f[1]=a[1]*b,f[2]=a[2]*b,f[3]=a[3]*b);return f};a.dot=function(a,f){return a[0]*f[0]+a[1]*f[1]+a[2]*f[2]+a[3]*f[3]};a.lerp=function(a,f,b,h){var e=a[0],k=a[1],d=a[2];a=a[3];h[0]=e+b*(f[0]-e);h[1]=k+b*(f[1]-k);h[2]=d+b*(f[2]-d);h[3]=a+b*(f[3]-a);return h};a.random=function(c,f){c=c||1;f[0]=h();f[1]=h();f[2]=h();f[3]=h();a.normalize(f,f);a.scale(f,c,f);return f};a.transformMat4=function(a,f,b){var h=a[0],
e=a[1],k=a[2];a=a[3];b[0]=f[0]*h+f[4]*e+f[8]*k+f[12]*a;b[1]=f[1]*h+f[5]*e+f[9]*k+f[13]*a;b[2]=f[2]*h+f[6]*e+f[10]*k+f[14]*a;b[3]=f[3]*h+f[7]*e+f[11]*k+f[15]*a;return b};a.transformQuat=function(a,f,b){var h=a[0],e=a[1],k=a[2];a=f[0];var d=f[1],r=f[2];f=f[3];var x=f*h+d*k-r*e,n=f*e+r*h-a*k,t=f*k+a*e-d*h,h=-a*h-d*e-r*k;b[0]=x*f+h*-a+n*-r-t*-d;b[1]=n*f+h*-d+t*-a-x*-r;b[2]=t*f+h*-r+x*-d-n*-a;return b};a.forEach=function(){var c=a.create();return function(a,b,h,e,k,d){b||(b=4);h||(h=0);for(e=e?Math.min(e*
b+h,a.length):a.length;h<e;h+=b)c[0]=a[h],c[1]=a[h+1],c[2]=a[h+2],c[3]=a[h+3],k(c,d,c),a[h]=c[0],a[h+1]=c[1],a[h+2]=c[2],a[h+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var h=p("vec3"),c=p("vec4"),f=p("mat3"),b="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new b(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=h.create(),c=h.fromValues(1,0,0),f=h.fromValues(0,1,0);return function(d,r,x){var n=h.dot(d,r);if(-.9999999>n)return h.cross(c,d,b),1E-6>h.length(b)&&h.cross(f,d,b),h.normalize(b,b),a.setAxisAngle(b,Math.PI,x),x;if(.9999999<n)return x[0]=0,x[1]=0,x[2]=0,x[3]=1,x;h.cross(d,
r,b);x[0]=b[0];x[1]=b[1];x[2]=b[2];x[3]=1+n;return a.normalize(x,x)}}();a.setAxes=function(){var b=f.create();return function(c,f,d,h){b[0]=f[0];b[3]=f[1];b[6]=f[2];b[1]=d[0];b[4]=d[1];b[7]=d[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,h),h)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],f=a[1],h=a[2];a=a[3];var n=b[0],t=b[1],w=b[2];b=b[3];c[0]=d*b+a*n+f*w-h*t;c[1]=f*b+a*t+h*n-d*w;c[2]=h*b+a*w+d*t-f*n;c[3]=a*b-d*n-f*t-h*w;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],f=a[1],h=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*n;c[1]=f*b+h*n;c[2]=h*b-f*n;c[3]=a*b-d*n;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],f=a[1],h=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*
b-h*n;c[1]=f*b+a*n;c[2]=h*b+d*n;c[3]=a*b-f*n;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],f=a[1],h=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+f*n;c[1]=f*b-d*n;c[2]=h*b+a*n;c[3]=a*b-h*n;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],f=a[2];b[0]=c;b[1]=d;b[2]=f;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-f*f));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var f=a[0],h=a[1],n=a[2];a=a[3];var t=b[0],w=b[1],B=b[2];b=b[3];var q,s,y;s=f*t+h*w+n*B+a*b;0>s&&(s=-s,t=-t,w=-w,
B=-B,b=-b);1E-6<1-s?(q=Math.acos(s),y=Math.sin(q),s=Math.sin((1-c)*q)/y,c=Math.sin(c*q)/y):s=1-c;d[0]=s*f+c*t;d[1]=s*h+c*w;d[2]=s*n+c*B;d[3]=s*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],f=a[2],h=a[3],n=c*c+d*d+f*f+h*h,n=n?1/n:0;b[0]=-c*n;b[1]=-d*n;b[2]=-f*n;b[3]=h*n;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var f=(d+1)%3,h=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*f+f]-a[3*h+h]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*f+h]-a[3*h+f])*c;b[f]=(a[3*f+d]+a[3*d+f])*c;b[h]=(a[3*h+d]+a[3*d+h])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new p(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var f=a[1],b=a[2],l=a[5];c[1]=a[3];c[2]=a[6];c[3]=f;c[5]=a[7];c[6]=b;c[7]=l}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=a[4],d=a[5],r=a[6],x=a[7],n=a[8],t=n*k-d*x,w=-n*e+d*r,B=
x*e-k*r,q=f*t+b*w+l*B;if(!q)return null;q=1/q;c[0]=t*q;c[1]=(-n*b+l*x)*q;c[2]=(d*b-l*k)*q;c[3]=w*q;c[4]=(n*f-l*r)*q;c[5]=(-d*f+l*e)*q;c[6]=B*q;c[7]=(-x*f+b*r)*q;c[8]=(k*f-b*e)*q;return c};a.adjoint=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=a[4],d=a[5],r=a[6],x=a[7],n=a[8];c[0]=k*n-d*x;c[1]=l*x-b*n;c[2]=b*d-l*k;c[3]=d*r-e*n;c[4]=f*n-l*r;c[5]=l*e-f*d;c[6]=e*x-k*r;c[7]=b*r-f*x;c[8]=f*k-b*e;return c};a.determinant=function(a){var c=a[3],f=a[4],b=a[5],l=a[6],e=a[7],k=a[8];return a[0]*(k*f-b*e)+a[1]*
(-k*c+b*l)+a[2]*(e*c-f*l)};a.multiply=function(a,c,f){var b=a[0],l=a[1],e=a[2],k=a[3],d=a[4],r=a[5],x=a[6],n=a[7];a=a[8];var t=c[0],w=c[1],B=c[2],q=c[3],s=c[4],y=c[5],g=c[6],A=c[7];c=c[8];f[0]=t*b+w*k+B*x;f[1]=t*l+w*d+B*n;f[2]=t*e+w*r+B*a;f[3]=q*b+s*k+y*x;f[4]=q*l+s*d+y*n;f[5]=q*e+s*r+y*a;f[6]=g*b+A*k+c*x;f[7]=g*l+A*d+c*n;f[8]=g*e+A*r+c*a;return f};a.mul=a.multiply;a.translate=function(a,c,f){var b=a[0],l=a[1],e=a[2],k=a[3],d=a[4],r=a[5],x=a[6],n=a[7];a=a[8];var t=c[0];c=c[1];f[0]=b;f[1]=l;f[2]=e;
f[3]=k;f[4]=d;f[5]=r;f[6]=t*b+c*k+x;f[7]=t*l+c*d+n;f[8]=t*e+c*r+a;return f};a.rotate=function(a,c,f){var b=a[0],l=a[1],e=a[2],k=a[3],d=a[4],r=a[5],x=a[6],n=a[7];a=a[8];var t=Math.sin(c);c=Math.cos(c);f[0]=c*b+t*k;f[1]=c*l+t*d;f[2]=c*e+t*r;f[3]=c*k-t*b;f[4]=c*d-t*l;f[5]=c*r-t*e;f[6]=x;f[7]=n;f[8]=a;return f};a.scale=function(a,c,f){var b=c[0];c=c[1];f[0]=b*a[0];f[1]=b*a[1];f[2]=b*a[2];f[3]=c*a[3];f[4]=c*a[4];f[5]=c*a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];return f};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=f+f,d=b+b,r=l+l,f=f*k,x=b*k,b=b*d,n=l*k,t=l*d,l=l*r,k=e*k,d=e*d,e=e*r;c[0]=1-b-l;c[3]=x-e;c[6]=n+d;c[1]=x+e;c[4]=1-f-l;c[7]=t-k;c[2]=n-d;c[5]=t+k;c[8]=1-f-b;return c};a.normalFromMat4=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=a[4],d=a[5],r=a[6],x=a[7],n=a[8],t=a[9],w=a[10],B=a[11],q=a[12],s=a[13],y=a[14],g=a[15],A=f*d-b*k,u=f*r-l*k,p=f*x-e*k,I=b*r-l*d,v=b*x-
e*d,K=l*x-e*r,m=n*s-t*q,H=n*y-w*q,n=n*g-B*q,D=t*y-w*s,t=t*g-B*s,w=w*g-B*y,B=A*w-u*t+p*D+I*n-v*H+K*m;if(!B)return null;B=1/B;c[0]=(d*w-r*t+x*D)*B;c[1]=(r*n-k*w-x*H)*B;c[2]=(k*t-d*n+x*m)*B;c[3]=(l*t-b*w-e*D)*B;c[4]=(f*w-l*n+e*H)*B;c[5]=(b*n-f*t-e*m)*B;c[6]=(s*K-y*v+g*I)*B;c[7]=(y*p-q*K-g*u)*B;c[8]=(q*v-s*p+g*A)*B;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.hv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new p(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var f=a[1],b=a[2],l=a[3],e=a[6],k=a[7],d=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=f;c[6]=a[9];c[7]=a[13];c[8]=b;c[9]=e;c[11]=a[14];c[12]=l;c[13]=k;
c[14]=d}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=a[4],d=a[5],r=a[6],x=a[7],n=a[8],t=a[9],w=a[10],B=a[11],q=a[12],s=a[13],y=a[14],g=a[15],A=f*d-b*k,u=f*r-l*k,p=f*x-e*k,I=b*r-l*d,v=b*x-e*d,K=l*x-e*r,m=n*s-t*q,H=n*y-w*q,D=n*g-B*q,U=t*y-w*s,P=t*g-B*s,Z=w*g-B*y,V=A*Z-u*P+p*U+I*D-v*H+K*m;if(!V)return null;
V=1/V;c[0]=(d*Z-r*P+x*U)*V;c[1]=(l*P-b*Z-e*U)*V;c[2]=(s*K-y*v+g*I)*V;c[3]=(w*v-t*K-B*I)*V;c[4]=(r*D-k*Z-x*H)*V;c[5]=(f*Z-l*D+e*H)*V;c[6]=(y*p-q*K-g*u)*V;c[7]=(n*K-w*p+B*u)*V;c[8]=(k*P-d*D+x*m)*V;c[9]=(b*D-f*P-e*m)*V;c[10]=(q*v-s*p+g*A)*V;c[11]=(t*p-n*v-B*A)*V;c[12]=(d*H-k*U-r*m)*V;c[13]=(f*U-b*H+l*m)*V;c[14]=(s*u-q*I-y*A)*V;c[15]=(n*I-t*u+w*A)*V;return c};a.adjoint=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=a[4],d=a[5],r=a[6],x=a[7],n=a[8],t=a[9],w=a[10],B=a[11],q=a[12],s=a[13],y=a[14],g=a[15];
c[0]=d*(w*g-B*y)-t*(r*g-x*y)+s*(r*B-x*w);c[1]=-(b*(w*g-B*y)-t*(l*g-e*y)+s*(l*B-e*w));c[2]=b*(r*g-x*y)-d*(l*g-e*y)+s*(l*x-e*r);c[3]=-(b*(r*B-x*w)-d*(l*B-e*w)+t*(l*x-e*r));c[4]=-(k*(w*g-B*y)-n*(r*g-x*y)+q*(r*B-x*w));c[5]=f*(w*g-B*y)-n*(l*g-e*y)+q*(l*B-e*w);c[6]=-(f*(r*g-x*y)-k*(l*g-e*y)+q*(l*x-e*r));c[7]=f*(r*B-x*w)-k*(l*B-e*w)+n*(l*x-e*r);c[8]=k*(t*g-B*s)-n*(d*g-x*s)+q*(d*B-x*t);c[9]=-(f*(t*g-B*s)-n*(b*g-e*s)+q*(b*B-e*t));c[10]=f*(d*g-x*s)-k*(b*g-e*s)+q*(b*x-e*d);c[11]=-(f*(d*B-x*t)-k*(b*B-e*t)+n*
(b*x-e*d));c[12]=-(k*(t*y-w*s)-n*(d*y-r*s)+q*(d*w-r*t));c[13]=f*(t*y-w*s)-n*(b*y-l*s)+q*(b*w-l*t);c[14]=-(f*(d*y-r*s)-k*(b*y-l*s)+q*(b*r-l*d));c[15]=f*(d*w-r*t)-k*(b*w-l*t)+n*(b*r-l*d);return c};a.determinant=function(a){var c=a[0],f=a[1],b=a[2],l=a[3],e=a[4],k=a[5],d=a[6],r=a[7],x=a[8],n=a[9],t=a[10],w=a[11],B=a[12],q=a[13],s=a[14];a=a[15];return(c*k-f*e)*(t*a-w*s)-(c*d-b*e)*(n*a-w*q)+(c*r-l*e)*(n*s-t*q)+(f*d-b*k)*(x*a-w*B)-(f*r-l*k)*(x*s-t*B)+(b*r-l*d)*(x*q-n*B)};a.multiply=function(a,c,f){var b=
a[0],l=a[1],e=a[2],k=a[3],d=a[4],r=a[5],x=a[6],n=a[7],t=a[8],w=a[9],B=a[10],q=a[11],s=a[12],y=a[13],g=a[14];a=a[15];var A=c[0],u=c[1],p=c[2],I=c[3];f[0]=A*b+u*d+p*t+I*s;f[1]=A*l+u*r+p*w+I*y;f[2]=A*e+u*x+p*B+I*g;f[3]=A*k+u*n+p*q+I*a;A=c[4];u=c[5];p=c[6];I=c[7];f[4]=A*b+u*d+p*t+I*s;f[5]=A*l+u*r+p*w+I*y;f[6]=A*e+u*x+p*B+I*g;f[7]=A*k+u*n+p*q+I*a;A=c[8];u=c[9];p=c[10];I=c[11];f[8]=A*b+u*d+p*t+I*s;f[9]=A*l+u*r+p*w+I*y;f[10]=A*e+u*x+p*B+I*g;f[11]=A*k+u*n+p*q+I*a;A=c[12];u=c[13];p=c[14];I=c[15];f[12]=A*b+
u*d+p*t+I*s;f[13]=A*l+u*r+p*w+I*y;f[14]=A*e+u*x+p*B+I*g;f[15]=A*k+u*n+p*q+I*a;return f};a.mul=a.multiply;a.translate=function(a,c,f){var b=c[0],l=c[1];c=c[2];var e,k,d,r,x,n,t,w,B,q,s,y;a===f?(f[12]=a[0]*b+a[4]*l+a[8]*c+a[12],f[13]=a[1]*b+a[5]*l+a[9]*c+a[13],f[14]=a[2]*b+a[6]*l+a[10]*c+a[14],f[15]=a[3]*b+a[7]*l+a[11]*c+a[15]):(e=a[0],k=a[1],d=a[2],r=a[3],x=a[4],n=a[5],t=a[6],w=a[7],B=a[8],q=a[9],s=a[10],y=a[11],f[0]=e,f[1]=k,f[2]=d,f[3]=r,f[4]=x,f[5]=n,f[6]=t,f[7]=w,f[8]=B,f[9]=q,f[10]=s,f[11]=y,
f[12]=e*b+x*l+B*c+a[12],f[13]=k*b+n*l+q*c+a[13],f[14]=d*b+t*l+s*c+a[14],f[15]=r*b+w*l+y*c+a[15]);return f};a.scale=function(a,c,f){var b=c[0],l=c[1];c=c[2];f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;f[4]=a[4]*l;f[5]=a[5]*l;f[6]=a[6]*l;f[7]=a[7]*l;f[8]=a[8]*c;f[9]=a[9]*c;f[10]=a[10]*c;f[11]=a[11]*c;f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};a.rotate=function(a,c,f,b){var l=f[0],e=f[1];f=f[2];var k=Math.sqrt(l*l+e*e+f*f),d,r,x,n,t,w,B,q,s,y,g,A,u,p,I,v,K,m,H,D;if(1E-7>Math.abs(k))return null;
k=1/k;l*=k;e*=k;f*=k;d=Math.sin(c);r=Math.cos(c);x=1-r;c=a[0];k=a[1];n=a[2];t=a[3];w=a[4];B=a[5];q=a[6];s=a[7];y=a[8];g=a[9];A=a[10];u=a[11];p=l*l*x+r;I=e*l*x+f*d;v=f*l*x-e*d;K=l*e*x-f*d;m=e*e*x+r;H=f*e*x+l*d;D=l*f*x+e*d;l=e*f*x-l*d;e=f*f*x+r;b[0]=c*p+w*I+y*v;b[1]=k*p+B*I+g*v;b[2]=n*p+q*I+A*v;b[3]=t*p+s*I+u*v;b[4]=c*K+w*m+y*H;b[5]=k*K+B*m+g*H;b[6]=n*K+q*m+A*H;b[7]=t*K+s*m+u*H;b[8]=c*D+w*l+y*e;b[9]=k*D+B*l+g*e;b[10]=n*D+q*l+A*e;b[11]=t*D+s*l+u*e;a!==b&&(b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);
return b};a.rotateX=function(a,c,f){var b=Math.sin(c);c=Math.cos(c);var l=a[4],e=a[5],k=a[6],d=a[7],r=a[8],x=a[9],n=a[10],t=a[11];a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[4]=l*c+r*b;f[5]=e*c+x*b;f[6]=k*c+n*b;f[7]=d*c+t*b;f[8]=r*c-l*b;f[9]=x*c-e*b;f[10]=n*c-k*b;f[11]=t*c-d*b;return f};a.rotateY=function(a,c,f){var b=Math.sin(c);c=Math.cos(c);var l=a[0],e=a[1],k=a[2],d=a[3],r=a[8],x=a[9],n=a[10],t=a[11];a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],
f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=l*c-r*b;f[1]=e*c-x*b;f[2]=k*c-n*b;f[3]=d*c-t*b;f[8]=l*b+r*c;f[9]=e*b+x*c;f[10]=k*b+n*c;f[11]=d*b+t*c;return f};a.rotateZ=function(a,c,f){var b=Math.sin(c);c=Math.cos(c);var l=a[0],e=a[1],k=a[2],d=a[3],r=a[4],x=a[5],n=a[6],t=a[7];a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=l*c+r*b;f[1]=e*c+x*b;f[2]=k*c+n*b;f[3]=d*c+t*b;f[4]=r*c-l*b;f[5]=x*c-e*b;f[6]=n*c-k*b;f[7]=t*c-d*b;return f};
a.fromRotationTranslation=function(a,c,f){var b=a[0],l=a[1],e=a[2],k=a[3],d=b+b,r=l+l,x=e+e;a=b*d;var n=b*r,b=b*x,t=l*r,l=l*x,e=e*x,d=k*d,r=k*r,k=k*x;f[0]=1-(t+e);f[1]=n+k;f[2]=b-r;f[3]=0;f[4]=n-k;f[5]=1-(a+e);f[6]=l+d;f[7]=0;f[8]=b+r;f[9]=l-d;f[10]=1-(a+t);f[11]=0;f[12]=c[0];f[13]=c[1];f[14]=c[2];f[15]=1;return f};a.fromQuat=function(a,c){var f=a[0],b=a[1],l=a[2],e=a[3],k=f+f,d=b+b,r=l+l,f=f*k,x=b*k,b=b*d,n=l*k,t=l*d,l=l*r,k=e*k,d=e*d,e=e*r;c[0]=1-b-l;c[1]=x+e;c[2]=n-d;c[3]=0;c[4]=x-e;c[5]=1-f-l;
c[6]=t+k;c[7]=0;c[8]=n+d;c[9]=t-k;c[10]=1-f-b;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,f,b,l,e,k){var d=1/(c-a),r=1/(b-f),x=1/(l-e);k[0]=2*l*d;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*l*r;k[6]=0;k[7]=0;k[8]=(c+a)*d;k[9]=(b+f)*r;k[10]=(e+l)*x;k[11]=-1;k[12]=0;k[13]=0;k[14]=e*l*2*x;k[15]=0;return k};a.perspective=function(a,c,f,b,l){a=1/Math.tan(a/2);var e=1/(f-b);l[0]=a/c;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(b+f)*e;l[11]=-1;l[12]=0;l[13]=0;
l[14]=2*b*f*e;l[15]=0;return l};a.ortho=function(a,c,f,b,l,e,k){var d=1/(a-c),r=1/(f-b),x=1/(l-e);k[0]=-2*d;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*r;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*x;k[11]=0;k[12]=(a+c)*d;k[13]=(b+f)*r;k[14]=(e+l)*x;k[15]=1;return k};a.lookAt=function(h,c,f,b){var l,e,k,d,r,x,n,t,w=h[0],B=h[1];h=h[2];k=f[0];d=f[1];e=f[2];n=c[0];f=c[1];l=c[2];if(1E-7>Math.abs(w-n)&&1E-7>Math.abs(B-f)&&1E-7>Math.abs(h-l))return a.identity(b);c=w-n;f=B-f;n=h-l;t=1/Math.sqrt(c*c+f*f+n*n);c*=t;f*=t;n*=
t;l=d*n-e*f;e=e*c-k*n;k=k*f-d*c;(t=Math.sqrt(l*l+e*e+k*k))?(t=1/t,l*=t,e*=t,k*=t):k=e=l=0;d=f*k-n*e;r=n*l-c*k;x=c*e-f*l;(t=Math.sqrt(d*d+r*r+x*x))?(t=1/t,d*=t,r*=t,x*=t):x=r=d=0;b[0]=l;b[1]=d;b[2]=c;b[3]=0;b[4]=e;b[5]=r;b[6]=f;b[7]=0;b[8]=k;b[9]=x;b[10]=n;b[11]=0;b[12]=-(l*w+e*B+k*h);b[13]=-(d*w+r*B+x*h);b[14]=-(c*w+f*B+n*h);b[15]=1;return b};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.hv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};
b4w.module.__gpp_eval=function(a){a.$p=function(){function a(h,c,f,b,l,e){this.message=h;this.offset=b;this.xh=l;this.Mf=e;this.name="SyntaxError"}(function(a,c){function f(){this.constructor=a}f.prototype=c.prototype;a.prototype=new f})(a,Error);return{SyntaxError:a,parse:function(h){function c(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function f(a){if(N!==a){N>a&&(N=0,wa={xh:1,Mf:1,Th:!1});var b=wa,c,d;for(c=N;c<
a;c++)d=h.charAt(c),"\n"===d?(b.Th||b.xh++,b.Mf=1,b.Th=!1):"\r"===d||"\u2028"===d||"\u2029"===d?(b.xh++,b.Mf=1,b.Th=!0):(b.Mf++,b.Th=!1);N=a}return wa}function b(a){R<oa||(R>oa&&(oa=R,Ua=[]),Ua.push(a))}function l(){var a,c,d;a=R;c=z();c!==G?(c=e(),c!==G?(d=z(),d!==G?(ka++,10===h.charCodeAt(R)?(d=jc,R++):(d=G,0===ka&&b(Xa)),d===G&&(h.substr(R,2)===bc?(d=bc,R+=2):(d=G,0===ka&&b(Kb)),d===G&&(13===h.charCodeAt(R)?(d=gc,R++):(d=G,0===ka&&b(va)))),ka--,d===G&&0===ka&&b(Xb),d===G&&(d=J),d!==G?a=c:(R=a,
a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C);return a}function e(){var a,c,d,e,g,f,m,q;a=R;c=k();if(c!==G){d=[];e=R;g=z();for(g!==G?(44===h.charCodeAt(R)?(f=ha,R++):(f=G,0===ka&&b(pa)),f!==G?(m=z(),m!==G?(q=k(),q!==G?e=[g,f,m,q]:(R=e,e=C)):(R=e,e=C)):(R=e,e=C)):(R=e,e=C);e!==G;)d.push(e),e=R,g=z(),g!==G?(44===h.charCodeAt(R)?(f=ha,R++):(f=G,0===ka&&b(pa)),f!==G?(m=z(),m!==G?(q=k(),q!==G?e=[g,f,m,q]:(R=e,e=C)):(R=e,e=C)):(R=e,e=C)):(R=e,e=C);d!==G?a=0==d.length?c:d[d.length-1]:(R=a,a=C)}else R=a,a=C;return a}
function k(){var a,c,g,f;a=R;c=d();c!==G?(g=z(),g!==G?(63===h.charCodeAt(R)?(g=la,R++):(g=G,0===ka&&b(Y)),g!==G?(g=z(),g!==G?(g=e(),g!==G?(f=z(),f!==G?(58===h.charCodeAt(R)?(f=ja,R++):(f=G,0===ka&&b(E)),f!==G?(f=z(),f!==G?(f=e(),f!==G?a=c?g:f:(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C);a===G&&(a=d());return a}function d(){var a,b,c,d,e,g,f,m;a=R;b=r();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=X(),g!==G?(f=z(),f!==G?(m=r(),m!==G?d=[e,g,f,m]:(R=d,d=
C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=X(),g!==G?(f=z(),f!==G?(m=r(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else R=a,a=C}else R=a,a=C;return a}function r(){var a,b,c,d,e,g,f,m;a=R;b=x();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=T(),g!==G?(f=z(),f!==G?(m=x(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=T(),g!==G?(f=z(),f!==G?(m=x(),m!==G?d=[e,g,f,m]:
(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else R=a,a=C}else R=a,a=C;return a}function x(){var a,b,c,d,e,g,f,m;a=R;b=n();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=Q(),g!==G?(f=z(),f!==G?(m=n(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=Q(),g!==G?(f=z(),f!==G?(m=n(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else R=a,a=C}else R=a,a=C;return a}
function n(){var a,b,c,d,e,g,f,m;a=R;b=t();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=M(),g!==G?(f=z(),f!==G?(m=t(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=M(),g!==G?(f=z(),f!==G?(m=t(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else R=a,a=C}else R=a,a=C;return a}function t(){var a,b,c,d,e,g,f,m;a=R;b=w();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=V(),g!==G?(f=z(),f!==G?(m=w(),m!==G?d=[e,
g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=V(),g!==G?(f=z(),f!==G?(m=w(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else R=a,a=C}else R=a,a=C;return a}function w(){var a,b,c,d,e,g,f,m;a=R;b=B();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=Z(),g!==G?(f=z(),f!==G?(m=B(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=Z(),g!==G?(f=z(),f!==G?(m=B(),m!==
G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else R=a,a=C}else R=a,a=C;return a}function B(){var a,b,c,d,e,g,f,m;a=R;b=q();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=P(),g!==G?(f=z(),f!==G?(m=q(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=P(),g!==G?(f=z(),f!==G?(m=q(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==
G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else R=a,a=C}else R=a,a=C;return a}function q(){var a,b,c,d,e,g,f,m;a=R;b=s();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=U(),g!==G?(f=z(),f!==G?(m=s(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=U(),g!==G?(f=z(),f!==G?(m=s(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,
b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else R=a,a=C}else R=a,a=C;return a}function s(){var a,b,c,d,e,g,f,m;a=R;b=y();if(b!==G){c=[];d=R;e=z();for(e!==G?(g=D(),g!==G?(f=z(),f!==G?(m=y(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(g=D(),g!==G?(f=z(),f!==G?(m=y(),m!==G?d=[e,g,f,m]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=
c[b][3]}else R=a,a=C}else R=a,a=C;return a}function y(){var a,b,c,d,e,f,m,k;a=R;b=g();if(b!==G){c=[];d=R;e=z();for(e!==G?(f=H(),f!==G?(m=z(),m!==G?(k=g(),k!==G?d=[e,f,m,k]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);d!==G;)c.push(d),d=R,e=z(),e!==G?(f=H(),f!==G?(m=z(),m!==G?(k=g(),k!==G?d=[e,f,m,k]:(R=d,d=C)):(R=d,d=C)):(R=d,d=C)):(R=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else R=a,a=C}else R=a,
a=C;return a}function g(){var a,d,e;a=R;h.substr(R,7)===ca?(d=ca,R+=7):(d=G,0===ka&&b(ua));d!==G?(e=z(),e!==G?(e=u(),e!==G?a=e:(R=a,a=C)):(R=a,a=C)):(R=a,a=C);if(a===G){a=R;d=A();if(d!==G)if(e=z(),e!==G)if(h.substr(R,2)===Ia?(e=Ia,R+=2):(e=G,0===ka&&b(Ta)),e===G&&(h.substr(R,2)===Wa?(e=Wa,R+=2):(e=G,0===ka&&b(tc))),e!==G){a:{a=d;switch(e){case "++":d=++a;break a;case "--":d=--a;break a}d=void 0}a=d}else R=a,a=C;else R=a,a=C;else R=a,a=C;a===G&&(a=A());a===G&&(a=R,h.substr(R,2)===Ia?(d=Ia,R+=2):(d=
G,0===ka&&b(Ta)),d===G&&(h.substr(R,2)===Wa?(d=Wa,R+=2):(d=G,0===ka&&b(tc)),d===G&&(43===h.charCodeAt(R)?(d=pb,R++):(d=G,0===ka&&b(uc)),d===G&&(45===h.charCodeAt(R)?(d=sb,R++):(d=G,0===ka&&b(Rb)),d===G&&(126===h.charCodeAt(R)?(d=ub,R++):(d=G,0===ka&&b(ud)),d===G&&(33===h.charCodeAt(R)?(d=nd,R++):(d=G,0===ka&&b(fc))))))),d!==G?(e=z(),e!==G?(e=g(),e!==G?a=c(d,e):(R=a,a=C)):(R=a,a=C)):(R=a,a=C))}return a}function A(){var a,c,d;ka++;var g;a=R;48===h.charCodeAt(R)?(c=Ha,R++):(c=G,0===ka&&b(Ja));if(c!==
G)if(Hb.test(h.charAt(R))?(c=h.charAt(R),R++):(c=G,0===ka&&b(Bb)),c!==G){c=R;d=[];g=I();if(g!==G)for(;g!==G;)d.push(g),g=I();else d=C;d!==G&&(d=h.substring(c,R));c=d;c!==G?a=c=parseInt("0x"+c):(R=a,a=C)}else R=a,a=C;else R=a,a=C;if(a===G){a=R;48===h.charCodeAt(R)?(c=Ha,R++):(c=G,0===ka&&b(Ja));if(c===G)if(c=R,zb.test(h.charAt(R))?(d=h.charAt(R),R++):(d=G,0===ka&&b(Ab)),d!==G){var f;g=[];f=S();if(f!==G)for(;f!==G;)g.push(f),f=S();else g=C;g===G&&(g=J);g!==G?c=d=[d,g]:(R=c,c=C)}else R=c,c=C;c!==G&&
(c=h.substring(a,R));a=c;a!==G&&(a=parseInt(a))}ka--;a===G&&0===ka&&b(ba);a===G&&(c=v(),c!==G&&(c=0),a=c,a===G&&(a=R,40===h.charCodeAt(R)?(c=ea,R++):(c=G,0===ka&&b(ma)),c!==G?(c=z(),c!==G?(c=e(),c!==G?(d=z(),d!==G?(41===h.charCodeAt(R)?(d=Aa,R++):(d=G,0===ka&&b(O)),d!==G?a=c:(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)));return a}function u(){var a,c,d,e,g;c=v();c!==G&&(c=0);a=c;if(a===G){c=[];e=d=R;ka++;40===h.charCodeAt(R)?(g=ea,R++):(g=G,0===ka&&b(ma));g===G&&(41===h.charCodeAt(R)?(g=
Aa,R++):(g=G,0===ka&&b(O)));ka--;g===G?e=Ea:(R=e,e=C);e!==G?(g=W(),g!==G?d=e=[e,g]:(R=d,d=C)):(R=d,d=C);if(d!==G)for(;d!==G;)c.push(d),e=d=R,ka++,40===h.charCodeAt(R)?(g=ea,R++):(g=G,0===ka&&b(ma)),g===G&&(41===h.charCodeAt(R)?(g=Aa,R++):(g=G,0===ka&&b(O))),ka--,g===G?e=Ea:(R=e,e=C),e!==G?(g=W(),g!==G?d=e=[e,g]:(R=d,d=C)):(R=d,d=C);else c=C;c!==G&&(c=1);a=c;a===G&&(a=R,40===h.charCodeAt(R)?(c=ea,R++):(c=G,0===ka&&b(ma)),c!==G?(d=z(),d!==G?(e=u(),e!==G?(g=z(),g!==G?(41===h.charCodeAt(R)?(c=Aa,R++):
(c=G,0===ka&&b(O)),c!==G?a=e:(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C)):(R=a,a=C))}return a}function S(){var a;ab.test(h.charAt(R))?(a=h.charAt(R),R++):(a=G,0===ka&&b(Ka));return a}function I(){var a;Za.test(h.charAt(R))?(a=h.charAt(R),R++):(a=G,0===ka&&b(lb));return a}function v(){var a,c;ka++;c=a=R;ka++;var d,e,g,f;d=R;h.substr(R,7)===ca?(e=ca,R+=7):(e=G,0===ka&&b(ua));e!==G?(g=R,ka++,f=m(),ka--,f===G?g=Ea:(R=g,g=C),g!==G?d=[e,g]:(R=d,d=C)):(R=d,d=C);ka--;d===G?c=Ea:(R=c,c=C);if(c!==G){ka++;c=
R;d=K();if(d!==G){e=[];for(g=m();g!==G;)e.push(g),g=m();e!==G?c=d+e.join(""):(R=c,c=C)}else R=c,c=C;ka--;c===G&&0===ka&&b(qb);c!==G?a=c:(R=a,a=C)}else R=a,a=C;ka--;a===G&&0===ka&&b(qb);return a}function K(){var a;Fa.test(h.charAt(R))?(a=h.charAt(R),R++):(a=G,0===ka&&b(Ma));a===G&&(36===h.charCodeAt(R)?(a=tb,R++):(a=G,0===ka&&b(kb)),a===G&&(95===h.charCodeAt(R)?(a=Na,R++):(a=G,0===ka&&b(La))));return a}function m(){var a;a=K();a===G&&(a=S());return a}function H(){var a,c,d,e;a=R;42===h.charCodeAt(R)?
(c=qd,R++):(c=G,0===ka&&b(ad));c===G&&(47===h.charCodeAt(R)?(c=nc,R++):(c=G,0===ka&&b(Pb)),c===G&&(37===h.charCodeAt(R)?(c=$b,R++):(c=G,0===ka&&b(cd))));c!==G?(d=R,ka++,61===h.charCodeAt(R)?(e=oc,R++):(e=G,0===ka&&b(Bc)),ka--,e===G?d=Ea:(R=d,d=C),d!==G?a=c:(R=a,a=C)):(R=a,a=C);return a}function D(){var a,c,d;a=R;43===h.charCodeAt(R)?(c=pb,R++):(c=G,0===ka&&b(uc));c!==G?(c=R,ka++,43===h.charCodeAt(R)?(d=pb,R++):(d=G,0===ka&&b(uc)),d===G&&(61===h.charCodeAt(R)?(d=oc,R++):(d=G,0===ka&&b(Bc))),ka--,d===
G?c=Ea:(R=c,c=C),c!==G?a="+":(R=a,a=C)):(R=a,a=C);a===G&&(a=R,45===h.charCodeAt(R)?(c=sb,R++):(c=G,0===ka&&b(Rb)),c!==G?(c=R,ka++,45===h.charCodeAt(R)?(d=sb,R++):(d=G,0===ka&&b(Rb)),d===G&&(61===h.charCodeAt(R)?(d=oc,R++):(d=G,0===ka&&b(Bc))),ka--,d===G?c=Ea:(R=c,c=C),c!==G?a="-":(R=a,a=C)):(R=a,a=C));return a}function U(){var a;h.substr(R,2)===ic?(a=ic,R+=2):(a=G,0===ka&&b(Sc));a===G&&(h.substr(R,2)===Ba?(a=Ba,R+=2):(a=G,0===ka&&b(Ib)));return a}function P(){var a;h.substr(R,2)===rb?(a=rb,R+=2):
(a=G,0===ka&&b(za));a===G&&(h.substr(R,2)===fb?(a=fb,R+=2):(a=G,0===ka&&b($)),a===G&&(60===h.charCodeAt(R)?(a=Qa,R++):(a=G,0===ka&&b(mb)),a===G&&(62===h.charCodeAt(R)?(a=ta,R++):(a=G,0===ka&&b(qa)))));return a}function Z(){var a;h.substr(R,2)===vb?(a=vb,R+=2):(a=G,0===ka&&b(xa));a===G&&(h.substr(R,2)===gb?(a=gb,R+=2):(a=G,0===ka&&b(ra)));return a}function V(){var a,c,d;a=R;38===h.charCodeAt(R)?(c=bb,R++):(c=G,0===ka&&b(Da));c!==G?(c=R,ka++,38===h.charCodeAt(R)?(d=bb,R++):(d=G,0===ka&&b(Da)),ka--,
d===G?c=Ea:(R=c,c=C),c!==G?a="&":(R=a,a=C)):(R=a,a=C);return a}function M(){var a,c,d;a=R;94===h.charCodeAt(R)?(c=nb,R++):(c=G,0===ka&&b(Jb));c!==G?(c=R,ka++,94===h.charCodeAt(R)?(d=nb,R++):(d=G,0===ka&&b(Jb)),ka--,d===G?c=Ea:(R=c,c=C),c!==G?a="^":(R=a,a=C)):(R=a,a=C);return a}function Q(){var a,c,d;a=R;124===h.charCodeAt(R)?(c=Cc,R++):(c=G,0===ka&&b(Vb));c!==G?(c=R,ka++,124===h.charCodeAt(R)?(d=Cc,R++):(d=G,0===ka&&b(Vb)),ka--,d===G?c=Ea:(R=c,c=C),c!==G?a="|":(R=a,a=C)):(R=a,a=C);return a}function T(){var a;
h.substr(R,2)===ac?(a=ac,R+=2):(a=G,0===ka&&b(pc));a!==G&&(a="&&");return a}function X(){var a;h.substr(R,2)===wb?(a=wb,R+=2):(a=G,0===ka&&b(Mb));a!==G&&(a="||");return a}function z(){var a,b;a=[];for(b=ia();b!==G;)a.push(b),b=ia();return a}function ia(){var a;ka++;Sb.test(h.charAt(R))?(a=h.charAt(R),R++):(a=G,0===ka&&b(hb));ka--;a===G&&0===ka&&b(Wb);return a}function W(){var a;h.length>R?(a=h.charAt(R),R++):(a=G,0===ka&&b(Oa));return a}var L=1<arguments.length?arguments[1]:{},G={},fa={start:l},da=
l,C=G,J=null,ha=",",pa={type:"literal",value:",",description:'","'},la="?",Y={type:"literal",value:"?",description:'"?"'},ja=":",E={type:"literal",value:":",description:'":"'},ca="defined",ua={type:"literal",value:"defined",description:'"defined"'},ea="(",ma={type:"literal",value:"(",description:'"("'},Aa=")",O={type:"literal",value:")",description:'")"'},Ea=void 0,ba={type:"other",description:"number"},Ha="0",Ja={type:"literal",value:"0",description:'"0"'},ab=/^[0-9]/,Ka={type:"class",value:"[0-9]",
description:"[0-9]"},zb=/^[1-9]/,Ab={type:"class",value:"[1-9]",description:"[1-9]"},Hb=/^[xX]/,Bb={type:"class",value:"[xX]",description:"[xX]"},Za=/^[0-9a-fA-F]/,lb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},qb={type:"other",description:"identifier"},tb="$",kb={type:"literal",value:"$",description:'"$"'},Na="_",La={type:"literal",value:"_",description:'"_"'},Fa=/^[a-zA-Z]/,Ma={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Ia="++",Ta={type:"literal",value:"++",description:'"++"'},
Wa="--",tc={type:"literal",value:"--",description:'"--"'},pb="+",uc={type:"literal",value:"+",description:'"+"'},sb="-",Rb={type:"literal",value:"-",description:'"-"'},ub="~",ud={type:"literal",value:"~",description:'"~"'},nd="!",fc={type:"literal",value:"!",description:'"!"'},qd="*",ad={type:"literal",value:"*",description:'"*"'},nc="/",Pb={type:"literal",value:"/",description:'"/"'},$b="%",cd={type:"literal",value:"%",description:'"%"'},oc="=",Bc={type:"literal",value:"=",description:'"="'},ic=
"<<",Sc={type:"literal",value:"<<",description:'"<<"'},Ba=">>",Ib={type:"literal",value:">>",description:'">>"'},rb="<=",za={type:"literal",value:"<=",description:'"<="'},fb=">=",$={type:"literal",value:">=",description:'">="'},Qa="<",mb={type:"literal",value:"<",description:'"<"'},ta=">",qa={type:"literal",value:">",description:'">"'},vb="==",xa={type:"literal",value:"==",description:'"=="'},gb="!=",ra={type:"literal",value:"!=",description:'"!="'},bb="&",Da={type:"literal",value:"&",description:'"&"'},
nb="^",Jb={type:"literal",value:"^",description:'"^"'},Cc="|",Vb={type:"literal",value:"|",description:'"|"'},ac="&&",pc={type:"literal",value:"&&",description:'"&&"'},wb="||",Mb={type:"literal",value:"||",description:'"||"'},Wb={type:"other",description:"whitespace"},Sb=/^[\t\x0B\f ]/,hb={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},Xb={type:"other",description:"end of line"},jc="\n",Xa={type:"literal",value:"\n",description:'"\\n"'},bc="\r\n",Kb={type:"literal",value:"\r\n",
description:'"\\r\\n"'},gc="\r",va={type:"literal",value:"\r",description:'"\\r"'},Oa={type:"any",description:"any character"},R=0,N=0,wa={xh:1,Mf:1,Th:!1},oa=0,Ua=[],ka=0,na;if("startRule"in L){if(!(L.Nq in fa))throw Error("Can't start parsing from rule \""+L.Nq+'".');da=fa[L.Nq]}na=da();if(na!==G&&R===h.length)return na;na!==G&&R<h.length&&b({type:"end",description:"end of input"});throw function(b,c,d){function e(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>
b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var m=f(d),k=d<h.length?h.charAt(d):null;null!==c&&e(c);return new a(null!==b?b:g(c,k),0,0,d,m.xh,m.Mf)}(null,Ua,oa);}}}()};
b4w.module.__md5=function(a){function p(a,k){var d=a[0],l=a[1],x=a[2],n=a[3],d=c(d,l,x,n,k[0],7,-680876936),n=c(n,d,l,x,k[1],12,-389564586),x=c(x,n,d,l,k[2],17,606105819),l=c(l,x,n,d,k[3],22,-1044525330),d=c(d,l,x,n,k[4],7,-176418897),n=c(n,d,l,x,k[5],12,1200080426),x=c(x,n,d,l,k[6],17,-1473231341),l=c(l,x,n,d,k[7],22,-45705983),d=c(d,l,x,n,k[8],7,1770035416),n=c(n,d,l,x,k[9],12,-1958414417),x=c(x,n,d,l,k[10],17,-42063),l=c(l,x,n,d,k[11],22,-1990404162),d=c(d,l,x,n,k[12],7,1804603682),n=c(n,d,l,x,
k[13],12,-40341101),x=c(x,n,d,l,k[14],17,-1502002290),l=c(l,x,n,d,k[15],22,1236535329),d=f(d,l,x,n,k[1],5,-165796510),n=f(n,d,l,x,k[6],9,-1069501632),x=f(x,n,d,l,k[11],14,643717713),l=f(l,x,n,d,k[0],20,-373897302),d=f(d,l,x,n,k[5],5,-701558691),n=f(n,d,l,x,k[10],9,38016083),x=f(x,n,d,l,k[15],14,-660478335),l=f(l,x,n,d,k[4],20,-405537848),d=f(d,l,x,n,k[9],5,568446438),n=f(n,d,l,x,k[14],9,-1019803690),x=f(x,n,d,l,k[3],14,-187363961),l=f(l,x,n,d,k[8],20,1163531501),d=f(d,l,x,n,k[13],5,-1444681467),n=
f(n,d,l,x,k[2],9,-51403784),x=f(x,n,d,l,k[7],14,1735328473),l=f(l,x,n,d,k[12],20,-1926607734),d=h(l^x^n,d,l,k[5],4,-378558),n=h(d^l^x,n,d,k[8],11,-2022574463),x=h(n^d^l,x,n,k[11],16,1839030562),l=h(x^n^d,l,x,k[14],23,-35309556),d=h(l^x^n,d,l,k[1],4,-1530992060),n=h(d^l^x,n,d,k[4],11,1272893353),x=h(n^d^l,x,n,k[7],16,-155497632),l=h(x^n^d,l,x,k[10],23,-1094730640),d=h(l^x^n,d,l,k[13],4,681279174),n=h(d^l^x,n,d,k[0],11,-358537222),x=h(n^d^l,x,n,k[3],16,-722521979),l=h(x^n^d,l,x,k[6],23,76029189),d=
h(l^x^n,d,l,k[9],4,-640364487),n=h(d^l^x,n,d,k[12],11,-421815835),x=h(n^d^l,x,n,k[15],16,530742520),l=h(x^n^d,l,x,k[2],23,-995338651),d=b(d,l,x,n,k[0],6,-198630844),n=b(n,d,l,x,k[7],10,1126891415),x=b(x,n,d,l,k[14],15,-1416354905),l=b(l,x,n,d,k[5],21,-57434055),d=b(d,l,x,n,k[12],6,1700485571),n=b(n,d,l,x,k[3],10,-1894986606),x=b(x,n,d,l,k[10],15,-1051523),l=b(l,x,n,d,k[1],21,-2054922799),d=b(d,l,x,n,k[8],6,1873313359),n=b(n,d,l,x,k[15],10,-30611744),x=b(x,n,d,l,k[6],15,-1560198380),l=b(l,x,n,d,k[13],
21,1309151649),d=b(d,l,x,n,k[4],6,-145523070),n=b(n,d,l,x,k[11],10,-1120210379),x=b(x,n,d,l,k[2],15,718787259),l=b(l,x,n,d,k[9],21,-343485551);a[0]=d+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=x+a[2]&4294967295;a[3]=n+a[3]&4294967295}function h(a,b,c,f,h,l){b=(b+a&4294967295)+(f+l&4294967295)&4294967295;return(b<<h|b>>>32-h)+c&4294967295}function c(a,b,c,f,l,n,t){return h(b&c|~b&f,a,b,l,n,t)}function f(a,b,c,f,l,n,t){return h(b&f|c&~f,a,b,l,n,t)}function b(a,b,c,f,l,n,t){return h(c^(b|~f),a,b,l,
n,t)}var l="0123456789abcdef".split("");a.bp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var f;for(f=64;f<=b.length;f+=64){for(var h=b.substring(f-64,f),n=[],t=void 0,t=0;64>t;t+=4)n[t>>2]=h.charCodeAt(t)+(h.charCodeAt(t+1)<<8)+(h.charCodeAt(t+2)<<16)+(h.charCodeAt(t+3)<<24);p(a,n)}b=b.substring(f-64);h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(f=0;f<b.length;f++)h[f>>2]|=b.charCodeAt(f)<<(f%4<<3);h[f>>2]|=128<<(f%4<<3);if(55<f)for(p(a,h),f=0;16>f;f++)h[f]=0;h[14]=8*
c;p(a,h);for(b=0;b<a.length;b++){c=a[b];f="";for(h=0;4>h;h++)f+=l[c>>8*h+4&15]+l[c>>8*h&15];a[b]=f}return a.join("")}};
b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cf = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cf = mix ( cf , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cg = vec3 ( 0.0 ) ; vec3 ch = vec3 ( 0.0 ) ; vec3 ci = vec3 ( 0.0 ) ; bn ( cf , cg , ch , ci ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","cj","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cj = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ck = ( u_model_matrix * vec4 ( cj , 1.0 ) ) . xyz ; mat4 cl = aa ( u_camera_eye , ck , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = ( u_model_matrix * vec4 ( cj , 1.0 ) ) . xyz ; cl = cl * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cm ) ;".split(" ")}]}}]},{type:"textline",b:"d cn = ah ( cf - cj , cj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cl ) ; cn . b = ck ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d cn = ah ( cf , cj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( cn . a , cn . b , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ak ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cn . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float fm = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float fm = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( fm < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cm ( cz ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fg ( cF . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",
b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",
";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cz",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 gp = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gp = mix ( gp , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gq = vec3 ( 0.0 ) ; vec3 gr = vec3 ( 0.0 ) ; vec3 gs = vec3 ( 0.0 ) ; bn ( gp , gq , gr , gs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||",
"BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gt","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gt = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gu = ga ( gp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gt , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gv = ( u_model_matrix * vec4 ( gt , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gw","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gw","=","u_view_matrix",
";"]}]}}]},{type:"textline",b:"mat4 gx = aa ( u_camera_eye , gv , gw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gy = ( u_model_matrix * vec4 ( gt , 1.0 ) ) . xyz ; gx = gx * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gy ) ;".split(" ")}]}}]},{type:"textline",b:"d gu = ah ( gp - gt , gt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gx ) ; gu . b = gv ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"d gu = ah ( gp , gt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gz","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( gu . a , gu . b , gz ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 gA = u_view_matrix * vec4 ( gu . a , 1.0 ) ; vec4 gB = u_proj_matrix * gA ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gB . xy += u_subpixel_jitter * gB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ak ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"textline",b:"gk ( gu . a ) ; cF = gA ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cz = - gA . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 gC = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gD = SHADOW_TEX_RES / 2.0 ; gC = floor ( gC * gD + 0.5 ) / gD - gC ; gB . xy += gC ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","gB",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gp",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gp",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gp , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4",
"u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gp",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gp",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")",
"{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gq = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gr = aa ( u_camera_eye , gq , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gr = gr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gs = ah ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gr ) ; gs . b = gq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d gs = ah ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gt = u_proj_matrix * u_view_matrix * vec4 ( gs . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gp = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["gp","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gp","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","gt",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gx ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gz = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gz = NUM_LINES ;".split(" ")}]}}]},{type:"textline",
b:"float gB ( float gA ) { return gA - floor ( gA * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gK ( inout float gC , in float gD [ gz ] , in float gE ) { for ( int gF = 0 ; gF < NUM_RINGS ; gF ++ ) { float gG = 40.0 * gD [ gF ] ; float gH = 300.0 * ( gB ( gG ) - 0.005 ) ; float gI = gG ; float gJ = abs ( gI * ( u_halo_size * gH - gE ) ) ; gC += 1.0 - min ( gJ , 1.0 ) ; } }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gT ( inout float gL , in float gM [ gz ] , in float gN ) { for ( int gO = 0 ; gO < NUM_LINES ; gO ++ ) { float gP = gM [ gO ] ; float gQ = gP ; float gR = 1000.0 * ( gB ( gP ) - 0.005 ) ; float gS = 20.0 * abs ( gQ * a . x + gR * a . y ) ; gL += 1.0 - min ( gS , 1.0 ) ; } gL *= gN ; }".split(" ")}]}}]},{type:"textline",b:"void g_ ( inout float gU , in vec2 gV ) { float gW , gX ; gX = atan ( gV . y , gV . x ) ; gX *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float gY = cos ( gX ) ; float gZ = sin ( gX ) ; gX = ( gY * gV . x + gZ * gV . y ) * ( gY * gV . y - gZ * gV . x ) ; gW = abs ( gX ) ; if ( gW < 1.0 ) { gW = ( 0.01 * u_halo_size ) / ( gW ) ; gU *= sqrt ( min ( gW , 1.0 ) ) ; } } void main ( ) { float ha = ( a . x * a . x + a . y * a . y ) ; float hb = sqrt ( ha ) ; ha = max ( 1.0 - ha , 0.0 ) ; ha = pow ( ha , u_halo_hardness ) ; float hc = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hd [ gz ] ; for ( int he = 0 ; he < gz ; he ++ ) { hd [ he ] = fract ( gy / ( float ( he ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hf = 0.0 ; gK ( hf , hd , hb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hg = 0.0 ; gT ( hg , hd , ha ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"g_ ( ha , a ) ;".split(" ")}]}}]},{type:"textline",b:"ha *= hc ; vec3 hh = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hf *= ha ; hh += u_halo_rings_color * hf ; ha += hf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hg *= hc ; hh += u_halo_lines_color * hg ; ha += hg ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ha *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hi = u_halo_stars_blend * ( gx . y - u_halo_stars_height ) ; ha *= clamp ( hi , 0.0 , 1.0 ) ; ha *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gt ( hh ) ; gw ( hh , ha ) ; gl_FragColor = vec4 ( hh , ha ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gy ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gx",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gz = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gy = fract ( gz . x + gz . y + gz . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gA = z ( gz , u_view_matrix ) ; mat4 gB = u_view_matrix ; gB [ 3 ] [ 0 ] = 0.0 ; gB [ 3 ] [ 1 ] = 0.0 ; gB [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gA = z ( gz , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gC = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gD = gA * gC ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gE = u_proj_matrix * gB * gD ; gE . z = 0.99999 * gE . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gx","=","gD",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gE = u_proj_matrix * u_view_matrix * gD ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gE",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gz = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gz , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kx ; varying vec3 ky ; varying vec3 kz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kB",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float ln = ky . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lo","=","a",";"]}]}}]},{type:"textline",b:["vec3","lp","=","kz",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lp = lp ; else lp = - lp ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lq = cross ( lp , kA . xyz ) * kA . w ; mat3 lr = mat3 ( kA . xyz , lq , lp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float ls = length ( cF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lt = normalize ( u_view_matrix_frag * vec4 ( kz , 0.0 ) ) . st ; lt = lt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( ls < PARALLAX_LOD_DIST ) { float lu = clamp ( 0.5 * ( PARALLAX_LOD_DIST - ls ) , 0.0 , 1.0 ) ; float lv = u_parallax_scale * lu ; vec3 lw = normalize ( kx * lr ) ; float lx = 1.0 / PARALLAX_STEPS ; vec2 ly = lw . xy * lv / ( PARALLAX_STEPS * lw . z ) ; float lz = 1.0 ; float lA ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lB","=","lt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lB","=","lo",";"]}]}}]},{type:"textline",b:"lA = texture2D ( u_normalmap0 , lB ) . a ; for ( float lC = 1.0 ; lC <= PARALLAX_STEPS ; lC ++ ) { if ( lA < lz ) { lz -= lx ; lB -= ly ; lA = texture2D ( u_normalmap0 , lB ) . a ; } } vec2 lD = lB + ly ; float lE = texture2D ( u_normalmap0 , lD ) . a - ( lz + lx ) ; float lF = lA - lz ; float lG = lF / ( lF - lE ) ; lB = lG * lD + ( 1.0 - lG ) * lB ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lo += lB - lt ;".split(" ")}]}}]},{type:"textline",b:["lt","=","lB",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lt += lB - lo ;".split(" ")}]}}]},{type:"textline",b:["lo","=","lB",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lH",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_normalmap0 , lt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_normalmap0 , lo ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lI = lH . rgb - 0.5 ; lI = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lI , u_normal_factor ) ; vec3 lJ = lr * lI ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lJ","=","lp",";"]}]}}]},{type:"textline",b:"lJ = normalize ( lJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lt = normalize ( u_view_matrix_frag * vec4 ( lJ , 0.0 ) ) . st ; lt = lt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lK = normalize ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lL = kB ; gr ( lL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lM = vec4 ( lL , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lM","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lN","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lO = texture2D ( u_colormap0 , lt ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lO = texture2D ( u_colormap0 , lo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gr ( lO . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","lP",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lP = texture2D ( u_colormap1 , lt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lP = texture2D ( u_colormap1 , lo ) ;".split(" ")}]}}]},{type:"textline",b:"gr ( lP . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 lQ = texture2D ( u_stencil0 , lt ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lQ = texture2D ( u_stencil0 , lo ) ;".split(" ")}]}}]},{type:"textline",b:"lO = mix ( lO , lP , lQ . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lM . rgb = mix ( lM . rgb , lO . rgb , u_diffuse_color_factor ) ; float lR = u_alpha_factor * lO . a ; lR += ( 1.0 - step ( 0.0 , lR ) ) ; lM . a = mix ( lR , 1.0 , u_diffuse_color . a ) ; lN = lO . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lM . rgb *= mix ( vec3 ( 1.0 ) , lO . rgb , u_diffuse_color_factor ) ; lM . a = lO . a ; lN = lO . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lS = u_diffuse_intensity * lM . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","lT","=","lS",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lU = 0.5 * lJ . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lV = u_environment_energy * textureCube ( u_sky_texture , lJ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lV = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lU ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lW = u_ambient * lV ; float lX = fl ( lS ) ; vec3 lY = u_emit * lM . rgb ; vec3 lZ = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 l_ = vec3 ( lN ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 l_ = texture2D ( u_specmap0 , lt ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 l_ = texture2D ( u_specmap0 , lo ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gr ( l_ . rgb ) ; lZ = mix ( lZ , l_ , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float ma = u_specular_params [ 0 ] ; vec2 mb = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mc = ma * lZ ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hp md = jW ( lY , lW , lS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp md = jR ( lY , lW , lS , mc , ky , lJ , lK , mb , u_diffuse_params , lX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , u_shadow_lamp_id ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 lT = md . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","me","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","me","=","0.0",";"]}]}}]},{type:"textline",b:"kZ ( lT , lK , lJ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , me ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lT += md . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lT = max ( lT - sqrt ( 0.01 * - min ( ln , 0.0 ) ) , 0.5 * lT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kw ( lT , ln , u_time , lX , lJ , u_sun_direction , u_sun_intensity , u_sun_quaternion , ky , ls ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mf = lM . a ; if ( mf <= 0.5 ) discard ; mf = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mf = lM . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mf += md . a . a * mc . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mf","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lT = mix ( lm ( cE , lJ . xz * u_refr_bump ) , lT , mf ) ; mf = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mg = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mh = gL ( u_cube_fog , lK ) ; vec4 mi = vec4 ( mh , u_fog_color_density . a ) ; gr ( mi . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mi = u_fog_color_density ; mi . rgb *= mg ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hd ( lT , ls , lK , u_cam_water_depth , u_underwater_fog_color_density , mi , ln , mg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gE ( lT , ls , mi ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"lT = vec3 ( dN . a ) ;".split(" ")}]}}]},{type:"textline",b:["gt","(","lT",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gw ( lT , mf ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lT , mf ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kx ; varying vec3 ky ; varying vec3 kz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kB",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 ln = a_position ; vec3 lo = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lp = vec3 ( a_tangent ) ; vec3 lq = a_tangent [ 3 ] * cross ( lo , lp ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lr = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 ls = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lt = lr - u_camera_eye ; vec3 lq = cross ( lt , ls ) ; vec3 lp = cross ( ls , lq ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lp = vec3 ( 0.0 ) ; vec3 lq = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ln = mix ( ln , a_position_next , u_va_frame_factor ) ; lo = mix ( lo , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lu = vec3 ( a_tangent ) ; vec3 lv = a_tangent_next [ 3 ] * cross ( a_normal_next , lu ) ; lp = mix ( lp , lu , u_va_frame_factor ) ; lq = mix ( lq , lv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bn ( ln , lp , lq , lo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lw","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lx = ga ( ln , lp , lq , lo , lw , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ly = ( u_model_matrix * vec4 ( lw , 1.0 ) ) . xyz ; mat4 lz = aa ( u_camera_eye , ly , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lA = ( u_model_matrix * vec4 ( lw , 1.0 ) ) . xyz ; lz = lz * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lA ) ;".split(" ")}]}}]},
{type:"textline",b:"d lx = ah ( ln - lw , lw , lp , lq , lo , lz ) ; lx . b = ly ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lx = ah ( ln , lw , lp , lq , lo , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lB = ( dot ( cross ( lx . e , lx . c ) , lx . d ) < 0.0 ) ? - 1.0 : 1.0 ; kA = vec4 ( lx . c , lB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"textline",b:"ce ( lx . a , lx . b , lo ) ;".split(" ")}]}}]},{type:"textline",b:"ky = lx . a ; kz = lx . e ; kx = u_camera_eye - lx . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = ak ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kB = lx . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",
a:[{type:"textline",b:["kB","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lC = u_view_matrix * vec4 ( lx . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cF","=","lC",";"]}]}}]},{type:"textline",b:"vec4 lD = u_proj_matrix * lC ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lD . xy += u_subpixel_jitter * lD . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gk","(","lD",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gk ( lx . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lE = lD . x ; float lF = lD . y ; float lG = lD . w ; cE . x = ( lE + lG ) / 2.0 ; cE . y = ( lF + lG ) / 2.0 ; cE . z = lG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kC = - lC . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","lD",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 ky ; varying vec4 cF ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 ln = vec3 ( UNITY_VALUE_NODES ) ; vec3 lo = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"},{type:"textline",b:"vec3 ls ( in vec3 lp , in float lq ) { vec3 lr = lo ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lr = lm ( cE , lp . xz * lq ) ;".split(" ")}]}}]},{type:"textline",b:["return","lr",";","}"]}]}}]},{type:"textline",b:"vec3 lv ( float lt , vec3 lu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lu ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lt ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lC ( vec3 lw ) { vec4 lx = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 ly = mix ( vec4 ( lw . bg , lx . wz ) , vec4 ( lw . gb , lx . xy ) , step ( lw . b , lw . g ) ) ; vec4 lz = mix ( vec4 ( ly . xyw , lw . r ) , vec4 ( lw . r , ly . yzx ) , step ( ly . x , lw . r ) ) ; float lA = lz . x - min ( lz . w , lz . y ) ; float lB = 1.0e-10 ; return vec3 ( abs ( lz . z + ( lz . w - lz . y ) / ( 6.0 * lA + lB ) ) , lA / ( lz . x + lB ) , lz . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lG ( vec3 lD ) { vec4 lE = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lF = abs ( fract ( vec3 ( lD . r , lD . r , lD . r ) + lE . xyz ) * 6.0 - lE . www ) ; return lD . b * mix ( lE . xxx , clamp ( lF - lE . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lD . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lI ( vec2 lH ) { return vec3 ( lH * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lK ( vec3 lJ ) { return vec2 ( lJ . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"textline",b:"void lP ( inout vec3 lL , vec3 lM , vec3 lN , float lO ) {".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kZ ( lL , lM , lN , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kZ ( lL , lM , lN , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lO ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} hp mc ( vec3 lQ , vec3 lR , vec3 lS , vec3 lT , vec3 lU , vec3 lV , vec3 lW , vec2 lX , vec2 lY , float lZ , float l_ , vec4 ma ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS_MAT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"return jR ( lQ , lR , lS , lT , lU , lV , lW , lX , lY , lZ , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , l_ , ma , u_shadow_lamp_id ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return jW ( lQ , lR , lS ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp mb ; mb . a = vec4 ( lS , ZERO_VALUE_NODES ) ; mb . b = lo ; return mb ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"mV",qualifier:["vec3"]},{type:"node_out",name:"mW",qualifier:["float"]},{type:"node_out",name:"mX",qualifier:["float"]},{type:"textline",b:"mV = normalize ( mL . xyz ) ; mW = abs ( mL . z ) ; mX = length ( mL . xyz ) ;".split(" ")}]}},
{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"mY",qualifier:["float"]},{type:"node_in",name:"mZ",qualifier:["float"]},{type:"node_in",name:"m_",qualifier:["float"]},{type:"node_out",name:"na",qualifier:["vec3"]},{type:"textline",b:"na = vec3 ( mY , mZ , m_ ) ;".split(" ")}]}},{type:"node",name:"COMBHSV",group:{type:"group",a:[{type:"node_in",name:"nb",qualifier:["float"]},{type:"node_in",name:"nc",qualifier:["float"]},{type:"node_in",name:"nd",qualifier:["float"]},{type:"node_out",
name:"ne",qualifier:["vec3"]},{type:"textline",b:"ne = lG ( vec3 ( nb , nc , nd ) ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"md",qualifier:["varying","vec2"]},{type:"node_out",name:"nf",qualifier:["vec3"]},{type:"textline",b:"nf = lI ( md ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"me",qualifier:["varying","vec3"]},{type:"node_out",name:"ng",qualifier:["vec3"]},{type:"textline",b:["ng",
"=","me",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"mf",qualifier:["varying","float"]},{type:"node_out",name:"nh",qualifier:["float"]},{type:"textline",b:["nh","=","mf",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"mg",qualifier:["varying","vec2"]},{type:"node_out",name:"ni",qualifier:["float"]},{type:"node_out",name:"nj",qualifier:["float"]},{type:"textline",b:"ni = mg [ 0 ] ; nj = mg [ 1 ] ;".split(" ")}]}},
{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"mh",qualifier:["varying","vec3"]},{type:"node_out",name:"nk",qualifier:["float"]},{type:"node_out",name:"nl",qualifier:["float"]},{type:"node_out",name:"nm",qualifier:["float"]},{type:"textline",b:"nk = mh [ 0 ] ; nl = mh [ 1 ] ; nm = mh [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"nn",qualifier:["vec3"]},{type:"textline",b:["nn","=","mE",";"]}]}},{type:"node",
name:"GEOMETRY_FB",group:{type:"group",a:[{type:"node_out",name:"no",qualifier:["float"]},{type:"textline",b:"no = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"np",qualifier:["vec3"]},{type:"textline",b:["np","=","mJ",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"nq",qualifier:["vec3"]},{type:"textline",b:"nq = vec3 ( mK . r , - mK . b , mK . g ) ;".split(" ")}]}},
{type:"node",name:"HUE_SAT",group:{type:"group",a:[{type:"node_in",name:"nr",qualifier:["float"]},{type:"node_in",name:"ns",qualifier:["float"]},{type:"node_in",name:"nt",qualifier:["float"]},{type:"node_in",name:"nu",qualifier:["float"]},{type:"node_in",name:"nv",qualifier:["vec3"]},{type:"node_out",name:"nw",qualifier:["vec3"]},{type:"textline",b:"{ vec3 nx = lC ( nv ) ; nx [ 0 ] += ( nr - 0.5 ) ; if ( nx [ 0 ] > UNITY_VALUE_NODES ) nx [ 0 ] -= UNITY_VALUE_NODES ; else if ( nx [ 0 ] < ZERO_VALUE_NODES ) nx [ 0 ] += UNITY_VALUE_NODES ; nx *= vec3 ( UNITY_VALUE_NODES , ns , nt ) ; nx = mix ( ln , mix ( lo , nx , step ( lo , nx ) ) , step ( nx , ln ) ) ; nw = mix ( nv , lG ( nx ) , nu ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"ny",qualifier:["float"]},{type:"node_in",name:"nz",qualifier:["vec3"]},{type:"node_out",name:"nA",qualifier:["vec3"]},{type:"textline",b:"nA = mix ( nz , ln - nz , ny ) ;".split(" ")}]}},{type:"node",name:"LAMP",group:{type:"group",a:[{type:"node_param",name:"mi",qualifier:["const","float"]},{type:"node_out",name:"nB",qualifier:["vec3"]},{type:"node_out",name:"nC",qualifier:["vec3"]},{type:"node_out",name:"nD",qualifier:["float"]},
{type:"node_out",name:"nE",qualifier:["float"]},{type:"textline",b:"{ const int nF = int ( mi ) ; vec4 nG = u_lamp_light_factors [ nF ] ; vec3 nH = u_lamp_light_directions [ nF ] ; vec3 nI = u_lamp_light_positions [ nF ] ; float nJ = nG . z ; nB = u_lamp_light_color_intensities [ nF ] ; if ( nJ != - UNITY_VALUE_NODES ) { nC = nI - ky ; nD = length ( nC ) ; nC = normalize ( nC ) ; nE = nJ / ( nJ + nD * nD ) ; float nK = nG . x ; float nL = nG . y ; if ( nK > - UNITY_VALUE_NODES ) { float nM = dot ( nC , nH ) ; nM *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nM - nK ) / nL ) ; nE *= nM ; } } else { nC = nH ; nD = length ( nI - ky ) ; nE = UNITY_VALUE_NODES ; } }".split(" ")}]}},
{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"mj",qualifier:["vec3"]},{type:"node_in",name:"nN",qualifier:["vec3"]},{type:"node_out",name:"nO",qualifier:["vec3"]},{type:"node_out",name:"nP",qualifier:["float"]},{type:"textline",b:"nO = mj ; nP = - dot ( nN , mj ) ;".split(" ")}]}},{type:"node",name:"VECTOR_VIEW",group:{type:"group",a:[{type:"node_in",name:"nQ",qualifier:["vec3"]},{type:"node_out",name:"nR",qualifier:["vec3"]},{type:"textline",b:"nR = - ( u_view_matrix_frag * vec4 ( nQ , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]}},
{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"mk",qualifier:["vec3"]},{type:"node_param",name:"ml",qualifier:["float"]},{type:"node_in",name:"nS",qualifier:["vec3"]},{type:"node_out",name:"nT",qualifier:["vec3"]},{type:"textline",b:"nT = nS * mk ; if ( ml == MAPPING_TYPE_NORMAL ) nT = normalize ( nT ) ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"mm",qualifier:["mat4"]},{type:"node_param",name:"mn",qualifier:["float"]},
{type:"node_param",name:"mo",qualifier:["float"]},{type:"node_param",name:"mp",qualifier:["vec3"]},{type:"node_param",name:"mq",qualifier:["vec3"]},{type:"node_param",name:"mr",qualifier:["float"]},{type:"node_in",name:"nU",qualifier:["vec3"]},{type:"node_out",name:"nV",qualifier:["vec3"]},{type:"textline",b:"nV = ( mm * vec4 ( nU , UNITY_VALUE_NODES ) ) . xyz ; if ( mn == UNITY_VALUE_NODES ) nV = max ( nV , mp ) ; if ( mo == UNITY_VALUE_NODES ) nV = min ( nV , mq ) ; if ( mr == MAPPING_TYPE_NORMAL ) nV = normalize ( nV ) ;".split(" ")}]}},
{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"nW",qualifier:["float"]},{type:"node_in",name:"nX",qualifier:["float"]},{type:"node_out",name:"nY",qualifier:["float"]},{type:"textline",b:"nY = nW + nX ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"nZ",qualifier:["float"]},{type:"node_in",name:"n_",qualifier:["float"]},{type:"node_out",name:"oa",qualifier:["float"]},{type:"textline",b:"oa = nZ - n_ ;".split(" ")}]}},{type:"node",
name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"ob",qualifier:["float"]},{type:"node_in",name:"oc",qualifier:["float"]},{type:"node_out",name:"od",qualifier:["float"]},{type:"textline",b:"od = ob * oc ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"oe",qualifier:["float"]},{type:"node_in",name:"of",qualifier:["float"]},{type:"node_out",name:"og",qualifier:["float"]},{type:"textline",b:"og = ( of != ZERO_VALUE_NODES ) ? oe / of : ZERO_VALUE_NODES ;".split(" ")}]}},
{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"oh",qualifier:["float"]},{type:"node_in",name:"oi",qualifier:["float"]},{type:"node_out",name:"oj",qualifier:["float"]},{type:"textline",b:"oj = sin ( oh ) ; oi ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"ok",qualifier:["float"]},{type:"node_in",name:"ol",qualifier:["float"]},{type:"node_out",name:"om",qualifier:["float"]},{type:"textline",b:"om = cos ( ok ) ; ol ;".split(" ")}]}},
{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"on",qualifier:["float"]},{type:"node_in",name:"oo",qualifier:["float"]},{type:"node_out",name:"op",qualifier:["float"]},{type:"textline",b:"op = tan ( on ) ; oo ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"oq",qualifier:["float"]},{type:"node_in",name:"or",qualifier:["float"]},{type:"node_out",name:"os",qualifier:["float"]},{type:"textline",b:"os = ( oq <= UNITY_VALUE_NODES && oq >= - UNITY_VALUE_NODES ) ? asin ( oq ) : ZERO_VALUE_NODES ; or ;".split(" ")}]}},
{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",name:"ot",qualifier:["float"]},{type:"node_in",name:"ou",qualifier:["float"]},{type:"node_out",name:"ov",qualifier:["float"]},{type:"textline",b:"ov = ( ot <= UNITY_VALUE_NODES && ot >= - UNITY_VALUE_NODES ) ? acos ( ot ) : ZERO_VALUE_NODES ; ou ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"ow",qualifier:["float"]},{type:"node_in",name:"ox",qualifier:["float"]},{type:"node_out",
name:"oy",qualifier:["float"]},{type:"textline",b:"oy = atan ( ow ) ; ox ;".split(" ")}]}},{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"oz",qualifier:["float"]},{type:"node_in",name:"oA",qualifier:["float"]},{type:"node_out",name:"oB",qualifier:["float"]},{type:"textline",b:"if ( oz < ZERO_VALUE_NODES || oz == ZERO_VALUE_NODES && oA == ZERO_VALUE_NODES ) oB = ZERO_VALUE_NODES ; else oB = pow ( oz , oA ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",
a:[{type:"node_in",name:"oC",qualifier:["float"]},{type:"node_in",name:"oD",qualifier:["float"]},{type:"node_out",name:"oE",qualifier:["float"]},{type:"textline",b:"oE = ( oC > ZERO_VALUE_NODES && oD > ZERO_VALUE_NODES ) ? log2 ( oC ) / log2 ( oD ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"oF",qualifier:["float"]},{type:"node_in",name:"oG",qualifier:["float"]},{type:"node_out",name:"oH",qualifier:["float"]},{type:"textline",
b:"oH = min ( oF , oG ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",name:"oI",qualifier:["float"]},{type:"node_in",name:"oJ",qualifier:["float"]},{type:"node_out",name:"oK",qualifier:["float"]},{type:"textline",b:"oK = max ( oI , oJ ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"oL",qualifier:["float"]},{type:"node_in",name:"oM",qualifier:["float"]},{type:"node_out",name:"oN",qualifier:["float"]},{type:"textline",
b:"oN = floor ( oL + 0.5 ) ; oM ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",a:[{type:"node_in",name:"oO",qualifier:["float"]},{type:"node_in",name:"oP",qualifier:["float"]},{type:"node_out",name:"oQ",qualifier:["float"]},{type:"textline",b:"oQ = ( oO < oP ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"oR",qualifier:["float"]},{type:"node_in",name:"oS",qualifier:["float"]},{type:"node_out",
name:"oT",qualifier:["float"]},{type:"textline",b:"oT = ( oR > oS ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"oU",qualifier:["float"]},{type:"node_in",name:"oV",qualifier:["float"]},{type:"node_out",name:"oW",qualifier:["float"]},{type:"textline",b:"oW = abs ( oV ) > 0.000001 ? mod ( oU , oV ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_ABSOLUTE",group:{type:"group",a:[{type:"node_in",name:"oX",
qualifier:["float"]},{type:"node_in",name:"oY",qualifier:["float"]},{type:"node_out",name:"oZ",qualifier:["float"]},{type:"textline",b:"oZ = abs ( oX ) ; oY ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"o_",qualifier:["float"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",qualifier:["vec3"]},{type:"textline",b:"{ float pd = clamp ( o_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pc = mix ( pa , pb , pd ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"pe",qualifier:["float"]},{type:"node_in",name:"pf",qualifier:["vec3"]},{type:"node_in",name:"pg",qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["vec3"]},{type:"textline",b:"{ float pi = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ph = mix ( pf , pf + pg , pi ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"pj",qualifier:["float"]},{type:"node_in",
name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_out",name:"pm",qualifier:["vec3"]},{type:"textline",b:"{ float pn = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pm = mix ( pk , pk * pl , pn ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"po",qualifier:["float"]},{type:"node_in",name:"pp",qualifier:["vec3"]},{type:"node_in",name:"pq",qualifier:["vec3"]},{type:"node_out",name:"pr",qualifier:["vec3"]},
{type:"textline",b:"{ float ps = clamp ( po , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pr = mix ( pp , pp - pq , ps ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"pt",qualifier:["float"]},{type:"node_in",name:"pu",qualifier:["vec3"]},{type:"node_in",name:"pv",qualifier:["vec3"]},{type:"node_out",name:"pw",qualifier:["vec3"]},{type:"textline",b:"{ float px = clamp ( pt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float py = UNITY_VALUE_NODES - px ; pw = ln - ( vec3 ( py ) + px * ( ln - pv ) ) * ( ln - pu ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"pz",qualifier:["float"]},{type:"node_in",name:"pA",qualifier:["vec3"]},{type:"node_in",name:"pB",qualifier:["vec3"]},{type:"node_out",name:"pC",qualifier:["vec3"]},{type:"textline",b:"{ float pD = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pE = UNITY_VALUE_NODES - pD ; pB += step ( pB , lo ) ; pC = pE * pA + pD * pA / pB ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",group:{type:"group",a:[{type:"node_in",
name:"pF",qualifier:["float"]},{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"textline",b:"{ float pJ = clamp ( pF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pI = mix ( pG , abs ( pG - pH ) , pJ ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"pK",qualifier:["float"]},{type:"node_in",name:"pL",qualifier:["vec3"]},{type:"node_in",name:"pM",qualifier:["vec3"]},
{type:"node_out",name:"pN",qualifier:["vec3"]},{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pN = min ( pL . rgb , pM . rgb * pO ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"pP",qualifier:["float"]},{type:"node_in",name:"pQ",qualifier:["vec3"]},{type:"node_in",name:"pR",qualifier:["vec3"]},{type:"node_out",name:"pS",qualifier:["vec3"]},{type:"textline",b:"{ float pT = clamp ( pP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pS = max ( pQ . rgb , pR . rgb * pT ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"pU",qualifier:["float"]},{type:"node_in",name:"pV",qualifier:["vec3"]},{type:"node_in",name:"pW",qualifier:["vec3"]},{type:"node_out",name:"pX",qualifier:["vec3"]},{type:"textline",b:"{ float pY = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pZ = UNITY_VALUE_NODES - pY ; vec3 p_ = vec3 ( pZ ) ; pX = mix ( pV * ( p_ + 2.0 * pY * pW ) , ln - ( p_ + 2.0 * pY * ( ln - pW ) ) * ( ln - pV ) , step ( 0.5 , pV ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"qa",qualifier:["float"]},{type:"node_in",name:"qb",qualifier:["vec3"]},{type:"node_in",name:"qc",qualifier:["vec3"]},{type:"node_out",name:"qd",qualifier:["vec3"]},{type:"textline",b:"{ float qe = clamp ( qa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qf = ln - qe * qc ; vec3 qg = qb / ( qf + step ( qf , lo ) ) ; qd = ( ln - step ( qb , lo ) ) * mix ( mix ( ln , qg , step ( qg , ln ) ) , ln , step ( qf , lo ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"qh",qualifier:["float"]},{type:"node_in",name:"qi",qualifier:["vec3"]},{type:"node_in",name:"qj",qualifier:["vec3"]},{type:"node_out",name:"qk",qualifier:["vec3"]},{type:"textline",b:"{ float ql = clamp ( qh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qm = ln - ql * ( ln - qj ) ; vec3 qn = ln - ( ln - qi ) / ( qm + step ( qm , lo ) ) ; qk = mix ( mix ( lo , mix ( ln , qn , step ( qn , ln ) ) , step ( ZERO_VALUE_NODES , qn ) ) , lo , step ( qm , lo ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"qo",qualifier:["float"]},{type:"node_in",name:"qp",qualifier:["vec3"]},{type:"node_in",name:"qq",qualifier:["vec3"]},{type:"node_out",name:"qr",qualifier:["vec3"]},{type:"textline",b:"{ float qs = clamp ( qo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qt , qu , qv ; qr = qp ; qu = lC ( qq ) ; if ( qu . y != ZERO_VALUE_NODES ) { qt = lC ( qr ) ; qt . x = qu . x ; qv = lG ( qt ) ; qr = mix ( qr , qv , qs ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SATURATION",group:{type:"group",a:[{type:"node_in",name:"qw",qualifier:["float"]},{type:"node_in",name:"qx",qualifier:["vec3"]},{type:"node_in",name:"qy",qualifier:["vec3"]},{type:"node_out",name:"qz",qualifier:["vec3"]},{type:"textline",b:"{ float qA = clamp ( qw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qB = UNITY_VALUE_NODES - qA ; qz = qx ; vec3 qC , qD ; qC = lC ( qz ) ; if ( qC . y != ZERO_VALUE_NODES ) { qD = lC ( qy ) ; qC . y = qB * qC . y + qA * qD . y ; qz = lG ( qC ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",name:"qE",qualifier:["float"]},{type:"node_in",name:"qF",qualifier:["vec3"]},{type:"node_in",name:"qG",qualifier:["vec3"]},{type:"node_out",name:"qH",qualifier:["vec3"]},{type:"textline",b:"{ float qI = clamp ( qE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qJ = UNITY_VALUE_NODES - qI ; vec3 qK , qL ; qK = lC ( qF ) ; qL = lC ( qG ) ; qK . z = qJ * qK . z + qI * qL . z ; qH = lG ( qK ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",
group:{type:"group",a:[{type:"node_in",name:"qM",qualifier:["float"]},{type:"node_in",name:"qN",qualifier:["vec3"]},{type:"node_in",name:"qO",qualifier:["vec3"]},{type:"node_out",name:"qP",qualifier:["vec3"]},{type:"textline",b:"{ float qQ = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qR , qS , qT ; qP = qN ; qS = lC ( qO ) ; if ( qS . y != ZERO_VALUE_NODES ) { qR = lC ( qP ) ; qR . x = qS . x ; qR . y = qS . y ; qT = lG ( qR ) ; qP = mix ( qP , qT , qQ ) ; } }".split(" ")}]}},{type:"node",
name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"qU",qualifier:["float"]},{type:"node_in",name:"qV",qualifier:["vec3"]},{type:"node_in",name:"qW",qualifier:["vec3"]},{type:"node_out",name:"qX",qualifier:["vec3"]},{type:"textline",b:"{ float qY = clamp ( qU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qZ = UNITY_VALUE_NODES - qY ; vec3 q_ = qW + qV - qW * qV ; qX = qV * ( vec3 ( qZ ) + vec3 ( qY ) * ( ( ln - qV ) * qW + q_ ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",
group:{type:"group",a:[{type:"node_in",name:"ra",qualifier:["float"]},{type:"node_in",name:"rb",qualifier:["vec3"]},{type:"node_in",name:"rc",qualifier:["vec3"]},{type:"node_out",name:"rd",qualifier:["vec3"]},{type:"textline",b:"{ float re = clamp ( ra , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rd = clamp ( rb + re * ( 2.0 * rc - ln ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; }".split(" ")}]}},{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"rf",qualifier:["vec3"]},{type:"node_in",
name:"rg",qualifier:["float"]},{type:"textline",b:"mP = rf ; mU = rg ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"ms",qualifier:["const","vec3"]},{type:"node_param",name:"mt",qualifier:["const","vec4"]},{type:"node_param",name:"mu",qualifier:["const","float"]},{type:"node_in",name:"rh",qualifier:["vec3"]},{type:"node_in",name:"ri",qualifier:["float"]},{type:"node_in",name:"rj",qualifier:["vec3"]},{type:"node_in",name:"rk",qualifier:["vec3"]},{type:"node_out",
name:"rl",qualifier:["vec3"]},{type:"node_out",name:"rm",qualifier:["float"]},{type:"node_out",name:"rn",qualifier:["vec3"]},{type:"textline",b:"{ rh = clamp ( rh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ri = clamp ( ri , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rj = clamp ( rj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 ro = rh ; float rp = ms [ 0 ] ; vec2 rq = vec2 ( ms [ 1 ] , ms [ 2 ] ) ; vec3 rr = mM * rh ; vec3 rs = mt [ 1 ] * rj ; float rt = mt [ 0 ] ; vec2 ru = vec2 ( mt [ 2 ] , mt [ 3 ] ) ; float rv = fl ( ro ) ; vec3 rw ; if ( mu == UNITY_VALUE_NODES ) rw = normalize ( rk ) ; else rw = mE ; float rx = 0.5 * rw . y + 0.5 ; vec3 ry = mO * u_environment_energy * lv ( rx , rw ) ; hp rz = mc ( rr , ry , ro , rs , mK , rw , mJ , ru , rq , rv , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ; rl = ( rp == UNITY_VALUE_NODES ) ? rz . a . rgb : lo ; rm = ri ; rn = rw ; if ( rt == UNITY_VALUE_NODES ) { rm += rz . a . a * rs . r * mN ; rm = clamp ( rm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rl += rz . b ; mQ = rz . b ; } else { mQ = lo ; } mR = rw ; mT = rv ; }".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"mv",qualifier:["const","vec3"]},{type:"node_param",name:"mw",qualifier:["const","vec4"]},{type:"node_param",name:"mx",qualifier:["const","float"]},{type:"node_in",name:"rA",qualifier:["vec3"]},{type:"node_in",name:"rB",qualifier:["float"]},{type:"node_in",name:"rC",qualifier:["vec3"]},{type:"node_in",name:"rD",qualifier:["vec3"]},{type:"node_in",name:"rE",qualifier:["float"]},{type:"node_in",name:"rF",qualifier:["float"]},
{type:"node_in",name:"rG",qualifier:["vec4"]},{type:"node_in",name:"rH",qualifier:["float"]},{type:"node_in",name:"rI",qualifier:["float"]},{type:"node_out",name:"rJ",qualifier:["vec3"]},{type:"node_out",name:"rK",qualifier:["float"]},{type:"node_out",name:"rL",qualifier:["vec3"]},{type:"node_out",name:"rM",qualifier:["vec3"]},{type:"node_out",name:"rN",qualifier:["vec3"]},{type:"textline",b:"{ rA = clamp ( rA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rB = clamp ( rB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rC = clamp ( rC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rO = rA ; float rP = mv [ 0 ] ; vec2 rQ = vec2 ( mv [ 1 ] , mv [ 2 ] ) ; vec3 rR = rE * rA ; vec3 rS = mw [ 1 ] * rC ; float rT = mw [ 0 ] ; vec2 rU = vec2 ( mw [ 2 ] , mw [ 3 ] ) ; float rV = fl ( rO ) ; vec3 rW ; if ( mx == UNITY_VALUE_NODES ) rW = normalize ( rD ) ; else rW = mE ; float rX = 0.5 * rW . y + 0.5 ; vec3 rY = mO * u_environment_energy * lv ( rX , rW ) ; hp rZ = mc ( rR , rY , rO , rS , mK , rW , mJ , rU , rQ , rV , rF , rG ) ; rJ = ( rP == UNITY_VALUE_NODES ) ? rZ . a . rgb : lo ; rK = rB ; rL = rW ; rM = rZ . a . rgb ; rN = rZ . b ; lP ( rJ , mJ , rL , rH ) ; if ( rT == UNITY_VALUE_NODES ) { rJ += rZ . b ; rK += rZ . a . a * rS . r * rI ; rK = clamp ( rK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mQ = rZ . b ; } else { mQ = lo ; } mR = rW ; mT = rV ; }".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"my",qualifier:["vec3"]},{type:"node_out",name:"r_",qualifier:["vec3"]},{type:"textline",b:["r_","=","my",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"sa",qualifier:["vec3"]},{type:"node_out",name:"sb",qualifier:["float"]},{type:"textline",b:"sb = sa . r * 0.35 + sa . g * 0.45 + sa . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"sc",qualifier:["vec3"]},
{type:"node_out",name:"sd",qualifier:["float"]},{type:"node_out",name:"se",qualifier:["float"]},{type:"node_out",name:"sf",qualifier:["float"]},{type:"textline",b:"sd = sc . r ; se = sc . g ; sf = sc . b ;".split(" ")}]}},{type:"node",name:"SEPHSV",group:{type:"group",a:[{type:"node_in",name:"sg",qualifier:["vec3"]},{type:"node_out",name:"sh",qualifier:["float"]},{type:"node_out",name:"si",qualifier:["float"]},{type:"node_out",name:"sj",qualifier:["float"]},{type:"textline",b:"{ vec3 sk = lC ( sg ) ; sh = sk . r ; si = sk . g ; sj = sk . b ; }".split(" ")}]}},
{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"sl",qualifier:["float"]},{type:"node_in",name:"sm",qualifier:["float"]},{type:"node_in",name:"sn",qualifier:["float"]},{type:"node_out",name:"so",qualifier:["float"]},{type:"textline",b:"so = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( sl - sn ) * sm ) ) ) ;".split(" ")}]}},{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"sp",qualifier:["vec3"]},{type:"node_out",name:"sq",
qualifier:["vec3"]},{type:"textline",b:"sq = max ( lo , sp ) ; sq = pow ( sq , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"sr",qualifier:["vec3"]},{type:"node_out",name:"ss",qualifier:["vec3"]},{type:"textline",b:"ss = max ( lo , sr ) ; ss = pow ( ss , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"st",qualifier:["vec3"]},{type:"node_out",name:"su",qualifier:["vec3"]},{type:"node_out",name:"sv",qualifier:["float"]},{type:"textline",b:"{ vec4 sw = texture2D ( node_TEXTURE_COLOR_var_texture , lK ( st ) ) ; su = sw . xyz ; gr ( su ) ; sv = sw . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sx",qualifier:["vec3"]},
{type:"node_out",name:"sy",qualifier:["vec3"]},{type:"node_out",name:"sz",qualifier:["float"]},{type:"textline",b:"{ vec4 sA = texture2D ( node_TEXTURE_NORMAL_var_texture , lK ( sx ) ) ; mS = sA . xyz - 0.5 ; sy = normalize ( mH * mS ) ; sz = sA . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",name:"sB",qualifier:["vec3"]},{type:"node_out",name:"sC",
qualifier:["vec3"]},{type:"node_out",name:"sD",qualifier:["float"]},{type:"textline",b:"{ vec4 sE = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , sB ) ; sC = sE . xyz ; gr ( sC ) ; sD = sE . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sF",qualifier:["vec3"]},{type:"node_in",name:"sG",qualifier:["vec3"]},{type:"node_out",name:"sH",qualifier:["vec3"]},
{type:"node_out",name:"sI",qualifier:["float"]},{type:"node_out",name:"sJ",qualifier:["vec3"]},{type:"node_out",name:"sK",qualifier:["float"]},{type:"textline",b:"{ vec4 sL = texture2D ( node_TEXTURE_COLOR2_var_texture , lK ( sF ) ) ; sH = sL . xyz ; gr ( sH ) ; sI = sL . w ; sL = texture2D ( node_TEXTURE_COLOR2_var_texture , lK ( sG ) ) ; sJ = sL . xyz ; gr ( sJ ) ; sK = sL . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",
qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sM",qualifier:["vec3"]},{type:"node_in",name:"sN",qualifier:["vec3"]},{type:"node_out",name:"sO",qualifier:["vec3"]},{type:"node_out",name:"sP",qualifier:["float"]},{type:"node_out",name:"sQ",qualifier:["vec3"]},{type:"node_out",name:"sR",qualifier:["float"]},{type:"textline",b:"{ vec4 sS = texture2D ( node_TEXTURE_NORMAL2_var_texture , lK ( sM ) ) ; mS = sS . xyz - 0.5 ; sO = normalize ( mH * mS ) ; sP = sS . w ; sS = texture2D ( node_TEXTURE_NORMAL2_var_texture , lK ( sN ) ) ; mS = sS . xyz - 0.5 ; sQ = normalize ( mH * mS ) ; sR = sS . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sT",qualifier:["vec3"]},{type:"node_in",name:"sU",qualifier:["vec3"]},{type:"node_in",name:"sV",qualifier:["vec3"]},{type:"node_out",name:"sW",qualifier:["vec3"]},{type:"node_out",name:"sX",qualifier:["float"]},{type:"node_out",name:"sY",qualifier:["vec3"]},{type:"node_out",name:"sZ",qualifier:["float"]},{type:"node_out",name:"s_",
qualifier:["vec3"]},{type:"node_out",name:"ta",qualifier:["float"]},{type:"textline",b:"{ vec4 tb = texture2D ( node_TEXTURE_COLOR3_var_texture , lK ( sT ) ) ; sW = tb . xyz ; gr ( sW ) ; sX = tb . w ; tb = texture2D ( node_TEXTURE_COLOR3_var_texture , lK ( sU ) ) ; sY = tb . xyz ; gr ( sY ) ; sZ = tb . w ; tb = texture2D ( node_TEXTURE_COLOR3_var_texture , lK ( sV ) ) ; s_ = tb . xyz ; gr ( s_ ) ; ta = tb . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR4",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tc",qualifier:["vec3"]},{type:"node_in",name:"td",qualifier:["vec3"]},{type:"node_in",name:"te",qualifier:["vec3"]},{type:"node_in",name:"tf",qualifier:["vec3"]},{type:"node_out",name:"tg",qualifier:["vec3"]},{type:"node_out",name:"th",qualifier:["float"]},{type:"node_out",name:"ti",qualifier:["vec3"]},{type:"node_out",name:"tj",qualifier:["float"]},{type:"node_out",name:"tk",qualifier:["vec3"]},{type:"node_out",
name:"tl",qualifier:["float"]},{type:"node_out",name:"tm",qualifier:["vec3"]},{type:"node_out",name:"tn",qualifier:["float"]},{type:"textline",b:"{ vec4 to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( tc ) ) ; tg = to . xyz ; gr ( tg ) ; th = to . w ; to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( td ) ) ; ti = to . xyz ; gr ( ti ) ; tj = to . w ; to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( te ) ) ; tk = to . xyz ; gr ( tk ) ; tl = to . w ; to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( tf ) ) ; tm = to . xyz ; gr ( tm ) ; tn = to . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tp",qualifier:["vec3"]},{type:"node_in",name:"tq",qualifier:["vec3"]},{type:"node_in",name:"tr",qualifier:["vec3"]},{type:"node_out",name:"ts",qualifier:["vec3"]},{type:"node_out",name:"tt",qualifier:["float"]},{type:"node_out",name:"tu",qualifier:["vec3"]},{type:"node_out",name:"tv",qualifier:["float"]},{type:"node_out",name:"tw",
qualifier:["vec3"]},{type:"node_out",name:"tx",qualifier:["float"]},{type:"textline",b:"{ vec4 ty = texture2D ( node_TEXTURE_NORMAL3_var_texture , lK ( tp ) ) ; mS = ty . xyz - 0.5 ; ts = normalize ( mH * mS ) ; tt = ty . w ; ty = texture2D ( node_TEXTURE_NORMAL3_var_texture , lK ( tq ) ) ; mS = ty . xyz - 0.5 ; tu = normalize ( mH * mS ) ; tv = ty . w ; ty = texture2D ( node_TEXTURE_NORMAL3_var_texture , lK ( tr ) ) ; mS = ty . xyz - 0.5 ; tw = normalize ( mH * mS ) ; tx = ty . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL4",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tz",qualifier:["vec3"]},{type:"node_in",name:"tA",qualifier:["vec3"]},{type:"node_in",name:"tB",qualifier:["vec3"]},{type:"node_in",name:"tC",qualifier:["vec3"]},{type:"node_out",name:"tD",qualifier:["vec3"]},{type:"node_out",name:"tE",qualifier:["float"]},{type:"node_out",name:"tF",qualifier:["vec3"]},{type:"node_out",name:"tG",
qualifier:["float"]},{type:"node_out",name:"tH",qualifier:["vec3"]},{type:"node_out",name:"tI",qualifier:["float"]},{type:"node_out",name:"tJ",qualifier:["vec3"]},{type:"node_out",name:"tK",qualifier:["float"]},{type:"textline",b:"{ vec4 tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tz ) ) ; mS = tL . xyz - 0.5 ; tD = normalize ( mH * mS ) ; tE = tL . w ; tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tA ) ) ; mS = tL . xyz - 0.5 ; tF = normalize ( mH * mS ) ; tG = tL . w ; tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tB ) ) ; mS = tL . xyz - 0.5 ; tH = normalize ( mH * mS ) ; tI = tL . w ; tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tC ) ) ; mS = tL . xyz - 0.5 ; tJ = normalize ( mH * mS ) ; tK = tL . w ; }".split(" ")}]}},
{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"mz",qualifier:["const","float"]},{type:"node_out",name:"tM",qualifier:["float"]},{type:"textline",b:["tM","=","mz",";"]}]}},{type:"node",name:"ANIM_VALUE",group:{type:"group",a:[{type:"node_param",name:"mA",qualifier:["const","int"]},{type:"node_out",name:"tN",qualifier:["float"]},{type:"textline",b:"tN = u_anim_values [ mA ] ;".split(" ")}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"tO",
qualifier:["vec3"]},{type:"node_in",name:"tP",qualifier:["vec3"]},{type:"node_out",name:"tQ",qualifier:["vec3"]},{type:"node_out",name:"tR",qualifier:["float"]},{type:"textline",b:"tQ = tO + tP ; tR = ( abs ( tQ [ 0 ] ) + abs ( tQ [ 1 ] ) + abs ( tQ [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"tS",qualifier:["vec3"]},{type:"node_in",name:"tT",qualifier:["vec3"]},{type:"node_out",name:"tU",qualifier:["vec3"]},{type:"node_out",
name:"tV",qualifier:["float"]},{type:"textline",b:"tU = tS - tT ; tV = ( abs ( tU [ 0 ] ) + abs ( tU [ 1 ] ) + abs ( tU [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"tW",qualifier:["vec3"]},{type:"node_in",name:"tX",qualifier:["vec3"]},{type:"node_out",name:"tY",qualifier:["vec3"]},{type:"node_out",name:"tZ",qualifier:["float"]},{type:"textline",b:"tY = tW + tX ; tZ = length ( tY ) ; tY = normalize ( tY ) ;".split(" ")}]}},{type:"node",
name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"t_",qualifier:["vec3"]},{type:"node_in",name:"ua",qualifier:["vec3"]},{type:"node_out",name:"ub",qualifier:["vec3"]},{type:"node_out",name:"uc",qualifier:["float"]},{type:"textline",b:"ub = lo ; uc = dot ( t_ , ua ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"ud",qualifier:["vec3"]},{type:"node_in",name:"ue",qualifier:["vec3"]},{type:"node_out",name:"uf",qualifier:["vec3"]},
{type:"node_out",name:"ug",qualifier:["float"]},{type:"textline",b:"uf = cross ( ud , ue ) ; ug = length ( uf ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"uh",qualifier:["vec3"]},{type:"node_in",name:"ui",qualifier:["vec3"]},{type:"node_out",name:"uj",qualifier:["vec3"]},{type:"node_out",name:"uk",qualifier:["float"]},{type:"textline",b:"uj = normalize ( uh ) ; uk = length ( uh ) ; ui ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",
a:[{type:"node_in",name:"ul",qualifier:["vec3"]},{type:"node_in",name:"um",qualifier:["vec3"]},{type:"node_out",name:"un",qualifier:["vec3"]},{type:"textline",b:"un = reflect ( - ul , um ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"uo",qualifier:["vec3"]},{type:"node_in",name:"up",qualifier:["float"]},{type:"node_in",name:"uq",qualifier:["const","float"]},{type:"node_in",
name:"ur",qualifier:["const","float"]},{type:"node_out",name:"us",qualifier:["vec3"]},{type:"textline",b:"{ float ut = length ( mL ) ; if ( ut < ur ) { vec2 uu = lK ( uo ) ; float uv = clamp ( 0.5 * ( ur - ut ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float uw = up * uv ; vec3 ux = normalize ( mJ * mH ) ; float uy = UNITY_VALUE_NODES / uq ; vec2 uz = ux . xy * uw / ( uq * ux . z ) ; float uA = UNITY_VALUE_NODES ; float uB = texture2D ( node_PARALLAX_var_texture , uu ) . a ; for ( float uC = 1.0 ; uC <= uq ; uC ++ ) { if ( uB < uA ) { uA -= uy ; uu -= uz ; uB = texture2D ( node_PARALLAX_var_texture , uu ) . a ; } } vec2 uD = uu + uz ; float uE = texture2D ( node_PARALLAX_var_texture , uD ) . a - ( uA + uy ) ; float uF = uB - uA ; float uG = uF / ( uF - uE ) ; uu = uG * uD + ( UNITY_VALUE_NODES - uG ) * uu ; us = lI ( uu ) ; } else us = uo ; }".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"uH",qualifier:["vec3"]},{type:"node_out",name:"uI",qualifier:["vec3"]},{type:"textline",b:"uI = clamp ( uH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}},{type:"node",name:"REFRACTION",group:{type:"group",a:[{type:"node_in",name:"uJ",qualifier:["vec3"]},{type:"node_in",name:"uK",qualifier:["float"]},{type:"node_out",name:"uL",qualifier:["vec3"]},{type:"textline",b:"uL = ls ( uJ , uK ) ;".split(" ")}]}},{type:"node",
name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"uM",qualifier:["float"]},{type:"node_in",name:"uN",qualifier:["float"]},{type:"node_in",name:"uO",qualifier:["float"]},{type:"node_in",name:"uP",qualifier:["float"]},{type:"node_in",name:"uQ",qualifier:["float"]},{type:"node_out",name:"uR",qualifier:["float"]},{type:"node_out",name:"uS",qualifier:["vec4"]},{type:"textline",b:"uR = uM ; uS = vec4 ( uN , uO , uP , uQ ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",
name:"uT",qualifier:["float"]},{type:"textline",b:["uT","=","u_time",";"]}]}},{type:"node",name:"SMOOTHSTEP",group:{type:"group",a:[{type:"node_in",name:"uU",qualifier:["float"]},{type:"node_in",name:"uV",qualifier:["float"]},{type:"node_in",name:"uW",qualifier:["float"]},{type:"node_out",name:"uX",qualifier:["float"]},{type:"textline",b:"uX = smoothstep ( uV , uW , uU ) ;".split(" ")}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["vec3","mB","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mC = ky . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mD","=","kz",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],
group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mD = mD ; else mD = - mD ;".split(" ")}]}}]},{type:"textline",b:"vec3 mE = normalize ( mD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mF = cross ( mD , kA . xyz ) * kA . w ; mat3 mG = mat3 ( kA . xyz , mF , mD ) ; mat3 mH = mG ;".split(" ")}]}}]},{type:"textline",b:"vec3 mI = u_camera_eye_frag - ky ; vec3 mJ = normalize ( mI ) ; vec3 mK = ky ; vec4 mL = cF ; float mM = u_emit ; float mN = u_specular_alpha ; float mO = u_ambient ; vec3 mP ; vec3 mQ ; vec3 mR ; vec3 mS ; float mT ; float mU ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 uY = mP ; float uZ = mU ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uY = max ( uY - sqrt ( 0.01 * - min ( mC , ZERO_VALUE_NODES ) ) , 0.5 * uY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kw ( uY , mC , u_time , mT , mR , u_sun_direction , mB , u_sun_quaternion , ky , length ( cF ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float u_ = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 va = gL ( u_cube_fog , mJ ) ; vec4 vb = vec4 ( va , u_fog_color_density . a ) ; gr ( vb . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 vb = u_fog_color_density ; vb . rgb *= u_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hd ( uY , length ( cF ) , mJ , u_cam_water_depth , u_underwater_fog_color_density , vb , mC , u_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gE ( uY , length ( cF ) , vb ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( uZ < 0.5 ) discard ; uZ = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 vc = texture2DProj ( u_shadow_mask , cE ) . rg ; float vd = vc . g ; uY = vec3 ( vd ) ;".split(" ")}]}}]},{type:"textline",b:["gt","(","uY",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",
b:"gw ( uY , uZ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uY , uZ ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",
";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 ky ; varying vec4 cF ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION",
"&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"md",qualifier:["varying","vec2"]},{type:"textline",b:["md","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",
group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"mi",qualifier:["varying","vec3"]},{type:"textline",b:["mi","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"mj",qualifier:["varying","float"]},{type:"textline",b:["mj","=","node_GEOMETRY_VC1_var_a_vertex_color",
";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"mk",qualifier:["varying","vec2"]},{type:"textline",b:["mk","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ml",qualifier:["varying","vec3"]},
{type:"textline",b:["ml","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 mm = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mn = a_normal ; vec3 mo = vec3 ( a_tangent ) ; vec3 mp = a_tangent [ 3 ] * cross ( mn , mo ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",
a:[{type:"textline",b:"vec3 mn = a_normal ; vec3 mo = vec3 ( 0.0 ) ; vec3 mp = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mn = vec3 ( 0.0 ) ; vec3 mo = vec3 ( 0.0 ) ; vec3 mp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"mm = mix ( mm , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mn = mix ( mn , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mq = vec3 ( a_tangent ) ; vec3 mr = a_tangent_next [ 3 ] * cross ( a_normal_next , mq ) ; mo = mix ( mo , mq , u_va_frame_factor ) ; mp = mix ( mp , mr , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bn ( mm , mo , mp , mn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ms","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ms = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mt = ( u_model_matrix * vec4 ( ms , 1.0 ) ) . xyz ; mat4 mu = aa ( u_camera_eye , mt , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mv = ( u_model_matrix * vec4 ( ms , 1.0 ) ) . xyz ; mu = mu * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mv ) ;".split(" ")}]}}]},{type:"textline",b:"d mw = ah ( mm - ms , ms , mo , mp , mn , mu ) ; mw . b = mt ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mw = ah ( mm , ms , mo , mp , mn , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( mw . a , mw . b , mn ) ;".split(" ")}]}}]},{type:"textline",b:"ky = mw . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:"kz = mw . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mx = ( dot ( cross ( mw . e , mw . c ) , mw . d ) < 0.0 ) ? - 1.0 : 1.0 ; kA = vec4 ( mw . c , mx ) ;".split(" ")}]}}]},
{type:"textline",b:"cF = u_view_matrix * vec4 ( mw . a , 1.0 ) ; vec4 my = u_proj_matrix * cF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"my . xy += u_subpixel_jitter * my . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gk","(","my",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gk ( mw . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mz = my . x ; float mA = my . y ; float mB = my . w ; cE . x = ( mz + mB ) / 2.0 ; cE . y = ( mA + mB ) / 2.0 ; cE . z = mB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kC = - cF . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},
{type:"textline",b:["gl_Position","=","my",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float mm ; varying vec3 kB ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cF",";"]}]}}]},{type:"textline",b:"void main ( ) { float mn = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mo = smoothstep ( u_p_alpha_start , u_p_alpha_end , mn ) ; float mp = u_diffuse_color . a * mm * ( 1.0 - clamp ( mo , 0.0 , 1.0 ) ) ; vec3 mq = kB * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:"gE ( mq , length ( cF ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gt","(","mq",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gw ( mq , mp ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mq , mp ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float mm ; varying vec3 kB ; varying vec3 cF ;".split(" ")},{type:"include",file:"particles.glslv"},
{type:"textline",b:"void main ( ) { mn ne ; ne = nd ( ) ; vec4 nf = u_view_matrix * vec4 ( ne . b , 1.0 ) ; gl_Position = u_proj_matrix * nf ; mm = ne . c ; kB = ne . d ; cF = nf . xyz ; float ng = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = ne . a * ng ; }".split(" ")}]};a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float mm ; varying vec3 kB ; varying vec2 a ; varying vec3 kx ; varying vec3 ky ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 ln = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lo = texture2D ( u_sampler , a ) ; gr ( lo . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"ln . rgb = mix ( ln . rgb , lo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"ln . rgb *= mix ( vec3 ( 1.0 ) , lo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"ln . a = lo . a ;".split(" ")}]}}]},{type:"textline",b:"ln . rgb *= kB ; vec3 lp = u_diffuse_intensity * ln . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lq = u_emit * ln . rgb ; vec3 lr = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 ls = u_environment_energy * textureCube ( u_sky_texture , lr ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lt = 0.5 ; vec3 ls = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lt ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lu = u_ambient * ls ; float lv = u_specular_params [ 0 ] ; vec2 lw = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lx = lv * u_specular_color ; vec3 ly = normalize ( kx ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hp lz = jR ( lq , lu , lp , lx , ky , lr , ly , lw , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp lz = jW ( lq , lu , lp ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lA = lz . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","lA","=","lp",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gE ( lA , length ( cF ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lB = ln . a * mm ; gt ( lA ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gw ( lA , lB ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lA , lB ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ; varying float mm ; varying vec3 kB ; varying vec2 a ; varying vec3 kx ; varying vec3 ky ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lp ( vec2 ln , vec2 lo ) { return ( atan ( lo . y , lo . x ) - atan ( ln . y , ln . x ) ) ; } void main ( ) { mn lq ; lq = nd ( ) ; float lr ; mat4 ls ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { lr = lq . e ; ls = z ( lq . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { lr = lq . e ; ls = k ( ) ; ls [ 3 ] = vec4 ( lq . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { lr = lq . e ; ls = o ( radians ( 90.0 ) ) ; ls [ 3 ] = vec4 ( lq . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { lr = lp ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lq . e ; ls = m ( radians ( - 90.0 ) ) ; ls [ 3 ] = vec4 ( lq . b , 1.0 ) ; } vec4 lt = vec4 ( a_p_bb_vertex * 2.0 * lq . a * u_p_size , 0.0 , 1.0 ) ; vec4 lu = ls * q ( lr ) * lt ; vec4 lv = u_view_matrix * lu ; vec4 lw = u_proj_matrix * lv ; gl_Position = lw ; mm = lq . c ; kB = lq . d ; a = a_p_bb_vertex + 0.5 ; ky = lu . xyz ; kx = u_camera_eye - lu . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cF","=","lv",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 ne ; const float nf = 0.99 ; const float ng = 1.8 ; const int nh = 8 ; float nr ( vec3 ni , vec3 nj ) { float nk = dot ( nj , nj ) ; float nl = 2.0 * dot ( nj , ni ) ; float nm = dot ( ni , ni ) - 1.0 ; float nn = nl * nl - 4.0 * nk * nm ; float no = sqrt ( nn ) ; float np = ( - nl - no ) / 2.0 ; float nq = nm / np ; return nq ; } float ny ( float ns , float nt ) { float nu = 3.0 * ( 1.0 - nt * nt ) ; float nv = 2.0 * ( 2.0 + nt * nt ) ; float nw = 1.0 + ns * ns ; float nx = pow ( 1.0 + nt * nt - 2.0 * nt * ns , 1.5 ) ; nx = max ( nx , 0.00001 ) ; return ( nu / nv ) * ( nw / nx ) ; } float nG ( vec3 nz , vec3 nA , float nB ) { float nC = dot ( nA , - nz ) ; if ( nC < 0.0 ) { return 1.0 ; } vec3 nD = nz + nC * nA ; if ( length ( nD ) < nB ) { return 0.0 ; } else if ( length ( nD ) >= nB ) { vec3 nE = normalize ( nD ) * nB - nz ; float nF = acos ( dot ( normalize ( nE ) , nA ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nF * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nK ( float nH , vec3 nI , float nJ ) { return nI - nI * pow ( u_sky_color , vec3 ( nJ / nH ) ) ; } void main ( ) { vec3 nL = normalize ( ne ) ; vec3 nM = u_sun_direction ; float nN = dot ( nL , nM ) ; float nO = ny ( nN , - 0.01 ) * u_rayleigh_brightness * nM . y ; float nP = ny ( nN - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nM . y ) ; float nQ = smoothstep ( 0.0 , 100.0 , ny ( nN , 0.9995 ) ) * u_spot_brightness ; vec3 nR = vec3 ( 0.0 , nf , 0.0 ) ; float nS = nr ( nR , nL ) ; float nT = nS / float ( nh ) ; float nU = nG ( nR , nL , nf - 0.3 ) ; vec3 nV = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nW = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nX = 0 ; nX < nh ; nX ++ ) { float nY = nT * float ( nX ) ; vec3 nZ = nR + nL * nY ; float n_ = nG ( nZ , nM , nf - 0.2 ) ; float oa = nr ( nZ , nM ) ; vec3 ob = nK ( oa , vec3 ( ng ) , u_scatter_strength ) * n_ ; nV += nK ( sqrt ( nY ) , u_sky_color * ob , u_rayleigh_strength ) ; nW += nK ( nY , ob , u_mie_strength ) ; } nV = nV * nU * pow ( nS , u_rayleigh_collection_power ) / float ( nh ) ; nW = ( nW * nU * pow ( nS , u_mie_collection_power ) ) / float ( nh ) ; vec3 oc = vec3 ( nQ * nW + nP * nW + nO * nV ) ; gt ( oc ) ; gl_FragColor = vec4 ( oc , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 ne ; void main ( ) { vec4 ln = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lo = u_cube_view_matrix * ln ; ne = lo . xyz ; gl_Position = ln ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_sampler , a ) ; gt ( ln . rgb ) ; gw ( ln . rgb , ln . a ) ; gl_FragColor = ln ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 ln = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lo = u_proj_matrix * u_view_matrix * vec4 ( ln , 0.0 ) ; lo . x /= lo . w ; lo . y /= lo . w ; lo += 99999.0 * step ( lo . z , 0.0 ) ; lo += 100.0 * ( step ( 1.0 , abs ( lo . x ) ) + step ( 1.0 , abs ( lo . y ) ) ) ; lo . x = - a_lf_dist * lo . x ; lo . y = - a_lf_dist * lo . y ; float lp = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lq = vec2 ( a_lf_bb_vertex . x / lp , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float lr = 1.9 ; lq *= ( 1.0 + lr * length ( lo . xy ) ) ; } gl_Position = vec4 ( lo . xy + lq , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 ne ; void main ( ) { vec3 ln = textureCube ( u_sky , ne ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gr ( ln . rgb ) ; float lo = u_camera_eye_frag . y - WATER_LEVEL ; lo = min ( - lo * 0.03 , 0.8 ) ; float lp = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lq = normalize ( ne ) ; vec3 lr = vec3 ( 0.0 ) ; vec4 ls = u_underwater_fog_color_density ; ls . rgb = mix ( ls . rgb , lr , min ( - lq . y + lo , 1.0 ) ) * lp ; float lt = clamp ( sign ( lq . y - 0.05 * lo ) , 0.0 , 1.0 ) ; ln = mix ( ls . rgb , ln , lt ) ; gt ( ln . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( ln , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 ne ; void main ( ) { vec4 ln = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lo = u_sky_vp_inverse * ln ; ne = lo . xyz ; gl_Position = ln ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float ln = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 kx ; varying vec3 ky ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kz",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kA ; varying vec3 nf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ng",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ni",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nx ( in vec2 nj , in vec3 nk , in vec3 nl , in vec3 nm , out float nn ) { vec3 no = reflect ( - nl , nk ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 np = nj . xy + nk . xz * REFL_BUMP / kC ; nn = u_reflect_factor ; vec3 nq ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nq = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nq = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float nr = dot ( nl , nk ) ; nn *= max ( 1.0 - 1.0 / nr , 1.0 ) ; } else { nq = texture2D ( u_reflectmap , np ) . rgb ; gr ( nq ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nn = u_mirror_factor ; vec3 nq = nm * textureCube ( u_mirrormap , no ) . rgb ; gr ( nq ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nn = u_reflect_factor ; vec3 nq = nm * vec3 ( 0.3 , 0.5 , 1.0 ) ; gr ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ns = normalize ( no + nl ) ; float nt = 1.0 - dot ( nl , ns ) ; float nu = u_fresnel_params [ 3 ] ; float nv = u_fresnel_params [ 2 ] ; float nw = nu + ( 1.0 - nu ) * pow ( nt , nv ) ; nn = min ( nn * nw , 1.0 ) ; return nq ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 ny = mat3 ( kA , nf , kz ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nz = normalize ( kz ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 ny = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nz = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float nA = ky . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 nB = vec2 ( ng . x , - ng . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nB = vec2 ( ky . x , - ky . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","nB","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nC = vec3 ( 0.0 ) ; vec3 nD = texture2D ( u_normalmap0 , nB * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:"vec3 nE = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nE","+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nD = texture2D ( u_normalmap0 , nB * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["nE","+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nD = texture2D ( u_normalmap0 , nB * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],
group:{type:"group",a:[{type:"textline",b:["nE","+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nD = texture2D ( u_normalmap0 , nB * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nE",
"+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nF = ny * nE ; if ( ! g ( nF , vec3 ( 0.0 ) ) ) nF = normalize ( nF ) ; vec3 nG = mix ( nz , nF , 0.2 ) ; nG = normalize ( nG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nz = mix ( nz , normalize ( ny * nC ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nz = mix ( nz , normalize ( ny * nC ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nz = normalize ( nz ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nH = normalize ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nI = cE . xy / cE . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"float nJ = kC * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nK = u_diffuse_color . a ; vec4 nL = texture2DProj ( u_scene_depth , cE ) ; float nM = cq ( nL ) ; float nN = max ( nM - kC , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nO = nI + nz . xz * u_refr_bump / kC ; float nP = le ( nM , nO , nI ) ; float nQ = max ( nP - kC , 0.0 ) ; float nR = u_view_max_depth / ABSORB * nQ ; float nS ; if ( u_cam_water_depth < 0.0 ) nS = 0.0 ; else nS = min ( nK * nR , 1.0 ) ; float nT = u_view_max_depth / ABSORB * nN ; nK = min ( 15.0 * nK * u_view_max_depth * nN , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nT = u_view_max_depth / ABSORB * nN ; if ( u_cam_water_depth > 0.0 ) nK = min ( nK * nT , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nK *= min ( 5.0 * nJ , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nK = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nS = 1.0 - nK ; vec2 nO = nI + nz . xz * REFR_BUMP / kC ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nU = texture2D ( u_refractmap , nO ) . rgb ; gr ( nU ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nV = pow ( min ( nh . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nW = mix ( u_shallow_water_col , u_diffuse_color . rgb , nV ) ; nV = pow ( min ( nh . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nW = mix ( u_shore_water_col , nW , nV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nW = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nX = max ( 1.0 - u_view_max_depth * nN , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nX = 1.0 - nK ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nY = max ( nA / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nZ = normalize ( vec3 ( nh . r , 0.0 , nh . g ) ) ; vec3 n_ = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nZ , 0.8 ) ) ; float oa = 1.25 * max ( dot ( nG , n_ ) - 0.2 , 0.0 ) ; oa += max ( dot ( nG , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nX += oa * ( 1.0 - nh . b ) ; nY *= ( 1.0 - 0.95 * pow ( nh . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nX += nY ; nX = min ( u_foam_factor * nX , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ob = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nB * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float oc = u_specular_params [ 0 ] ; vec2 od = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 oe = oc * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 of = u_environment_energy * textureCube ( u_sky_texture , nz ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 of = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 og = u_ambient * of ; vec3 oh = og + u_sun_intensity ; float oi ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 oj = nx ( nI , nz , nH , oh , oi ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 oj = nx ( vec2 ( 0.0 ) , nz , nH , oh , oi ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 ok = u_diffuse_intensity * nW ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hp ol = jR ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ok , oe , ky , nz , nH , od , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp ol = jW ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ok ) ;".split(" ")}]}}]},
{type:"textline",b:"ok = ol . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float om = max ( dot ( u_sun_direction , - kz ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nH , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; om = clamp ( SSS_STRENGTH * om , 0.0 , 1.0 ) ; ok = mix ( ok , u_shallow_water_col , om ) ; ok = mix ( ok , u_shore_water_col , om ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"ok = mix ( nU , ok , nS ) ;".split(" ")}]}}]},{type:"textline",b:"ok = mix ( ok , oj , oi ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float on = mix ( ob . g , ob . r , max ( 4.0 * ( nX - 0.75 ) , 0.0 ) ) ; on = mix ( ob . b , on , max ( 2.0 * nX - 1.0 , 0.0 ) ) ; on = mix ( 0.0 , on , nX ) ; ok = mix ( ok , oh , on ) ;".split(" ")}]}}]},{type:"textline",b:"ok += ol . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 oo = gL ( u_cube_fog , nH ) ; vec4 op = vec4 ( oo , u_fog_color_density . a ) ; gr ( op . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","op","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { hm ( ok , nJ , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gE ( ok , nJ , op ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gE ( ok , nJ , op ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gt","(","ok",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nK = max ( nK , ol . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nK","+=","on",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gw ( ok , nK ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oq = fwidth ( ni ) ; vec3 or = smoothstep ( vec3 ( 0.0 ) , oq * ln , ni ) ; float os = min ( min ( or . x , or . y ) , or . z ) ; os = clamp ( os , 0.0 , 1.0 ) ; ok = mix ( u_wireframe_edge_color , ok , os ) ; nK = mix ( 1.0 , nK , os ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ok , nK ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kx ; varying vec3 ky ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kz",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kA ; varying vec3 nf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ng",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nh",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ni",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lt ( in vec2 ln ) { vec2 lo = 0.5 + vec2 ( ( ln . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( ln . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lp = texture2D ( u_shore_dist_map , lo ) ; const vec2 lq = vec2 ( 1.0 / 255.0 , 1.0 ) ; float lr = dot ( lp . ba , lq ) ; vec2 ls = normalize ( lp . rg * 2.0 - 1.0 ) ; return vec3 ( ls , lr ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lK ( inout vec3 lu , in float lv , in vec3 lw ) { float lx = dG ( DST_NOISE_SCALE_0 * ( lu . xz + DST_NOISE_FREQ_0 * lv ) ) * dG ( DST_NOISE_SCALE_1 * ( lu . zx - DST_NOISE_FREQ_1 * lv ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float ly = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lz = lw . b ; float lA = sqrt ( lz ) ; float lB = max ( lz , DIR_MIN_SHR_FAC ) * sin ( lA / ly + DIR_FREQ * lv ) ; float lC = max ( dG ( DIR_NOISE_SCALE * ( lu . xz + DIR_NOISE_FREQ * lv ) ) , DIR_MIN_NOISE_FAC ) ; lB *= lC ; float lD = WAVES_HEIGHT * mix ( lB , lx , max ( lA , DST_MIN_FAC ) ) ; vec2 lE = lw . rg ; float lF = WAVES_HOR_FAC * lB * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lz ) , 0.0 ) ; vec2 lG = lF * lE ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lD = WAVES_HEIGHT * lx ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lH = 2.0 * ( lu . xz - 0.1 * lv ) ; vec2 lI = 1.3 * ( lu . zx + 0.03 * lv ) ; float lJ = da ( 0.5 * lH ) . x + da ( 0.5 * lI ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lu . xz += lG ; lJ *= lz ;".split(" ")}]}}]},{type:"textline",
b:"lD += SMALL_WAVES_FAC * lJ ;".split(" ")}]}}]},{type:"textline",b:"lu . y += lD ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) ni = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) ni = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) ni = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","lL","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float lM = abs ( lL . y ) ; vec2 lN = u_camera_eye . xz - mod ( u_camera_eye . xz , lM ) ; lL . y = WATER_LEVEL ; lL . xz += lN ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d lO = ah ( lL , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"ng = lO . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nh = lt ( lO . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float lP = length ( u_wind ) ; float lQ = u_time ; lQ *= lP ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"lR","=","lM",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lR","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 lS = lO . a + vec3 ( lR , 0.0 , 0.0 ) ; vec3 lT = lO . a + vec3 ( 0.0 , 0.0 , lR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 lU = lt ( lS . xz ) ; vec3 lV = lt ( lT . xz ) ; lK ( lS , lQ , lU ) ; lK ( lT , lQ , lV ) ; lK ( lO . a , lQ , nh ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lK ( lS , lQ , vec3 ( 0.0 ) ) ; lK ( lT , lQ , vec3 ( 0.0 ) ) ; lK ( lO . a , lQ , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { lO . a . y = WATER_LEVEL - 1.0 ; lS . y = lO . a . y ; lT . y = lO . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 lW = normalize ( lS - lO . a ) ; vec3 lX = normalize ( lT - lO . a ) ; kz = normalize ( cross ( lX , lW ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kA = lX ; nf = cross ( kz , kA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lY = dot ( kz , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lZ = clamp ( 0.8 - lY , 0.0 , 1.0 ) ; kz = mix ( kz , vec3 ( 0.0 , 1.0 , 0.0 ) , lZ ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"ky = lO . a ; kx = u_camera_eye - lO . a ; vec4 l_ = u_view_matrix * vec4 ( lO . a , 1.0 ) ; vec4 ma = u_proj_matrix * l_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float mb = ma . x ; float mc = ma . y ; float nj = ma . w ; cE . x = ( mb + nj ) / 2.0 ; cE . y = ( mc + nj ) / 2.0 ; cE . z = nj ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kC = - l_ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","ma",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 ni ; const float ln = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lo = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lo = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lp = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lq = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lr = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 ls = vec3 ( 0.0 ) ; float lt = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lu = sign ( ni - vec3 ( 0.02 * ln ) ) ; if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) { ls = lo ; lt = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lu = sign ( ni - vec3 ( 0.02 * ln ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) ls = u_wireframe_edge_color ; else ls = lr ; lt = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) lt = 1.0 ; else lt = 0.0 ; ls = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) ls = u_wireframe_edge_color ; else if ( gl_FrontFacing ) ls = lp ; else ls = lq ; lt = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lv = fwidth ( ni ) ; vec3 lw = smoothstep ( vec3 ( 0.0 ) , lv * ln , ni ) ; float lx = min ( min ( lw . x , lw . y ) , lw . z ) ; lx = clamp ( lx , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { ls = vec3 ( mix ( u_wireframe_edge_color , lr , lx ) ) ; lt = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { ls = u_wireframe_edge_color ; lt = mix ( 1.0 , 0.0 , lx ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) ls = mix ( u_wireframe_edge_color , lp , lx ) ; else ls = mix ( u_wireframe_edge_color , lq , lx ) ; lt = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gt","(","ls",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gw ( ls , lt ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ls , lt ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","ni",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) ni = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) ni = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) ni = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 ln = a_position ; vec3 lo = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lp = ah ( ln , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ln = mix ( ln , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lq = vec3 ( 0.0 ) ; vec3 lr = vec3 ( 0.0 ) ; bn ( ln , lq , lr , lo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","ls","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ls = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lp = ga ( ln , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ls , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lt = ( u_model_matrix * vec4 ( ls , 1.0 ) ) . xyz ; mat4 lu = aa ( u_camera_eye , lt , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lv = ( u_model_matrix * vec4 ( ls , 1.0 ) ) . xyz ; lu = lu * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lv ) ;".split(" ")}]}}]},{type:"textline",b:"d lp = ah ( ln - ls , ls , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lu ) ; lp . b = lt ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d lp = ah ( ln , ls , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( lp . a , lp . b , lo ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lw = u_view_matrix * vec4 ( lp . a , 1.0 ) ; gl_Position = u_proj_matrix * lw ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_sampler_left , a ) ; vec4 lo = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( ln [ 0 ] , lo [ 1 ] , lo [ 2 ] , ln [ 3 ] + lo [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",
b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lq ( float ln , float lo ) { vec2 lp = a + vec2 ( ln , lo ) * u_texel_size ; return texture2D ( u_color , lp ) ; } float lu ( vec4 lr ) { vec3 ls = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lt = dot ( lr . rgb , ls ) ; return lt ; } vec4 lN ( ) { vec4 lv = lq ( - 1.0 , - 1.0 ) ; vec4 lw = lq ( 1.0 , - 1.0 ) ; vec4 lx = lq ( - 1.0 , 1.0 ) ; vec4 ly = lq ( 1.0 , 1.0 ) ; vec4 lz = lq ( 0.0 , 0.0 ) ; float lA = lu ( lv ) ; float lB = lu ( lw ) ; float lC = lu ( lx ) ; float lD = lu ( ly ) ; float lE = lu ( lz ) ; float lF = min ( lE , min ( min ( lA , lB ) , min ( lC , lD ) ) ) ; float lG = max ( lE , max ( max ( lA , lB ) , max ( lC , lD ) ) ) ; vec2 lH ; lH . x = - ( ( lA + lB ) - ( lC + lD ) ) ; lH . y = ( ( lA + lC ) - ( lB + lD ) ) ; float lI = max ( ( lA + lB + lC + lD ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lJ = 1.0 / ( min ( abs ( lH . x ) , abs ( lH . y ) ) + lI ) ; lH = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lH * lJ ) ) * u_texel_size ; vec4 lK = 0.5 * ( texture2D ( u_color , a + lH * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lH * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 lL = lK * 0.5 + 0.25 * ( texture2D ( u_color , a + lH * - 0.5 ) + texture2D ( u_color , a + lH * 0.5 ) ) ; float lM = lu ( lL ) ; if ( ( lM < lF ) || ( lM > lG ) ) return lK ; else return lL ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oE ( ) { vec2 lO ; lO . x = a . x ; lO . y = a . y ; vec4 lP = texture2D ( u_color , lO ) ; vec4 lQ = lq ( 0.0 , 1.0 ) ; vec4 lR = lq ( 1.0 , 0.0 ) ; vec4 lS = lq ( 0.0 , - 1.0 ) ; vec4 lT = lq ( - 1.0 , 0.0 ) ; float lU = lu ( lQ ) ; float lV = lu ( lR ) ; float lW = lu ( lS ) ; float lX = lu ( lT ) ; float lY = lu ( lP ) ; float lZ = max ( lU , lY ) ; float l_ = min ( lU , lY ) ; float ma = max ( lV , lZ ) ; float mb = min ( lV , l_ ) ; float mc = max ( lW , lX ) ; float nj = min ( lW , lX ) ; float nk = max ( mc , ma ) ; float nl = min ( nj , mb ) ; float nm = nk * FXAA_QUALITY_EDGE_THRESHOLD ; float nn = nk - nl ; float no = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nm ) ; bool np = nn < no ; if ( np ) return lP ; vec4 nq = lq ( - 1.0 , - 1.0 ) ; vec4 nr = lq ( 1.0 , 1.0 ) ; vec4 ns = lq ( 1.0 , - 1.0 ) ; vec4 nt = lq ( - 1.0 , 1.0 ) ; float nu = lu ( nq ) ; float nv = lu ( nr ) ; float nw = lu ( ns ) ; float nx = lu ( nt ) ; float ny = lW + lU ; float nz = lX + lV ; float nA = 1.0 / nn ; float nB = ny + nz ; float nC = ( - 2.0 * lY ) + ny ; float nD = ( - 2.0 * lY ) + nz ; float nE = nw + nv ; float nF = nu + nw ; float nG = ( - 2.0 * lV ) + nE ; float nH = ( - 2.0 * lW ) + nF ; float nI = nu + nx ; float nJ = nx + nv ; float nK = ( abs ( nC ) * 2.0 ) + abs ( nG ) ; float nL = ( abs ( nD ) * 2.0 ) + abs ( nH ) ; float nM = ( - 2.0 * lX ) + nI ; float nN = ( - 2.0 * lU ) + nJ ; float nO = abs ( nM ) + nK ; float nP = abs ( nN ) + nL ; float nQ = nI + nE ; float nR = u_texel_size . x ; bool nS = nO >= nP ; float nT = nB * 2.0 + nQ ; if ( ! nS ) lW = lX ; if ( ! nS ) lU = lV ; if ( nS ) nR = u_texel_size . y ; float nU = ( nT * ( 1.0 / 12.0 ) ) - lY ; float nV = lW - lY ; float nW = lU - lY ; float nX = lW + lY ; float nY = lU + lY ; bool nZ = abs ( nV ) >= abs ( nW ) ; float n_ = max ( abs ( nV ) , abs ( nW ) ) ; if ( nZ ) nR = - nR ; float oa = clamp ( abs ( nU ) * nA , 0.0 , 1.0 ) ; vec2 ob ; ob . x = lO . x ; ob . y = lO . y ; vec2 oc ; oc . x = ( ! nS ) ? 0.0 : u_texel_size . x ; oc . y = ( nS ) ? 0.0 : u_texel_size . y ; if ( ! nS ) ob . x += nR * 0.5 ; if ( nS ) ob . y += nR * 0.5 ; vec2 od ; od . x = ob . x - oc . x ; od . y = ob . y - oc . y ; vec2 oe ; oe . x = ob . x + oc . x ; oe . y = ob . y + oc . y ; float of = ( ( - 2.0 ) * oa ) + 3.0 ; float og = lu ( texture2D ( u_color , od ) ) ; float oh = oa * oa ; float oi = lu ( texture2D ( u_color , oe ) ) ; if ( ! nZ ) nX = nY ; float oj = n_ * 1.0 / 4.0 ; float ok = lY - nX * 0.5 ; float ol = of * oh ; bool om = ok < 0.0 ; og -= nX * 0.5 ; oi -= nX * 0.5 ; bool on = abs ( og ) >= oj ; bool oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 1.5 ; if ( ! on ) od . y -= oc . y * 1.5 ; bool op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 1.5 ; if ( ! oo ) oe . y += oc . y * 1.5 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 2.0 ; if ( ! on ) od . y -= oc . y * 2.0 ; op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 2.0 ; if ( ! oo ) oe . y += oc . y * 2.0 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 2.0 ; if ( ! on ) od . y -= oc . y * 2.0 ; op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 2.0 ; if ( ! oo ) oe . y += oc . y * 2.0 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 4.0 ; if ( ! on ) od . y -= oc . y * 4.0 ; op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 4.0 ; if ( ! oo ) oe . y += oc . y * 4.0 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 2.0 ; if ( ! on ) od . y -= oc . y * 2.0 ; if ( ! oo ) oe . x += oc . x * 2.0 ; if ( ! oo ) oe . y += oc . y * 2.0 ; } } } } float oq = lO . x - od . x ; float or = oe . x - lO . x ; if ( ! nS ) oq = lO . y - od . y ; if ( ! nS ) or = oe . y - lO . y ; bool os = ( og < 0.0 ) != om ; float ot = ( or + oq ) ; bool ou = ( oi < 0.0 ) != om ; float ov = 1.0 / ot ; bool ow = oq < or ; float ox = min ( oq , or ) ; bool oy = ow ? os : ou ; float oz = ol * ol ; float oA = ( ox * ( - ov ) ) + 0.5 ; float oB = oz * FXAA_QUALITY_SUBPIX ; float oC = oy ? oA : 0.0 ; float oD = max ( oC , oB ) ; if ( ! nS ) lO . x += oD * nR ; if ( nS ) lO . y += oD * nR ; return texture2D ( u_color , lO ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lN ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oE ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 ln = vec2 ( 0.0 , 0.0 ) ; vec2 lo = u_texel_size ; vec4 lp = texture2D ( u_color , a ) ; gl_FragColor = lp * 0.0875447373698 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0858112354248 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0808139781061 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0731235112908 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0635705267419 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0530985673112 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0426125984122 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0328565115809 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lp , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_main , a ) ; vec4 lo = texture2D ( u_bloom , a ) ; vec4 lp = ln ; lp += lo ; gl_FragColor = vec4 ( lp . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_color , a ) ; vec3 lo = ln . rgb ; if ( u_brightness < 0.0 ) lo = lo * ( 1.0 + u_brightness ) ; else lo = lo + ( ( 1.0 - lo ) * u_brightness ) ; lo = ( lo - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lo *= u_exposure ; vec3 lp = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lq = dot ( lo , lp ) ; lo = mix ( vec3 ( lq ) , lo , u_saturation ) ; gl_FragColor = vec4 ( lo , ln . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cm ( clamp ( nq ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nr = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float ns = nq ( u_depth , a , u_camera_range ) ; ns *= u_view_max_depth ; float nt ; if ( ns < u_dof_dist ) nt = ( u_dof_dist - ns ) / u_dof_front ; else nt = ( ns - u_dof_dist ) / u_dof_rear ; nt = clamp ( nt , 0.0 , 1.0 ) ; vec4 nu = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nr , nu , nt ) ; } else gl_FragColor = nr ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float ls ( float ln , float lo , float lp ) { vec2 lq = a + vec2 ( ln , lo ) * u_texel_size ; vec4 lr = texture2D ( u_sampler , lq ) * lp ; return cq ( lr ) ; } void main ( ) { float lt = ( ls ( - 1.0 , - 1.0 , - 1.0 ) + ls ( 0.0 , - 1.0 , - 1.0 ) + ls ( 1.0 , - 1.0 , - 1.0 ) + ls ( - 1.0 , 0.0 , - 1.0 ) + ls ( 0.0 , 0.0 , 8.0 ) + ls ( 1.0 , 0.0 , - 1.0 ) + ls ( - 1.0 , 1.0 , - 1.0 ) + ls ( 0.0 , 1.0 , - 1.0 ) + ls ( 1.0 , 1.0 , - 1.0 ) ) ; lt *= 1000.0 ; gl_FragColor = vec4 ( lt , lt , lt , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_glow_src , a ) ; gl_FragColor = ln ; if ( u_draw_glow != 0.0 ) { vec4 lo = texture2D ( u_glow_mask , a ) ; vec4 lp = texture2D ( u_glow_mask_blurred , a ) ; float lq = lp . a - lo . a ; if ( lq != 0.0 ) { float lr = smoothstep ( 0.0 , 1.0 , lp . a ) ; if ( lo . a == 0.0 ) { vec3 ls = u_glow_color ; gt ( ls ) ; vec4 lt = vec4 ( clamp ( ls , 0.0 , 1.0 ) , lr ) ; gl_FragColor = mix ( ln , lt , lr ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nr ; varying vec2 ns ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nt ; void main ( ) { vec2 nu = ( nt . xy - a ) ; float nv = length ( nu ) ; vec2 nw = u_radial_blur_step * nu / nv ; float nx = nv / u_radial_blur_step ; nw *= min ( nx , STEPS_PER_PASS ) / STEPS_PER_PASS ; nx = max ( nx , STEPS_PER_PASS ) ; vec2 ny = a ; float nz = 0.0 ; for ( float nA = 0.0 ; nA < STEPS_PER_PASS ; nA += 1.0 ) { if ( nA <= nx ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float nB = nq ( u_input , ny , u_camera_range ) ; nz += max ( ( 1.0 - pow ( nv , 0.3 ) ) * step ( 0.9 , nB ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nC = texture2D ( u_input , ny ) ; nz += cq ( nC ) ;".split(" ")}]}}]},{type:"textline",b:"} ny += nw ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nD = a + ns ; float nE = da ( vec2 ( 2.5 * ( nD . x ) , 2.5 * ( nD . y ) + 1.0 * u_time ) ) . x + 0.75 * da ( vec2 ( 5.0 * ( nD . x ) - 0.66 * u_time , 5.0 * ( nD . y ) + 0.66 * u_time ) ) . x + 0.5 * dG ( vec2 ( 7.5 * ( nD . x ) + 0.33 * u_time , 7.5 * ( nD . y ) - 0.33 * u_time ) ) ; nE *= clamp ( 1.2 - sqrt ( 0.2 * nv ) , 0.0 , 1.0 ) * nr ; nz = max ( nE , nz ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cm ( nz / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nr ; varying vec2 ns ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nt ; void lu ( in vec4 ln , in vec3 lo , out vec3 lp ) { float lq = ln . w * lo . x + ln . y * lo . z - ln . z * lo . y ; float lr = ln . w * lo . y + ln . z * lo . x - ln . x * lo . z ; float ls = ln . w * lo . z + ln . x * lo . y - ln . y * lo . x ; float lt = - ln . x * lo . x - ln . y * lo . y - ln . z * lo . z ; lp . x = lq * ln . w - lt * ln . x - lr * ln . z + ls * ln . y ; lp . y = lr * ln . w - lt * ln . y - ls * ln . x + lq * ln . z ; lp . z = ls * ln . w - lt * ln . z - lq * ln . y + lr * ln . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lv = normalize ( u_sun_direction ) ; nt = u_proj_matrix * u_view_matrix * vec4 ( lv , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nr = 1.0 ; vec3 lw = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lx ; lu ( u_camera_quat , lw , lx ) ; lx = normalize ( lx ) ; float ly = dot ( lx , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lz = atan ( lx . x , lx . z ) ; ns = vec2 ( - lz , acos ( ly ) ) ; } else { nr = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nt . x /= nt . w ; nt . y /= nt . w ; nt . x = 0.5 * ( nt . x + 1.0 ) ; nt . y = 0.5 * ( nt . y + 1.0 ) ; nt += 99999.0 * step ( nt . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_main , a ) ; vec3 lo = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gr ( ln . rgb ) ; float lp = cq ( texture2D ( u_god_rays , a ) ) ; vec3 lq = ln . rgb + u_god_rays_intensity * vec3 ( lp ) * lo ; gt ( lq ) ; gl_FragColor . rgb = lq ; gl_FragColor . a = ln . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_color , a ) * 0.38026 ; ln += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; ln += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; ln += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; ln += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; ln += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; ln += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; ln += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; ln += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = ln ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_input , a ) ; float lo = dot ( ln . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lo ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float ln ; float lo = 0.0 ; for ( float lp = 0.025 ; lp < 1.0 ; lp += 0.05 ) for ( float lq = 0.025 ; lq < 1.0 ; lq += 0.05 ) { ln = max ( texture2D ( u_input , vec2 ( lp , lq ) ) . r , 0.01 ) ; lo += log ( ln ) ; } float lr = exp ( lo / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( lr ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nu ; void main ( ) { float nv = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nw = texture2D ( u_luminance , a ) . r ; vec4 nx = texture2D ( u_main , a ) ; float ny = nw / nv ; float nz = u_bloom_edge_lum ; gl_FragColor = nx * max ( ny - nz , 0.0 ) * nu ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nu ; const vec3 ln = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lv ( in vec4 lo , in vec3 lp , out vec3 lq ) { float lr = lo . w * lp . x + lo . y * lp . z - lo . z * lp . y ; float ls = lo . w * lp . y + lo . z * lp . x - lo . x * lp . z ; float lt = lo . w * lp . z + lo . x * lp . y - lo . y * lp . x ; float lu = - lo . x * lp . x - lo . y * lp . y - lo . z * lp . z ; lq . x = lr * lo . w - lu * lo . x - ls * lo . z + lt * lo . y ; lq . y = ls * lo . w - lu * lo . y - lt * lo . x + lr * lo . z ; lq . z = lt * lo . w - lu * lo . z - lr * lo . y + ls * lo . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lw ; lv ( u_camera_quat , ln , lw ) ; nu = dot ( - lw , u_sun_direction ) * u_bloom_key ; nu *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_mb_tex_curr , a ) ; vec4 lo = texture2D ( u_mb_tex_accum , a ) ; if ( length ( ln - lo ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * ln + u_motion_blur_exp * lo ; } else { gl_FragColor = ln ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 ln = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( ln . r + ln . g + ln . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lo = vec2 ( 0.0 , 0.0 ) ; vec2 lp = u_texel_size ; vec4 lq ; lq = texture2D ( u_color , a ) ; gl_FragColor = lq * 0.2270270270 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.1945945946 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.1945945946 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.1216216216 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.1216216216 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.0540540541 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.0540540541 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.0162162162 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lp = u_texel_size ; vec4 lq = texture2D ( u_color , a ) ; gl_FragColor = lq ; if ( lq . a == 0.0 ) { lq = texture2D ( u_color , a + lp ) ; if ( lq . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lq . a ) ; else { lq = texture2D ( u_color , a - lp ) ; if ( lq . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lq . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nw ; varying vec4 nx ; varying vec4 ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nF ( vec2 nA , sampler2D nB ) { float nC = texture2D ( nB , nA ) . r ; float nD = texture2D ( nB , nw . xy ) . r ; float nE = texture2D ( nB , nw . zw ) . r ; return vec3 ( nC , nD , nE ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nL ( vec2 nG , sampler2D nH ) { vec3 nI = nF ( nG , nH ) ; vec2 nJ = abs ( nI . xx - nI . yz ) ; vec2 nK = step ( SMAA_PREDICATION_THRESHOLD , nJ ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nK ) ; }".split(" ")}]}}]},{type:"textline",b:"void nP ( bvec2 nM , inout vec2 nN , vec2 nO ) { if ( nM . x ) nN . x = nO . x ; if ( nM . y ) nN . y = nO . y ; } void nP ( bvec4 nQ , inout vec4 nR , vec4 nS ) { nP ( nQ . xy , nR . xy , nS . xy ) ; nP ( nQ . zw , nR . zw , nS . zw ) ; } vec2 nU ( vec2 nT ) { return sign ( nT ) * floor ( abs ( nT ) + .5 ) ; } vec4 nU ( vec4 nV ) { return sign ( nV ) * floor ( abs ( nV ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ol ( vec2 nW , sampler2D nX".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nY"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nZ = nL ( nW , nY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nZ = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 n_ = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float oa = dot ( texture2D ( nX , nW ) . rgb , n_ ) ; float ob = dot ( texture2D ( nX , nw . xy ) . rgb , n_ ) ; float oc = dot ( texture2D ( nX , nw . zw ) . rgb , n_ ) ; vec4 od ; od . xy = abs ( oa - vec2 ( ob , oc ) ) ; vec2 oe = step ( nZ , od . xy ) ; if ( dot ( oe , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float of = dot ( texture2D ( nX , nx . xy ) . rgb , n_ ) ; float og = dot ( texture2D ( nX , nx . zw ) . rgb , n_ ) ; od . zw = abs ( oa - vec2 ( of , og ) ) ; vec2 oh = max ( od . xy , od . zw ) ; float oi = dot ( texture2D ( nX , ny . xy ) . rgb , n_ ) ; float oj = dot ( texture2D ( nX , ny . zw ) . rgb , n_ ) ; od . zw = abs ( vec2 ( ob , oc ) - vec2 ( oi , oj ) ) ; oh = max ( oh . xy , od . zw ) ; float ok = max ( oh . x , oh . y ) ; oe . xy *= step ( ok , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * od . xy ) ; return oe ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 on ( vec2 om ) { om . r = om . r * abs ( 5.0 * om . r - 5.0 * 0.75 ) ; return nU ( om ) ; } vec4 on ( vec4 oo ) { oo . rb = oo . rb * abs ( 5.0 * oo . rb - 5.0 * 0.75 ) ; return nU ( oo ) ; } vec2 ow ( sampler2D op , vec2 oq , vec2 or , out vec2 os ) { vec4 ot = vec4 ( oq , - 1.0 , 1.0 ) ; vec3 ou = vec3 ( u_texel_size , 1.0 ) ; for ( int ov = 0 ; ov < SMAA_MAX_SEARCH_STEPS_DIAG ; ov ++ ) { if ( ot . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ot . w > 0.9 ) { ot . xyz += ou * vec3 ( or , 1.0 ) ; os = texture2D ( op , ot . xy , 0.0 ) . rg ; ot . w = dot ( os , vec2 ( 0.5 , 0.5 ) ) ; } } return ot . zw ; } vec2 oE ( sampler2D ox , vec2 oy , vec2 oz , out vec2 oA ) { vec4 oB = vec4 ( oy , - 1.0 , 1.0 ) ; oB . x += 0.25 * u_texel_size . x ; vec3 oC = vec3 ( u_texel_size , 1.0 ) ; for ( int oD = 0 ; oD < SMAA_MAX_SEARCH_STEPS_DIAG ; oD ++ ) { if ( oB . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oB . w > 0.9 ) { oB . xyz = oC * vec3 ( oz , 1.0 ) + oB . xyz ; oA = texture2D ( ox , oB . xy , 0.0 ) . rg ; oA = on ( oA ) ; oB . w = dot ( oA , vec2 ( 0.5 , 0.5 ) ) ; } } return oB . zw ; } vec2 oK ( sampler2D oF , vec2 oG , vec2 oH , float oI ) { vec2 oJ = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * oH + oG ; oJ = SMAA_AREATEX_PIXEL_SIZE * oJ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oJ . x += 0.5 ; oJ . y += SMAA_AREATEX_SUBTEX_SIZE * oI ; return texture2D ( oF , oJ , 0.0 ) . rg ; } vec2 oZ ( sampler2D oL , sampler2D oM , vec2 oN , vec2 oO , vec4 oP ) { vec2 oQ = vec2 ( 0.0 , 0.0 ) ; vec4 oR ; vec2 oS ; if ( oO . r > 0.0 ) { oR . xz = ow ( oL , oN , vec2 ( - 1.0 , 1.0 ) , oS ) ; oR . x += float ( oS . y > 0.9 ) ; } else oR . xz = vec2 ( 0.0 , 0.0 ) ; oR . yw = ow ( oL , oN , vec2 ( 1.0 , - 1.0 ) , oS ) ; if ( oR . x + oR . y > 2.0 ) { vec4 oT = vec4 ( - oR . x + 0.25 , oR . x , oR . y , - oR . y - 0.25 ) * u_texel_size . xyxy + oN . xyxy ; vec4 oU ; oU . xy = texture2D ( oL , oT . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oU . zw = texture2D ( oL , oT . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oU . yxwz = on ( oU . xyzw ) ; vec2 oV = vec2 ( 2.0 , 2.0 ) * oU . xz + oU . yw ; nP ( bvec2 ( step ( 0.9 , oR . zw ) ) , oV , vec2 ( 0.0 , 0.0 ) ) ; oQ += oK ( oM , oR . xy , oV , oP . z ) ; } oR . xz = oE ( oL , oN , vec2 ( - 1 , - 1 ) , oS ) ; if ( texture2D ( oL , oN + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oR . yw = oE ( oL , oN , vec2 ( 1 , 1 ) , oS ) ; oR . y += float ( oS . y > 0.9 ) ; } else oR . yw = vec2 ( 0.0 , 0.0 ) ; if ( oR . x + oR . y > 2.0 ) { vec4 oW = vec4 ( - oR . x , - oR . x , oR . y , oR . y ) * u_texel_size . xyxy + oN . xyxy ; vec4 oX ; oX . x = texture2D ( oL , oW . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oX . y = texture2D ( oL , oW . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oX . zw = texture2D ( oL , oW . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oY = vec2 ( 2.0 , 2.0 ) * oX . xz + oX . yw ; nP ( bvec2 ( step ( 0.9 , oR . zw ) ) , oY , vec2 ( 0 , 0 ) ) ; oQ += oK ( oM , oR . xy , oY , oP . w ) . gr ; } return oQ ; }".split(" ")}]}}]},
{type:"textline",b:"float pe ( sampler2D o_ , vec2 pa , float pb ) { vec2 pc = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 pd = SMAA_SEARCHTEX_SIZE * vec2 ( pb , 1.0 ) ; pc += vec2 ( - 1.0 , 1.0 ) ; pd += vec2 ( 0.5 , - 0.5 ) ; pc *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; pd *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( o_ , pc * pa + pd , 0.0 ) . r ; } float pm ( sampler2D pf , sampler2D pg , vec2 ph , float pi ) { vec2 pj = vec2 ( 0.0 , 1.0 ) ; for ( int pk = 0 ; pk < SMAA_MAX_SEARCH_STEPS ; pk ++ ) { if ( ph . x > pi && pj . g > 0.8281 && pj . r == 0.0 ) { pj = texture2D ( pf , ph , 0.0 ) . rg ; ph = - vec2 ( 2.0 , 0.0 ) * u_texel_size + ph ; } } float pl = - ( 255.0 / 127.0 ) * pe ( pg , pj , 0.0 ) + 3.25 ; return u_texel_size . x * pl + ph . x ; } float pu ( sampler2D pn , sampler2D po , vec2 pp , float pq ) { vec2 pr = vec2 ( 0.0 , 1.0 ) ; for ( int ps = 0 ; ps < SMAA_MAX_SEARCH_STEPS ; ps ++ ) { if ( pp . x < pq && pr . g > 0.8281 && pr . r == 0.0 ) { pr = texture2D ( pn , pp , 0.0 ) . rg ; pp = vec2 ( 2.0 , 0.0 ) * u_texel_size + pp ; } } float pt = - ( 255.0 / 127.0 ) * pe ( po , pr , 0.5 ) + 3.25 ; return - u_texel_size . x * pt + pp . x ; } float pC ( sampler2D pv , sampler2D pw , vec2 px , float py ) { vec2 pz = vec2 ( 1.0 , 0.0 ) ; for ( int pA = 0 ; pA < SMAA_MAX_SEARCH_STEPS ; pA ++ ) { if ( px . y > py && pz . r > 0.8281 && pz . g == 0.0 ) { pz = texture2D ( pv , px , 0.0 ) . rg ; px = - vec2 ( 0.0 , 2.0 ) * u_texel_size + px ; } } float pB = - ( 255.0 / 127.0 ) * pe ( pw , pz . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pB + px . y ; } float pK ( sampler2D pD , sampler2D pE , vec2 pF , float pG ) { vec2 pH = vec2 ( 1.0 , 0.0 ) ; for ( int pI = 0 ; pI < SMAA_MAX_SEARCH_STEPS ; pI ++ ) { if ( pF . y < pG && pH . r > 0.8281 && pH . g == 0.0 ) { pH = texture2D ( pD , pF , 0.0 ) . rg ; pF = vec2 ( 0.0 , 2.0 ) * u_texel_size + pF ; } } float pJ = - ( 255.0 / 127.0 ) * pe ( pE , pH . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pJ + pF . y ; } vec2 pR ( sampler2D pL , vec2 pM , float pN , float pO , float pP ) { vec2 pQ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nU ( 4.0 * vec2 ( pN , pO ) ) + pM ; pQ = SMAA_AREATEX_PIXEL_SIZE * pQ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pQ . y = SMAA_AREATEX_SUBTEX_SIZE * pP + pQ . y ; return texture2D ( pL , pQ , 0.0 ) . rg ; } void pZ ( sampler2D pS , inout vec2 pT , vec4 pU , vec2 pV ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pW = step ( pV . xy , pV . yx ) ; vec2 pX = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pW ; pX /= pW . x + pW . y ; vec2 pY = vec2 ( 1.0 , 1.0 ) ; pY . x -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pY . x -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pY . y -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pY . y -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pT *= clamp ( pY , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void qg ( sampler2D p_ , inout vec2 qa , vec4 qb , vec2 qc ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 qd = step ( qc . xy , qc . yx ) ; vec2 qe = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * qd ; qe /= qd . x + qd . y ; vec2 qf = vec2 ( 1.0 , 1.0 ) ; qf . x -= qe . x * texture2D ( p_ , qb . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; qf . x -= qe . y * texture2D ( p_ , qb . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; qf . y -= qe . x * texture2D ( p_ , qb . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; qf . y -= qe . y * texture2D ( p_ , qb . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; qa *= clamp ( qf , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qz ( vec2 qh , vec2 qi , sampler2D qj , sampler2D qk , sampler2D ql , vec4 qm ) { vec4 qn = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qo = texture2D ( qj , qh ) . rg ; if ( qo . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qn . rg = oZ ( qj , qk , qh , qo , qm ) ; if ( qn . r == - qn . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qp ; vec3 qq ; qq . x = pm ( qj , ql , nw . xy , ny . x ) ; qq . y = nx . y ; qp . x = qq . x ; float qr = texture2D ( qj , qq . xy , 0.0 ) . r ; qq . z = pu ( qj , ql , nw . zw , ny . y ) ; qp . y = qq . z ; qp = abs ( nU ( qp / u_texel_size . xx - qi . xx ) ) ; vec2 qs = sqrt ( qp ) ; float qt = texture2D ( qj , qq . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qn . rg = pR ( qk , qs , qr , qt , qm . y ) ; qq . y = qh . y ; pZ ( qj , qn . rg , qq . xyzy , qp ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qo . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qo . r > 0.0 ) { vec2 qu ; vec3 qv ; qv . y = pC ( qj , ql , nx . xy , ny . z ) ; qv . x = nw . x ; qu . x = qv . y ; float qw = texture2D ( qj , qv . xy , 0.0 ) . g ; qv . z = pK ( qj , ql , nx . zw , ny . w ) ; qu . y = qv . z ; qu = abs ( nU ( qu / u_texel_size . yy - qi . yy ) ) ; vec2 qx = sqrt ( qu ) ; float qy = texture2D ( qj , qv . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qn . ba = pR ( qk , qx , qw , qy , qm . x ) ; qv . x = qh . x ; qg ( qj , qn . ba , qv . xyxz , qu ) ; } return qn ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ ( vec2 qA , sampler2D qB , sampler2D qC".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qD"]}]}}]},{type:"textline",b:") { vec4 qE ; qE . x = texture2D ( qC , nv . xy ) . a ; qE . y = texture2D ( qC , nv . zw ) . g ; qE . wz = texture2D ( qC , qA ) . xz ; if ( dot ( qE , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qF = texture2D ( qB , qA , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qG = texture2D ( qD , a ) ; vec2 qH = 2.0 * cy ( qG ) - 1.0 ; qF . a = sqrt ( 2.0 * length ( qH ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qF ; } else { bool qI = max ( qE . x , qE . z ) > max ( qE . y , qE . w ) ; vec4 qJ = vec4 ( 0.0 , qE . y , 0.0 , qE . w ) ; vec2 qK = qE . yw ; nP ( bvec4 ( qI , qI , qI , qI ) , qJ , vec4 ( qE . x , 0.0 , qE . z , 0.0 ) ) ; nP ( bvec2 ( qI , qI ) , qK , qE . xz ) ; qK /= dot ( qK , vec2 ( 1.0 , 1.0 ) ) ; vec4 qL = qJ * vec4 ( u_texel_size , - u_texel_size ) + qA . xyxy ; vec4 qM = qK . x * texture2D ( qB , qL . xy , 0.0 ) ; qM += qK . y * texture2D ( qB , qL . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qN = texture2D ( qD , qL . xy ) ; vec2 qO = 2.0 * cy ( qN ) - 1.0 ; vec2 qP = qK . x * qO ; qN = texture2D ( qD , qL . zw ) ; qO = 2.0 * cy ( qN ) - 1.0 ; qP += qK . y * qO ; qM . a = sqrt ( 2.0 * length ( qP ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qM",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 rb ( vec2 qR , sampler2D qS , sampler2D qT".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qU"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = texture2D ( qU , a ) ; vec2 qW ; qW = 2.0 * cy ( qV ) - 1.0 ; vec4 qX = texture2D ( qS , qR ) ; vec4 qY = texture2D ( qT , qR - qW ) ; float qZ = abs ( qX . a * qX . a - qY . a * qY . a ) / 2.0 ; float q_ = 0.5 * clamp ( 1.0 - sqrt ( qZ ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 ra = mix ( qX , qY , q_ ) ; ra . a = 1.0 ; return ra ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qX = texture2D ( qS , qR ) ; vec4 qY = texture2D ( qT , qR ) ; return mix ( qX , qY , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = vec4 ( ol ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = qz ( a , nz , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = qQ ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = vec4 ( rb ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 rc = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","rc",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nw ; varying vec4 nx ; varying vec4 ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lo ( vec2 ln ) { nw = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + ln . xyxy ; nx = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + ln . xyxy ; ny = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + ln . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void lr ( vec2 lp , out vec2 lq ) { lq = lp / u_texel_size ; nw = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lp . xyxy ; nx = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lp . xyxy ; ny = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nw . xz , nx . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lt ( vec2 ls ) { nv = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + ls . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lo","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"lr ( a , nz ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lt","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float nB ( in vec2 nA ) { return nq ( u_depth , nA , u_camera_range ) ; } void main ( ) { float nC = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nC , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nD = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float nE = nB ( a ) ; float nF = nE * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nG = 8.0 ; const int nH = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nG = 16.0 ; const int nH = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nG = 24.0 ; const int nH = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nG = 32.0 ; const int nH = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nI = u_ssao_radius_increase * 0.001 ; const float nJ = 1.0 + 2.4 / nG ; float nK = 0.0 ; for ( int nL = 0 ; nL < nH ; nL ++ ) for ( int nM = - 1 ; nM <= 1 ; nM += 2 ) for ( int nN = - 1 ; nN <= 1 ; nN += 2 ) for ( int nO = - 1 ; nO <= 1 ; nO += 2 ) { vec3 nP = reflect ( normalize ( vec3 ( nM , nN , nO ) ) , nD ) * ( nI *= nJ ) ; vec3 nQ = vec3 ( a , nF ) ; nQ += vec3 ( nP . xy , nP . z * nF * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nQ . z -= 1.4 * ( nQ . z - nF ) * step ( nF , nQ . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nR = nB ( nQ . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nS = clamp ( ( nF - nR ) / nR , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nK += mix ( 1.0 , nS , step ( nR , nQ . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"nK += mix ( step ( nQ . z , nR ) , 0.5 , nS ) ;".split(" ")}]}}]},{type:"textline",b:"} nK = nK / nG ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nK = clamp ( nK * nK + 0.6 * nK , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nK = clamp ( nK * nK + nK , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nT = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nE ) ; nK = mix ( 1.0 , nK , nT ) ; gl_FragColor = vec4 ( nC , nK , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float nB ( in vec2 nA ) { return nq ( u_depth , nA , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nC = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nD = nB ( a ) ; float nE = 0.0 ; float nF = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nG = vec2 ( - 2.0 ) ; for ( int nH = 0 ; nH < 4 ; ++ nH ) { for ( int nI = 0 ; nI < 4 ; ++ nI ) { vec2 nJ = ( nG + vec2 ( float ( nH ) , float ( nI ) ) ) * u_texel_size ; float nK = texture2D ( u_ssao_mask , a + nJ ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nL = nB ( a + nJ ) ; float nM = 1.0 - clamp ( abs ( nL - nD ) * nF , 0.0 , 1.0 ) ; nC += nK * nM ; nE += nM ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nC","+=","nK",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nC / nE , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nC / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float ln = texture2D ( u_depth , a ) . x ; vec4 lo = vec4 ( a * 2.0 - 1.0 , 2.0 * ln - 1.0 , 1.0 ) ; vec4 lp = u_view_proj_inverse * lo ; vec4 lq = lp / lp . w ; vec4 lr = u_view_proj_prev * lq ; lr /= lr . w ; vec2 ls = ( lo . xy - lr . xy ) / 4.0 + 0.5 ; ls = clamp ( ls , 0.0 , 1.0 ) ; gl_FragColor = cm ( ls ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:"return U ; } d ah ( in vec3 ab , in vec3 ac , in vec3 ad , in vec3 ae , in vec3 af , in mat4 ag ) { ab = ( ag * vec4 ( ab , 1.0 ) ) . xyz ; ac = ( ag * vec4 ( ac , 1.0 ) ) . xyz ; ad = ( ag * vec4 ( ad , 0.0 ) ) . xyz ; ae = ( ag * vec4 ( ae , 0.0 ) ) . xyz ; af = ( ag * vec4 ( af , 0.0 ) ) . xyz ; return s ( d ( ab , ac , ad , ae , af , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 ak ( vec2 ai , vec3 aj ) { return ( ai + 0.5 ) * aj . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 at ( in vec4 al , in vec4 am , in float an ) { float ao = al [ 0 ] * am [ 0 ] + al [ 1 ] * am [ 1 ] + al [ 2 ] * am [ 2 ] + al [ 3 ] * am [ 3 ] ; if ( ao < 0.0 ) { am *= - 1.0 ; ao = - ao ; } if ( abs ( ao ) >= 1.0 ) return al ; float ap = acos ( ao ) ; float aq = sqrt ( 1.0 - ao * ao ) ; if ( abs ( aq ) < 0.001 ) return vec4 ( al * 0.5 + am * 0.5 ) ; float ar = sin ( ( 1.0 - an ) * ap ) / aq ; float as = sin ( an * ap ) / aq ; return al * ar + am * as ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aI ( in vec3 au , in vec4 av , in vec4 aw , in vec4 ax , in vec4 ay , in float az ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aA = at ( av , aw , az ) ; vec4 aB = mix ( ax , ay , az ) ; vec3 aC = j ( aA , au ) ; vec3 aD = aC * aB . w + aB . xyz ; return aD ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aE = j ( av , au ) ; vec3 aF = j ( aw , au ) ; vec3 aG = aE * ax . w + ax . xyz ; vec3 aH = aF * ay . w + ay . xyz ; return mix ( aG , aH , az ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aR ( in vec3 aJ , in vec4 aK , in vec4 aL , in float aM ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aN = at ( aK , aL , aM ) ; vec3 aO = j ( aN , aJ ) ; return aO ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aP = j ( aK , aJ ) ; vec3 aQ = j ( aL , aJ ) ; return mix ( aP , aQ , aM ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aI ( in vec3 aS , in vec4 aT , in vec4 aU ) { vec3 aV = j ( aT , aS ) ; vec3 aW = aV * aU . w + aU . xyz ; return aW ; } vec3 aR ( in vec3 aX , in vec4 aY ) { vec3 aZ = j ( aY , aX ) ; return aZ ; }".split(" ")}]}}]},{type:"textline",b:"void bn ( inout vec3 a_ , inout vec3 ba , inout vec3 bb , inout vec3 bc ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bd","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 be = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bh = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bi = a_influence ; for ( int bj = 0 ; bj < 4 ; bj ++ ) { int bk = int ( bi [ bj ] ) ; float bl = fract ( bi [ bj ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"be += bl * aI ( a_ , u_quatsb [ bk ] , u_quatsa [ bk ] , u_transb [ bk ] , u_transa [ bk ] , bd ) ; bf += bl * aR ( ba , u_quatsb [ bk ] , u_quatsa [ bk ] , bd ) ; bg += bl * aR ( bb , u_quatsb [ bk ] , u_quatsa [ bk ] , bd ) ; bh += bl * aR ( bc , u_quatsb [ bk ] , u_quatsa [ bk ] , bd ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"be += bl * aI ( a_ , u_quatsb [ bk ] , u_transb [ bk ] ) ; bf += bl * aR ( ba , u_quatsb [ bk ] ) ; bg += bl * aR ( bb , u_quatsb [ bk ] ) ; bh += bl * aR ( bc , u_quatsb [ bk ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} a_ = be ; ba = bf ; bb = bg ; bc = bh ; } if ( ! ( a_influence . y > 0.0 ) ) { int bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"a_ = aI ( a_ , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , bd ) ; ba = aR ( ba , u_quatsb [ bm ] , u_quatsa [ bm ] , bd ) ; bb = aR ( bb , u_quatsb [ bm ] , u_quatsa [ bm ] , bd ) ; bc = aR ( bc , u_quatsb [ bm ] , u_quatsa [ bm ] , bd ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"a_ = aI ( a_ , u_quatsb [ bm ] , u_transb [ bm ] ) ; ba = aR ( ba , u_quatsb [ bm ] ) ; bb = aR ( bb , u_quatsb [ bm ] ) ; bc = aR ( bc , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bB ( inout vec3 bo , in vec3 bp , in float bq , in float br , in float bs , in vec3 bt , in float bu ) { float bv = length ( bp ) ; float bw = br * ( 1.0 + 0.1 * fract ( bv ) ) ; float bx = bq * bu * ( 1.0 + sin ( 2.0 * 3.14 * bs * bw + bv ) ) ; float by = ( bo . y - bp . y ) * abs ( bx ) ; by += 1.0 ; by *= by ; by = by * by - by ; vec3 bz = bo ; bz . xz += bt . xz * by * sign ( bx ) ; float bA = length ( bo - bp ) ; bo = bp + normalize ( bz - bp ) * bA ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bD ( vec4 bC ) { return bC * bC * ( 3.0 - 2.0 * bC ) ; } vec4 bF ( vec4 bE ) { return abs ( fract ( bE + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bH ( vec4 bG ) { return bD ( bF ( bG ) ) ; } void bY ( inout vec3 bI , in float bJ , in vec3 bK , in vec3 bL , in vec3 bM , in float bN , in float bO , in float bP , in vec3 bQ ) { float bR ; float bS ; float bT ; vec2 bU ; vec4 bV ; vec2 bW ; vec3 bX ; bR = dot ( bM , vec3 ( 1.0 ) ) ; bS = bR + bQ . g ; bT = dot ( bI , vec3 ( bQ . g ) ) ; bU = ( bJ + vec2 ( bT , bS ) ) ; bV = ( ( fract ( ( bU . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bL ) * bN ; bV = bH ( bV ) ; bW = bV . xz + bV . yw ; bW . y = 0.5 - bW . y ; bX = bW . xyx * bQ . rbr * vec3 ( bO * bK . x , bP , bO * bK . z ) ; bI += bX ; }".split(" ")}]}}]},
{type:"textline",b:"void ce ( inout vec3 bZ , inout vec3 b_ , in vec3 ca ) { vec3 cb = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 cc = b_ ; vec3 cd = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cc = bZ ; vec3 cd = b_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bY ( cc , u_time , ca , cb , cd , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bB ( cc , cd , au_wind_bending_amp , au_wind_bending_freq , u_time , cb , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bB ( cc , cd , au_wind_bending_amp , au_wind_bending_freq , u_time , cb , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bZ += cc - b_ ; b_ = cc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bZ = cc ; b_ = cd ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cf = 255.0 ; float cg = 0.0 ; float ch = 1.0 ; vec4 cm ( const in float ci ) { vec4 cj = vec4 ( cf * cf * cf , cf * cf , cf , ch ) ; vec4 ck = vec4 ( cg , ch / cf , ch / cf , ch / cf ) ; vec4 cl = fract ( ci * cj ) ; cl -= cl . xxyz * ck ; return cl ; } float cq ( const in vec4 cn ) { float co ; vec4 cp = vec4 ( ch / ( cf * cf * cf ) , ch / ( cf * cf ) , ch / cf , ch ) ; co = dot ( cn , cp ) ; return co ; } vec4 cm ( const in vec2 cr ) { vec2 cs = vec2 ( cf , ch ) ; vec2 ct = vec2 ( cg , ch / cf ) ; vec4 cu = fract ( cr . xxyy * cs . xyxy ) ; cu -= cu . xxzz * ct . xyxy ; if ( cr . r == ch ) cu . rg = vec2 ( cg , ch ) ; if ( cr . g == ch ) cu . ba = vec2 ( cg , ch ) ; return cu ; } vec2 cy ( const in vec4 cv ) { vec2 cw ; vec2 cx = vec2 ( ch / cf , ch ) ; cw . r = dot ( cv . rg , cx ) ; cw . g = dot ( cv . ba , cx ) ; return cw ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cG = 0.0 ; float cH = 1.0 ; vec4 cJ ( vec4 cI ) { return cI - floor ( cI * ( cH / 289.0 ) ) * 289.0 ; } vec3 cJ ( vec3 cK ) { return cK - floor ( cK * ( cH / 289.0 ) ) * 289.0 ; } vec2 cJ ( vec2 cL ) { return cL - floor ( cL * ( cH / 289.0 ) ) * 289.0 ; } vec4 cN ( vec4 cM ) { return cM - floor ( cM * ( cH / 7.0 ) ) * 7.0 ; } vec4 cP ( vec4 cO ) { return cJ ( ( 34.0 * cO + 5.0 ) * cO ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 da ( vec2 cQ ) { vec2 cR = cJ ( floor ( cQ ) ) ; vec2 cS = fract ( cQ ) ; vec4 cT = cS . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 cU = cS . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 cV = cP ( cR . x + vec4 ( cG , cH , cG , cH ) ) ; cV = cP ( cV + cR . y + vec4 ( cG , cG , cH , cH ) ) ; vec4 cW = cN ( cV ) * K + K2 ; vec4 cX = cN ( floor ( cV * K ) ) * K + K2 ; vec4 cY = cT + JITTER * cW ; vec4 cZ = cU + JITTER * cX ; vec4 c_ = cY * cY + cZ * cZ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"c_ . xy = min ( c_ . xy , c_ . zw ) ; c_ . x = min ( c_ . x , c_ . y ) ; return c_ . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c_ . xy = ( c_ . x < c_ . y ) ? c_ . xy : c_ . yx ; c_ . xz = ( c_ . x < c_ . z ) ? c_ . xz : c_ . zx ; c_ . xw = ( c_ . x < c_ . w ) ? c_ . xw : c_ . wx ; c_ . y = min ( c_ . y , c_ . z ) ; c_ . y = min ( c_ . y , c_ . w ) ; return sqrt ( c_ . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dq ( vec2 db , float dc ) { vec2 dd = cJ ( floor ( db ) ) ; vec2 de = fract ( db ) ; vec4 df = de . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dg = de . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dh = cP ( dd . x + vec4 ( cG , cH , cG , cH ) ) ; dh = cP ( dh + dd . y + vec4 ( cG , cG , cH , cH ) ) ; vec4 di = cN ( dh ) * K + K2 ; vec4 dj = cN ( floor ( dh * K ) ) * K + K2 ; vec4 dk = df + JITTER * di ; vec4 dl = dg + JITTER * dj ; vec4 dm = dk * dk + dl * dl ; dk += dc ; dl += dc ; vec4 dn = dk * dk + dl * dl ; dk += dc ; dl += dc ; vec4 dp = dk * dk + dl * dl ; dm . xy = min ( dm . xy , dm . zw ) ; dm . x = min ( dm . x , dm . y ) ; dn . xy = min ( dn . xy , dn . zw ) ; dn . x = min ( dn . x , dn . y ) ; dp . xy = min ( dp . xy , dp . zw ) ; dp . x = min ( dp . x , dp . y ) ; return mat3 ( dm . xx , cG , dn . xx , cG , dp . xx , cG ) ; } vec3 ds ( vec3 dr ) { return cJ ( ( ( dr * 34.0 ) + cH ) * dr ) ; } float dG ( vec2 dt ) { const vec4 du = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dv = floor ( dt + dot ( dt , du . yy ) ) ; vec2 dw = dt - dv + dot ( dv , du . xx ) ; vec2 dx ; dx = ( dw . x > dw . y ) ? vec2 ( cH , cG ) : vec2 ( cG , cH ) ; vec4 dy = dw . xyxy + du . xxzz ; dy . xy -= dx ; dv = cJ ( dv ) ; vec3 dz = ds ( ds ( dv . y + vec3 ( cG , dx . y , cH ) ) + dv . x + vec3 ( cG , dx . x , cH ) ) ; vec3 dA = max ( 0.5 - vec3 ( dot ( dw , dw ) , dot ( dy . xy , dy . xy ) , dot ( dy . zw , dy . zw ) ) , cG ) ; dA = dA * dA ; dA = dA * dA ; vec3 dB = 2.0 * fract ( dz * du . www ) - cH ; vec3 dC = abs ( dB ) - 0.5 ; vec3 dD = floor ( dB + 0.5 ) ; vec3 dE = dB - dD ; dA *= 1.79284291400159 - 0.85373472095314 * ( dE * dE + dC * dC ) ; vec3 dF ; dF . x = dE . x * dw . x + dC . x * dw . y ; dF . yz = dE . yz * dy . xz + dC . yz * dy . yw ; return 130.0 * dot ( dA , dF ) ; } vec2 dM ( vec2 dH ) { float dI = dot ( dH , vec2 ( 12.9898 , 78.233 ) ) ; float dJ = dot ( dH , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dK = fract ( sin ( dI ) * 43758.5453 ) * 2.0 - cH ; float dL = fract ( sin ( dJ ) * 43758.5453 ) * 2.0 - cH ; return vec2 ( dK , dL ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dN",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dO = 0.1 ; const float dP = 0.1 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dQ = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dR = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dS = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"textline",b:"float ee ( vec3 dT , sampler2D dU , float dV ) { float dW ; dT . z = clamp ( dT . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dW = 0.0 ; float dX = dM ( dT . xy ) . x * M_PI ; float dY = cos ( dX ) ; float dZ = sin ( dX ) ; mat2 d_ = mat2 ( dY , dZ , - dZ , dY ) ; vec2 ea , eb ; for ( int ec = 0 ; ec < 4 ; ec ++ ) for ( int ed = 0 ; ed < 4 ; ed ++ ) { eb . x = dR [ ec ] [ ed ] ; eb . y = dS [ ec ] [ ed ] ; eb = d_ * eb ; ea = dT . xy + eb * dV / SHADOW_TEX_RES ; dW += step ( dT . z , texture2D ( dU , ea ) . r ) ; } dW /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dW","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dW , 0.0 , 1.0 ) ; } float ew ( vec3 ef , sampler2D eg , vec3 eh , sampler2D ei , float ej , float ek , float el ) { float em , en ; ef . z = clamp ( ef . z , 0.0 , 1.0 ) ; eh . z = clamp ( eh . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"em = 0.0 ; en = 0.0 ; float eo = dM ( ef . xy ) . x * M_PI ; float ep = cos ( eo ) ; float eq = sin ( eo ) ; mat2 er = mat2 ( ep , eq , - eq , ep ) ; vec2 es , et ; for ( int eu = 0 ; eu < 4 ; eu ++ ) for ( int ev = 0 ; ev < 4 ; ev ++ ) { et . x = dR [ eu ] [ ev ] ; et . y = dS [ eu ] [ ev ] ; et = er * et ; es = ef . xy + et * ej / SHADOW_TEX_RES ; em += step ( ef . z , texture2D ( eg , es ) . r ) ; es = eh . xy + et * ek / SHADOW_TEX_RES ; en += step ( eh . z , texture2D ( ei , es ) . r ) ; } em = mix ( em , en , el ) ; em /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["em","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( em , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool ez ( vec2 ex , float ey ) { return all ( lessThanEqual ( ex , vec2 ( 1.0 + ey ) ) ) && all ( greaterThanEqual ( ex , vec2 ( 0.0 - ey ) ) ) ; } float eD ( vec2 eA ) { float eB = min ( eA . x , eA . y ) ; float eC = min ( 1.0 - eA . x , 1.0 - eA . y ) ; return min ( eB , eC ) ; } float eG ( float eE , float eF ) { if ( eF >= 0.0 && eF <= dP ) eE = ( eE - 1.0 ) / dP * eF + 1.0 ; return eE ; } float eS ( vec3 eH , vec3 eI , sampler2D eJ , sampler2D eK , float eL , float eM , float eN , float eO ) { float eP ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eQ = eD ( eH . xy ) ; if ( - eO > eN && eQ >= 0.0 && eQ <= dO && ez ( eI . xy , 0.0 ) ) { float eR = 1.0 - eQ / dO ; eP = ew ( eH , eJ , eI , eK , eL , eM , eR ) ; } else".split(" ")}]}}]},{type:"textline",b:"eP = ee ( eH , eJ , eL ) ; return eP ; } float e_ ( vec3 eT , sampler2D eU , float eV , float eW , float eX ) { float eY = ee ( eT , eU , eV ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eX > eW ) { float eZ = eD ( eT . xy ) ; eY = eG ( eY , eZ ) ; }".split(" ")}]}}]},{type:"textline",b:"return eY ; } float fg ( float fa ) { float fb = 1.0 ; vec3 fc = cA . xyz / cA . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fd = cB . xyz / cB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fe = cC . xyz / cC . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 ff = cD . xyz / cD . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ez ( fc . xy , 0.0 ) ) { fb = eS ( fc , fd , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fa ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( ez ( fc . xy , dQ ) ) { fb = e_ ( fc , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fa ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ez ( fd . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fb = eS ( fd , fe , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fa ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fb = e_ ( fd , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fa ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ez ( fe . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fb = eS ( fe , ff , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fa ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fb = e_ ( fe , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fa ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ez ( ff . xy , 0.0 ) ) fb = e_ ( ff , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fa ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fb",";","}"]}]}}]}]}}]},{type:"textline",b:"float fl ( inout vec3 fh ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fi = texture2DProj ( u_shadow_mask , cE ) . rg ; vec3 fj = vec3 ( fi . r ) ; float fk = fi . g ; dN = vec4 ( fj , fk ) ; fh *= dN . a ; return dN . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fg ( cF . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fq ( vec3 fm , float fn , vec2 fo ) { vec2 fp = vec2 ( ( fm . x - fo . x ) / fn , - ( fm . z - fo . y ) / fn ) ; return fract ( fp ) ; } vec2 fu ( vec2 fr , float fs , vec2 ft ) { return vec2 ( fr . x * fs , - fr . y * fs ) + ft ; } d fv ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d ga ( vec3 fw , vec3 fx , vec3 fy , vec3 fz , vec3 fA , sampler2D fB , sampler2D fC , vec3 fD , float fE , vec3 fF , vec4 fG , mat4 fH ) { vec3 fI = j ( fG , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fJ = - fI . x ; float fK = - fI . z ; vec2 fL = vec2 ( fF . x + fE * ( - 1.0 - fJ ) / 2.0 , fF . z + fE * ( 1.0 - fK ) / 2.0 ) ; vec2 fM = fq ( fA , fE , fL ) ; float fN = fE / 2.0 ; vec2 fO = abs ( fu ( fM - vec2 ( 0.5 ) , fE , vec2 ( 0.0 ) ) ) ; float fP = fN * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fO ) > fP ) return fv ( ) ; float fQ = fE / fD . z ; vec2 fR = ( fM - vec2 ( 0.5 ) ) * fQ + vec2 ( 0.5 ) ; vec3 fS = fI * ( fE / fD . z - 1.0 ) / 2.0 ; fR . x += fS . x ; fR . y -= fS . z ; vec4 fT = texture2D ( fC , fR ) ; float fU = fT . r ; if ( fU < u_scale_threshold ) return fv ( ) ; float fV = fD . y - fD . x ; float fW = fD . y - texture2D ( fB , fR ) . r * fV ; vec2 fX = fw . xz - fA . xz ; fA . xz = fu ( fM , fE , fL ) ; fA . y = fW ; fw . xz = fA . xz + fX ; fw . y *= fU ; fw . y += fW ; vec3 fY = fT . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fw -= fA ; mat4 fZ = aa ( fF , fA , fH ) ; d f_ = ah ( fw , fA , fx , fy , fz , fZ ) ; f_ . b = fA ; f_ . f = fY ; return s ( f_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fw , fA , fx , fy , fz , fY ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gg ( mat4 gb , vec4 gc ) { vec2 gd = ( gb * u_v_light_matrix [ 3 ] ) . xy ; float ge = SHADOW_TEX_RES / 2.0 ; gd = floor ( gd * ge + 0.5 ) / ge - gd ; vec4 gf = gb * gc ; gf . xy += gd ; gf = u_b_light_matrix * gf ; return gf ; } void gk ( vec3 gh ) { vec3 gi = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gj = u_v_light_matrix * vec4 ( gh + u_normal_offset * gi , 1.0 ) ; cA = gg ( u_p_light_matrix0 , gj ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cB = gg ( u_p_light_matrix1 , gj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cC = gg ( u_p_light_matrix2 , gj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cD = gg ( u_p_light_matrix3 , gj ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gk ( vec4 gl ) { float gm = gl . x ; float gn = gl . y ; float go = gl . w ; cE . x = ( gm + go ) / 2.0 ; cE . y = ( gn + go ) / 2.0 ; cE . z = go ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gr ( inout vec3 gq ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gq = max ( vec3 ( 0.0 ) , gq ) ; gq = pow ( gq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gt ( inout vec3 gs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gs = max ( vec3 ( 0.0 ) , gs ) ; gs = pow ( gs , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gw ( inout vec3 gu , in float gv ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gu = gu * gv ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gE ( inout vec3 gz , in float gA , in vec4 gB ) { float gC = gB . w * gA ; float gD = exp ( - gC * gC ) ; gD = clamp ( gD , 0.0 , 1.0 ) ; gz = mix ( gB . rgb , gz , gD ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gL ( in mat4 gF , in vec3 gG ) { vec3 gH = mix ( gF [ 0 ] . rgb , gF [ 1 ] . rgb , max ( sign ( gG . x ) , 0.0 ) ) ; vec3 gI = mix ( gF [ 2 ] . rgb , gF [ 3 ] . rgb , max ( sign ( gG . z ) , 0.0 ) ) ; vec3 gJ = vec3 ( gF [ 0 ] . a , gF [ 1 ] . a , gF [ 2 ] . a ) ; vec3 gK = mix ( gH , gI , abs ( gG . z ) ) ; gK = mix ( gK , gJ , abs ( gG . y ) ) ; return gK ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gN ( inout float gM ) { gM -= 0.5 ; gM = 4.0 * ( gM * gM * gM ) + 0.5 ; } void hd ( inout vec3 gO , in float gP , in vec3 gQ , in float gR , in vec4 gS , in vec4 gT , in float gU , in float gV ) { float gW = gT . w * gP ; float gX = exp ( - gW * gW ) ; gX = clamp ( gX , 0.0 , 1.0 ) ; float gY = max ( gQ . y , 0.0 ) ; gP = max ( gP - max ( gR / gY , 0.0 ) , 0.0 ) ; float gZ = gS . w * gP ; float g_ = 1.0 - gZ ; g_ = max ( g_ , 0.0 ) ; gN ( g_ ) ; g_ += max ( gU - 0.5 , 0.0 ) ; if ( g_ < gX ) { vec3 ha = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hb = gS . rgb ; gR = clamp ( - gR * 0.03 , 0.0 , 0.8 ) ; vec3 hc = mix ( hb , ha , min ( gY , 1.0 ) ) ; hc = mix ( hc , vec3 ( 0.0 ) , gR ) * gV ; gO = mix ( hc , gO , g_ ) ; } if ( g_ >= gX ) { gO = mix ( gT . rgb , gO , gX ) ; } } void hm ( inout vec3 he , in float hf , in float hg , in vec4 hh , in float hi ) { float hj = hh . w * hf ; float hk = 1.0 - hj ; hk = clamp ( hk , 0.0 , 1.0 ) ; gN ( hk ) ; hg = clamp ( - hg * 0.03 , 0.0 , 0.8 ) ; vec3 hl = mix ( hh . rgb , vec3 ( 0.0 ) , hg ) * hi ; he = mix ( hl , he , hk ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hn = 0.0 ; float ho = 1.0 ; struct hp { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hx ( vec3 hq , vec3 hr , vec3 hs , vec4 ht , float hu ) { vec3 hv = normalize ( hq + hr ) ; float hw = ht [ 0 ] * max ( dot ( hs , hv ) , hn ) + ht [ 1 ] ; return pow ( hw , hu ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hI ( vec3 hy , vec3 hz , vec3 hA , float hB ) { vec3 hC = normalize ( hy + hz ) ; float hD = max ( dot ( hA , hC ) , 0.001 ) ; float hE = max ( dot ( hA , hz ) , 0.01 ) ; float hF = max ( dot ( hA , hy ) , 0.01 ) ; float hG = tan ( acos ( hD ) ) ; float hH = max ( hB , 0.001 ) ; return hF * ( ho / ( 4.0 * M_PI * hH * hH ) ) * ( exp ( - ( hG * hG ) / ( hH * hH ) ) / ( sqrt ( hE * hF ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hQ ( vec3 hJ , vec3 hK , vec3 hL , float hM , float hN ) { vec3 hO = normalize ( hJ + hK ) ; float hP = acos ( dot ( hO , hL ) ) ; if ( hP < hM ) return ho ; else if ( hP >= hM + hN || hN == hn ) return hn ; else return ho - ( hP - hM ) / hN ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void ik ( float hR , vec3 hS , vec3 hT , vec3 hU , float hV , inout float hW ) { if ( hV > hn ) { float hX = max ( dot ( hS , hU ) , hn ) ; float hY = hV * hV ; float hZ = ho - 0.5 * ( hY / ( hY + 0.33 ) ) ; vec3 h_ = hT - hR * hS ; vec3 ia = hU - hX * hS ; if ( length ( h_ ) == hn || length ( ia ) == hn || abs ( hR ) > ho || abs ( hX ) > ho ) hW = hW * hZ ; else { float ib = acos ( hR ) ; float ic = acos ( hX ) ; vec3 id = normalize ( h_ ) ; vec3 ie = normalize ( ia ) ; float ig , ih ; ig = max ( ib , ic ) ; ih = min ( ib , ic ) ; ih *= 0.95 ; float ii = max ( dot ( id , ie ) , hn ) ; float ij = 0.45 * ( hY / ( hY + 0.09 ) ) ; hW = hW * ( hZ + ( ij * ii * sin ( ig ) * tan ( ih ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void is ( vec3 il , vec3 im , float io , float ip , out float iq ) { float ir ; if ( io == hn ) { iq = ho ; } else { ir = ho + abs ( dot ( im , il ) ) ; ir = ip + ( ho - ip ) * pow ( ir , io ) ; iq = clamp ( ir , hn , ho ) ; } }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"void i_ ( inout hp it , vec3 iu , vec3 iv , vec3 iw , vec3 ix , vec3 iy , vec2 iz , vec2 iA , float iB , vec3 iC , vec3 iD , vec3 iE , vec4 iF , vec4 iG , float iH , vec4 iI ) { if ( iF . w + iG . w == hn ) return ; vec3 iJ = vec3 ( hn ) ; vec3 iK = iE * iB ; float iL = iG . z ; if ( iL != - ho ) { iJ = iC - iw ; float iM = length ( iJ ) ; iK *= iL / ( iL + iM * iM ) ; iJ = normalize ( iJ ) ; float iN = iG . x ; float iO = iG . y ; if ( iN > - ho ) { float iP = dot ( iJ , iD ) ; iP *= smoothstep ( hn , ho , ( iP - iN ) / iO ) ; iK *= iP ; } } else iJ = iD ; float iQ = hn ; if ( iF . w != hn ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"is ( ix , iJ , iA [ 0 ] , iA [ 1 ] , iQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iR = max ( dot ( ix , iJ ) , hn ) ; iQ = iF [ 0 ] * iR + iF [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ik ( iR , ix , iJ , iy , iA [ 0 ] , iQ ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iS = hn ; if ( iG . w != hn ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iS = hx ( iJ , iy , ix , iF , iz [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iS = hI ( iJ , iy , ix , iz [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iS = hQ ( iJ , iy , ix , iz [ 0 ] , iz [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iS","=","hn",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iJ , ix ) * dot ( iy , ix ) < hn ) { float iT = iI . x ; float iU = iI . y ; float iV = iI . z ; float iW = iI . w ; float iX = clamp ( abs ( dot ( iJ , ix ) ) , hn , ho ) ; float iY = clamp ( dot ( iy , - iJ ) , hn , ho ) ; float iZ = pow ( iY , iU ) ; it . a += iH * vec4 ( iK * iX * pow ( iu , vec3 ( iT ) ) , ho ) ; it . a += iV * mix ( vec4 ( iu , ho ) , vec4 ( ho ) , iW ) * iH * vec4 ( iK * iX * vec3 ( iZ ) , ho ) ; } else { it . b += iK * iv * iS ; it . a += vec4 ( iK * iu * iQ , iS ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"it . b += iK * iv * iS ; it . a += vec4 ( iK * iu * iQ , iS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hp jR ( vec3 ja , vec3 jb , vec3 jc , vec3 jd , vec3 je , vec3 jf , vec3 jg , vec2 jh , vec2 ji , float jj , vec3 jk [ NUM_LIGHTS ] , vec3 jl [ NUM_LIGHTS ] , vec3 jm [ NUM_LIGHTS ] , vec4 jn [ NUM_LIGHTS ] , vec4 jo [ NUM_LIGHTS ] , float jp , vec4 jq , int jr ) { hp js ; js . a = vec4 ( ja + jc * jb , hn ) ; js . b = vec3 ( hn ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float jt = ho ; if ( jr == 0 ) jt = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , jt , jk [ 0 ] , jl [ 0 ] , jm [ 0 ] , jn [ 0 ] , jo [ 0 ] , jp , jq ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float ju = ho ; if ( jr == 1 ) ju = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , ju , jk [ 1 ] , jl [ 1 ] , jm [ 1 ] , jn [ 1 ] , jo [ 1 ] , jp , jq ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"float jv = ho ; if ( jr == 2 ) jv = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , jv , jk [ 2 ] , jl [ 2 ] , jm [ 2 ] , jn [ 2 ] , jo [ 2 ] , jp , jq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"float jw = ho ; if ( jr == 3 ) jw = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , jw , jk [ 3 ] , jl [ 3 ] , jm [ 3 ] , jn [ 3 ] , jo [ 3 ] , jp , jq ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jx = 0 ; jx < NUM_LIGHTS ; jx ++ ) { vec4 jy = jn [ jx ] ; vec4 jz = jo [ jx ] ; if ( jy . w + jz . w != hn ) { vec3 jA = vec3 ( hn ) ; vec3 jB = jm [ jx ] ; if ( jx == jr ) jB *= jj ; float jC = jz . z ; if ( jC != - ho ) { jA = jk [ jx ] - je ; float jD = length ( jA ) ; jB *= jC / ( jC + jD * jD ) ; jA = normalize ( jA ) ; float jE = jz . x ; float jF = jz . y ; if ( jE > - ho ) { float jG = dot ( jA , jl [ jx ] ) ; jG *= smoothstep ( hn , ho , ( jG - jE ) / jF ) ; jB *= jG ; } } else jA = jl [ jx ] ; float jH = hn ; if ( jy . w != hn ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"is ( jf , jA , ji [ 0 ] , ji [ 1 ] , jH ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jI = max ( dot ( jf , jA ) , hn ) ; jH = jy [ 0 ] * jI + jy [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ik ( jI , jf , jA , jg , ji [ 0 ] , jH ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jJ = hn ; if ( jz . w != hn ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jJ = hx ( jA , jg , jf , jy , jh [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jJ = hI ( jA , jg , jf , jh [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jJ = hQ ( jA , jg , jf , jh [ 0 ] , jh [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( jA , jf ) * dot ( jg , jf ) < hn ) { float jK = jq . x ; float jL = jq . y ; float jM = jq . z ; float jN = jq . w ; float jO = clamp ( abs ( dot ( jA , jf ) ) , hn , ho ) ; float jP = clamp ( dot ( jg , - jA ) , hn , ho ) ; float jQ = pow ( jP , jL ) ; js . a += jp * vec4 ( jB * jO * pow ( jc , vec3 ( jK ) ) , ho ) ; js . a += jM * mix ( vec4 ( jc , ho ) , vec4 ( ho ) , jN ) * jp * vec4 ( jB * jO * vec3 ( jQ ) , ho ) ; } else { js . b += jB * jd * jJ ; js . a += vec4 ( jB * jc * jH , jJ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"js . b += jB * jd * jJ ; js . a += vec4 ( jB * jc * jH , jJ ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","js",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp jW ( vec3 jS , vec3 jT , vec3 jU ) { hp jV ; jV . a = vec4 ( jS + jU * jT , hn ) ; jV . b = vec3 ( hn ) ; return jV ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void kw ( inout vec3 jX , float jY , float jZ , float j_ , vec3 ka , vec3 kb , vec3 kc , vec4 kd , vec3 ke , float kf ) { if ( kf > CAUSTICS_VIEW_DISTANCE ) return ; vec4 kg = kd ; vec3 kh = ke + ka ; kh . xz = 10.0 * sin ( 0.1 * kh . xz ) ; vec3 ki = kh + 2.0 * cross ( - kg . xyz , cross ( - kg . xyz , kh ) + kg . w * kh ) ; vec2 kj = ki . xz ; vec3 kk = kb ; float kl = max ( dot ( ka , kk ) , 0.0 ) ; float km = 0.025 ; kj . s += 0.5 * sin ( dot ( ke + jZ , vec3 ( 1.0 ) ) ) ; kj . t += 0.7 * ( - sin ( dot ( ke - jZ , vec3 ( - 0.7 ) ) ) ) ; kj . st += 0.23 * cos ( 4.0 * jY - CAUST_SPEED . x * jZ ) ; kj . st += 3.0 * sin ( jY - 0.3 * CAUST_SPEED . y * jZ ) ; float kn = CAUST_SCALE * ( 1.0 + max ( 0.1 * jY , 0.0 ) ) ; mat3 ko = dq ( ( kj / kn ) , km ) ; float kp = ( ko * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kq = ( ko * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float kr = ( ko * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 ks = CAUST_BRIGHT * vec3 ( kp , kq , kr ) ; float kt = j_ * kl ; float ku = max ( sign ( jY ) , 0.0 ) ; kt = min ( kt + 0.5 * sign ( - ka . y ) * ku , 1.0 ) ; kt *= 1.0 - ku * ( 0.1 * jY ) ; ks *= kt ; ks *= ks ; float kv = min ( - jY + 10.0 , 1.0 ) ; jX += max ( ( 2.0 * kc * ks ) * kv , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kK ( in vec3 kD , in vec3 kE , in float kF , in float kG ) { vec3 kH = normalize ( kE + kD ) ; float kI = 1.0 - dot ( kD , kH ) ; float kJ = kG + ( 1.0 - kG ) * pow ( kI , kF ) ; return kJ ; } void kZ ( inout vec3 kL , in vec3 kM , in vec3 kN , in float kO , in float kP , in float kQ ) { vec3 kR = reflect ( - kM , kN ) ; float kS = 1.0 ; if ( kO != 0.0 ) kS = kK ( kM , kR , kO , kP ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kT = u_refl_plane . xyz * dot ( kN , u_refl_plane . xyz ) ; vec3 kU = kN - kT ; vec2 kV = ( u_view_matrix_frag * vec4 ( kU , 0.0 ) ) . xy ; vec2 kW = cE . xy / cE . z ; kW += kV * REFL_BUMP ; vec3 kX = texture2D ( u_reflectmap , kW ) . rgb ; gr ( kX . rgb ) ; kL = mix ( kL , kX , kQ * kS ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 kY = textureCube ( u_mirrormap , kR ) . xyz ; gr ( kY . rgb ) ; kL = mix ( kL , kY , u_mirror_factor * kS ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float le ( in float k_ , inout vec2 la , in vec2 lb ) { vec4 lc = texture2D ( u_scene_depth , la ) ; float ld = cq ( lc ) ; if ( ld < kC ) { la = lb ; return k_ ; } else { return ld ; } return k_ ; } vec3 lm ( in vec3 lf , in vec2 lg ) { vec2 lh = lf . xy / lf . z ; vec2 li = lh + lg ; vec4 lj = texture2DProj ( u_scene_depth , lf ) ; float lk = cq ( lj ) ; le ( lk , li , lh ) ; vec3 ll = texture2D ( u_refractmap , li ) . rgb ; gr ( ll ) ; return ll ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mn { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mu ( inout float mo , float mp , vec2 mq , vec2 mr ) { float ms = mr . x - mq . x ; float mt = ( mp - mq . x ) / ms ; mo = mix ( mo , mr . y , clamp ( mt , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mB ( inout vec3 mv , float mw , vec4 mx , vec4 my ) { float mz = my . x - mx . x ; float mA = ( mw - mx . x ) / mz ; mv = mix ( mv , my . yzw , clamp ( mA , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mI ( float mC , float mD , vec2 mE [ SIZE_RAMP_LENGTH ] ) { float mF = mC / mD ; float mG = mE [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mu ( mG , mF , mE [ 0 ] , mE [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mu ( mG , mF , mE [ 1 ] , mE [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mu ( mG , mF , mE [ 2 ] , mE [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mH = 1 ; mH < SIZE_RAMP_LENGTH ; mH ++ ) mu ( mG , mF , mE [ mH - 1 ] , mE [ mH ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mG",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mP ( float mJ , float mK , vec4 mL [ COLOR_RAMP_LENGTH ] ) { float mM = mJ / mK ; vec3 mN = mL [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mB ( mN , mM , mL [ 0 ] , mL [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mB ( mN , mM , mL [ 1 ] , mL [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mB ( mN , mM , mL [ 2 ] , mL [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mO = 1 ; mO < COLOR_RAMP_LENGTH ; mO ++ ) mB ( mN , mM , mL [ mO - 1 ] , mL [ mO ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mN",";","}"]}]}}]},{type:"textline",b:"float mY ( float mQ , float mR , float mS , float mT ) { float mU = max ( 0.01 , min ( mR , mS ) ) ; float mV = max ( 0.01 , min ( mR , mT ) ) ; float mW = mR - mV ; float mX = clamp ( mQ / mU , 0.0 , 1.0 ) - step ( mW , mQ ) * ( mQ - mW ) / mV ; return mX ; } mn nd ( ) { mn mZ ; float m_ ; if ( u_p_cyclic == 1 ) { m_ = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( m_ < 0.0 ) m_ += u_p_length ; } if ( u_p_cyclic != 1 ) { m_ = u_p_time - a_p_delay ; } if ( m_ < 0.0 || m_ >= a_p_lifetime ) { mZ . a = 0.0001 ; mZ . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( m_ < 0.0 || m_ >= a_p_lifetime ) ) { vec3 na = a_position ; vec3 nb = a_normal ; na += u_p_nfactor * m_ * nb ; na += a_p_vels . xyz * m_ ; na . y -= u_p_gravity * m_ * m_ / 2.0 ; float nc = max ( u_p_mass , EPSILON ) ; na += ( u_p_wind / nc ) * m_ * m_ / 2.0 ; mZ . b = na ; mZ . e = a_p_vels . w * m_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mZ . a = mI ( m_ , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mZ . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mZ . d = mP ( m_ , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mZ . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mZ . c = mY ( m_ , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mZ ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nq ( in sampler2D nj , in vec2 nk , in vec2 nl ) { float nm = texture2D ( nj , nk ) . r ; float nn = nl . x ; float no = nl . y ; float np = 2.0 * nn / ( nn + no - ( 2.0 * nm - 1.0 ) * ( no - nn ) ) ; return np ; }".split(" ")}]}};
b4w.module.animation=function(a,p){var h=p("__animation"),c=p("__constraints");p("__physics");var f=p("__print"),b=p("__util");a.SLOT_0=h.SLOT_0;a.SLOT_1=h.SLOT_1;a.SLOT_2=h.SLOT_2;a.SLOT_3=h.SLOT_3;a.SLOT_4=h.SLOT_4;a.SLOT_5=h.SLOT_5;a.SLOT_6=h.SLOT_6;a.SLOT_7=h.SLOT_7;a.SLOT_ALL=h.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=h.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=h.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=h.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=h.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
h.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=h.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=h.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=h.AB_CYCLIC;a.AB_FINISH_RESET=h.AB_FINISH_RESET;a.AB_FINISH_STOP=h.AB_FINISH_STOP;var l=new Float32Array(4);a.is_animated=function(a){return h.is_animated(a)};a.get_actions=function(){for(var a=[],b=h.wv(),c=0;c<b.length;c++)a.push(h.ly(b[c].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return h.Wi(a)?
h.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!h.is_animated(a))return null;b=b||h.SLOT_0;return h.Iv(a,b)};a.apply=function(a,b,c){if(c>h.SLOT_7)f.error("Can't apply animation to slot "+c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||h.SLOT_0;if(h.is_animated(a)){var l=h.get_slot_num_by_anim(a,b);if(-1!=l&&l!=c){f.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+l+'").');return}}h.apply(a,b,c)}};a.remove=function(a){h.remove(a)};
a.remove_slot_animation=function(a,b){h.is_animated(a)&&(b=b||h.SLOT_0,h.remove_slot_animation(a,b))};a.apply_def=function(a){h.apply_def(a)};a.play=function(a,b,c){h.is_animated(a)?(c=c||h.SLOT_0,h.play(a,b,c),h.update_object_animation(a,0,c)):f.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){h.is_animated(a)&&(b=b||h.SLOT_0,h.stop(a,b))};a.is_play=function(a,b){if(!h.is_animated(a))return!1;b=b||h.SLOT_0;return h.is_play(a,b)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,
c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.set_current_frame_float(a,b,c),h.update_object_animation(a,0,c))};a.get_frame=function(a,b){if(!h.is_animated(a))return 0;b=b||h.SLOT_0;return h.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!h.is_animated(a))return 0;b=b||h.SLOT_0;return h.get_speed(a,b)};a.get_frame_range=
function(a,b){if(h.is_animated(a)){b=b||h.SLOT_0;var c=a.w[b];if(c)return[c.start,c.start+c.length]}return null};a.get_anim_start_frame=function(a,b){return h.is_animated(a)?(b=b||h.SLOT_0,h.get_anim_start_frame(a,b)):-1};a.get_anim_length=function(a,b){return h.is_animated(a)?(b=b||h.SLOT_0,h.get_anim_length(a,b)):-1};a.cyclic=function(b,c,d){a.set_behavior(b,c?h.AB_CYCLIC:h.AB_FINISH_RESET,d)};a.is_cyclic=function(a,b){if(!h.is_animated(a))return!1;b=b||h.SLOT_0;return h.is_cyclic(a,b)};a.set_behavior=
function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!h.is_animated(a))return null;b=b||h.SLOT_0;return h.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,f){f=f||h.SLOT_0;h.is_animated(a)&&h.apply_smoothing(a,b,c,f)};a.update_object_animation=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.update_object_animation(a,b||0,c))};a.frame_to_sec=function(a){return h.frame_to_sec(a)};a.get_bone_translation=function(a,f,d){if(!b.Ye(a))return null;
d||(d=new Float32Array(3));c.Cv(a,f,!1,l,null);d[0]=l[0];d[1]=l[1];d[2]=l[2];return d};a.get_first_armature_object=function(a){return b.sc(a)?h.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return h.is_animated(a)&&b?h.get_slot_num_by_anim(a,b):null};a.get_anim_name=function(a,b){if(!h.is_animated(a))return null;b=b||h.SLOT_0;return h.yv(a,b)};a.get_anim_type=function(a,b){return h.is_animated(a)?h.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return h.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.Gd};a.set_skel_mix_factor=function(a,c,d){b.Ye(a)?(c=Math.min(Math.max(c,0),1),a.d.Gd!=c&&h.set_skel_mix_factor(a,c,d||0)):f.error("Can't blend animation. Object \""+a.name+'" is not armature')}};
b4w.module.assets=function(a,p){var h=p("__assets");a.AT_ARRAYBUFFER=h.AT_ARRAYBUFFER;a.AT_JSON=h.AT_JSON;a.AT_TEXT=h.AT_TEXT;a.AT_AUDIOBUFFER=h.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=h.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=h.AT_AUDIO_ELEMENT;a.enqueue=function(a,f,b){h.enqueue(a,f,b)}};
b4w.module.camera=function(a,p){function h(a,h){c.Jb(a)?(d.copy(h,a.d.Wa),e.v(a),f.sync_transform(a)):b.error("set_pivot(): Wrong object or camera move style")}var c=p("__camera");p("__config");var f=p("__physics"),b=p("__print"),l=p("__constraints"),e=p("__transform"),k=p("__util"),d=p("vec3"),r=p("vec4"),x=p("quat"),n=p("mat3"),t=p("mat4"),w=new Float32Array(3),B=new Float32Array(3),q=new Float32Array(4),s=new Float32Array(4),y=new Float32Array(9);a.MS_STATIC=c.MS_STATIC;a.MS_ANIMATION=c.MS_ANIMATION;
a.MS_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.is_camera=function(a){return c.is_camera(a)};a.set_move_style=function(a,b){a.d.T=b};a.get_move_style=function(a){return c.is_camera(a)?c.get_move_style(a):(b.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,d){if(!c.Jb(a)&&!c.rh(a)&&!c.Fb(a))return b.error("set_velocity_params(): Wrong object or camera move style"),
null;var e=a.d;e.xm=d[0];e.wm=d[1];e.ym=d[2]};a.get_velocity_params=function(a,d){if(!c.Jb(a)&&!c.rh(a)&&!c.Fb(a))return b.error("get_velocity_params(): Wrong object or camera move style"),null;d||(d=new Float32Array(3));var e=a.d;d[0]=e.xm;d[1]=e.wm;d[2]=e.ym;return d};a.change_eye_target_dist=function(){b.error("change_eye_target_dist() deprecated")};a.set_look_at=function(a,b,d,h){var q=a.d;c.Zu(b,d,h,q.e,q.quat);e.v(a);f.sync_transform(a)};a.get_eye=function(a,e){if(c.is_camera(a))return e||(e=
new Float32Array(3)),d.copy(a.d.e,e),e;b.error("get_eye(): Wrong object")};a.set_pivot=h;a.get_pivot=function(a,e){if(c.Jb(a))return e||(e=new Float32Array(3)),d.copy(a.d.Wa,e),e;b.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,h,l){if(c.Jb(a)){var n=a.d;w[0]=0;w[1]=1;w[2]=0;var t=k.quat_to_dir(n.quat,k.AXIS_MY,B);.999999>Math.abs(d.dot(t,w))&&(x.setAxisAngle(w,h,q),k.qq(n.e,n.Wa,q,n.e));w[0]=1;w[1]=0;w[2]=0;d.transformQuat(w,n.quat,w);x.setAxisAngle(w,l,q);k.qq(n.e,
n.Wa,q,n.e);e.v(a);f.sync_transform(a)}else b.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,h,q){if(c.Jb(a)){var k=a.d;if(k.ir){var l=n.fromMat4(k.H,y),t=d.subtract(k.e,k.Wa,B);w[0]=h;w[1]=0;w[2]=q;d.scale(w,d.len(t),w);d.transformMat3(w,l,w);d.add(k.Wa,w,k.Wa);d.add(k.e,w,k.e);e.v(a);f.sync_transform(a)}}else b.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,d){if(c.Fb(a)){var h=a.d;if(h.zb&&h.lo&&d){var l=x.setAxisAngle(k.AXIS_Y,d,q);x.normalize(l,l);x.multiply(l,
h.quat,h.quat);e.v(a);f.sync_transform(a)}}else b.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return c.Fb(a)?c.Io(a):(b.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,d){if(c.Fb(a)){var h=a.d;if(h.zb){var l=k.quat_to_dir(h.quat,k.AXIS_X,w),n=c.Io(a)-d,l=x.setAxisAngle(l,n,q),h=x.multiply(l,h.quat,q);e.set_rotation(a,h);e.v(a);f.sync_transform(a)}else b.warn("set_hover_cam_angle(): undefined without distance limits")}else b.error("set_hover_cam_angle(): wrong object or camera move style")};
a.get_hover_angle_limits=function(a,d){if(c.Fb(a))return a.d.Oa?(d||(d=new Float32Array(2)),d[0]=a.d.Oa.Qa,d[1]=a.d.Oa.Ka):b.warn("get_hover_angle_limits(): camera hasn't angle limits"),d;b.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,d){if(c.Fb(a)||c.Jb(a))return a.d.zb?(d||(d=new Float32Array(2)),d[0]=a.d.Pf,d[1]=a.d.Fc):b.warn("get_cam_dist_limits(): camera hasn't distance limits"),d;b.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,
h){if(c.Fb(a)){var q=a.d;q.zb?d.copy(h,q.Ud):e.set_translation(a,h);e.v(a);f.sync_transform(a)}else b.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,e){if(!c.Fb(a))return b.error("get_hover_cam_pivot(): wrong object"),null;e||(e=new Float32Array(3));d.copy(a.d.Ud,e);return e};a.is_use_distance_limits=function(a){return c.Jb(a)||c.Fb(a)?a.d.zb:(b.error("is_use_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,d,h,q){if(c.Jb(a)||c.rh(a)){var k=
a.d;k.Aa={Ka:d,Qa:h};q==e.SPACE_LOCAL&&c.ez(a);c.zm(a)}else if(c.Fb(a)){if(d>h){b.error("apply_vertical_limits(): wrong horizontal limits");return}k=a.d;k.Aa={Ka:-h,Qa:-d}}else{b.error("apply_vertical_limits(): wrong object");return}e.v(a);f.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.Aa=null;(c.Jb(a)||c.rh(a))&&c.zm(a)};a.apply_horizontal_limits=function(a,d,h,q){if(c.Jb(a)||c.rh(a)){var k=a.d;k.pb={left:d,right:h};q==e.SPACE_LOCAL&&c.jw(a);c.zm(a)}else if(c.Fb(a)){if(d>h){b.error("apply_horizontal_limits(): wrong horizontal limits");
return}k=a.d;k.pb={left:d,right:h}}else{b.error("apply_horizontal_limits(): wrong object");return}e.v(a);f.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.pb=null};a.apply_hover_angle_limits=function(a,d,h){c.Fb(a)?d>h?b.error("apply_horizontal_limits(): wrong horizontal limits"):(a.d.Oa={Ka:d,Qa:h},e.v(a),f.sync_transform(a)):b.error("apply_horizontal_limits(): wrong object")};a.clear_hover_angle_limits=function(a){a.d.Oa=null};a.apply_distance_limits=function(a,d,h){if(c.Jb(a)||c.Fb(a))if(d>
h)b.error("apply_distance_limits(): wrong distance limits");else{var q=a.d;q.zb=!0;q.Fc=d;q.Pf=h;e.v(a);f.sync_transform(a)}else b.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){c.Jb(a)||c.Fb(a)?a.d.zb=!1:b.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(a,b,d){x.identity(a.d.quat);c.Vl(a,Math.PI/2);c.pq(a,b);c.Vl(a,-d);e.v(a);f.sync_transform(a)};a.is_look_up=function(a){k.quat_to_dir(a.d.quat,k.AXIS_MY,w);return 0<=w[1]?!0:!1};a.rotate=
function(a,b,d){c.pq(a,b);c.Vl(a,-d);e.v(a);f.sync_transform(a)};a.get_angles=function(a,b){b||(b=new Float32Array(2));c.get_angles(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a.d.M,e=0;e<d.length;e++){var f=d[e];f.type!=c.tb&&f.type!=c.Bb||c.Kx(f,b,f.Pc)}};a.get_stereo_distance=function(a){a=a.d.M;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.tb||d.type==c.Bb)return d.Xh}return 0};a.is_underwater=function(a){return a.d.cr};a.translate_view=function(a,b,d,e){a=a.d.M;for(var f=
0;f<a.length;f++){var h=a[f];h.hb||c.mg(h,h.jb);var q=w;q[0]=-b;q[1]=-d;q[2]=0;t.translate(h.ia,q,h.ia);t.rotateZ(h.ia,e,h.ia);t.multiply(h.ia,h.ea,h.Df);c.At(h);c.zt(h)}};a.correct_up=function(a,b){b||(b=k.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,d){if(c.Jb(a)){e.get_object_center(d,!1,w);h(a,w);e.v(a);var q=e.get_object_size(d),k=c.xv(a)/2,q=q/Math.sin(k),k=e.Sw(a,w);e.move_local(a,0,q-k,0);e.v(a);f.sync_transform(a)}else b.error("zoom_object(): wrong object")};a.calc_ray=function(a,
e,f,h){h||(h=new Float32Array(3));var q=a.d.M[0];switch(q.type){case c.pc:case c.we:case c.tb:case c.Bb:var k=Math.tan(q.od*Math.PI/360);s[0]=(2*e/q.width-1)*k*q.jb;s[1]=-1;s[2]=(2*f/q.height-1)*k;s[3]=0;r.transformMat4(s,a.d.H,s);h[0]=s[0];h[1]=s[1];h[2]=s[2];d.normalize(h,h);return h;default:return b.error("Non-compatible camera"),h}};a.project_point=function(a,f,h){h||(h=new Float32Array(2));var q=a.d.M[0];switch(q.type){case c.pc:case c.we:case c.tb:case c.Bb:return e.get_translation(a,w),d.subtract(f,
w,w),s.set(w),s[3]=0,r.transformMat4(s,q.Df,s),a=-s[1]/s[3],h[0]=(s[0]/s[3]+1)/2*q.width|0,h[1]=(a+1)/2*q.height|0,h;default:return b.error("Non-compatible camera"),h}}};b4w.module.config=function(a,p){var h=p("__config");a.P_LOW=h.P_LOW;a.P_HIGH=h.P_HIGH;a.P_ULTRA=h.P_ULTRA;a.P_CUSTOM=h.P_CUSTOM;a.set=h.set;a.get=h.get;a.reset=h.reset;a.get_std_assets_path=h.get_std_assets_path};
b4w.module.controls=function(a,p){var h=p("__controls");p("__print");a.CT_CONTINUOUS=h.CT_CONTINUOUS;a.CT_TRIGGER=h.CT_TRIGGER;a.CT_SHOT=h.CT_SHOT;a.CT_LEVEL=h.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;
a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.create_custom_sensor=h.create_custom_sensor;a.create_keyboard_sensor=h.create_keyboard_sensor;a.create_collision_sensor=h.create_collision_sensor;a.create_collision_impulse_sensor=h.create_collision_impulse_sensor;a.create_ray_sensor=h.create_ray_sensor;a.create_mouse_click_sensor=h.create_mouse_click_sensor;a.create_mouse_wheel_sensor=h.create_mouse_wheel_sensor;
a.create_mouse_move_sensor=h.create_mouse_move_sensor;a.create_touch_move_sensor=h.create_touch_move_sensor;a.create_touch_zoom_sensor=h.create_touch_zoom_sensor;a.create_motion_sensor=h.create_motion_sensor;a.create_vertical_velocity_sensor=h.create_vertical_velocity_sensor;a.create_timer_sensor=h.create_timer_sensor;a.reset_timer_sensor=h.reset_timer_sensor;a.create_elapsed_sensor=h.create_elapsed_sensor;a.create_timeline_sensor=h.create_timeline_sensor;a.create_selection_sensor=function(a,f){return h.create_selection_sensor(a,
f||!1)};a.set_custom_sensor=function(a,f){h.Ax(a,f)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=h.get_sensor_value;a.get_sensor_payload=h.get_sensor_payload;a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,f,b){a.wl=f.slice(0);a.vl=Array(f.length);a.cj=b||h.Mk};a.remove_sensor_lock=function(a){a.wl=null;a.vl=null;a.cj=null};a.create_sensor_manifold=function(a,
f,b,l,e,k,d){e=e||h.Mk;h.create_sensor_manifold(a,f,b,l,e,k,void 0===d?null:d)};a.create_kb_sensor_manifold=function(a,f,b,l,e,k){l=h.create_keyboard_sensor(l);h.create_sensor_manifold(a,f,b,[l],h.Mk,e,void 0===k?null:k)};a.check_sensor_manifolds=function(a){return h.check_sensor_manifold(a,null)};a.check_sensor_manifold=h.check_sensor_manifold;a.remove_sensor_manifolds=function(a){h.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=h.remove_sensor_manifold;a.reset=h.reset;a.register_keyboard_events=
h.register_keyboard_events;a.register_mouse_events=h.register_mouse_events;a.register_wheel_events=h.register_wheel_events;a.register_touch_events=h.register_touch_events;a.unregister_keyboard_events=h.unregister_keyboard_events;a.unregister_mouse_events=h.unregister_mouse_events;a.unregister_wheel_events=h.unregister_wheel_events;a.unregister_touch_events=h.unregister_touch_events};
b4w.module.constraints=function(a,p){var h=p("__constraints"),c=p("__physics"),f=p("__transform");a.append_stiff=function(a,l,e,k,d){d=d||1;l instanceof Array&&2==l.length?h.an(a,l[0],l[1],e,k,d):h.bn(a,l,e,k,d);f.v(a);c.sync_transform(a)};a.append_semi_stiff=function(a,l,e,k){h.bt(a,l,e,k);f.v(a);c.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,e,k,d,r,x,n){h.at(a,l,e,k,d,r,x,n);f.v(a);c.sync_transform(a)};a.append_semi_soft_cam=function(a,l,e,k){if(!k||0>k)k=.25;h.$s(a,l,e,k);f.v(a);c.sync_transform(a)};
a.append_stiff_trans=function(a,l,e){h.ct(a,l,e);f.v(a);c.sync_transform(a)};a.append_copy_trans=function(a,l,e){h.Ws(a,l,e);f.v(a);c.sync_transform(a)};a.append_stiff_trans_rot=function(a,l,e,k){h.dt(a,l,e,k);f.v(a);c.sync_transform(a)};a.append_track=function(a,l){3==l.length?h.gt(a,l):h.ft(a,l);f.v(a);c.sync_transform(a)};a.append_follow=function(a,l,e,k){3==l.length?h.Ys(a,l,e,k):h.Xs(a,l,e,k);f.v(a);c.sync_transform(a)};a.remove=function(a){a.$a&&h.remove(a)}};
b4w.module.data=function(a,p){var h=p("__data");p("__print");var c=p("__util");a.load=h.load;a.unload=function(a){h.unload(a|0)};a.set_debug_resources_root=h.set_debug_resources_root;a.is_primary_loaded=h.is_primary_loaded;a.load_and_add_new=h.load;a.get_bpy_world=function(){c.da("get_bpy_world() deprecated");return null};a.cleanup=a.unload};
b4w.module.debug=function(a,p){p("__batch");var h=p("__print"),c=p("__controls"),f=p("__debug"),b=p("__physics"),l=p("__scenegraph"),e=p("__scenes"),k=p("__sfx"),d=p("__textures"),r=p("__util"),x=p("vec3");a.physics_worker=function(){b.Du()};a.physics_id=function(a){h.log("O",b.bv(a));for(var c=b.vv().j.l,d=0;d<c.length;d++){var e=c[d];e.gb.F==a&&h.log("B",e)}};a.visible_objects=function(){for(var a=e.get_active(),b=e.la(a,"MESH",e.DATA_ID_ALL),a=e.ga(a,"MAIN_OPAQUE").l,c=0;c<b.length;c++){var d=
b[c],f=d.d;if("DYNAMIC"==f.type)for(var k=0;k<a.length;k++){var l=a[k];if(l.R&&l.Va==f){h.log(d.name,d);break}}}};a.object_info=function(a){for(var b=e.get_active(),c=e.la(b,"MESH",e.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){h.log("Object",f);for(var k=e.bl(b),l=0;l<k.length;l++){for(var g=k[l],r=g.l,u=[],x=0;x<r.length;x++)r[x].Va==f.d&&u.push(r[x]);h.log("Subscene "+g.type,u)}}}};a.objects_stat=function(){var a=e.get_active();console.log("Armatures: "+e.la(a,"ARMATURE",e.DATA_ID_ALL).length);
console.log("Cameras: "+e.la(a,"CAMERA",e.DATA_ID_ALL).length);console.log("Curves: "+e.la(a,"CURVE",e.DATA_ID_ALL).length);console.log("Empties: "+e.la(a,"EMPTY",e.DATA_ID_ALL).length);console.log("Lamps: "+e.la(a,"LAMP",e.DATA_ID_ALL).length);console.log("Meshes: "+e.la(a,"MESH",e.DATA_ID_ALL).length);console.log("Speakers: "+e.la(a,"SPEAKER",e.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=e.get_active(),b=[e.ga(b,"MAIN_OPAQUE"),e.ga(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.l,f=0;f<d.length;f++){var h=d[f].k;h&&(a+=h.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=e.get_active(),b=[e.ga(b,"MAIN_OPAQUE"),e.ga(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.l,f=0;f<d.length;f++){var h=d[f].k;h&&(a+=h.num_triangles)}}return a};a.num_draw_calls=function(){var a=e.get_active(),a=[e.ga(a,"MAIN_OPAQUE"),e.ga(a,"MAIN_BLEND")];return a[0].l.length+a[1].l.length};a.geometry_stats=function(){for(var a=e.get_active(),b=e.bl(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var f=d.l,h=0;h<f.length;h++){var k=f[h].k,g=f[h].Va;k&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||g.mj)&&(a[k.id]=k)}}var f=d=c=b=0,l;for(l in a)k=a[l],k=k.bb,k.Hi&&(d++,f+=k.Hi/1048576),b++,c+=k.bo/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:f}};a.num_textures=function(){for(var a=[],b=0,c=e.get_active(),c=[e.ga(c,"MAIN_OPAQUE"),e.ga(c,"MAIN_BLEND")],d=0;d<c.length;d++){var f=c[d];if(f)for(var f=
f.l,h=0;h<f.length;h++){var k=f[h].k;if(k)for(var k=k.D,g=0;g<k.length;g++){var l=k[g];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var u=l.Ha;-1===a.indexOf(u)&&(a.push(u),l=l.width*l.height*4/1048576/l.Bk,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=e.get_active(),c=e.bl(c),f=0;f<c.length;f++){var h=c[f];if("SINK"!=h.type){var k=h.h,l=[k.cb,k.hc];l.push.apply(l,h.Rc);for(h=0;h<l.length;h++){var g=l[h];d.vh(g)&&-1==a.indexOf(g)&&
(a.push(g),b+=k.width*k.height*d.Uv(g))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=e.get_active();(a=e.ga(a,"MAIN_OPAQUE"))&&e.wp(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=e.get_active(),b=e.ga(a,"MAIN_OPAQUE"),a=e.ry(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],f;switch(c){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=[1,0,1]}e.wp(d.h,b,f)}};a.scenegraph_to_dot=function(){var a=e.get_active();
h.log(l.Au(e.dl(a)))};a.controls_info=c.debug;a.object_distance=function(a,b){return x.dist(a.d.e,b.d.e)};a.msg=f.msg;a.fbmsg=f.fbmsg;a.print_telemetry=f.print_telemetry;a.plot_telemetry=f.plot_telemetry;a.fbres=function(a,b){function c(){f.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),h=new Float32Array([0,
-1,0]),g=new Float32Array([0,0,-1]);if(!r.Ld(a,r.Gs))throw"Wrong VEC3_IDENT";if(!r.Ld(b,r.Bs))throw"Wrong QUAT4_IDENT";if(!r.Ld(c,r.AXIS_X))throw"Wrong AXIS_X";if(!r.Ld(d,r.AXIS_Y))throw"Wrong AXIS_Y";if(!r.Ld(e,r.AXIS_Z))throw"Wrong AXIS_Z";if(!r.Ld(f,r.AXIS_MX))throw"Wrong AXIS_MX";if(!r.Ld(h,r.AXIS_MY))throw"Wrong AXIS_MY";if(!r.Ld(g,r.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=k.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==k.fl(c)&&k.mute(c,!0)}};
a.check_finite=function(a){f.check_finite(a)};a.set_debug_params=function(a){var b=e.get_active();if(b=e.ga(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&e.Qx(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&e.Px(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return h.Lv()};a.get_warning_quantity=function(){return h.Xv()};a.clear_errors_warnings=function(){return h.clear_errors_warnings()}};
b4w.module.geometry=function(a,p){function h(a){return a&&a.d&&a.d.md?!0:!1}var c=p("__batch"),f=p("__geometry"),b=p("__print"),l=p("__renderer");a.extract_vertex_array=function(a,k,d){if(!h(a))return b.error("Wrong object:",a.name),null;if(a=c.S(a,k,"MAIN")||c.S(a,k,"NODES")){if((k=a.bb)&&k.Kb&&k.Kb[d])return f.Uu(k,d);b.error("Attribute not found:"+d);return null}b.error("Wrong material:",k);return null};a.extract_index_array=function(a,f){if(!h(a))return b.error("Wrong object:",a.name),null;var d=
c.S(a,f,"MAIN")||c.S(a,f,"NODES");if(d){if((d=d.bb)&&d.Kb)return d.Vd;b.error("Buffer data not found");return null}b.error("Wrong material:",f);return null};a.update_vertex_array=function(a,k,d,l){var x=["MAIN","NODES","DEPTH","COLOR_ID"];if(h(a))for(var n=0;n<x.length;n++){var t=c.S(a,k,x[n]);t&&(t=t.bb)&&t.Kb&&t.Kb[d]&&f.Mj(t,d,0,l)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,k,d,r,x){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(h(a))if(d instanceof Uint16Array||d instanceof
Uint32Array)if(r instanceof Float32Array)for(var t=0;t<n.length;t++){var w=c.S(a,k,n[t]);if(w){var B=w.bb;if(B){f.Hy(B,w.ld,d);var q=0,s;for(s in B.Kb)var y=B.Kb[s],q=q+r.length/3*y.Ic;B.Uc=new Float32Array(q);var q=B.Uc,g=0;for(s in B.Kb)switch(y=B.Kb[s],s){case "a_position":q.set(r,g);y.offset=g;y.length=r.length;g+=y.length;break;case "a_normal":var A;x&&(A=f.wn(d,r,r));var u=f.un(d,r,A);q.set(u,g);y.offset=g;y.length=r.length;g+=y.length;break;case "a_tangent":y.offset=g;y.length=r.length/3*y.Ic;
for(var p=new Float32Array(y.length),u=0;u<p.length;u+=4)p[u]=1,p[u+3]=1;q.set(p,g);g+=y.length;break;default:y.offset=g,y.length=r.length/3*y.Ic,u=new Float32Array(y.length),q.set(u,g),g+=y.length}f.My(B);l.dn(w);if(w.vb)for(u=0;u<w.vb.length;u++)(y=w.vb[u])&&y.bb&&(y.bb=B)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)}};
b4w.module.hud=function(a,p){var h=p("__hud");p("__print");a.draw_mixer_strip=h.draw_mixer_strip;a.plot_array=h.plot_array};
b4w.module.lights=function(a,p){function h(a){for(var h=b.get_active(),w=b.la(h,"LAMP",b.DATA_ID_ALL),r=0;r<w.length;r++){var q=w[r];if("SUN"==q.Ca.type){var s=q;break}}if(!s)return c.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(w=(90-a.vert_position)/180*Math.PI,r=s.d,l.set_rotation_euler(s,[w,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),e.quat_to_dir(r.quat,e.AXIS_Y,a),r=k.length(r.e),k.copy(a,d),k.scale(d,r,d),l.set_translation(s,
d),l.v(s),a=s.Ca,a.jo&&(q=s.data.energy,r=h.world.light_settings.environment_energy,w=Math.cos(Math.abs(w)),q*=Math.max(Math.min(3*w,1),0),w=Math.max(w,.1)*r,f.uq(a,q),b.set_environment_colors(h,w,null,null)),b.Oj(s,h))}var c=p("__print"),f=p("__lights"),b=p("__scenes"),l=p("__transform"),e=p("__util"),k=p("vec3"),d=new Float32Array(3),r,x=60;a.get_lamps=function(a){var c=b.get_active(),c=b.la(c,"LAMP",b.DATA_ID_ALL);if(!a)return c;for(var d=[],e=0;e<c.length;e++){var f=c[e];f.Ca.type===a&&d.push(f)}return d};
a.get_sun_params=function(){for(var a=b.get_active(),a=b.la(a,"LAMP",b.DATA_ID_ALL),c=null,d=0;d<a.length;d++){var e=a[d];if("SUN"==e.Ca.type){c=e;break}}return c?(c=c.Ca.direction,a=180*Math.atan2(c[2],c[0])/Math.PI+90,180<a&&(a-=360),c=180*Math.atan2(c[1],Math.sqrt(c[0]*c[0]+c[2]*c[2]))/Math.PI,d={},d.hor_position=a,d.vert_position=c,d):null};a.set_sun_params=h;a.set_day_time=function(a){for(var d=b.get_active(),d=b.la(d,"LAMP",b.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("SUN"==f.Ca.type){var q=
f;break}}if(!q)return c.error("There is no sun on the scene"),null;q=-Math.cos(a/12*Math.PI)*x;d={};d.hor_position=12>a?15*a:15*(a-24);d.vert_position=q;h(d)};a.set_date=function(a){(r=a.getDate())?1582==r&&10==a.gB&&4<a.zu&&15>a.zu&&c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){x=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var d=b.get_active();if(!d)return c.error("No active scene"),
!1;for(var d=b.la(d,"LAMP",b.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.name===a){var h=f.Ca;break}}return h?{light_color:h.color,light_energy:h.Tf}:!1};a.set_light_params=function(a,d){var e=b.get_active();if(!e)return c.error("No active scene"),!1;for(var h=b.la(e,"LAMP",b.DATA_ID_ALL),q=0;q<h.length;q++){var k=h[q];if(k.name===a){var l=k.Ca;break}}if(!l)return c.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof d.light_energy&&(f.uq(l,d.light_energy),b.Oj(k,e));"object"==
typeof d.light_color&&(f.Hx(l,d.light_color),b.Oj(k,e))};a.get_lights_names=function(){var a=b.get_active();if(!a)return c.error("No active scene"),!1;for(var d=[],a=b.la(a,"LAMP",b.DATA_ID_ALL),e=0;e<a.length;e++)d.push(a[e].Ca.name);return d}};
b4w.module.material=function(a,p){function h(a,b){for(var c=a.P,d=0;d<c.length;d++){var e=c[d];if(-1<e.tc.indexOf(b))return"MAIN"==e.type}return!1}function c(a,c){var d=b.S(a,c,"MAIN");return Boolean(d&&d.lc[0])}function f(a,c){var d=b.S(a,c,"MAIN");return Boolean(d&&d.lc[1])}var b=p("__batch"),l=p("__config"),e=p("__print"),k=p("__shaders"),d=p("__util");p("vec4");var r=l.n,x="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){e.error("max_bones() deprecated, return default value");
return r.max_bones};a.set_max_bones=function(){e.error("set_max_bones() deprecated")};a.set_batch_param=function(){e.error("set_batch_param() deprecated")};a.inherit_material=function(a,c,f,h){if(d.kp(f)&&d.kp(a)){for(var q=["MAIN","DEPTH","COLOR_ID"],k=!1,l=0;l<q.length;l++){var g=q[l],r=b.S(a,c,g),u=b.S(f,h,g);if(r&&u)for(k=!0,"MAIN"==g&&(u.ob.set(r.ob),u.Le=r.Le,u.Bd.set(r.Bd),u.lc.set(r.lc),u.Qd=r.Qd,u.Bc=r.Bc,u.Bc=r.Bc,u.Ke=r.Ke,u.ye=r.ye),g=0;g<u.ac.length;g++){var p=u.ac[g];if(-1!==x.indexOf(p)){var I=
r.ac.indexOf(p);if(-1!==I&&(u.D[g]=r.D[I],u.vb))for(g=0;g<u.vb.length;g++){var v=u.vb[g],K=v.ac.indexOf(p);-1!==K&&(v.D[K]=r.D[I])}}}}k||e.error("Wrong objects for inheriting material!")}else e.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,c,d){(a=b.S(a,c,"MAIN"))?a.ob.set(d):e.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,c){var d=
b.S(a,c,"MAIN");if(d){var f=Array(4);f[0]=d.ob[0];f[1]=d.ob[1];f[2]=d.ob[2];f[3]=d.ob[3];return f}e.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,c,d){(a=b.S(a,c,"MAIN"))?a.Le=d:e.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,c){var d=b.S(a,c,"MAIN");if(d)return d.Le;e.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,c,d){(a=b.S(a,c,"MAIN"))?a.Bd.set(d):e.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,c){var d=b.S(a,c,"MAIN");if(d){var f=Array(3);f[0]=d.Bd[0];f[1]=d.Bd[1];f[2]=d.Bd[2];return f}e.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,d,f){c(a,d)||e.error('Property "specular_intensity" is missing!');b.S(a,d,"MAIN").lc[0]=f};a.get_specular_intensity=function(a,d){c(a,d)||e.error('Property "specular_intensity" is missing!');return b.S(a,d,"MAIN").lc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,
d){f(a,c)||e.error('Property "specular_hardness" is missing!');b.S(a,c,"MAIN").lc[1]=d};a.get_specular_hardness=function(a,c){f(a,c)||e.error('Property "specular_hardness" is missing!');return b.S(a,c,"MAIN").lc[1]};a.check_specular_hardness=f;a.set_emit_factor=function(a,c,d){(a=b.S(a,c,"MAIN"))?a.Qd=d:e.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,c){var d=b.S(a,c,"MAIN");if(d)return d.Qd;e.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
c,d){(a=b.S(a,c,"MAIN"))?a.Bc=d:e.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,c){var d=b.S(a,c,"MAIN");if(d)return d.Bc;e.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,c,d){(a=b.S(a,c,"MAIN"))?a.Ke=d:e.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,c){var d=b.S(a,c,"MAIN");if(d)return d.Ke;e.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
c){var d=b.S(a,c,"MAIN");d?d.ye=alpha_factor:e.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,c){var d=b.S(a,c,"MAIN");if(d)return d.ye;e.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,c){if(!a||!c)return e.error("B4W Error: missing arguments in get_material_params"),null;if(!h(a,c))return null;var d=b.S(a,c,"MAIN");if(!d)return null;var f={};"MAIN"==d.type&&(f.Nh=d.Nh,f.sA=d.pd[2],f.tA=5*(1-d.pd[3]),f.Fh=d.Fh,f.oB=b.fb(d,
"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,c){if(!a||!c)return e.error("B4W Error: missing arguments in get_water_material_params"),null;if(!h(a,c))return null;var d=b.S(a,c,"MAIN");if(!d||!d.re)return null;if(!d)return e.warn("B4W Warning: material not found"),null;var f={};if("MAIN"==d.type){if(r.ng){var q=f.shallow_water_col=Array(3);q[0]=d.shallow_water_col[0];q[1]=d.shallow_water_col[1];q[2]=d.shallow_water_col[2];q=f.shore_water_col=Array(3);q[0]=d.shore_water_col[0];
q[1]=d.shore_water_col[1];q[2]=d.shore_water_col[2];f.shallow_water_col_fac=d.shallow_water_col_fac;f.shore_water_col_fac=d.shore_water_col_fac}f.foam_factor=d.foam_factor;f.norm_uv_velocity=d.Uj;f.absorb_factor=b.fb(d,"ABSORB")[1];f.sss_strength=b.fb(d,"SSS_STRENGTH")[1];f.sss_width=b.fb(d,"SSS_WIDTH")[1];f.dst_noise_scale0=b.fb(d,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=b.fb(d,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=b.fb(d,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=b.fb(d,"DST_NOISE_FREQ_1")[1];
f.dir_min_shore_fac=b.fb(d,"DIR_MIN_SHR_FAC")[1];f.dir_freq=b.fb(d,"DIR_FREQ")[1];f.dir_noise_scale=b.fb(d,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=b.fb(d,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=b.fb(d,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=b.fb(d,"DST_MIN_FAC")[1];f.waves_hor_fac=b.fb(d,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,c,d){if(a&&c&&d){if(!h(a,c))return e.warn("B4W Warning: setting material params is not possible"),null;(a=b.S(a,c,"MAIN"))?"MAIN"==a.type&&("number"==
typeof d.material_reflectivity&&(a.Nh=d.material_reflectivity),"number"==typeof d.material_fresnel&&(a.pd[2]=d.material_fresnel),"number"==typeof d.material_fresnel_factor&&(a.pd[3]=1-d.material_fresnel_factor/5),"number"==typeof d.material_parallax_scale&&(a.Fh=d.material_parallax_scale),"number"==typeof d.material_parallax_steps&&(d=k.u(parseFloat(d.material_parallax_steps)),b.U(a,"PARALLAX_STEPS",d),b.sb(a,!0))):e.warn("B4W Warning: material not found")}else e.error("B4W Error: missing arguments in set_material_params")};
a.set_water_material_params=function(a,c,d){if(!a||!c||!d)return e.error("B4W Error: missing arguments in set_water_material_params"),null;if(!h(a,c))return e.warn("B4W Warning: setting water material params is not possible"),null;a=b.S(a,c,"MAIN");if(!a)return e.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(r.ng&&("object"==typeof d.shallow_water_col&&a.shallow_water_col.set(d.shallow_water_col),"number"==typeof d.shallow_water_col_fac&&(a.shallow_water_col_fac=d.shallow_water_col_fac),
"object"==typeof d.shore_water_col&&a.shore_water_col.set(d.shore_water_col),"number"==typeof d.shore_water_col_fac&&(a.shore_water_col_fac=d.shore_water_col_fac)),r.shore_smoothing&&a.Em&&("boolean"==typeof d.shore_smoothing&&(d.shore_smoothing?b.U(a,"SHORE_SMOOTHING",1):b.U(a,"SHORE_SMOOTHING",0)),"number"==typeof d.absorb_factor&&(c=k.u(parseFloat(d.absorb_factor)),b.U(a,"ABSORB",c))),"number"==typeof d.foam_factor&&r.Vf&&(a.foam_factor=d.foam_factor),"number"==typeof d.norm_uv_velocity&&(a.Uj=
d.norm_uv_velocity),r.water_dynamic&&a.water_dynamic&&("boolean"==typeof d.water_dynamic&&(d.water_dynamic?b.U(a,"DYNAMIC",1):b.U(a,"DYNAMIC",0)),"number"==typeof d.waves_height&&(c=k.u(parseFloat(d.waves_height)),b.U(a,"WAVES_HEIGHT",c)),"number"==typeof d.waves_length&&(c=k.u(parseFloat(d.waves_length)),b.U(a,"WAVES_LENGTH",c)),"number"==typeof d.sss_strength&&(c=k.u(parseFloat(d.sss_strength)),b.U(a,"SSS_STRENGTH",c)),"number"==typeof d.sss_width&&(c=k.u(parseFloat(d.sss_width)),b.U(a,"SSS_WIDTH",
c)),"number"==typeof d.dst_noise_scale0&&(c=k.u(parseFloat(d.dst_noise_scale0)),b.U(a,"DST_NOISE_SCALE_0",c)),"number"==typeof d.dst_noise_scale1&&(c=k.u(parseFloat(d.dst_noise_scale1)),b.U(a,"DST_NOISE_SCALE_1",c)),"number"==typeof d.dst_noise_freq0&&(c=k.u(parseFloat(d.dst_noise_freq0)),b.U(a,"DST_NOISE_FREQ_0",c)),"number"==typeof d.dst_noise_freq1&&(c=k.u(parseFloat(d.dst_noise_freq1)),b.U(a,"DST_NOISE_FREQ_1",c)),"number"==typeof d.dir_min_shore_fac&&(c=k.u(parseFloat(d.dir_min_shore_fac)),b.U(a,
"DIR_MIN_SHR_FAC",c)),"number"==typeof d.dir_freq&&(c=k.u(parseFloat(d.dir_freq)),b.U(a,"DIR_FREQ",c)),"number"==typeof d.dir_noise_scale&&(c=k.u(parseFloat(d.dir_noise_scale)),b.U(a,"DIR_NOISE_SCALE",c)),"number"==typeof d.dir_noise_freq&&(c=k.u(parseFloat(d.dir_noise_freq)),b.U(a,"DIR_NOISE_FREQ",c)),"number"==typeof d.dir_min_noise_fac&&(c=k.u(parseFloat(d.dir_min_noise_fac)),b.U(a,"DIR_MIN_NOISE_FAC",c)),"number"==typeof d.dst_min_fac&&(c=k.u(parseFloat(d.dst_min_fac)),b.U(a,"DST_MIN_FAC",c)),
"number"==typeof d.waves_hor_fac&&(d=k.u(parseFloat(d.waves_hor_fac)),b.U(a,"WAVES_HOR_FAC",d))),b.sb(a,!0));return!0}};
b4w.module.particles=function(a,p){var h=p("__particles"),c=p("__print");a.set_size=function(a,b,l){h.ag(a)?h.set_size(a,b,l):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,b,l){h.ag(a)?h.set_normal_factor(a,b,l):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,b,l){h.ag(a)?(l=Math.min(l,1),l=Math.max(l,0),h.set_factor(a,b,l)):c.error('"',a.name,'" has no particle systems')}};
b4w.module.physics=function(a,p){var h=p("__print"),c=p("__physics"),f=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):h.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):h.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,f){c.has_physics(a)?c.set_gravity(a,f):h.error("No physics for object "+a.name)};a.set_damping=function(a,f,e){c.has_physics(a)?c.m("set_damping",a.j.F,f,e):h.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var f=a.game;c.m("set_damping",a.j.F,f.damping,f.rotation_damping)}else h.error("No physics for object "+a.name)};a.set_transform=function(a,f,e){c.has_physics(a)?c.set_transform.apply(this,
arguments):h.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):h.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):h.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):h.error("No physics for object "+a.name)};a.apply_force=function(a,f,e,k){c.has_physics(a)?c.apply_force.apply(this,
arguments):h.error("No physics for object "+a.name)};a.apply_torque=function(a,f,e,k){c.has_physics(a)?c.apply_torque.apply(this,arguments):h.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object"),c.vehicle_throttle(a,f.clamp(l,-1,1))):h.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,l,e){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object");
l=f.clamp(l,0,1);var k=a.f.Uf;-1==e||1==e?k=Math.max(-1,Math.min(k+e*l,1)):0==e&&0<=k?(k-=l,k=Math.max(0,k)):0==e&&0>k?(k+=l,k=Math.min(0,k)):h.error("Wrong steering direction");c.vehicle_throttle(a,f.clamp(k,-1,1))}else h.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object"),c.vehicle_steer(a,f.clamp(l,-1,1))):h.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,e){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||h.error("Wrong object");l=f.clamp(l,0,1);var k=a.f.vg;-1==e||1==e?k=Math.max(-1,Math.min(k+e*l,1)):0==e&&0<=k?(k-=l,k=Math.max(0,k)):0==e&&0>k?(k+=l,k=Math.min(0,k)):h.error("Wrong steering direction");c.vehicle_steer(a,f.clamp(k,-1,1))}else h.error("No physics for object "+a.name)};a.vehicle_brake=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object"),c.vehicle_brake(a,f.clamp(l,0,1))):h.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,l){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object");l=f.clamp(l,-1,1);var e=a.f.Wg;c.vehicle_brake(a,f.clamp(e+e*l,0,1))}else h.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
h.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Uf;h.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.vg;h.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return h.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Wg;h.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);h.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,f,e){c.has_physics(a)?c.set_character_move_dir(a,f,e):h.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,f){c.has_physics(a)?c.set_character_move_type(a,f):h.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){h.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,f){c.has_physics(a)?c.set_character_walk_velocity(a,f):h.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,f){c.has_physics(a)?c.set_character_run_velocity(a,f):h.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,f){c.has_physics(a)?c.set_character_fly_velocity(a,f):h.error("No physics for object "+a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):h.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,f,e){c.has_physics(a)?c.character_rotation_inc(a,f,e):h.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,f){c.has_physics(a)?c.set_character_rotation_quat(a,f):h.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,f,e){c.has_physics(a)?c.set_character_rotation(a,f,e):h.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,f){c.has_physics(a)?c.set_character_rotation_v(a,f):h.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,f){c.has_physics(a)?c.set_character_rotation_h(a,f):h.error("No physics for object "+a.name)};a.append_collision_test=function(a,f,e,k){c.has_physics(a)?c.append_collision_test(a,f,e,k):h.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,f){c.has_physics(a)?c.remove_collision_test(a,f):h.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,f){c.has_physics(a)?c.apply_collision_impulse_test(a,f):h.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):h.error("No physics for object "+a.name)};a.append_ray_test=function(a,f,e,k,d,r){c.has_physics(a)?c.append_ray_test(a,f,e,k,d,r):h.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,f,e,k,d){c.has_physics(a)?c.remove_ray_test(a,f,e,k,d):h.error("No physics for object "+a.name)};a.apply_constraint=function(a,f,e,k,d,r,x,n,t,w){c.has_physics(f)&&c.has_physics(d)?c.apply_constraint(a,f,e,k,d,r,x,n,t,w):h.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.fw(a)?c.clear_constraint(a):h.error("Wrong object")};a.pull_to_constraint_pivot=function(a,f,e,k,d,r){c.has_physics(a)&&c.has_physics(k)?c.pull_to_constraint_pivot(a,
f,e,k,d,r):h.error("Wrong objects")}};
b4w.module.scenes=function(a,p){var h=p("__batch"),c=p("__camera"),f=p("__graph"),b=p("__print"),l=p("__physics"),e=p("__scenes"),k=p("__util");a.DATA_ID_ALL=e.DATA_ID_ALL;a.set_active=function(a){var b=e.Mi();e.set_active(k.keysearch("name",a,b))};a.get_active=function(){return e.W()?e.get_active().name:""};a.get_scenes=function(){for(var a=e.Mi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(e.W())return e.get_active().camera;b.error("No active scene");return!1};
a.get_object_by_name=function(a,b){return e.Oi(e.Yj,a,b)};a.get_object_by_dupli_name=function(a,b,c){return e.Oi(e.Km,a,b,c)};a.get_object_by_dupli_name_list=function(a,b){return e.Oi(e.Lm,a,b)};a.get_object_by_empty_name=function(c,e,f){b.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(c,e,f)};a.get_object_data_id=function(a){return e.get_object_data_id(a)};a.pick_object=e.pick_object;a.set_glow_intensity=function(a,b){for(var c=
0;c<a.P.length;c++){var e=a.P[c];"COLOR_ID"==e.type&&(e.Zf=b)}};a.apply_glow_anim=function(a,b,c,f){a.d&&a.d.Kc&&e.apply_glow_anim(a,b,c,f)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Kc){var b=a.d.Pi;e.apply_glow_anim(a,b.Zv,b.aw,b.bw)}};a.clear_glow_anim=function(a){a.d&&a.d.Kc&&e.clear_glow_anim(a)};a.set_glow_color=function(a){var b=e.get_active();if(b=e.ga(b,"GLOW"))b.ph.set(a),b.ta=!0};a.get_shadow_params=function(){if(!e.W())return b.error("No active scene"),!1;var a=e.get_active(),c=e.ga(a,
"SHADOW_CAST");if(!c)return null;var f=a.d.wc,h=e.ga(a,"MAIN_OPAQUE"),k=e.ga(a,"DEPTH"),l={};l.csm_resolution=f.csm_resolution;l.self_shadow_polygon_offset=c.self_shadow_polygon_offset;k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.b4w_enable_csm=f.b4w_enable_csm;l.csm_num=f.csm_num;l.csm_first_cascade_border=f.csm_first_cascade_border;l.first_cascade_blur_radius=f.first_cascade_blur_radius;l.csm_last_cascade_border=f.csm_last_cascade_border;l.last_cascade_blur_radius=f.last_cascade_blur_radius;
l.fade_last_cascade=f.fade_last_cascade;l.blend_between_cascades=f.blend_between_cascades;f.b4w_enable_csm?(l.csm_borders=e.Hv(a,h.h),l.blur_radii=new Float32Array(f.csm_num),l.blur_radii.set(h.h.sj.subarray(0,f.csm_num))):(l.csm_borders=null,l.blur_radii=null);return l};a.set_shadow_params=function(a){if(!e.W())return b.error("No active scene"),!1;var k=e.get_active();"number"==typeof a.self_shadow_polygon_offset&&f.L(k.d.Na,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var l=e.ga(k,"DEPTH");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var n=e.ga(k,"MAIN_BLEND");n&&("number"==typeof a.self_shadow_normal_offset&&(n.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(n.pcf_blur_radius=a.pcf_blur_radius),n.ta=!0);n=k.d.wc;"number"==typeof a.csm_first_cascade_border&&(n.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(n.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(n.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(n.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var t=l.l,w=0;w<t.length;w++){var B=t[w];B.Va.rb&&(B=B.k,h.ik(B,n),h.sb(B))}l.ta=!0}l=k.camera.d.M;for(w=0;w<l.length;w++)c.Nj(l[w],n);e.Wl(k)};a.get_environment_colors=
function(){if(!e.W())return b.error("No active scene"),!1;var a=e.get_active();return e.get_environment_colors(a)};a.set_environment_colors=function(a,c,f){if(!e.W())return b.error("No active scene"),!1;var h=e.get_active();e.set_environment_colors(h,parseFloat(a),c,f)};a.get_fog_color_density=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();return e.get_fog_color_density(c,a)};a.set_fog_color_density=function(a){if(!e.W())return b.error("No active scene"),!1;var c=
e.get_active();e.set_fog_color_density(c,a)};a.get_ssao_params=function(){if(!e.W())return b.error("No active scene"),!1;var a=e.get_active();return e.get_ssao_params(a)};a.set_ssao_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_ssao_params(c,a)};a.get_color_correction_params=function(){if(!e.W())return b.error("No active scene"),null;var a=e.get_active(),a=e.ga(a,"COMPOSITING");if(!a)return null;var c={};c.brightness=a.brightness;c.contrast=a.contrast;
c.exposure=a.exposure;c.saturation=a.saturation;return c};a.set_color_correction_params=function(a){if(!e.W())return b.error("No active scene"),null;var c=e.get_active(),c=e.ga(c,"COMPOSITING");if(!c)return null;"number"==typeof a.brightness&&(c.brightness=a.brightness);"number"==typeof a.contrast&&(c.contrast=a.contrast);"number"==typeof a.exposure&&(c.exposure=a.exposure);"number"==typeof a.saturation&&(c.saturation=a.saturation);c.ta=!0};a.get_sky_params=function(){if(!e.W())return b.error("No active scene"),
!1;var a=e.get_active();return e.get_sky_params(a)};a.set_sky_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_sky_params(c,a)};a.get_dof_params=function(){if(!e.W())return b.error("No active scene"),!1;var a=e.get_active();return e.ga(a,"DOF")?e.get_dof_params(a):null};a.set_dof_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_dof_params(c,a)};a.get_god_rays_params=function(){if(!e.W())return b.error("No active scene"),
!1;var a=e.get_active();return e.ga(a,"GOD_RAYS")?e.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_god_rays_params(c,a)};a.get_bloom_params=function(){if(!e.W())return b.error("No active scene"),!1;var a=e.get_active();return e.ga(a,"BLOOM")?e.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_bloom_params(c,a)};a.get_wind_params=
function(){return e.get_wind_params()};a.set_wind_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_wind_params(c,a)};a.get_water_surface_level=e.get_water_surface_level;a.set_water_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.set_water_params(c,a)};a.get_water_mat_params=function(a){if(!e.W())return b.error("No active scene"),!1;var c=e.get_active();e.get_water_mat_params(c,a)};a.update_scene_materials_params=
function(){if(!e.W())return b.error("No active scene"),!1;var a=e.get_active();e.gr(a)};a.hide_object=function(a){e.hide_object(a)};a.show_object=function(a){e.show_object(a)};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return e.W()?e.check_object(a,e.get_active()):(b.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=e.get_active();a||(a="ALL");b||0===b||(b=e.DATA_ID_ALL);return e.la(c,a,b)};a.get_appended_objs=function(c,e){b.warn("get_appended_objs() deprecated, use get_all_objects() instead");
return a.get_all_objects(c,e)};a.get_object_name=function(a){return a?a.name:(b.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(b.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Cb};a.get_object_children=function(a){return a.Fd.slice(0)};a.get_first_character=function(){for(var a=e.la(e.get_active(),"MESH",e.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||
0===b||(b=1);return e.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return e.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.append_object=function(){k.da('Method "append_object" is deprecated')};a.add_object=function(){k.da('Method "add_object" is deprecated')};a.remove_object=function(){k.da('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){k.da("get_screen_scenes() deprecated")};a.set_light_pos=function(){k.da("set_light_pos() deprecated, use lights module instead")};
a.set_light_direction=function(){k.da("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){k.da("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){k.da("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){k.da("remove_all() deprecated, use lights module instead")};a.check_collision=function(){k.da("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){k.da("check_ray_hit() deprecated, use lights module instead")}};
b4w.module.sfx=function(a,p){var h=p("__scenes"),c=p("__sfx");a.play=function(a,b,h){c.play(a,b,h)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,b,h,e){c.cyclic(a,b);e&&c.playrate(a,e);c.play(a,0,h)};a.speaker_stop=function(a){c.stop(a)};a.stop=function(a){c.stop(a)};a.speaker_playback_rate=function(a,b){c.playrate(a,b)};a.playrate=function(a,b){c.playrate(a,b)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};
a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,h){c.speaker_reset_speed(a,b,h)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.Nv()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.Ix(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.Lw(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.vw()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};
a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=function(a){c.set_compressor_params(h.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(h.get_active())};a.duck=function(a,b,h){a&&"object"===typeof a?c.duck(a,b,h):c.Nu(b,h)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.Ey()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;
a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response};
b4w.module.shaders=function(a,p){function h(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function f(a){for(var b=k.Mi(),c=0;c<b.length;c++)for(var d=k.la(b[c],"MESH",k.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.P)for(var h=0;h<f.P.length;h++){var l=f.P[h];if(l.Yb==a&&l.tc.length)return l.tc}}return null}function b(a){a.sort(function(a,b){return b.Zk.ALU_OPS-a.Zk.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Zk,e=c.gz,h=f(c.xu),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";l.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,h);l.groupCollapsed("directives");for(var h=c.Xa.Od,k=0;k<h.length;k++){var s=h[k];l.log(s[0],s[1])}l.groupEnd();l.groupCollapsed("vert src");l.log(c.fz);l.groupEnd();l.groupCollapsed("vert stats");for(var y in e)"ALU_OPS"!=y&&"TEX_OPS"!=y&&l.log(y,e[y]);l.groupEnd();l.groupCollapsed("frag src");l.log(c.iv);l.groupEnd();l.groupCollapsed("frag stats");for(y in d)"ALU_OPS"!=y&&"TEX_OPS"!=y&&l.log(y,d[y]);l.groupEnd();
l.groupEnd()}}p("__config");var l=p("__print"),e=p("__extensions"),k=p("__scenes"),d=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=d.Bu(),b=0,c;for(c in a){var e=a[c],f=e.count;1<f&&l.log(f-1,e.vB,e.MA);b+=f-1}l.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var f=d.Fv(),k=0,t;for(t in f)a&&-1===t.indexOf(a)||k++;var k="of "+k+" analyzing...",w={};for(t in f)if(!a||-1!==t.indexOf(a)){var B=f[t],q,s=B.Bm;q=B.Bo;var y=e.Fo();if(y){s=y.getTranslatedShaderSource(s);
q=y.getTranslatedShaderSource(q);var y=c("/nvidia_vert",s),g=h(y),A=c("/nvidia_frag",q),u=h(A);q={fz:s,GB:y,gz:g,iv:q,rA:A,Zk:u}}else l.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),q=void 0;y=B.Xa;s=y.bi+" + "+y.kh;q.xu=B;q.Xa=y;B=w[s]=w[s]||[];B.push(q);l.log(k)}for(s in w)l.group("%c"+s,"color: #800"),B=w[s],b(B),l.groupEnd()}};
b4w.module.textures=function(a,p){var h=p("__textures"),c=p("__print");a.get_canvas_texture_context=function(a){var b=h.Dv(a);if(b)return b;c.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){h.Jy(a)||c.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){h.play_video(a)||c.error('Texture with name "'+a+'" not found!')};a.stop_video=function(a){h.stop_video(a)||c.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a){h.reset_video(a)||
c.error('Texture with name "'+a+'" not found!')}};
b4w.module.transform=function(a,p){var h=p("__print"),c=p("__physics"),f=p("__transform"),b=p("__util"),l=new Float32Array(3),e=new Float32Array(4);a.SPACE_LOCAL=f.SPACE_LOCAL;a.SPACE_WORLD=f.SPACE_WORLD;a.set_translation=function(a,b,e,h){l[0]=b;l[1]=e;l[2]=h;f.set_translation(a,l);f.v(a);c.sync_transform(a)};a.set_translation_v=function(a,b){f.set_translation(a,b);f.v(a);c.sync_transform(a)};a.set_translation_rel=function(a,d,e,h,n){l[0]=d;l[1]=e;l[2]=h;b.Yh(l,1,n.d.quat,n.d.e,l);f.set_translation(a,
l);f.v(a);c.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));f.get_translation(a,b);return b};a.set_rotation=function(a,b,h,l,n){e[0]=b;e[1]=h;e[2]=l;e[3]=n;f.set_rotation(a,e);f.v(a);c.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){f.set_rotation(a,b);f.v(a);c.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));f.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,b,e,h){l[0]=b;l[1]=e;l[2]=h;f.set_rotation_euler(a,l);f.v(a);c.sync_transform(a)};a.set_rotation_euler_v=function(a,b){f.set_rotation_euler(a,b);f.v(a);c.sync_transform(a)};a.set_scale=function(a,b){f.set_scale(a,b);f.v(a)};a.get_scale=function(a){return f.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return h.error("Wrong object: "+a.name),!1;f.set_translation(a,[0,0,0]);f.set_rotation(a,[0,0,0,1]);f.set_scale(a,1);f.v(a);c.sync_transform(a)};
a.get_object_size=function(a){return b.sc(a)?f.get_object_size(a):(h.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,e){return b.sc(a)?f.get_object_center(a,c,e):(h.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,e,h){f.move_local(a,b,e,h);f.v(a);c.sync_transform(a)};a.get_object_bounding_box=function(a){return f.get_object_bounding_box(a)}};
b4w.module.util=function(a,p){var h=p("__print"),c=p("__util"),f=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,f){f||(f=new Float32Array(4));return c.euler_to_quat(a,f)};a.quat_to_euler=
function(a,f){f||(f=new Float32Array(3));return c.quat_to_euler(a,f)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,f){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,f)};a.cam_quat_to_mesh_quat=function(a,f){return c.cam_quat_to_mesh_quat(a,f)};a.quat_project=function(a,l,e,k,d){return 0!=f.dot(e,k)?(h.error("Wrong in-plane direction"),null):c.quat_project(a,l,e,k,d)};a.hash_code=c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;
a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect};"object"==typeof module&&module.Qk&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var h=p("__version");a.version=h.version;a.type=h.type;a.date=h.date};"object"==typeof module&&module.Qk&&b4w.module.version(exports);
b4w.module.main=function(a,p){function h(){}function c(){}function f(){}function b(){ia=0;window.performance||(q.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();q.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function l(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();q.error("B4W Error: WebGL context lost");k()},!1);A.Xb(b);var d=A.Mo();
d&&q.log("%cRENDERER INFO:","color: #00a",b.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(d.UNMASKED_RENDERER_WEBGL));m.Xb(b);u.Xb(b);P.Xb(b);U.Xb(b);g.Xb(b);y.Xb(b);H.xq(a.width,a.height);D.init();c=n();r()}function e(){h=function(){}}function k(){d()||(L=performance.now()/1E3,D.pause(),K.pause(),P.pause())}function d(){return G<L}function r(){C(r);var a=performance.now()/1E3;W||(W=a);var b=a-W;b<1/T.$d||(d()||(G>W&&(b-=G-Math.max(L,W)),ia+=b,g.update(),v.update(),y.update(),x(ia,b),
c(b)),W=a)}function x(a,b){y.is_primary_loaded()&&(S.reset(),Z.update(b),I.update(a,b),D.update(a,b),t.update(b),y.is_primary_loaded()&&(K.update(a,b),y.is_primary_loaded()&&(h(b,a),y.is_primary_loaded()&&(s.update(a,b),y.is_primary_loaded()&&(H.update(a,b),fa&&(fa(X.toDataURL()),fa=null))))))}function n(){var a=60,b=0,c=0,d=T.fv,e=T.ev;return function(g){a=V.smooth(1/g,a,g,d);b=V.smooth(0,b,g,d);c=(c+1)%e;0==c&&f(Math.round(a),Math.round(b))}}var t=p("__animation"),w=p("__compat"),B=p("__config"),
q=p("__print"),s=p("__controls"),y=p("__data"),g=p("__debug"),A=p("__extensions"),u=p("__geometry"),S=p("__hud"),I=p("__nla"),v=p("__assets"),K=p("__physics"),m=p("__renderer"),H=p("__scenes"),D=p("__sfx"),U=p("__shaders"),P=p("__textures"),Z=p("__transform"),V=p("__util"),M=p("__version"),Q=B.context,T=B.n,X=null,z=null,ia=0,W=0,L=0,G=0,fa=null,da=["webgl","experimental-webgl"],C=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/T.$d)}}();a.init=function(a,c){B.Jx();q.Ox(T.console_verbose);var d=M.version()+" "+M.type()+" ("+M.date()+")";q.log("%cINIT B4W ENGINE","color: #00a",d);if(!window.WebGLRenderingContext)return null;d=b();X=a;var e;e=null;for(var g=0;g<da.length;g++){var f=da[g];try{e=a.getContext(f,Q)}catch(m){}if(e)break}if(!e)return null;l(X,e);B.jt();w.Gx(e);q.log("%cSET PRECISION:","color: #00a",T.precision);
c?(S.init(c),z=c):(B.n.show_hud_debug_info=!1,B.Ad.hj=!1);K.lw(d);return e};a.set_check_gl_errors=function(a){g.set_check_gl_errors(a)};a.resize=function(a,b){X.style.width=a+"px";X.style.height=b+"px";z&&(z.style.width=a+"px",z.style.height=b+"px");X.width=a*T.Ai;X.height=b*T.Ai;z&&(z.width=a,z.height=b);S.Fg();H.xq(a*T.Ai,b*T.Ai);m.clear();x(ia,0);y.Oy(X.width,X.height)};a.set_fps_callback=function(a){f=a};a.clear_fps_callback=function(){f=function(){}};a.set_on_before_render_callback=function(a){h=
a};a.set_render_callback=function(a){h=a};a.clear_on_before_render_callback=function(){e()};a.clear_render_callback=function(){e()};a.global_timeline=function(){return ia};a.redraw=function(){x(ia,0)};a.pause=k;a.resume=function(){d()&&(G=performance.now()/1E3,D.resume(),K.resume(),P.play(!0))};a.is_paused=d;a.reset=function(){y.unload();z=X=null;G=L=W=ia=0;f=function(){};c=function(){};h=function(){}};a.canvas_data_url=function(a){fa=a};a.get_canvas_elem=function(){return X};a.set_texture_quality=
function(){V.da("set_texture_quality() deprecated")};a.set_shaders_dir=function(){V.da("set_shaders_dir() deprecated")};a.detect_mobile=function(){return w.detect_mobile()}};b4w={module:{},register:function(a,p){var h=b4w.module;if(h[a])throw Error('Module "'+a+'" already registered');h[a]=p},require:function(a){var p=b4w.require,h=b4w.module[a];if(!h)throw Error('Module "'+a+'" not found');h._compiled||(h._compiled={},h(h._compiled,p));return h._compiled},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a,p){function h(){var a=new Date,f=a.getDate(),f=10>f?"0"+String(f):String(f),b=a.getMonth()+1,b=10>b?"0"+String(b):String(b),h=String(a.getFullYear()),e=a.getHours(),e=10>e?"0"+String(e):String(e),k=a.getMinutes(),k=10>k?"0"+String(k):String(k),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return f+"."+b+"."+h+" "+e+":"+k+":"+a}a.version=function(){return""};a.type=function(){return"DEBUG"};a.date=h;a.timestamp=function(){var a=h(),a=a.split(" ").join("").split(":").join("").split(".").join("");
return"?t="+a}};"object"==typeof module&&module.exports&&b4w.module.__version(exports);b4w.module.__boundings=function(a,p){function h(a,b){for(var c=a[0],d=a[1],e=a[2],f=a[0],g=a[1],h=a[2],k=3;k<a.length;k+=3)var l=a[k],n=a[k+1],v=a[k+2],c=Math.max(c,l),d=Math.max(d,n),e=Math.max(e,v),f=Math.min(f,l),g=Math.min(g,n),h=Math.min(h,v);b.max_x=c;b.max_y=d;b.max_z=e;b.min_x=f;b.min_y=g;b.min_z=h;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,e=a.max_z,f=a.min_x,g=a.min_y,h=a.min_z;b[0]=f;b[1]=g;b[2]=h;b[3]=c;b[4]=g;b[5]=h;b[6]=c;b[7]=d;b[8]=h;b[9]=f;b[10]=
d;b[11]=h;b[12]=f;b[13]=g;b[14]=e;b[15]=c;b[16]=g;b[17]=e;b[18]=c;b[19]=d;b[20]=e;b[21]=f;b[22]=d;b[23]=e;return b}function f(a,b,c){k.add(b,c,a.center);k.scale(a.center,.5,a.center);a.radius=k.distance(a.center,b);return a}var b=p("__geometry"),l=p("__util"),e=p("__tsr"),k=p("vec3"),d=new Float32Array(24),r=new Float32Array(3),x=new Float32Array(3),n=new Float32Array(3);a.copy_bb=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.big_bounding_box=
function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zero_bounding_box=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.expand_bounding_box=function(a,b){var c=a.max_y,d=a.max_z,e=a.min_x,f=a.min_y,g=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,g);return a};a.bb_from_coords=h;a.bounding_box_transform=
function(b,e,f){f||(f=a.zero_bounding_box());b=c(b,d);l.positions_multiply_matrix(b,e,b);return h(b,f)};a.extract_bb_corners=c;a.shrink_bounding_box=function(b,c,d){d||(d=a.zero_bounding_box());var e=c.min_x,f=c.max_x,h=c.min_y,g=c.max_y,k=c.min_z;c=c.max_z;if(e>=b.max_x||f<=b.min_x||h>=b.max_y||g<=b.min_y||k>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,h);d.max_y=
Math.min(b.max_y,g);d.min_z=Math.max(b.min_z,k);d.max_z=Math.min(b.max_z,c);return d};a.stretch_bounding_box=function(b,c,d){d||(d=a.zero_bounding_box());var e=b.max_x-b.min_x,f=b.max_y-b.min_y,h=b.max_z-b.min_z;d.min_x=b.min_x-.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*h;d.max_z=b.max_z+.5*(c-1)*h;return d};a.bounding_sphere_transform=function(b,c,d){d||(d=a.zero_bounding_sphere());k.transformMat4(b.center,c,d.center);d.radius=
b.radius*l.matrix_to_scale(c);return d};a.bounding_ellipsoid_transform=function(a,b,c){c||(c={axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array([0,0,0])});e.transform_vec3(a.center,b,c.center);k.copy(a.axis_x,c.axis_x);k.copy(a.axis_y,c.axis_y);k.copy(a.axis_z,c.axis_z);e.transform_dir_vec3(c.axis_x,b,c.axis_x);e.transform_dir_vec3(c.axis_y,b,c.axis_y);e.transform_dir_vec3(c.axis_z,b,c.axis_z);return c};a.create_bounding_sphere=function(a,b){return{radius:a,
center:new Float32Array(b)}};a.zero_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:0}};a.create_bounding_ellipsoid=function(a,b,c,d){return{axis_x:new Float32Array(a),axis_y:new Float32Array(b),axis_z:new Float32Array(c),center:new Float32Array([d[0],d[1],d[2]])}};a.big_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:1E12}};a.expand_bounding_sphere=function(a,b){var c=k.subtract(b.center,a.center,k.create());0==k.length(c)&&k.set(1,0,0,c);var d=
k.normalize(c,k.create()),c=k.scale(d,a.radius,k.create());k.add(c,a.center,c);var e=k.scale(d,-a.radius,k.create());k.add(e,a.center,e);var f=k.scale(d,b.radius,k.create());k.add(f,b.center,f);var g=k.scale(d,-b.radius,k.create());k.add(g,b.center,g);c=[c,e,f,g];d=k.normalize(d,k.create());e=c[0];f=c[0];for(g=1;g<c.length;g++){var h=k.dot(c[g],d);h<k.dot(e,d)&&(e=c[g]);h>k.dot(f,d)&&(f=c[g])}d=[e,f];c=d[0];d=d[1];a.center=k.scale(k.add(c,d,k.create()),.5,k.create());a.radius=k.length(k.subtract(d,
c,k.create()))/2};a.create_bounding_capsule=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d-2*a);return{radius:a,height:e,center:new Float32Array([0,(c+d)/2,0])}};a.create_bounding_cylinder=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{radius:a,height:e,center:new Float32Array([0,(c+d)/2,0])}};a.create_bounding_cone=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{radius:a,height:e,center:new Float32Array([0,(c+d)/2,0])}};a.check_bb_intersection=function(a,b){return a.min_x>
b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.recalculate_mesh_boundings=function(a){for(var b=0,c=0,d=0,e=0,f=0,g=0,h=0,k=0,l=0;l<a.submeshes.length;l++){var n=a.submeshes[l];if(n.position.length){b=e=n.position[0];c=f=n.position[1];d=g=n.position[2];break}}for(l=0;l<a.submeshes.length;l++)for(var n=a.submeshes[l],n=n.position,v=0;v<n.length/3;v++)var r=n[3*v],m=n[3*v+1],H=n[3*v+2],b=Math.max(r,b),c=Math.max(m,c),d=Math.max(H,d),e=Math.min(r,
e),f=Math.min(m,f),g=Math.min(H,g),h=Math.max(Math.sqrt(r*r+m*m+H*H),h),k=Math.max(Math.sqrt(r*r+H*H),k);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=g;a.b4w_bounding_sphere_radius=h;a.b4w_bounding_cylinder_radius=k};a.get_frustum_mec=function(c){var d=c.subarray(0,3),e=c.subarray(6,9),h=c.subarray(12,15),l=c.subarray(18,21);c=k.subtract(e,d,r);k.normalize(c,c);var y=b.get_plane_normal(d,
e,h,x),y=k.cross(y,c,y);k.normalize(y,y);var g=k.create(),A=k.create();k.subtract(e,d,n);A[0]=k.dot(n,c);A[1]=k.dot(n,y);e=k.create();k.subtract(h,d,n);e[0]=k.dot(n,c);e[1]=k.dot(n,y);h=k.create();k.subtract(l,d,n);h[0]=k.dot(n,c);h[1]=k.dot(n,y);l=a.zero_bounding_sphere();h=[g,A,e,h];g=f(l,h[0],h[1]);for(l=2;l<h.length;l++)if(k.distance(g.center,h[l])>g.radius){for(var u=g,g=h,A=h[l],e=l-1,u=f(u,A,g[0]),p=1;p<=e;p++)if(k.distance(u.center,g[p])>u.radius){for(var I=u,u=g,v=A,K=g[p],m=p-1,I=f(I,v,
K),H=0;H<=m;H++)if(k.distance(I.center,u[H])>I.radius){var D=v,U=K,P=u[H],Z=k.subtract(U,P,n),Z=k.squaredLength(Z),V=k.subtract(D,P,n),M=k.squaredLength(V),V=k.subtract(D,U,n),Q=k.squaredLength(V),V=Z*(M+Q-Z),T=M*(Q+Z-M),Z=Q*(Z+M-Q),M=V+T+Z;k.copy(D,I.center);k.scale(I.center,V/M,I.center);k.scaleAndAdd(I.center,U,T/M,I.center);k.scaleAndAdd(I.center,P,Z/M,I.center);I.radius=k.distance(I.center,D)}u=I}g=u}l=g;c=k.scale(c,l.center[0],n);k.scaleAndAdd(c,y,l.center[1],c);k.add(c,d,l.center);return l}};b4w.module.__constraints=function(a,p){function h(a){var b={};b.type=a;return b}function c(a,b){a._constraint&&a._constraint.obj_parent&&f(a._constraint.obj_parent,a);if(b.obj_parent){var c=b.obj_parent;if(-1==c._descends.indexOf(a))c._descends.push(a);else throw"Descendant object override is forbidden";}a._constraint=b}function f(a,b){var c=a._descends.indexOf(b);if(-1!=c)a._descends.splice(c,1);else throw"No descendant object";}function b(a,b,c){switch(b.type){case 1:var d=a._render.quat,f=b.obj_parent._render.world_matrix;
c=b.obj_parent._render.quat;b.rotation_offset?(w.copy(b.rotation_offset,d),w.multiply(c,d,d)):w.copy(c,d);t.transformMat4(b.offset,f,a._render.trans);a._render.scale=b.scale_offset*b.obj_parent._render.scale;break;case 9:var h=a._render.trans,d=a._render.quat,f=b.obj_parent._render.world_matrix;c=b.obj_parent._render.quat;w.multiply(w.invert(b.parent_prev_rotation,b.parent_prev_rotation),d,d);w.multiply(c,d,d);t.transformMat4(b.offset,f,h);w.copy(c,b.parent_prev_rotation);break;case 10:h=a._render.trans;
d=a._render.quat;f=b.obj_parent._render.world_matrix;c=b.obj_parent._render.quat;w.multiply(w.invert(b.parent_prev_rotation,b.parent_prev_rotation),d,d);w.multiply(c,d,d);t.transformMat4(b.offset,f,h);w.copy(c,b.parent_prev_rotation);var d=a._render.quat,h=b.obj_parent._render.quat,u=t.transformQuat(n.AXIS_Y,d,q),I=w.invert(h,A),p=t.transformQuat(u,I,s),X=y;X[0]=p[0];X[1]=0;X[2]=p[2];f=t.length(X);I=-X[2]/f;I=Math.acos(I)*n.sign(X[0]);f/=t.length(p);f=Math.acos(f)*n.sign(p[1]);p=!1;I<-b.clamp_left&&
(I=-b.clamp_left,p=!0);I>b.clamp_right&&(I=b.clamp_right,p=!0);f<-b.clamp_up&&(f=-b.clamp_up,p=!0);f>b.clamp_down&&(f=b.clamp_down,p=!0);p&&(b=Math.sin(f),f=Math.cos(f),p=Math.sin(I),I=Math.cos(I),X=s,X[0]=f*p,X[1]=b,X[2]=-f*I,t.transformQuat(X,h,X),b=w.rotationTo(u,X,A),w.multiply(b,d,d),w.normalize(d,d));"CAMERA"==a._render.type&&(b=t.transformQuat(n.AXIS_Y,c,s),k(a,b));break;case 12:h=a._render.trans;d=a._render.quat;f=b.obj_parent._render.world_matrix;I=b.obj_parent._render.trans;a=b.softness;
p=q;u=A;t.transformMat4(b.offset,f,p);n.smooth_v(p,h,c,a,h);b=q;t.sub(I,h,b);t.normalize(b,b);X=d;h=v;I=h.subarray(0,3);f=h.subarray(3,6);p=h.subarray(6,9);t.copy(b,f);t.negate(f,f);t.normalize(f,f);Boolean(.999999<Math.abs(t.dot(b,n.AXIS_Y)))?(b=B.fromQuat(w.normalize(X,u),K),t.copy(b.subarray(0,3),I)):t.cross(n.AXIS_Y,f,I);t.normalize(I,I);t.cross(I,f,p);t.normalize(p,p);w.fromMat3(h,u);w.normalize(u,u);n.smooth_q(u,d,c,.16*a,d);break;case 2:d=a._render.quat;I=g;c=A;r(b.obj_parent,b.bone_name,!0,
I,c);b.rotation_offset?(w.copy(b.rotation_offset,d),w.multiply(c,d,d)):w.copy(c,d);n.transform_vec3(b.offset,1,c,I,a._render.trans);break;case 3:h=a._render.trans;d=a._render.quat;c=b.obj_parent._render.trans;l(h,d,c);"CAMERA"==a._render.type&&k(a,n.AXIS_Y);break;case 4:h=a._render.trans;d=a._render.quat;c=b.target;l(h,d,c);"CAMERA"==a._render.type&&k(a,n.AXIS_Y);break;case 5:h=a._render.trans;d=a._render.quat;c=b.obj_parent._render.trans;d=e(h,d,c,b.offset_min,m);u=t.dist(h,c);if(b=d?u+b.offset_min:
u>b.offset_max?u-b.offset_max:u<b.offset_min?u-b.offset_min:0)t.sub(c,h,q),t.normalize(q,q),t.scale(q,b,q),t.add(h,q,h);"CAMERA"==a._render.type&&k(a,n.AXIS_Y);break;case 6:h=a._render.trans;d=a._render.quat;c=b.target;d=e(h,d,c,b.offset_min,m);u=t.dist(h,c);if(b=d?u+b.offset_min:u>b.offset_max?u-b.offset_max:u<b.offset_min?u-b.offset_min:0)t.sub(c,h,q),t.normalize(q,q),t.scale(q,b,q),t.add(h,q,h);"CAMERA"==a._render.type&&k(a,n.AXIS_Y);break;case 7:f=b.obj_parent._render.world_matrix;t.transformMat4(b.offset,
f,a._render.trans);break;case 8:I=b.obj_parent._render.trans;h=a._render.trans;t.add(I,b.offset,h);break;case 13:d=a._render.quat;f=b.obj_parent._render.world_matrix;c=b.obj_parent._render.quat;b.rotation_offset?(w.copy(b.rotation_offset,d),w.multiply(c,d,d)):w.copy(c,d);t.transformMat4(b.offset,f,a._render.trans);break;case 11:c=b.obj_parent._render,c=x.create_sep(c.trans,c.scale,c.quat,S),x.multiply(c,b.tsr_offset,c),h=a._render.trans,h[0]=c[0],h[1]=c[1],h[2]=c[2],a._render.scale=c[3],d=a._render.quat,
d[0]=c[4],d[1]=c[5],d[2]=c[6],d[3]=c[7]}}function l(a,b,c){var d=q;n.quat_to_dir(b,n.AXIS_MY,d);t.normalize(d,d);var e=s;t.subtract(c,a,e);t.normalize(e,e);a=g;n.rotation_to_stable(d,e,a);w.multiply(a,b,b)}function e(a,b,c,d,e){var f=!1,m=q;n.quat_to_dir(b,n.AXIS_MY,m);t.normalize(m,m);var h=s;t.subtract(c,a,h);a=t.length(h);t.normalize(h,h);t.dot(m,h)<Math.cos(e)&&(t.scale(h,-1,h),f=!0);a>d-.001&&(d=n.rotation_to_stable(m,h,g),w.multiply(d,b,b),w.normalize(b,b));return f}function k(a,b){var c=a._render.quat,
e=d(c,b,A);w.multiply(e,c,c)}function d(a,b,c){a=B.fromQuat(a,v);var d=q;d[0]=a[3];d[1]=a[4];d[2]=a[5];if(.999<Math.abs(t.dot(b,d)))return w.identity(c),c;b=t.cross(b,d,d);t.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);d=s;d[0]=a[0];d[1]=a[1];d[2]=a[2];t.normalize(d,d);w.rotationTo(d,b,c);return c}function r(a,b,c,d,e){var f=a._render,m=f.frame_factor,h=f.bone_pointers[b];b=h.deform_bone_index;a=a.pose.bones[h.pose_bone_index];var h=a._tsr_local,k=g,q=f.trans_before,l=f.trans_after,n=f.quats_before,
s=f.quats_after,v=q[4*b+1],r=q[4*b+2],t=q[4*b+3],y=l[4*b+1],C=l[4*b+2],J=l[4*b+3];k[0]=(1-m)*q[4*b]+m*l[4*b];k[1]=(1-m)*v+m*y;k[2]=(1-m)*r+m*C;k[3]=(1-m)*t+m*J;q=A;l=u;q[0]=n[4*b];q[1]=n[4*b+1];q[2]=n[4*b+2];q[3]=n[4*b+3];l[0]=s[4*b];l[1]=s[4*b+1];l[2]=s[4*b+2];l[3]=s[4*b+3];w.slerp(q,l,m,q);m=S;x.set_transcale(k,m);x.set_quat(q,m);c?(c=I,x.translate(h,a._tail,c),x.multiply(m,c,m)):x.multiply(m,h,m);x.multiply(f.tsr,m,m);d[0]=m[0];d[1]=m[1];d[2]=m[2];d[3]=m[3];e&&(e[0]=m[4],e[1]=m[5],e[2]=m[6],e[3]=
m[7])}var x=p("__tsr"),n=p("__util"),t=p("vec3"),w=p("quat"),B=p("mat3");p("mat4");a.CONS_TYPE_STIFF_OBJ=1;a.CONS_TYPE_STIFF_BONE=2;a.CONS_TYPE_TRACK_OBJ=3;a.CONS_TYPE_TRACK_POINT=4;a.CONS_TYPE_FOLLOW_OBJ=5;a.CONS_TYPE_FOLLOW_POINT=6;a.CONS_TYPE_STIFF_TRANS_OBJ=7;a.CONS_TYPE_COPY_TRANS_OBJ=8;a.CONS_TYPE_SEMI_STIFF_OBJ=9;a.CONS_TYPE_SEMI_STIFF_CAM_OBJ=10;a.CONS_TYPE_CHILD_OF=11;a.CONS_TYPE_SEMI_SOFT_CAM_OBJ=12;a.CONS_TYPE_STIFF_TRANS_ROT_OBJ=13;var q=new Float32Array(3),s=new Float32Array(3),y=new Float32Array(3),
g=new Float32Array(4),A=new Float32Array(4),u=new Float32Array(4),S=new Float32Array(16),I=new Float32Array(16),v=new Float32Array(9),K=new Float32Array(9),S=new Float32Array(8),m=9*Math.PI/10;a.CONS_ROTATE_LIMIT=m;a.append_stiff_obj=function(a,d,e,f,g){var m=h(1);m.obj_parent=d;m.offset=new Float32Array(e);m.scale_offset=g||1;m.rotation_offset=f?new Float32Array(f):null;c(a,m);b(a,m,0)};a.append_stiff_bone=function(a,d,e,f,g){var m=h(2);m.obj_parent=d;m.bone_name=e;m.offset=new Float32Array(f);m.rotation_offset=
g?new Float32Array(g):null;c(a,m);b(a,m,0)};a.append_semi_stiff_obj=function(a,d,e,f){var g=h(9),m=a._render.quat,k=d._render.quat;g.obj_parent=d;g.offset=new Float32Array(e);g.parent_prev_rotation=new Float32Array(k);f&&(w.copy(f,m),w.multiply(k,m,m));c(a,g);b(a,g,0)};a.append_semi_stiff_cam_obj=function(a,d,e,f,g,m,k,q){var l=h(10),n=a._render.quat,u=d._render.quat;l.obj_parent=d;l.offset=new Float32Array(e);l.parent_prev_rotation=new Float32Array(u);l.clamp_left=g;l.clamp_right=m;l.clamp_up=k;
l.clamp_down=q;f&&(w.copy(f,n),w.multiply(u,n,n));c(a,l);b(a,l,0)};a.append_semi_soft_cam_obj=function(a,d,e,f){var g=h(12);g.obj_parent=d;g.offset=new Float32Array(e);g.softness=f;c(a,g);b(a,g,0)};a.append_stiff_trans_rot_obj=function(a,d,e,f,g){var m=h(13);m.obj_parent=d;m.offset=new Float32Array(e);m.scale_offset=g||1;m.rotation_offset=f?new Float32Array(f):null;c(a,m);b(a,m,0)};a.append_track_obj=function(a,d){var e=h(3);e.obj_parent=d;c(a,e);b(a,e,0)};a.append_track_point=function(a,d){var e=
h(4);e.target=new Float32Array(d);c(a,e);b(a,e,0)};a.append_follow_obj=function(a,d,e,f){var g=h(5);g.obj_parent=d;g.offset_min=e;g.offset_max=f;c(a,g);b(a,g,0)};a.append_follow_point=function(a,d,e,f){var g=h(6);g.target=new Float32Array(d);g.offset_min=e;g.offset_max=f;c(a,g);b(a,g,0)};a.append_stiff_trans_obj=function(a,d,e){var f=h(7);f.obj_parent=d;f.offset=new Float32Array(e);c(a,f);b(a,f,0)};a.append_copy_trans_obj=function(a,d,e){var f=h(8);f.obj_parent=d;f.offset=new Float32Array(e);c(a,
f);b(a,f,0)};a.append_child_of=function(a,d,e){var f=h(11);f.obj_parent=d;f.tsr_offset=new Float32Array(e);c(a,f);b(a,f,0)};a.update_constraint=function(a,c){a._constraint&&b(a,a._constraint,c)};a.rotate_to=l;a.rotate_to_limits=e;a.correct_up=k;a.calc_cam_rot_correction=d;a.remove=function(a){a._constraint.obj_parent&&f(a._constraint.obj_parent,a);a._constraint=null};a.get_type=function(a){return a._constraint?a._constraint.type:null};a.get_parent=function(a){return a._constraint&&a._constraint.obj_parent?
a._constraint.obj_parent:null};a.get_child_of_offset=function(a){return a._constraint&&11==a._constraint.type?a._constraint.tsr_offset:null};a.get_bone_pose=r};b4w.module.__compat=function(a,p){function h(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}var c=p("__config"),f=p("__extensions"),b=p("__print"),l=p("__util");a.set_hardware_defaults=function(a){var k=c.animation,d=c.defaults,r=c.context,x=c.scenes,n=c.sfx;d.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);d.max_cube_map_size=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var t=Boolean(f.get_depth_texture());h("Firefox/28.0")&&(h("Linux")||h("Macintosh"))&&(b.warn("Firefox 28 detected, applying depth hack"),
t=!1);h("iPad")||h("iPhone")?(b.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),r.alpha||(d.background_color[3]=1),d.vert_anim_mix_normals_hack=!0,d.smaa=!1,d.ssao=!1,d.precision="highp",d.init_wa_context_hack=!0):h("Mac OS X")&&h("Safari")&&!h("Chrome")&&(b.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),
n.audio_loading_hack=!0,n.clamp_playback_rate_hack=!0);h("Windows")&&(h("Firefox/33")||h("Chrome/40")||h("Chrome/41"))&&(b.warn("Condititions for clear procedural skydome hack detected"),d.clear_procedural_sky_hack=!0);if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))b.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),
d.glsl_unroll_hack=!0,d.is_mobile_device=!0,h("iPad")||h("iPhone")||(b.warn("Mobile (not iOS) detected, disable playback rate for video textures."),n.disable_playback_rate_hack=!0);10>a.getParameter(a.MAX_VARYING_VECTORS)&&(b.warn("Not enough varyings, disable shadows on blend objects"),d.disable_blend_shadows_hack=!0);if(r=f.get_renderer_info())h("Macintosh")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(b.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),
t=!1,d.glsl_unroll_hack=!0),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(b.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),t=!1,k.frames_blending_hack=!0),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(b.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),d.precision="highp",d.shadows="NONE"),
-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(b.warn("Qualcomm Adreno detected, applying shader constants hack."),d.shader_constants_hack=!0,-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(b.warn('Qualcomm Adreno305 detected, set "highp" precision.'),d.precision="highp"),-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(b.warn('Qualcomm Adreno330 detected, set "highp" precision.'),d.precision=
"highp")),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(b.warn("NVIDIA Tegra 3 detected, force low quality for LEVELS_OF_QUALITY nodes."),d.force_low_quality_nodes=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(b.warn("Vertex textures are not allowed. Disabling vertex textures"),d.allow_vertex_textures=!1);t||(d.deferred_rendering=!1,d.foam=!1,d.parallax=!1,d.dynamic_grass=!1,d.procedural_fog=!1,d.water_dynamic=
!1,d.shore_smoothing=!1,d.shore_distance=!1,d.smaa=!1);d.use_dds=Boolean(f.get_s3tc());k=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);k=l.clamp(k,128,Infinity);d.max_bones=l.trunc((k-50)/4);d.max_bones_no_blending=l.trunc((k-50)/2);k=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT);0===k.precision&&(d.precision="mediump");!window.ActiveXObject&&"ActiveXObject"in window&&(b.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),
x.cubemap_tex_size=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(b.warn("Not enough fragment uniforms, force low quality for LEVELS_OF_QUALITY nodes."),d.force_low_quality_nodes=!0)}};b4w.module.__config=function(a,p){function h(){return b4w.module_check(a.paths.built_in_data_module)}var c=p("__print"),f=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.context_save=f.clone_object_r(a.context);a.defaults={alpha_sort:!0,alpha_sort_threshold:.1,min_format_version:5,max_fps:1E4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,fps_measurement_interval:1.5,fps_callback_interval:10,background_color:[0,0,0,0],force_selectable:!1,
all_objs_selectable:!1,lod_transition_ratio:.01,resolution_factor:1,canvas_resolution_factor:1,texture_min_filter:3,allow_cors:!1,force_low_quality_nodes:!1,anisotropic_filtering:!0,show_hud_debug_info:!1,depth_textures:!0,shadows:"DEPTH",anaglyph_use:!1,reflections:!0,reflect_multiplier:.5,refractions:!0,glow:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,procedural_fog:!0,
water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,max_texture_size:1024,max_cube_map_size:512,max_bones:53,use_dds:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,allow_vertex_textures:!0,glsl_unroll_hack:!1,no_phy_interp_hack:!1,shader_constants_hack:!1,disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1};a.defaults_save=f.clone_object_r(a.defaults);a.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1};
a.controls={cam_trans_base_speed:[5,5,5,5],cam_zoom_base_speed:.1,mouse_wheel_notch_multiplier:1/120};a.assets={max_requests:15,prevent_caching:!0,min50_available:!1,dds_available:!1};a.assets_save=f.clone_object_r(a.assets);a.paths={shaders_dir:"../../shaders/",shaders_include_dir:"include/",shader_texts_module:"shader_texts",built_in_data_module:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",resources_dir:"../external/deploy/apps/common/",resources_search_paths:["b4w.min.js",
"b4w.full.min.js","webplayer.min.js","src/data.js"]};a.physics={enabled:!0,max_fps:60,uranium_path:""};a.physics_save=f.clone_object_r(a.physics);a.scenes={offscreen_tex_size:1024,grass_tex_size:1024,cubemap_tex_size:384};a.scenes_save=f.clone_object_r(a.scenes);a.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1};a.sfx_save=f.clone_object_r(a.sfx);a.debug_subs={enabled:!1,subs_type:"MAIN_OPAQUE",subs_number:0,slink_type:"COLOR"};a.debug_subs_save=
f.clone_object_r(a.debug_subs);a.apply_quality=function(){var b=a.defaults,c=a.physics,e=a.scenes;switch(b.quality){case a.P_ULTRA:b.shadows="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.reflect_multiplier=1;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;b.resolution_factor=1.75;e.offscreen_tex_size=2048;e.grass_tex_size=2048;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.max_bones=53;b.precision=
"highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!0;b.compositing=!0;b.motion_blur=!0;c.max_fps=120;break;case a.P_HIGH:b.shadows="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.reflect_multiplier=.5;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;b.resolution_factor=1;e.offscreen_tex_size=1024;e.grass_tex_size=1024;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.max_bones=
53;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;c.max_fps=60;break;case a.P_LOW:b.shadows="NONE",b.shore_smoothing=!1,b.glow=!1,b.ssao=!1,b.dof=!1,b.god_rays=!1,b.bloom=!1,b.reflections=!1,b.reflect_multiplier=.5,b.refractions=!1,b.foam=!1,b.parallax=!1,b.dynamic_grass=!1,b.procedural_fog=!1,b.resolution_factor=1,e.offscreen_tex_size=512,e.grass_tex_size=512,b.texture_min_filter=2,b.anisotropic_filtering=!1,b.use_min50=!0,
b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.shore_distance=!1,b.antialiasing=!1,b.smaa=!1,b.compositing=!1,b.motion_blur=!1,c.max_fps=60}};a.set=function(b,f){switch(b){case "all_objs_selectable":a.defaults.all_objs_selectable=f;break;case "alpha":a.context.alpha=f;break;case "alpha_sort":a.defaults.alpha_sort=f;break;case "alpha_sort_threshold":a.defaults.alpha_sort_threshold=f;break;case "allow_cors":a.defaults.allow_cors=f;break;case "anaglyph_use":a.defaults.anaglyph_use=f;break;
case "animation_framerate":a.animation.framerate=f;break;case "antialiasing":a.defaults.antialiasing=f;break;case "assets_dds_available":a.assets.dds_available=f;break;case "assets_min50_available":a.assets.min50_available=f;break;case "background_color":a.defaults.background_color=f;break;case "built_in_module_name":a.paths.built_in_data_module=f;break;case "console_verbose":a.defaults.console_verbose=f;break;case "context_antialias":a.context.antialias=f;break;case "debug_subs_enabled":a.debug_subs.enabled=
f;break;case "deferred_rendering":a.defaults.deferred_rendering=f;break;case "do_not_load_resources":a.defaults.do_not_load_resources=f;break;case "force_selectable":a.defaults.force_selectable=f;break;case "glow":a.defaults.glow=f;break;case "physics_enabled":a.physics.enabled=f;break;case "physics_uranium_path":a.physics.uranium_path=f;break;case "precision":a.defaults.precision=f;break;case "quality":a.defaults.quality=f;break;case "resolution_factor":a.defaults.resolution_factor=f;break;case "sfx_mix_mode":a.sfx.mix_mode=
f;break;case "shaders_dir":a.paths.shaders_dir=f;break;case "show_hud_debug_info":a.defaults.show_hud_debug_info=f;break;case "smaa":a.defaults.smaa=f;break;case "smaa_search_texture_path":a.paths.smaa_search_texture_path=f;break;case "smaa_area_texture_path":a.paths.smaa_area_texture_path=f;break;case "wireframe_debug":a.defaults.wireframe_debug=f;break;case "water_wireframe_debug":a.defaults.water_wireframe_debug=f;break;default:c.error("B4W config set - property unknown: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.defaults.all_objs_selectable;
case "allow_cors":return a.defaults.allow_cors;case "alpha":return a.context.alpha;case "alpha_sort":return a.defaults.alpha_sort;case "alpha_sort_threshold":return a.defaults.alpha_sort_threshold;case "anaglyph_use":return a.defaults.anaglyph_use;case "animation_framerate":return a.animation.framerate;case "antialiasing":return a.defaults.antialiasing;case "assets_dds_available":return a.assets.dds_available;case "assets_min50_available":return a.assets.min50_available;case "background_color":return a.defaults.background_color;
case "built_in_module_name":return a.paths.built_in_data_module;case "console_verbose":return a.defaults.console_verbose;case "context_antialias":return a.context.antialias;case "debug_subs_enabled":return a.debug_subs.enabled;case "deferred_rendering":return a.defaults.deferred_rendering;case "do_not_load_resources":return a.defaults.do_not_load_resources;case "force_selectable":return a.defaults.force_selectable;case "glow":return a.defaults.glow;case "physics_enabled":return a.physics.enabled;
case "physics_uranium_path":return a.physics.uranium_path;case "precision":return a.defaults.precision;case "quality":return a.defaults.quality;case "resolution_factor":return a.defaults.resolution_factor;case "sfx_mix_mode":return a.sfx.mix_mode;case "shaders_dir":return a.paths.shaders_dir;case "show_hud_debug_info":return a.defaults.show_hud_debug_info;case "smaa":return a.defaults.smaa;case "smaa_search_texture_path":return a.paths.smaa_search_texture_path;case "smaa_area_texture_path":return a.paths.smaa_area_texture_path;
case "wireframe_debug":return a.defaults.wireframe_debug;case "water_wireframe_debug":return a.defaults.water_wireframe_debug;default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=f.clone_object_r(a.context_save);a.defaults=f.clone_object_r(a.defaults_save);a.assets=f.clone_object_r(a.assets_save);a.physics=f.clone_object_r(a.physics_save);a.scenes=f.clone_object_r(a.scenes_save);a.sfx=f.clone_object_r(a.sfx_save);a.debug_subs=f.clone_object_r(a.debug_subs_save)};
a.is_built_in_data=h;a.set_resources_paths=function(){var b=a.paths,f=a.physics;if(h())b.smaa_search_texture_path="smaa_search_texture.png",b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path||""==f.uranium_path){for(var e=null,k=document.getElementsByTagName("script"),d=0;d<k.length;d++){for(var r=k[d].src,x=0;x<b.resources_search_paths.length;x++)if(0<=r.indexOf(b.resources_search_paths[x])){e=r;break}if(null!==e)break}e||(c.error("Couldn't determine path to external resources, fallback to current page URL"),
e=document.location.href);k=e.indexOf("?");0<=k&&(e=e.substring(0,k));e=e.substring(0,e.lastIndexOf("/")+1)+b.resources_dir;f.uranium_path=f.uranium_path||e+"uranium.js";b.smaa_search_texture_path=b.smaa_search_texture_path||e+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||e+"smaa_area_texture.png"}}};b4w.module.__controls=function(a,p){function h(a){return{type:a,value:0,payload:null,lock_sensors:null,lock_sensor_values:null,lock_logic_fun:null,do_activation:!1,key:0,collision_id:"",collision_obj:null,need_collision_pt:!1,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,start_offset:new Float32Array(3),end_offset:new Float32Array(3),local_coords:!1,ray_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,
quat_temp:new Float32Array(4),avg_linear_vel:0,avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,auto_release:!1}}function c(a,b){var c;if(a.lock_logic_fun){c=a.lock_sensors;for(var d=a.lock_sensor_values,e=0;e<c.length;e++)d[e]=c[e].value;c=a.lock_logic_fun(d)}else c=!1;c||(a.value=Number(b))}function f(a){a=v.indexOf(a);-1<a?v.splice(a,1):s.error("Wrong object")}function b(a,b){for(var c=0,d=0;d<b.length;d++)for(var e=b[d]._sensor_manifolds_arr,f=0;f<e.length;f++)for(var g=e[f].sensors,
m=0;m<g.length;m++)g[m]===a&&c++;return c}function l(a,b){switch(a.type){case 80:y.remove_collision_test(a.collision_obj,a.collision_id,a.collision_cb);a.do_activation=!0;break;case 90:y.clear_collision_impulse_test(a.col_imp_obj);a.do_activation=!0;break;case 100:y.remove_ray_test(a.source_object,a.collision_id,a.start_offset,a.end_offset,a.local_coords),a.do_activation=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function e(a){for(var b=0;b<K.length;b++){var d=K[b];20==d.type&&a.keyCode==d.key&&c(d,
1)}G&&a.preventDefault()}function k(a){for(var b=0;b<K.length;b++){var d=K[b];20==d.type&&0==a.keyCode&&16==d.key&&c(d,0);20==d.type&&a.keyCode==d.key&&c(d,0)}G&&a.preventDefault()}function d(a){for(var b=!1,d=null,e=0;e<K.length;e++){var f=K[e];50==f.type&&(c(f,1),f.payload=a.which);160==f.type&&(b||(d=g.pick_object(a.clientX,a.clientY),b=!0),f.value=d==f.source_object?1:0)}fa&&a.preventDefault()}function r(a){for(var b=0;b<K.length;b++){var d=K[b];50==d.type&&c(d,0);160==d.type&&d.auto_release&&
(d.value=0)}fa&&a.preventDefault()}function x(a){var b=a.clientX,d=a.clientY;D=b;U=d;for(var b=b-P,d=d-Z,e=Math.sqrt(b*b+d*d),f=0;f<K.length;f++){var g=K[f];if(40===g.type)switch(g.axis){case "X":c(g,b);break;case "Y":c(g,d);break;case "XY":c(g,e)}}fa&&a.preventDefault()}function n(a){var b=a.wheelDelta||-40*a.detail,b=b*I.mouse_wheel_notch_multiplier;H+=b;for(b=0;b<K.length;b++){var d=K[b];30===d.type&&c(d,H)}da&&a.preventDefault()}function t(a){a=a.targetTouches;if(1==a.length){var b=a[0];a=b.pageX;
for(var b=b.pageY,c=!1,d=null,e=0;e<K.length;e++){var f=K[e];160==f.type&&(c||(d=g.pick_object(a,b),c=!0),f.value=d==f.source_object)}Q[0]=a;Q[1]=-1;T[0]=b;T[1]=-1}else 1<a.length&&(X=z=B(a),Q[0]=a[0].pageX,Q[1]=a[1].pageX,T[0]=a[0].pageY,T[1]=a[1].pageY);V.set(Q);M.set(T)}function w(a){var b=a.targetTouches;if(0!==b.length){if(1===b.length){V[0]=b[0].pageX;V[1]=-1;M[0]=b[0].pageY;M[1]=-1;var b=V[0]-Q[0],d=M[0]-T[0],e=Math.sqrt(b*b+d*d);if(-1!=Q[1]&&-1!=T[1]){var f=V[0]-Q[1],g=M[0]-T[1],m=Math.sqrt(f*
f+g*g);m<e&&(b=f,d=g,e=m)}for(f=0;f<K.length;f++)if(g=K[f],60===g.type)switch(g.axis){case "X":c(g,b);break;case "Y":c(g,d);break;case "XY":c(g,e)}}else if(1<b.length)for(V[0]=b[0].pageX,V[1]=b[1].pageX,M[0]=b[0].pageY,M[1]=b[1].pageY,X=B(b),b=X-z,f=0;f<K.length;f++)g=K[f],70===g.type&&c(g,b);C&&a.preventDefault()}}function B(a){var b=a[0],c=a[1];a=b.pageX;var b=b.pageY,d=c.pageX,c=c.pageY;return Math.sqrt((a-d)*(a-d)+(b-c)*(b-c))}var q=p("__config"),s=p("__print"),y=p("__physics"),g=p("__scenes"),
A=p("__util"),u=p("vec3"),S=p("quat"),I=q.controls,v=[],K=[],m={},H=0,D=0,U=0,P=0,Z=0,V=new Float32Array(2),M=new Float32Array(2),Q=new Float32Array(2),T=new Float32Array(2),X=0,z=0,ia=0,W=!1,L=0,G=!1,fa=!1,da=!1,C=!1;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(b,d){ia=b;for(var e=0;e<K.length;e++){var f=K[e],g=b,h=d;if(h)switch(f.type){case 110:var k=f.source_object,q=k._render.trans,k=k._render.quat,l=u.dist(f.trans_last,q),n=f.quat_temp;S.invert(f.quat_last,
n);S.multiply(k,n,n);S.normalize(n,n);n=Math.abs(2*Math.acos(n[3]));l/=h;f.avg_linear_vel=A.smooth(l,f.avg_linear_vel,h,.3);f.payload[0]=l;l=n/h;f.avg_angular_vel=A.smooth(l,f.avg_angular_vel,h,.3);f.payload[1]=l;f.avg_linear_vel>=f.threshold||f.avg_angular_vel>=f.rotation_threshold?c(f,1):c(f,0);u.copy(q,f.trans_last);S.copy(k,f.quat_last);f.time_last=g;break;case 120:k=f.source_object;q=k._render.trans;k=Math.abs(q[1]-f.trans_last[1])/h;f.avg_vertical_vel=A.smooth(k,f.avg_vertical_vel,h,.3);f.payload=
k;f.avg_vertical_vel>=f.threshold?c(f,1):c(f,0);u.copy(q,f.trans_last);f.time_last=g;break;case 130:g-f.time_last>=f.period&&(c(f,1),f.time_last=g);break;case 140:f.time_last||(f.time_last=g);c(f,g-f.time_last);f.time_last=g;break;case 150:c(f,g)}}for(e=0;e<v.length;e++)for(h=v[e],f=h._sensor_manifolds_arr,g=0;g<f.length;g++)if(q=f[g],q.update_counter!=L){q.update_counter=L;for(var k=q,l=k.sensors,n=k.sensor_values,s=0;s<l.length;s++)n[s]=l[s].value;var k=k.logic_fun(n),l=q,n=l.last_pulse,r=s=void 0;
switch(l.type){case a.CT_CONTINUOUS:k?r=s=1:1==n?r=s=-1:s=0;break;case a.CT_TRIGGER:k&&-1==n?r=s=1:k||1!=n?s=0:r=s=-1;break;case a.CT_SHOT:k&&-1==n?r=s=1:k||1!=n?s=0:(s=0,r=-1);break;case a.CT_LEVEL:s=l.last_logic_result!=k?1:0;break;default:A.panic("Wrong sensor manifold type: "+l.type)}r&&(l.last_pulse=r);if(l=s)if(n=h==m?null:h,W=!1,q.callback(n,q.id,l,q.callback_param),q.last_logic_result=k,W){e=-1;break}}for(e=0;e<v.length;e++)for(h=v[e],f=h._sensor_manifolds_arr,g=0;g<f.length;g++)for(q=f[g],
h=q.sensors,q=0;q<h.length;q++)switch(k=h[q],k.type){case 30:c(k,0);break;case 40:c(k,0);break;case 60:c(k,0);break;case 70:c(k,0);break;case 130:c(k,0)}H=0;P=D;Z=U;Q.set(V);T.set(M);z=X;L++};a.create_custom_sensor=function(a){var b=h(10);c(b,a);return b};a.create_keyboard_sensor=function(a){var b=h(20);b.key=a;return b};a.create_collision_sensor=function(a,b,d){if(!a||!a._physics)return s.error("Wrong collision object"),null;var e=h(80);e.collision_obj=a;e.collision_id=b||"ANY";e.need_collision_pt=
d;e.collision_cb=function(a,b){c(e,a);a&&b&&d&&(e.payload=e.payload||new Float32Array(3),e.payload[0]=b[0],e.payload[1]=b[1],e.payload[2]=b[2])};e.do_activation=!0;return e};a.create_collision_impulse_sensor=function(a){if(!a||!a._physics)return s.error("Wrong collision impulse object"),null;var b=h(90);b.col_imp_obj=a;b.col_imp_cb=function(a){c(b,a)};b.do_activation=!0;return b};a.create_ray_sensor=function(a,b,d,e,f){if(!a)return s.error("Wrong collision object"),null;var g=h(100);g.source_object=
a;g.start_offset=b;g.end_offset=d;g.local_coords=e;g.collision_id=f||"ANY";g.ray_cb=function(a,b){c(g,a);a&&(g.payload=b)};g.do_activation=!0;return g};a.create_mouse_click_sensor=function(){return h(50)};a.create_mouse_wheel_sensor=function(){return h(30)};a.create_mouse_move_sensor=function(a){var b=h(40);b.axis=a||"XY";return b};a.create_touch_move_sensor=function(a){var b=h(60);b.axis=a||"XY";return b};a.create_touch_zoom_sensor=function(){return h(70)};a.create_motion_sensor=function(a,b,c){if(!a)return s.error("Wrong collision object"),
null;var d=h(110);d.source_object=a;var e=a._render.trans;a=a._render.quat;d.quat_temp=new Float32Array(4);d.trans_last=new Float32Array(e);d.quat_last=new Float32Array(a);d.avg_linear_vel=0;d.avg_angular_vel=0;d.threshold=b;d.rotation_threshold=c;d.time_last=0;d.payload=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=function(a,b){if(!a)return s.error("Wrong collision object"),null;var c=h(120);c.source_object=a;var d=a._render.quat;c.trans_last=new Float32Array(a._render.trans);
c.quat_last=new Float32Array(d);c.avg_vertical_vel=0;c.threshold=b;c.time_last=0;c.payload=0;return c};a.create_timer_sensor=function(a){var b=h(130);b.period=a;b.time_last=ia;return b};a.reset_timer_sensor=function(a,b,c,d){a=a||m;d=d||0;a=a._sensor_manifolds;if(!a||!a[b])return s.error("reset_timer_sensor(): wrong object"),null;b=a[b].sensors[c];if(!b)return s.error("reset_timer_sensor(): sensor not found"),null;b.time_last=ia+d};a.create_elapsed_sensor=function(){var a=h(140);a.time_last=0;return a};
a.create_timeline_sensor=function(){return h(150)};a.create_selection_sensor=function(a,b){var c=h(160);c.source_object=a;c.auto_release=b;return c};a.sensor_set_value=c;a.get_sensor_value=function(a,b,c){a=a||m;a=a._sensor_manifolds;if(!a||!a[b])return s.error("get_sensor_value(): wrong object"),null;b=a[b].sensors[c];return b?b.value:(s.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,c){a=a||m;a=a._sensor_manifolds;if(!a||!a[b])return s.error("get_sensor_payload(): wrong object"),
null;b=a[b].sensors[c];return b?b.payload:(s.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){v=[];K=[];m={};ia=0};a.check_sensor_manifold=function(a,b){a=a||m;if(!a._sensor_manifolds)return!1;if(b&&a._sensor_manifolds[b])return!0;if(!b)for(var c in a._sensor_manifolds)return!0;return!1};a.remove_sensor_manifold=function(a,c){a=a||m;var d=a._sensor_manifolds,e=a._sensor_manifolds_arr;if(c){var g=d[c];if(g){for(var h=g.sensors,k=0;k<h.length;k++)1===b(h[k],v)&&l(h[k],K);
delete d[c];g=e.indexOf(g);-1<g?e.splice(g,1):A.panic("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||f(a)}}else{for(c in d){g=d[c];h=g.sensors;for(k=0;k<h.length;k++)1===b(h[k],v)&&l(h[k],K);delete d[c];g=e.indexOf(g);-1<g?e.splice(g,1):A.panic("Incorrect manifolds array")}f(a);W=!0}};a.create_sensor_manifold=function(a,c,d,e,f,g,h){a=a||m;a._sensor_manifolds=a._sensor_manifolds||{};a._sensor_manifolds_arr=a._sensor_manifolds_arr||[];var k=a._sensor_manifolds,q=a._sensor_manifolds_arr,
n=k[c];if(n){e=n.sensors;for(var s=0;s<e.length;s++)1===b(e[s],v)&&l(e[s],K);n=q.indexOf(n);-1<n?q.splice(n,1):A.panic("Incorrect manifolds array")}d={id:c,type:d,sensors:e.slice(0),logic_fun:f,sensor_values:Array(e.length),callback:g,callback_param:h,last_pulse:-1,last_logic_result:0,update_counter:-1};k[c]=d;q.push(d);-1==v.indexOf(a)&&v.push(a);a=d.sensors;for(c=0;c<a.length;c++){k=a[c];if(k.do_activation){switch(k.type){case 80:y.append_collision_test(k.collision_obj,k.collision_id,k.collision_cb,
k.need_collision_pt);break;case 90:y.apply_collision_impulse_test(k.col_imp_obj,k.col_imp_cb);break;case 100:y.append_ray_test(k.source_object,k.collision_id,k.start_offset,k.end_offset,k.local_coords,k.ray_cb)}k.do_activation=!1}-1==K.indexOf(k)&&K.push(k)}W=!0};a.default_AND_logic_fun=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.default_OR_logic_fun=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=
0;a<v.length;a++){var b=v[a],c=b._sensor_manifolds,b=b._sensor_manifolds_arr,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<K.length;a++)l(K[a],K),a--;v.splice(0,v.length)};a.debug=function(){s.log(String(v.length)+" objects with manifolds",v);s.log(String(K.length)+" sensors",K);for(var a=[],b=[],c=0;c<K.length;c++){var d=K[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}s.log(String(a.length)+" collision sensors",a);s.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,
b){a.addEventListener("keydown",e,!1);a.addEventListener("keyup",k,!1);G=b};a.register_mouse_events=function(a,b){a.addEventListener("mousedown",d,!1);a.addEventListener("mouseup",r,!1);a.addEventListener("mousemove",x,!1);fa=b};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",n,!1);a.addEventListener("DOMMouseScroll",n,!1);da=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",t,!1);a.addEventListener("touchmove",w,!1);document.addEventListener("touchstart",
function(){});C=b};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",e,!1);a.removeEventListener("keyup",k,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",d,!1);a.removeEventListener("mouseup",r,!1);a.removeEventListener("mousemove",x,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",n,!1);a.removeEventListener("DOMMouseScroll",n,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",t,!1);a.removeEventListener("touchmove",
w,!1);document.removeEventListener("touchstart",function(){})}};b4w.module.__curve=function(a,p){function h(a,b,c,d,f){var h=d.length;f||(f=new Float32Array(h));for(var n=h+a,t=new Float32Array(n),w=1;w<=n-1;w++)t[w-1]=b>=c[w-1]&&b<c[w+1-1]?1:0;for(var B=2;B<=a;B++)for(w=1;w<=n-B;w++)t[w-1]=(0!=t[w-1]?(b-c[w-1])*t[w-1]/(c[w+B-1-1]-c[w-1]):0)+(0!=t[w+1-1]?(c[w+B-1]-b)*t[w+1-1]/(c[w+B-1]-c[w+1-1]):0);b==c[n-1]&&(t[h-1]=1);a=0;for(w=1;w<=h;w++)a+=t[w-1]*d[w-1];for(w=1;w<=h;w++)f[w-1]=0!=a?t[w-1]*d[w-1]/a:0;return f}function c(a){a=a.knot;return a[a.length-1]}function f(a){a=
a.cumulative_length;return a[a.length-1]}var b=p("__util");a.create_spline=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var d=a.order_u;b.order=d;a=a.points;var f=a.length/5,x=[],n=f+d,f=f+2;x[0]=0;for(var t=2;t<=n;t++)x[t-1]=t>d&&t<f?x[t-2]+1:x[t-2];b.knot=x;if("2D"==c.dimensions)b.is_3d=!1;else if("3D"==c.dimensions)b.is_3d=!0;else throw"Wrong curve dimensions";d=[];x=[];for(c=0;c<a.length;c+=5)d.push(a[c]),d.push(a[c+1]),d.push(a[c+2]),b.is_3d&&
d.push(a[c+3]),x.push(a[c+4]);b.cpoints=d;b.weights=x;a=[];for(var c=b.cpoints,d=b.is_3d?4:3,x=b.weights,n=b.knot,f=b.order,t=c.length/d,w=t+f,B=0,q=n[w-1]/999,s=0;1E3>s;s++){5E-6>n[w-1]-B&&(B=n[w-1]);for(var y=h(f,B,n,x),g=0;g<d;g++)for(var A=a[d*s+g]=0;A<t;A++)a[d*s+g]+=y[A]*c[d*A+g];B+=q}d=b.is_3d?4:3;x=new Float32Array(1E3);x[0]=0;for(c=1;1E3>c;c+=1)n=a[(c-1)*d],f=a[(c-1)*d+1],t=a[(c-1)*d+2],w=a[c*d],B=a[c*d+1],q=a[c*d+2],n=Math.sqrt((w-n)*(w-n)+(B-f)*(B-f)+(q-t)*(q-t)),x[c]=x[c-1]+n;b.cumulative_length=
x;return b};a.spline_point=function(a,b,f){f||(f=[]);var d=b,r=Math.max(d,0),r=c(a);b=r=Math.min(d,r);var d=a.cpoints,r=a.is_3d?4:3,x=a.weights,n=a.knot,t=a.order;a=d.length/r;var w=a+t;5E-6>n[w-1]-b&&(b=n[w-1]);w=new Float32Array(a);h(t,b,n,x,w);for(b=0;b<r;b++)for(x=f[b]=0;x<a;x++)f[b]+=w[x]*d[r*x+b];return f};a.spline_derivative=function(a,b,c){c||(c=[]);var d=a.cpoints,f=a.is_3d?4:3,h=a.weights,n=a.knot,t=a.order;a=d.length/f;var w=a+t;5E-6>n[w-1]-b&&(b=n[w-1]);var w=new Float32Array(a),B=b;b=
w;var q=h.length;b||(b=new Float32Array(q));var s=new Float32Array(q),y=new Float32Array(q),g=s,A=y;g||(g=new Float32Array(q));A||(A=new Float32Array(q));for(var u=q+t,p=new Float32Array(u),I=new Float32Array(u),v=1;v<=u-1;v++)p[v-1]=B>=n[v-1]&&B<n[v+1-1]?1:0;B==n[u-1]&&(p[q-1]=1);for(var K=2;K<=t;K++)for(v=1;v<=u-K;v++){var m=0!=p[v-1]?p[v-1]/(n[v+K-1-1]-n[v-1]):0,H=0!=p[v+1-1]?-p[v+1-1]/(n[v+K-1]-n[v+1-1]):0,D=0!=I[v-1]?(B-n[v-1])*I[v-1]/(n[v+K-1-1]-n[v-1]):0,U=0!=I[v+1-1]?(n[v+K-1]-B)*I[v+1-1]/
(n[v+K-1]-n[v+1-1]):0;p[v-1]=(0!=p[v-1]?(B-n[v-1])*p[v-1]/(n[v+K-1-1]-n[v-1]):0)+(0!=p[v+1-1]?(n[v+K-1]-B)*p[v+1-1]/(n[v+K-1]-n[v+1-1]):0);I[v-1]=m+H+D+U}for(v=1;v<=q;v++)g[v-1]=p[v-1],A[v-1]=I[v-1];n=0;for(t=1;t<=q;t++)n+=s[t-1]*h[t-1];B=0;for(t=1;t<=q;t++)B+=y[t-1]*h[t-1];for(t=1;t<=q;t++)b[t-1]=0!=n?y[t-1]*h[t-1]/n+s[t-1]*h[t-1]*B/(n*n):0;for(h=0;h<f;h++)for(n=c[h]=0;n<a;n++)c[h]+=w[n]*d[f*n+h];return c};a.spline_max_t=c;a.spline_length=f;a.spline_len_to_t=function(a,e){if(0>=e)return 0;var h=
c(a);if(e>=f(a))return h;var d=a.cumulative_length,r=b.binary_search_max(d,e,0,d.length-1);return h*(r+(e-d[r])/(d[r+1]-d[r]))/1E3}};b4w.module.__debug=function(a,p){function h(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&e.panic("Structure assertion failed: incompatible types");for(var c in a)c in b||e.panic("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||e.panic("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&e.panic("Structure assertion failed: incompatible types for key "+
c)}var f=p("__extensions"),b=p("__print"),l=p("__textures"),e=p("__util"),k=null,d={},r=!1,x={},n=[],t=-1,w=null,B=!1;a.WIREFRAME_MODES={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.setup_context=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var e=b[c];e in a&&(d[a[e]]=e)}k=a};a.check_gl=function(a){if(r){var b=k.getError();if(b!=k.NO_ERROR){if(b in
d)throw"B4W Error: "+b+", gl."+d[b]+" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.check_bound_fb=function(){if(!r)return!0;switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:return!0;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),!1;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),
!1;case k.FRAMEBUFFER_UNSUPPORTED:return b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;default:return b.error("B4W Error: FRAMEBUFFER CHECK FAILED"),!1}};a.check_depth_only_issue=function(){if(-1!=t)return t;var a=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,a);a=l.create_texture("DEBUG",l.TT_DEPTH);l.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.w_target,a.w_texture,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(t=
!0,b.warn("B4W warning: depth-only issue was found")):t=!1;k.bindFramebuffer(k.FRAMEBUFFER,null);return t};a.check_shader_compiling=function(a,c,d){if(r&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw d=h(d),b.error("B4W Error: shader compilation failed:\n"+d+"\n"+k.getShaderInfoLog(a)+" ("+c+")"),"Engine failed: see above for error messages";};a.check_shader_linking=function(a,c,d,e,q,l){if(r&&!k.getProgramParameter(a,k.LINK_STATUS)){var n=f.get_debug_shaders();n&&(q=n.getTranslatedShaderSource(d),
l=n.getTranslatedShaderSource(e));q=h(q);l=h(l);b.error("B4W Error: shader linking failed:\n"+q+"\n\n\n"+l+"\n"+k.getProgramInfoLog(a)+" ("+c+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){r=a};a.exec_count=function(a){x[a]=a in x?x[a]+1:1};a.update=function(){for(var a in x)b.log(a,x[a]),x[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(e.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}n.push(a)};
a.msg=function(){for(var a=1,b=0;b<n.length;b++){var c=n[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],e.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);n.push(c)};var q=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var c=0,d={},e=Math.max(0,performance.now()-1E3*a),f=0;f<n.length;f++){var h=n[f];a=h[0];if(!(a<e)){var k=String(h[1]);d[k]||(d[k]=q[c++%
q.length]);var l=d[k];a=["%c"+(a/1E3).toFixed(6),l,k];for(k=2;k<h.length;k++)a.push(h[k]);b.log.apply(this,a)}}n.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var c={},d=Math.max(0,performance.now()-1E3*a),e=0;e<n.length;e++){var f=n[e];a=f[0];if(!(a<d))for(var h=2;h<f.length;h++){var k=String(f[1]);3<f.length&&(k+="_"+String(h-2));c[k]||(c[k]=k+"\n");c[k]+=String(a)+" "+f[h]+"\n"}}a="";for(k in c)a+=c[k]+"\n\n";b.log(a);n.splice(0)};a.check_browser=function(a){var b=navigator.userAgent.toLowerCase(),
c=function(a){return-1<b.indexOf(a)?!0:!1};switch(a.toLowerCase()){case "chrome":return c("mozilla")&&c("applewebkit")&&c("chrome");case "firefox":return c("mozilla")&&c("gecko")&&c("firefox");case "msie":return c("mozilla")&&c("trident")&&c("msie");case "opera":return c("opera")&&c("presto");case "safari":return c("mozilla")&&c("applewebkit")&&c("safari")&&!c("chrome");default:return!1}};a.check_finite=function(a){if(e.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?
!0:!1};a.assert_type=function(a,b){typeof a!=b&&e.panic("Type assertion failed: value type is not a {"+b+"}:",a)};a.assert_structure=c;a.assert_structure_seq=function(a){B?c(a,w):B=!0;w=a}};b4w.module.__extensions=function(a,p){function h(a){if(a in b)return b[a];var e=f.getExtension(a)||null;b[a]=e;c.log("%cGET EXTENSION","color: #"+(e?"0a0":"a00"),a);return e}var c=p("__print"),f=null,b={};a.setup_context=function(a){f=a};a.get_s3tc=function(){return h("WEBGL_compressed_texture_s3tc")||h("WEBKIT_WEBGL_compressed_texture_s3tc")||h("MOZ_WEBGL_compressed_texture_s3tc")};a.get_depth_texture=function(){return h("WEBGL_depth_texture")||h("WEBKIT_WEBGL_depth_texture")||h("MOZ_WEBGL_depth_texture")};
a.get_aniso=function(){return h("EXT_texture_filter_anisotropic")||h("WEBKIT_EXT_texture_filter_anisotropic")||h("MOZ_EXT_texture_filter_anisotropic")};a.get_debug_shaders=function(){return h("WEBGL_debug_shaders")};a.get_renderer_info=function(){return h("WEBGL_debug_renderer_info")};a.get_elem_index_uint=function(){return h("OES_element_index_uint")};a.get_standard_derivatives=function(){return h("OES_standard_derivatives")};a.cleanup=function(){b={}}};b4w.module.__graph=function(a,p){function h(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.nodes.push(b,d)}function c(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function f(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.edges.push(b,d,e);else throw"Wrong node IDs";}function b(a,b){if(!c(a,b))throw"Node not found";for(var d=a.nodes,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function l(a){a=a.nodes;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,
a[c]);return++b}function e(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function k(a){var b=[],c={};d(a,c);for(var e=a.nodes,f=0;f<e.length;f+=2)0==g(a,e[f])&&r(a,e[f],c,b);return{nodes:b,edges:a.edges.slice(0)}}function d(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)b[c[d]]=!1}function r(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<y(a,b);e++){var f=A(a,b,e);r(a,f,c,d)}d.unshift(b,s(a,b))}}function x(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<y(a,b);e++){var f=
A(a,b,e);x(a,f,c,d)}if(20==d||30==d)for(e=0;e<g(a,b);e++)f=u(a,b,e),x(a,f,c,d)}}function n(a){var b=a.nodes;a=a.edges;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{nodes:c,edges:d}}function t(a,b,c){if(c.core_len==c.n1){for(var d=0,e=0;d<c.n1;d++)-1!=c.core_1[d]&&(a[e]=d,b[e]=c.core_1[d],e++);return!0}if(c.n1>c.n2||c.t1both_len>c.t2both_len||c.t1out_len>c.t2out_len||c.t1in_len>c.t2in_len)return!1;for(var e=
d=-1,f=!1;!f&&w(c,m,d,e);)if(d=m[0],e=m[1],B(c,d,e)){var h;h=c;f={};f.g1=h.g1;f.g2=h.g2;f.node_comp=h.node_comp;f.edge_comp=h.edge_comp;f.n1=h.n1;f.n2=h.n2;f.order=h.order;f.core_len=f.orig_core_len=h.core_len;f.t1in_len=h.t1in_len;f.t1out_len=h.t1out_len;f.t1both_len=h.t1both_len;f.t2in_len=h.t2in_len;f.t2out_len=h.t2out_len;f.t2both_len=h.t2both_len;f.added_node1=-1;f.core_1=h.core_1;f.core_2=h.core_2;f.in_1=h.in_1;f.in_2=h.in_2;f.out_1=h.out_1;f.out_2=h.out_2;f.share_count=h.share_count;h.share_count[0]+=
1;var f=h=f,k=d,l=e,n=f.g1,v=f.g2,s=f.n1,r=f.n2,x=f.core_1,I=f.core_2,p=f.in_1,K=f.in_2,C=f.out_1,J=f.out_2;q(k<s);q(l<r);q(f.core_len<s);q(f.core_len<r);s=++f.core_len;f.added_node1=k;p[k]||(p[k]=s,f.t1in_len++,C[k]&&f.t1both_len++);C[k]||(C[k]=s,f.t1out_len++,p[k]&&f.t1both_len++);K[l]||(K[l]=s,f.t2in_len++,J[l]&&f.t2both_len++);J[l]||(J[l]=s,f.t2out_len++,K[l]&&f.t2both_len++);x[k]=l;I[l]=k;for(x=0;x<g(n,k);x++)I=u(n,k,x),p[I]||(p[I]=s,f.t1in_len++,C[I]&&f.t1both_len++);for(x=0;x<y(n,k);x++)I=
A(n,k,x),C[I]||(C[I]=s,f.t1out_len++,p[I]&&f.t1both_len++);for(x=0;x<g(v,l);x++)I=u(v,l,x),K[I]||(K[I]=s,f.t2in_len++,J[I]&&f.t2both_len++);for(x=0;x<y(v,l);x++)I=A(v,l,x),J[I]||(J[I]=s,f.t2out_len++,K[I]&&f.t2both_len++);f=t(a,b,h);q(1>=h.core_len-h.orig_core_len);q(-1!=h.added_node1);I=h.g1;k=h.g2;l=h.core_len;n=h.added_node1;v=h.core_1;p=h.core_2;s=h.in_1;K=h.in_2;r=h.out_1;C=h.out_2;if(h.orig_core_len<l){s[n]==l&&(s[n]=0);for(J=0;J<g(I,n);J++)x=u(I,n,J),s[x]==l&&(s[x]=0);r[n]==l&&(r[n]=0);for(J=
0;J<y(I,n);J++)x=A(I,n,J),r[x]==l&&(r[x]=0);I=v[n];K[I]==l&&(K[I]=0);for(J=0;J<g(k,I);J++)x=u(k,I,J),K[x]==l&&(K[x]=0);C[I]==l&&(C[I]=0);for(J=0;J<y(k,I);J++)x=A(k,I,J),C[x]==l&&(C[x]=0);v[n]=-1;p[I]=-1;h.core_len=h.orig_core_len;h.added_node1=-1}}return f}function w(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.t1both_len,f=a.t2both_len,g=a.t1out_len,h=a.t2out_len,m=a.t1in_len,k=a.t2in_len,q=a.core_len,l=a.n1,n=a.n2,u=a.core_1,v=a.core_2,s=a.in_1,r=a.in_2,C=a.out_1,t=a.out_2;if(e>q&&f>q)for(;c<l&&
(-1!=u[c]||0==C[c]||0==s[c]);)c++,d=0;else if(g>q&&h>q)for(;c<l&&(-1!=u[c]||0==C[c]);)c++,d=0;else if(m>q&&k>q)for(;c<l&&(-1!=u[c]||0==s[c]);)c++,d=0;else if(0==c&&0!=a.order){for(s=0;s<l&&-1!=u[c=a.order[s]];)s++;s==l&&(c=l)}else for(;c<l&&-1!=u[c];)c++,d=0;if(e>q&&f>q)for(;d<n&&(-1!=v[d]||0==t[d]||0==r[d]);)d++;else if(g>q&&h>q)for(;d<n&&(-1!=v[d]||0==t[d]);)d++;else if(m>q&&k>q)for(;d<n&&(-1!=v[d]||0==r[d]);)d++;else for(;d<n&&-1!=v[d];)d++;return c<l&&d<n?(b[0]=c,b[1]=d,!0):!1}function B(a,b,
c){var d=a.g1,e=a.g2,f=a.n2,h=a.core_1,m=a.core_2,k=a.in_1,l=a.in_2,n=a.out_1,v=a.out_2;q(b<a.n1);q(c<f);q(-1==h[b]);q(-1==m[c]);f=(0,a.node_comp)(s(d,b),s(e,c))?!0:!1;if(!f)return!1;for(var r=f=0,t=0,w=0,x=0,B=0,C=0;C<y(d,b);C++){var J=A(d,b,C);if(-1!=h[J]){var p=h[J];if(!S(e,c,p)||!I(a.edge_comp,d,b,J,e,c,p))return!1}else k[J]&&t++,n[J]&&f++,k[J]||n[J]||x++}for(C=0;C<g(d,b);C++)if(J=u(d,b,C),-1!=h[J]){if(p=h[J],!S(e,p,c)||!I(a.edge_comp,d,J,b,e,p,c))return!1}else k[J]&&t++,n[J]&&f++,k[J]||n[J]||
x++;for(C=0;C<y(e,c);C++)if(p=A(e,c,C),-1!=m[p]){if(J=m[p],!S(d,b,J))return!1}else l[p]&&w++,v[p]&&r++,l[p]||v[p]||B++;for(C=0;C<g(e,c);C++)if(p=u(e,c,C),-1!=m[p]){if(J=m[p],!S(d,J,b))return!1}else l[p]&&w++,v[p]&&r++,l[p]||v[p]||B++;return t<=w&&f<=r&&x<=B}function q(a){if(!a)throw"Assertion failed";}function s(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function y(a,b){for(var c=a.edges,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function g(a,b){for(var c=a.edges,
d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function A(a,b,c){a=a.edges;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function u(a,b,c){a=a.edges;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function S(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function I(a,b,c,d,e,f,g){for(var h=v(b,c,d),m=v(e,f,g),k=0;k<h;k++){for(var q=!1,l=0;l<m;l++)if(a(K(b,c,d,k),K(e,f,g,l))){q=!0;break}if(!q)return!1}return!0}
function v(a,b,c){var d=0;a=a.edges;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function K(a,b,c,d){a=a.edges;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}var m=[-1,-1];a.NULL_NODE=-1;a.FORWARD_DIR=10;a.BACKWARD_DIR=20;a.TWO_WAY=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";
}}return{nodes:b,edges:c}};a.create_node_edge_arr=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{nodes:c,edges:d}};a.append_node=h;a.has_node=c;a.append_edge=f;a.remove_node=b;a.remove_edge=function(a,b,c,d){if(!S(a,b,c))throw"Edge not found";a=a.edges;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.append_node_attr=function(a,b){if(-1==
e(a,b))h(a,l(a),b);else throw"Non-unique attribute";};a.replace_edge_attr=function(a,b,c,d,e){a=a.edges;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.gen_node_id=l;a.node_by_attr=e;a.append_edge_attr=function(a,b,c,d){b=e(a,b);c=e(a,c);if(-1!=b&&-1!=c)f(a,b,c,d);else throw"Attributes not found";};a.traverse=function(a,b){for(var c=a.nodes,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.traverse_edges=function(a,b){for(var c=a.edges,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);
};a.traverse_inputs=function(a,b,c){for(var d=a.edges,e=0;e<d.length;e+=3)if(d[e+1]==b){var f=d[e];if(c(f,s(a,f),d[e+2]))break}};a.traverse_outputs=function(a,b,c){for(var d=a.edges,e=0;e<d.length;e+=3)if(d[e]==b){var f=d[e+1];if(c(f,s(a,f),d[e+2]))break}};a.topsort=k;a.topsort_attr=function(a){a=k(a).nodes;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.is_connected=function(a){};a.subgraph_node_conn=function(a,b,e){if(!c(a,b))throw"No such node";var f={};d(a,f);x(a,b,f,e);b=[];for(var g in f)f[g]&&
(g=Number(g),b.push(g,s(a,g)));a={nodes:b,edges:a.edges.slice(0)};f=a.edges;for(g=0;g<f.length;g+=3)b=f[g+1],c(a,f[g])&&c(a,b)||(f.splice(g,3),g-=3);return a};a.get_source_nodes=function(a){for(var b=[],c=a.nodes,d=0;d<c.length;d+=2){var e=c[d];g(a,e)||b.push(e)}return b};a.get_sink_nodes=function(a){for(var b=[],c=a.nodes,d=0;d<c.length;d+=2){var e=c[d];y(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.g1=n(a);e.g2=n(b);e.node_comp=c||function(a,b){return a==b};e.edge_comp=d||function(a,
b){return a==b};d=a.nodes.length/2;var f=b.nodes.length/2;e.n1=d;e.n2=f;e.order=0;e.core_len=e.orig_core_len=0;e.t1both_len=e.t1in_len=e.t1out_len=0;e.t2both_len=e.t2in_len=e.t2out_len=0;e.added_node1=-1;e.core_1=Array(d);e.core_2=Array(f);e.in_1=Array(d);e.in_2=Array(f);e.out_1=Array(d);e.out_2=Array(f);e.share_count=[1];for(c=0;c<d;c++)e.core_1[c]=-1,e.in_1[c]=0,e.out_1[c]=0;for(c=0;c<f;c++)e.core_2[c]=-1,e.in_2[c]=0,e.out_2[c]=0;f=Array(d);d=Array(d);if(t(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.nodes[2*
f[c]],d[c]=b.nodes[2*d[c]];return[f,d]}return null};a.get_node_attr=s;a.out_edge_count=y;a.in_edge_count=g;a.get_out_edge=A;a.get_in_edge=u;a.get_edge_count=v;a.get_edge_attr=K;a.replace=function(a,c,d){for(var e=a.edges,f=l(a),g=0;g<c.length;g++){var m=c[g];b(a,m);for(var k=0;k<e.length;k+=3)e[k]==m&&(e[k]=f),e[k+1]==m&&(e[k+1]=f),e[k]==e[k+1]&&(e.splice(k,3),k-=3)}h(a,f,d)};a.debug_dot=function(a,b){var c=a.nodes,d=a.edges,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=
2){var g=c[f],h=c[f+1],h=b?b(g,h):String(g);e+="    ";e+=String(g)+' [label="'+h.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<d.length;f+=3)c=d[f],g=d[f+1],e+="    ",e+=String(c)+" -> "+String(g)+";\n";return e+="}"}};b4w.module.__scenegraph=function(a,p){function h(a){a=Ha.clone_object_r(a);a.framebuffer=null;a.color_attachment=null;a.depth_attachment=null;return a}function c(a,c){var d=[];O.traverse_edges(a,function(b,c,e){-1<d.indexOf(e)?O.replace_edge_attr(a,b,c,e,l(e)):d.push(e)});O.traverse(a,function(b,c){for(var e=0;e<c.slinks_internal.length;e++){var f=c.slinks_internal[e];-1<d.indexOf(f)?c.slinks_internal[e]=l(f):d.push(f)}"ANTIALIASING"==c.type&&O.traverse_inputs(a,b,function(a,b,c){if("MOTION_BLUR"==
b.type)for(a=0;a<b.slinks_internal.length;a++)c=b.slinks_internal[a],c.min_filter=ba.TF_LINEAR,c.mag_filter=ba.TF_LINEAR})});O.traverse(a,function(d,e){var g={};f(a,d,g);for(var h in g){var m=g[h];if(c)for(var k=0;k<m.length;k++){var q=m[k];if("DEPTH"==q.from){if(b(q))throw"Failed to use renderbuffer as input texture: "+q.from+"->"+q.to;q.use_renderbuffer=!0}}q=m[0];for(k=0;k<m.length;k++)if(m[k].min_filter==ba.TF_LINEAR){q=m[k];break}for(var l=m[0],k=0;k<m.length;k++)if(m[k].mag_filter==ba.TF_LINEAR){l=
m[k];break}for(var n=m[0],k=0;k<m.length;k++)if(!m[k].use_renderbuffer){n=m[k];break}for(k=0;k<m.length;k++)m[k].min_filter=q.min_filter,m[k].mag_filter=l.mag_filter,m[k].use_renderbuffer=n.use_renderbuffer}})}function f(a,b,c){O.traverse_inputs(a,b,function(b,d,e){e.active&&e.from==e.to&&(c[e.from]=c[e.from]||[],-1==c[e.from].indexOf(e)&&c[e.from].push(e),f(a,b,c))});O.traverse_outputs(a,b,function(a,b,d){d.active&&(c[d.from]=c[d.from]||[],-1==c[d.from].indexOf(d)&&c[d.from].push(d))});b=O.get_node_attr(a,
b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.slinks_internal.length;d++){var e=b.slinks_internal[d];c[e.from].push(e)}}function b(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function l(a){if(a.texture)throw"Failed to clone slink with attached texture";return Ha.clone_object_json(a)}function e(a){var b=O.topsort(a),c=[];O.traverse(b,function(a,e){switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var f=
[];break;default:f=c}for(var g=0;g<e.slinks_internal.length;g++){var h=e.slinks_internal[g],m=n(f,h,d(h));h.texture=m;e.textures_internal[g]=m}for(g=0;g<e.textures_internal.length;g++)m=e.textures_internal[g],x(f,m);switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":f=[]}O.traverse_outputs(b,a,function(c,e,g){if((c=r(b,a,g.from))&&g.active&&!g.texture){e=f;for(var h=c,m=0;m<e.length;m++){var k=e[m];k.tex===h&&k.ref++}}else c=n(f,g,d(g));g.texture=
c});O.traverse_inputs(b,a,function(a,b,c){x(f,c.texture)});O.traverse_outputs(b,a,function(a,b,c){c.texture&&"NONE"==c.to&&x(f,c.texture)})})}function k(a){w(a,function(b,c,d,e){b.update_dim&&(pa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||pa(a,d,"ANTIALIASING"))&&(b.size_mult*=ab.resolution_factor)})}function d(a){a=Ha.clone_object_json(a);delete a.to;delete a.active;return JSON.stringify(a)}function r(a,b,c){var d=null;O.traverse_inputs(a,b,function(a,b,e){if(e.active&&
e.from==e.to&&e.from==c&&e.texture)return d=e.texture,!0});O.traverse_outputs(a,b,function(a,b,e){if(e.active&&e.from==c&&e.texture)return d=e.texture,!0});return d}function x(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref&&d.ref--}}function n(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.ref){d=f;break}}if(d)return d.ref++,d.tex;b=t(b);a.push({id:c,ref:1,tex:b});return b}function t(a){var b=a.size_mult*a.size;switch(a.from){case "COLOR":var c=ba.create_texture("COLOR",
ba.TT_RGBA_INT);ba.resize(c,b,b);ba.set_filters(c,a.min_filter,a.mag_filter);return c;case "DEPTH":return a.use_renderbuffer?(c=ba.create_texture("DEPTH_RBUF",ba.TT_RENDERBUFFER),ba.resize(c,b,b)):(c=ba.create_texture("DEPTH_TEX",ba.TT_DEPTH),ba.resize(c,b,b),ba.set_filters(c,a.min_filter,a.mag_filter)),c;case "CUBEMAP":return c=ba.create_cubemap_texture("CUBEMAP",b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.from;}}function w(a,b){var c=!1;O.traverse_edges(a,function(d,e,f){if(f&&
(d=O.get_node_attr(a,d),e=O.get_node_attr(a,e),b(f,!1,d,e)))return c=!0});c||O.traverse(a,function(a,c){for(var d=0;d<c.slinks_internal.length;d++)if(b(c.slinks_internal[d],!0,c,null))return!0})}function B(a){O.traverse(a,function(b,c){if("SINK"!=c.type){var d=c.camera;O.traverse_outputs(a,b,function(a,b,c){c.active&&c.texture&&(ea.set_attachment(d,c.from,c.texture),c.from==c.to&&b.camera&&ea.set_attachment(b.camera,c.from,c.texture))});for(var e=0;e<c.slinks_internal.length;e++){var f=c.slinks_internal[e];
f.active&&f.from==f.to&&ea.set_attachment(d,f.from,c.textures_internal[e])}!d.color_attachment&&!d.depth_attachment||d.framebuffer||(d.framebuffer=Ea.render_target_create(d.color_attachment,d.depth_attachment))}})}function q(a,b){var c=s("SHADOW_CAST");c.csm_index=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;c.camera=ea.create_camera(ea.TYPE_ORTHO_ASYMMETRIC);return c}function s(a){return{type:a,blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,debug_render_calls:0,time:0,camera:null,
cube_view_matrices:null,reflection_plane:null,bundles:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),zsort_eye_last:new Float32Array(3),grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),cube_fog:new Float32Array(16),environment_energy:0,num_lights:0,light_directions:null,light_positions:null,light_color_intensities:null,light_factors1:null,light_factors2:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),sun_intensity:new Float32Array([0,
0,0]),sun_direction:new Float32Array(3),sun_quaternion:new Float32Array(4),sky_texture_slots:null,glow_factor:0,draw_glow_flag:0,is_for_glow:!1,glow_color:new Float32Array(3),water:0,water_params:null,use_shoremap:!1,shoremap_center:new Float32Array(2),shoremap_size:new Float32Array(2),shoremap_tex_size:0,max_shore_dist:0,cam_water_depth:0,water_fog_color_density:null,water_waves_height:0,water_waves_length:0,water_level:0,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,
procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,
radial_blur_step:0,steps_per_pass:0,csm_index:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,v_light_matrix:null,b_light_matrix:null,p_light_matrix:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",jitter_projection_space:new Float32Array(2),do_render:!0,enqueue:!0,clear_color:!0,clear_depth:!0,depth_test:!0,need_perm_uniforms_update:!0}}function y(a,b,c,d,e){return{from:a,to:b,size:c,
size_mult:d,update_dim:e,active:!0,texture:null,use_renderbuffer:!1,min_filter:ba.TF_NEAREST,mag_filter:ba.TF_NEAREST}}function g(){var a=s("GRASS_MAP");a.camera=ea.create_camera(ea.TYPE_ORTHO_ASPECT);return a}function A(a){var b=s("POSTPROCESSING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=ea.create_camera(ea.TYPE_NONE);b.pp_effect=a;return b}function u(a,b,c){a=s("BLOOM_BLUR");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ea.create_camera(ea.TYPE_NONE);a.pp_effect=
c;return a}function S(a,b,c,d,e,f,g,h,m){var k=s("MAIN_"+a);if("OPAQUE"===a)k.clear_color=!0,k.clear_depth=c,k.blend=!1;else if("BLEND"===a)k.clear_color=!1,k.clear_depth=!1,k.blend=!0;else if("XRAY"===a)k.clear_color=!1,k.clear_depth=!0,k.blend=!0;else if("REFLECT"===a)k.clear_color=!0,k.clear_depth=!0,k.blend=!1;else throw"wrong main subscene type";k.blend&&h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.camera=b;k.horizon_color.set(g.horizon_color);k.zenith_color.set(g.zenith_color);
k.environment_energy=g.environment_energy;k.sky_texture_slots=g.sky_texture_slots;k.fog_color_density=f;d&&(k.water_params=d,d.fog_color_density&&(k.water_fog_color_density=new Float32Array(d.fog_color_density)),k.water_waves_height=d.waves_height,k.water_waves_length=d.waves_length,k.water_level=d.water_level,d.caustic_scale&&m&&(k.caustics=!0,k.caust_scale=d.caustic_scale,k.caust_speed.set(d.caustic_speed),k.caust_brightness=d.caustic_brightness),d.shoremap_image&&(k.use_shoremap=!0,a=d.shore_boundings,
k.shoremap_center[0]=(a[0]+a[1])/2,k.shoremap_center[1]=(a[2]+a[3])/2,k.shoremap_size[0]=a[0]-a[1],k.shoremap_size[1]=a[2]-a[3],k.shoremap_tex_size=d.shoremap_tex_size,k.max_shore_dist=d.max_shore_dist));k.light_directions=new Float32Array(3*e);k.light_positions=new Float32Array(3*e);k.light_color_intensities=new Float32Array(3*e);k.light_factors1=new Float32Array(4*e);k.light_factors2=new Float32Array(4*e);return k}function I(a,b){var c=s("COLOR_PICKING");b&&(c.type+="_XRAY",c.clear_color=!1,c.clear_depth=
!0);c.enqueue=!1;c.camera=a;return c}function v(a){var b=s("WIREFRAME");b.do_render=!1;b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function K(a,b,c){a=s("DEPTH");a.camera=b;a.self_shadow_normal_offset=c.self_shadow_normal_offset;return a}function m(a){var b=s("DEPTH_PACK");b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function H(a,b,c){var d=s("SSAO");d.clear_color=!1;d.clear_depth=!1;d.depth_test=!1;d.camera=a;d.fog_color_density=b;d.water_fog_color_density=new Float32Array(b);
d.ssao_radius_increase=c.radius_increase;d.ssao_hemisphere=c.hemisphere;d.ssao_influence=c.influence;d.ssao_dist_factor=c.dist_factor;d.ssao_samples=c.samples;return d}function D(a,b){var c=s("SSAO_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.ssao_blur_depth=b.blur_depth;c.ssao_blur_discard_value=b.blur_discard_value;c.camera=a;return c}function U(){var a=s("ANTIALIASING");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function P(a){var b=
s(a);b.clear_color="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.clear_depth=!1;b.depth_test=!1;b.camera=ea.create_camera(ea.TYPE_NONE);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.jitter_subsample_ind=new Float32Array(4));return b}function Z(a,b,c,d){var e=s("COMPOSITING");e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=ea.create_camera(ea.TYPE_NONE);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function V(a,b){var c=s("MOTION_BLUR");c.clear_color=
!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ea.create_camera(ea.TYPE_NONE);c.assign_texture=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function M(a){var b=s("DOF");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=a;return b}function Q(a){var b=s("GLOW_MASK");b.camera=a;b.depth_test=!1;return b}function T(a){var b=s("GLOW");b.glow_color.set(a.glow_color);b.glow_factor=a.glow_factor;b.ext_texel_size_mult=5;b.blur_texel_size_mult=3;b.depth_test=!1;b.camera=ea.create_camera(ea.TYPE_NONE);
return b}function X(){var a=s("REFRACT");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function z(a,b,c,d,e,f,g){var h=s("GOD_RAYS");h.clear_color=!1;h.clear_depth=!1;h.depth_test=!1;h.horizon_color[0]=1;h.horizon_color[1]=1;h.horizon_color[2]=1;h.zenith_color[0]=1;h.zenith_color[1]=1;h.zenith_color[2]=1;h.environment_energy=1;h.pack=d;h.water=b;h.radial_blur_step=e;h.max_ray_length=c;h.steps_per_pass=g;h.camera=a;h.num_lights=f;h.light_directions=
new Float32Array(3*f);h.light_positions=new Float32Array(3*f);h.light_color_intensities=new Float32Array(3*f);h.light_factors1=new Float32Array(4*f);h.light_factors2=new Float32Array(4*f);return h}function ia(a,b){var c=s("GOD_RAYS_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ea.create_camera(ea.TYPE_NONE);c.god_rays_intensity=a;c.num_lights=b;c.light_directions=new Float32Array(3*b);c.light_positions=new Float32Array(3*b);c.light_color_intensities=new Float32Array(3*b);c.light_factors1=
new Float32Array(4*b);c.light_factors2=new Float32Array(4*b);return c}function W(a,b){var c=s("SKY");c.enqueue=!1;c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;var d=ea.create_camera(ea.TYPE_NONE);d.width=Ka.cubemap_tex_size;d.height=Ka.cubemap_tex_size;c.camera=d;c.cube_view_matrices=Ha.generate_cubemap_matrices();c.num_lights=a;c.light_directions=new Float32Array(3*a);c.light_positions=new Float32Array(3*a);c.light_color_intensities=new Float32Array(3*a);c.light_factors1=new Float32Array(4*
a);c.light_factors2=new Float32Array(4*a);c.horizon_color[0]=1;c.horizon_color[1]=1;c.horizon_color[2]=1;c.zenith_color[0]=1;c.zenith_color[1]=1;c.zenith_color[2]=1;c.environment_energy=1;c.sky_color.set(b.sky_color);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;
c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function L(){var a=s("SCREEN");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function G(){var a=s("ANAGLYPH");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function fa(){var a=s("LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);
return a}function da(){var a=s("AVERAGE_LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ea.create_camera(ea.TYPE_NONE);return a}function C(a,b,c,d){var e=s("LUMINANCE_TRUNCED");e.clear_color=!1;e.clear_depth=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.camera=d;e.light_directions=new Float32Array(3*c);e.light_positions=new Float32Array(3*c);e.light_color_intensities=new Float32Array(3*c);e.light_factors1=new Float32Array(4*c);e.light_factors2=new Float32Array(4*c);return e}function J(a){var b=s("BLOOM");
b.clear_color=!1;b.clear_depth=!1;b.camera=ea.create_camera(ea.TYPE_NONE);b.bloom_blur=a;return b}function ha(){var a=s("SINK");a.enqueue=!1;return a}function pa(a,b,c){if(b.type===c)return!0;b=E(a,b);for(var d=0;d<b.length;d++)if(pa(a,b[d],c))return!0;return!1}function la(a,b,c){if(b.type===c)return!0;b=ja(a,b);for(var d=0;d<b.length;d++)if(la(a,b[d],c))return!0;return!1}function Y(a,b,c){if(b.type===c)return b;b=ja(a,b);for(var d=0;d<b.length;d++){var e=Y(a,b[d],c);if(e)return e}return null}function ja(a,
b){var c=O.node_by_attr(a,b);if(c==O.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=O.in_edge_count(a,c),f=0;f<e;f++){var g=O.get_in_edge(a,c,f);g!=c&&d.push(O.get_node_attr(a,g))}return d}function E(a,b){var c=O.node_by_attr(a,b);if(c==O.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=O.out_edge_count(a,c),f=0;f<e;f++){var g=O.get_out_edge(a,c,f);g!=c&&d.push(O.get_node_attr(a,g))}return d}function ca(a){var b=[],c=[];w(a,function(a,d,e,f){a.texture&&-1==b.indexOf(a.texture)&&(b.push(a.texture),
c.push(a.texture,b.length-1))});return c}function ua(a,b,c,d){b=""+(a.from+"\\n");b+="NONE"!=a.to?a.to+"\\n":"";b+="(";a.update_dim?(c=a.size_mult,Math.round(c)!=c&&(c=c.toFixed(2)),c=(1==c?"":c)+"S",b+=c+"x"+c):b+=a.size+"x"+a.size;if("SCREEN"!=a.from){b+=" ";if(a.use_renderbuffer)b+="RR";else{c=a.min_filter;var e=a.mag_filter,f="";c==ba.TF_LINEAR?f+="L":c==ba.TF_NEAREST&&(f+="N");e==ba.TF_LINEAR?f+="L":e==ba.TF_NEAREST&&(f+="N");b+=f}for(c=0;c<d.length;c+=2)d[c]==a.texture&&(b+=" "+d[c+1])}return b+
")\\n"}var ea=p("__camera"),ma=p("__config"),Aa=p("__debug"),O=p("__graph"),Ea=p("__renderer"),ba=p("__textures"),Ha=p("__util");p("vec4");var Ja=ma.debug_subs,ab=ma.defaults,Ka=ma.scenes;a.create_rendering_graph_compat=function(a,b){var d=O.create(),f=a.cameras[0],g=b.lamps_number,m=b.world_light_set,q=b.fog_color_density,l=b.water_params,n=S("OPAQUE",f,!0,l,g,q,m,null,b.sun_exist);O.append_node_attr(d,n);var E=S("BLEND",f,!0,l,g,q,m,null,null,b.sun_exist);O.append_node_attr(d,E);O.append_edge_attr(d,
n,E,y("SCREEN","NONE",1,1,!0));if(b.xray){var u=S("XRAY",f,!1,l,g,q,m,null,b.sun_exist);O.append_node_attr(d,u);O.append_edge_attr(d,E,u,y("SCREEN","NONE",1,1,!0))}m=ha();O.append_node_attr(d,m);ab.wireframe_debug?(f=v(f),O.append_node_attr(d,f),b.xray?O.append_edge_attr(d,u,f,y("SCREEN","NONE",1,1,!0)):O.append_edge_attr(d,E,f,y("SCREEN","NONE",1,1,!0)),O.append_edge_attr(d,f,m,y("SCREEN","NONE",1,1,!0))):O.append_edge_attr(d,E,m,y("SCREEN","NONE",1,1,!0));b.color_picking&&(f=h(n.camera),a.cameras.push(f),
E=I(f,!1),O.append_node_attr(d,E),b.xray?(f=h(n.camera),a.cameras.push(f),n=I(f,!0),O.append_node_attr(d,n),f=y("COLOR","COLOR",1,1,!0),O.append_edge_attr(d,E,n,f),O.append_edge_attr(d,n,m,y("COLOR","NONE",1,1,!0)),O.append_edge_attr(d,n,m,y("DEPTH","NONE",1,1,!0))):(O.append_edge_attr(d,E,m,y("COLOR","NONE",1,1,!0)),O.append_edge_attr(d,E,m,y("DEPTH","NONE",1,1,!0))));b.sky_params.procedural_skydome&&(g=W(g,b.sky_params),O.append_node_attr(d,g),n=y("CUBEMAP","u_sky",Ka.cubemap_tex_size,1,!1),O.append_edge_attr(d,
g,m,n));c(d,!0);1<ab.resolution_factor&&k(d);e(d);B(d);return d};a.check_slink_tex_conn=b;a.traverse_slinks=w;a.create_rendering_graph=function(a,b,d){var f=O.create(),l=[],n=[],E=[],s=[],r=[],t=[],w=[],x=[],p=[],ca=[],Y=[],ja=b.lamps_number,ua=b.water_params,la=b.render_shadows,pa=b.ssao,ma=b.god_rays,Ea=b.refractions,ub=b.refl_planes,ud=b.bloom,nd=b.motion_blur,fc=b.compositing,qd=b.antialiasing,ad=b.world_light_set,nc=b.fog_color_density,Pb=b.shadow_params,$b=b.mb_params,cd=b.bloom_params,oc=b.cc_params,
Bc=b.god_rays_params,ic=b.glow_params,Sc=b.dof,Ba=[];if(ab.anaglyph_use&&!a){var Ib=d.cameras[0],rb=h(Ib);ea.make_stereo(Ib,ea.TYPE_STEREO_LEFT);ea.make_stereo(rb,ea.TYPE_STEREO_RIGHT);Ba.push(Ib,rb);d.cameras.push(rb)}else{var za=d.cameras[0];Ba.push(za)}if(la){ea.update_camera_shadows(Ba[0],Pb);for(var fb=Pb.csm_num,$=0;$<fb;$++){var Qa=q($,Pb);O.append_node_attr(f,Qa);ca.push(Qa);var mb=Pb.csm_resolution,za=Qa.camera;za.width=mb;za.height=mb;Qa.clear_color=!1;Y.push(y("DEPTH","u_shadow_map"+$,
mb,1,!1));Aa.check_depth_only_issue()&&Qa.slinks_internal.push(y("COLOR","COLOR",mb,1,!1))}}if(0<ub.length&&!a)for($=0;$<Ba.length;$++){za=h(Ba[$]);d.cameras.push(za);var ta=S("REFLECT",za,!1,ua,ja,nc,ad,null,b.sun_exist);ta.reflection_plane=ub[0];ta.camera.reflection_plane=ub[0];O.append_node_attr(f,ta);t.push(ta);var qa=y("COLOR","u_reflectmap",1,ab.reflect_multiplier,!0);w.push(qa);var vb=y("DEPTH","DEPTH",1,ab.reflect_multiplier,!0);ta.slinks_internal.push(vb)}l=[];n=[];if(b.dynamic_grass){var xa=
g();O.append_node_attr(f,xa);mb=Ka.grass_tex_size;xa.camera.width=mb;xa.camera.height=mb;var gb=y("DEPTH","u_grass_map_depth",mb,1,!1);gb.min_filter=ba.TF_LINEAR;gb.mag_filter=ba.TF_LINEAR;var ra=y("COLOR","u_grass_map_color",mb,1,!1);ra.min_filter=ba.TF_LINEAR;ra.mag_filter=ba.TF_LINEAR}else ra=gb=xa=null;for($=0;$<Ba.length;$++){var za=Ba[$],bb=h(za);d.cameras.push(bb);if(la){var Da=K(f,bb,Pb);O.append_node_attr(f,Da);for(var nb=0;nb<ca.length;nb++){var Qa=ca[nb],Jb=Y[nb];O.append_edge_attr(f,Qa,
Da,Jb)}var Cc=y("COLOR","u_color",1,1,!0),Vb=y("DEPTH","u_depth",1,1,!0);if(pa){var ac=h(za);d.cameras.push(ac);var pc=b.ssao_params,wb=H(ac,nc,pc);O.append_node_attr(f,wb);var Mb=y("COLOR","u_ssao_mask",1,1,!0);O.append_edge_attr(f,Da,wb,Cc);O.append_edge_attr(f,Da,wb,Vb);var Wb=h(za);d.cameras.push(Wb);var Sb=D(Wb,pc);O.append_node_attr(f,Sb);var hb=y("COLOR","u_shadow_mask",1,1,!0);O.append_edge_attr(f,wb,Sb,Mb);O.append_edge_attr(f,Da,Sb,Vb)}var Xb=h(bb);d.cameras.push(Xb);var jc=m(Xb);O.append_node_attr(f,
jc);O.append_edge_attr(f,Da,jc,y("DEPTH","u_depth",1,1,!0));E.push(jc);var Xa=y("DEPTH","DEPTH",1,1,!0);r.push(Xa)}else Da=K(f,bb,Pb),O.append_node_attr(f,Da),Xa=y("DEPTH","DEPTH",1,1,!0),r.push(Xa),Aa.check_depth_only_issue()&&Da.slinks_internal.push(y("COLOR","COLOR",1,1,!0)),Xb=h(bb),d.cameras.push(Xb),jc=m(Xb),O.append_node_attr(f,jc),O.append_edge_attr(f,Da,jc,y("DEPTH","u_depth",1,1,!0)),E.push(jc);xa&&(O.append_edge_attr(f,xa,Da,gb),O.append_edge_attr(f,xa,Da,ra));ta=S("OPAQUE",za,!1,ua,ja,
nc,ad,null,b.sun_exist);O.append_node_attr(f,ta);n.push(ta);O.append_edge_attr(f,Da,ta,r[$]);Mb?O.append_edge_attr(f,Sb,ta,hb):O.append_edge_attr(f,Da,ta,y("COLOR","u_shadow_mask",1,1,!0));var bc=y("COLOR","u_color",1,1,!0),Kb=y("COLOR","COLOR",1,1,!0);s.push(Kb);xa&&(O.append_edge_attr(f,xa,ta,gb),O.append_edge_attr(f,xa,ta,ra));t.length&&(O.append_edge_attr(f,t[$],ta,w[$]),ta.reflection_plane=ub[0])}l=n;n=[];if(!a&&b.color_picking){za=h(l[0].camera);d.cameras.push(za);var gc=I(za,!1);O.append_node_attr(f,
gc);if(b.xray){za=h(l[0].camera);d.cameras.push(za);var va=I(za,!0);O.append_node_attr(f,va);var Oa=y("COLOR","COLOR",1,1,!0);O.append_edge_attr(f,gc,va,Oa);var R=y("DEPTH","DEPTH",1,1,!0);O.append_edge_attr(f,gc,va,R)}}else gc=null;if(Ea&&!a)for($=0;$<Ba.length;$++){var N=X();O.append_node_attr(f,N);O.append_edge_attr(f,l[$],N,bc);x.push(N);p.push(y("COLOR","u_refractmap",1,1,!0))}for(var wa=[],$=0;$<Ba.length;$++){Da=E[$];za=h(Ba[$]);d.cameras.push(za);ta=S("BLEND",za,!1,ua,ja,nc,ad,Pb,b.sun_exist);
n.push(ta);O.append_node_attr(f,ta);O.append_edge_attr(f,l[$],ta,s[$]);O.append_edge_attr(f,l[$],ta,r[$]);xa&&(O.append_edge_attr(f,xa,ta,gb),O.append_edge_attr(f,xa,ta,ra));for(nb=0;nb<ca.length;nb++)Qa=ca[nb],Jb=Y[nb],O.append_edge_attr(f,Qa,ta,Jb);if("DEPTH_PACK"==Da.type){var oa=y("COLOR","u_scene_depth",1,1,!0);oa.min_filter=ba.TF_NEAREST;oa.mag_filter=ba.TF_NEAREST}else oa=y("DEPTH","u_scene_depth",1,1,!0),oa.min_filter=ba.TF_LINEAR,oa.mag_filter=ba.TF_LINEAR;O.append_edge_attr(f,Da,ta,oa);
t.length&&(O.append_edge_attr(f,t[$],ta,w[$]),ta.reflection_plane=ub[0]);x.length&&O.append_edge_attr(f,x[$],ta,p[$]);wa.push(ta)}l=n;n=[];if(b.xray){for($=0;$<Ba.length;$++){Da=E[$];za=h(Ba[$]);d.cameras.push(za);ta=S("XRAY",za,!1,ua,ja,nc,ad,Pb,b.sun_exist);n.push(ta);O.append_node_attr(f,ta);O.append_edge_attr(f,l[$],ta,s[$]);O.append_edge_attr(f,l[$],ta,r[$]);xa&&(O.append_edge_attr(f,xa,ta,gb),O.append_edge_attr(f,xa,ta,ra));for(nb=0;nb<ca.length;nb++)Qa=ca[nb],Jb=Y[nb],O.append_edge_attr(f,
Qa,ta,Jb);"DEPTH_PACK"==Da.type?(oa=y("COLOR","u_scene_depth",1,1,!0),oa.min_filter=ba.TF_NEAREST,oa.mag_filter=ba.TF_NEAREST):(oa=y("DEPTH","u_scene_depth",1,1,!0),oa.min_filter=ba.TF_LINEAR,oa.mag_filter=ba.TF_LINEAR);O.append_edge_attr(f,Da,ta,oa);t.length&&(O.append_edge_attr(f,t[$],ta,w[$]),ta.reflection_plane=ub[0]);x.length&&O.append_edge_attr(f,x[$],ta,p[$])}l=n;n=[]}if(ab.wireframe_debug){for($=0;$<Ba.length;$++){za=Ha.clone_object_r(Ba[$]);d.cameras.push(za);var Ua=v(za);n.push(Ua);O.append_node_attr(f,
Ua);O.append_edge_attr(f,l[$],Ua,s[$]);O.append_edge_attr(f,l[$],Ua,r[$]);xa&&(O.append_edge_attr(f,xa,Ua,gb),O.append_edge_attr(f,xa,Ua,ra))}l=n;n=[]}if(ma&&!a){for($=0;$<Ba.length;$++){var ka=Bc.max_ray_length,na=Bc.intensity,Cb=Bc.steps_per_pass,Ca=l[$],cb=ua?1:0,Pa=y("DEPTH","u_input",1,1,!0);Pa.min_filter=ba.TF_LINEAR;Pa.mag_filter=ba.TF_LINEAR;var db=y("COLOR","u_input",1,.25,!0);db.min_filter=ba.TF_LINEAR;db.mag_filter=ba.TF_LINEAR;var $a=ka/Cb,Ga=h(Ba[$]);d.cameras.push(Ga);var Ra=z(Ga,cb,
ka,!0,$a,ja,Cb);O.append_node_attr(f,Ra);O.append_edge_attr(f,Ca,Ra,Pa);var $a=ka/Cb*.5,ib=h(Ba[$]);d.cameras.push(ib);var Xc=z(ib,cb,ka,!1,$a,ja,Cb);O.append_node_attr(f,Xc);O.append_edge_attr(f,Ra,Xc,db);var $a=ka/Cb*.25,Dc=h(Ba[$]);d.cameras.push(Dc);var dd=z(Dc,cb,ka,!1,$a,ja,Cb);O.append_node_attr(f,dd);O.append_edge_attr(f,Xc,dd,db);t.length&&(Ra.reflection_plane=ub[0],Xc.reflection_plane=ub[0],dd.reflection_plane=ub[0]);var vc=ia(na,ja);n.push(vc);O.append_node_attr(f,vc);O.append_edge_attr(f,
Ca,vc,y("COLOR","u_main",1,1,!0));O.append_edge_attr(f,dd,vc,y("COLOR","u_god_rays",1,1,!0))}l=n;n=[]}if(ud&&!a){for($=0;$<Ba.length;$++){var Ca=l[$],Tc=fa();O.append_node_attr(f,Tc);O.append_edge_attr(f,Ca,Tc,y("COLOR","u_input",1,1,!0));var xb=da();O.append_node_attr(f,xb);xb.camera.width=1;xb.camera.height=1;var qc=y("COLOR","u_input",1,.25,!0);qc.min_filter=ba.TF_LINEAR;qc.mag_filter=ba.TF_LINEAR;var Va=y("COLOR","u_luminance",1,.25,!0);Va.min_filter=ba.TF_LINEAR;Va.mag_filter=ba.TF_LINEAR;O.append_edge_attr(f,
Tc,xb,qc);var Ec=cd.key,kc=cd.edge_lum,eb=h(Ba[$]);d.cameras.push(eb);var Ya=C(Ec,kc,ja,eb);O.append_node_attr(f,Ya);O.append_edge_attr(f,Ca,Ya,y("COLOR","u_main",1,1,!0));O.append_edge_attr(f,Tc,Ya,Va);O.append_edge_attr(f,xb,Ya,y("COLOR","u_average_lum",1,1,!1));var rc=y("COLOR","u_color",1,.25,!0);rc.min_filter=ba.TF_LINEAR;rc.mag_filter=ba.TF_LINEAR;var wc=u(f,Tc,"X_BLUR",!0);O.append_node_attr(f,wc);O.append_edge_attr(f,Ya,wc,rc);var yb=u(f,wc,"Y_BLUR",!0);O.append_node_attr(f,yb);O.append_edge_attr(f,
wc,yb,rc);var Yb=J(cd.blur);O.append_node_attr(f,Yb);var Db=y("COLOR","u_bloom",1,.25,!0);Db.min_filter=ba.TF_LINEAR;Db.mag_filter=ba.TF_LINEAR;O.append_edge_attr(f,yb,Yb,Db);O.append_edge_attr(f,Ca,Yb,y("COLOR","u_main",1,1,!0));n.push(Yb)}l=n;n=[]}if(nd&&!a){for($=0;$<l.length;$++){var cc=l[$],Hc=V($b.mb_decay_threshold,$b.mb_factor);n.push(Hc);O.append_node_attr(f,Hc);var Eb=y("COLOR","u_mb_tex_curr",1,1,!0);O.append_edge_attr(f,cc,Hc,Eb);var Yc=y("COLOR","u_mb_tex_accum",1,1,!0);Hc.slinks_internal.push(Yc)}l=
n;n=[]}if(Sc&&!a){for($=0;$<l.length;$++){var Ca=l[$],Zb=h(Ba[$]);d.cameras.push(Zb);rc=y("COLOR","u_color",1,1,!0);rc.min_filter=ba.TF_LINEAR;rc.mag_filter=ba.TF_LINEAR;var jb=A("X_BLUR");O.append_node_attr(f,jb);O.append_edge_attr(f,Ca,jb,rc);var lc=A("Y_BLUR");O.append_node_attr(f,lc);O.append_edge_attr(f,jb,lc,rc);var Da=wa[$],Tb=M(Zb);Zb.dof_distance=d.dof_distance;Zb.dof_object=d.dof_object;Zb.dof_front=d.dof_front;Zb.dof_rear=d.dof_rear;Zb.dof_power=d.dof_power;Zb.dof_on=1;n.push(Tb);O.append_node_attr(f,
Tb);O.append_edge_attr(f,Ca,Tb,y("COLOR","u_sharp",1,1,!0));O.append_edge_attr(f,lc,Tb,y("COLOR","u_blurred",1,1,!0));O.append_edge_attr(f,Da,Tb,y("DEPTH","u_depth",1,1,!0))}l=n;n=[]}if(!a&&b.glow){for($=0;$<Ba.length;$++){var Ca=l[$],id=h(Ba[$]);d.cameras.push(id);var Zc=Q(id);O.append_node_attr(f,Zc);var Ic=A("X_EXTEND"),hd=y("COLOR","u_color",1,1,!0),ob=y("COLOR","u_glow_mask",1,1,!0);Ic.is_for_glow=!0;O.append_node_attr(f,Ic);O.append_edge_attr(f,Zc,Ic,hd);var Qb=y("COLOR","u_color",1,.5,!0);
Qb.min_filter=ba.TF_LINEAR;Qb.mag_filter=ba.TF_LINEAR;var hc=A("Y_EXTEND");hc.is_for_glow=!0;O.append_node_attr(f,hc);O.append_edge_attr(f,Ic,hc,Qb);jb=A("X_BLUR");jb.is_for_glow=!0;O.append_node_attr(f,jb);O.append_edge_attr(f,hc,jb,Qb);var Ub=y("COLOR","u_color",1,.25,!0);Ub.min_filter=ba.TF_LINEAR;Ub.mag_filter=ba.TF_LINEAR;var bd=y("COLOR","u_glow_mask_blurred",1,.25,!0);bd.min_filter=ba.TF_LINEAR;bd.mag_filter=ba.TF_LINEAR;lc=A("Y_BLUR");lc.is_for_glow=!0;O.append_node_attr(f,lc);O.append_edge_attr(f,
jb,lc,Ub);var Nb=T(ic);O.append_node_attr(f,Nb);O.append_edge_attr(f,Ca,Nb,y("COLOR","u_glow_src",1,1,!0));O.append_edge_attr(f,Zc,Nb,ob);O.append_edge_attr(f,lc,Nb,bd);n.push(Nb)}l=n;n=[]}if(fc&&!a){for($=0;$<l.length;$++){var Ca=l[$],Nc=Z(oc.brightness,oc.contrast,oc.exposure,oc.saturation);O.append_node_attr(f,Nc);O.append_edge_attr(f,Ca,Nc,y("COLOR","u_color",1,1,!0));n.push(Nc)}l=n;n=[]}if(qd&&!a){for($=0;$<l.length;$++)if(Ca=l[$],ab.smaa){var $c=y("COLOR","u_color",1,1,!0);$c.min_filter=ba.TF_LINEAR;
$c.mag_filter=ba.TF_LINEAR;var Uc=P("SMAA_EDGE_DETECTION");O.append_node_attr(f,Uc);O.append_edge_attr(f,Ca,Uc,$c);var xc=P("SMAA_BLENDING_WEIGHT_CALCULATION");O.append_node_attr(f,xc);O.append_edge_attr(f,Uc,xc,$c);var mc=y("COLOR","u_search_tex",1,1,!1),Vc=y("COLOR","u_area_tex",1,1,!1);mc.min_filter=ba.TF_LINEAR;mc.mag_filter=ba.TF_LINEAR;Vc.min_filter=ba.TF_LINEAR;Vc.mag_filter=ba.TF_LINEAR;xc.slinks_internal.push(mc);xc.slinks_internal.push(Vc);var Fc=P("SMAA_NEIGHBORHOOD_BLENDING");O.append_node_attr(f,
Fc);O.append_edge_attr(f,Ca,Fc,$c);var Lc=y("COLOR","u_blend",1,1,!0);Lc.min_filter=ba.TF_LINEAR;Lc.mag_filter=ba.TF_LINEAR;O.append_edge_attr(f,xc,Fc,Lc);n.push(Fc)}else{var Oc=U();O.append_node_attr(f,Oc);var Pc=y("COLOR","u_color",1,1,!0);Pc.min_filter=ba.TF_LINEAR;Pc.mag_filter=ba.TF_LINEAR;O.append_edge_attr(f,Ca,Oc,Pc);if(1<ab.resolution_factor){var yc=A("NONE");O.append_node_attr(f,yc);O.append_edge_attr(f,Oc,yc,Pc);n.push(yc)}else n.push(Oc)}l=n;n=[]}if(ab.anaglyph_use&&!a){var zc=G();O.append_node_attr(f,
zc);O.append_edge_attr(f,l[0],zc,y("COLOR","u_sampler_left",1,1,!0));O.append_edge_attr(f,l[1],zc,y("COLOR","u_sampler_right",1,1,!0));n.push(zc)}else n.push(l[0]);var Wc=O.node_by_attr(f,l[0]),od=!1;O.traverse_inputs(f,Wc,function(a,b,c){if(c.from==c.to)return od=!0});if(od||a){var Fb=L(l[0]);O.append_node_attr(f,Fb);O.append_edge_attr(f,l[0],Fb,y("COLOR","u_color",1,1,!0));l=n;n=[];n.push(Fb)}gc&&(va?n.push(va):n.push(gc));if(!a&&b.sky_params.procedural_skydome){var sc=W(ja,b.sky_params);O.append_node_attr(f,
sc);n.push(sc)}var Jc=ha();O.append_node_attr(f,Jc);if(Ja.enabled){var Kc=A("NONE");O.append_node_attr(f,Kc)}for($=0;$<n.length;$++)switch(n[$].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":O.append_edge_attr(f,n[$],Jc,y("COLOR","NONE",1,1,!0));O.append_edge_attr(f,n[$],Jc,y("DEPTH","NONE",1,1,!0));break;case "SKY":var ed=y("CUBEMAP","u_sky",Ka.cubemap_tex_size,1,!1);O.append_edge_attr(f,sc,Jc,ed);break;default:O.append_edge_attr(f,n[$],Ja.enabled?Kc:Jc,y("SCREEN","NONE",1,1,!0))}if(Ja.enabled){var Mc=
null,ya=0;O.traverse(f,function(a,b){if(b.type==Ja.subs_type){if(ya==Ja.subs_number)return Mc=b,!0;ya++}});if(Mc){var Lb=O.node_by_attr(f,Mc);O.traverse_edges(f,function(a,b,c){if(a==Lb)return O.append_edge_attr(f,Mc,Kc,y(Ja.slink_type,"u_color",c.size,c.size_mult,c.update_dim)),O.append_edge_attr(f,Kc,Jc,y("SCREEN","NONE",.5,.5,!0)),!0})}}for(var fd=O.get_sink_nodes(f),$=0;$<fd.length;$++)for(var Qc=fd[$],nb=0;nb<E.length;nb++)Da=E[nb],O.get_node_attr(f,Qc)==Da&&O.remove_node(f,Qc);c(f,!1);1<ab.resolution_factor&&
k(f);e(f);B(f);return f};a.init_subs=s;a.find_on_screen=function(a){var b=null;O.traverse(a,function(a,c){return c.camera&&null===c.camera.framebuffer?(b=c,!0):!1});return b};a.find_input=function(a,b,c){a=ja(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.has_lower_subs=pa;a.has_upper_subs=la;a.find_upper_subs=Y;a.get_inputs=ja;a.get_outputs=E;a.find_subs=function(a,b){var c=null;O.traverse(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.debug_convert_to_dot=function(a){var b=
"digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ca(a);O.traverse(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.pp_effect.replace(/_/g," ")+")");if(d.camera){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.camera.color_attachment&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.camera.depth_attachment&&(f+="D"+c[g+1])}d.slinks_internal.length&&
(f+="\\n-----\\n");for(g=0;g<d.slinks_internal.length;g++)f+=ua(d.slinks_internal[g],a,null,c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});O.traverse_edges(a,function(a,d,e){var f=b+="    ",g=ua(e,a,d,c);b=f+(String(a)+" -> "+String(d)+' [label="'+g+'" style="'+(e.active?"solid":"dotted")+'"];\n')});return b+="}"};a.create_rendering_queue=function(a){a=O.topsort_attr(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];
d.enqueue&&b.push(d)}return b}};b4w.module.__objects=function(a,p){function h(a){a={type:a,data_id:0,grid_id:[0,0],trans:new Float32Array(3),quat:new Float32Array(4),tsr:new Float32Array(8),world_matrix:new Float32Array(16),inv_world_matrix:new Float32Array(16),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),use_panning:!1,move_style:0,trans_speed:0,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,underwater:!1,distance_min:0,distance_max:0,use_distance_limits:!1,horizontal_limits:null,vertical_limits:null,
hover_angle_limits:null,enable_hover_hor_rotation:!0,cameras:null,glow_anim_settings:null,friction:0,elasticity:0,force_strength:0,lod_dist_min:0,lod_transition_ratio:0,physics_type:"",use_collision_compound:!1,shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,reflexible:!1,reflexible_only:!1,reflective:!1,caustics:!1,wind_bending:!1,disable_fogging:!1,dynamic_geometry:!1,dynamic_grass:!1,do_not_cull:!1,hide:!1,last_lod:!1,selectable:!1,origin_selectable:!1,is_hair_particles:!1,is_visible:!1,wind_bending_angle:0,
wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,detail_bending_amp:0,branch_bending_amp:0,main_bend_col:"",detail_bend_col:null,bend_center_only:!1,billboard:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,time:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,anim_destination_mix_factor:1,two_last_skeletal_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],
skinning_data_cache:[],quats_before:null,quats_after:null,trans_before:null,trans_after:null,bone_pointers:null,pose_data:null,mats_anim_values:null,mats_anim_inds:null,bb_local:null,bcyl_local:null,bcap_local:null,bcon_local:null,bb_world:null,bs_local:null,bs_world:null,be_local:null,be_world:null,scale:1,lod_dist_max:1E4};y.identity(a.quat);q.identity(a.tsr);A.identity(a.world_matrix);A.identity(a.inv_world_matrix);return a}function c(a,b,c,d){var e=a._render.params,f;for(f in e){var g=a.name+
"_"+f;f in d||(d[f]=b.length,b.push(e[f][0]));c.push(g,d[f])}}var f=p("__animation"),b=p("__batch"),l=p("__boundings"),e=p("__camera"),k=p("__config"),d=p("__constraints"),r=p("__curve"),x=p("__lights"),n=p("__nla"),t=p("__particles");p("__print");var w=p("__scenes"),B=p("__transform"),q=p("__tsr"),s=p("__util"),y=p("quat"),g=p("vec3"),A=p("mat4"),u=k.defaults,S=0,I=new Float32Array(4);a.create_render=h;a.update_object=function(a,k){var m;if((m=a.parent)&&m._is_dynamic)m=!0;else{if(!(m="ARMATURE"===
a.type||"CAMERA"===a.type)&&(m="MESH"===a.type)){var y=f.is_animatable(a),D=a.b4w_do_not_batch,p=a.b4w_dynamic_geometry,P=a.b4w_collision,Z=a.b4w_vehicle,V=a.b4w_floating;m=a.b4w_character;var M=a.b4w_billboard,Q=t.has_dynamic_grass_particles(a),T=n.has_nla(a);if(!(y=y||D||p||P||Z||V))b:{y=a.data;for(D=0;D<y.materials.length;D++)if("LENS_FLARES"===y.materials[D].name){y=!0;break b}y=!1}m=y||Q||m||M||T}!m&&(m="EMPTY"===a.type)&&(m=f.is_animatable(a),M=n.has_nla(a),m=m||M);m=m?!0:!1}a._is_dynamic=m;
a._render=h("MESH"===a.type?m?"DYNAMIC":"STATIC":a.type);a._constraint=null;a._descends=[];a._dg_parent||(a._dg_parent=null);m=a._render;Q=a.location;M=a.scale[0];s.quat_bpy_b4w(a.rotation_quaternion,I);B.set_translation(a,Q);B.set_rotation(a,I);B.set_scale(a,M);switch(a.type){case "ARMATURE":Q=a.pose.bones;for(M=0;M<Q.length;M++)T=Q[M],y=T.bone,D=new Float32Array(y.matrix_local),p=new Float32Array(16),A.invert(D,p),P=new Float32Array(T.matrix_basis),Z=new Float32Array(3),g.subtract(y.tail_local,
y.head_local,Z),s.vecdir_multiply_matrix(Z,p,Z),T._tail=Z,T._chain=[T].concat(T.parent_recursive),T._tsr_local=q.from_mat4(D,q.create()),T._tsr_basis=q.from_mat4(P,q.create()),T._tsr_channel_cache=q.create(),T._tsr_channel_cache_valid=!1;Q=f.calc_armature_bone_pointers(a);m.bone_pointers=Q;Q=f.calc_pose_data(a,Q);a.b4w_animation_mixing?(m.quats_before=new Float32Array(Q.quats),m.quats_after=new Float32Array(Q.quats),m.trans_before=new Float32Array(Q.trans),m.trans_after=new Float32Array(Q.trans)):
(m.quats_before=Q.quats,m.quats_after=Q.quats,m.trans_before=Q.trans,m.trans_after=Q.trans);m.pose_data=Q;m.frame_factor=0;m.anim_mixing=a.b4w_animation_mixing;break;case "MESH":m.selectable=u.all_objs_selectable||a.b4w_selectable;m.origin_selectable=a.b4w_selectable;m.billboard=a.b4w_billboard;m.billboard_type="BASIC";m.billboard_spherical="SPHERICAL"==a.b4w_billboard_geometry;m.glow_anim_settings={glow_duration:a.b4w_glow_settings.glow_duration,glow_period:a.b4w_glow_settings.glow_period,glow_relapses:a.b4w_glow_settings.glow_relapses};
m.selectable&&(a._color_id=s.gen_color_id(S),S++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a._render.vertex_anim=a.data.b4w_vertex_anim.length?!0:!1;if(M=f.get_first_armature_object(a)){Q=a._render;T=a.data.vertex_groups;if(T.length){y=M.data.bones;D=M.pose.bones;p=0;P={};for(Z=0;Z<y.length;Z++){var V=y[Z].name,X=s.keysearch("name",V,T);if(X){var z=s.get_index_for_key_value(D,"name",V);P[V]={bone_index:Z,deform_bone_index:p++,pose_bone_index:z,vgroup_index:X.index}}}Q.bone_pointers=P;Q.max_bones=
p;Q.is_skinning=!0}Q=a._render.bone_pointers;Q=f.calc_pose_data(M,Q);M.b4w_animation_mixing?(m.quats_before=new Float32Array(Q.quats),m.quats_after=new Float32Array(Q.quats),m.trans_before=new Float32Array(Q.trans),m.trans_after=new Float32Array(Q.trans)):(m.quats_before=Q.quats,m.quats_after=Q.quats,m.trans_before=Q.trans,m.trans_after=Q.trans);m.pose_data=Q;m.frame_factor=0}if(f.has_animated_nodemats(a)){M=a._render;Q=a.data.materials;T=[];y=[];for(D=0;D<Q.length;D++)if((p=Q[D].node_tree)&&p.animation_data)for(Z=
p.animation_data,p={},(P=Z.action)&&c(P,T,y,p),Z=Z.nla_tracks,V=0;V<Z.length;V++)for(X=Z[V].strips,z=0;z<Z[V].strips.length;z++)P=X[z].action,c(P,T,y,p);M.mats_anim_values=T;M.mats_anim_inds=y}a._batches=[];m.shadow_cast=a.b4w_shadow_cast;m.shadow_receive=a.b4w_shadow_receive;m.shadow_cast_only=a.b4w_shadow_cast_only&&m.shadow_cast;m.reflexible=a.b4w_reflexible;m.reflexible_only=a.b4w_reflexible_only&&m.reflexible;m.reflective=a.b4w_reflective;m.caustics=a.b4w_caustics;m.wind_bending=a.b4w_wind_bending;
m.wind_bending_angle=a.b4w_wind_bending_angle;M=b.wb_angle_to_amp(a.b4w_wind_bending_angle,b.bb_bpy_to_b4w(a.data.b4w_bounding_box),a.scale[0]);m.wind_bending_amp=M;m.wind_bending_freq=a.b4w_wind_bending_freq;m.detail_bending_freq=a.b4w_detail_bending_freq;m.detail_bending_amp=a.b4w_detail_bending_amp;m.branch_bending_amp=a.b4w_branch_bending_amp;m.hide=!1;m.main_bend_col=a.b4w_main_bend_stiffness_col;M=a.b4w_detail_bend_colors;m.detail_bend_col={};m.detail_bend_col.leaves_stiffness=M.leaves_stiffness_col;
m.detail_bend_col.leaves_phase=M.leaves_phase_col;m.detail_bend_col.overall_stiffness=M.overall_stiffness_col;m.do_not_cull=a.b4w_do_not_cull;m.disable_fogging=a.b4w_disable_fogging;m.dynamic_geometry=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";M=a.data.materials[0];m.friction=M.physics.friction;m.elasticity=M.physics.elasticity;m.lod_dist_min=0;m.lod_dist_max=1E4;m.lod_transition_ratio=a.b4w_lod_transition;m.last_lod=!0;break;case "CAMERA":e.camera_object_to_camera(a);e.assign_boundings(a);
break;case "LAMP":x.lamp_to_light(a);break;case "CURVE":if(M=r.create_spline(a))a._spline=M;break;case "EMPTY":M=l.zero_bounding_box(),m.bb_local=M,M=l.zero_bounding_sphere(),m.bs_local=M}if(!k&&(a.parent&&"OBJECT"==a.parent_type?(Q=m.trans,T=m.quat,M=m.scale,d.append_stiff_obj(a,a.parent,Q,T,M)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(Q=m.trans,T=m.quat,d.append_stiff_bone(a,a.parent,a.parent_bone,Q,T)):a._dg_parent&&a._dg_parent.b4w_group_relative?(M=q.create_sep(m.trans,m.scale,
m.quat),d.append_child_of(a,a._dg_parent,M)):a._dg_parent&&!a._dg_parent.b4w_group_relative&&(B.update_transform(a),T=m.world_matrix,A.multiply(a._dg_parent._render.world_matrix,T,T),Q=s.matrix_to_trans(T),M=s.matrix_to_scale(T),T=s.matrix_to_quat(T),B.set_translation(a,Q),B.set_rotation(a,T),B.set_scale(a,M)),M=a.dupli_group))for(Q=M.objects,M=0;M<Q.length;M++)Q[M]._dg_parent=a;a.field&&(m.force_strength=a.field.strength,w.update_force(a));m.use_collision_compound=a.game.use_collision_compound;m.physics_type=
a.game.physics_type;B.update_transform(a)};a.update_objects_dynamics=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c._render||"DYNAMIC"!=c._render.type&&"CAMERA"!=c._render.type||B.update_transform(c);c.b4w_use_default_animation&&f.is_animatable(c)&&(f.apply_def(c),f.play(c,null,f.SLOT_ALL))}};a.cleanup=function(){S=0}};b4w.module.__ipc=function(a,p){var h=a.IN_COLLISION=0;a.IN_COLLISION_IMPULSE=1;a.IN_ERROR=2;a.IN_FBMSG=3;a.IN_FLOATER_BOB_TRANSFORM=4;a.IN_LOG=5;var c=a.IN_PROP_OFFSET=6,f=a.IN_RAY_HIT=7,b=a.IN_TRANSFORM=8;a.IN_VEHICLE_SPEED=9;a.IN_PING=10;a.OUT_INIT=11;a.OUT_ACTIVATE=12;a.OUT_ADD_BOAT_BOB=13;a.OUT_ADD_CAR_WHEEL=14;a.OUT_ADD_FLOATER_BOB=15;a.OUT_APPEND_BOUNDING_BODY=16;a.OUT_APPEND_BOAT=17;a.OUT_APPEND_CAR=18;a.OUT_APPEND_CHARACTER=19;a.OUT_APPEND_COLLISION_TEST=20;a.OUT_APPEND_CONSTRAINT=21;a.OUT_APPEND_FLOATER=
22;a.OUT_APPEND_GHOST_MESH_BODY=23;a.OUT_APPEND_STATIC_MESH_BODY=24;a.OUT_APPEND_WATER=25;a.OUT_APPEND_WORLD=26;a.OUT_APPLY_CENTRAL_FORCE=27;a.OUT_APPLY_COLLISION_IMPULSE_TEST=28;a.OUT_APPLY_TORQUE=29;a.OUT_CHARACTER_JUMP=30;a.OUT_CHARACTER_ROTATION_INCREMENT=31;a.OUT_CLEANUP=32;a.OUT_CLEAR_COLLISION_IMPULSE_TEST=33;a.OUT_DISABLE_SIMULATION=34;a.OUT_ENABLE_SIMULATION=35;a.OUT_PAUSE=36;a.OUT_RAY_TEST=37;a.OUT_REMOVE_COLLISION_TEST=38;a.OUT_REMOVE_CONSTRAINT=39;a.OUT_RESUME=40;a.OUT_SET_ACTIVE_WORLD=
41;a.OUT_SET_CHARACTER_FLY_VELOCITY=42;a.OUT_SET_CHARACTER_HOR_ROTATION=43;a.OUT_SET_CHARACTER_MOVE_DIR=44;a.OUT_SET_CHARACTER_MOVE_TYPE=45;a.OUT_SET_CHARACTER_ROTATION=46;a.OUT_SET_CHARACTER_RUN_VELOCITY=47;a.OUT_SET_CHARACTER_VERT_ROTATION=48;a.OUT_SET_CHARACTER_WALK_VELOCITY=49;a.OUT_SET_GRAVITY=50;a.OUT_SET_LINEAR_VELOCITY=51;var l=a.OUT_SET_TRANSFORM=52;a.OUT_SET_WATER_TIME=53;a.OUT_ADD_WATER_WRAPPER=54;a.OUT_UPDATE_BOAT_CONTROLS=55;a.OUT_UPDATE_CAR_CONTROLS=56;a.OUT_PING=57;a.OUT_DEBUG=58;for(var e=
null,k=[],d=[],r=[],x=[],n=0;59>n;n++)k.push(null),d.push(null),r.push(null),x.push(null);d[b]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};d[c]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};d[f]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};d[h]={msg_id:0,body_id_a:0,body_id_b:0,result:0,coll_point:new Float32Array(3)};
d[l]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};x[b]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];x[c]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];x[f]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];x[h]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];x[l]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",function(a){var c=
a.data;a=c[0]|0;if(x[a]){for(var e=d[a],f=x[a],g=0,h=0;h<f.length;h+=2){var k=f[h],l=f[h+1];if(1==l)e[k]="msg_id"==k||"body_id"==k||"body_id_a"==k||"body_id_b"==k?c[g]|0:c[g];else for(var n=0;n<l;n++)e[k][n]=c[g+n];g+=l}c=e}b(a,c)},!1);e=a};a.cleanup=function(){e=null};a.post_msg=function(){var a=arguments[0]|0;if(x[a]){var b=d[a],c=x[a],f=0;if(!r[a]){for(var h=0,l=1;l<c.length;l+=2)h+=c[l];r[a]=new Float32Array(h)}h=r[a];for(l=0;l<c.length;l+=2){var g=b[c[l]],n=c[l+1];1==n?h[f]=g:h.set(g,f);f+=n}k[a]||
(k[a]=h);a=k[a]}else for(b=arguments.length,k[a]||(k[a]=Array(b),k[a][0]=a),a=k[a],c=1;c<b;c++)a[c]=arguments[c];e.postMessage(a)};a.get_msg_cache=function(a){return d[a]}};b4w.module.__hud=function(a,p){function h(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){f(' SCENE "'+a.name+'"');if(a._render){var b=0,c=0;d.traverse(a._render.graph,function(a,d){if("SINK"==d.type)f(" (F)",d.type);else{var e=d.type,h=Math.round(d.camera.width)+"x"+Math.round(d.camera.height),g=d.bundles.length,k=d.debug_render_calls,l=d.enqueue&&d.do_render;l?f(" (A)",e,d.num_lights,h,k,"of",g):f(" (P)",e,d.num_lights,h,k,"of",g);d.debug_render_calls=
0;l&&(b+=g,c+=k)}});return[b,c]}f("No INFO")}function f(){for(var a=80+20*x[0],b=[5,18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e=b[d]-String(arguments[d]).length,f="",h=0;h<e;h++)f+=" ";c+=f+arguments[d]}x[0]++;r.fillText(c,30,a)}function b(a,b,c,d,e){e.x=a;e.y=b;e.w=c;e.h=d;return e}function l(a,b,c){b*=a.w;c.x=a.x+b;c.y=a.y;c.w=a.w-2*b;c.h=a.h;return c}function e(a){return a.x+a.w/2}function k(a){var c=r,d={x:0,y:0,w:0,h:0};b(0,0,c.canvas.width,c.canvas.height,d);l(d,.01,
d);c=.02*d.h;d.x=d.x;d.y+=c;d.w=d.w;d.h-=2*c;c=d.w/8;d.x+=c*a;d.y=d.y;d.w=c;d.h=d.h;l(d,.02,d);return d}var d=p("__graph"),r=null,x=[0,0];a.init=function(a){a=a.getContext("2d");h(a);return r=a};a.update_dim=function(){r&&h(r)};a.reset=function(){var a=r;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),x[0]=0,x[1]=0)};a.show_debug_info=function(a,b){var d=r;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";f(" FPS",
(1/b).toFixed(2));x[0]++;for(var e=d=0,h=0;h<a.length;h++){var k=c(a[h]),d=d+k[0],e=e+k[1];x[0]++}f(" ---------------------------------------------");f("    ","TOTAL ACTIVE","","",e,"of",d)}};a.print=function(){var a=r;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",f.apply(Math,arguments))};a.plot_array=function(a,b,c,d,f,h,l){var g=r;if(g){b=k(b);var x=b.h/5;b.x=b.x;b.y+=4*x;b.w=b.w;b.h=x;g.textAlign="center";g.fillStyle="#00FF00";r.fillText(a,e(b),b.y-10);g.strokeStyle="#00FF00";g.lineWidth=
.5;g.beginPath();g.moveTo(b.x,b.y);g.lineTo(b.x+b.w,b.y);g.lineTo(b.x+b.w,b.y+b.h);g.lineTo(b.x,b.y+b.h);g.closePath();g.stroke();if(!h&&!l)for(h=1E6,l=-1E6,a=0;a<c.length;a++)h=Math.min(h,c[a]),l=Math.max(l,c[a]);g.textAlign="right";r.fillText(String(h),b.x-10,b.y+b.h);r.fillText(String(l),b.x-10,b.y);g.textAlign="center";r.fillText(String(d),b.x,b.y+b.h+15);r.fillText(String(f),b.x+b.w,b.y+b.h+15);g.strokeStyle="#FF0000";g.lineWidth=1.5;g.beginPath();d=b.w/(c.length-1);l=b.h/(l-h);for(a=0;a<c.length;a++)f=
b.x+d*a,x=b.y+b.h-(c[a]-h)*l,0==a?g.moveTo(f,x):g.lineTo(f,x);g.stroke()}};a.draw_mixer_strip=function(a,c,d,f,h,l,x){var g=r;if(g)for(g.textAlign="center",g.fillStyle="#00FF00",g.font="bold 12px Courier",d=k(d),r.fillText(c?"["+a+"]":a,e(d),d.y),0<=l&&r.fillText(l?"[M]":"[ ]",e(d)-15,d.y+30),0<=x&&r.fillText(x?"[S]":"[ ]",e(d)+15,d.y+30),a={x:0,y:0,w:0,h:0},c=0;c<f.length;c++){var A=f[c];(x="VOLUME"==A[0])?b(d.x,d.y+350,d.w,250,a):b(d.x,d.y+10+50*c,d.w,d.h,a);l=g;var u=a,p=c==h,I=A[0],v=A[1],K=A[2],
m=A[3],H=A[5],A=(m-K)/A[4],A=1>A?Math.floor(1/A-1E-5).toFixed(0).length:0,H=H?Math.log(v/K)/Math.log(m/K):(v-K)/(m-K);l.textAlign="center";p?l.fillText("["+I+"]",e(u),u.y):l.fillText(I,e(u),u.y);l.strokeStyle="#00FF00";l.lineWidth=x?3:1;x?(l.textAlign="right",l.fillText(m.toFixed(A),e(u)-10,u.y+15),l.textAlign="right",l.fillText(K.toFixed(A),e(u)-10,u.y+u.h-15)):(l.textAlign="right",l.fillText(K.toFixed(A),u.x+28,u.y+15),l.textAlign="left",l.fillText(m.toFixed(A),u.x+u.w-28,u.y+15));l.beginPath();
if(x){var D=u.y+15+(u.h-30)*(1-H);l.moveTo(e(u),u.y+15);l.lineTo(e(u),u.y+u.h-15);l.moveTo(e(u)-5,u.y+15);l.lineTo(e(u)+5,u.y+15);l.moveTo(e(u)-5,u.y+u.h-15);l.lineTo(e(u)+5,u.y+u.h-15);l.moveTo(e(u)-5,D);l.lineTo(e(u)+5,D)}else{var U=u.x+30+(u.w-60)*H;l.moveTo(u.x+30,u.y+15);l.lineTo(u.x+u.w-30,u.y+15);l.moveTo(u.x+30,u.y+15-5);l.lineTo(u.x+30,u.y+15+5);l.moveTo(u.x+u.w-30,u.y+15-5);l.lineTo(u.x+u.w-30,u.y+15+5);l.moveTo(U,u.y+15-5);l.lineTo(U,u.y+15+5)}l.stroke();"EQ_Q"==I?(p=v,p=1+1/(2*p*p)+Math.sqrt((2+
1/(p*p))*(2+1/(p*p))/4-1),p=Math.log(p)/Math.log(2),x?(l.textAlign="left",l.fillText(v.toFixed(A),e(u)+10,D),l.textAlign="left",l.fillText("("+p.toFixed(A+1)+")",e(u)+10,D+10)):(l.textAlign="right",l.fillText(v.toFixed(A),U,u.y+30),l.textAlign="left",l.fillText("("+p.toFixed(A+1)+")",U,u.y+30))):x?(l.textAlign="left",l.fillText(v.toFixed(A),e(u)+10,D)):(l.textAlign="center",l.fillText(v.toFixed(A),U,u.y+30))}}};b4w.module.__prerender=function(a,p){var h=p("__config"),c=p("__debug"),f=p("__geometry"),b=p("__util"),l=p("vec3"),e=h.defaults,k="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.prerender_subs=function(a){if(-1<k.indexOf(a.type)){for(var h=!1,x=a.bundles,n=0;n<x.length;n++){var t=x[n],w=t,B=a,q=w.obj_render,s=B.camera;w.do_render=!0;q.is_visible=!1;if(q)if(q.hide)w.do_render=!1;else{var y=void 0;var g=s.eye,A=q.bs_world.center,
y=q.lod_dist_min,u=q.lod_dist_max,g=Math.sqrt((A[0]-g[0])*(A[0]-g[0])+(A[1]-g[1])*(A[1]-g[1])+(A[2]-g[2])*(A[2]-g[2])),A=q.lod_transition_ratio*q.bs_world.radius,y=g>=y&&g<u+A?!0:!1;y?(q.is_visible=!0,"GLOW_MASK"!=B.type||Boolean(w.batch.glow_intensity)?(y=void 0,s=s.frustum_planes,q.do_not_cull?y=!1:("STATIC"===q.type?(y=q.bs_world,q=y.center,q=b.sphere_is_out_of_frustum(q,s,y.radius)):(y=q.be_world,q=y.center,q=b.ellipsoid_is_out_of_frustum(q,s,y.axis_x,y.axis_y,y.axis_z)),y=q),y?w.do_render=!1:
"WIREFRAME"==B.type&&(w.do_render=w.batch.wireframe_mode==c.WIREFRAME_MODES.WM_DEBUG_SPHERES?w.batch.debug_sphere:!w.batch.debug_sphere)):w.do_render=!1):w.do_render=!1}else w.do_render=!1;t.do_render&&(h=!0)}switch(a.type){case "WIREFRAME":break;default:a.do_render="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||h?!0:!1}}if("MAIN_BLEND"==a.type&&(h=a.camera.eye,l.dist(h,a.zsort_eye_last)>e.alpha_sort_threshold&&e.alpha_sort&&a.bundles)){for(x=0;x<a.bundles.length;x++)t=a.bundles[x],w=t.batch,n=t.obj_render.world_matrix,
w&&w.blend&&w.zsort_type!=f.ZSORT_DISABLED&&(w=w.bufs_data)&&t.do_render&&(t=w.info_for_z_sort_updates)&&t.type==f.ZSORT_BACK_TO_FRONT&&f.update_buffers_movable(w,n,h);a.zsort_eye_last.set(h)}}};b4w.module.__print=function(a,p){var h=!1,c=0,f=0;a.set_verbose=function(a){h=a};a.log=function(){h&&console.log.apply(console,arguments)};a.error=function(){c++;console.error.apply(console,arguments)};a.warn=function(){f++;console.warn.apply(console,arguments)};a.time=function(){h&&console.time.apply(console,arguments)};a.timeEnd=function(){h&&console.timeEnd.apply(console,arguments)};a.group=function(){h&&console.group.apply(console,arguments)};a.groupCollapsed=function(){h&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){h&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.get_warning_count=function(){return f};a.get_error_count=function(){return c};a.clear_errors_warnings=function(){c=f=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function h(a,b,c){c=c+">>"+a;c in t||(t[c]={storage:[],report_type:"undefined",type:a});t[c].storage.push(b.name)}function c(a,b,c){param_id in t||(t[param_id]={storage:[],report_type:"deprecated",type:a});t[param_id].storage.push(b.name)}function f(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=k.clone_object_json(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<
d.length;c++){var f=k.clone_object_nr(d[c]);e.submeshes.push(f)}return e}var b=p("__boundings"),l=p("__curve"),e=p("__print"),k=p("__util"),d=p("vec3"),r=p("vec4"),x=p("quat"),n=p("mat4"),t={};a.check_bpy_data=function(a){t={};var b=a.worlds;if(0==b.length){e.warn("WARNING Datablock world is missing, reexport scene");var d={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};
b.push(d)}for(var b=a.worlds,f=0;f<b.length;f++){var d=b[f],l=d.b4w_shadow_settings;"csm_resolution"in l||(h("world",d,"b4w_shadow_settings.csm_resolution"),l.csm_resolution=2048);"self_shadow_polygon_offset"in l||(h("world",d,"b4w_shadow_settings.self_shadow_polygon_offset"),l.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in l||(h("world",d,"b4w_shadow_settings.self_shadow_normal_offset"),l.self_shadow_normal_offset=.01);"b4w_enable_csm"in l||(h("world",d,"b4w_shadow_settings.b4w_enable_csm"),
l.b4w_enable_csm=!1);"csm_num"in l||(h("world",d,"b4w_shadow_settings.csm_num"),l.csm_num=1);"csm_first_cascade_border"in l||(h("world",d,"b4w_shadow_settings.csm_first_cascade_border"),l.csm_first_cascade_border=10);"first_cascade_blur_radius"in l||(h("world",d,"b4w_shadow_settings.first_cascade_blur_radius"),l.first_cascade_blur_radius=3);"csm_last_cascade_border"in l||(h("world",d,"b4w_shadow_settings.csm_last_cascade_border"),l.csm_last_cascade_border=100);"last_cascade_blur_radius"in l||(h("world",
d,"b4w_shadow_settings.last_cascade_blur_radius"),l.last_cascade_blur_radius=1.5);"fade_last_cascade"in l||(h("world",d,"b4w_shadow_settings.fade_last_cascade"),l.fade_last_cascade=!0);"blend_between_cascades"in l||(h("world",d,"b4w_shadow_settings.blend_between_cascades"),l.blend_between_cascades=!0);l=d.b4w_ssao_settings;"dist_factor"in l||(h("world",d,"b4w_ssao_settings.dist_factor"),l.dist_factor=0,l.samples=16);"hemisphere"in l||(h("world",d,"b4w_ssao_settings.hemisphere"),l.hemisphere=!1);"blur_depth"in
l||(h("world",d,"b4w_ssao_settings.blur_depth"),l.blur_depth=!1);"blur_discard_value"in l||(h("world",d,"b4w_ssao_settings.blur_discard_value"),l.blur_discard_value=1);"b4w_glow_color"in d||(d.b4w_glow_color=[1,1,1],h("object",d,"b4w_glow_color"));"b4w_glow_factor"in d||(d.b4w_glow_factor=1,h("object",d,"b4w_glow_factor"));"b4w_fog_density"in d||(h("world",d,"b4w_fog_density"),d.b4w_fog_density=0);"b4w_sky_settings"in d&&"rayleigh_brightness"in d.b4w_sky_settings||(h("world",d,"rayleigh_brightness"),
d.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in d?("blur"in d.b4w_bloom_settings||(h("world",d,"b4w_bloom_settings.blur"),d.b4w_bloom_settings.blur=4),"edge_lum"in d.b4w_bloom_settings||(h("world",d,"b4w_bloom_settings.edge_lum"),d.b4w_bloom_settings.edge_lum=
1)):(h("world",d,"b4w_bloom_settings"),d.b4w_bloom_settings={key:.2,blur:4});"b4w_motion_blur_settings"in d?("motion_blur_factor"in d.b4w_motion_blur_settings||(h("world",d,"b4w_motion_blur_settings.motion_blur_factor"),d.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in d.b4w_motion_blur_settings||(h("world",d,"b4w_motion_blur_settings.motion_blur_decay_threshold"),d.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(h("world",d,"b4w_motion_blur_settings"),
d.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});"b4w_color_correction_settings"in d||(h("world",d,"b4w_color_correction_settings"),d.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in d.b4w_god_rays_settings||(h("world",d,"b4w_god_rays_settings.steps_per_pass"),d.b4w_god_rays_settings.steps_per_pass=10)}b=a.scenes;for(f=0;f<b.length;f++)d=b[f],"b4w_use_nla"in d||(d.b4w_use_nla=!1,h("scene",d,"b4w_use_nla")),"fps"in
d||(d.fps=24,h("scene",d,"fps")),"b4w_nla_cyclic"in d||(d.b4w_nla_cyclic=!1,h("scene",d,"b4w_nla_cyclic")),"b4w_nla_script"in d||(d.b4w_nla_script=[],h("scene",d,"b4w_nla_script")),"b4w_detect_collisions"in d&&(c("scene",d,"b4w_detect_collisions"),delete d.b4w_detect_collisions),"audio_doppler_speed"in d||(d.audio_doppler_speed=343.3),"audio_doppler_factor"in d||(d.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in d||(d.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,
release:.25},h("scene",d,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in d||(d.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in d||(d.b4w_enable_bloom=!1,h("scene",d,"b4w_enable_bloom")),"b4w_enable_motion_blur"in d||(d.b4w_enable_motion_blur=!1,h("scene",d,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in d||(d.b4w_enable_color_correction=!1,h("scene",d,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in d||(d.b4w_enable_antialiasing=!0,h("scene",d,"b4w_enable_antialiasing"));
b=a.meshes;for(f=0;f<b.length;f++)for(d=b[f],d.b4w_bounding_box||(h("mesh",d,"b4w_bounding_box"),d.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),d.uv_textures||(h("mesh",d,"uv_textures"),d.uv_textures=[]),d.b4w_bounding_sphere_center||(d.b4w_bounding_sphere_center=[0,0,0]),d.b4w_bounding_cylinder_center||(d.b4w_bounding_cylinder_center=[0,0,0]),d.b4w_bounding_ellipsoid_center||(d.b4w_bounding_ellipsoid_center=[0,0,0]),d.b4w_bounding_ellipsoid_axes||(l=d.b4w_bounding_box,d.b4w_bounding_ellipsoid_axes=
[(l.max_x-l.min_x)/2,(l.max_y-l.min_y)/2,(l.max_z-l.min_z)/2]),l=0;l<d.b4w_vertex_anim.length;l++){var g=d.b4w_vertex_anim[l];"allow_nla"in g||(h('mesh["b4w_vertex_anim"]',d,"allow_nla"),g.allow_nla=!0)}b=a.cameras;for(f=0;f<b.length;f++)d=b[f],d.type||(d.type="PERSP",h("camera",d,"type")),"b4w_eye_target_dist"in d&&(delete d.b4w_eye_target_dist,c("camera",d,"b4w_eye_target_dist")),"b4w_use_distance_limits"in d||(d.b4w_use_distance_limits=!1,h("camera",d,"b4w_use_distance_limits")),"b4w_distance_min"in
d||(d.b4w_distance_min=1,h("camera",d,"b4w_distance_min")),"b4w_distance_max"in d||(d.b4w_distance_max=100,h("camera",d,"b4w_distance_max")),"b4w_horizontal_translation_min"in d||(d.b4w_horizontal_translation_min=-100,h("camera",d,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in d||(d.b4w_horizontal_translation_max=100,h("camera",d,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in d||(d.b4w_vertical_translation_min=-100,h("camera",d,"b4w_vertical_translation_min")),
"b4w_vertical_translation_max"in d||(d.b4w_vertical_translation_max=100,h("camera",d,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in d||(d.b4w_use_horizontal_clamping=!1,h("camera",d,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in d||(d.b4w_rotation_left_limit=-Math.PI,h("camera",d,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in d||(d.b4w_rotation_right_limit=Math.PI,h("camera",d,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in d||(d.b4w_horizontal_clamping_type=
"LOCAL",h("camera",d,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in d||(d.b4w_use_vertical_clamping=!1,h("camera",d,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in d||(d.b4w_rotation_down_limit=-Math.PI/2,h("camera",d,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in d||(d.b4w_rotation_up_limit=Math.PI/2,h("camera",d,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in d||(d.b4w_vertical_clamping_type="LOCAL",h("camera",d,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in
d||(d.b4w_hover_angle_min=Math.PI/6,h("camera",d,"b4w_hover_angle_min")),"b4w_hover_angle_max"in d||(d.b4w_hover_angle_max=Math.PI/6,h("camera",d,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in d||(d.b4w_enable_hover_hor_rotation=!0,h("camera",d,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in d||(d.b4w_use_panning=!0,h("camera",d,"b4w_use_panning"));b=a.lamps;for(f=0;f<b.length;f++)d=b[f],"b4w_generate_shadows"in d||(d.b4w_generate_shadows=!1,h("lamp",d,"b4w_generate_shadows")),"b4w_dynamic_intensity"in
d||(d.b4w_dynamic_intensity=!1,h("lamp",d,"b4w_dynamic_intensity")),"use_diffuse"in d||(d.use_diffuse=!0,h("lamp",d,"use_diffuse")),"use_specular"in d||(d.use_specular=!0,h("lamp",d,"use_specular"));b=a.speakers;for(f=0;f<b.length;f++)d=b[f],"b4w_behavior"in d||(d.b4w_behavior=d.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in d||(d.b4w_disable_doppler=!1),"b4w_delay"in d||(d.b4w_delay=0),"b4w_delay_random"in d||(d.b4w_delay_random=0),"b4w_volume_random"in d||(d.b4w_volume_random=
0),"b4w_pitch_random"in d||(d.b4w_pitch_random=0),"b4w_fade_in"in d||(d.b4w_fade_in=0),"b4w_fade_out"in d||(d.b4w_fade_out=0),"b4w_loop"in d||(d.b4w_loop=!1),"b4w_loop_count"in d||(d.b4w_loop_count=0),"b4w_loop_count_random"in d||(d.b4w_loop_count_random=0),"b4w_playlist_id"in d||(d.b4w_playlist_id="");b=a.textures;for(f=0;f<b.length;f++)d=b[f],"b4w_anisotropic_filtering"in d||(d.b4w_anisotropic_filtering="OFF",h("texture",d,"b4w_anisotropic_filtering")),"b4w_water_foam"in d||(d.b4w_water_foam=!1,
h("texture",d,"b4w_water_foam")),"b4w_foam_uv_freq"in d||(d.b4w_foam_uv_freq=[1,1],h("texture",d,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in d||(d.b4w_foam_uv_magnitude=[1,1],h("texture",d,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in d||(d.b4w_parallax_steps=5,h("material",d,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in d||(d.b4w_parallax_lod_dist=10,h("material",d,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in d||(d.b4w_shore_dist_map=!1,h("texture",d,"b4w_shore_dist_map")),"b4w_shore_boundings"in
d||(d.b4w_shore_boundings=new Float32Array(4),d.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],h("texture",d,"b4w_shore_boundings")),"b4w_max_shore_dist"in d||(d.b4w_max_shore_dist=100,h("texture",d,"b4w_max_shore_dist")),"b4w_disable_compression"in d||(d.b4w_disable_compression=!1,h("texture",d,"b4w_disable_compression")),"b4w_source_type"in d||(d.b4w_source_type="",h("texture",d,"b4w_source_type")),"b4w_source_id"in d||(d.b4w_source_id="",h("texture",d,"b4w_source_id")),"b4w_source_size"in d||(d.b4w_source_size=
1024,h("texture",d,"b4w_source_size"));b=a.materials;for(f=0;f<b.length;f++)for(d=b[f],("b4w_node_mat_type"in d)&&c("material",d,"b4w_node_mat_type"),("b4w_skydome"in d)&&c("material",d,"b4w_skydome"),("b4w_procedural_skydome"in d)&&c("material",d,"b4w_procedural_skydome"),d.b4w_water&&("b4w_water_shore_smoothing"in d||(d.b4w_water_shore_smoothing=!1,h("material",d,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in d||(d.b4w_water_dynamic=!1,h("material",d,"b4w_water_dynamic")),"b4w_waves_height"in
d||(d.b4w_waves_height=1,h("material",d,"b4w_waves_height")),"b4w_waves_length"in d||(d.b4w_waves_length=1,h("material",d,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in d||(d.b4w_water_dst_noise_scale0=.05,h("material",d,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in d||(d.b4w_water_dst_noise_scale1=.03,h("material",d,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in d||(d.b4w_water_dst_noise_freq0=1.3,h("material",d,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in
d||(d.b4w_water_dst_noise_freq1=1,h("material",d,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in d||(d.b4w_water_dir_min_shore_fac=.4,h("material",d,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in d||(d.b4w_water_dir_freq=.5,h("material",d,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in d||(d.b4w_water_dir_noise_scale=.05,h("material",d,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in d||(d.b4w_water_dir_noise_freq=.07,h("material",d,"b4w_water_dir_noise_freq")),
"b4w_water_dir_min_noise_fac"in d||(d.b4w_water_dir_min_noise_fac=.5,h("material",d,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in d||(d.b4w_water_dst_min_fac=.2,h("material",d,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in d||(d.b4w_water_waves_hor_fac=5,h("material",d,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in d||(d.b4w_water_absorb_factor=6,h("material",d,"b4w_water_absorb_factor")),"b4w_water_fog_color"in d||(d.b4w_water_fog_color=new Float32Array(3),d.b4w_water_fog_color=
[.5,.7,.7],h("material",d,"b4w_water_fog_color")),"b4w_foam_factor"in d||(d.b4w_foam_factor=5,h("material",d,"b4w_foam_factor")),"b4w_generated_mesh"in d||(d.b4w_generated_mesh=!1,h("material",d,"b4w_generated_mesh")),"b4w_water_num_cascads"in d||(d.b4w_water_num_cascads=5,h("material",d,"b4w_water_num_cascads")),"b4w_water_subdivs"in d||(d.b4w_water_subdivs=64,h("material",d,"b4w_water_subdivs")),"b4w_water_detailed_dist"in d||(d.b4w_water_detailed_dist=1E3,h("material",d,"b4w_water_detailed_dist"))),
("b4w_dynamic_grass_size"in d)||(d.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in d)||(d.b4w_dynamic_grass_color=""),("diffuse_intensity"in d)||(d.diffuse_intensity=1,h("material",d,"diffuse_intensity")),("b4w_use_ghost"in d)||(d.b4w_use_ghost=!1),("b4w_collision_group"in d)||(d.b4w_collision_group=128,h("material",d,"b4w_collision_group")),("b4w_collision_mask"in d)||(d.b4w_collision_mask=127,h("material",d,"b4w_collision_mask")),"HALO"!=d.type||("b4w_halo_sky_stars"in d)||(d.b4w_halo_sky_stars=
!1,h("material",d,"b4w_halo_sky_stars")),"HALO"!=d.type||("b4w_halo_stars_blend_height"in d)||(d.b4w_halo_stars_blend_height=10,h("material",d,"b4w_halo_stars_blend_height")),"HALO"!=d.type||("b4w_halo_stars_min_height"in d)||(d.b4w_halo_stars_min_height=0,h("material",d,"b4w_halo_stars_min_height")),("specular_shader"in d)||(d.specular_shader="COOKTORR",h("material",d,"specular_shader")),("diffuse_shader"in d)||(d.diffuse_shader="LAMBERT",h("material",d,"diffuse_shader")),("roughness"in d)||(d.roughness=
.5,h("material",d,"roughness")),("diffuse_fresnel"in d)||(d.diffuse_fresnel=.1,h("material",d,"diffuse_fresnel")),("diffuse_fresnel_factor"in d)||(d.diffuse_fresnel_factor=.5,h("material",d,"diffuse_fresnel_factor")),("specular_slope"in d)||(d.specular_slope=.2,h("material",d,"specular_slope")),("specular_toon_size"in d)||(d.specular_toon_size=.5,h("material",d,"specular_toon_size")),("specular_toon_smooth"in d)||(d.specular_toon_smooth=.1,h("material",d,"specular_toon_smooth")),("specular_alpha"in
d)||(d.specular_alpha=1,h("material",d,"specular_alpha")),("b4w_wettable"in d)||(d.b4w_wettable=!1,h("material",d,"b4w_wettable")),("b4w_refractive"in d)||(d.b4w_refractive=!1,h("material",d,"b4w_refractive")),("b4w_refr_bump"in d)||(d.b4w_refr_bump=0,h("material",d,"b4w_refr_bump")),("b4w_shallow_water_col"in d)||(d.b4w_shallow_water_col=[0,.8,.3],h("material",d,"b4w_shallow_water_col")),("b4w_shore_water_col"in d)||(d.b4w_shore_water_col=[0,.9,.2],h("material",d,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in
d)||(d.b4w_shallow_water_col_fac=1,h("material",d,"b4w_shallow_water_col_fac")),("b4w_shore_water_col_fac"in d)||(d.b4w_shore_water_col_fac=.5,h("material",d,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in d)||(d.b4w_water_sss_strength=5.9,h("material",d,"b4w_water_sss_strength")),("b4w_water_sss_width"in d)||(d.b4w_water_sss_width=.45,h("material",d,"b4w_water_sss_width")),("b4w_render_above_all"in d)||(d.b4w_render_above_all=!1,h("material",d,"b4w_render_above_all")),d=d.texture_slots,l=
0;l<d.length;l++)g=d[l],"blend_type"in g||(g.blend_type="MIX",h("texture_slot",g,"blend_type"));b=a.objects;for(f=0;f<b.length;f++){d=b[f];switch(d.type){case "MESH":"b4w_dynamic_geometry"in d||(d.b4w_dynamic_geometry=!1);"b4w_reflexible"in d||(d.b4w_reflexible=!1);"b4w_reflexible_only"in d||(d.b4w_reflexible_only=!1);"b4w_reflective"in d||(d.b4w_reflective=!1);"b4w_wind_bending"in d||(d.b4w_wind_bending=!1,h("object",d,"b4w_wind_bending"));"b4w_wind_bending_angle"in d||(d.b4w_wind_bending_angle=
10,d.b4w_wind_bending_freq=.25,h("object",d,"wind bending params"));"b4w_detail_bending_amp"in d||(d.b4w_detail_bending_amp=.1,d.b4w_branch_bending_amp=.3,h("object",d,"detail bending params"));"b4w_detail_bending_freq"in d||(d.b4w_detail_bending_freq=1,h("object",d,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in d||(d.b4w_main_bend_stiffness_col="",h("object",d,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in d||(d.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",
overall_stiffness_col:""},h("object",d,"b4w_detail_bend_colors"));"b4w_caustics"in d||(d.b4w_caustics=!1);"vertex_groups"in d&&d.vertex_groups.length&&d.data&&0==d.data.vertex_groups.length&&(d.data.vertex_groups=d.vertex_groups,delete d.vertex_groups,h("object",d,"vertex_groups"));"b4w_vertex_anim"in d&&d.b4w_vertex_anim.length&&d.data&&0==d.data.b4w_vertex_anim.length&&(d.data.b4w_vertex_anim=d.b4w_vertex_anim,delete d.b4w_vertex_anim,h("object",d,"b4w_vertex_anim"));"b4w_do_not_render"in d||(d.b4w_do_not_render=
!1);"use_ghost"in d.game||(d.game.use_ghost=!1);"use_sleep"in d.game||(d.game.use_sleep=!1);"velocity_min"in d.game||(d.game.velocity_min=0);"velocity_max"in d.game||(d.game.velocity_max=0);"collision_group"in d.game||(d.game.collision_group=1);"collision_mask"in d.game||(d.game.collision_mask=255);"b4w_vehicle_settings"in d?d.b4w_vehicle_settings&&("steering_ratio"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.steering_ratio=10),"steering_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.steering_max=
1),"inverse_control"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.inverse_control=!1),"force_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.force_max=1500),"brake_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.brake_max=100),"speed_ratio"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.delta_tach_angle=
4.43),"suspension_compression"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in
d.b4w_vehicle_settings||(d.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.floating_factor=3),"floating_factor"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.water_rot_damp=.9)):(d.b4w_vehicle_settings=null,h("object",d,"b4w_vehicle_settings"));"b4w_floating_settings"in
d?d.b4w_floating_settings&&("floating_factor"in d.b4w_floating_settings||(d.b4w_floating_settings.floating_factor=3),"water_lin_damp"in d.b4w_floating_settings||(d.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in d.b4w_floating_settings||(d.b4w_floating_settings.water_rot_damp=.8)):(d.b4w_floating_settings=null,h("object",d,"b4w_floating_settings"));"b4w_character_settings"in d?d.b4w_character_settings&&("walk_speed"in d.b4w_character_settings||(d.b4w_character_settings.walk_speed=4),"run_speed"in
d.b4w_character_settings||(d.b4w_character_settings.run_speed=8),"step_height"in d.b4w_character_settings||(d.b4w_character_settings.step_height=.25),"jump_strength"in d.b4w_character_settings||(d.b4w_character_settings.jump_strength=5),"waterline"in d.b4w_character_settings||(d.b4w_character_settings.waterline=0)):(d.b4w_character_settings=null,h("object",d,"b4w_character_settings"));"b4w_selectable"in d||(d.b4w_selectable=!1,h("object",d,"b4w_selectable"));"b4w_billboard"in d||(d.b4w_billboard=
!1,h("object",d,"b4w_billboard"));"b4w_billboard_geometry"in d||(d.b4w_billboard_geometry="SPHERICAL",h("object",d,"b4w_billboard_geometry"));"b4w_glow_settings"in d||(d.b4w_glow_settings={},d.b4w_glow_settings.glow_duration=1,d.b4w_glow_settings.glow_period=1,d.b4w_glow_settings.glow_relapses=0,h("object",d,"b4w_glow_settings"));"b4w_lod_transition"in d||(d.b4w_lod_transition=.01,h("object",d,"b4w_lod_transition"));"lod_levels"in d||(d.lod_levels=[],h("object",d,"lod_levels"));"b4w_animation_mixing"in
d||(d.b4w_animation_mixing=!1,h("object",d,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in d||(d.b4w_group_relative=!1,h("object",d,"b4w_group_relative"))}"b4w_anim_behavior"in d||(d.b4w_anim_behavior=d.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",h("object",d,"b4w_anim_behavior"));if(!("rotation_quaternion"in d)){l=[0,0,0,1];k.euler_to_quat(d.rotation_euler,l);var g=l,n=l[0],u=l[1],r=l[2];g[0]=l[3];g[1]=n;g[2]=u;g[3]=r;d.rotation_quaternion=l;h("object",d,"rotation_quaternion")}"webgl_do_not_batch"in
d&&(d.b4w_do_not_batch=d.webgl_do_not_batch)&&c("object",d,"webgl_do_not_batch");"b4w_shadow_cast_only"in d||(d.b4w_shadow_cast_only=!1,h("object",d,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in d||(d.b4w_correct_bounding_offset="AUTO",h("object",d,"b4w_correct_bounding_offset"));g=d.particle_systems;for(l=0;l<g.length;l++)n=g[l],u=n.settings,"use_whole_group"in u||(u.use_whole_group=!1,h("object",u,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,h("particle_system",n,
"transforms")),"b4w_billboard_align"in u||(u.b4w_billboard_align="VIEW",h("particle_settings",u,"b4w_billboard_align")),"b4w_dynamic_grass"in u||(u.b4w_dynamic_grass=!1,h("object",u,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in u||(u.b4w_dynamic_grass_scale_threshold=.01,h("object",u,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in u||(u.b4w_initial_rand_rotation=!1,h("particle_settings",u,"b4w_initial_rand_rotation")),"b4w_rotation_type"in u||(u.b4w_rotation_type=
"Z",h("particle_settings",u,"b4w_rotation_type")),"b4w_rand_rotation_strength"in u||(u.b4w_rand_rotation_strength=1,h("particle_settings",u,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in u||(u.b4w_hair_billboard=!1,h("particle_settings",u,"b4w_hair_billboard")),"b4w_hair_billboard_type"in u||(u.b4w_hair_billboard_type="BASIC",h("particle_settings",u,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in u||(u.b4w_hair_billboard_jitter_amp=0,h("particle_settings",u,"b4w_hair_billboard_jitter_amp")),
"b4w_hair_billboard_jitter_freq"in u||(u.b4w_hair_billboard_jitter_freq=0,h("particle_settings",u,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in u||(u.b4w_hair_billboard_geometry="SPHERICAL",h("particle_settings",u,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in u||(u.b4w_wind_bend_inheritance="PARENT",h("particle_settings",u,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in u||(u.b4w_shadow_inheritance="PARENT",h("particle_settings",u,"b4w_shadow_inheritance")),
"b4w_reflection_inheritance"in u||(u.b4w_reflection_inheritance="PARENT",h("particle_settings",u,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in u||(u.b4w_vcol_from_name="",h("particle_settings",u,"b4w_vcol_from_name")),"b4w_vcol_to_name"in u||(u.b4w_vcol_to_name="",h("particle_settings",u,"b4w_vcol_to_name")),"b4w_coordinate_system"in u||(u.b4w_coordinate_system="LOCAL",h("particle_settings",u,"b4w_coordinate_system")),"b4w_allow_nla"in u||(u.b4w_allow_nla=!0,h("particle_settings",u,"b4w_allow_nla"));
"constraints"in d||(d.constraints=[],h("object",d,"constraints"));g=d.modifiers;for(l=0;l<g.length;l++){a:{n=g[l];switch(n.type){case "ARRAY":if(!("fit_type"in n)){e.error("WARNING Incomplete modifier "+String(n.type)+' for "'+d.name+'", reexport '+(d.library?"library"+d.library.split("/").slice(-1)[0]:"main scene"));n=!1;break a}}n=!0}n||(g.splice(l,1),l--)}"animation_data"in d||(d.animation_data={action:null,nla_tracks:[]},h("object",d,"animation_data"));if(d.animation_data)for(("action"in d.animation_data)||
(d.animation_data.action=null,e.warn("B4W Warning: no action in animation data "+d.name)),("nla_tracks"in d.animation_data)||(d.animation_data.nla_tracks=[],e.warn("B4W Warning: no NLA in animation data "+d.name)),g=d.animation_data.nla_tracks,l=0;l<g.length;l++)for(n=g[l],u=0;u<n.strips.length;u++)r=n.strips[u],"action"in r||(r.action=null,e.warn("B4W Warning: no action in NLA strip "+d.name)),"action_frame_start"in r||(r.action_frame_start=0,e.warn("B4W Warning: no action_frame_start in NLA strip "+
d.name)),"action_frame_end"in r||(r.action_frame_end=r.frame_end-r.frame_start,e.warn("B4W Warning: no action_frame_start in NLA strip "+d.name));"b4w_collision_id"in d||(d.b4w_collision_id="",h("material",d,"b4w_collision_id"));g=d.scale;l=Math.abs((g[0]-g[1])/g[0]);g=Math.abs((g[1]-g[2])/g[1]);.001>l&&.001>g||e.warn("B4W Warning: non-uniform scale for object "+d.name)}for(var x in t)f=t[x],b=x.match(/.*?(?=>>|$)/i)[0],e.warn("WARNING "+String(b)+" is "+f.report_type+" for "+f.type+", reexport "+
a.b4w_filepath_blend)};a.apply_mesh_modifiers=function(a){var c;a:{c=a.modifiers;for(var e=0;e<c.length;e++){var h=c[e].type;if("ARRAY"==h||"CURVE"==h){c=!0;break a}}c=!1}if(!c)return null;c=f(a.data,a.data.name+"_MOD");a=a.modifiers;for(e=0;e<a.length;e++){var t=a[e];switch(t.type){case "ARRAY":for(var h=c,g=t,A=0,u=0,p=0,I=new Float32Array(16),t=[],v=1;v<g.count;v++){g.use_constant_offset&&(A+=g.constant_offset_displace[0],u+=g.constant_offset_displace[1],p+=g.constant_offset_displace[2]);if(g.use_relative_offset)var K=
h.b4w_bounding_box,A=A+(K.max_x-K.min_x)*g.relative_offset_displace[0],u=u+(K.max_y-K.min_y)*g.relative_offset_displace[1],p=p+(K.max_z-K.min_z)*g.relative_offset_displace[2];k.trans_matrix(A,u,p,I);for(var m=K=f(h),H=I,D=0;D<m.submeshes.length;D++){var U=m.submeshes[D];k.positions_multiply_matrix(U.position,H,U.position,0);k.vectors_multiply_matrix(U.normal,H,U.normal,0);k.tangents_multiply_matrix(U.tangent,H,U.tangent,0)}t.push(K)}for(v=0;v<t.length;v++)for(g=h,A=t[v],u=0;u<g.submeshes.length;u++){p=
g.submeshes[u];I=A.submeshes[u];K=p.base_length;m=p.indices.length;p.base_length+=I.base_length;for(var P in p)if("base_length"!=P)if("indices"==P)for(p[P]=k.uint32_concat(p[P],I[P]),H=m;H<p.indices.length;H++)p.indices[H]+=K;else p[P]=k.float32_concat(p[P],I[P])}break;case "CURVE":for(var h=c,v=t.object._spline,g=new Float32Array(16),u=v.is_3d?4:3,A=new Float32Array(u),u=new Float32Array(u),p=new Float32Array(3),I=new Float32Array(4),K=new Float32Array(4),m=new Float32Array(3),H=new Float32Array(3),
D=new Float32Array(3),U=new Float32Array(4),Z=new Float32Array(4),V=0;V<h.submeshes.length;V++){var M=h.submeshes[V],Q=M.position,T=M.normal,M=M.tangent,X;a:switch(X=t.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}m[0]=0;m[1]=0;m[2]=0;m[X]=1;for(var z=l.spline_length(v),ia=0;ia<Q.length/3;ia++){D[0]=Q[3*ia];D[1]=Q[3*ia+1];D[2]=Q[3*ia+2];var W=D[X],L=l.spline_len_to_t(v,W);
l.spline_point(v,L,A);p[0]=A[0];p[1]=A[1];p[2]=A[2];l.spline_derivative(v,L,u);H[0]=u[0];H[1]=0;H[2]=u[2];d.normalize(H,H);x.rotationTo(m,H,I);0>W?(A[0]=H[0],A[1]=H[1],A[2]=H[2],d.scale(A,W,A),d.add(p,A,p)):W>z&&(A[0]=H[0],A[1]=H[1],A[2]=H[2],d.scale(A,W-z,A),d.add(p,A,p));n.fromRotationTranslation(I,p,g);v.is_3d&&(x.setAxisAngle(m,A[3],K),d.transformQuat(D,K,D));D[X]=0;d.transformMat4(D,g,D);Q[3*ia]=D[0];Q[3*ia+1]=D[1];Q[3*ia+2]=D[2];T.length&&(U[0]=T[3*ia],U[1]=T[3*ia+1],U[2]=T[3*ia+2],U[3]=0,r.transformMat4(U,
g,U),T[3*ia]=U[0],T[3*ia+1]=U[1],T[3*ia+2]=U[2]);M.length&&(Z[0]=M[3*ia],Z[1]=M[3*ia+1],Z[2]=M[3*ia+2],Z[3]=0,r.transformMat4(Z,g,Z),M[3*ia]=Z[0],M[3*ia+1]=Z[1],M[3*ia+2]=Z[2])}}}b.recalculate_mesh_boundings(c)}return c};a.create_material=function(a){return{name:a,use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,
specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,
offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};b4w.module.__renderer=function(a,p){function h(a){if(a){var b=(a.clear_color?B.COLOR_BUFFER_BIT:0)|(a.clear_depth?B.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=x;break;case "DEPTH":a=n;break;case "SHORE_SMOOTHING":a=x;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=t;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=w;break;default:a=r.background_color}}else b=B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT,a=r.background_color;B.colorMask(!0,
!0,!0,!0);B.depthMask(!0);B.clearColor(a[0],a[1],a[2],a[3]);B.clear(b)}function c(a,b,c){B.bindBuffer(B.ARRAY_BUFFER,a.vbo);for(var d=0;d<b.length;d++){var e=b[d];B.enableVertexAttribArray(e.loc);B.vertexAttribPointer(e.loc,e.num_comp,B.FLOAT,!1,0,e.base_offset+e.frame_length*c)}a.ibo?(B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,a.ibo),B.drawElements(a.mode,a.count,a.ibo_type,0)):B.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],B.disableVertexAttribArray(e.loc)}function f(a){switch(a){case 0:return B.TEXTURE_CUBE_MAP_NEGATIVE_Y;
case 1:return B.TEXTURE_CUBE_MAP_POSITIVE_Y;case 2:return B.TEXTURE_CUBE_MAP_POSITIVE_X;case 3:return B.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return B.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return B.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function b(a){var b=a.uniforms,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.proj_matrix)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.view_matrix)};
h=!0;break;case "u_shadow_cast_billboard_view_matrix":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.shadow_cast_billboard_view_matrix)};h=!0;break;case "u_view_proj_prev":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.prev_view_proj_matrix)};h=!0;break;case "u_view_proj_inverse":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.view_proj_inv_matrix)};h=!0;break;case "u_sky_vp_inverse":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.sky_vp_inv_matrix)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":k=
function(a,b,c,d,e,f){a.uniform3fv(b,f.eye)};h=!0;break;case "u_camera_eye_last":k=function(a,b,c,d,e,f){a.uniform3fv(b,f.eye_last)};h=!0;break;case "u_camera_quat":k=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};h=!0;break;case "u_view_max_depth":k=function(a,b,c,d,e,f){a.uniform1f(b,f.far)};h=!0;break;case "u_camera_range":k=function(a,b,c,d,e,f){a.uniform2f(b,f.near,f.far)};break;case "u_csm_center_dists":k=function(a,b,c,d,e,f){a.uniform4fv(b,f.csm_center_dists)};break;case "u_cam_water_depth":k=
function(a,b,c,d,e,f){a.uniform1f(b,c.cam_water_depth)};h=!0;break;case "u_waves_height":k=function(a,b,c,d,e,f){a.uniform1f(b,c.water_waves_height)};break;case "u_waves_length":k=function(a,b,c,d,e,f){a.uniform1f(b,c.water_waves_length)};break;case "u_fog_color_density":k=function(a,b,c,d,e,f){a.uniform4fv(b,c.fog_color_density)};break;case "u_underwater_fog_color_density":k=function(a,b,c,d,e,f){a.uniform4fv(b,c.water_fog_color_density)};break;case "u_bloom_key":k=function(a,b,c,d,e,f){a.uniform1f(b,
c.bloom_key)};break;case "u_bloom_edge_lum":k=function(a,b,c,d,e,f){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":k=function(a,b,c,d,e,f){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.wind)};break;case "u_horizon_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.horizon_color)};break;case "u_zenith_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.zenith_color)};break;case "u_environment_energy":k=function(a,b,c,d,e,f){a.uniform1f(b,c.environment_energy)};
break;case "u_sky_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.sky_color)};break;case "u_rayleigh_brightness":k=function(a,b,c,d,e,f){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":k=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":k=function(a,b,c,d,e,f){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":k=function(a,b,c,d,e,f){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":k=function(a,b,c,d,e,f){a.uniform1f(b,
c.rayleigh_strength)};break;case "u_mie_strength":k=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":k=function(a,b,c,d,e,f){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":k=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":k=function(a,b,c,d,e,f){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.light_positions)};break;case "u_light_directions":k=
function(a,b,c,d,e,f){a.uniform3fv(b,c.light_directions)};break;case "u_light_color_intensities":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.light_color_intensities)};break;case "u_light_factors1":k=function(a,b,c,d,e,f){a.uniform4fv(b,c.light_factors1)};break;case "u_light_factors2":k=function(a,b,c,d,e,f){a.uniform4fv(b,c.light_factors2)};break;case "u_sun_quaternion":k=function(a,b,c,d,e,f){a.uniform4fv(b,c.sun_quaternion)};break;case "u_sun_intensity":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.sun_intensity)};
break;case "u_sun_direction":k=function(a,b,c,d,e,f){a.uniform3fv(b,c.sun_direction)};break;case "u_height":k=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_matrix":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,d.world_matrix)};h=!0;break;case "u_transb":k=function(a,b,c,d,e,f){a.uniform4fv(b,d.trans_before)};h=!0;break;case "u_transa":k=function(a,b,c,d,e,f){a.uniform4fv(b,d.trans_after)};h=!0;break;case "u_quat":k=function(a,b,c,d,e,f){a.uniform4fv(b,d.quat)};h=!0;break;
case "u_quatsb":k=function(a,b,c,d,e,f){a.uniform4fv(b,d.quats_before)};h=!0;break;case "u_quatsa":k=function(a,b,c,d,e,f){a.uniform4fv(b,d.quats_after)};h=!0;break;case "u_frame_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,d.frame_factor)};h=!0;break;case "au_center_pos":k=function(a,b,c,d,e,f){};h=!0;break;case "au_wind_bending_amp":k=function(a,b,c,d,e,f){a.uniform1f(b,d.wind_bending_amp)};h=!0;break;case "au_wind_bending_freq":k=function(a,b,c,d,e,f){a.uniform1f(b,d.wind_bending_freq)};h=!0;
break;case "au_detail_bending_freq":k=function(a,b,c,d,e,f){a.uniform1f(b,d.detail_bending_freq)};h=!0;break;case "au_detail_bending_amp":k=function(a,b,c,d,e,f){a.uniform1f(b,d.detail_bending_amp)};h=!0;break;case "au_branch_bending_amp":k=function(a,b,c,d,e,f){a.uniform1f(b,d.branch_bending_amp)};h=!0;break;case "u_anim_values":k=function(a,b,c,d,e,f){a.uniform1fv(b,d.mats_anim_values)};h=!0;break;case "u_diffuse_color":k=function(a,b,c,d,e,f){a.uniform4fv(b,e.diffuse_color)};h=!0;break;case "u_diffuse_intensity":k=
function(a,b,c,d,e,f){a.uniform1f(b,e.diffuse_intensity)};h=!0;break;case "u_diffuse_params":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.diffuse_params)};h=!0;break;case "u_emit":k=function(a,b,c,d,e,f){a.uniform1f(b,e.emit)};h=!0;break;case "u_ambient":k=function(a,b,c,d,e,f){a.uniform1f(b,e.ambient)};h=!0;break;case "u_specular_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.specular_color)};h=!0;break;case "u_specular_alpha":k=function(a,b,c,d,e,f){a.uniform1f(b,e.specular_alpha)};h=!0;break;case "u_specular_params":k=
function(a,b,c,d,e,f){a.uniform3fv(b,e.specular_params)};h=!0;break;case "u_reflect_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.reflect_factor)};h=!0;break;case "u_mirror_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.mirror_factor)};h=!0;break;case "u_grass_map_dim":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.grass_map_dim)};h=!0;break;case "u_grass_size":k=function(a,b,c,d,e,f){a.uniform1f(b,e.grass_size)};h=!0;break;case "u_scale_threshold":k=function(a,b,c,d,e,f){a.uniform1f(b,e.grass_scale_threshold)};
h=!0;break;case "u_cube_fog":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,e.cube_fog)};break;case "u_jitter_amp":k=function(a,b,c,d,e,f){a.uniform1f(b,e.jitter_amp)};h=!0;break;case "u_jitter_freq":k=function(a,b,c,d,e,f){a.uniform1f(b,e.jitter_freq)};h=!0;break;case "u_wireframe_mode":k=function(a,b,c,d,e,f){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":k=function(a,b,c,d,e,f){a.uniform2fv(b,
c.jitter_projection_space)};h=!0;break;case "u_subsample_indices":k=function(a,b,c,d,e,f){a.uniform4fv(b,c.jitter_subsample_ind)};h=!0;break;case "u_refr_bump":k=function(a,b,c,d,e,f){a.uniform1f(b,e.refr_bump)};h=!0;break;case "u_lamp_light_positions":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.lamp_light_positions)};break;case "u_lamp_light_directions":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.lamp_light_directions)};break;case "u_lamp_light_color_intensities":k=function(a,b,c,d,e,f){a.uniform3fv(b,
e.lamp_light_color_intensities)};break;case "u_lamp_light_factors":k=function(a,b,c,d,e,f){a.uniform4fv(b,e.lamp_light_factors)};break;case "u_halo_size":k=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_size)};h=!0;break;case "u_halo_hardness":k=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_hardness)};h=!0;break;case "u_halo_rings_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.halo_rings_color)};h=!0;break;case "u_halo_lines_color":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.halo_lines_color)};h=!0;break;
case "u_halo_stars_blend":k=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_stars_blend)};h=!0;break;case "u_halo_stars_height":k=function(a,b,c,d,e,f){a.uniform1f(b,e.halo_stars_height)};h=!0;break;case "u_fresnel_params":k=function(a,b,c,d,e,f){a.uniform4fv(b,e.fresnel_params)};h=!0;break;case "u_texture_scale":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.texture_scale)};h=!0;break;case "u_parallax_scale":k=function(a,b,c,d,e,f){a.uniform1f(b,e.parallax_scale)};h=!0;break;case "u_color_id":k=function(a,
b,c,d,e,f){a.uniform3fv(b,e.color_id)};h=!0;break;case "u_line_points":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.line_points)};h=!0;break;case "u_diffuse_color_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.diffuse_color_factor)};h=!0;break;case "u_alpha_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.alpha_factor)};h=!0;break;case "u_specular_color_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.specular_color_factor)};h=!0;break;case "u_normal_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.normal_factor)};
h=!0;break;case "u_colormap0_uv_velocity":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.colormap0_uv_velocity)};h=!0;break;case "u_normalmap0_uv_velocity":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_uv_velocities[0])};h=!0;break;case "u_normalmap1_uv_velocity":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_uv_velocities[1])};h=!0;break;case "u_normalmap2_uv_velocity":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_uv_velocities[2])};h=!0;break;case "u_normalmap3_uv_velocity":k=function(a,
b,c,d,e,f){a.uniform2fv(b,e.normalmap_uv_velocities[3])};h=!0;break;case "u_normalmap0_scale":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[0])};h=!0;break;case "u_normalmap1_scale":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[1])};h=!0;break;case "u_normalmap2_scale":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[2])};h=!0;break;case "u_normalmap3_scale":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.normalmap_scales[3])};h=!0;break;case "u_foam_factor":k=function(a,
b,c,d,e,f){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.foam_uv_freq)};h=!0;break;case "u_foam_mag":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.foam_mag)};h=!0;break;case "u_foam_scale":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.foam_scale)};h=!0;break;case "u_shallow_water_col":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.shore_water_col)};h=!0;break;
case "u_water_shallow_col_fac":k=function(a,b,c,d,e,f){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":k=function(a,b,c,d,e,f){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_length)};h=!0;break;case "u_p_cyclic":k=function(a,b,c,d,e,f){a.uniform1i(b,e.p_cyclic)};h=!0;break;case "u_p_max_lifetime":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_max_lifetime)};h=!0;break;case "u_p_fade_in":k=function(a,b,c,d,e,f){a.uniform1f(b,
e.p_fade_in)};h=!0;break;case "u_p_fade_out":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_fade_out)};h=!0;break;case "u_p_size":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_size)};h=!0;break;case "u_p_alpha_start":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_alpha_start)};h=!0;break;case "u_p_alpha_end":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_alpha_end)};h=!0;break;case "u_p_nfactor":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_nfactor)};h=!0;break;case "u_p_gravity":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_gravity)};
h=!0;break;case "u_p_mass":k=function(a,b,c,d,e,f){a.uniform1f(b,e.p_mass)};h=!0;break;case "u_p_size_ramp":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.p_size_ramp)};h=!0;break;case "u_p_color_ramp":k=function(a,b,c,d,e,f){a.uniform4fv(b,e.p_color_ramp)};h=!0;break;case "u_p_wind":k=function(a,b,c,d,e,f){a.uniform3fv(b,e.p_wind)};h=!0;break;case "u_texel_size":k=function(a,b,c,d,e,f){a.uniform2fv(b,e.texel_size)};h=!0;break;case "u_p_time":k=function(a,b,c,d,e,f){a.uniform1f(b,e.particle_system._internal.time)};
h=!0;break;case "u_va_frame_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,d.va_frame_factor)};h=!0;break;case "u_normal_offset":k=function(a,b,c,d,e,f){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":k=function(a,b,c,d,e,f){a.uniform4fv(b,f.pcf_blur_radii)};break;case "u_v_light_matrix":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.v_light_matrix)};h=!0;break;case "u_b_light_matrix":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.b_light_matrix)};break;case "u_p_light_matrix0":k=
function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[0])};h=!0;break;case "u_p_light_matrix1":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[1])};h=!0;break;case "u_p_light_matrix2":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[2])};h=!0;break;case "u_p_light_matrix3":k=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,c.p_light_matrix[3])};h=!0;break;case "u_motion_blur_exp":k=function(a,b,c,d,e,f){a.uniform1f(b,c.motion_blur_exp)};h=!0;break;case "u_refl_plane":k=
function(a,b,c,d,e,f){a.uniform4fv(b,c.reflection_plane)};break;case "u_radial_blur_step":k=function(a,b,c,d,e,f){a.uniform1f(b,c.radial_blur_step)};break;case "u_god_rays_intensity":k=function(a,b,c,d,e,f){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":k=function(a,b,c,d,e,f){a.uniform1f(b,c.ssao_radius_increase)};break;case "u_ssao_blur_discard_value":k=function(a,b,c,d,e,f){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":k=function(a,b,c,d,
e,f){a.uniform1f(b,c.ssao_influence)};break;case "u_ssao_dist_factor":k=function(a,b,c,d,e,f){a.uniform1f(b,c.ssao_dist_factor)};break;case "u_dof_dist":k=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};h=!0;break;case "u_dof_front":k=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":k=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};h=!0;break;case "u_glow_intensity":k=function(a,b,c,d,e,f){a.uniform1f(b,e.glow_intensity)};h=!0;break;case "u_glow_color":k=function(a,
b,c,d,e,f){a.uniform3fv(b,c.glow_color)};break;case "u_draw_glow":k=function(a,b,c,d,e,f){a.uniform1f(b,c.draw_glow_flag)};h=!0;break;case "u_brightness":k=function(a,b,c,d,e,f){a.uniform1f(b,c.brightness)};break;case "u_contrast":k=function(a,b,c,d,e,f){a.uniform1f(b,c.contrast)};break;case "u_exposure":k=function(a,b,c,d,e,f){a.uniform1f(b,c.exposure)};break;case "u_saturation":k=function(a,b,c,d,e,f){a.uniform1f(b,c.saturation)};break;default:k=null}k&&(k={name:f,fun:k,loc:b[f]},h?c.push(k):(d.push(k),
e[f]=k))}a.transient_uniform_setters=c;a.permanent_uniform_setters=d;a.permanent_uniform_setters_table=e}var l=p("__config"),e=p("__debug"),k=p("__textures"),d=p("__util"),r=l.defaults,x=[1,1,1,1],n=[1,1,1,1],t=[0,0,0,1],w=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var B=null,q=new Uint8Array(4);a.setup_context=function(a){var b=r.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);
a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);B=a};a.draw=function(a){if(a.do_render){var d=a.camera;B.bindFramebuffer(B.FRAMEBUFFER,d.framebuffer);if(a.assign_texture){var g=d.color_attachment;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,g.w_target,g.w_texture,0)}B.viewport(0,0,d.width,d.height);h(a);a.blend?B.enable(B.BLEND):B.disable(B.BLEND);a.depth_test?B.enable(B.DEPTH_TEST):B.disable(B.DEPTH_TEST);
if(a.need_perm_uniforms_update){for(var d=a.camera,g=a.bundles,k=0;k<g.length;k++){var l=g[k],n=l.batch,t=n.shader;B.useProgram(t.program);l=l.obj_render;t.permanent_uniform_setters.length||b(t);for(var t=t.permanent_uniform_setters,v=t.length;v--;){var w=t[v];w.fun(B,w.loc,a,l,n,d)}}a.need_perm_uniforms_update=!1}switch(a.type){case "SHADOW_CAST":B.enable(B.POLYGON_OFFSET_FILL);B.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);B.cullFace(B.BACK);break;case "MAIN_REFLECT":B.disable(B.POLYGON_OFFSET_FILL);
B.cullFace(B.FRONT);break;default:B.disable(B.POLYGON_OFFSET_FILL),B.cullFace(B.BACK)}d=a.camera;g=a.bundles;for(k=0;k<g.length;k++)if(l=g[k],l.do_render){var n=a,w=d,t=l.obj_render,m=l.batch,l=m.shader;B.useProgram(l.program);for(var x=m.bufs_data,v=m.attribute_setters,D=l.transient_uniform_setters,p=D.length;p--;){var P=D[p];P.fun(B,P.loc,n,t,m,w)}w=m.color_mask;B.colorMask(w,w,w,w);B.depthMask(m.depth_mask);m.use_backface_culling?B.enable(B.CULL_FACE):B.disable(B.CULL_FACE);w=m.textures;m=m.texture_names;
D=l.uniforms;p=w.length|0;if(0!==p)if(1===p)B.activeTexture(B.TEXTURE0),B.bindTexture(w[0].w_target,w[0].w_texture);else for(P=0;P<p;P++){var Z=w[P],V=m[P];B.activeTexture(B.TEXTURE0+P);B.bindTexture(Z.w_target,Z.w_texture);B.uniform1i(D[V],P)}if("SKY"==n.type){w=n;l=l.uniforms;m=w.camera.color_attachment.w_texture;D=w.cube_view_matrices;for(p=0;6>p;p++)if(P=f(p),r.clear_procedural_sky_hack)Z=new Uint8Array([91.8,142.8,.96*255,255]),B.bindTexture(B.TEXTURE_CUBE_MAP,m),B.texImage2D(P,0,B.RGBA,1,1,
0,B.RGBA,B.UNSIGNED_BYTE,Z);else if(B.uniformMatrix4fv(l.u_cube_view_matrix,!1,D[p]),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,P,m,0),c(x,v,t.va_frame),w.need_fog_update&&0!=p){var P=w,Z=p,M=q;B.readPixels(191,191,1,1,B.RGBA,B.UNSIGNED_BYTE,M);255!=M[0]&&255!=M[1]&&255!=M[2]||B.readPixels(191,220,1,1,B.RGBA,B.UNSIGNED_BYTE,M);var V=M[0],Q=M[1],M=M[2],V=V/255,Q=Q/255,M=M/255;1===Z?(P.cube_fog[3]=V,P.cube_fog[7]=Q,P.cube_fog[11]=M):(P.cube_fog[4*(Z-2)]=V,P.cube_fog[4*(Z-2)+1]=Q,P.cube_fog[4*
(Z-2)+2]=M)}n.debug_render_calls+=6}else c(x,v,t.va_frame),n.debug_render_calls++}e.check_gl("draw subscene: "+a.type);B.bindFramebuffer(B.FRAMEBUFFER,null)}};a.clear=h;a.assign_attribute_setters=function(a){var b=a.attribute_setters;b.length=0;var c=a.bufs_data;a=a.shader;c&&a||d.panic("Incomplete batch");c=c.pointers;a=a.attributes;for(var e in a){var f=c[e];b.push({loc:a[e],base_offset:4*f.offset,frame_length:1<f.frames?4*f.length:0,num_comp:f.num_comp})}};a.assign_uniform_setters=b;a.read_pixels=
function(a,b,c,e,f,h){e||(e=1);f||(f=1);h||(h=new Uint8Array(4*e*f));h.length!=4*e*f&&d.panic("read_pixels(): Wrong storage");B.bindFramebuffer(B.FRAMEBUFFER,a);B.readPixels(b,c,e,f,B.RGBA,B.UNSIGNED_BYTE,h);B.bindFramebuffer(B.FRAMEBUFFER,null);return h};a.update_batch_permanent_uniform=function(a,c){var d=a.shader;B.useProgram(d.program);d.permanent_uniform_setters.length||b(d);d=d.permanent_uniform_setters_table[c];d.fun(B,d.loc,null,null,a,null)};a.render_target_create=function(a,b){var c=B.createFramebuffer();
B.bindFramebuffer(B.FRAMEBUFFER,c);if(a){var d=a,f=d.w_texture,d=d.w_target==B.TEXTURE_CUBE_MAP?B.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.w_target;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,d,f,0)}k.is_renderbuffer(b)?B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,b.w_renderbuffer):k.is_texture(b)&&(d=b,f=d.w_texture,d=d.w_target,B.framebufferTexture2D(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,d,f,0));e.check_bound_fb();B.bindFramebuffer(B.FRAMEBUFFER,null);return c};a.render_target_cleanup=
function(a,b,c,d,e){null==a?(B.bindFramebuffer(B.FRAMEBUFFER,a),B.viewport(0,0,d,e),B.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT)):(k.is_texture(b)&&B.deleteTexture(b.w_texture),k.is_renderbuffer(c)?B.deleteRenderbuffer(c.w_renderbuffer):k.is_texture(c)&&B.deleteTexture(c.w_texture),B.deleteFramebuffer(a))};a.increment_subpixel_index=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function h(a,b,d){var e=a.directives;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function f(a,b){var c=a+b;if(A[c])return A[c];if(s){var d=s[b];if(!d)return null}else{d=B.get_text_sync(a+b,!1);if(!d)return null;d=y.parser.parse(d)}return A[c]=d}function b(a,b,c,d){function e(b){b=b.parts;for(var c=0;c<b.length;c++){var k=
b[c];switch(k.type){case "condition":a:for(var k=k.parts,s=0;s<k.length;s++){var t=k[s];switch(t.type){case "if":case "elif":var v=t.expression;try{var x,p=l(v,h,u,!0);x=w.parser.parse(p)}catch(B){throw"Failed to process #"+t.type+" expression: "+v.join(" ");}if(x){e(t.group);break a}break;case "else":e(t.group);break;case "ifdef":t.name in h&&e(t.group);break;case "ifndef":t.name in h||e(t.group)}}break;case "include":k=f(q.shaders_dir,q.shaders_include_dir+k.file);e(k);break;case "var":case "export":case "import":break;
case "define":s=k.name;h[s]=k.tokens;k.params&&(u[s]=k.params);break;case "error":throw"Shader error: #error "+k.tokens.join(" ");case "line":break;case "pragma":g.push("#pragma "+k.name+" "+k.tokens.join(" "));break;case "undef":k=k.name;delete h[k];delete u[k];break;case "warning":n.warn("Shader warning: #warning "+k.tokens.join(" "));break;case "extension":g.push("#extension "+l(k.tokens,h,u,!1));break;case "#":break;case "node":r[k.name]=k.group.parts;break;case "nodes_global":k=d;for(s=0;s<k.length;s++)if(t=
k[s],v=r[t.id])for(var y=0,A=0;A<v.length;A++){var C=v[A];"node_param"==C.type&&(C=C.qualifier.join(" ")+" ","vert"==a?C+=t.vparams[y]:"frag"==a&&(C+=t.params[y],null!==t.param_values[y]&&(C+=" = "+t.param_values[y])),C+=";",g.push(C),y++)}break;case "nodes_main":k=d;s={};for(t=0;t<k.length;t++)if(C=k[t],v=r[C.id]){var J=0,ha=0,P=0;s[t]={};for(y=0;y<v.length;y++)switch(A=v[y],A.type){case "node_in":var K=C.inputs[J];if(null!==C.input_values[J]){var Y=A.qualifier.join(" ")+" ",Y=Y+K,Y=Y+(" = "+C.input_values[J]),
Y=Y+";";g.push(Y)}s[t][A.name]=K;J++;break;case "node_out":K=C.outputs[ha];Y=A.qualifier.join(" ")+" ";Y+=K;Y+=";";g.push(Y);s[t][A.name]=K;ha++;break;case "node_param":"vert"==a?K=C.vparams[P]:"frag"==a&&(K=C.params[P]),s[t][A.name]=K,P++}}for(t=0;t<k.length;t++)if(C=k[t],v=r[C.id])for(y=0;y<v.length;y++)if(A=v[y],"textline"==A.type){C=[];for(J=0;J<A.tokens.length;J++)ha=A.tokens[J],ha in s[t]?C.push(s[t][ha]):C.push(ha);g.push(l(C,h,u,!1))}break;case "textline":g.push(l(k.tokens,h,u,!1));break;
default:throw"Unknown element type: "+k.type;}}}for(var g=[],h={},k=0;k<c.length;k++)h[c[k][0]]=[c[k][1]];for(k=0;k<d.length;k++)h["USE_NODE_"+d[k].id]=[1];var u={},r={};e(b);return g.join("\n")}function l(a,b,c,d){var f=[];e(a,b,c,d,f);return f.join(" ")}function e(a,b,c,d,f){for(var g=0;g<a.length;g++){var h=a[g];h in b?(h=b[h],0==h.length&&d?f.push(0):e(h,b,c,d,f)):f.push(h)}}function k(a,b,c,d,e){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);t.check_shader_compiling(d,b,c);return d}
function d(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return r(a);case 2:return"vec2("+r(a[0])+","+r(a[1])+")";case 3:return"vec3("+r(a[0])+","+r(a[1])+","+r(a[2])+")";case 4:return"vec4("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+")";case 9:return"mat3("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+","+r(a[4])+","+r(a[5])+","+r(a[6])+","+r(a[7])+","+r(a[8])+")";case 16:return"mat4("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+","+r(a[4])+","+r(a[5])+","+r(a[6])+","+r(a[7])+","+r(a[8])+
","+r(a[9])+","+r(a[10])+","+r(a[11])+","+r(a[12])+","+r(a[13])+","+r(a[14])+","+r(a[15])+")";default:throw"Wrong glsl value dimension";}}function r(a){return a%1?String(a):String(a)+".0"}var x=p("__config"),n=p("__print"),t=p("__debug"),w=p("__gpp_eval"),B=p("__assets");p("__util");var q=x.paths;if(b4w.module_check(x.paths.shader_texts_module))var s=p(x.paths.shader_texts_module),y=null;else s=null,y=p("__gpp_parser");var g={},A={},u=[],S=null;a.setup_context=function(a){S=a};a.set_directive=h;a.get_directive=
c;a.is_enabled=function(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.set_default_directives=function(a){a.directives=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "SHADOW_TEX_RES":f=d(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";break;case "SHADOW_SRC":f="SHADOW_SRC_NONE";break;case "SHADOW_DST":f=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=x.defaults.precision;break;case "EPSILON":f="highp"==x.defaults.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:n.error("Unknown directive ("+a.vert+", "+a.frag+"): "+e)}h(a,e,f)}};a.get_vname=function(a){return a.vert};a.get_fname=function(a){return a.frag};
a.inherit_directives=function(a,b){for(var d=b.directives,e=0;e<d.length;e++){var f=d[e][0],g=d[e][1];c(a,f)&&h(a,f,g)}};a.get_compiled_shader=function(a,c){var d=JSON.stringify(a)+JSON.stringify(c),e=g[d];if(e)return e;var h=a.frag,e=f(q.shaders_dir,a.vert),h=f(q.shaders_dir,h);if(!e||!h)return null;var l=a.directives||[],u=b("vert",e,l,c),l=b("frag",h,l,c),e=S,r=k(e,d,u,e.VERTEX_SHADER,a),s=k(e,d,l,e.FRAGMENT_SHADER,a),h=e.createProgram();e.attachShader(h,r);e.attachShader(h,s);e.linkProgram(h);
e.validateProgram(h);e.getProgramParameter(h,e.VALIDATE_STATUS)==e.FALSE&&n.error("B4W Error - shader program is not valid",d);t.check_shader_linking(h,d,r,s,u,l);u={vshader:r,fshader:s,program:h,attributes:{},uniforms:{},permanent_uniform_setters:[],permanent_uniform_setters_table:{},transient_uniform_setters:[],shaders_info:a};r=e.getProgramParameter(h,e.ACTIVE_ATTRIBUTES);for(l=0;l<r;l++){var s=e.getActiveAttrib(h,l).name,w=e.getAttribLocation(h,s);u.attributes[s]=w}r=e.getProgramParameter(h,e.ACTIVE_UNIFORMS);
for(l=0;l<r;l++)s=e.getActiveUniform(h,l).name.split("[0]").join(""),w=e.getUniformLocation(h,s),u.uniforms[s]=w;return g[d]=e=u};a.debug_get_compilation_stats=function(){return u};a.get_compiled_shaders=function(){return g};a.cleanup=function(){for(var a in g){var b=g[a];S.deleteProgram(b.program);S.deleteShader(b.vshader);S.deleteShader(b.fshader);delete g[a]}for(var c in A)delete A[c];for(var d in u)delete u[d]};a.debug_shaders_info=function(a){var b=a.directives;n.log("Shader: "+a.vert+" "+a.frag+
", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.glsl_value=d;a.check_uniform=function(a,b){return b in a.uniforms?!0:!1};a.get_varyings_count=function(a){return(S.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__assets=function(a,p){function h(){return t.is_built_in_data()?p(t.paths.built_in_data_module).data:null}function c(){var a={_source_url:null,_parse_response:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},
open:function(b,c,d){a._source_url=c;a.readyState=1},send:function(){a.status=404;a.readyState=4;var b=h();b&&a._source_url in b&&(a.status=200,b[a._source_url]&&(a.response=a._parse_response(b[a._source_url])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function f(c){for(var f=0,g=0;g<c.length;g++){var h=c[g];20===h.state&&f++;if(f>=y.max_requests)break;if(10===h.state)switch(h.state=20,f++,h.type){case a.AT_ARRAYBUFFER:b(h,"arraybuffer");break;
case a.AT_JSON:b(h,"json");break;case a.AT_TEXT:b(h,"text");break;case a.AT_AUDIOBUFFER:l(h);break;case a.AT_IMAGE_ELEMENT:e(h);break;case a.AT_AUDIO_ELEMENT:k(h);break;case a.AT_VIDEO_ELEMENT:d(h);break;default:throw"Wrong asset type: "+h.type;}}}function b(a,b){var d=h(),e=d&&a.filepath in d?new c:new XMLHttpRequest;e.open("GET",a.filepath,!0);"text"==b?(e.overrideMimeType("text/plain"),e.responseType="text"):"json"==b?(e.overrideMimeType("application/json"),e.responseType="text"):e.responseType=
b;e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState){if(200==e.status||0==e.status){var c=e.response;if(c){if("json"==b&&"string"==typeof c)try{c=JSON.parse(c)}catch(d){a.asset_cb(null,a.uri,a.type,a.filepath);w.error(d+" (parsing JSON "+a.filepath+")");return}a.asset_cb(c,a.uri,a.type,a.filepath)}else a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: empty responce when trying to get "+a.filepath)}else a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: "+e.status+
" when trying to get "+a.filepath);a.state=30}};e.addEventListener("progress",function(b){b.lengthComputable&&a.progress_cb(b.loaded/b.total)},!1);e.send(null)}function l(a){var b=h(),d=b&&a.filepath in b?new c:new XMLHttpRequest;d.open("GET",a.filepath,!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState)if(200==d.status||0==d.status){var b=d.response;b?B.decode_audio_data(b,function(b){a.asset_cb(b,a.uri,a.type,a.filepath);a.state=30},function(){a.asset_cb(null,
a.uri,a.type,a.filepath);w.error("B4W Error: failed to decode "+a.filepath);a.state=30}):(a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: empty responce when trying to get "+a.filepath),a.state=30)}else a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: "+d.status+" when trying to get "+a.filepath),a.state=30};d.send(null)}function e(a){var b=document.createElement("img");g.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath),
a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: could not load image: "+a.filepath),a.state=30)},!1);var c=h();if(c&&a.filepath in c)if(c[a.filepath]){var d=r(a.filepath);b.src="data:"+d+";base64,"+c[a.filepath]}else c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.filepath}function k(a){var b=document.createElement("audio");g.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=
a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: could not load sound: "+a.filepath),a.state=30)},!1);var c=h();if(c&&a.filepath in c)if(c[a.filepath]){var d=x(a.filepath);b.src="data:"+d+";base64,"+c[a.filepath];40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath),a.state=30)}else c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.filepath,g.is_mobile_device&&b.load();
setTimeout(function(){b.some_prop_to_prevent_gc=1},5E3)}function d(a){var b=document.createElement("video");b.muted=!0;if(g.allow_cors||g.is_mobile_device)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.uri,a.type,a.filepath),w.error("B4W Error: could not load video: "+a.filepath),a.state=30)},!1);var c=h();if(c&&a.filepath in c)if(c[a.filepath]){var d=
n(a.filepath);b.src="data:"+d+";base64,"+c[a.filepath];40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath),a.state=30)}else c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.filepath,g.is_mobile_device&&b.load();setTimeout(function(){b.some_prop_to_prevent_gc=1},1E4)}function r(a){var b="image";switch(q.get_file_extension(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function x(a){var b="audio";switch(q.get_file_extension(a).toLowerCase()){case "ogv":case "ogg":b+=
"/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function n(a){var b="video";switch(q.get_file_extension(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var t=p("__config"),w=p("__print"),B=p("__sfx"),q=p("__util"),s=p("__version"),y=t.assets,g=t.defaults;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.AT_VIDEO_ELEMENT=
70;var A=[],u=0,S={};a.split_extension=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.get_text_sync=function(a){if(S[a])return S[a];var b=y.prevent_caching?a+s.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return S[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=
0;a<A.length;a++)A[a].state=40;A=[];u=0;S={}};a.enqueue=function(a,b,c,d){for(var e=0;e<a.length;e++){var g=a[e],g={uri:g[0],type:g[1],filepath:g[2],name:g[3],state:10,asset_cb:b||function(){},pack_cb:c||function(){},progress_cb:d||function(){},pack_index:u};if(y.prevent_caching){var k=h();k&&g.filepath in k||(g.filepath+=s.timestamp())}A.push(g)}f(A);u++};a.update=function(){f(A);for(var a=A,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.pack_index===a[b].pack_index?30!==e.state&&(c=!1):(c&&(a[d-1].pack_cb(),
c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].pack_cb(),a.splice(b))}}};b4w.module.__geometry=function(a,p){function h(a){return 65536<a.base_length?S.get_elem_index_uint()?!1:!0:!1}function c(a){return 0<a.indices.length?!0:!1}function f(a,d,e){if(!c(a))return a;e||g.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.base_length*(d||1)+", will use drawArrays","color: #aa0");d=a.indices;e=a.base_length;var f=a.va_common,h=a.va_frames,k;for(k in f){var l=f[k],m=t(l,e);f[k]=b(d,l,m)}for(f=0;f<h.length;f++){var n=h[f];for(k in n)l=n[k],m=t(l,e),n[k]=
b(d,l,m)}a.base_length=d.length;a.indices=new Uint16Array(0);return a}function b(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],g=0;g<c;g++)d[c*e+g]=b[c*f+g];return d}function l(a,b){var c=a.vbo_array,d=a.pointers[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function e(b,c){var d,e;switch(c){case a.DM_DEFAULT:case a.DM_TRIANGLES:d=H.TRIANGLES;e=H.STATIC_DRAW;break;case a.DM_POINTS:d=
H.POINTS;e=H.STATIC_DRAW;break;case a.DM_DYNAMIC_TRIANGLES:d=H.TRIANGLES;e=H.DYNAMIC_DRAW;break;case a.DM_DYNAMIC_POINTS:d=H.POINTS;e=H.DYNAMIC_DRAW;break;case a.DM_LINES:d=H.LINES;e=H.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.usage=e}function k(a){a.ibo_array?(a.ibo||(a.ibo=H.createBuffer()),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.ibo),H.bufferData(H.ELEMENT_ARRAY_BUFFER,a.ibo_array,a.usage),a.debug_ibo_bytes=a.ibo_array.byteLength):a.debug_ibo_bytes=0;a.vbo||(a.vbo=H.createBuffer());
H.bindBuffer(H.ARRAY_BUFFER,a.vbo);H.bufferData(H.ARRAY_BUFFER,a.vbo_array,a.usage);a.debug_vbo_bytes=a.vbo_array.byteLength}function d(a){for(var b=u.create_empty_submesh("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].indices.length;b.indices=new Uint32Array(c);for(d=c=0;d<a.length;d++)c+=a[d].base_length;b.base_length=c;var e=a[0],f;for(f in e.va_common){for(d=c=0;d<a.length;d++)c+=a[d].va_common[f].length;b.va_common[f]=new Float32Array(c)}for(f in e.va_frames[0]){for(d=c=0;d<a.length;d++)c+=
a[d].va_frames[0][f].length;for(d=0;d<e.va_frames.length;d++)b.va_frames[d]=b.va_frames[d]||{},b.va_frames[d][f]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){f=a[e];for(var g=f.indices,h=f.base_length,k=f.va_common,l=0;l<g.length;l++)b.indices[c+l]=g[l]+d;var c=c+g.length,m;for(m in k){var g=k[m],n=d*t(g,h);b.va_common[m].set(g,n)}for(l=0;l<f.va_frames.length;l++){var k=f.va_frames[l],q=b.va_frames[l];for(m in k)g=k[m],n=d*t(g,h),q[m].set(g,n)}d+=h}return b}function r(a,b,c,d,e,h){var k=u.create_empty_submesh("SUBMESH_"+
a.name+"_"+b),l=a.submeshes[b],m=l.base_length,q=a.materials[b];k.base_length=m;if(x(c,"a_texcoord")){var r=null,t=a.materials[b];b=a.submeshes[b];if(t.texture_slots.length)switch(t=t.texture_slots[0],t.texture_coords){case "UV":t=a.uv_textures.indexOf(t.uv_layer);-1==t||0==t?r=new Float32Array(b.texcoord):1==t&&(r=new Float32Array(b.texcoord2));break;case "ORCO":for(var w=a.b4w_bounding_box,r=new Float32Array(2*b.base_length),t=(w.max_x+w.min_x)/2,p=(w.max_z+w.min_z)/2,B=w.max_x-w.min_x,w=w.max_z-
w.min_z,y=0,C=0;C<b.position.length;C+=3)r[y++]=(b.position[C]-t)/B+.5,r[y++]=(p-b.position[C+2])/w+.5}null===r&&(r=new Float32Array(b.texcoord));b=r}else b=new Float32Array(0);var J,r=l.group;if(x(c,"a_influence")&&d){t=new Float32Array(4*m);p=r.length/m;B=new Float32Array(p);for(w=0;w<p;w++)for(J in B[w]=-1,d)if(y=d[J],y.vgroup_index===w){B[w]=y.deform_bone_index;break}C=3<p?p:4;d=new Float32Array(C);J=new Uint32Array(C);for(var w=new Float32Array(4),y=new Float32Array(C),C=new Uint32Array(C),A=
new Float32Array(4),H=0;H<m;H++)d.set(y),J.set(C),w.set(A),t.set(n(r,p,H,m,B,d,J,w),4*H)}else t=new Float32Array(0);J=t;d=e?u.clone_object_r(e):{};d.a_color={generate_buffer:!0};x(c,"a_color")&&a.active_vcol_name?d.a_color.src=[{name:a.active_vcol_name,mask:7}]:d.a_color.src=[];e={a_texcoord:b,a_influence:J};J=l.vertex_colors;b=l.color;r=a.name;t=[];for(p=0;p<J.length;p++)t.push(J[p].name);for(var S in d)if(p=d[S].src,p.length){for(w=B=0;w<p.length;w++)B+=u.rgb_mask_get_channels_count(p[w].mask);
e[S]=new Float32Array(B*m);for(w=y=0;w<p.length;w++){var Y=p[w].name,C=p[w].mask,A=u.rgb_mask_get_channels_presence(C),ja=t.indexOf(Y);if(-1==ja)throw'B4W Error: vertex color "'+Y+'" for mesh "'+r+'" not found.';var H=J[ja].mask,E=u.rgb_mask_get_channels_count(H);(C&H)!==C&&g.error("B4W Error: Wrong color extraction from "+Y+" to "+S+".");for(var Y=J,ca=m,ua=0,ea=0;ea<ja;ea++)ua+=u.rgb_mask_get_channels_count(Y[ea].mask);Y=ua*ca;for(ja=0;ja<m;ja++)for(ca=0;3>ca;ca++)A[ca]&&(ua=y+u.rgb_mask_get_channel_presence_index(C,
ca),ea=u.rgb_mask_get_channel_presence_index(H,ca),e[S][ja*B+ua]=b[Y+ja*E+ea]);y+=E}}else e[S]=new Float32Array(0);S=a.uv_textures;d=l.texcoord;J=l.texcoord2;b=a.name;if(h)for(var ma in h){r=S.indexOf(ma);if(-1==r)throw'B4W Error: uv map "'+ma+'" for mesh "'+b+'" not found';if(0==r)var Aa=new Float32Array(d);else 1==r&&(Aa=new Float32Array(J));e[h[ma]]=Aa}k.va_common=e;k.indices=new Uint32Array(l.indices);h=l.position.length/m/3;Aa=(ma=x(c,"a_normal")&&l.normal.length?!0:!1)&&x(c,"a_tangent")&&l.tangent.length?
!0:!1;S=ma&&q.texture_slots.length&&x(c,"a_tangent")&&"ORCO"==q.texture_slots[0].texture_coords?!0:!1;for(e=0;e<h;e++){q={};d=new Float32Array(3*m);J=new Float32Array(ma?3*m:0);b=new Float32Array(Aa||S?4*m:0);r=e*m*3;t=r+3*m;d.set(l.position.subarray(r,t),0);ma&&(r=e*m*3,t=r+3*m,J.set(l.normal.subarray(r,t),0));if(Aa)r=e*m*4,t=r+4*m,b.set(l.tangent.subarray(r,t),0);else if(S)for(r=J,t=b,p=m,g.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+
a.name+'". Please add a UV-map.'),B=0;B<p;B++)w=v,y=K,w[0]=r[3*B],w[1]=r[3*B+1],w[2]=r[3*B+2],I.cross(w,u.AXIS_Z,y),0==I.length(y)&&I.cross(w,u.AXIS_X,y),I.normalize(y,y),t[4*B]=y[0],t[4*B+1]=y[1],t[4*B+2]=y[2],t[4*B+3]=1;else if(ma&&x(c,"a_tangent"))for(b=new Float32Array(4*m),e=0;e<b.length;e++)b[e]=1;q.a_position=d;q.a_normal=J;q.a_tangent=b;k.va_frames.push(q)}if(1<h){a=k.va_frames[0];var q={},O;for(O in a)q[O]=new Float32Array(a[O]);k.va_frames.push(q)}x(c,"a_polyindex")&&(f(k,1,!0),k.va_common.a_polyindex=
s(k));return k}function x(a,b){return-1<a.indexOf(b)?!0:!1}function n(a,b,c,d,e,f,g,h){for(var k=!0,l=0;l<b;l++){var m=a[l*d+c];if(-1!==m){var n=e[l];-1!==n&&(f[l]=m,g[l]=n,k=!1)}}if(k)return h;w(f,g,!1);for(l=a=0;4>l;l++)a+=f[l];if(.01>a)return h;for(l=0;4>l;l++)f[l]/=a;if(.01>Math.abs(f[0]-1))h[0]=g[0]+1;else for(l=0;4>l;l++)h[l]=g[l]+f[l];return h}function t(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+
b;return d}function w(a,b,c){var d=a.length,e=d,f=!1;for(c=c?-1:1;1<e||f;){1<e&&(e=Math.floor(e/1.247330950103979));for(var f=!1,g=0;e+g<d;g++)0>c*(a[g]-a[g+e])&&(f=a[g],a[g]=a[g+e],a[g+e]=f,f=b[g],b[g]=b[g+e],b[g+e]=f,f=!0)}}function B(a,b,c){var d=[],e=[];I.subtract(b,a,d);I.subtract(c,a,e);I.normalize(d,d);I.normalize(e,e);return Math.acos(I.dot(d,e))}function q(a,b,d){b||(b=[]);d=d?a.va_frames[0].a_normal:a.va_frames[0].a_position;if(c(a)){a=a.indices;for(var e=a.length/3,f=0;f<e;f++){var g=new Float32Array(9),
h=a[3*f];g[0]=d[3*h];g[1]=d[3*h+1];g[2]=d[3*h+2];h=a[3*f+1];g[3]=d[3*h];g[4]=d[3*h+1];g[5]=d[3*h+2];h=a[3*f+2];g[6]=d[3*h];g[7]=d[3*h+1];g[8]=d[3*h+2];b[f]=g}}else for(f=0;f<d.length;f++)g=new Float32Array(9),g[0]=d[9*f],g[1]=d[9*f+1],g[2]=d[9*f+2],g[3]=d[9*f+3],g[4]=d[9*f+4],g[5]=d[9*f+5],g[6]=d[9*f+6],g[7]=d[9*f+7],g[8]=d[9*f+8],b[f]=g;return b}function s(a){for(var b=new Float32Array(a.base_length),c=0;c<a.base_length;c++)b[c]=c%3;return b}function y(a,b,c){var d=I.dist(a,b);a=I.dist(a,c);b=I.dist(b,
c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var g=p("__print"),A=p("__tsr"),u=p("__util"),S=p("__extensions"),I=p("vec3"),v=new Float32Array(3),K=new Float32Array(3),m=new Float32Array(3);a.ZSORT_DISABLED=10;a.ZSORT_BACK_TO_FRONT=20;a.ZSORT_FRONT_TO_BACK=30;a.DM_TRIANGLES=10;a.DM_POINTS=20;a.DM_DYNAMIC_TRIANGLES=30;a.DM_DYNAMIC_POINTS=40;a.DM_LINES=50;a.DM_DEFAULT=a.DM_TRIANGLES;var H=null;a.setup_context=function(a){H=a};a.delete_buffers=function(a){var b=_buffers[a];H.deleteBuffer(b.ibo);H.deleteBuffer(b.vbo);
delete _buffers[a]};a.submesh_to_bufs_data=function(b,d,g,l){h(b)&&f(b);var m=b.indices,n=b.base_length,q=b.va_frames,u={},r;for(r in b.va_common)r in l&&!l[r].generate_buffer||(u[r]=b.va_common[r]);l={ibo_array:null,vbo_array:null,ibo_type:0,count:0,pointers:{},mode:0,usage:0,debug_ibo_bytes:0,debug_vbo_bytes:0,vbo:null,ibo:null,info_for_z_sort_updates:null};if(m.length)if(r=m.length,65536>=n)var s=new Uint16Array(m),w=H.UNSIGNED_SHORT;else s=new Uint32Array(m),w=H.UNSIGNED_INT;else r=n,s=null;var x=
0,v=q.length,p;for(p in q[0])var B=q[0][p],x=x+B.length*v;for(p in u)B=u[p],x+=B.length;p=new Float32Array(x);var x=0,v={},y;for(y in u){var C=u[y];if(B=C.length)p.set(C,x),v[y]={attribute_name:y,num_comp:t(C,n),offset:x,frames:1,length:B},x+=B}u=q.length;for(y in q[0])if(C=q[0][y],B=C.length,C=t(C,n),B){v[y]={num_comp:C,offset:x,frames:u,length:B};1<u&&(v[y+"_next"]={num_comp:C,offset:x+B,frames:u,length:B});for(var J=0;J<u;J++)C=q[J][y],p.set(C,x),x+=B}l.count=r;l.ibo_array=s;l.vbo_array=p;l.ibo_type=
w;l.pointers=v;e(l,g);k(l);d!=a.ZSORT_DISABLED&&c(b)&&(l.info_for_z_sort_updates={median_cache:new Float32Array(m.length),median_world_cache:new Float32Array(m.length),dist_cache:new Float32Array(m.length/3),type:d});return l};a.is_long_submesh=h;a.is_indexed=c;a.submesh_drop_indices=f;a.update_bufs_data_index_array=function(a,b,c){e(a,b);a.count=c.length;a.ibo_array=c;a.ibo_type=c instanceof Uint16Array?H.UNSIGNED_SHORT:H.UNSIGNED_INT;return a};a.update_bufs_data_array=function(a,b,c,d){var e=a.vbo_array,
f=a.pointers,g=f[b];if(g){if(c&&g.num_comp!=c)throw'Error: invalid num_comp for "'+b+'"';e.set(d,g.offset)}else e=e.length,g=new Float32Array(e+d.length),g.set(a.vbo_array),g.set(d,e),a.vbo_array=g,f[b]={num_comp:c,offset:e};k(a);return a};a.extract_array=l;a.make_static=function(a){a.usage=H.STATIC_DRAW};a.make_dynamic=function(a){a.usage=H.DYNAMIC_DRAW};a.update_gl_buffers=k;a.cleanup_bufs_data=function(a){a.ibo&&H.deleteBuffer(a.ibo);a.vbo&&H.deleteBuffer(a.vbo)};a.has_empty_submesh=function(a,
b){return a.submeshes[b].base_length?!1:!0};a.submesh_apply_transform=function(a,b){for(var c=0;c<a.va_frames.length;c++){var d=a.va_frames[c].a_position;A.transform_vectors(d,b,d,0);d=a.va_frames[c].a_normal;0<d.length&&A.transform_dir_vectors(d,b,d,0);d=a.va_frames[c].a_tangent;0<d.length&&A.transform_tangents(d,b,d,0)}(c=a.va_common.au_center_pos)&&c.length&&A.transform_vectors(c,b,c,0);return a};a.submesh_apply_particle_transform=function(a,b){var c=a.va_common.au_center_pos;if(c&&c.length){var d=
new Float32Array(c);A.transform_vectors(d,b,d,0);for(var e=0;e<a.va_frames.length;e++)for(var f=0;f<d.length;f++)a.va_frames[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';return a};a.submesh_apply_params=function(a,b){var c=a.base_length,d;for(d in b){var e=b[d].length;a.va_common[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var g=0;g<e;g++)a.va_common[d][f*e+g]=b[d][g]}return a};a.submesh_list_join=d;a.make_clone_submesh=function(a,
b,c){if(!a.base_length)return u.create_empty_submesh("EMPTY");var d=c.length;65536<a.base_length*d&&!S.get_elem_index_uint()&&f(a,d);var e=a.indices,g=a.base_length,h=a.va_common;a=a.va_frames;for(var k in b){var l=b[k].length,m=l*g;h[k]=new Float32Array(m);for(var n=0;n<g;n++)for(m=0;m<l;m++)h[k][n*l+m]=b[k][m]}b=u.create_empty_submesh("CLONE_"+d+"_SUBMESHES");b.base_length=g*d;b.indices=new Uint32Array(e.length*d);for(n=0;n<d;n++)for(l=e.length*n,k=g*n,m=0;m<e.length;m++)b.indices[l+m]=e[m]+k;for(var q in h)for(e=
h[q],m=e.length*d,l=t(e,g),b.va_common[q]=new Float32Array(m),n=0;n<d;n++)k=g*l*n,b.va_common[q].set(e,k);for(q in a[0])for(n=0;n<a.length;n++)for(e=a[n][q],m=e.length*d,l=t(e,g),b.va_frames[n]=b.va_frames[n]||{},b.va_frames[n][q]=new Float32Array(m),m=0;m<d;m++)switch(h=c[m],k=g*l*m,q){case "a_position":A.transform_vectors(e,h,b.va_frames[n][q],k);break;case "a_normal":A.transform_dir_vectors(e,h,b.va_frames[n][q],k);break;case "a_tangent":A.transform_tangents(e,h,b.va_frames[n][q],k);break;default:throw"Wrong attribute name: "+
q;}return b};a.extract_submesh=r;a.extract_halo_submesh=function(a){var b=a.base_length,c=a.va_frames[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.indices.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=
.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=u.create_empty_submesh("HALO");c.va_frames=[];c.va_frames[0]={};c.base_length=4*b;c.va_frames[0].a_position=d;c.va_common.a_halo_bb_vertex=e;c.indices=a;return c};a.has_attr=x;a.extract_submesh_all_mats=function(a,b){for(var c=[],e=0;e<a.submeshes.length;e++){var f=r(a,e,b,null,null,null);f.base_length&&c.push(f)}return 0==c.length?u.create_empty_submesh("EMPTY"):1==c.length?
c[0]:d(c)};a.update_buffers_movable=function(a,b,c){for(var d=a.ibo_array,e=l(a,"a_position"),f=a.info_for_z_sort_updates,g=f.median_cache,h=f.median_world_cache,f=f.dist_cache,k=d,m=k.length/3,n=0;n<m;n++){var q=k[3*n],r=k[3*n+1],s=k[3*n+2],t=e[3*q+1],w=e[3*q+2],C=e[3*r+1],J=e[3*r+2],x=e[3*s+1],v=e[3*s+2];g[3*n]=(e[3*q]+e[3*r]+e[3*s])/3;g[3*n+1]=(t+C+x)/3;g[3*n+2]=(w+J+v)/3}u.positions_multiply_matrix(g,b,h);b=g.length/3;for(e=0;e<b;e++)h=g[3*e]-c[0],k=g[3*e+1]-c[1],m=g[3*e+2]-c[2],f[e]=h*h+k*k+
m*m;c=d;d=f.length;if(!(2>d))for(g=d,e=!1;1<g||e;)for(1<g&&(g=Math.floor(g/1.247330950103979)),e=!1,b=0;g+b<d;b++)0>f[b]-f[b+g]&&(e=f[b],f[b]=f[b+g],f[b+g]=e,e=c,h=b,k=b+g,m=e[3*h],n=e[3*h+1],q=e[3*h+2],e[3*h]=e[3*k],e[3*h+1]=e[3*k+1],e[3*h+2]=e[3*k+2],e[3*k]=m,e[3*k+1]=n,e[3*k+2]=q,e=!0);d=c;H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.ibo);H.bufferData(H.ELEMENT_ARRAY_BUFFER,d,H.DYNAMIC_DRAW)};a.sort_two_arrays=w;a.calc_normals=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],g=Array(3),h=Array(3),
k=Array(3),l=0;l<e;l++){for(var m=a[3*l],n=a[3*l+1],q=a[3*l+2],u=0;3>u;u++)g[u]=b[3*m+u],h[u]=b[3*n+u],k[u]=b[3*q+u];if(c)var u=B(g,h,k),r=B(h,k,g),s=Math.PI-u-r;else s=r=u=1;var C=f,t;t=g;var w=k,x=[],v=[],p=[];I.subtract(h,t,x);I.subtract(w,t,v);I.cross(x,v,p);I.normalize(p,p);t=p;for(w=0;3>w;w++)x=3*n+w,v=3*q+w,C[3*m+w]=u*t[w],C[x]=r*t[w],C[v]=s*t[w]}if(c)for(var y in c)for(l=c[y],a=0;3>a;a++){b=3*l[0]+a;for(e=1;e<l.length;e++)g=3*l[e]+a,f[b]+=f[g];for(e=1;e<l.length;e++)g=3*l[e]+a,f[g]=f[b]}for(l=
0;l<d;l++){c=l;y=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=y[e];I.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,y[e]=a[b]}return f};a.calc_shared_indices=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var g=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[g]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],g=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),g in d&&d[g].push(b);return d};a.geometry_random_points=function(a,b,c,d){var e=q(a,null,!1);if(c)var f=q(a,null,!0);var g=e.length,h=new Float32Array(g),
k=v,l=K;for(a=0;a<g;a++){var n=e[a];k.set(n.subarray(0,3));l.set(n.subarray(3,6));m.set(n.subarray(6));h[a]=Math.sqrt(y(k,l,m))}k=new Float32Array(g);k[0]=h[0];for(a=1;a<g;a++)k[a]=k[a-1]+h[a];g=k[h.length-1];h=[];for(a=0;a<b;a++){var l=g*u.rand_r(d),l=u.binary_search_max(k,l,0,k.length-1),n=c?f[l]:e[l],l=a,r=n,s=d,n=void 0,n=new Float32Array(3),t=r[0],w=r[1],x=r[2],C=r[3],J=r[4],p=r[5],B=r[6],A=r[7],H=r[8],r=u.rand_r(s),s=u.rand_r(s);1<r+s&&(r=1-r,s=1-s);var I=1-r-s,w=I*w+r*J+s*A,x=I*x+r*p+s*H;n[0]=
I*t+r*C+s*B;n[1]=w;n[2]=x;h[l]=n}return h};a.extract_triangles=q;a.extract_polyindices=s;a.triangle_area_squared=y;a.get_plane_normal=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],g=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*h;d[1]=f*b-e*a;d[2]=e*h-g*f;return d};a.scale_submesh_xyz=function(a,b,c){a=a.va_frames[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__primitives=function(a,p){function h(a,b,c,f){for(var h=[],k=[],l=[],q=[],s=2*c/(a-1),p=2*f/(b-1),g=0;g<a;g++)for(var A=-c+g*s,u=0;u<b;u++)if(k.push(A,0,-f+u*p),l.push(0,1,0),q.push(g/(a-1),u/(b-1)),g&&u){var S=g*b+u,I=S-1,v=(g-1)*b+u,K=v-1;h.push(S,I,v);h.push(I,K,v)}a=e.create_empty_va_frame();a.a_position=new Float32Array(k);a.a_normal=new Float32Array(l);l=e.create_empty_submesh("GRID_PLANE");l.va_frames[0]=a;l.va_common.a_texcoord=new Float32Array(q);l.indices=new Uint32Array(h);
l.base_length=k.length/3;return l}function c(a){var c=a.length;if(c%4)throw"Wrong array";for(var f=[],h=[],k=0;k<c;k+=4){var l=a[k+1],p=a[k+2],q=a[k+3];b(a[k],h);b(l,h);b(p,h);b(q,h);f.push(k,k+1,k+2);f.push(k,k+2,k+3)}a=e.create_empty_va_frame();a.a_position=new Float32Array(h);c=e.create_empty_submesh("FROM_QUADS");c.va_frames[0]=a;c.indices=new Uint32Array(f);c.base_length=h.length/3;return c}function f(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function b(a,b){b.push(a[0],a[1],a[2])}var l=p("__geometry"),
e=p("__util"),k=p("__config").defaults;a.generate_lines=function(a){for(var b=e.create_empty_submesh("LINE"),c=[],f=0;f<2*a;f++)c.push(f);f=e.create_empty_va_frame();f.a_point=new Float32Array(c);b.va_frames[0]=f;b.indices=new Uint32Array(c);b.base_length=2*a;return b};a.generate_plane=function(a,b){var c=h(2,2,a,b);c.name="PLANE";return c};a.generate_grid=h;a.generate_multigrid=function(a,b,c){function f(a,b){return 1==a%2&&(0==b||b==q-1)||1==b%2&&(0==a||a==p-1)?!0:!1}var h=c/=Math.pow(2,a-1),w=
c,p=b+1,q=b+1;b=[];c=[];for(var s=0,y=0,g=-1,A=[],u=0;u<a;u++){for(var S=2*h/(p-1),I=2*w/(q-1),v=[],K=[],m=0,H=0;H<p;H++){for(var D=-h+H*S,U=[],P=0;P<q;P++){var Z=-w+P*I;if(D>-s&&D<s&&Z>-y&&Z<y)U.push(-1),m++;else{for(var V=null,M=0;M<A.length;M+=3)if(D==A[M]&&Z==A[M+1]){V=A[M+2];break}M=null!==V?V:g+1;f(H,P)?(U.push(-2),m++):(null==V&&(0==P||P==q-1||0==H||H==p-1?(V=u==a-1?S:2*S,v.push(D,Z,M)):V=S,c.push(D,V,Z),g++),U.push(M));if(H&&P)if(1==H)if(f(H-1,P)){if(1<P){var Z=M-1,V=K[H-1][P+1],Q=V-1;b.push(M,
Z,Q)}else V=K[H-1][P+1],Q=V-1;b.push(M,Q,V)}else f(H,P)||(Z=M-1,V=K[H-1][P],b.push(M,Z,V));else if(H==p-1){if(!f(H,P))if(P==q-1)Z=M-1,V=K[H-1][P-1],Q=K[H-2][P],b.push(M,Z,V),b.push(M,V,Q);else{var Z=M-1,V=K[H-1][P],Q=V-1,T=V+1;b.push(M,Z,Q);b.push(M,Q,V);b.push(M,V,T);2==P&&(T=K[H-2][P-2],b.push(Z,T,Q))}}else 1==P?f(H,P-1)?(Z=K[H-1][P],V=K[H-1][P-1],b.push(M,V,Z)):(Z=U[P-1],V=K[H-1][P],Q=K[H-2][P-1],b.push(M,Z,V),b.push(Z,Q,V)):P==q-1?f(H,P)||(Z=U[P-1],V=K[H-1][P-1],Q=K[H-2][P],b.push(M,Z,V),b.push(M,
V,Q)):-1!=K[H-1][P]&&-1!=K[H-1][P-1]&&-1!=U[P-1]?(Z=U[P-1],V=K[H-1][P],Q=K[H-1][P-1],b.push(M,Z,V),b.push(Z,Q,V),P==q-2&&f(H,P+1)&&(T=K[H-1][P+1],b.push(M,V,T))):P==q-2&&f(H,P+1)&&(V=K[H-1][P],T=K[H-1][P+1],b.push(M,V,T))}}K.push(U)}A=v;s=h;y=w;h*=2;w*=2}2E4>s&&(a=-(2*s)/(p-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-s,a,-y),c.push(-s,a,y),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(s,a,-y),c.push(s,a,y),M=g+1,b.push(M+3,M+2,M+1,M+2,M+0,M+1,M+6,M+4,M+2,M+4,M+0,M+2,M+5,M+7,M+1,M+7,M+3,M+1,M+
5,M+4,M+7,M+7,M+4,M+6));a=e.create_empty_va_frame();a.a_position=new Float32Array(c);h=e.create_empty_submesh("multigrid_plane");h.va_frames[0]=a;h.indices=new Uint32Array(b);h.base_length=c.length/3;k.water_wireframe_debug&&(l.submesh_drop_indices(h,1,!0),a.a_polyindex=l.extract_polyindices(h));return h};a.generate_from_triangles=function(a){var c=a.length;if(c%3)throw"Wrong array";for(var f=[],h=[],k=0;k<c;k+=3){var l=a[k+1],p=a[k+2];b(a[k],h);b(l,h);b(p,h);f.push(k,k+1,k+2)}a=e.create_empty_va_frame();
a.a_position=new Float32Array(h);c=e.create_empty_submesh("FROM_TRIANGLES");c.va_frames[0]=a;c.indices=new Uint32Array(f);c.base_length=h.length/3;return c};a.generate_from_quads=c;a.generate_frustum=function(a){a=e.vectorize(a,[]);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.generate_fullscreen_quad=function(){var a=e.create_empty_submesh("BILLBOARD"),
b=e.create_empty_va_frame();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,1,2,3]);a.base_length=4;return a};a.generate_billboard=function(){var a=e.create_empty_submesh("BILLBOARD"),b=e.create_empty_va_frame();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_cube=function(){var a=e.create_empty_submesh("CUBEMAP_BOARD"),b=e.create_empty_va_frame();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_uv_sphere=function(a,c,h,k,t,w){var p=e.create_empty_submesh("UV_SPHERE"),q,s,y=[],g=[],A=[];for(s=0;s<=c;s++)for(q=0;q<=a;q++){var u=q/a,S=s/c,I=-h*Math.cos(2*u*Math.PI)*Math.sin(S*Math.PI),v=h*Math.cos(S*Math.PI),u=h*Math.sin(2*u*Math.PI)*Math.sin(S*Math.PI);t&&(I=1E-5>Math.abs(I)?0:I,v=1E-5>Math.abs(v)?0:v,u=1E-5>Math.abs(u)?0:u);g.push(I+k[0],v+k[1],
u+k[2])}for(s=t=0;s<c;s++)for(q=0;q<a;q++)I=f(g,(a+1)*s+q+1),v=f(g,(a+1)*s+q),u=f(g,(a+1)*(s+1)+q),S=f(g,(a+1)*(s+1)+q+1),Math.abs(I[1])==h+k[1]?(b(I,y),b(u,y),b(S,y),w?A.push(t,t+1,t+1,t+2,t+2,t):A.push(t,t+1,t+2),t+=3):Math.abs(u[1])==h+k[1]?(b(I,y),b(v,y),b(u,y),w?A.push(t,t+1,t+1,t+2,t+2,t):A.push(t,t+1,t+2),t+=3):(b(I,y),b(v,y),b(u,y),b(S,y),w?(A.push(t,t+1),A.push(t+1,t+2),A.push(t+2,t+3),A.push(t+3,t)):(A.push(t,t+1,t+2),A.push(t,t+2,t+3)),t+=4);a={};a.a_position=y;w?a.a_normal=[]:(w=l.calc_shared_indices(A,
g,y),a.a_normal=l.calc_normals(A,y,w));a.a_tangent=[];p.va_common.a_influence=[];p.va_common.a_color=[];p.va_common.a_texcoord=[];p.va_frames[0]=a;p.indices=A;p.base_length=y.length/3;return p}};b4w.module.__particles=function(a,p){function h(a,b,c,d,e,f,h){var l=a._internal.delay_attrs,r=a._internal.emitter_tsr_snapshots,t=a._internal.time;a=a._internal.prev_time;for(var v=b?4:1,p=0;p<l.length;p+=v){var m=l[p];if(m>a&&m<=t)for(m=0;8>m;m++)r[8*p+m]=e[m];for(m=0;8>m;m++)x[m]=r[8*p+m];m=n;m[0]=c[3*p];m[1]=c[3*p+1];m[2]=c[3*p+2];k.transform_vec3(m,x,m);f[3*p]=m[0];f[3*p+1]=m[1];f[3*p+2]=m[2];var H=n;H[0]=d[3*p];H[1]=d[3*p+1];H[2]=d[3*p+2];k.transform_dir_vec3(H,x,H);h[3*p]=H[0];h[3*p+1]=H[1];
h[3*p+2]=H[2];if(b)for(m=1;4>m;m++)f[3*(p+m)]=f[3*p],f[3*(p+m)+1]=f[3*p+1],f[3*(p+m)+2]=f[3*p+2],h[3*(p+m)]=H[0],h[3*(p+m)+1]=H[1],h[3*(p+m)+2]=H[2]}}function c(a){a?(e.srand(a),t=function(){return e.rand()}):t=function(){return Math.random()}}var f=p("__config"),b=p("__geometry"),l=p("__scenes"),e=p("__util"),k=p("__tsr"),d=p("vec3"),r=f.animation,x=new Float32Array(8),n=new Float32Array(3),t=function(){throw"_rand() undefined";};a.has_particles=function(a){return 0<a.particle_systems.length?!0:
!1};a.has_anim_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.has_hair_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.has_dynamic_grass_particles=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.generate_emitter_particles_submesh=
function(a,f,l,n,x){l._internal=l._internal||{};var g=b.extract_submesh_all_mats(f,["a_position","a_normal"],!1);n=l.settings.count;var p=l.settings.frame_start/r.framerate,u=l.settings.frame_end/r.framerate,S=l.settings.lifetime/r.framerate,I=l.settings.lifetime_random,v=l.settings.emit_from,K=l.settings.factor_random,m=l.settings.angular_velocity_mode,H=l.settings.angular_velocity_factor,D=l.settings.b4w_randomize_emission,U=l.settings.b4w_cyclic;c(l.seed);var P=l._internal.use_world_space="WORLD"==
l.settings.b4w_coordinate_system?!0:!1;l._internal.frame=0;if(f=!a.halo_particles){var Z;Z=[];for(var V=0;V<n;V++)Z.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);Z=new Float32Array(Z);for(var V=[],M=0;M<n;M++)V.push(4*M,4*M+2,4*M+1,4*M,4*M+3,4*M+2);V=new Uint16Array(V)}switch(v){case "VERT":for(var M=g.va_frames[0].a_position,g=g.va_frames[0].a_normal,Q=M.length/3,v=[],T=0;T<n;T++){var X=Math.round((Q-1)*t());v.push(X);f&&(v.push(X),v.push(X),v.push(X))}Q=[];for(T=0;T<v.length;T++)Q.push(M[3*v[T]]),Q.push(M[3*
v[T]+1]),Q.push(M[3*v[T]+2]);M=new Float32Array(Q);Q=[];for(T=0;T<v.length;T++)Q.push(g[3*v[T]]),Q.push(g[3*v[T]+1]),Q.push(g[3*v[T]+2]);v=new Float32Array(Q);break;case "FACE":M=[];v=[];T=[];e.init_rand_r_seed(0,T);Q=b.geometry_random_points(g,n,!1,T);e.init_rand_r_seed(0,T);g=b.geometry_random_points(g,n,!0,T);for(T=0;T<Q.length;T++)M.push(Q[T][0],Q[T][1],Q[T][2]),f&&(M.push(Q[T][0],Q[T][1],Q[T][2]),M.push(Q[T][0],Q[T][1],Q[T][2]),M.push(Q[T][0],Q[T][1],Q[T][2])),v.push(g[T][0],g[T][1],g[T][2]),
f&&(v.push(g[T][0],g[T][1],g[T][2]),v.push(g[T][0],g[T][1],g[T][2]),v.push(g[T][0],g[T][1],g[T][2]));M=new Float32Array(M);v=new Float32Array(v);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}v=[M,v];g=v[0];v=v[1];l._internal.positions=new Float32Array(g);l._internal.normals=new Float32Array(v);l._internal.positions_cache=new Float32Array(g.length);l._internal.normals_cache=new Float32Array(v.length);l._internal.time=0;l._internal.prev_time=
-1;M=[];u=(u-p)/n;for(Q=0;Q<n;Q++)T=D?u*Q+10*u*(.5-t()):u*Q,U||(T+=p),M.push(T),f&&(M.push(T),M.push(T),M.push(T));p=new Float32Array(M);l._internal.delay_attrs=new Float32Array(p);l._internal.delay_attrs_masked=new Float32Array(p);l._internal.emitter_tsr_snapshots=new Float32Array(8*p.length);for(D=0;D<8*p.length;D++)for(U=0;8>U;U++)l._internal.emitter_tsr_snapshots[8*D+U]=x[U];P?h(l,f,g,v,x,g,v):(k.transform_vectors(g,x,g,0),k.transform_dir_vectors(v,x,v,0));l=[];x=S*I;for(I=0;I<n;I++)P=x*t(),l.push(S-
P),f&&(l.push(S-P),l.push(S-P),l.push(S-P));S=new Float32Array(l);l=[];for(x=0;x<n;x++){I=[t()-.5,t()-.5,t()-.5];d.normalize(I,I);l.push(K*I[0]);l.push(K*I[1]);l.push(K*I[2]);switch(m){case "NONE":l.push(0);break;case "SPIN":case "VELOCITY":l.push(H);break;case "RAND":l.push(2*H*(t()-.5));break;default:throw"Undefined velocity factor";}if(f)for(I=l.slice(-4),P=0;12>P;P++)l.push(I[P%4])}n=new Float32Array(l);K=e.create_empty_submesh("EMITTER_PARTICLES");m=e.create_empty_va_frame();m.a_position=g;m.a_normal=
v;K.va_frames[0]=m;f?K.indices=V:(a.draw_mode=b.DM_POINTS,K.indices=new Uint16Array(0));K.base_length=g.length/3;K.va_common.a_p_delay=p;K.va_common.a_p_lifetime=S;K.va_common.a_p_vels=n;f&&(K.va_common.a_p_bb_vertex=Z);return K};a.update_emitter_transform=function(a){for(var c=a._batches,d=0;d<c.length;d++){var e=c[d],f=c[d].particle_system;if(f){var g=e.bufs_data,l=f._internal.positions_cache,n=f._internal.normals_cache,r=f._internal.positions,t=f._internal.normals;f._internal.use_world_space?h(f,
!e.halo_particles,r,t,a._render.tsr,l,n):(e=t,f=a._render.tsr,t=n,k.transform_vectors(r,f,l,0),k.transform_dir_vectors(e,f,t,0));b.make_dynamic(g);b.update_bufs_data_array(g,"a_position",3,l);b.update_bufs_data_array(g,"a_normal",3,n)}}};a.set_emitter_particles_uniforms=function(a,b,c){var d=b.settings.lifetime/r.framerate,e=b.settings.normal_factor,f=9.81*b.settings.effector_weights.gravity,h=b.settings.effector_weights.wind,k=b.settings.mass,n=b.settings.b4w_fade_in/r.framerate,t=b.settings.b4w_fade_out/
r.framerate,x=b.settings.b4w_cyclic;a.p_length=b.settings.frame_end/r.framerate-b.settings.frame_start/r.framerate;a.p_cyclic=x?1:0;a.p_nfactor=e;a.p_gravity=f;e=l.get_wind();a.p_wind[0]=e[0]*h;a.p_wind[1]=e[1]*h;a.p_wind[2]=e[2]*h;a.p_max_lifetime=d;a.p_mass=k;a.p_fade_in=n;a.p_fade_out=t;a.halo_particles?(d=c.halo.size,h=c.halo.hardness,30>h?(h=.5,k=.9):40>h?(h=.1,k=1):50>h?(h=0,k=.8):(h=0,k=.5)):(d=b.settings.particle_size,k=h=1);a.p_size=d;a.p_alpha_start=h;a.p_alpha_end=k;d=b.settings.texture_slots;
b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;h=Math.min(2*d.length,b.length);for(k=0;k<h;k+=2)n=d[k/2],b[k]=n.position,b[k+1]=(n.color[0]+n.color[1]+n.color[2])/3;a.p_size_ramp_length=d.length}a.p_size_ramp.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;
h=Math.min(4*d.length,c.length);for(k=0;k<h;k+=4)n=d[k/4],c[k]=n.position,c[k+1]=n.color[0],c[k+2]=n.color[1],c[k+3]=n.color[2];a.p_color_ramp_length=d.length}a.p_color_ramp.set(c)};a.set_time=function(a,b){a._internal.prev_time=a._internal.time;a._internal.time=b};a.prepare_lens_flares=function(a){for(var b=a.base_length,c=a.va_frames[0].a_position,d=a.va_common.a_texcoord,e=[],f=[],h=0;h<b;h++)f.push(c[3*h]),f.push(c[3*h+1]),e.push(c[3*h+2]);e=new Float32Array(e);f=new Float32Array(f);a.va_common.a_lf_dist=
e;a.va_common.a_lf_bb_vertex=f;a.va_common.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a._batches;for(var d=0;d<a.length;d++){var e=a[d],f=e.particle_system;f&&f.name==b&&(e.p_size=c)}};a.set_normal_factor=function(a,b,c){a=a._batches;for(var d=0;d<a.length;d++){var e=a[d],f=e.particle_system;f&&f.name==b&&(e.p_nfactor=c)}};a.set_factor=function(a,c,d){a=a._batches;for(var e=0;e<a.length;e++){var f=a[e],g=f.particle_system;if(g&&g.name==c){var h=g._internal.delay_attrs;if(1==d)g=h;else if(0==
d)for(var k=!f.halo_particles,l=k?4:1,g=g._internal.delay_attrs_masked,n=0;n<g.length;n+=l)g[n]=1E4,k&&(g[n+1]=g[n],g[n+2]=g[n],g[n+3]=g[n]);else for(var r=1/d,g=g._internal.delay_attrs_masked,l=(k=!f.halo_particles)?4:1,t=0,n=0;n<g.length;n+=l)n>=t?(g[n]=h[n],t+=r):g[n]=1E4,k&&(g[n+1]=g[n],g[n+2]=g[n],g[n+3]=g[n]);b.update_bufs_data_array(f.bufs_data,"a_p_delay",1,g)}}};a.update_start_pos=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==e.settings.type)for(var f=
e._internal.delay_attrs,d=0;d<8*f.length;d++)e._internal.emitter_tsr_snapshots[8*d]=b[0],e._internal.emitter_tsr_snapshots[8*d+1]=b[1],e._internal.emitter_tsr_snapshots[8*d+2]=b[2],e._internal.emitter_tsr_snapshots[8*d+3]=b[3],e._internal.emitter_tsr_snapshots[8*d+4]=c[0],e._internal.emitter_tsr_snapshots[8*d+5]=c[1],e._internal.emitter_tsr_snapshots[8*d+6]=c[2],e._internal.emitter_tsr_snapshots[8*d+7]=c[3]}}};b4w.module.__textures=function(a,p){function h(){return{name:"",type:0,source:"",width:0,height:0,compress_ratio:1,allow_node_dds:!0,source_size:1024,canvas_context:null,video_file:null,is_movie:!1,frame_start:0,frame_offset:0,frame_duration:0,use_auto_refresh:!1,use_cyclic:!1,movie_length:0,fps:0,w_target:0,w_texture:null,w_renderbuffer:null}}function c(b,c,d){var e=b.type,k=new Uint8Array([204,204,204,255]),l=h();switch(e){case "DATA_TEX2D":case "IMAGE":var q=g.createTexture(),x=g.TEXTURE_2D;g.bindTexture(x,
q);g.texImage2D(x,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,k);b.image&&"MOVIE"==b.image.source&&(l.is_movie=!0,l.frame_start=b.frame_start,l.frame_offset=b.frame_offset,l.frame_duration=b.frame_duration,l.use_auto_refresh=b.use_auto_refresh,l.use_cyclic=b.use_cyclic,l.movie_length=b.movie_length,0!=l.frame_offset&&r.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":q=g.createTexture();x=g.TEXTURE_2D;g.bindTexture(x,
q);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(d=t.keysearch("name",b.b4w_source_id,d)))l.offscreen_scene=d,l.source_size=b.b4w_source_size,d._render_to_texture=!0,g.texImage2D(x,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":q=g.createTexture();x=g.TEXTURE_CUBE_MAP;g.bindTexture(x,q);d="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var p=0;6>p;p++)g.texImage2D(g["TEXTURE_CUBE_MAP_"+
d[p]],0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,k);break;case "VORONOI":case "BLEND":return null;default:return r.error('B4W warning: texture "'+b.name+'" has unsupported type "'+e+'"'),null}"NONE"==e||"DATA_TEX2D"==e?g.texParameteri(x,g.TEXTURE_MIN_FILTER,g.LINEAR):g.texParameteri(x,g.TEXTURE_MIN_FILTER,A[w.texture_min_filter]);g.texParameteri(x,g.TEXTURE_MAG_FILTER,g.LINEAR);k=x;d=b.b4w_anisotropic_filtering;"DEFAULT"===d&&(d=c);"OFF"!==d&&w.anisotropic_filtering&&(c=n.get_aniso())&&(d=parseFloat(d.split("x")[0]),
g.texParameterf(k,c.TEXTURE_MAX_ANISOTROPY_EXT,d));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(g.texParameteri(x,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(x,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)):(g.texParameteri(x,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(x,g.TEXTURE_WRAP_T,g.REPEAT));l.type=a.TT_RGBA_INT;l.width=1;l.height=1;l.w_texture=q;l.w_target=x;"CANVAS"==b.b4w_source_type&&"NONE"==e?(e=b.b4w_source_id,q=b.b4w_source_size,l.name=e,l.source="CANVAS",x=document.createElement("canvas"),
x.setAttribute("id",e),x.width=q,x.height=q,l.canvas_context=x.getContext("2d"),s[e]=l,f(l)):(l.name=b.name,l.source=e,g.generateMipmap(x),g.bindTexture(x,null));return b._render=l}function f(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.w_target;g.bindTexture(b,a.w_texture);var c=e(a),d=k(a),f=a.canvas_context.canvas;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texImage2D(b,0,c,c,d,f);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);g.bindTexture(b,null);a.width=f.width;a.height=f.height}function b(a){g.texParameteri(a,
g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(a,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(a,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(a,g.TEXTURE_MIN_FILTER,g.LINEAR)}function l(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function e(b){switch(b.type){case a.TT_RGBA_INT:b=g.RGBA;break;case a.TT_RGB_INT:b=g.RGB;break;case a.TT_RGBA_FLOAT:b=g.RGBA;break;case a.TT_RGB_FLOAT:b=g.RGB;break;case a.TT_DEPTH:b=g.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function k(b){switch(b.type){case a.TT_RGBA_INT:b=g.UNSIGNED_BYTE;break;case a.TT_RGB_INT:b=g.UNSIGNED_BYTE;break;case a.TT_RGBA_FLOAT:b=g.FLOAT;break;case a.TT_RGB_FLOAT:b=g.FLOAT;break;case a.TT_DEPTH:b=g.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}var d=p("__config"),r=p("__print"),x=p("__dds"),n=p("__extensions"),t=p("__util"),w=d.defaults,B=d.animation,q=d.sfx;a.TF_NEAREST=0;a.TF_LINEAR=0;a.TF_NEAREST_MIPMAP_NEAREST=0;a.TF_LINEAR_MIPMAP_NEAREST=
0;a.TF_NEAREST_MIPMAP_LINEAR=0;a.TF_LINEAR_MIPMAP_LINEAR=0;a.TT_RGBA_INT=10;a.TT_RGB_INT=20;a.TT_RGBA_FLOAT=30;a.TT_RGB_FLOAT=40;a.TT_DEPTH=50;a.TT_RENDERBUFFER=60;var s={},y={},g=null,A;a.setup_context=function(b){A=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.TF_NEAREST=b.NEAREST;a.TF_LINEAR=b.LINEAR;a.TF_NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST;a.TF_LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST;a.TF_NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;
a.TF_LINEAR_MIPMAP_LINEAR=b.LINEAR_MIPMAP_LINEAR;g=b};a.get_canvas_context=function(a){return a in s?s[a].canvas_context:null};a.update_canvas_context=function(a){return a in s?(f(s[a]),!0):!1};a.create_texture=function(b,c){var d=h();d.name=b;d.type=c;d.source="NONE";if(c==a.TT_RENDERBUFFER)d.w_renderbuffer=g.createRenderbuffer();else{var e=g.TEXTURE_2D,f=g.createTexture();g.bindTexture(e,f);g.texParameteri(e,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(e,
g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(e,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.bindTexture(e,null);d.w_target=e;d.w_texture=f}return d};a.create_cubemap_texture=function(b,c){var d=g.createTexture(),e=g.TEXTURE_CUBE_MAP;g.bindTexture(e,d);g.texParameteri(e,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(e,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
k=0;6>k;k++)g.texImage2D(g[f[k]],0,g.RGBA,c,c,0,g.RGBA,g.UNSIGNED_BYTE,null);g.bindTexture(e,null);e=h();e.name=b;e.type=a.TT_RGBA_INT;e.source="NONE";e.width=3*c;e.height=2*c;e.compress_ratio=1;e.w_texture=d;e.w_target=g.TEXTURE_CUBE_MAP;return e};a.set_filters=function(b,c,d){if(b.type!=a.TT_RENDERBUFFER){var e=b.w_target;g.bindTexture(e,b.w_texture);c&&g.texParameteri(e,g.TEXTURE_MIN_FILTER,c);d&&g.texParameteri(e,g.TEXTURE_MAG_FILTER,d);g.bindTexture(e,null)}};a.get_filters=function(b){if(b.type==
a.TT_RENDERBUFFER)return{min:a.TF_NEAREST,mag:a.TF_NEAREST};var c=b.w_target;g.bindTexture(c,b.w_texture);b=g.getTexParameter(c,g.TEXTURE_MIN_FILTER);var d=g.getTexParameter(c,g.TEXTURE_MAG_FILTER);g.bindTexture(c,null);return{min:b,mag:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.TT_RENDERBUFFER)g.bindRenderbuffer(g.RENDERBUFFER,b.w_renderbuffer),g.renderbufferStorage(g.RENDERBUFFER,g.DEPTH_COMPONENT16,c,d),g.bindRenderbuffer(g.RENDERBUFFER,
null);else{var f=b.w_target;g.bindTexture(f,b.w_texture);var h=e(b),l=k(b);g.texImage2D(f,0,h,c,d,0,h,l,null);g.bindTexture(f,null)}c>w.max_texture_size||d>w.max_texture_size?r.error("B4W warning: texture has unsupported size",filepath):(b.width=c,b.height=d)}};a.create_texture_bpy=c;a.update_video_texture=function(a){var b=a.w_target;g.bindTexture(b,a.w_texture);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);4!=a.video_file.length?g.texImage2D(b,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,a.video_file):g.texImage2D(b,
0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,a.video_file);g.bindTexture(b,null)};a.update_texture=function(a,c,d,e){var f=a.source,h=a.w_target;g.bindTexture(h,a.w_texture);if(4==c.length){var k=!0;c=new Uint8Array([255*c[0],255*c[1],255*c[2],255*c[3]])}if("IMAGE"==f)if(k)g.texImage2D(h,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,c),a.width=1,a.height=1;else if(d){d=x.get_width_height(c);if(d.width>w.max_texture_size||d.height>w.max_texture_size){r.error("B4W warning: texture has unsupported size",e);return}x.upload_dds_levels(g,
n.get_s3tc(),c,!0);l(d.width,d.height)&&(a.auxilary_texture||r.warn("B4W warning: using NPOT-texture",e),b(h));a.width=d.width;a.height=d.height;a.compress_ratio=x.get_compress_ratio(c)}else{g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);if(c.width>w.max_texture_size||c.height>w.max_texture_size){r.error("B4W warning: texture has unsupported size",e);return}a.is_movie?(a.video_file=c,a.video_file.loop=a.use_cyclic,y[a.name]=a,a.fps=B.framerate,c.duration&&(a.fps=a.movie_length/c.duration),q.disable_playback_rate_hack||
(c.playbackRate=B.framerate/a.fps,q.clamp_playback_rate_hack&&2<c.playbackRate&&(c.playbackRate=2))):g.texImage2D(h,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,c);a.width=c.width;a.height=c.height;l(c.width,c.height)?(a.auxilary_texture||r.warn("B4W warning: using NPOT-texture",e),b(h)):g.generateMipmap(h)}else if("ENVIRONMENT_MAP"==f)if(d=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],k){for(k=0;6>k;k++)f=d[k],g.texImage2D(g["TEXTURE_CUBE_MAP_"+
f[0]],0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,c);a.width=3;a.height=2}else{g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);var t=c.width/3;if(t>w.max_cube_map_size||t>w.max_cube_map_size){r.error("B4W warning: cubemap has unsupported size",e);return}for(k=0;6>k;k++){var f=d[k],s=document.createElement("canvas");s.width=t;s.height=t;var p=s.getContext("2d");"POSITIVE_Y"==f[0]||"NEGATIVE_Y"==f[0]?(p.translate(0,t),p.scale(1,-1)):(p.translate(t,0),p.scale(-1,1));p.drawImage(c,f[1]*t,f[2]*t,t,t,0,0,t,t);g.texImage2D(g["TEXTURE_CUBE_MAP_"+
f[0]],0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,s)}a.width=3*t;a.height=2*t;l(c.width/3,c.height/2)?(r.warn("B4W warning: using NPOT cube map texture",e),b(h)):g.generateMipmap(h)}else"DATA_TEX2D"==f&&(g.texImage2D(h,0,g.RGBA,c.width,c.height,0,g.RGBA,g.UNSIGNED_BYTE,c.data),a.width=c.width,a.height=c.height);g.bindTexture(h,null)};a.delete_texture=function(a){g.deleteTexture(a)};a.is_texture=function(a){return a&&a.name&&(a.w_texture||a.w_renderbuffer)?!0:!1};a.is_renderbuffer=function(a){return a&&a.name&&
a.w_renderbuffer?!0:!1};a.is_float=function(b){return b.type==a.TT_RGBA_FLOAT||b.type==a.TT_RGB_FLOAT?!0:!1};a.get_texture_channel_size=function(b){var c=0;switch(b.type){case a.TT_RGBA_INT:case a.TT_RGB_INT:c=4;break;case a.TT_RGBA_FLOAT:case a.TT_RGB_FLOAT:c=16;break;case a.TT_DEPTH:c=3;break;case a.TT_RENDERBUFFER:c=2}return c};a.generate_texture=function(a,b){var d=null;switch(a){case "SSAO_TEXTURE":d={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"},
c(d,null,b),d.image={filepath:null}}return d};a.cleanup=function(){s={};y={}};a.play_video=function(a){return a in y?(y[a].video_file.play(),!0):null};a.stop_video=function(a){return a in y?(y[a].video_file.pause(),!0):null};a.pause=function(){for(var a in y)y[a].video_file&&y[a].video_file.pause()};a.play=function(){for(var a in y)y[a].video_file&&y[a].video_file.play()}};b4w.module.__dds=function(a,p){function h(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),h=0,k=0,g=0,l=k=h=0,r=0,p=0,I=0,v=c/4;d/=4;for(var K=0;K<d;K++)for(var m=0;m<v;m++)g=b+4*(K*v+m),e[0]=a[g],e[1]=a[g+1],h=e[0]&31,k=e[0]&2016,l=e[0]&63488,r=e[1]&31,p=e[1]&2016,I=e[1]&63488,e[2]=5*h+3*r>>3|5*k+3*p>>3&2016|5*l+3*I>>3&63488,e[3]=5*r+3*h>>3|5*p+3*k>>3&2016|5*I+3*l>>3&63488,h=a[g+2],k=4*K*c+4*m,f[k]=e[h&3],f[k+1]=e[h>>2&3],f[k+2]=e[h>>4&3],f[k+3]=e[h>>6&3],k+=c,f[k]=e[h>>8&3],f[k+1]=e[h>>
10&3],f[k+2]=e[h>>12&3],f[k+3]=e[h>>14],h=a[g+3],k+=c,f[k]=e[h&3],f[k+1]=e[h>>2&3],f[k+2]=e[h>>4&3],f[k+3]=e[h>>6&3],k+=c,f[k]=e[h>>8&3],f[k+1]=e[h>>10&3],f[k+2]=e[h>>12&3],f[k+3]=e[h>>14];return f}function c(a,b,c,f){var p=new Int32Array(c,0,31),q,s,y,g,A,u;if(542327876!=p[0])return e.error("Invalid magic number in DDS header"),0;if(!p[20]&4)return e.error("Unsupported format, must contain a FourCC code"),0;q=p[21];switch(q){case k:s=8;y=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case d:s=16;y=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case r:s=16;y=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return e.error("Unsupported FourCC code:",l(q)),null}u=1;p[2]&131072&&!1!==f&&(u=Math.max(1,p[7]));g=p[4];A=p[3];p=p[1]+4;if(b)for(q=0;q<u;++q)f=Math.max(4,g)/4*Math.max(4,A)/4*s,b=new Uint8Array(c,p,f),a.compressedTexImage2D(a.TEXTURE_2D,q,y,g,A,0,b),p+=f,g=Math.max(.5*g,1),A=Math.max(.5*A,1);else if(q==k)Math.max(4,g),Math.max(4,A),b=new Uint16Array(c),c=h(b,p/2,g,A),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,g,A,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),f&&a.generateMipmap(a.TEXTURE_2D);else return e.error("No manual decoder for",l(q),"and no native support"),0;return u}function f(a,b,d,e,f,h){var k=new XMLHttpRequest;k.open("GET",d,!0);k.responseType="arraybuffer";k.onload=function(){if(200==k.status){a.bindTexture(a.TEXTURE_2D,e);var d=c(a,b,k.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(e)};k.send(null);return e}function b(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var e=p("__print"),k=b("DXT1"),d=b("DXT3"),r=b("DXT5");a.dxt_to_rgb_565=h;a.upload_dds_levels=c;a.get_width_height=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.get_compress_ratio=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case d:case r:b=
4;break;default:e.error("Unsupported FourCC code:",l(a))}return b};a.load_dds_texture_ex=f;a.load_dds_texture=function(a,b,c,d){var e=a.createTexture();f(a,b,c,e,!0,d);return e}};b4w.module.__loader=function(a,p){function h(b,d,e,f,h){var k=q,l=t.create(),r;for(r in d){var x=c(d[r]);(f&&x.is_resource||!b&&x.primary_only)&&n(x);t.append_node_attr(l,x)}for(r in d)for(x=d[r],x.name=r,b=0;b<x.inputs.length;b++)t.append_edge_attr(l,d[x.inputs[b]],x,null);d=c({name:"out",priority:a.FINISH_PRIORITY,cb_before:function(a,b,c,d,e,f){0===b.id&&(k.primary_loaded=!0);3!=b.status&&(b.status=2);h(b.id);e(b,c);w.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")}});var m=[];if(e)for(e=
t.get_sink_nodes(l),b=0;b<e.length;b++)m.push(t.get_node_attr(l,e[b]));else t.traverse(l,function(a,b){b.background_loading||m.push(b)});t.append_node_attr(l,d);for(b=0;b<m.length;b++)d.inputs.push(m[b].name),t.append_edge_attr(l,m[b],d,null);return l}function c(a){a.background_loading=a.background_loading||!1;a.priority||0===a.priority||(a.priority=a.SYNC_PRIORITY);a.inputs=a.inputs||[];a.is_finished=a.is_finished||!1;a.skip=a.skip||!1;a.relative_size=a.relative_size||0;a.is_resource=a.is_resource||
!1;a.primary_only=a.primary_only||!1;a.status=0;a.loop_index=0;a.load_rate=0;a.cb_param=a.cb_param||null;return a}function f(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];t.get_node_attr(a.stage_graph,f).is_finished&&(t.traverse_outputs(a.stage_graph,f,function(d,e,f){var h=!0;t.traverse_inputs(a.stage_graph,d,function(a,b,c){if(!b.is_finished)return h=!1,1});h&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function b(a){var b=
[],c=a.stages_queue,d=!1;do{var e=f(a,c);b.push.apply(b,c);0<e.length&&(d=!0);c=e}while(0<e.length);c=function(b,c){var d=t.get_node_attr(a.stage_graph,b),e=t.get_node_attr(a.stage_graph,c),f=e.priority-d.priority;0==f&&(f=d.background_loading-e.background_loading);return f};d&&b.sort(c);a.stages_queue=b;return a.stages_queue.length}function l(a,b,c){if(b.skip)return b.is_finished=!0,k(a,b),!1;if(!b.cb_before&&!b.cb_loop&&!b.cb_after)return k(a,b),!1;if(0==b.status&&(b.status++,b.cb_before))return b.cb_before(c,
a,b,b.cb_param,k,d),!0;if(1==b.status){if(b.cb_loop)return b.cb_loop(c,a,b,b.cb_param,k,d),!0;b.status++}return 2==b.status&&(b.status++,b.cb_after)?(b.cb_after(c,a,b,b.cb_param,k,d),!0):!1}function e(a){if(0==a.stages_size_total)return 100;var b=0;t.traverse(a.stage_graph,function(c,d){a.do_not_load_resources&&d.is_resource||(b+=d.load_rate*d.relative_size)});return B.trunc(100*b/a.stages_size_total)}function k(a,b){b.is_finished=!0;b.status=3;r(a,b,1)}function d(a,b,c){1>c?r(a,b,c):b.status++}function r(a,
b,c){var d=q;if(b.cb_before||b.cb_loop||b.cb_after)if(b.load_rate=c,b=e(a),a.curr_percents!=b||1==c)a.stageload_cb(b,performance.now()-a.time_load_start),a.curr_percents=b,d.make_idle_iteration=!0}function x(a,b){var c=null;t.traverse(a.stage_graph,function(a,d){if(d.name==b)return c=d,1});return c}function n(a){a.skip=!0;a.load_rate=1}var t=p("__graph"),w=p("__print"),B=p("__util");a.SYNC_PRIORITY=0;a.ASYNC_PRIORITY=1;a.FINISH_PRIORITY=2;var q=null;a.get_scheduler=function(){return q};a.create_scheduler=
function(){var a={threads:[],current_thread_index:0,active_threads:0,primary_loaded:!1,make_idle_iteration:!1};return q=a};a.create_thread=function(a,b,c,d,e,f,k,l){var n=q,m={id:n.threads.length,status:0,filepath:b,binary_name:"",load_hidden:l||!1,wait_complete_loading:f,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:d||function(){},complete_load_cb:e||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1};
a=h(0===m.id,a,f,k,c||function(){});m.stage_graph=a;b=[];c=t.get_source_nodes(a);for(d=0;d<c.length;d++)b.push(c[d]);m.stages_queue=b;t.traverse(a,function(a,b){if(b.cb_before||b.cb_loop||b.cb_after)m.do_not_load_resources&&b.is_resource||(m.stages_size_total+=b.relative_size)});n.threads.push(m);n.active_threads++;return m.id};a.update_scheduler=function(c){var d=q,e;(e=!d)||(e=0==q.active_threads);if(!e)if(d.make_idle_iteration)d.make_idle_iteration=!1;else{e=performance.now();do{var f=d.threads[d.current_thread_index],
h=c[f.id];if(3!=f.status)if(0==f.status&&(f.status=1,f.time_load_start=performance.now(),f.stageload_cb(0,0)),b(f)){var k=f,n=k.stages_queue.length;do{var r=t.get_node_attr(k.stage_graph,k.stages_queue[0]),x=l(k,r,h);r.priority==a.ASYNC_PRIORITY&&(k.reset_time_cycle=!0);r=k.stages_queue.shift();k.stages_queue.push(r);n--}while(!x&&0!=n)}else f.complete_load_cb(h,f),f.status=3,d.active_threads--,k=f,k.stageload_cb=null,k.complete_load_cb=null,k.stage_graph=null,k.stages_queue=null;d.primary_loaded&&
(d.current_thread_index=(d.current_thread_index+1)%d.threads.length);if(f.reset_time_cycle){f.reset_time_cycle=!1;break}}while(16>performance.now()-e)}};a.stage_part_finish_cb=d;a.skip_stage_by_name=function(a,b){var c=x(a,b);null!==c&&n(c)};a.thread_is_finished=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=q;if(!b)return!1;a|=0;return b.threads[a]&&(3==b.threads[a].status||2==b.threads[a].status)};a.cleanup=function(){q=null}};b4w.module.__camera=function(a,p){function h(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function c(b){var c;c={type:b,name:"",size_mult:1,width:0,height:0,framebuffer:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,near:0,far:0,left:0,right:0,top:0,bottom:0,eye:new Float32Array(3),eye_last:new Float32Array(3),quat:new Float32Array(4),
view_matrix:new Float32Array(16),billboard_view_matrix:new Float32Array(16),proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),shadow_cast_billboard_view_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,dof_on:0,frustum_planes:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,
0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,0,0,0])},stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,csm_radii:null,csm_center_dists:new Float32Array(4),pcf_blur_radii:new Float32Array(4)};if(b==a.TYPE_NONE)return c;switch(b){case a.TYPE_PERSP:l(c,40,.1,1E3);break;case a.TYPE_ORTHO:l(c,2.5,.1,1E3);break;case a.TYPE_PERSP_ASPECT:break;case a.TYPE_ORTHO_ASPECT:break;case a.TYPE_ORTHO_ASYMMETRIC:break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:throw"Stereo camera may only be created from perspective one";
default:throw"Unknown camera type";}return c}function f(b,c,d){if(b.type!=a.TYPE_STEREO_LEFT&&b.type!=a.TYPE_STEREO_RIGHT)throw"set_stereo_params(): wrong camera type";b.stereo_conv_dist=c;b.stereo_eye_dist=d;B(b,b.aspect);if(H.check_active())for(c=H.get_active(),b=c._render.shadow_params,c=c.camera._render.cameras,d=0;d<c.length;d++)A(c[d],b)}function b(a,b){var c=a._render,d=D.quat_to_dir(c.quat,D.AXIS_MY,X),e=Math.asin(d[1]/U.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?D.quat_to_dir(c.quat,
D.AXIS_MZ,z):D.quat_to_dir(c.quat,D.AXIS_Z,z)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function l(b,c,d,e,f){switch(b.type){case a.TYPE_PERSP:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:b.fov=c;b.aspect=1;break;case a.TYPE_ORTHO:b.top=c;b.aspect=1;break;case a.TYPE_PERSP_ASPECT:delete b.fov;b.fov=c;b.aspect=f/c;break;case a.TYPE_ORTHO_ASPECT:b.top=c;b.aspect=f/c;break;default:m.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=
d;b.far=e}function e(b,c){var d=c._render.trans,e=c._render.quat,f=fa;M.rotateX(c._render.world_matrix,-Math.PI/2,f);M.invert(f,b.view_matrix);if(b.reflection_plane){var f=b.reflection_plane[0],g=b.reflection_plane[1],h=b.reflection_plane[2],k=b.reflection_plane[3],l=fa;l[0]=1-2*f*f;l[1]=-2*f*g;l[2]=-2*f*h;l[3]=0;l[4]=-2*f*g;l[5]=1-2*g*g;l[6]=-2*g*h;l[7]=0;l[8]=-2*f*h;l[9]=-2*g*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*f*k;l[13]=-2*g*k;l[14]=-2*h*k;l[15]=1;M.multiply(b.view_matrix,l,b.view_matrix);B(b,b.aspect,
!0);f=W;g=fa;M.invert(b.view_matrix,g);M.transpose(g,g);P.transformMat4(b.reflection_plane,g,f);g=L;g[0]=(D.sign(f[0])+b.proj_matrix[8])/b.proj_matrix[0];g[1]=(D.sign(f[1])+b.proj_matrix[9])/b.proj_matrix[5];g[2]=-1;g[3]=(1+b.proj_matrix[10])/b.proj_matrix[14];P.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.proj_matrix[2]=f[0];b.proj_matrix[6]=f[1];b.proj_matrix[10]=f[2]+1;b.proj_matrix[14]=f[3]}b.type==a.TYPE_STEREO_LEFT?b.view_matrix[12]+=b.stereo_eye_dist/2:b.type==a.TYPE_STEREO_RIGHT&&
(b.view_matrix[12]-=b.stereo_eye_dist/2);M.multiply(b.proj_matrix,b.view_matrix,b.view_proj_matrix);s(b);q(b);U.copy(b.eye,b.eye_last);U.copy(d,b.eye);Z.copy(e,b.quat)}function k(b,c,d,e){M.lookAt(c,d,e,b.view_matrix);b.type==a.TYPE_STEREO_LEFT?b.view_matrix[12]+=b.stereo_eye_dist/2:b.type==a.TYPE_STEREO_RIGHT&&(b.view_matrix[12]-=b.stereo_eye_dist/2);M.multiply(b.proj_matrix,b.view_matrix,b.view_proj_matrix);s(b);q(b);U.copy(c,b.eye)}function d(b){b=b._render;if(b.horizontal_limits){var c=X;b.move_style==
a.MS_TARGET_CONTROLS?U.subtract(b.trans,b.pivot,c):D.quat_to_dir(b.quat,D.AXIS_MY,c);c[1]=0;U.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.move_style==a.MS_EYE_CONTROLS&&(d*=-1);b.horizontal_limits.left+=d;b.horizontal_limits.right+=d}}function r(b){b=b._render;if(b.vertical_limits){var c=X;b.move_style==a.MS_TARGET_CONTROLS?U.subtract(b.trans,b.pivot,c):D.quat_to_dir(b.quat,D.AXIS_MY,c);U.normalize(c,c);c=Math.asin(c[1]);b.vertical_limits.up+=c;b.vertical_limits.down+=c}}function x(a){a=
a._render;if(a.horizontal_limits)if(a.vertical_limits){var b=D.angle_wrap_0_2pi(a.vertical_limits.up+Math.PI/2),c=D.angle_wrap_0_2pi(a.vertical_limits.down+Math.PI/2);if(c>Math.PI)a.vertical_limits={down:-Math.PI/2,up:Math.PI/2};else if(b>Math.PI||b<c)a.vertical_limits.up=Math.PI/2}else a.vertical_limits={down:-Math.PI/2,up:Math.PI/2}}function n(a){a=D.quat_to_dir(a._render.quat,D.AXIS_MY,X);U.normalize(a,a);return-Math.asin(a[1])}function t(a,b,c){if(b==c)return c-a;a=D.angle_wrap_0_2pi(a);b=D.angle_wrap_0_2pi(b);
c=D.angle_wrap_0_2pi(c);if(.001>Math.abs(b-c))return 0;b=2*Math.PI-b;c=D.angle_wrap_0_2pi(c+b);a=D.angle_wrap_0_2pi(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function w(a,b,c){a=a._render;var d=U.subtract(a.pivot,a.trans,X);b=Z.setAxisAngle(b,c,ia);U.transformQuat(d,b,d);U.subtract(a.pivot,d,a.trans);Z.multiply(b,a.quat,a.quat)}function B(b,c,d){switch(b.type){case a.TYPE_PERSP:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_PERSP_ASPECT:M.perspective(D.rad(b.fov),b.aspect,b.near,b.far,
b.proj_matrix);break;case a.TYPE_ORTHO:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_ORTHO_ASPECT:c=b.top*b.aspect;M.ortho(-c,c,-b.top,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:M.ortho(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:if(!c)throw"No aspect ratio";b.aspect=c;var e=Math.tan(b.fov*Math.PI/360);c=b.near*e;var f=b.aspect*b.stereo_conv_dist*e;b.type==a.TYPE_STEREO_LEFT?(e=f-b.stereo_eye_dist/
2,f+=b.stereo_eye_dist/2):(e=f+b.stereo_eye_dist/2,f-=b.stereo_eye_dist/2);e=-(b.near/b.stereo_conv_dist*e);f*=b.near/b.stereo_conv_dist;M.frustum(e,f,-c,c,b.near,b.far,b.proj_matrix);b.left=e;b.right=f;break;case a.TYPE_NONE:return;default:throw"Wrong camera type: "+b.type;}d||(M.multiply(b.proj_matrix,b.view_matrix,b.view_proj_matrix),s(b),q(b))}function q(a){M.copy(a.view_matrix,a.sky_vp_inv_matrix);a.sky_vp_inv_matrix[12]=0;a.sky_vp_inv_matrix[13]=0;a.sky_vp_inv_matrix[14]=0;a.sky_vp_inv_matrix[15]=
1;M.multiply(a.proj_matrix,a.sky_vp_inv_matrix,a.sky_vp_inv_matrix);M.invert(a.sky_vp_inv_matrix,a.sky_vp_inv_matrix)}function s(a){M.copy(a.view_matrix,a.view_proj_inv_matrix);M.multiply(a.proj_matrix,a.view_proj_inv_matrix,a.view_proj_inv_matrix);M.invert(a.view_proj_inv_matrix,a.view_proj_inv_matrix)}function y(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.near);d||(d=b.far);var g,h,k,l,m,n,q,r;switch(b.type){case a.TYPE_NONE:throw"Extraction from NONE camera is not possible";case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:g=
c*Math.tan(b.fov*Math.PI/360);l=-g;h=g*b.aspect;k=-h;m=d/c*g;r=-m;n=m*b.aspect;q=-n;break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:k=b.top*b.aspect;g=m=b.top;h=n=k;l=r=-b.top;k=q=-k;break;case a.TYPE_ORTHO_ASYMMETRIC:g=m=b.top;h=n=b.right;l=r=b.bottom;k=q=b.left;break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:m=c/b.near;g=c*Math.tan(b.fov*Math.PI/360);l=-g;h=b.right*m;k=b.left*m;q=d/c;m=g*q;r=-m;n=h*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=h;e[4]=
l;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=k;e[10]=g;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=fa,M.invert(b.view_matrix,c),D.positions_multiply_matrix(e,c,e,0));return e}function g(a){return"CAMERA"===a.type?!0:!1}function A(a,b){if(b.b4w_enable_csm){var c=b.csm_num;if(!a.csm_centers){var d=b.csm_num;a.csm_centers=Array(d);for(var e=0;e<d;e++)a.csm_centers[e]=new Float32Array(3);a.csm_radii=new Float32Array(d)}for(d=0;d<c;d++){var e=
0==d?a.near:u(b,a,d-1),f=u(b,a,d),e=y(a,e,f,da),e=I.get_frustum_mec(e);a.csm_centers[d].set(e.center);a.csm_radii[d]=e.radius;a.csm_center_dists[d]=U.length(e.center);a.pcf_blur_radii[d]=S(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.pcf_blur_radii[0]=b.first_cascade_blur_radius}function u(a,b,c){var d=a.csm_num,e=D.clamp(a.csm_first_cascade_border,b.near,b.far);a=D.clamp(a.csm_last_cascade_border,b.near,b.far);c=S(e,a,d,c);return D.clamp(c,b.near,b.far)}function S(a,b,c,d){switch(d){case 0:break;
case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var I=p("__boundings"),v=p("__config"),K=p("__constraints"),m=p("__print"),H=p("__scenes"),D=p("__util"),U=p("vec3"),P=p("vec4"),Z=p("quat"),V=p("mat3"),M=p("mat4"),Q=v.controls;a.TYPE_NONE=10;a.TYPE_PERSP=20;a.TYPE_ORTHO=30;a.TYPE_PERSP_ASPECT=40;a.TYPE_ORTHO_ASPECT=50;a.TYPE_ORTHO_ASYMMETRIC=60;a.TYPE_STEREO_LEFT=70;a.TYPE_STEREO_RIGHT=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=
4;var T=new Float32Array(2),X=new Float32Array(3),z=new Float32Array(3),ia=new Float32Array(4);new Float32Array(4);var W=new Float32Array(4),L=new Float32Array(4),G=new Float32Array(16),fa=new Float32Array(16),da=new Float32Array(24);a.camera_object_to_camera=function(b){var e=b._render,f=b.data;switch(f.type){case "PERSP":var g=c(a.TYPE_PERSP);if(f.angle_y)var k=f.angle_y/Math.PI*180;l(g,k,f.clip_start,f.clip_end);break;case "ORTHO":g=c(a.TYPE_ORTHO),l(g,f.ortho_scale/2,f.clip_start,f.clip_end)}g.name=
b.name;e.trans_speed=Q.cam_trans_base_speed.slice();e.underwater=!1;e.move_style=h(f.b4w_move_style);e.dof_distance=b.data.dof_distance;e.dof_object=b.data.dof_object;e.dof_front=b.data.b4w_dof_front;e.dof_rear=b.data.b4w_dof_rear;e.dof_power=b.data.b4w_dof_power;e.enable_hover_hor_rotation=b.data.b4w_enable_hover_hor_rotation;e.cameras=[g];e.move_style==a.MS_TARGET_CONTROLS&&e.pivot.set(f.b4w_target);e=b._render;if(e.move_style===a.MS_TARGET_CONTROLS||e.move_style===a.MS_EYE_CONTROLS||e.move_style===
a.MS_HOVER_CONTROLS)f=b.data,e.move_style===a.MS_TARGET_CONTROLS||e.move_style===a.MS_EYE_CONTROLS?(f.b4w_use_horizontal_clamping&&(e.horizontal_limits={left:f.b4w_rotation_left_limit,right:f.b4w_rotation_right_limit}),f.b4w_use_vertical_clamping&&(e.vertical_limits={down:f.b4w_rotation_down_limit,up:f.b4w_rotation_up_limit}),"LOCAL"==f.b4w_horizontal_clamping_type&&d(b),"LOCAL"==f.b4w_vertical_clamping_type&&r(b),x(b),f.b4w_use_panning&&(e.use_panning=f.b4w_use_panning)):e.move_style===a.MS_HOVER_CONTROLS&&
(f.b4w_use_horizontal_clamping&&f.b4w_horizontal_translation_min<=f.b4w_horizontal_translation_max&&(e.horizontal_limits={left:f.b4w_horizontal_translation_min,right:f.b4w_horizontal_translation_max}),f.b4w_use_vertical_clamping&&f.b4w_vertical_translation_min<=f.b4w_vertical_translation_max&&(e.vertical_limits={down:-f.b4w_vertical_translation_max,up:-f.b4w_vertical_translation_min}),f.b4w_use_distance_limits&&f.b4w_hover_angle_min<=f.b4w_hover_angle_max&&(e.hover_angle_limits={down:f.b4w_hover_angle_min,
up:f.b4w_hover_angle_max})),e.use_distance_limits=f.b4w_use_distance_limits&&f.b4w_distance_min<=f.b4w_distance_max,e.use_distance_limits&&(e.distance_min=f.b4w_distance_min,e.distance_max=f.b4w_distance_max);e=b._render;if(e.move_style===a.MS_HOVER_CONTROLS&&e.use_distance_limits)if(e.hover_angle_limits){if(f=n(b),g=D.quat_to_dir(e.quat,D.AXIS_Z,X),b=0,0<g[1]&&(b-=Math.asin(g[1]/U.len(g))),f>e.hover_angle_limits.up?b+=f-e.hover_angle_limits.up:f<e.hover_angle_limits.down&&(b+=e.hover_angle_limits.down-
f),(b||0>f)&&m.warn("B4W Warning: Active hover camera has wrong orientation"),b&&(f=D.quat_to_dir(e.quat,D.AXIS_X,z),b=Z.setAxisAngle(f,-b,ia),Z.normalize(b,b),Z.multiply(b,e.quat,e.quat)),b=D.quat_to_dir(e.quat,D.AXIS_MY,X),f=W,f.set(D.AXIS_Y),f[3]=0,b=D.line_plane_intersect(f,0,e.trans,b,e.hover_pivot),!b||100<U.len(b))e.hover_pivot[0]=e.trans[0],e.hover_pivot[1]=0,e.hover_pivot[2]=e.trans[2]}else e.use_distance_limits=!1};a.create_camera=c;a.check_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.color_attachment);
case "DEPTH":return Boolean(a.depth_attachment);case "SCREEN":return!Boolean(a.color_attachment)&&!Boolean(a.depth_attachment);default:throw"Wrong attachment type: "+b;}};a.set_attachment=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.color_attachment=c;break;case "DEPTH":a.depth_attachment=c;break;case "SCREEN":a.color_attachment=null;a.depth_attachment=null;break;default:throw"Wrong attachment type: "+b;}};a.get_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.color_attachment;
case "DEPTH":return a.depth_attachment;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.make_stereo=function(b,c){if(b.type!=a.TYPE_PERSP||c!=a.TYPE_STEREO_LEFT&&c!=a.TYPE_STEREO_RIGHT)throw"make_stereo(): wrong camera type";b.type=c;f(b,6,.065)};a.set_stereo_params=f;a.rotate_h=function(a,b){var c=a._render.quat,d=ia,e=X;e[0]=0;e[1]=1;e[2]=0;Z.setAxisAngle(e,b,d);Z.multiply(d,c,c)};a.rotate_v=function(a,b){var c=a._render.quat,d=ia,e=X;e[0]=1;e[1]=0;e[2]=0;Z.setAxisAngle(e,
b,d);Z.multiply(d,c,c)};a.rotate_h_local=function(a,b){var c=a._render.quat;Z.invert(c,c);var d=ia,e=X;e[0]=0;e[1]=0;e[2]=1;Z.setAxisAngle(e,-b,d);Z.multiply(d,c,c);Z.invert(c,c)};a.rotate_v_local=function(a,b){var c=a._render.quat;Z.invert(c,c);var d=ia,e=X;e[0]=1;e[1]=0;e[2]=0;Z.setAxisAngle(e,-b,d);Z.multiply(d,c,c);Z.invert(c,c)};a.get_angles=b;a.set_frustum=l;a.set_frustum_asymmetric=function(b,c,d,e,f,g,h){switch(b.type){case a.TYPE_ORTHO_ASYMMETRIC:b.left=c;b.right=d;b.bottom=e;b.top=f;b.near=
g;b.far=h;break;default:m.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a._render.move_style};a.set_view=e;a.set_view_eye_target_up=k;a.set_view_trans_quat=function(a,b,c){var d=X;d[0]=0;d[1]=-1;d[2]=0;U.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=z;e[0]=0;e[1]=0;e[2]=-1;U.transformQuat(e,c,e);k(a,b,d,e)};a.set_camera_trans_quat=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a._render;a.trans.set(b);a.quat.set(c)};
a.eye_target_up_to_trans_quat=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];M.lookAt(a,b,c,fa);M.invert(fa,fa);M.rotateX(fa,Math.PI/2,fa);V.fromMat4(fa,G);Z.fromMat3(G,e)};a.update_camera_transform=function(a){var b=a._render.cameras;if(!b)throw"Wrong object";for(var c=a._render,d=0;d<b.length;d++){var f=b[d];e(f,a);D.extract_frustum_planes(f.view_proj_matrix,f.frustum_planes);if(f.dof_object)if(f.dof_on){var g=U.dist(c.trans,f.dof_object.location);f.dof_distance=g}else f.dof_distance=0}};a.update_camera=
function(b){var c=b._render;if(c.move_style==a.MS_TARGET_CONTROLS)if(c.use_distance_limits){if(K.rotate_to_limits(c.trans,c.quat,c.pivot,c.distance_min,K.CONS_ROTATE_LIMIT)){var d=U.subtract(c.trans,c.pivot,X);U.scale(d,-c.distance_min/U.length(d),d);U.add(c.pivot,d,c.trans)}}else K.rotate_to(c.trans,c.quat,c.pivot);c.move_style!=a.MS_TARGET_CONTROLS&&c.move_style!=a.MS_EYE_CONTROLS||K.correct_up(b,D.AXIS_Y)};a.horizontal_limits_local_to_world=d;a.vertical_limits_local_to_world=r;a.vertical_limits_correct=
x;a.clamp_limits=function(c){var d=c._render;if(d.move_style===a.MS_TARGET_CONTROLS||d.move_style===a.MS_EYE_CONTROLS){if(d.horizontal_limits){var e=d.horizontal_limits.left,f=d.horizontal_limits.right,g=b(c,T),g=g[0],g=d.move_style==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=t(g,e,f))d.move_style==a.MS_TARGET_CONTROLS?w(c,D.AXIS_Y,g):(g=Z.setAxisAngle(D.AXIS_MY,g,ia),Z.multiply(g,c._render.quat,c._render.quat))}d.vertical_limits&&(e=d.vertical_limits.down,f=d.vertical_limits.up,g=b(c,T),g=g[1],d.move_style==
a.MS_TARGET_CONTROLS&&(g*=-1),g=0<D.quat_to_dir(d.quat,D.AXIS_Z,X)[1]?D.sign(g)*Math.PI-g:g,g=t(g,e,f))&&(d.move_style==a.MS_TARGET_CONTROLS?(e=D.quat_to_dir(c._render.quat,D.AXIS_MX,z),w(c,e,g)):(e=g,g=c._render,f=D.quat_to_dir(g.quat,D.AXIS_X,X),e=Z.setAxisAngle(f,e,ia),Z.multiply(e,g.quat,g.quat)));d.move_style===a.MS_TARGET_CONTROLS&&d.use_distance_limits&&(g=c._render,e=U.subtract(g.trans,g.pivot,X),f=U.length(e),f>g.distance_max?(U.scale(e,g.distance_max/f,e),U.add(g.pivot,e,g.trans)):f<g.distance_min&&
(f=D.quat_to_dir(g.quat,D.AXIS_MY,z),U.scale(f,100*g.distance_min,f),U.add(e,f,e),U.scale(e,-g.distance_min/U.length(e),e),U.add(g.pivot,e,g.trans)))}d.move_style===a.MS_HOVER_CONTROLS&&(d=c._render,g=d.use_distance_limits?d.hover_pivot:d.trans,d.horizontal_limits&&(g[0]=D.clamp(g[0],d.horizontal_limits.left,d.horizontal_limits.right)),d.vertical_limits&&(g[2]=D.clamp(g[2],d.vertical_limits.down,d.vertical_limits.up)),d=c._render,d.use_distance_limits&&(e=D.quat_to_dir(d.quat,D.AXIS_Z,X),g=0,0<e[1]&&
(g=Math.asin(e[1]/U.len(e))),e=U.negate(b(c,T),T),e[1]<d.hover_angle_limits.down?g+=e[1]-d.hover_angle_limits.down:e[1]>d.hover_angle_limits.up&&(g+=e[1]-d.hover_angle_limits.up),g&&(e=D.quat_to_dir(d.quat,D.AXIS_X,z),U.normalize(e,e),g=Z.setAxisAngle(e,g,ia),Z.normalize(g,g),Z.multiply(g,d.quat,d.quat)),g=X,c=c._render,c.use_distance_limits?(e=D.quat_to_dir(c.quat,D.AXIS_MY,X),U.normalize(e,e),c.hover_angle_limits.up-c.hover_angle_limits.down?(f=(-Math.asin(e[1])-c.hover_angle_limits.down)/(c.hover_angle_limits.up-
c.hover_angle_limits.down),f=Math.max(f,0)):f=0,c=U.scale(e,-(f*(c.distance_max-c.distance_min)+c.distance_min),g)):c=null,U.add(d.hover_pivot,c,d.trans)))};a.get_hover_angle=n;a.is_float_aspect=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_ORTHO:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return!0;default:return!1}};a.get_angular_diameter=function(b){b=b._render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return Math.PI*
b.fov/180;default:return m.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.set_projection=B;a.calc_sky_vp_inverse=q;a.calc_view_proj_inverse=s;a.extract_frustum_corners=y;a.assign_boundings=function(a){a=a._render;var b=I.zero_bounding_box();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.bb_local=b;var c=I.create_bounding_sphere(1,[0,0,0]);a.bs_local=c;a.bcap_local=I.create_bounding_capsule(1,b);a.bcyl_local=I.create_bounding_cylinder(1,b);a.bcon_local=I.create_bounding_cone(1,
b)};a.is_camera=g;a.is_target_camera=function(b){return g(b)&&b._render&&b._render.move_style==a.MS_TARGET_CONTROLS?!0:!1};a.is_hover_camera=function(b){return g(b)&&b._render&&b._render.move_style==a.MS_HOVER_CONTROLS?!0:!1};a.is_eye_camera=function(b){return g(b)&&b._render&&b._render.move_style==a.MS_EYE_CONTROLS?!0:!1};a.update_camera_shadows=A;a.csm_far_plane=u};b4w.module.__lights=function(a,p){function h(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),spot_size:0,spot_blend:0,generate_shadows:!1,dynamic_intensity:!1,use_diffuse:!0,use_specular:!0,energy:1,distance:25,falloff_type:"INVERSE_SQUARE"}}function c(a){a.color_intensity[0]=a.color[0]*a.energy;a.color_intensity[1]=a.color[1]*a.energy;a.color_intensity[2]=a.color[2]*a.energy}var f=p("__util"),b=p("vec3");a.init_light=h;
a.lamp_to_light=function(a){var e=a.data,k=h(e.type);k.name=a.name;k.use_diffuse=e.use_diffuse;k.use_specular=e.use_specular;var d=f.quat_to_dir(a._render.quat,f.AXIS_Y,[]);b.normalize(d,d);k.direction[0]=d[0];k.direction[1]=d[1];k.direction[2]=d[2];k.color[0]=e.color[0];k.color[1]=e.color[1];k.color[2]=e.color[2];k.energy=e.energy;c(k);k.distance=e.distance;if("POINT"===k.type||"SPOT"===k.type)k.falloff_type=e.falloff_type;"SPOT"===k.type&&(k.spot_size=e.spot_size,k.spot_blend=e.spot_blend);k.generate_shadows=
e.b4w_generate_shadows;k.dynamic_intensity=e.b4w_dynamic_intensity;a._light=k};a.set_light_color=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];c(a)};a.set_light_energy=function(a,b){a.energy=b;c(a)};a.update_light_transform=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a._light;b&&f.quat_to_dir(a._render.quat,f.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,p){function h(){if(!Bb)throw"no active scene";return Bb}function c(){return Bb?!0:!1}function f(a,b,c,d){d|=0;for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g._render.data_id==d){e=g;break}}return e}function b(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function e(b){if("NONE"==ba.shadows||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==I(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=I(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function k(a,b,c){c=J.node_by_attr(a,b);J.traverse_inputs(a,c,function(a,c,d){if(d.active){switch(d.from){case "COLOR":case "CUBEMAP":a=c.camera.color_attachment;break;case "DEPTH":a=c.camera.depth_attachment;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;
default:if(!a)throw"Connection of SCREEN is forbidden";c=b.bundles;for(var e=0;e<c.length;e++){var f=c[e].batch;ea.check_uniform(f.shader,d.to)&&W.append_texture(f,a,d.to)}}}});for(a=0;a<b.slinks_internal.length;a++){var d=b.slinks_internal[a],e=b.textures_internal[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.bundles,g=0;g<f.length;g++)c=f[g].batch,ea.check_uniform(c.shader,d.to)&&W.append_texture(c,e,d.to)}}}function d(a,b,c,d,e){for(var f=
b._render,g=b._batches,h=0;h<g.length;h++){var l=g[h];if(!(l.shadow_cast_only||l.reflexible_only||"MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||B(a,l))){if("OPAQUE"===d){if(l.blend)continue;var m=ca.find_subs(c,"SHADOW_CAST")&&l.shadow_receive?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!l.blend)continue;if("XRAY"==d!=l.xray)continue;if(ca.find_subs(c,"SHADOW_CAST")&&l.shadow_receive)switch(ba.shadows){case "DEPTH":m="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";
}else m="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==l.type&&l.anim_mat_values&&(b._render.all_mats_anim_values.push(l.anim_mat_values),b._render.all_mats_anim_inds.push(l.anim_node_val_indices));var q=l.shaders_info,u=e._render.shadow_params;ea.set_directive(q,"SHADOW_SRC",m);W.assign_shadow_receive_dirs(l,u);ea.set_directive(q,"NUM_LIGHTS",a.num_lights);"special_skydome.glslf"==ea.get_fname(q)&&ea.set_directive(q,"REFLECTION_PASS",0);ea.set_directive(q,"SSAO_ONLY",0);a.water_params&&
a.water_fog_color_density?ea.set_directive(q,"WATER_EFFECTS",1):ea.set_directive(q,"WATER_EFFECTS",0);a.water_params&&a.caustics&&f.caustics?(ea.set_directive(q,"CAUSTICS",1),ea.set_directive(q,"CAUST_SCALE",a.caust_scale),ea.set_directive(q,"CAUST_SPEED",ea.glsl_value(a.caust_speed,2)),ea.set_directive(q,"CAUST_BRIGHT",a.caust_brightness)):ea.set_directive(q,"CAUSTICS",0);a.water_params&&(ea.set_directive(q,"WAVES_HEIGHT",ea.glsl_value(a.water_waves_height)),ea.set_directive(q,"WAVES_LENGTH",ea.glsl_value(a.water_waves_length)),
ea.set_directive(q,"WATER_LEVEL",ea.glsl_value(a.water_level)));l.reflective&&ca.find_subs(c,"MAIN_REFLECT")&&-1===l.texture_names.indexOf("u_mirrormap")?ea.set_directive(q,"REFLECTIVE",1):ea.set_directive(q,"REFLECTIVE",0);if(u=ca.find_subs(c,"SKY"))if(l.procedural_sky){var s=u.camera.color_attachment;W.append_texture(l,s,"u_sky")}else ba.procedural_fog?(l.cube_fog=u.cube_fog,ea.set_directive(q,"PROCEDURAL_FOG",1)):ea.set_directive(q,"PROCEDURAL_FOG",0);else ea.set_directive(q,"PROCEDURAL_FOG",0);
if("SKY_TEXTURE"==e.world.light_settings.environment_color){s=null;if(e._render.sky_params.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)s=u.camera.color_attachment;else for(h=0;h<a.sky_texture_slots.length;h++)if(a.sky_texture_slots[h].texture.b4w_use_as_environment_lighting){s=W.get_batch_texture(a.sky_texture_slots[h],!1);break}s?(ea.set_directive(q,"SKY_TEXTURE",1),W.append_texture(l,s,"u_sky_texture")):ja.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}l.dynamic_grass&&
(u=ca.find_subs(c,"GRASS_MAP"))&&w(l,u,f);ca.find_subs(c,"REFRACT")&&l.refractive?ea.set_directive(q,"REFRACTIVE",1):ea.set_directive(q,"REFRACTIVE",0);l.water&&(l.water_shore_smoothing&&ca.find_subs(c,"DEPTH")?ea.set_directive(q,"SHORE_SMOOTHING",1):ea.set_directive(q,"SHORE_SMOOTHING",0),l.water_dynamic&&a.water_params&&a.water_waves_height?ea.set_directive(q,"DYNAMIC",1):ea.set_directive(q,"DYNAMIC",0));"PARTICLES"==l.type&&(ea.set_directive(q,"SIZE_RAMP_LENGTH",l.p_size_ramp_length),ea.set_directive(q,
"COLOR_RAMP_LENGTH",l.p_color_ramp_length));for(var u=l.textures,v=0;v<u.length;v++){var s=u[v],p=s.offscreen_scene;if(p){var C=p._render.graph,D=null,A=null;J.traverse_edges(C,function(a,b,c){if("SCREEN"==c.from)return D=J.get_node_attr(C,a),A=c,!0});if(!D||!A)throw"Failed to assign RTT";ma.set_filters(s,ma.TF_LINEAR,ma.TF_LINEAR);A.texture=s;var y=D.camera;y.color_attachment=s;y.framebuffer=E.render_target_create(s,null);K(p,s.source_size,s.source_size,!0);s=ca.create_rendering_queue(C);for(y=s.length-
1;0<=y;y--){var z=s[y],H=z.camera;G.set_projection(H,1);"MAIN_OPAQUE"==a.type&&H.type==G.TYPE_PERSP&&G.update_camera_shadows(H,p._render.shadow_params);e._render.queue.unshift(z)}}}if(l.lamp_uuid_indexes){var u=0,Y;for(Y in l.lamp_uuid_indexes)u++;ea.set_directive(q,"NUM_LAMP_LIGHTS",u);l.lamp_light_positions=new Float32Array(3*u);l.lamp_light_directions=new Float32Array(3*u);l.lamp_light_color_intensities=new Float32Array(3*u);l.lamp_light_factors=new Float32Array(4*u);for(v=0;v<e._objects.LAMP.length;v++)r(l,
e._objects.LAMP[v])}t(c,a,m);W.update_shader(l);m={do_render:!0,obj_render:f,batch:l};x(l);a.bundles.push(m);k(c,a,l);n(l)}}a.bundles.sort(function(a,b){var c;if(a.batch&&b.batch){c=a.batch.blend;var d=b.batch.blend;(c=c==d?0:c>d?1:-1)||(c=a.batch.offset_z,d=b.batch.offset_z,c=c==d?0:c>d?1:-1)}else c=0;return c})}function r(a,b){var c=b.uuid;if(c in a.lamp_uuid_indexes){c=a.lamp_uuid_indexes[c];a.lamp_light_positions.set(b._render.trans,3*c);a.lamp_light_directions.set(b._light.direction,3*c);a.lamp_light_color_intensities.set(b._light.color_intensity,
3*c);var d=Ma;A(b._light,Fa,d);a.lamp_light_factors.set(d,4*c)}}function x(a){var b=a.shader.attributes,c=a.bufs_data.pointers,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==a.type)b=ea.get_varyings_count(a.shader.vshader),10<b&&("MAIN"==a.type&&ja.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials: "'+a.material_names.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.uv_maps_usage&&(c=Aa.get_dict_length(a.uv_maps_usage)),a.vertex_colors_usage&&
(d=Aa.get_dict_length(a.vertex_colors_usage)),ja.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.material_names.join(", ")+'"')))}function n(a){8<a.textures.length&&ja.warn("B4W Warning: too many textures used - "+a.textures.length+' (max 8), materials "'+a.material_names.join(", ")+'"')}function t(a,b,c){for(var d=0,e=ca.get_inputs(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=
ca.find_upper_subs(a,g,"SHADOW_CAST").camera,b.v_light_matrix=g.view_matrix,b.b_light_matrix=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.p_light_matrix=b.p_light_matrix||[],b.p_light_matrix[d]=g.proj_matrix,d++)}}function w(a,b,c){a.grass_map_dim=b.grass_map_dim;var d=b.grass_map_dim[0],e=b.grass_map_dim[1],f=b.grass_map_dim[2];c=c.bb_local;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.grass_map_dim[2]=f;b=b.camera;G.set_frustum(b,f/2,-e,-d,f/2);G.set_projection(b);
d=a.grass_size||0;d=0==d?c:Math.max(d,c);a.grass_size=d}function B(a,b){for(var c=a.bundles,d=0;d<c.length;d++){var e=c[d].batch;if(e&&e.id==b.id)return!0}return!1}function q(a){var b=D(a,"MAIN_OPAQUE"),c=!0;J.traverse(a._render.graph,function(d,e){"SHADOW_CAST"===e.type&&(s(e,b,e.bundles,a,c),c=!1)})}function s(b,c,d,e,f){if(0!=d.length){var g=b.camera;c=c.camera;var h=I(e,"LAMP",a.DATA_ID_ALL),k;a:{for(k=0;k<h.length;k++){var l=h[k];if(l.data.b4w_generate_shadows){k=l;break a}}k=!1}h=(k||h[0])._render;
G.set_view_trans_quat(g,h.trans,h.quat);O.copy(c.eye,g.eye);Ea.copy(c.view_matrix,g.shadow_cast_billboard_view_matrix);h=pb;L.zero_bounding_box(h);for(k=0;k<d.length;k++)l=d[k].obj_render,0==k?L.copy_bb(l.bb_world,h):L.expand_bounding_box(h,l.bb_world);d=L.extract_bb_corners(h,Wa);Aa.positions_multiply_matrix(d,g.view_matrix,d);if(e._render.shadow_params.b4w_enable_csm){e=O.copy(c.csm_centers[b.csm_index],La);h=Ea.invert(c.view_matrix,Ta);Aa.positions_multiply_matrix(e,h,e);Aa.positions_multiply_matrix(e,
g.view_matrix,e);b=c.csm_radii[b.csm_index];if(f)for(Rb=0,f=2;f<d.length;f+=3)Rb=Math.min(Rb,d[f]);f=pb;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=Rb}else{b=f=pb;c=tc;c.set(d);e=kb/9;d=Ea.identity(Ta);Ea.rotate(d,e,Aa.AXIS_MZ,d);k=h=-1;for(l=0;10>l;l++){var m=L.bb_from_coords(c,uc),n=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==h||n<h)h=n,k=l,L.copy_bb(m,b);Aa.positions_multiply_matrix(c,d,c)}b=k*e;0<b&&(c=Ea.identity(Ta),Ea.rotate(c,b,Aa.AXIS_MZ,c),Ea.multiply(c,
g.view_matrix,g.view_matrix));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}G.set_frustum_asymmetric(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);G.set_projection(g);Aa.extract_frustum_planes(g.view_proj_matrix,g.frustum_planes)}}function y(a,b){for(var c=b._render,d=b._batches,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=
d[f];if(g.xray==e&&"COLOR_ID"==g.type&&!B(a,g)){W.set_batch_directive(g,"USE_GLOW",0);W.update_shader(g);var h={do_render:!0,obj_render:c,batch:g};x(g);a.bundles.push(h)}}}function g(a){var b=Aa.clone_object_nr(a);a.shaders_info=JSON.parse(JSON.stringify(a.shaders_info));return b}function A(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.use_diffuse?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.use_specular?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,
b=c[0]=Math.cos(a.spot_size/2),c[1]=a.spot_blend*(1-b)}}function u(a,b){for(var c=H(b,Ka),d=a._light,e=a._render,f=d.index,g=0;g<c.length;g++){var h=c[g];h.light_positions.set(e.trans,3*f);h.light_directions.set(d.direction,3*f);h.light_color_intensities.set(d.color_intensity,3*f);var k=Fa,l=Ma;A(d,k,l);switch(d.type){case "SUN":if(h.sun_quaternion.set(e.quat),h.sun_intensity=d.color_intensity,"SKY"===h.type){var m=La;m[0]=m[1]=m[2]=1;var n=Math.acos(O.dot(h.sun_direction,m)),m=Math.acos(O.dot(d.direction,
m));h.need_fog_update=Math.floor(n/.025)!=Math.floor(m/.025)?!0:!1;O.copy(d.direction,h.sun_direction);S(b,h)}else O.copy(d.direction,h.sun_direction);case "HEMI":case "POINT":case "SPOT":break;default:ja.error("B4W Warning: unknown light type: "+d.type)}h.light_factors1.set(k,4*f);h.light_factors2.set(l,4*f);h.need_perm_uniforms_update=!0;for(k=0;k<h.bundles.length;k++)l=h.bundles[k].batch,l.lamp_uuid_indexes&&r(l,a)}}function S(a,b){E.draw(b);if(b.need_fog_update)for(var c=H(a,["MAIN_OPAQUE","MAIN_BLEND",
"MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].bundles,f=0;f<e.length;f++){var g=e[f];g.do_render&&(g=g.batch,W.check_batch_perm_uniform(g,"u_cube_fog")&&E.update_batch_permanent_uniform(g,"u_cube_fog"))}}function I(b,c,d){if(!b._objects)throw"Access to uninitialized scene";b=b._objects[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f._render.data_id==d&&c.push(f)}return c}function v(b){var c=[];b=I(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,
f=0;f<e.materials.length;f++){var g=e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function K(a,b,c,d){for(var e=a._render,f=a.camera._render.cameras,g=0;g<f.length;g++){var h=f[g];G.set_projection(h,b/c);e.render_shadows&&G.update_camera_shadows(h,e.shadow_params)}e.render_shadows&&(e.need_shadow_update=!0,D(a,"DEPTH").need_perm_uniforms_update=!0,D(a,"MAIN_BLEND").need_perm_uniforms_update=!0);G.update_camera_transform(a.camera);ca.traverse_slinks(e.graph,function(e,f,g,h){if(d||e.update_dim){h=
e.size_mult*b;var k=e.size_mult*c;if(f)for(f=0;f<g.slinks_internal.length;f++)g.slinks_internal[f]==e&&ma.resize(e.texture,h,k);else ma.is_texture(e.texture)&&ma.resize(e.texture,h,k),e=g.camera,e.width=h,e.height=k,"DOF"==g.type&&U(a,{dof_power:g.camera.dof_power,dof_on:g.camera.dof_on}),m(g,1/b,1/c)}})}function m(a,b,c){a=a.bundles;for(var d=0;d<a.length;d++){var e=a[d].batch;e&&W.set_texel_size(e,b,c)}}function H(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];J.traverse(a._render.graph,function(a,
b){b.type==e&&c.push(b)})}return c}function D(a,b){return ca.find_subs(a._render.graph,b)}function U(a,b){var c=D(a,"DOF");if(!c)return ja.error("DOF is not enabled on scene. Check camera settings"),0;var d=a._render.graph;"boolean"==typeof b.dof_on&&(c.camera.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.camera.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.camera.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.camera.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.camera.dof_power=
b.dof_power;for(var e=ca.find_input(d,c,"POSTPROCESSING"),d=ca.find_input(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].bundles[0].batch;f&&(W.set_texel_size_mult(f,c.camera.dof_power),m(e[d],1/c.camera.width,1/c.camera.height))}}c.need_perm_uniforms_update=!0}function P(a,b){var c=D(Bb,"MAIN_OPAQUE");if(!c||!c.water_params)return ja.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.water_waves_height,e=c.water_waves_length,f=c.water_level,g=c.water_params;
if(!d||!g.dynamic)return g.water_level;var h=O.length(c.wind),k=c.time;h&&(k*=h);var l=Na;l[0]=20/e*(a-.25*k);l[1]=20/e*(b-.25*k);h=Aa.cellular2x2(l);l[0]=17/e*(b+.1*k);l[1]=17/e*(a+.1*k);var l=Aa.cellular2x2(l),h=h+l-1,m=g.dst_noise_scale0,l=g.dst_noise_scale1,n=g.dst_noise_freq0,E=g.dst_noise_freq1,q=Na;q[0]=m*(a+n*k);q[1]=m*(b+n*k);m=Aa.snoise(q);q[0]=l*(b-E*k);q[1]=l*(a-E*k);l=Aa.snoise(q);l*=d*m;if(c.use_shoremap)if(E=(a-c.shoremap_center[0])/c.shoremap_size[0],q=(c.shoremap_center[1]+b)/c.shoremap_size[1],
E+=.5,q+=.5,1<E||0>E||1<q||0>q)d=l;else var E=Aa.get_array_smooth_value(Bb._render.shore_distances,c.shoremap_tex_size,E,q),q=g.dir_min_shore_fac,m=g.dir_freq,r=g.dir_noise_scale,u=g.dir_noise_freq,n=g.dir_min_noise_fac,g=g.dst_min_fac,c=e/c.max_shore_dist/Math.PI,r=[r/e*(a+u*k),r/e*(b+u*k)],e=Math.sqrt(E),d=d*Math.max(E,q)*Math.sin(e/c+m*k)*Math.max(Aa.snoise(r),n),k=Math.max(e,g),d=d*(1-k)+l*k,h=h*E;else d=l;return f+(d+.05*h)}function Z(a,b,c){b.is_for_glow&&"POSTPROCESSING"==b.type&&c.do_render!=
b.do_render&&(b.do_render=c.do_render);c.do_render||"GLOW"!=b.type||(b.draw_glow_flag=0)}function V(a,b,c,d){var e=J.get_node_attr(a,b);G.set_attachment(e.camera,c,d);e.assign_texture=!0;J.traverse_outputs(a,b,function(b,e,f){f.active&&f.from==c&&ca.check_slink_tex_conn(f)&&M(a,b,f.to,d)});J.traverse_inputs(a,b,function(b,e,f){f.active&&f.from==c&&f.from==f.to&&V(a,b,c,d)})}function M(a,b,c,d){a=J.get_node_attr(a,b).bundles;for(b=0;b<a.length;b++)W.replace_texture(a[b].batch,d,c)}function Q(a){var b=
D(a,"GRASS_MAP");if(b){var c=b.camera,d=a.camera._render,e=d.trans;a=La;a[0]=0;a[1]=-b.grass_map_dim[2]/2;a[2]=0;O.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Ia;b[0]=0;b[1]=0;b[2]=0;b[3]=1;G.set_view_trans_quat(c,a,b)}}function T(a,b){J.traverse(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.slinks_internal[0]||!d.textures_internal[0])throw"Wrong MOTION_BLUR subscene";var e=d.slinks_internal[0],f=d.textures_internal[0];d.textures_internal[0]=d.camera.color_attachment;J.traverse_outputs(a,
c,function(b,c,d){d.active&&M(a,b,d.to,f)});V(a,c,e.from,f);M(a,c,e.to,d.textures_internal[0]);d.motion_blur_exp=Math.exp(-b/d.mb_factor)}})}function X(b,c){var d=0,e=b._glow_anim;0==e.time_start&&(e.time_start=c);var f=c-e.time_start;if(e.relapses&&f/e.period>=e.relapses)a.clear_glow_anim(b);else{f%=e.period;if(f<e.glow_time)switch(e=f/(e.glow_time/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b._batches.length;e++)f=
b._batches[e],"COLOR_ID"==f.type&&(f.glow_intensity=d)}}function z(a){J.traverse(a._render.graph,function(a,b){b.need_perm_uniforms_update=!0})}function ia(a){if("WIND"==a.field.type){a=a._render;Aa.quat_to_dir(a.quat,Aa.AXIS_Y,sb);O.normalize(sb,sb);O.scale(sb,a.force_strength,sb);a=Za;for(var b=0;b<a.length;b++)for(var c=H(a[b],Ab),d=0;d<c.length;d++)c[d].wind.set(sb)}}var W=p("__batch"),L=p("__boundings"),G=p("__camera"),fa=p("__config"),da=p("__debug"),C=p("__geometry"),J=p("__graph"),ha=p("__hud"),
pa=p("__objects");p("__particles");var la=p("__prerender"),Y=p("__primitives"),ja=p("__print"),E=p("__renderer"),ca=p("__scenegraph"),ua=p("__sfx"),ea=p("__shaders"),ma=p("__textures"),Aa=p("__util"),O=p("vec3"),Ea=p("mat4"),ba=fa.defaults,Ha="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Ja=["ARMATURE","EMPTY","MESH","SPEAKER"],ab="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),Ka="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),
zb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Ab="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),Hb=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Bb=null,Za=[],lb=[],qb,tb,kb=Math.PI/2;a.GET_OBJECT_BY_NAME=0;a.GET_OBJECT_BY_DUPLI_NAME=1;a.GET_OBJECT_BY_DUPLI_NAME_LIST=2;a.DATA_ID_ALL=-1;var Na=new Float32Array(2),La=new Float32Array(3),Fa=new Float32Array(4),Ma=new Float32Array(4),
Ia=new Float32Array(4),Ta=new Float32Array(16),Wa=new Float32Array(24),tc=new Float32Array(24),pb=L.zero_bounding_box(),uc=L.zero_bounding_box(),sb=new Float32Array(3),Rb=null;a.set_active=function(a){Bb=a;ua.set_active_scene(a)};a.prepare_rendering=function(a){var b=a._render;if(!a._render_to_texture){for(var c=ca.create_rendering_queue(b.graph),d=0;d<c.length;d++)b.queue.push(c[d]);K(a,qb,tb,!1)}a=H(a,Ab);for(c=0;c<a.length;c++)a[c].wind.set(sb);for(d=0;d<b.queue.length;d++)"SHADOW_CAST"==b.queue[d].type&&
E.draw(b.queue[d])};a.get_active=h;a.check_active=c;a.get_all_scenes=function(){return Za};a.get_object=function(b,c,d,e){for(var g=Za,h=null,k="",l=0;l<g.length;l++){var m=I(g[l],"ALL",a.DATA_ID_ALL);switch(b){case a.GET_OBJECT_BY_NAME:k=c;h=f(c,m,!1,d);break;case a.GET_OBJECT_BY_DUPLI_NAME:var h=k=d,n=e,E=null;(m=f(c,m,!1,n))&&m.dupli_group&&(E=f(h,m.dupli_group.objects,!0,n));h=E;break;case a.GET_OBJECT_BY_DUPLI_NAME_LIST:for(var k=c[c.length-1],h=c,n=d,E=null,q=0;q<h.length;q++)if((E=f(h[q],m,
0!=q,n))&&E.dupli_group)m=E.dupli_group.objects;else break;h=E}if(h)break}h||ja.warn("get object "+k+": not found");return h};a.append_to_existed_scene=function(a,c,d){for(var e in Ja){var f=Ja[e],g=b(a,f),h=c._render.video_textures,k=!1;for(e=0;e<d.length;e++)if(k=!0,d[e]._render&&d[e]._render.is_movie){for(var l=0;l<h.length;l++)h[l]==d[e]&&(k=!1);k&&h.push(d[e])}f in c._objects||(c._objects[f]=[]);for(l=0;l<g.length;l++)Aa.is_armature(g[l])&&g[l].proxy||(c._objects.ALL.push(g[l]),c._objects[f].push(g[l]))}};
a.append_scene=function(c,d){c._objects={ALL:[]};for(var f in Ha){var g=Ha[f],h=b(c,g);c._objects[g]=[];for(var k=0;k<h.length;k++)Aa.is_armature(h[k])&&h[k].proxy||(c._objects.ALL.push(h[k]),c._objects[g].push(h[k]))}c._render=c._render||{};g=c._render;h=c.camera._render;f=c.world.b4w_shadow_settings;k=g.shadow_params={};k.csm_resolution=f.csm_resolution;k.self_shadow_polygon_offset=f.self_shadow_polygon_offset;k.self_shadow_normal_offset=f.self_shadow_normal_offset;k.b4w_enable_csm=f.b4w_enable_csm;
k.b4w_enable_csm?(k.csm_num=f.csm_num,k.csm_first_cascade_border=f.csm_first_cascade_border,k.first_cascade_blur_radius=f.first_cascade_blur_radius,k.csm_last_cascade_border=f.csm_last_cascade_border,k.last_cascade_blur_radius=f.last_cascade_blur_radius,k.fade_last_cascade=f.fade_last_cascade,k.blend_between_cascades=f.blend_between_cascades):(k.csm_num=1,k.csm_first_cascade_border=f.csm_first_cascade_border,k.first_cascade_blur_radius=f.first_cascade_blur_radius,k.csm_last_cascade_border=f.csm_last_cascade_border,
k.last_cascade_blur_radius=f.last_cascade_blur_radius,k.fade_last_cascade=!1,k.blend_between_cascades=!1);g.video_textures=[];for(f=0;f<d.length;f++)d[f]._render&&d[f]._render.is_movie&&g.video_textures.push(d[f]);f=c.world.b4w_fog_color;g.fog_color_density=new Float32Array([f[0],f[1],f[2],c.world.b4w_fog_density]);a:{if(c._objects)for(f=c._objects.LAMP,k=0;k<f.length;k++)if("SUN"==f[k]._light.type){f=!0;break a}f=!1}g.sun_exist=f;f=g.sun_exist;var k={},l=c.world.b4w_sky_settings;k.procedural_skydome=
l.procedural_skydome&&f;k.use_as_environment_lighting=l.use_as_environment_lighting;k.sky_color=l.color;k.rayleigh_brightness=l.rayleigh_brightness;k.mie_brightness=l.mie_brightness;k.spot_brightness=l.spot_brightness;k.scatter_strength=l.scatter_strength;k.rayleigh_strength=l.rayleigh_strength;k.mie_strength=l.mie_strength;k.rayleigh_collection_power=l.rayleigh_collection_power;k.mie_collection_power=l.mie_collection_power;k.mie_distribution=l.mie_distribution;!f&&l.procedural_skydome&&ja.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");
g.sky_params=k;var m=c.world;f=[0,0,0];var k=[0,0,0],l=m.light_settings,n=m.texture_slots;if(l.use_environment_light)if("SKY_COLOR"==l.environment_color||"SKY_TEXTURE"==l.environment_color)f=m.horizon_color.slice(0),k=m.zenith_color.slice(0);else if("PLAIN"==l.environment_color)f=[1,1,1],k=[1,1,1];else throw"Unsupported world environment color"+l.environment_color;m={};m.environment_energy=l.environment_energy;m.horizon_color=f;m.zenith_color=k;m.sky_texture_slots=n;g.world_light_set=m;g.lamps_number=
I(c,"LAMP",a.DATA_ID_ALL).length;f=v(c);k=[];l=I(c,"MESH",a.DATA_ID_ALL);for(n=0;n<f.length;n++){var E=f[n];if(E.b4w_water){for(var m={},q=0;q<l.length;q++)for(var r=l[q],u=r.data.materials,t=0;t<u.length;t++)u[t]==E&&(m.water_level=r.location[1]);if(ba.deferred_rendering)for(m.fog_color_density=E.b4w_water_fog_color.slice(0),m.fog_color_density.push(E.b4w_water_fog_density),E.b4w_water_dynamic?(m.dynamic=!0,m.waves_height=E.b4w_waves_height,m.waves_length=E.b4w_waves_length,m.dst_noise_scale0=E.b4w_water_dst_noise_scale0,
m.dst_noise_scale1=E.b4w_water_dst_noise_scale1,m.dst_noise_freq0=E.b4w_water_dst_noise_freq0,m.dst_noise_freq1=E.b4w_water_dst_noise_freq1,m.dir_min_shore_fac=E.b4w_water_dir_min_shore_fac,m.dir_freq=E.b4w_water_dir_freq,m.dir_noise_scale=E.b4w_water_dir_noise_scale,m.dir_noise_freq=E.b4w_water_dir_noise_freq,m.dir_min_noise_fac=E.b4w_water_dir_min_noise_fac,m.dst_min_fac=E.b4w_water_dst_min_fac,m.waves_hor_fac=E.b4w_water_waves_hor_fac):(m.dynamic=!1,m.waves_height=0,m.waves_length=0),m.caustic_scale=
null,m.caustic_brightness=null,m.caustic_speed=new Float32Array(2),m.shoremap_image=null,E=E.texture_slots,q=0;q<E.length;q++)r=E[q].texture,"VORONOI"==r.type&&(m.caustic_scale=r.noise_scale,m.caustic_speed.set(r.b4w_uv_velocity_trans),m.caustic_brightness=r.noise_intensity),!0===r.b4w_shore_dist_map&&(m.shoremap_image=r.image,m.shoremap_tex_size=r.image.size[0],m.shore_boundings=r.b4w_shore_boundings,m.max_shore_dist=r.b4w_max_shore_dist);else m.waves_height=0,m.waves_length=0,m.caustic_scale=null,
m.caustic_brightness=null,m.caustic_speed=null,m.fog_color_density=null,m.dynamic=!1;k.push(m)}}if(0<k.length){m=k[0];if(!m.dynamic)for(n=0;n<k.length;n++)k[n].dynamic&&(m=k[n]);f=m}else f=null;g.water_params=f;a:{f=I(c,"MESH",a.DATA_ID_ALL);for(k=0;k<f.length;k++)if(f[k]._render.selectable){f=!0;break a}f=!1}g.color_picking=f||ba.force_selectable;a:{f=I(c,"MESH",a.DATA_ID_ALL);for(k=0;k<f.length;k++)for(l=f[k].data.materials,n=0;n<l.length;n++)if(m=l[n],q=m.game_settings.alpha_blend,m.b4w_render_above_all&&
"OPAQUE"!=q&&"CLIP"!=q){f=!0;break a}f=!1}g.xray=f;g.num_lamps_added=0;if(ba.deferred_rendering){f=c._render_to_texture;g.render_shadows=e(c);g.fog_color=c.world.b4w_fog_color;a:{if(ba.shore_smoothing)for(k=v(c),l=0;l<k.length;l++)if(n=k[l],n.b4w_water&&n.b4w_water_shore_smoothing){k=!0;break a}k=!1}g.shore_smoothing=k;if(ba.reflections&&c.b4w_render_reflections)for(k=[],l=I(c,"MESH",a.DATA_ID_ALL),n=0;n<l.length;n++){if(m=l[n],m.b4w_reflective){b:{m=m.constraints;for(q=0;q<m.length;q++)if(E=m[q],
"LOCKED_TRACK"==E.type&&"REFLECTION PLANE"==E.name){q=E.target;break b}q=null}q&&(m=q.location,q=q._render.quat,E=new Float32Array(4),Aa.trans_quat_to_plane(m,q,Aa.AXIS_Y,E),k.push(E))}}else k=!1;g.refl_planes=k;k={};l=c.world.b4w_bloom_settings;k.blur=l.blur;k.edge_lum=l.edge_lum;k.key=l.key;g.bloom_params=k;k={};l=c.world.b4w_motion_blur_settings;k.mb_decay_threshold=l.motion_blur_decay_threshold;k.mb_factor=l.motion_blur_factor;g.mb_params=k;k={};l=c.world.b4w_color_correction_settings;k.brightness=
l.brightness;k.contrast=l.contrast;k.exposure=l.exposure;k.saturation=l.saturation;g.cc_params=k;k={};l=c.world.b4w_god_rays_settings;k.intensity=l.intensity;k.max_ray_length=l.max_ray_length;k.steps_per_pass=l.steps_per_pass;g.god_rays_params=k;k={};l=c.world;k.glow_color=l.b4w_glow_color;k.glow_factor=l.b4w_glow_factor;g.glow_params=k;g.dof=ba.dof&&(0<h.dof_distance||h.dof_object);a:{if(ba.dynamic_grass)for(l=k=!1,n=I(c,"MESH",a.DATA_ID_ALL),m=0;m<n.length;m++){E=n[m];r=E.data.materials;for(q=0;q<
r.length;q++)r[q].b4w_terrain&&(k=!0);E=E.particle_systems;for(q=0;q<E.length;q++)r=E[q].settings,"HAIR"==r.type&&r.b4w_dynamic_grass&&(l=!0);if(k&&l){k=!0;break a}}k=!1}g.dynamic_grass=k;g.motion_blur=ba.motion_blur&&c.b4w_enable_motion_blur;g.compositing=ba.compositing&&c.b4w_enable_color_correction;g.antialiasing=ba.antialiasing&&c.b4w_enable_antialiasing;g.bloom=ba.bloom&&c.b4w_enable_bloom&&g.sun_exist;g.ssao=ba.ssao&&c.b4w_enable_ssao;k={};l=c.world.b4w_ssao_settings;k.radius_increase=l.radius_increase;
k.hemisphere=l.hemisphere;k.blur_depth=l.blur_depth;k.blur_discard_value=l.blur_discard_value;k.influence=l.influence;k.dist_factor=l.dist_factor;k.samples=l.samples;g.ssao_params=k;g.god_rays=ba.god_rays&&c.b4w_enable_god_rays&&g.sun_exist;g.refractions=ba.refractions&&c.b4w_render_refractions;g.glow=ba.glow?g.color_picking:!1;g.graph=ca.create_rendering_graph(f,g,h)}else g.graph=ca.create_rendering_graph_compat(h,g);g.queue=[];g.need_shadow_update=!1;g.need_grass_map_update=!1;Za.push(c)};a.combine_scene_objects=
b;a.get_graph=function(a){return a._render.graph};a.generate_auxiliary_batches=function(a){J.traverse(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=W.create_postprocessing_batch(c.pp_effect);break;case "SSAO":d=W.create_ssao_batch(c);break;case "SSAO_BLUR":d=W.create_ssao_blur_batch(c);W.set_texel_size(d,1/c.camera.width,1/c.camera.height);break;case "DEPTH_PACK":d=W.create_depth_pack_batch();break;case "REFRACT":case "SCREEN":d=W.create_postprocessing_batch("NONE");break;case "GOD_RAYS":d=
ca.find_input(a,c,"WIREFRAME")||ca.find_input(a,c,"MAIN_BLEND")||ca.find_input(a,c,"GOD_RAYS");d=W.create_god_rays_batch(d.camera.color_attachment,c.pack|0,(c.reflection_plane&&c.water)|0,c.steps_per_pass);break;case "GOD_RAYS_COMBINE":var d=ca.find_input(a,c,"WIREFRAME")||ca.find_input(a,c,"MAIN_BLEND"),e=ca.find_input(a,c,"GOD_RAYS"),d=W.create_god_rays_combine_batch(d.camera.color_attachment,e.camera.color_attachment);break;case "MOTION_BLUR":d=W.create_motion_blur_batch(c.mb_decay_threshold);
break;case "DOF":d=W.create_dof_batch();W.set_texel_size_mult(d,c.camera.dof_power);for(var e=ca.find_input(a,c,"POSTPROCESSING"),f=ca.find_input(a,e,"POSTPROCESSING"),g=[e,f],h=0;h<g.length;h++){var l=g[h].bundles;(e=l[0].batch)&&W.set_texel_size_mult(e,c.camera.dof_power)}break;case "GLOW":g=ca.find_input(a,c,"POSTPROCESSING");h=ca.find_input(a,g,"POSTPROCESSING");e=ca.find_input(a,h,"POSTPROCESSING");f=ca.find_input(a,e,"POSTPROCESSING");d=W.create_glow_batch();g=[h,g];for(h=0;h<g.length;h++)l=
g[h].bundles,(l=l[0].batch)&&W.set_texel_size_mult(l,c.blur_texel_size_mult);g=[f,e];for(h=0;h<g.length;h++)l=g[h].bundles,(l=l[0].batch)&&W.set_texel_size_mult(l,c.ext_texel_size_mult*c.glow_factor);break;case "COMPOSITING":d=W.create_compositing_batch();break;case "ANTIALIASING":d=W.create_antialiasing_batch();break;case "LANCZOS":d=W.create_lanczos_batch(c.lanczos_type);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
W.create_smaa_batch(c.type);break;case "ANAGLYPH":d=W.create_anaglyph_batch();break;case "SKY":d=W.create_sky_batch();W.set_texel_size(d,1/c.camera.width,1/c.camera.height);break;case "LUMINANCE":d=W.create_luminance_batch();break;case "AVERAGE_LUMINANCE":d=W.create_average_luminance_batch();break;case "LUMINANCE_TRUNCED":d=W.create_luminance_trunced_batch();break;case "BLOOM_BLUR":d=W.create_bloom_blur_batch(c.pp_effect);W.set_texel_size(d,1/c.camera.width,1/c.camera.height);break;case "BLOOM":d=
ca.find_input(a,c,"BLOOM_BLUR");g=[ca.find_input(a,d,"BLOOM_BLUR"),d];for(h=0;h<g.length;h++)l=g[h].bundles,(l=l[0].batch)&&W.set_texel_size_mult(l,c.bloom_blur);d=W.create_bloom_combine_batch();break;case "VELOCITY":d=W.create_velocity_batch()}d&&(e={do_render:!0,obj_render:pa.create_render("NONE"),batch:d},x(d),c.bundles.push(e),k(a,c,d),n(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a._render.graph,e=b._render;!ca.find_subs(c,"SHADOW_CAST")&&e.shadow_receive&&(e.shadow_receive=
!1);for(var e=H(a,ab),f=0;f<e.length;f++){var h=e[f],l=b,m=c,E=a;switch(h.type){case "MAIN_OPAQUE":d(h,l,m,"OPAQUE",E);break;case "MAIN_BLEND":d(h,l,m,"BLEND",E);break;case "MAIN_XRAY":d(h,l,m,"XRAY",E);break;case "MAIN_REFLECT":m=l._render;l=l._batches;for(E=0;E<l.length;E++){var q=l[E],r=g(q);if(!("MAIN"!=r.type&&"NODES"!=r.type&&"PARTICLES"!=r.type||B(h,r)||r.blend)&&r.reflexible){var v=r.shaders_info;ea.set_directive(v,"DISABLE_FOG",0);ea.set_directive(v,"WATER_EFFECTS",0);"special_skydome.glslf"==
ea.get_fname(v)&&ea.set_directive(v,"REFLECTION_PASS",1);ea.set_directive(v,"SHADOW_SRC","SHADOW_SRC_NONE");ea.set_directive(v,"TEXTURE_NORM",0);W.update_shader(r);v={do_render:!0,obj_render:m,batch:r};x(r);h.bundles.push(v);"MAIN"==r.type&&(q.childs||(q.childs=[]),q.childs.push(r))}}break;case "DEPTH":q=l._render;l=l._batches;for(r=0;r<l.length;r++){var p=l[r];if("DEPTH"==p.type&&!B(h,p)&&!p.shadow_cast_only){if(ca.has_upper_subs(m,h,"SHADOW_CAST"))if(p.shadow_receive){switch(ba.shadows){case "DEPTH":var v=
"SHADOW_SRC_DEPTH",C="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}p=W.update_batch_shadow_src_dst(p,v,C);W.assign_shadow_receive_dirs(p,E._render.shadow_params);ca.get_inputs(m,h);t(m,h,v)}else p=W.update_batch_shadow_src_dst(p,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else p=W.update_batch_shadow_src_dst(p,"SHADOW_SRC_NONE","SHADOW_DST_NONE");p.dynamic_grass&&(v=ca.find_subs(m,"GRASS_MAP"))&&w(p,v,q);W.update_shader(p);v={do_render:!0,obj_render:q,batch:p};x(p);h.bundles.push(v);k(m,h,p);
n(p)}}break;case "SHADOW_CAST":q=!1;r=l._render;l=l._batches;for(v=0;v<l.length;v++)if(p=l[v],p.shadow_cast||p.shadow_receive)if(q=!0,"DEPTH"==p.type&&!B(h,p)&&p.shadow_cast){switch(ba.shadows){case "DEPTH":C="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}p=W.create_shadow_batch_form_depth(p,"SHADOW_SRC_NONE",C);p.dynamic_grass&&(C=ca.find_subs(m,"GRASS_MAP"))&&w(p,C,r);W.set_batch_directive(p,"SHADOW_TEX_RES",ea.glsl_value(E._render.shadow_params.csm_resolution));W.update_shader(p);
C={do_render:!0,obj_render:r,batch:p};x(p);h.bundles.push(C)}q&&s(h,ca.find_subs(m,"MAIN_OPAQUE"),h.bundles,E,!0);break;case "COLOR_PICKING":y(h,l);break;case "COLOR_PICKING_XRAY":y(h,l);break;case "GRASS_MAP":m=l._render;l=l._batches;for(E=0;E<l.length;E++)q=l[E],"GRASS_MAP"!=q.type||B(h,q)||(W.update_shader(q),r={do_render:!0,obj_render:m,batch:q},x(q),h.bundles.push(r),q=h.camera,C=m.bb_world,r=h.grass_map_dim[0],v=h.grass_map_dim[1],p=h.grass_map_dim[2],0==r&&0==v?(r=C.min_y,v=C.max_y):(r=Math.min(r,
C.min_y),v=Math.max(v,C.max_y)),C=1E-4*(v-r),h.grass_map_dim[0]=r-C,h.grass_map_dim[1]=v+C,G.set_frustum(q,p/2,-v,-r,p/2),G.set_projection(q));break;case "GLOW_MASK":m=l._render;l=l._batches;for(E=0;E<l.length;E++)q=l[E],"COLOR_ID"!=q.type||B(h,q)||(r=g(q),W.set_batch_directive(r,"USE_GLOW",1),W.update_shader(r),l.push(r),v={do_render:!0,obj_render:m,batch:r},x(r),h.bundles.push(v),q.childs||(q.childs=[]),q.childs.push(r));break;case "WIREFRAME":for(E=l._render,l=l._batches,q=0;q<l.length;q++)r=l[q],
"WIREFRAME"!=r.type||B(h,r)||(r.dynamic_grass&&(v=ca.find_subs(m,"GRASS_MAP"))&&w(r,v,E),W.update_shader(r),v={do_render:!0,obj_render:E,batch:r},x(r),h.bundles.push(v),k(m,h,r),n(r))}}break;case "LAMP":b._light.index=a._render.num_lamps_added++;c=H(a,Ka);for(e=0;e<c.length;e++)c[e].num_lights++;u(b,a)}};a.has_batch=B;a.schedule_shadow_update=function(a){a._render.need_shadow_update=!0};a.get_csm_borders=function(a,b){for(var c=a._render.shadow_params,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=
G.csm_far_plane(c,b,e);return d};a.hide_object=function(a){a._render.hide=!0};a.show_object=function(a){a._render.hide=!1};a.remove_object_bundles=function(a,b){for(var c=b._render,d=H(a,ab),e=0;e<d.length;e++)for(var f=d[e].bundles,g=f.length-1;0<=g;g--){var h=f[g];h.obj_render==c&&(h.batch&&C.cleanup_bufs_data(h.batch.bufs_data),f.splice(g,1))}};a.check_object=function(a,b){return b._objects[a.type]&&-1<b._objects[a.type].indexOf(a)?!0:!1};a.sort_lamps=function(a){var b=a._objects.LAMP;if(b.length==
a._render.num_lamps_added){for(var c=[],d=0;d<b.length;d++)c[b[d]._light.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f;f=b[c[d]]._light;var g=b[c[e]]._light;f=!g.use_diffuse||!g.use_specular||f.use_diffuse&&f.use_specular?!f.use_diffuse&&(g.use_diffuse||!f.use_specular&&g.use_specular)?!0:!1:!0;f&&(f=c[d],c[d]=c[e],c[e]=f)}for(d=0;d<c.length;d++)b[c[d]]._light.index=d,u(b[c[d]],a,!0)}};a.update_lamp_scene=u;a.cleanup=function(){for(var a=0;a<Za.length;a++){var b=Za[a];J.traverse(b._render.graph,
function(a,b){if("SINK"!=b.type){var c=b.camera;E.render_target_cleanup(c.framebuffer,c.color_attachment,c.depth_attachment,c.width,c.height);for(var c=b.bundles,d=0;d<c.length;d++){var e=c[d].batch;e&&W.clear_batch(e)}}});b._render.graph=[];b._render.queue=[]}Bb=null;Za.length=0;lb.length=0;sb[0]=0;sb[1]=0;sb[2]=0};a.make_frustum_shot=function(a,b,c){a=G.extract_frustum_corners(a,a.near,a.far,null,!0);var d=Y.generate_frustum(a);a=pa.create_render("DYNAMIC");a.bb_world=a.bb_local=L.big_bounding_box();
a.bs_world=a.bs_local=L.big_bounding_sphere();var e=a.bs_world.radius;a.be_world=a.be_local=L.create_bounding_ellipsoid([e,0,0],[0,e,0],[0,0,e],a.bs_world.center);c=W.create_shadeless_batch(d,c,.5);b.bundles.push({do_render:!0,obj_render:a,batch:c})};a.get_scene_objs=I;a.get_scene_timeline=function(a){return[a.frame_start,a.frame_end]};a.setup_dim=function(a,b){qb=a;tb=b;Bb&&K(Bb,a,b,!1)};a.set_texel_size=m;a.subs_array=H;a.get_subs=D;a.get_environment_colors=function(a){a=H(a,Ka)[0];var b=a.horizon_color,
c=a.zenith_color,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.environment_energy,d,e]};a.set_environment_colors=function(a,b,c,d){a=H(a,Ka);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.environment_energy=b);c&&f.horizon_color.set(c);d&&f.zenith_color.set(d);f.need_perm_uniforms_update=!0}};a.get_sky_params=function(a){if(a=D(a,"SKY")){var b={};b.color=Array(3);O.copy(a.sky_color,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=
a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){for(var c=H(a,["SKY"]),d=0;d<c.length;d++){var e=c[d];"number"==
typeof b.procedural_skydome&&(e.procedural_skydome=b.procedural_skydome);"number"==typeof b.use_as_environment_lighting&&(e.use_as_environment_lighting=b.use_as_environment_lighting);"object"==typeof b.color&&e.sky_color.set(b.color);"number"==typeof b.rayleigh_brightness&&(e.rayleigh_brightness=b.rayleigh_brightness);"number"==typeof b.mie_brightness&&(e.mie_brightness=b.mie_brightness);"number"==typeof b.spot_brightness&&(e.spot_brightness=b.spot_brightness);"number"==typeof b.scatter_strength&&
(e.scatter_strength=b.scatter_strength);"number"==typeof b.rayleigh_strength&&(e.rayleigh_strength=b.rayleigh_strength);"number"==typeof b.mie_strength&&(e.mie_strength=b.mie_strength);"number"==typeof b.rayleigh_collection_power&&(e.rayleigh_collection_power=b.rayleigh_collection_power);"number"==typeof b.mie_collection_power&&(e.mie_collection_power=b.mie_collection_power);"number"==typeof b.mie_distribution&&(e.mie_distribution=b.mie_distribution);e.need_perm_uniforms_update=!0;e.need_fog_update=
!0;S(h(),e);E.draw(e)}};a.get_fog_color_density=function(a,b){var c=b||[],d=H(a,zb)[0].fog_color_density;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=H(a,zb),d=0;d<c.length;d++){var e=c[d];e.fog_color_density.set(b);e.need_perm_uniforms_update=!0}};a.get_ssao_params=function(a){var b=D(a,"SSAO");a=D(a,"SSAO_BLUR");if(!b)return null;var c=b.bundles[0].batch,d={};d.ssao_quality=W.get_batch_directive(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;
d.ssao_blur_depth=a.ssao_blur_depth;d.blur_discard_value=a.ssao_blur_discard_value;d.radius_increase=b.ssao_radius_increase;d.influence=b.ssao_influence;d.dist_factor=b.ssao_dist_factor;d.ssao_only=b.ssao_only;d.ssao_white=W.get_batch_directive(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=D(a,"SSAO"),d=D(a,"SSAO_BLUR");if(!c)return ja.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.bundles[0].batch;W.set_batch_directive(e,"SSAO_QUALITY",b.ssao_quality);
W.update_shader(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.bundles[0].batch,W.set_batch_directive(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),W.update_shader(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.bundles[0].batch,W.set_batch_directive(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),W.update_shader(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ssao_radius_increase&&(c.ssao_radius_increase=b.ssao_radius_increase);"number"==
typeof b.ssao_influence&&(c.ssao_influence=b.ssao_influence);"number"==typeof b.ssao_dist_factor&&(c.ssao_dist_factor=b.ssao_dist_factor);if("number"==typeof b.ssao_only){c=D(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.bundles.length;f++)e=c.bundles[f].batch,W.set_batch_directive(e,"SSAO_ONLY",b.ssao_only),W.update_shader(e,!0)}"number"==typeof b.ssao_white&&(e=c.bundles[0].batch,W.set_batch_directive(e,"SSAO_WHITE",b.ssao_white),W.update_shader(e,!0));c.need_perm_uniforms_update=!0;
d.need_perm_uniforms_update=!0};a.get_dof_params=function(a){a=D(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.camera.dof_distance;b.dof_front=a.camera.dof_front;b.dof_rear=a.camera.dof_rear;b.dof_power=a.camera.dof_power;return b};a.set_dof_params=U;a.get_god_rays_params=function(a){var b=H(a,["GOD_RAYS"]);a=D(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].max_ray_length;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=W.get_batch_directive(b[0].bundles[0].batch,
"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=H(a,["GOD_RAYS"]),d=D(a,"GOD_RAYS_COMBINE");if(!c||!d)return ja.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].max_ray_length=e,c[f].radial_blur_step=e/c[f].steps_per_pass/(f+1),c[f].need_perm_uniforms_update=!0;if("number"==typeof b.god_rays_steps)for(var g=
ea.glsl_value(b.god_rays_steps,1),e=c[0].max_ray_length,f=0;f<c.length;f++){c[f].steps_per_pass=g;c[f].radial_blur_step=e/g/(f+1);c[f].need_perm_uniforms_update=!0;var h=c[f].bundles[0].batch;W.set_batch_directive(h,"STEPS_PER_PASS",g);W.update_shader(h,!0)}d.need_perm_uniforms_update=!0};a.get_bloom_params=function(a){var b=D(a,["LUMINANCE_TRUNCED"]);a=D(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=
function(a,b){var c=D(a,"LUMINANCE_TRUNCED"),d=D(a,"BLOOM");if(!c||!d)return ja.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.need_perm_uniforms_update=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.need_perm_uniforms_update=!0);if("number"==typeof b.bloom_blur)for(var e=a._render.graph,c=ca.find_input(e,d,"BLOOM_BLUR"),e=ca.find_input(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].bundles[0].batch;f&&(W.set_texel_size_mult(f,
b.bloom_blur),m(c[e],1/d.camera.width,1/d.camera.height))}};a.get_wind_params=function(){var a=sb,b=O.length(a);if(0==b)return null;var a=180*Math.atan(a[0]/a[2])/Math.PI,c={};c.wind_dir=a;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=I(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return ja.error("There is no wind on the scene"),0;d=g._render;"number"==typeof c.wind_dir&&(La=[0,c.wind_dir/180*Math.PI,
-Math.PI/2],Aa.euler_to_quat(La,Ia),d.quat.set(Ia),ia(g));"number"==typeof c.wind_strength&&(d.force_strength=c.wind_strength,ia(g));z(b)};a.schedule_grass_map_update=function(a){a._render.need_grass_map_update=!0};a.get_water_surface_level=P;a.get_water_mat_params=function(a,b){var c=D(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.water_waves_height,b.waves_length=c.water_waves_length,c.water_fog_color_density)){b.water_fog_density=c.water_fog_color_density[3];var d=b.water_fog_color=[];d[0]=c.water_fog_color_density[0];
d[1]=c.water_fog_color_density[1];d[2]=c.water_fog_color_density[2]}};a.set_water_params=function(a,b){var c=D(a,"MAIN_OPAQUE");if(!c||!c.water_params)return ja.error("set_water_params() - no water parameters on this scene"),null;c=c.water_params;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&
(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=
b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.dynamic=b.water_dynamic);for(var d=H(a,Hb),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.fog_color_density&&(f.water_fog_color_density[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.fog_color_density&&f.water_fog_color_density.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.water_waves_height=b.waves_height);"number"==typeof b.waves_length&&(f.water_waves_length=b.waves_length);f.need_perm_uniforms_update=
!0}};a.get_shore_dist=function(a,b){var c=D(Bb,"MAIN_OPAQUE");if(!c.use_shoremap)return 100;var d=c.max_shore_dist,e=c.water_level,f=(a[0]-c.shoremap_center[0])/c.shoremap_size[0],g=(c.shoremap_center[1]+a[2])/c.shoremap_size[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*Aa.get_array_smooth_value(Bb._render.shore_distances,c.shoremap_tex_size,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var c=h().camera._render,d=0;d<Za.length;d++){var e=Za[d],f=e._render.graph;
if(e._render.water_params)var g=c.trans[1]-P(c.trans[0],c.trans[2]);for(var k=e._render.video_textures,l=0;l<k.length;l++){var m=k[l]._render.video_file,n=k[l]._render.frame_duration+k[l]._render.frame_offset;if(m){var r=k[l]._render,u=Math.round(m.currentTime*r.fps),t=r.frame_offset/r.fps;if(u<r.frame_offset-(ba.is_mobile_device?5:0)||k[l]._render.use_cyclic&&u>n)m.currentTime=t;!k[l]._render.use_cyclic&&u>n&&m.pause();2<=m.readyState&&ma.update_video_texture(r)}}J.traverse(f,function(b,c){-1<Ab.indexOf(c.type)&&
(c.time=a);-1<Hb.indexOf(c.type)&&e._render.water_params&&(c.cam_water_depth=g)})}if(ba.deferred_rendering)for(d=0;d<lb.length;d++)X(lb[d],a);for(d=0;d<Za.length;d++)if(e=Za[d],c=e._render,f=c.queue,c.need_shadow_update&&(q(e),c.need_shadow_update=!1),c.need_grass_map_update&&(Q(e),c.need_grass_map_update=!1),f.length){e.b4w_enable_motion_blur&&T(c.graph,b);if(ba.deferred_rendering&&c.glow){for(var k=D(e,"GLOW_MASK").bundles,s=0,l=0;l<k.length;l++)s+=k[l].batch.glow_intensity;J.traverse(e._render.graph,
function(a,b){"GLOW"===b.type&&(b.draw_glow_flag=s)})}k=null;for(l=0;l<f.length;l++)"GLOW_MASK"==f[l].type&&(k=l);for(l=0;l<f.length;l++)m=f[l],la.prerender_subs(m),null!==k&&Z(c.graph,m,f[k]),E.draw(m)}ba.show_hud_debug_info&&ha.show_debug_info(Za,b)};a.get_all_subscenes=function(a){var b=[];J.traverse(a._render.graph,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a._glow_anim={time_start:0,glow_time:b,period:c,relapses:d};-1==lb.indexOf(a)&&lb.push(a)};a.clear_glow_anim=
function(a){if(a._batches)for(var b=0;b<a._batches.length;b++){var c=a._batches[b];"COLOR_ID"==c.type&&(c.glow_intensity=0)}a=lb.indexOf(a);-1!=a&&lb.splice(a,1)};a.cleanup_glow_anim=function(){lb=[]};a.get_cam_water_depth=function(){var a=D(Bb,"MAIN_BLEND"),b=Bb;return a||b._render.water_params?a.cam_water_depth:null};a.get_object_data_id=function(a){return a._render.data_id};a.update_scene_permanent_uniforms=z;a.set_wireframe_mode=function(a,b){switch(b){case "WM_NONE":a.do_render=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=
0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_mode=da.WIREFRAME_MODES[b];a.do_render=!0}a.blend="WM_TRANSPARENT_WIREFRAME"==b;a.need_perm_uniforms_update=!0};a.set_wireframe_edge_color=function(a,b){for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_edge_color=b,a.need_perm_uniforms_update=!0};a.add_meta_objects=function(a,b){for(var c=0;c<b.length;c++)a._objects.ALL.push(b[c]),a._objects.MESH.push(b[c])};a.update_force=ia;a.pick_object=function(b,d){if(!c())return ja.error("No active scene"),
null;var e=h(),f=D(e,"COLOR_PICKING");if(f){la.prerender_subs(f);E.draw(f,f.bundles);var g=D(e,"COLOR_PICKING_XRAY");g?(la.prerender_subs(g),E.draw(g,g.bundles),f=g.camera):f=f.camera;d=f.height-d;f=E.read_pixels(f.framebuffer,b,d);e=I(e,"MESH",a.DATA_ID_ALL);for(g=0;g<e.length;g++){var k=e[g]._color_id;if(k&&5>Math.abs(255*k[0]-f[0])&&5>Math.abs(255*k[1]-f[1])&&5>Math.abs(255*k[2]-f[2]))return e[g]}}else ja.error("Color picking is not available");return null};a.get_wind=function(){return sb};a.get_selectable_objects=
function(b){var c=[];b=I(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e._render.selectable&&c.push(e)}return c}};b4w.module.__physics=function(a,p){function h(a,b){for(var c=a._descends,d=0;d<c.length;d++)c[d]._render.use_collision_compound&&b.push(c[d]),h(c[d],b);return null}function c(a,b){if(T)switch(a){case v.IN_LOG:S.log(b);break;case v.IN_ERROR:S.error(b);break;case v.IN_FBMSG:I.fbmsg.apply(this,b.slice(1));break;case v.IN_TRANSFORM:var c=f(b.body_id);if(c){var d=b.trans,e=b.quat,g=b.linvel,h=b.angvel,c=c._physics;c.curr_time=b.time;H.set_sep(d,1,e,c.curr_tsr);P.copy(g,c.linvel);P.copy(h,c.angvel)}break;
case v.IN_PROP_OFFSET:(d=f(b.chassis_hull_body_id))&&H.set_sep(b.trans,1,b.quat,d._vehicle.prop_offsets[b.prop_ind]);break;case v.IN_FLOATER_BOB_TRANSFORM:if(c=f(b[1]))d=b[4],c=c._floater.bobs[b[2]],m.set_translation(c,b[3]),m.set_rotation(c,d),m.update_transform(c);break;case v.IN_VEHICLE_SPEED:if(c=f(b[1]))c._vehicle.speed=b[2];break;case v.IN_COLLISION:for(var h=T,d=b.body_id_a,c=b.body_id_b,e=b.result,g=b.coll_point,d=parseInt(d),h=h._physics.bundles,k=0;k<h.length;k++)for(var l=h[k].physics,
n=0;n<l.collision_tests.length;n++){for(var q=l.collision_tests[n],r=q.pairs,u=!1,t=0;t<r.length;t++){var s=r[t];if(s[0]===d&&s[1]===c){q.pair_results[t]=e;u=!0;break}}if(u){r=q.pair_results;for(t=u=0;t<r.length;t++)u=u||r[t];q.callback(u,g)}}break;case v.IN_COLLISION_IMPULSE:if(c=f(b[1]))c=c._physics,c.col_imp_test_cb&&c.col_imp_test_cb(b[2]);break;case v.IN_RAY_HIT:if(c=f(b.body_id))for(c=c._physics,e=b.from,g=b.to,h=b.local,k=b.body_id_b_hit,l=b.cur_result,n=0;n<c.ray_tests.length;n++)if(r=c.ray_tests[n],
D.cmp_arr_float(r.from,e,1E-7)&&D.cmp_arr_float(r.to,g,1E-7)&&r.local==h){for(d in r.results)r.results[d]=1;-1!=k&&(r.results[k]=l);for(var q=r.collision_id,t=r.callback,r=r.results,u=!1,s=1,x=0;x<T._physics.bundles.length;x++){var w=T._physics.bundles[x].physics;if(("ANY"==q||w.id==q)&&w.body_id in r&&1!==r[w.body_id]){u=!0;s=r[w.body_id];break}}t(u,s)}break;case v.IN_PING:console.log("Physics message ping: ",performance.now()-b[1]);break;default:S.error("Wrong message: "+a)}}function f(a){return z[a]||
null}function b(){ia.body++;return ia.body}function l(a){return{body_id:a,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,is_character:!1,is_floater:!1,cons_id:null,id:"",collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,ray_tests:[],curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4)}}function e(a,b){switch(a){case "BOX":var c=b.bb_local;break;case "CYLINDER":c=b.bcyl_local;
break;case "CONE":c=b.bcon_local;break;case "SPHERE":c=b.bs_local;break;case "CAPSULE":c=b.bcap_local}return c}function k(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.center&&(b.center=a.center);"number"===typeof a.radius&&(b.radius=
a.radius);"number"===typeof a.height&&(b.height=a.height);return b}function d(a,b,c,d){var e=a._render.trans,f=b._render.world_matrix,g=new Float32Array(16);V.invert(f,g);f=new Float32Array(3);P.transformMat4(e,g,f);switch(b._vehicle.type){case 10:b=b.b4w_vehicle_settings;a=a._render.bb_local;v.post_msg(v.OUT_ADD_CAR_WHEEL,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:v.post_msg(v.OUT_ADD_BOAT_BOB,c,f,a.synchronize_pos)}}function r(a){return a._physics&&a._physics.cons_id?
!0:!1}function x(a,b,c,d,e,f,g,h,k,l){var m;ia.constraint++;m=ia.constraint.toString(16);v.post_msg(v.OUT_APPEND_CONSTRAINT,m,a,h,b._physics.body_id,c,d,e._physics.body_id,f,g,k,l);b._physics.cons_id=m}function n(a){var b=a._physics;if(b&&(0===b.mass||!0===b.is_ghost||!1===b.simulated||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a._render.trans[0]!=a._physics.cached_trans[0]||a._render.trans[1]!=a._physics.cached_trans[1]||a._render.trans[2]!=a._physics.cached_trans[2]||a._render.quat[0]!=a._physics.cached_quat[0]||
a._render.quat[1]!=a._physics.cached_quat[1]||a._render.quat[2]!=a._physics.cached_quat[2])){a._physics.cached_trans.set(a._render.trans);a._physics.cached_quat.set(a._render.quat);var b=a._physics,c=v.get_msg_cache(v.OUT_SET_TRANSFORM);c.msg_id=v.OUT_SET_TRANSFORM;c.body_id=a._physics.body_id;c.trans=a._render.trans;"DYNAMIC"===b.type?(c.quat=L,Z.identity(L)):c.quat=a._render.quat;v.post_msg(v.OUT_SET_TRANSFORM,c)}a=a._descends;for(b=0;b<a.length;b++)n(a[b])}function t(a,b,c,d,e){e=e||new Float32Array(3);
a=a._render.quat;e[0]=b;e[1]=c;e[2]=d;return P.transformQuat(e,a,e)}function w(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b._physics.bundles.length;e++){var f=b._physics.bundles[e];if("ANY"==a||f.physics.id==a)f=f.physics.body_id,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function B(a,b){v.post_msg(v.OUT_ACTIVATE,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=D.array_stringify(e.from)+D.array_stringify(e.to)+String(e.local);c[f]=c[f]||{from:e.from,to:e.to,
local:e.local,body_ids:[]};var g=c[f].body_ids,h;for(h in e.results)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].from,e=c[f].to,h=c[f].local,g=c[f].body_ids,v.post_msg(v.OUT_RAY_TEST,a,d,e,h,g)}else v.post_msg(v.OUT_RAY_TEST,a,null,null,!1,null)}function q(a,b){if(b.steering_wheel){var c=a._physics.body_id,d=b.engine_force*b.force_max,e=b.brake_force*b.brake_max,f=-b.steering*b.steering_max*2*Math.PI/b.steering_ratio;b.inverse_control&&(f*=-1);switch(b.type){case 10:v.post_msg(v.OUT_ACTIVATE,c);
v.post_msg(v.OUT_UPDATE_CAR_CONTROLS,c,d,e,f);break;case 20:v.post_msg(v.OUT_ACTIVATE,c),v.post_msg(v.OUT_UPDATE_BOAT_CONTROLS,c,d,e,f)}}}function s(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function y(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function g(a){return a.b4w_character?!0:!1}function A(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}p("__camera");var u=p("__config");p("__constraints");var S=p("__print"),I=p("__debug"),
v=p("__ipc");p("__renderer");var K=p("__scenes"),m=p("__transform"),H=p("__tsr"),D=p("__util"),U=p("__version"),P=p("vec3"),Z=p("quat"),V=p("mat4"),M=u.physics,Q=u.defaults,T=null,X=[],z=[],ia={world:0,body:0,constraint:0,shape:0},W=new Float32Array(3),L=new Float32Array(4),G=new Float32Array(4),fa=new Float32Array(16),da=new Float32Array(8),C=new Float32Array(8);a.init_engine=function(a){if(M.enabled){var b=M.uranium_path+U.timestamp();S.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+M.max_fps);
b=new Worker(b);v.init(b,c);v.post_msg(v.OUT_INIT,a,M.max_fps)}};a.attach_scene_physics=function(a){var b;ia.world++;b=ia.world;v.post_msg(v.OUT_APPEND_WORLD,b);a._physics={};a._physics.world_id=b;a._physics.bundles=[]};a.cleanup=function(){if(M.enabled){v.post_msg(v.OUT_CLEANUP);T=null;X.length=0;z.length=0;for(var a in ia)ia[a]=0}};a.append_object=function(a,c){T=c;v.post_msg(v.OUT_SET_ACTIVE_WORLD,c._physics.world_id);var f=a._render;if(!f)throw"No object render: "+a.name;if(a.parent&&f.use_collision_compound)return null;
var m=[];f.use_collision_compound&&h(a,m);for(var n=a._batches||[],u=0;u<n.length;u++){var E=n[u],t;if(!(t="PHYSICS"!=E.type))a:{for(var w=c._physics.bundles,p=0;p<w.length;p++){var C=w[p].batch;if(C&&C.id==E.id){t=!0;break a}}t=!1}if(!t)if(E.submesh.base_length)if(E.water&&c._render.water_params){var B=E;v.post_msg(v.OUT_APPEND_WATER);var H=T,I=K.get_subs(H,"MAIN_OPAQUE");if(I.water_params&&B.water_dynamics){var da={};da.dst_noise_scale0=B.dst_noise_scale0;da.dst_noise_scale1=B.dst_noise_scale1;
da.dst_noise_freq0=B.dst_noise_freq0;da.dst_noise_freq1=B.dst_noise_freq1;da.dir_min_shore_fac=B.dir_min_shore_fac;da.dir_freq=B.dir_freq;da.dir_noise_scale=B.dir_noise_scale;da.dir_noise_freq=B.dir_noise_freq;da.dir_min_noise_fac=B.dir_min_noise_fac;da.dst_min_fac=B.dst_min_fac;da.waves_hor_fac=B.waves_hor_fac;var U=I.water_waves_height,L=I.water_waves_length,M=I.water_level;I.use_shoremap?v.post_msg(v.OUT_ADD_WATER_WRAPPER,da,I.shoremap_size[0],I.shoremap_size[1],I.shoremap_center[0],I.shoremap_center[1],
I.max_shore_dist,U,L,M,I.shoremap_tex_size,H._render.shore_distances):v.post_msg(v.OUT_ADD_WATER_WRAPPER,da,0,0,0,0,0,U,L,M,0,null)}}else{if(E.use_ghost){var Q,W=a,ia=E,Hb=b(),Bb=ia.submesh;v.post_msg(v.OUT_APPEND_GHOST_MESH_BODY,Hb,Bb.va_frames[0].a_position,Bb.indices||null,W._render.trans,ia.collision_group,ia.collision_mask);var Za=l(Hb);Za.is_ghost=!0;Q=Za}else{var lb=a,qb=E,tb=b(),kb=qb.submesh;v.post_msg(v.OUT_APPEND_STATIC_MESH_BODY,tb,kb.va_frames[0].a_position,kb.indices||null,lb._render.trans,
qb.friction,qb.elasticity,qb.collision_group,qb.collision_mask);Q=l(tb)}Q.id=E.collision_id;var Na={batch:E,physics:Q};c._physics.bundles.push(Na)}else S.error("Object "+a.name+" has collision material with no assigned vertices")}if(s(a)||y(a)||g(a)||A(a)||a.b4w_collision){var La=a,Fa=f.physics_type,Ma=La._render,Ia=La.game,Ta=b();if("CAMERA"==La.type)var Wa=Ia.use_collision_bounds?Ia.collision_bounds_type:"BOX",tc=e(Wa,Ma),pb=Ma.friction,uc=Ma.elasticity,pb=.5,uc=0;else"EMPTY"==La.type?(Wa="EMPTY",
tc=null,uc=pb=0):(Wa=Ia.use_collision_bounds?Ia.collision_bounds_type:"BOX",tc=e(Wa,Ma),pb=Ma.friction,uc=Ma.elasticity);var sb=Ma.trans,Rb=Ma.quat,ub=Ia.use_ghost,ud=Ia.use_sleep,nd=Ia.mass,fc=Ia.velocity_min,qd=Ia.velocity_max,ad=Ia.damping,nc=Ia.rotation_damping,Pb=Ia.collision_group,$b=Ia.collision_mask,cd=Ma.bs_local.radius,oc=k(tc),Bc=La.b4w_correct_bounding_offset,ic;var Sc=Wa;if(m.length){var Ba=[],Ib={};Ib.quat=new Float32Array([0,0,0,1]);Ib.trans=new Float32Array(3);Ib.worker_bounding=oc;
Ib.bounding_type=Sc;Ba.push(Ib);V.invert(Ma.world_matrix,fa);Z.invert(Ma.quat,G);for(var rb=0;rb<m.length;rb++){var za={},fb=m[rb],$=fb.game.collision_bounds_type,Qa=new Float32Array(4),mb=new Float32Array(3);P.transformMat4(fb._render.trans,fa,mb);Z.multiply(G,fb._render.quat,Qa);za.trans=mb;za.quat=Qa;za.bounding_type=$;za.worker_bounding=k(e($,fb._render));Ba.push(za)}ic=Ba}else ic=[];v.post_msg(v.OUT_APPEND_BOUNDING_BODY,Ta,sb,Rb,Fa,ub,ud,nd,fc,qd,ad,nc,Pb,$b,Wa,oc,cd,pb,uc,ic,Bc);X.push(La);
z[Ta]=La;var ta=l(Ta);ta.type=Fa;ta.mass=nd;ta.is_ghost=ub;Q=ta;a._physics=Q;Na={batch:null,physics:Q};c._physics.bundles.push(Na)}if(s(a)||y(a)){var qa=a,vb=qa._physics.body_id;s(qa)?(qa._vehicle.type=10,v.post_msg(v.OUT_APPEND_CAR,vb,qa._vehicle.suspension_compression,qa._vehicle.suspension_stiffness,qa._vehicle.suspension_damping,qa._vehicle.wheel_friction,qa._vehicle.max_suspension_travel_cm)):y(qa)&&(qa._vehicle.type=20,v.post_msg(v.OUT_APPEND_BOAT,vb,qa._vehicle.floating_factor,qa._vehicle.water_lin_damp,
qa._vehicle.water_rot_damp));if(qa._vehicle.props){var xa=qa._vehicle.props;switch(qa._vehicle.type){case 10:d(xa[1],qa,vb,!0);d(xa[0],qa,vb,!0);d(xa[3],qa,vb,!1);d(xa[2],qa,vb,!1);break;case 20:for(var gb=0;gb<xa.length;gb++)d(xa[gb],qa,vb,!1)}}qa._physics.id=qa.b4w_vehicle_settings.name;q(a,a._vehicle)}else if(g(a)){var ra=a._render,bb=a._physics,Da=ra.bb_local.max_y-ra.bb_local.min_y,nb=bb.body_id,Jb=a.b4w_character_settings,Cc=Jb.walk_speed,Vb=Jb.run_speed,ac=Jb.step_height,pc=Jb.jump_strength,
wb=Jb.waterline,Mb=D.dir_ground_proj_angle(a);v.post_msg(v.OUT_APPEND_CHARACTER,nb,Mb,Da,Cc,Vb,ac,pc,wb);bb.is_character=!0}else if(A(a)){var Wb=a,Sb=Wb._physics.body_id;v.post_msg(v.OUT_APPEND_FLOATER,Sb,Wb._floater.floating_factor,Wb._floater.water_lin_damp,Wb._floater.water_rot_damp);if(Wb._floater.bobs)for(var hb=Wb._floater.bobs,Xb=0;Xb<hb.length;Xb++){var jc=hb[Xb],Xa=jc._render.trans,bc=Wb._render.world_matrix,Kb=new Float32Array(16);V.invert(bc,Kb);var gc=new Float32Array(3);P.transformMat4(Xa,
Kb,gc);v.post_msg(v.OUT_ADD_FLOATER_BOB,Sb,gc,jc.bob_synchronize_pos)}Wb._physics.is_floater=!0}else a.b4w_collision&&(Q.id=a.b4w_collision_id);for(u=0;u<X.length;u++)if(a=X[u],a._physics){var va=a;if(!r(va))for(var Oa=0;Oa<va.constraints.length;Oa++){var R=va.constraints[Oa],N=R.target,wa=R.pivot_type;if("RIGID_BODY_JOINT"==R.type&&N._physics){var oa=new Float32Array([R.pivot_x,R.pivot_y,R.pivot_z]),Ua,ka=new Float32Array([R.axis_x,R.axis_y,R.axis_z]);Ua=D.euler_to_quat(ka,new Float32Array(4));var na=
V.fromRotationTranslation(Ua,oa,new Float32Array(16)),Cb=V.multiply(va._render.world_matrix,na,new Float32Array(16)),Ca=V.invert(N._render.world_matrix,new Float32Array(16)),cb=V.multiply(Ca,Cb,Ca),Pa=D.matrix_to_trans(cb),db=D.matrix_to_quat(cb),$a=R,Ga={};Ga.use_limit_x=$a.use_limit_x;Ga.use_limit_y=$a.use_limit_y;Ga.use_limit_z=$a.use_limit_z;Ga.use_angular_limit_x=$a.use_angular_limit_x;Ga.use_angular_limit_y=$a.use_angular_limit_y;Ga.use_angular_limit_z=$a.use_angular_limit_z;Ga.limit_max_x=
$a.limit_max_x;Ga.limit_min_x=$a.limit_min_x;Ga.limit_max_y=$a.limit_max_y;Ga.limit_min_y=$a.limit_min_y;Ga.limit_max_z=$a.limit_max_z;Ga.limit_min_z=$a.limit_min_z;Ga.limit_angle_max_x=$a.limit_angle_max_x;Ga.limit_angle_min_x=$a.limit_angle_min_x;Ga.limit_angle_max_y=$a.limit_angle_max_y;Ga.limit_angle_min_y=$a.limit_angle_min_y;Ga.limit_angle_max_z=$a.limit_angle_max_z;Ga.limit_angle_min_z=$a.limit_angle_min_z;x(wa,va,oa,Ua,N,Pa,db,Ga,null,null)}}}};a.find_obj_by_body_id=f;a.update=function(a,
b){for(var c=0;c<X.length;c++){var d=X[c],e=d._physics;if(e.simulated&&e.curr_time){var f=performance.now()/1E3-e.curr_time,f=Math.min(f,10/60);Q.no_phy_interp_hack&&(f=0);var g=da;H.integrate(e.curr_tsr,f,e.linvel,e.angvel,da);m.set_translation(d,H.get_trans_view(g));m.set_rotation(d,H.get_quat_view(g));m.update_transform(d);n(d);if(d._vehicle)for(var e=d,f=e._vehicle.props,g=e._render.tsr,h=da,k=0;k<f.length;k++){var l=f[k];H.multiply(g,e._vehicle.prop_offsets[k],h);m.set_tsr(l,h);m.update_transform(l)}d._vehicle&&
d._vehicle.steering_wheel&&(e=d._vehicle,f=e.steering_wheel)&&(g=d._vehicle.steering_wheel_axis,l=fa,h=d._render.trans,k=d._render.quat,D.transform_mat4(d._vehicle.steering_wheel_matrix,1,k,h,l),D.matrix_to_trans(l,f._render.trans),D.matrix_to_quat(l,f._render.quat),l=L,D.transform_vec4(g,1,k,h,l),g=G,Z.setAxisAngle(l,-e.steering*e.steering_max*2*Math.PI,g),Z.multiply(g,f._render.quat,f._render.quat),m.update_transform(f));d._vehicle&&d._vehicle.speedometer&&(e=d._vehicle,f=e.speedometer)&&(h=d._vehicle.speedometer_axis,
g=fa,k=d._render.trans,l=d._render.quat,D.transform_mat4(d._vehicle.speedometer_matrix,1,l,k,g),D.matrix_to_trans(g,f._render.trans),D.matrix_to_quat(g,f._render.quat),g=L,D.transform_vec4(h,1,l,k,g),h=G,k=Math.abs(e.speed)*e.speed_ratio,k>e.max_speed_angle&&(k=e.max_speed_angle),Z.setAxisAngle(g,-k,h),Z.multiply(h,f._render.quat,f._render.quat),m.update_transform(f));d._vehicle&&d._vehicle.tachometer&&(e=d._vehicle,f=e.tachometer)&&(g=d._vehicle.tachometer_axis,l=fa,h=d._render.trans,k=d._render.quat,
D.transform_mat4(d._vehicle.tachometer_matrix,1,k,h,l),D.matrix_to_trans(l,f._render.trans),D.matrix_to_quat(l,f._render.quat),d=L,D.transform_vec4(g,1,k,h,d),g=G,Z.setAxisAngle(d,-Math.abs(e.engine_force)*e.delta_tach_angle,g),Z.multiply(g,f._render.quat,f._render.quat),m.update_transform(f))}}if(c=T)c=K.get_subs(c,"MAIN_OPAQUE"),c.water_params&&0<c.water_params.waves_height&&(d=P.length(c.wind),v.post_msg(v.OUT_SET_WATER_TIME,c.time*d))};a.get_active_scene=function(){return T};a.pause=function(){M.enabled&&
v.post_msg(v.OUT_PAUSE)};a.resume=function(){M.enabled&&v.post_msg(v.OUT_RESUME)};a.enable_simulation=function(a){a=a._physics;if(!a)throw"No object physics";if(!a.simulated){var b=a.body_id;a.simulated=!0;v.post_msg(v.OUT_ENABLE_SIMULATION,b)}};a.disable_simulation=function(a){a=a._physics;if(!a)throw"No object physics";if(a.simulated){var b=a.body_id;a.simulated=!1;v.post_msg(v.OUT_DISABLE_SIMULATION,b)}};a.has_physics=function(a){return a._physics?!0:!1};a.has_dynamic_physics=function(a){return(a=
a._physics)&&a.simulated&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.mass&&0==a.is_ghost?!0:!1};a.has_simulated_physics=function(a){return(a=a._physics)&&a.simulated?!0:!1};a.set_gravity=function(a,b){v.post_msg(v.OUT_SET_GRAVITY,a._physics.body_id,b)};a.has_constraint=r;a.apply_constraint=x;a.clear_constraint=function(a){a=a._physics;v.post_msg(v.OUT_REMOVE_CONSTRAINT,a.cons_id);a.cons_id=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=H.create_sep(c,1,d,da);f=H.create_sep(f,1,g,C);
H.invert(c,c);H.multiply(f,c,c);m.get_tsr(e,f);H.multiply(f,c,c);m.set_tsr(b,c);m.update_transform(b);a.set_transform(b,b._render.trans,b._render.quat)};a.set_transform=function(a,b,c){H.set_sep(a._render.trans,1,a._render.quat,a._physics.curr_tsr);var d=v.get_msg_cache(v.OUT_SET_TRANSFORM);d.msg_id=v.OUT_SET_TRANSFORM;d.body_id=a._physics.body_id;d.trans=b;d.quat=c;v.post_msg(v.OUT_ACTIVATE,a._physics.body_id);v.post_msg(v.OUT_SET_TRANSFORM,d)};a.sync_transform=n;a.apply_velocity=function(a,b,c,
d){t(a,b,c,d,W);a=a._physics.body_id;v.post_msg(v.OUT_ACTIVATE,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(W[0]),f=Math.abs(W[1]),g=Math.abs(W[2]);W[0]=e?W[0]/e*Math.max(e,b):0;W[1]=f?W[1]/f*Math.max(f,c):0;W[2]=g?W[2]/g*Math.max(g,d):0;v.post_msg(v.OUT_SET_LINEAR_VELOCITY,a,W[0],W[1],W[2])};a.apply_velocity_world=function(a,b,c,d){a=a._physics.body_id;v.post_msg(v.OUT_ACTIVATE,a);v.post_msg(v.OUT_SET_LINEAR_VELOCITY,a,b,c,d)};a.apply_force=function(a,b,c,d){t(a,b,c,d,W);a=a._physics.body_id;
v.post_msg(v.OUT_ACTIVATE,a);v.post_msg(v.OUT_APPLY_CENTRAL_FORCE,a,W[0],W[1],W[2])};a.apply_torque=function(a,b,c,d){t(a,b,c,d,W);a=a._physics.body_id;v.post_msg(v.OUT_ACTIVATE,a);v.post_msg(v.OUT_APPLY_TORQUE,a,W[0],W[1],W[2])};a.set_character_move_dir=function(a,b,c){a=a._physics.body_id;v.post_msg(v.OUT_ACTIVATE,a);v.post_msg(v.OUT_SET_CHARACTER_MOVE_DIR,a,b,c)};a.set_character_move_type=function(a,b){v.post_msg(v.OUT_SET_CHARACTER_MOVE_TYPE,a._physics.body_id,b)};a.set_character_walk_velocity=
function(a,b){v.post_msg(v.OUT_SET_CHARACTER_WALK_VELOCITY,a._physics.body_id,b)};a.set_character_run_velocity=function(a,b){v.post_msg(v.OUT_SET_CHARACTER_RUN_VELOCITY,a._physics.body_id,b)};a.set_character_fly_velocity=function(a,b){v.post_msg(v.OUT_SET_CHARACTER_FLY_VELOCITY,a._physics.body_id,b)};a.character_jump=function(a){v.post_msg(v.OUT_CHARACTER_JUMP,a._physics.body_id)};a.character_rotation_inc=function(a,b,c){v.post_msg(v.OUT_CHARACTER_ROTATION_INCREMENT,a._physics.body_id,b,c)};a.set_character_rotation=
function(a,b,c){v.post_msg(v.OUT_SET_CHARACTER_ROTATION,a._physics.body_id,b,c)};a.set_character_rotation_h=function(a,b){v.post_msg(v.OUT_SET_CHARACTER_HOR_ROTATION,a._physics.body_id,b)};a.set_character_rotation_v=function(a,b){v.post_msg(v.OUT_SET_CHARACTER_VERT_ROTATION,a._physics.body_id,b)};a.check_underwater=function(){return!1};a.check_on_surface=function(){return!1};a.check_collision=function(){S.error("check_collision() deprecated");return!1};a.check_collision_any=function(){S.error("check_collision_any() deprecated");
return!1};a.check_ray_hit=function(){S.error("check_ray_hit() deprecated");return!1};a.update_object_coords=function(){S.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a._physics,f=e.body_id;b=b||"ANY";for(var g=0;g<e.collision_tests.length;g++){var h=e.collision_tests[g];if(h.collision_id==b&&h.callback==c)return}g=[];a=a._physics.body_id;h=[];w(b,T,h,null);for(var k=0;k<h.length;k++){var l=h[k];a<l?g.push([a,l]):a>l&&g.push([l,a])}h={collision_id:b,callback:c,
pairs:g,pair_results:new Uint8Array(g.length),need_collision_pt:d||!1};e.collision_tests.push(h);v.post_msg(v.OUT_ACTIVATE,f);v.post_msg(v.OUT_APPEND_COLLISION_TEST,g,d)};a.remove_collision_test=function(a,b,c){a=a._physics;b=b||"ANY";for(var d=0;d<a.collision_tests.length;d++){var e=a.collision_tests[d];if(e.collision_id==b&&e.callback==c){a.collision_tests.splice(d,1);d--;for(var f=T._physics.bundles,e=e.pairs,g=0;g<f.length;g++)for(var h=f[g].physics,k=0;k<h.collision_tests.length;k++)for(var l=
h.collision_tests[k],m=0;m<l.pairs.length;m++)for(var n=l.pairs[m],q=0;q<e.length;q++){var r=e[q];n[0]===r[0]&&n[1]===r[1]&&(e.splice(q,1),q--)}e.length&&v.post_msg(v.OUT_REMOVE_COLLISION_TEST,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a._physics;c?(v.post_msg(v.OUT_APPLY_COLLISION_IMPULSE_TEST,c.body_id),c.col_imp_test_cb=b):S.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=function(a){var b=a._physics;b?(v.post_msg(v.OUT_CLEAR_COLLISION_IMPULSE_TEST,b.body_id),
b.col_imp_test_cb=null):S.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a._physics;if(g){a=g.body_id;b=b||"ANY";c={from:new Float32Array(c),to:new Float32Array(d),local:e,callback:f,collision_id:b,results:{}};w(b,T,null,c.results);delete c.results[a];for(var h in c.results)c.results[h]=1;g.ray_tests.push(c);B(a,g.ray_tests)}else S.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a._physics){a=b.body_id;for(var f=0;f<b.ray_tests.length;f++){var g=
b.ray_tests[f];D.cmp_arr_float(g.from,c,1E-7)&&D.cmp_arr_float(g.to,d,1E-7)&&g.local==e&&(b.ray_tests.splice(f,1),f--)}B(a,b.ray_tests)}else S.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a._vehicle;c.engine_force=b;q(a,c)};a.vehicle_steer=function(a,b){var c=a._vehicle;c.steering=b;q(a,c)};a.vehicle_brake=function(a,b){var c=a._vehicle;c.brake_force=b;q(a,c)};a.is_vehicle_chassis=s;a.is_vehicle_hull=y;a.is_car_wheel=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;
return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.is_boat_bob=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.is_floater_bob=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.is_vehicle_steering_wheel=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.is_vehicle_speedometer=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?
!0:!1};a.is_vehicle_tachometer=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a._vehicle.speed};a.wheel_index=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=g;a.is_floater_main=A;a.get_fps=function(){return 0};a.debug_worker=function(){v.post_msg(v.OUT_DEBUG)};a.remove_bounding_object=function(a){var b=
X.indexOf(a);-1!=b?(X.splice(b,1),a=z.indexOf(a),-1!=a&&z.splice(a,1)):S.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,p){function h(a,b){for(var c=W(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}tb[b.id]=null;kb[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=pa.get_width_height(a));d=a.width;a=a.height;ea.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Na)&&c&&ea.warn("B4W Warning: image",b,"is not from app root.")}function f(a,b,c,d,e,f){d=b.filepath;if(!d)throw"Nothing requested";
ja.enqueue([[d,ja.AT_JSON,d]],function(d,f,g,h){if(d){ea.log("%cLOAD METADATA","color: #616",h);f=d.b4w_format_version;if(Number(f)<Hb.min_format_version)throw"Incompatible file version: "+f+". Required: "+Hb.min_format_version;for(var k in d)a[k]=d[k];(d=a.binaries[0].binfile)?b.binary_name=d:(Y.skip_stage_by_name(b,"load_binaries"),Y.skip_stage_by_name(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)ea.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=
0;d<a.b4w_export_warnings.length;d++)ea.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);e(b,c)}},null,function(a){f(b,c,a)})}function b(a,b,c,d,e,f){d=X(b.filepath)+b.binary_name;if(!d)throw"Binary data is missing";ja.enqueue([[d,ja.AT_ARRAYBUFFER,d]],function(d,f,g,h){d&&(ea.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function l(a,b,c,d,f,g){d=a.bin_data;g=a.binaries[0];var h=a.objects,k=a.meshes;a=a.actions;for(var l=Ka.check_endians(),m=["indices"],n=
["normal","tangent"],E=["color","group"],q=["position","texcoord","texcoord2"],r=0;r<k.length;r++)for(var u=k[r].submeshes,t=0;t<u.length;t++)for(var s in u[t]){var x=u[t][s][1];if(-1!=m.indexOf(s)){var w=4*u[t][s][0]+g["int"],v=u[t],p=s,C=d;if(l)var D=new Uint32Array(C,w,x);else for(var D=new Uint32Array(x),C=new DataView(C),B=0;B<x;B++)D[B]=C.getUint32(w+4*B,!0);v[p]=D}else if(-1!=q.indexOf(s))w=4*u[t][s][0]+g["float"],u[t][s]=e(d,w,x,l);else if(-1!=n.indexOf(s)){w=2*u[t][s][0]+g["short"];v=u[t];
p=s;C=d;D=new Float32Array(x);C=new DataView(C);for(B=0;B<x;B++)D[B]=C.getInt16(w+2*B,!0)/32767;v[p]=D}else if(-1!=E.indexOf(s)){w=2*u[t][s][0]+g.ushort;v=u[t];p=s;C=d;D=new Float32Array(x);C=new DataView(C);for(B=0;B<x;B++)D[B]=C.getUint16(w+2*B,!0)/65535;v[p]=D}}for(s=0;s<h.length;s++)for(k=h[s].particle_systems,m=0;m<k.length;m++)n=k[m],n.transforms=e(d,4*n.transforms[0]+g["float"],n.transforms[1],l);for(h=0;h<a.length;h++){s=a[h];var k=s.fcurves,n=s.frame_range,m=n[0],n=n[1],E=da.get_approx_curve_length(m,
n),q=null,u=r=!1,A;for(A in k)r|=-1<A.indexOf("rotation_euler"),u|=-1<A.indexOf("rotation_quaternion");for(A in k)if(r&&u&&-1<A.indexOf("rotation_euler"))delete k[A];else{var t=k[A],y;for(y in t)x=t[y],w=e(d,g["float"]+4*x.bin_data_pos[0],x.bin_data_pos[1],l),v=new Float32Array(E),null===q&&(q=new Int8Array(E)),da.approximate_curve(x,w,v,q,m,n),x._pierced_points=v;-1<A.indexOf("rotation_euler")&&da.fcurves_replace_euler_by_quat(k,A)}s._bflags=q}f(b,c)}function e(a,b,c,d){if(d)d=new Float32Array(a,
b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function k(a,b,c,d,e,f){var g=a.cameras,h=a.groups,k=a.materials,l=a.meshes,m=a.node_groups,n=a.objects,E=a.particles,q=a.scenes,r=a.speakers,u=a.textures,s=a.worlds;m||(ea.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),m=a.node_groups=[]);for(var x="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
p={},C=0;C<x.length;C++)for(var B=a[x[C]],D=0;D<B.length;D++){var A=B[D];p[A.uuid]=A}for(var y=0;y<q.length;y++){for(var z=q[y],J=z.objects,H=0;H<J.length;H++)w(J,H,p);z.camera&&w(z,"camera",p);z.world&&w(z,"world",p)}for(y=0;y<h.length;y++)for(var Y=h[y].objects,H=0;H<Y.length;H++)w(Y,H,p);for(y=0;y<n.length;y++){var G=n[y];G.dupli_group&&w(G,"dupli_group",p);G.parent&&w(G,"parent",p);if(G.animation_data){var I=G.animation_data;I.action&&w(I,"action",p);if(I.nla_tracks)for(H=0;H<I.nla_tracks.length;H++)for(var ja=
I.nla_tracks[H],P=0;P<ja.strips.length;P++)ja.strips[P].action&&w(ja.strips[P],"action",p)}switch(G.type){case "MESH":if(!G.data)throw"mesh not found for object "+G.name;w(G,"data",p);for(var ba=G.modifiers,H=0;H<ba.length;H++){var S=ba[H];"ARMATURE"==S.type?w(S,"object",p):"CURVE"==S.type&&w(S,"object",p)}var U=G.particle_systems;if(U)for(H=0;H<U.length;H++)w(U[H],"settings",p);break;case "ARMATURE":w(G,"data",p);for(var M=G.pose.bones,ha=G.data.bones,H=0;H<M.length;H++){var T=M[H];T.bone=ha[T.bone];
for(var Q=T.parent_recursive,P=0;P<Q.length;P++)Q[P]=M[Q[P]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":w(G,"data",p)}var Aa=G.constraints;if(Aa)for(H=0;H<Aa.length;H++){var V=Aa[H];V.target&&w(V,"target",p)}var Ea=G.lod_levels;if(Ea)for(H=0;H<Ea.length;H++){var Ha=Ea[H];Ha.object&&w(Ha,"object",p)}}for(y=0;y<l.length;y++)for(var Z=l[y].materials,H=0;H<Z.length;H++)w(Z,H,p);for(y=0;y<k.length;y++){for(var la=k[y],pa=la.texture_slots,H=0;H<pa.length;H++)w(pa[H],"texture",p);var X=
la.node_tree;X&&t(X,p)}for(y=0;y<m.length;y++)(X=m[y].node_tree)&&t(X,p);for(y=0;y<u.length;y++){var ab=u[y],ia=ab.type;"IMAGE"!=ia&&"ENVIRONMENT_MAP"!=ia||w(ab,"image",p)}for(y=0;y<g.length;y++){var fa=g[y];fa.dof_object&&w(fa,"dof_object",p)}for(y=0;y<r.length;y++){var R=r[y];R.sound&&w(R,"sound",p);if(R.animation_data&&(I=R.animation_data,I.action&&w(I,"action",p),I.nla_tracks))for(H=0;H<I.nla_tracks.length;H++)for(ja=I.nla_tracks[H],P=0;P<ja.strips.length;P++)ja.strips[P].action&&w(ja.strips[P],
"action",p)}for(y=0;y<E.length;y++){for(var N=E[y],pa=N.texture_slots,H=0;H<pa.length;H++)w(pa[H],"texture",p);N.dupli_group&&w(N,"dupli_group",p);N.dupli_object&&w(N,"dupli_object",p)}for(y=0;y<s.length;y++)if(pa=s[y].texture_slots)for(H=0;H<pa.length;H++)w(pa[H],"texture",p);ma.check_bpy_data(a);La=0===b.id;Fa||(Fa=a.scenes[0]);var kb=a.textures,tb;tb=La?a.scenes[0].b4w_anisotropic_filtering:Fa.b4w_anisotropic_filtering;for(var Na=0;Na<kb.length;Na++)La||"SCENE"!=kb[Na].b4w_source_type||(kb[Na].b4w_source_id=
""),Ja.create_texture_bpy(kb[Na],tb,a.scenes);for(var ka={},na=a.objects,qb=0;qb<na.length;qb++){var Ca=na[qb];if("MESH"===Ca.type&&!Ca.particle_systems.length)for(var cb=Ca.data,Pa=cb.name,db=cb.submeshes,$a=cb.materials,Ga=0;Ga<db.length;Ga++)0!==db[Ga].base_length||ka[Pa]||($a[Ga]?ea.warn('B4W Warning: material "'+$a[Ga].name+'" is not assigned to any face (object "'+Ca.name+'").'):ea.warn('B4W Warning: Mesh "'+cb.name+'" has no faces (object "'+Ca.name+'").'),ka[Pa]=!0)}for(var Ra=a.meshes,ib=
0;ib<Ra.length;ib++){var Ia=Ra[ib];Ia.materials.length||Ia.uv_textures.length&&ea.warn('B4W Warning: mesh "'+Ia.name+'" has a UV map but has no exported material.')}var Bb=a.materials,Za=ma.create_material("DEFAULT");Bb.push(Za);for(var Ma=a.meshes,Ta=Ka.keysearch("name","DEFAULT",a.materials),Wa=0;Wa<Ma.length;Wa++){var pb=Ma[Wa];0==pb.materials.length&&pb.materials.push(Ta)}for(var sb=a.actions,uc=b.id,kc=0;kc<sb.length;kc++){var eb=sb[kc];eb._data_id=uc;da.append_action(eb)}for(var Ya=a.scenes,
rc=0;rc<Ya.length;rc++){for(var wc=Ya[rc],yb=O.combine_scene_objects(wc,"ALL"),Yb=[],Db=0;Db<yb.length;Db++)for(var cc=yb[Db].particle_systems,Hc=0;Hc<cc.length;Hc++){var Eb=cc[Hc].settings;if("HAIR"==Eb.type)if("OBJECT"==Eb.render_type)ca.update_object(Eb.dupli_object,!0);else if("GROUP"==Eb.render_type){for(var Yc=Eb.dupli_group,Zb=O.combine_scene_objects(wc,"EMPTY"),jb=0;jb<Zb.length;jb++)Zb[jb].dupli_group==Yc&&Yb.push(Zb[jb]);for(jb=0;jb<Yc.objects.length;jb++)ca.update_object(Yc.objects[jb],
!0)}else ea.warn("B4W Warning: render type",Eb.render_type,"not supported for particle systems ("+Eb.name+").")}for(Db=0;Db<Yb.length;Db++)K(Yb[Db],[wc])}L(a,b.id);for(var lc=a.scenes,Tb=0;Tb<lc.length;Tb++){for(var id=lc[Tb],Zc=[],Ic=[],hd=lc[Tb].objects,ob=0;ob<hd.length;ob++){var Qb=hd[ob];v(hd,Qb,Zc,Ic);var hc=Qb.dupli_group;if(hc)for(var Ub=hc.objects,bd=0;bd<Ub.length;bd++)v(Ub,Ub[bd],Zc,Ic)}for(ob=0;ob<Ic.length;ob++)K(Ic[ob],[id]);for(ob=0;ob<Zc.length;ob++)Ka.append_unique(Zc[ob][0],Zc[ob][1])}L(a,
b.id);for(var Nb=W(a,b.id),Na=0;Na<Nb.length;Na++){var Nc=Nb[Na];!La&&Nc.parent&&-1<tc.indexOf(Nc.parent.type)&&(Nc.parent="");ca.update_object(Nc,!1);Nc._render.data_id=b.id}for(var $c=0;$c<Nb.length;$c++){var Uc=Nb[$c];if("MESH"==Uc.type){var xc=da.get_first_armature_object(Uc);if(xc){var mc=xc._render;if(mc.anim_mixing){var Vc=Uc._render.bone_pointers,Fc=[],Lc;for(Lc in Vc){var Oc=Vc[Lc];Fc.push(4*Oc.deform_bone_index,4*Oc.bone_index)}mc.mesh_to_arm_bone_maps.push(Fc)}mc.skinned_renders.push(Uc._render)}}}for(var Pc=
-1,yc=0;yc<Nb.length;yc++){var zc=Nb[yc],Wc=zc._render;if(Ka.is_mesh(zc)&&Wc.is_skinning){var od=Wc.max_bones;od>Pc&&(Pc=od)}}for(yc=0;yc<Nb.length;yc++)if(zc=Nb[yc],Wc=zc._render,Ka.is_mesh(zc)&&Wc.is_skinning){Wc.max_bones=Pc;var Fb=zc,sc=Wc.max_bones,Jc=Hb.max_bones,Kc=Fb._render;sc>2*Jc?Ka.panic('B4W Error: too many bones for "'+Fb.name+'"'):sc>Jc?(ea.warn('B4W Warning: too many bones for "'+Fb.name+'" / '+sc+" bones (max "+Jc+"). Blending between frames will be disabled."),Kc.frames_blending=
!1):Kc.frames_blending=!0;Kc.frames_blending=Kc.frames_blending&&!lb.frames_blending_hack}for(var ed=0;ed<Nb.length;ed++){var Mc=Nb[ed];if(Ka.is_mesh(Mc)){var ya=Mc.lod_levels.length;if(ya)for(var Lb=Mc,fd=0;fd<ya;fd++){var Qc=Mc.lod_levels[fd].object;if(!Qc){Lb._render.last_lod=!0;Lb._render.lod_dist_max=Mc.lod_levels[fd].distance;break}Qc._render.lod_transition_ratio=Mc._render.lod_transition_ratio;Lb._render.lod_dist_max=Mc.lod_levels[fd].distance;Qc._render.lod_dist_min=Mc.lod_levels[fd].distance;
if(Mc.lod_levels[fd+1])Qc._render.lod_dist_max=Mc.lod_levels[fd+1].distance;else{Qc._render.last_lod=!0;Qc._render.lod_dist_max=1E4;break}Lb._render.last_lod=!1;Lb=Qc}}}for(var Ob=0;Ob<Nb.length;Ob++){var sa=Nb[Ob];if(sa.b4w_vehicle){var dc=sa.b4w_vehicle_settings;if("CHASSIS"==dc.part){sa._vehicle={};sa._vehicle.force_max=dc.force_max;sa._vehicle.brake_max=dc.brake_max;sa._vehicle.suspension_compression=dc.suspension_compression;sa._vehicle.suspension_stiffness=dc.suspension_stiffness;sa._vehicle.suspension_damping=
dc.suspension_damping;sa._vehicle.wheel_friction=dc.wheel_friction;sa._vehicle.roll_influence=dc.roll_influence;sa._vehicle.max_suspension_travel_cm=dc.max_suspension_travel_cm;sa._vehicle.engine_force=0;sa._vehicle.brake_force=1;sa._vehicle.steering=0;sa._vehicle.speed=0;sa._vehicle.props=[];sa._vehicle.prop_offsets=[];sa._vehicle.steering_wheel=null;for(var Gb=sa._dg_parent?sa._dg_parent.dupli_group.objects:Nb,gd=0;gd<Gb.length;gd++){var Sa=Gb[gd];if(Sa.b4w_vehicle){var ec=Sa.b4w_vehicle_settings;
if(ua.is_car_wheel(Sa)&&dc.name==ec.name){var kd=ua.wheel_index(Sa.b4w_vehicle_settings.part);sa._vehicle.props[kd]=Sa;sa._vehicle.prop_offsets[kd]=new Float32Array(8)}else if(ua.is_vehicle_steering_wheel(Sa)&&dc.name==ec.name){sa._vehicle.steering_wheel=Sa;sa._vehicle.steering_max=ec.steering_max;sa._vehicle.steering_ratio=ec.steering_ratio;sa._vehicle.inverse_control=ec.inverse_control;var Ac=Ab.invert(sa._render.world_matrix,new Float32Array(16)),jd=Ab.multiply(Ac,Sa._render.world_matrix,Ac);sa._vehicle.steering_wheel_matrix=
jd;var rd=new Float32Array([1,0,0,0]);zb.transformMat4(rd,jd,rd);sa._vehicle.steering_wheel_axis=rd}else if(ua.is_vehicle_speedometer(Sa)&&dc.name==ec.name){sa._vehicle.speedometer=Sa;sa._vehicle.speed_ratio=ec.speed_ratio;sa._vehicle.max_speed_angle=ec.max_speed_angle;var Ac=Ab.invert(sa._render.world_matrix,new Float32Array(16)),ld=Ab.multiply(Ac,Sa._render.world_matrix,Ac);sa._vehicle.speedometer_matrix=ld;var Rc=new Float32Array([1,0,0,0]);zb.transformMat4(Rc,ld,Rc);sa._vehicle.speedometer_axis=
Rc}else if(ua.is_vehicle_tachometer(Sa)&&dc.name==ec.name){sa._vehicle.tachometer=Sa;sa._vehicle.delta_tach_angle=ec.delta_tach_angle;var Ac=Ab.invert(sa._render.world_matrix,new Float32Array(16)),Gc=Ab.multiply(Ac,Sa._render.world_matrix,Ac);sa._vehicle.tachometer_matrix=Gc;var pd=new Float32Array([1,0,0,0]);zb.transformMat4(pd,Gc,pd);sa._vehicle.tachometer_axis=pd}}}if(4!=sa._vehicle.props.length)throw"Not enough wheels for chassis "+sa.name;}else if("HULL"==dc.part){sa._vehicle={};sa._vehicle.props=
[];sa._vehicle.prop_offsets=[];sa._vehicle.force_max=dc.force_max;sa._vehicle.brake_max=dc.brake_max;sa._vehicle.floating_factor=dc.floating_factor;sa._vehicle.water_lin_damp=dc.water_lin_damp;sa._vehicle.water_rot_damp=dc.water_rot_damp;sa._vehicle.engine_force=0;sa._vehicle.brake_force=1;sa._vehicle.steering=0;sa._vehicle.speed=0;sa._vehicle.steering_wheel=null;for(var vd=sa._dg_parent?sa._dg_parent.dupli_group.objects:Nb,gd=0;gd<vd.length;gd++)Sa=vd[gd],Sa.b4w_vehicle&&(ec=Sa.b4w_vehicle_settings,
ua.is_boat_bob(Sa)&&dc.name==ec.name?(sa._vehicle.props.push(Sa),sa._vehicle.prop_offsets.push(new Float32Array(8))):ua.is_vehicle_steering_wheel(Sa)&&dc.name==ec.name?(sa._vehicle.steering_wheel=Sa,sa._vehicle.steering_max=ec.steering_max,sa._vehicle.steering_ratio=ec.steering_ratio,sa._vehicle.inverse_control=ec.inverse_control,Ac=Ab.invert(sa._render.world_matrix,new Float32Array(16)),jd=Ab.multiply(Ac,Sa._render.world_matrix,Ac),sa._vehicle.steering_wheel_matrix=jd,rd=new Float32Array([1,0,0,
0]),zb.transformMat4(rd,jd,rd),sa._vehicle.steering_wheel_axis=rd):ua.is_vehicle_speedometer(Sa)&&dc.name==ec.name?(sa._vehicle.speedometer=Sa,sa._vehicle.speed_ratio=ec.speed_ratio,sa._vehicle.max_speed_angle=ec.max_speed_angle,Ac=Ab.invert(sa._render.world_matrix,new Float32Array(16)),ld=Ab.multiply(Ac,Sa._render.world_matrix,Ac),sa._vehicle.speedometer_matrix=ld,Rc=new Float32Array([1,0,0,0]),zb.transformMat4(Rc,ld,Rc),sa._vehicle.speedometer_axis=Rc):ua.is_vehicle_tachometer(Sa)&&dc.name==ec.name&&
(sa._vehicle.tachometer=Sa,sa._vehicle.delta_tach_angle=ec.delta_tach_angle,Ac=Ab.invert(sa._render.world_matrix,new Float32Array(16)),Gc=Ab.multiply(Ac,Sa._render.world_matrix,Ac),sa._vehicle.tachometer_matrix=Gc,pd=new Float32Array([1,0,0,0]),zb.transformMat4(pd,Gc,pd),sa._vehicle.tachometer_axis=pd))}}}for(var sd=0;sd<Nb.length;sd++){var md=Nb[sd];if(md.b4w_floating){var xd=md.b4w_floating_settings;if("MAIN_BODY"==xd.part){md._floater={};md._floater.floating_factor=xd.floating_factor;md._floater.water_lin_damp=
xd.water_lin_damp;md._floater.water_rot_damp=xd.water_rot_damp;md._floater.bobs=[];for(var Bd=md._dg_parent?md._dg_parent.dupli_group.objects:Nb,zd=0;zd<Bd.length;zd++){var wd=Bd[zd];if(wd.b4w_floating){var Fd=wd.b4w_floating_settings;ua.is_floater_bob(wd)&&xd.name==Fd.name&&(md._floater.bobs.push(wd),wd.bob_synchronize_pos=wd.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function d(a,b,c,d,e,f){!La&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],ea.warn("B4W Warning: loading data contains multiple scenes.",
"Only the first one will be loaded."));-1==lb.framerate&&La&&(lb.framerate=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){f=a.scenes[d];if(La&&!f.camera)throw"Scene check failed: No camera";for(var g=O.combine_scene_objects(f,"MESH"),h=0;h<g.length;h++){var k=g[h],l=ma.apply_mesh_modifiers(k);l&&(a.meshes.push(l),k.data=l)}for(var h=W(a,b.id),k=a.meshes,l=k.slice(0),m=0;m<h.length;m++){var n=h[m];"MESH"==n.type&&(n=l.indexOf(n.data),-1<n&&l.splice(n,1))}for(m=0;m<l.length;m++)k.splice(k.indexOf(l[m]),
1);La?(O.append_scene(f,a.textures),f._render.video_textures.length&&(b.has_video_textures=!0),Za.enabled&&f.b4w_enable_physics&&ua.attach_scene_physics(f),f.b4w_enable_audio&&ba.attach_scene_sfx(f),h=O.get_graph(f),k=f.b4w_batch_grid_size):(O.append_to_existed_scene(f,Fa,a.textures),Za.enabled&&f.b4w_enable_physics&&!Fa._physics&&ua.attach_scene_physics(Fa),f.b4w_enable_audio&&!Fa._sfx&&ba.attach_scene_sfx(Fa),h=O.get_graph(Fa),k=Fa.b4w_batch_grid_size);g=C.generate_main_batches(h,k,g,f.world,Fa._render.lamps_number);
La?(O.add_meta_objects(f,g),O.generate_auxiliary_batches(h)):O.add_meta_objects(Fa,g)}d=a.materials;if(Bb.dds_available&&Hb.use_dds)for(a=0;a<d.length;a++){f=d[a];k=f.texture_slots;for(g=0;g<k.length;g++)if(l=k[g],m=l.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)h=m.image,h._is_dds||(-1<h.filepath.indexOf(".dds")?h._is_dds=!0:(h._is_dds=!m.b4w_disable_compression&&!l.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=h.source,h._is_dds&&(h.filepath+=".dds")));if(g=f.node_tree)for(k=
g.nodes,g=0;g<k.length;g++)h=k[g],"TEXTURE"==h.type&&((l=h.texture)?(h=l.image,h._is_dds||(h._is_dds=l._render.allow_node_dds&&!l.b4w_disable_compression&&"MOVIE"!=h.source,h._is_dds&&(h.filepath+=".dds"))):ea.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],g=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds")),f._is_dds=g;e(b,c)}function r(a,b,c,d,e,f){d=a.groups;a=a.objects;f={};for(var g={},h={},k={},l=0;l<d.length;l++){var m=d[l];
f[m.uuid]=m;h[m.uuid]=m}for(l=0;l<a.length;l++)m=a[l],g[m.uuid]=m,k[m.uuid]=m;x(a,null,k,h);for(var n in h)n in f||d.push(h[n]);for(n in k)n in g||a.push(k[n]);e(b,c)}function x(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var m=Ka.clone_object_json(l[g]);m.name+="_CLONE";h.constraints.push(m)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&
(k.animation_data=Ka.clone_object_json(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=Ka.get_index_for_key_value(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=Ka.clone_object_json(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,n(l),c[l.uuid]=l,e[g.uuid]=
l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=Ka.clone_object_json(l),k.name=Ka.unique_name(l.name+"_CLONE"),k.uuid=E.hexdigest("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,x(k.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(ea.warn("B4W Warning: Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=
l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var q in e)Ma[q]=e[q]}function n(a){a.uuid=E.hexdigest("Object"+a.name)}function t(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"MATERIAL"!=e.type&&"MATERIAL_EXT"!=e.type||!e.material||w(e,"material",
b);"TEXTURE"==e.type&&e.texture&&w(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in Ma&&(e.lamp.uuid=Ma[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&w(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];B(f,"from_node",c);B(f,"to_node",c);q(f,"from_socket",f.from_node.outputs);q(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&w(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&
w(e.strips[f],"action",b)}function w(a,b,c){(c=c[a[b].uuid])||ea.error("Dangling link found:",b,a);a[b]=c}function B(a,b,c){c=Ka.keysearch("name",a[b].name,c);a[b]=c}function q(a,b,c){c=Ka.keysearch("identifier",a[b].identifier,c);a[b]=c}function s(a,b,d,e,f,g){if(!Hb.do_not_load_resources){for(var h=X(b.filepath),k=a.images,l={},m=[],n=0;n<k.length;n++){var E=k[n],q=E.uuid;if("FILE"===E.source||"MOVIE"===E.source){var r=y(E,a.textures);if(!r.length)ea.warn("B4W Warning: image ",E.name," has no users.");
else if(!r[0].b4w_shore_dist_map){r=ia(h+E.filepath);if("FILE"===E.source){var u=E._is_dds?ja.AT_ARRAYBUFFER:ja.AT_IMAGE_ELEMENT;if(Bb.min50_available&&Hb.use_min50){var t=ja.split_extension(r);"dds"==t[1]?(r=ja.split_extension(t[0]),r=r[0]+".min50."+r[1]+".dds"):r=t[0]+".min50."+t[1]}}else"MOVIE"===E.source&&(t=ja.split_extension(r),u=ba.detect_video_container(t[1]),""!=u&&(r=t[0]+"."+u),u=ja.AT_VIDEO_ELEMENT);m.push([q,u,r,E.name]);l[q]=E}}}m.length?(e.image_counter=0,ja.enqueue(m,function(f,h,
k,n){if(f){if(k==ja.AT_VIDEO_ELEMENT){k=f.videoWidth;var E=f.videoHeight;ea.log("%cLOAD VIDEO "+k+"x"+E,"color: #"+(2048<k||2048<E?"a00":1024<k||1024<E?"aa0":"0a0"),n);-1==n.indexOf(Na)&&ea.warn("B4W Warning: video",n,"is not from app root.")}else c(f,n,!0);h=l[h];n=y(h,a.textures);for(k=0;k<n.length;k++)E=n[k],Ja.update_texture(E._render,f,h._is_dds,E.image.filepath)}f=++e.image_counter/m.length;g(b,d,f)},function(){ea.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function y(a,b){for(var c=
[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function g(a,b,c,d,e,f){if(!Hb.do_not_load_resources){a=W(a,b.id);for(var g=X(b.filepath),h=[],k={},l=0;l<a.length;l++){var m=a[l];if(A(m)){var n=m.data.sound,E=n.uuid;"BACKGROUND_MUSIC"==ba.get_spk_behavior(m)?(E=Ka.gen_uuid(),b.has_background_music=!0):"NONE"!=ba.get_spk_behavior(m)&&Hb.init_wa_context_hack&&(b.init_wa_context=!0);if(!(E in k)){k[E]=[];n=ia(g+n.filepath);switch(ba.source_type(m)){case ba.AST_ARRAY_BUFFER:var q=ja.AT_AUDIOBUFFER;
break;case ba.AST_HTML_ELEMENT:q=ja.AT_AUDIO_ELEMENT}var n=ja.split_extension(n),r=ba.detect_audio_container(n[1]);if(r!=n[1]){if(J.is_built_in_data()){Y.skip_stage_by_name(b,"load_speakers");return}n=n[0]+".lossconv."+r}else n=n[0]+"."+r;h.push([E,q,n])}k[E].push(m)}}h.length?ja.enqueue(h,function(a,e,g,l){if(a)for(ea.log("%cLOAD SOUND","color: #0aa",l),-1==l.indexOf(Na)&&ea.warn("B4W Warning: sound",l,"is not from app root."),e=k[e],g=0;g<e.length;g++)ba.update_spkobj(e[g],a);a=++d.sound_counter/
h.length;f(b,c,a)},function(){ea.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function A(a){return ba.is_speaker(a)&&ba.source_type(a)!=ba.AST_NONE?!0:!1}function u(a,b){for(var c=O.get_scene_objs(a,"SPEAKER",O.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];ba.is_speaker(e)&&(ba.is_cyclic(e)||b)&&ba.play_def(e)}}function S(a){a=a._render.video_textures;for(var b=0;b<a.length;b++)a[b]._render.video_file&&a[b].use_auto_refresh&&a[b]._render.video_file.play()}function I(a,b,c,d,e,f){Ea.start();
ea.log("%cSTART NLA","color: #0a0");e(b,c)}function v(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;if(h){var k=Ka.clone_object_nr(h);k.name=b.name+"_LOD_"+String(f+1);n(k);k.lod_levels=[];c.push([a,k]);d.push(h);g.object=k}}}function K(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}
function m(a,b,c,d,e,f){for(d=0;d<a.scenes.length;d++){f=a.scenes[d];var g=La?f.b4w_enable_physics:Fa.b4w_enable_physics||f.b4w_enable_physics;La||(f=Fa);for(var h=0;h<pb.length;h++)for(var k=O.get_scene_objs(f,pb[h],O.DATA_ID_ALL),l=0;l<k.length;l++){var m=k[l];m._render.data_id==b.id&&Za.enabled&&g&&(ua.append_object(m,f),b.load_hidden&&ua.has_physics(m)&&ua.disable_simulation(m))}}e(b,c)}function H(a,b,d,e,f,g){var h={};e=[];var k=a.scenes;for(g=0;g<a.scenes.length;g++){var l=k[g];if(l._render.water_params&&
(l=l._render.water_params.shoremap_image)&&"FILE"===l.source){var m=l.uuid,n=X(b.filepath),n=ia(n+l.filepath);e.push([m,l._is_dds?ja.AT_ARRAYBUFFER:ja.AT_IMAGE_ELEMENT,n,l.name]);h[m]=l}}e.length?ja.enqueue(e,function(b,d,e,f){if(b){c(b,f,!0);d=h[d];f=y(d,a.textures);for(e=0;e<f.length;e++){var g=f[e];Ja.update_texture(g._render,b,d._is_dds,g.image.filepath)}for(e=0;e<k.length;e++)if(f=k[e],f._render.water_params.shoremap_image===d){var l=b,m=d,n=document.createElement("canvas"),g=m.size[0],m=m.size[1];
n.width=g;n.height=m;n=n.getContext("2d");n.drawImage(l,0,0);l=n.getImageData(0,0,g,m).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var g=g*m,m=new Float32Array(g),E=0;E<g;E++)m[E]=n[1]*l[4*E+2]+n[2]*l[4*E+3];f._render.shore_distances=m}}},function(){f(b,d)}):f(b,d)}function D(a,b,d,e,f,g){if(Hb.antialiasing&&Hb.smaa){e=a.scenes[0];a=[];var h=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"];for(g=0;g<h.length;g++){var k=
O.get_subs(e,h[g]);k&&a.push(k)}if(a.length){e=[];X(b.filepath);g=ja.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",g,J.paths.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",g,J.paths.smaa_area_texture_path,"smaa_area_texture"]);for(g=0;g<a.length;g++)if(h=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==h.type){a=h.slinks_internal;for(g=0;g<a.length;g++)if(h=a[g],"u_search_tex"==h.to)var l=h.texture;else if("u_area_tex"==h.to)var m=h.texture;break}e.length?ja.enqueue(e,function(a,b,d,
e){a&&(c(a,e,!1),b="SEARCH_TEXTURE"==b?l:m,b.source="IMAGE",b.auxilary_texture=!0,d=-1!=e.indexOf(".dds")?1:0,Ja.update_texture(b,a,d,e),Ja.set_filters(b,Ja.TF_LINEAR,Ja.TF_LINEAR))},function(){f(b,d)}):f(b,d)}else f(b,d)}else f(b,d)}function U(a,b,c,d,e,f){for(c=0;c<a.scenes.length;c++){e=a.scenes[c];La||(e=Fa);f=O.get_scene_objs(e,"ALL",O.DATA_ID_ALL);for(var g=0;g<f.length;g++){var h=f[g];h._render.data_id==b.id&&(b.load_hidden&&O.hide_object(h),d.added_objects.push({scene:e,obj:h}))}}}function P(a,
b,c,d,e,f){a=d.added_objects;var g=d.obj_counter;a.length?(e=a[g].obj,g=a[g].scene,O.append_object(g,e),-1!=uc.indexOf(e.type)&&g.b4w_enable_audio&&ba.append_object(e,g),d=++d.obj_counter/a.length):d=1;f(b,c,d)}function Z(a,b,c,d,e,f){if(La){for(d=0;d<a.scenes.length;d++)f=a.scenes[d],O.sort_lamps(f),O.prepare_rendering(f),f.b4w_use_nla&&Ea.update_scene_nla(f,f.b4w_nla_cyclic);O.set_active(a.scenes[0])}else O.update_scene_permanent_uniforms(Fa);a=W(a,b.id);ca.update_objects_dynamics(a);e(b,c)}function V(a,
b,c,d,e,f){if(La)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||S(a.scenes[d]),u(a.scenes[d]);else a.scenes[0].b4w_use_nla||S(Fa),u(Fa);e(b,c)}function M(a,b,c,d,e,f){Hb.is_mobile_device&&(b.has_video_textures||b.has_background_music||b.init_wa_context)?Ia||Q(a,e,b,c):e(b,c)}function Q(a,b,c,d){var e=sb.canvas.parentElement;Wa=e.style.zIndex;e.style.zIndex="999";Ia=document.createElement("div");Ia.style.position="relative";Ia.style.height="88px";Ia.style.width="88px";var f=Math.round(sb.canvas.offsetHeight/
2-44),g=Math.round(sb.canvas.offsetWidth/2-44);Ia.style.top=f.toString()+"px";Ia.style.left=g.toString()+"px";Ia.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Ta=document.createElement("div");Ta.style.position="relative";Ta.style.height=sb.canvas.offsetHeight.toString()+"px";Ta.style.width=sb.canvas.offsetWidth.toString()+"px";Ta.style.background="rgba(0, 0, 0, 0.5)";Ta.style.zIndex="999";e.appendChild(Ta);Ta.appendChild(Ia);Ia.addEventListener("click",function(){c.has_video_textures&&(Ja.play(),Ja.pause());if(c.has_background_music){if(La)for(var e=0;e<a.scenes.length;e++)u(a.scenes[e],!0);else u(Fa,!0);ba.pause()}c.init_wa_context&&ba.play_empty_sound();
T();b(c,d)},!1)}function T(){if(Ia){var a=sb.canvas.parentElement;a.style.zIndex=Wa;Ta.removeChild(Ia);a.removeChild(Ta);Ia=Ta=null;Wa=0}}function X(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function z(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<
b;d++)a="/"+a;return a||"."}function ia(a){var b=a.split("://",2);return 1<b.length?(b[1]=z(b[1]),b.join("://")):z(a)}function W(a,b){kb[b]||L(a,b);return kb[b]}function L(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)G(c[e].objects,0,d);kb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)kb[b].push(g[h])}function G(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=fa(f);d[g]=d[g]||[];(La||-1==tc.indexOf(f.type))&&-1==d[g].indexOf(f)&&
d[g].push(f);(f=f.dupli_group)&&G(f.objects,b+1,c)}}function fa(a){return(a=a.parent||da.get_first_armature_object(a))?1+fa(a):0}var da=p("__animation"),C=p("__batch"),J=p("__config"),ha=p("__controls"),pa=p("__dds"),la=p("__extensions");p("__lights");var Y=p("__loader"),ja=p("__assets"),E=p("__md5"),ca=p("__objects"),ua=p("__physics"),ea=p("__print"),ma=p("__reformer"),Aa=p("__renderer"),O=p("__scenes"),Ea=p("__nla"),ba=p("__sfx"),Ha=p("__shaders"),Ja=p("__textures"),ab=p("__nodemat"),Ka=p("__util"),
zb=p("vec4"),Ab=p("mat4"),Hb=J.defaults,Bb=J.assets,Za=J.physics,lb=J.animation,qb=J.sfx,tb=null,kb=null,Na="",La=!1,Fa=null,Ma={},Ia=null,Ta=null,Wa=0,tc=["LAMP","CAMERA"],pb=["MESH","CAMERA","EMPTY"],uc=["SPEAKER"],sb=null;a.is_primary_loaded=function(a){return Y.is_primary_loaded(a)};a.update=function(){Y.update_scheduler(tb)};a.setup_context=function(a){sb=a};a.update_media_controls=function(a,b){if(Ia){Ta.style.height=b.toString()+"px";Ta.style.width=a.toString()+"px";var c=Math.round(b/2-44),
d=Math.round(a/2-44);Ia.style.top=c.toString()+"px";Ia.style.left=d.toString()+"px"}};a.load=function(a,c,e,n,E){var q={load_main:{priority:Y.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:f},duplicate_objects:{priority:Y.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:50,primary_only:!1,cb_before:r},load_binaries:{priority:Y.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,
primary_only:!1,cb_before:b},prepare_bindata:{priority:Y.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:0,primary_only:!1,cb_before:l},prepare_root_datablocks:{priority:Y.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:150,primary_only:!1,cb_before:k},prepare_root_scenes:{priority:Y.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_root_datablocks"],is_resource:!1,relative_size:350,
primary_only:!1,cb_before:d},load_smaa_textures:{priority:Y.ASYNC_PRIORITY,background_loading:!0,inputs:["prepare_root_scenes"],is_resource:!1,relative_size:10,primary_only:!0,cb_before:D},load_shoremap:{priority:Y.ASYNC_PRIORITY,background_loading:!0,inputs:["prepare_root_scenes"],is_resource:!1,relative_size:10,primary_only:!0,cb_before:H},load_textures:{priority:Y.ASYNC_PRIORITY,background_loading:!0,inputs:["prepare_root_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:s,cb_param:{image_counter:0}},
add_physics_objects:{priority:Y.SYNC_PRIORITY,background_loading:!1,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_before:m},add_objects:{priority:Y.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],is_resource:!1,relative_size:800,primary_only:!1,cb_before:U,cb_loop:P,cb_after:Z,cb_param:{added_objects:[],obj_counter:0}},load_speakers:{priority:Y.ASYNC_PRIORITY,background_loading:!0,inputs:["add_objects"],is_resource:!0,relative_size:30,primary_only:!1,
cb_before:g,cb_param:{sound_counter:0}},mobile_media_start:{priority:Y.SYNC_PRIORITY,background_loading:!Hb.is_mobile_device,inputs:["load_textures","load_speakers"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:M,cb_loop:M},synchronize_media:{priority:Y.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!0,relative_size:70,primary_only:!1,cb_before:V},start_nla:{priority:Y.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!1,relative_size:5,
primary_only:!1,cb_before:I}},u=Y.get_scheduler();u||(u=Y.create_scheduler(),tb=[],kb=[],Ma={});tb[u.threads.length]={};return Y.create_thread(q,a,c,e,h,n||qb.audio_loading_hack,Hb.do_not_load_resources,E)};a.unload=function(a){var b=Y.get_scheduler();if(!b||!b.threads.length||a&&!Y.thread_is_finished(b.threads[a]))ea.error("Unable to unload data!");else{if(0==a)ea.log("%cUNLOAD ALL","color: #00a"),da.cleanup(),ba.cleanup(),Ea.cleanup(),O.cleanup(),Y.cleanup(),ua.cleanup(),ca.cleanup(),Ka.cleanup(),
Aa.cleanup(),ab.cleanup(),Ha.cleanup(),ha.cleanup(),la.cleanup(),ja.cleanup(),Ja.cleanup(),kb=null,Ma={},La=!1,tb=Fa=null;else{ea.log("%cUNLOAD DATA "+a,"color: #00a");da.remove_actions(a);for(var b=O.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=O.get_scene_objs(d,"ALL",O.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g._render.data_id==a){var h=d,k=g;da.is_animated(k)&&da.remove(k);O.clear_glow_anim(k);ua.has_physics(k)&&(ua.disable_simulation(k),ua.remove_bounding_object(k));ha.check_sensor_manifold(k)&&
ha.remove_sensor_manifold(k);O.remove_object_bundles(h,k);ba.is_speaker(k)&&ba.speaker_remove(k);e.splice(f,1);h=O.get_scene_objs(d,g.type,O.DATA_ID_ALL);g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}T()}};a.set_debug_resources_root=function(a){Na=a}};b4w.module.__batch=function(a,p){function h(a){a={type:a,id:0,render_id:0,odd_id_prop:"",textures:[],texture_names:[],material_names:[],node_elements:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:null,attribute_setters:[],particle_system:null,bufs_data:null,bone_pointers:null,childs:null,debug_sphere_dynamic:!1,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,glow_intensity:0,grass_scale_threshold:0,grass_size:0,grass_map_dim:new Float32Array(3),
color_id:new Float32Array(3),cube_fog:new Float32Array(16),blend:!1,color_mask:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,dynamic_grass:!1,procedural_sky:!1,draw_mode:Q.DM_DEFAULT,zsort_type:Q.ZSORT_DISABLED,texel_size_multiplier:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,halo_stars_height:0,
halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:Array(2),normalmap_uv_velocities:Array(4),colormap0_uv_velocity:new Float32Array(2),specular_params:new Float32Array(3),texture_scale:new Float32Array(3),specular_color:new Float32Array(3),
diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(4),lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,lamp_light_factors:null,water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),
shore_water_col:new Float32Array(3),normalmap_scales:null,refractive:!1,p_length:0,p_cyclic:0,p_nfactor:0,p_gravity:0,p_max_lifetime:0,p_mass:0,p_fade_in:0,p_fade_out:0,p_size:0,p_alpha_start:0,p_alpha_end:0,p_size_ramp_length:0,p_color_ramp_length:0,p_wind:new Float32Array(3),p_size_ramp:new Float32Array(8),p_color_ramp:new Float32Array(16)};a.diffuse_color[3]=1;a.color_mask=!0;a.depth_mask=!0;a.texel_size_multiplier=1;return a}function c(a,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g._render,
k=l(g.data.b4w_bounding_box),m=g.data.b4w_bounding_cylinder_radius,n=g.data.b4w_bounding_sphere_radius,q=g.data.b4w_bounding_sphere_center,r=g.data.b4w_bounding_ellipsoid_axes,u=g.data.b4w_bounding_ellipsoid_center;if(h.billboard){var n=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),m=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),t=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),t=Math.sqrt(n*n+m*m+t*t),n=Math.sqrt(n*n+m*m);k.max_x=k.max_y=k.max_z=t;k.min_x=k.min_y=k.min_z=-t;m=n;n=t;q[0]=q[1]=q[2]=
0;r[0]=r[1]=r[2]=t;u[0]=u[1]=u[2]=0}h.bb_local=k;t=P.bounding_box_transform(k,h.world_matrix);h.bb_world=t;var t=h,s=m;t.bcyl_local=P.create_bounding_cylinder(s,k);t.bcap_local=P.create_bounding_capsule(m,k);t.bcon_local=P.create_bounding_cone(s,k);q=P.create_bounding_sphere(n,q);h.bs_local=q;q=P.bounding_sphere_transform(q,h.world_matrix);h.bs_world=q;r=P.create_bounding_ellipsoid([r[0],0,0],[0,r[1],0],[0,0,r[2]],u);h.be_local=r;r=P.bounding_ellipsoid_transform(r,h.tsr);h.be_world=r;e=e.concat(b(g,
h,c,d))}return e}function f(a,c,d,e){for(var f=[],g=[],h={},k=0;k<a.length;k++){var m=a[k],n=m._render,q=l(m.data.b4w_bounding_box),r=P.bounding_box_transform(q,n.world_matrix),u=P.create_bounding_sphere(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),t=P.bounding_sphere_transform(u,n.world_matrix),s=m.data.b4w_bounding_ellipsoid_axes,s=P.create_bounding_ellipsoid([s[0],0,0],[0,s[1],0],[0,0,s[2]],m.data.b4w_bounding_ellipsoid_center),x=P.bounding_ellipsoid_transform(s,n.tsr);
n.bb_local=q;n.bb_world=r;n.bs_local=u;n.bs_world=t;n.be_local=s;n.be_world=x;q={};q.shadow_cast=n.shadow_cast;q.shadow_cast_only=n.shadow_cast_only;q.shadow_receive=n.shadow_receive;q.selectable=n.selectable;q.origin_selectable=n.origin_selectable;q.glow_anim_settings=n.glow_anim_settings;q.reflexible=n.reflexible;q.reflexible_only=n.reflexible_only;q.reflective=n.reflective;q.caustics=n.caustics;q.wind_bending=n.wind_bending;q.main_bend_col=n.main_bend_col;q.detail_bend_col=n.detail_bend_col;q.billboard=
n.billboard;q.billboard_type=n.billboard_type;q.dynamic_grass=n.dynamic_grass;q.do_not_cull=n.do_not_cull;q.disable_fogging=n.disable_fogging;q.dynamic_geometry=n.dynamic_geometry;r=n.bs_world.center;q.grid_id=0==d?[0,0]:[Math.floor(r[0]/d),Math.floor(r[2]/d)];q.lod_dist_max=n.lod_dist_max;q.lod_dist_min=n.lod_dist_min;q.lod_transition_ratio=n.lod_transition_ratio;n=JSON.stringify(q);h[n]=h[n]||[];h[n].push(m)}for(var w in h){q=JSON.parse(w);d=h[w];var m=z.create_render("STATIC"),p;for(p in q)m[p]=
q[p];m.data_id=a[0]._render.data_id;m.wind_bending_amp=0;m.wind_bending_freq=0;m.detail_bending_freq=0;m.detail_bending_amp=0;m.branch_bending_amp=0;m.hide=!1;for(k=0;k<d.length;k++)n=d[k],0==k?(m.bb_world=J.clone_object_r(n._render.bb_world),m.bs_world=J.clone_object_r(n._render.bs_world),m.be_local=J.clone_object_r(n._render.be_local),m.be_world=J.clone_object_r(n._render.be_world)):(P.expand_bounding_box(m.bb_world,n._render.bb_world),P.expand_bounding_sphere(m.bs_world,n._render.bs_world));m.bb_local=
J.clone_object_r(m.bb_world);m.bs_local=J.clone_object_r(m.bs_world);g.push({render:m,objects:d})}for(a=0;a<g.length;a++)for(h=g[a].render,k=g[a].objects,w=0;w<k.length;w++){p=k[w];d=b(p,h,c,e);m=I(p._render)||I(h);n={};h.wind_bending&&(n.au_center_pos=[m[0],m[1],m[2]],n.au_wind_bending_amp=[p._render.wind_bending_amp],n.au_wind_bending_freq=[p.b4w_wind_bending_freq],n.au_detail_bending_amp=[p.b4w_detail_bending_amp],n.au_detail_bending_freq=[p.b4w_detail_bending_freq],n.au_branch_bending_amp=[p.b4w_branch_bending_amp]);
for(q=0;q<d.length;q++)t=d[q].render,r=d[q].submesh,u=d[q].batch,t.is_hair_particles?t.billboard?Q.submesh_apply_particle_transform(r,m):Q.submesh_apply_transform(r,m):("COLOR_ID"==u.type?(t=d[q].render=p._render,t.type="DYNAMIC",u.odd_id_prop=p.uuid,y(u,t),v(u,J.calc_variable_id(t,0))):r=Q.submesh_apply_transform(r,m),Q.submesh_apply_params(r,n));f=f.concat(d)}return f}function b(a,b,c,d){var f=[];if(a.b4w_do_not_render)return f;for(var g=e(c,b),l=J.calc_variable_id(b,0),m=a.data,n=m.materials,q=
0;q<g.length;q++)for(var r=g[q],u=0;u<n.length;u++){var t=n[u];if(("LENS_FLARES"!=t.name||0!=d)&&!Q.has_empty_submesh(m,u)){var s=h(r);if(k(s,t,!0)){s.draw_mode=m.draw_mode||Q.DM_DEFAULT;"COLOR_ID"===r&&s.color_id.set(a._color_id);y(s,b);for(var x=s,w=a.particle_systems,p=0;p<w.length;p++){var C=w[p].settings.b4w_vcol_from_name,B=w[p].settings.b4w_vcol_to_name;""!==C&&""!==B&&(x.vertex_colors_usage[C]={generate_buffer:!1,src:[{name:C,mask:7}]})}"DYNAMIC"==b.type&&(s.odd_id_prop=a.uuid);v(s,l);x=Q.extract_submesh(m,
u,s.common_attributes,s.bone_pointers,s.vertex_colors_usage,s.uv_maps_usage);"LENS_FLARES"==t.name&&(x=ia.prepare_lens_flares(x));f.push({batch:s,submesh:x,mat_names:[t.name],render:b,rel_objects:[a]})}}}g=a.particle_systems;if(0<g.length&&f.length){d=!0;for(q=0;q<g.length;q++)if(g[q].settings.use_render_emitter){d=!1;break}q=f[0].batch;g=f[0].submesh;m=[];n=a.particle_systems;r=a.data;for(u=0;u<n.length;u++)if(t=n[u],s=t.settings,s.count)if("EMITTER"==s.type){if("DYNAMIC"==b.type){x=h("PARTICLES");
w=r.materials;p=t.settings.material-1;p>=w.length&&(V.warn('B4W Warning: Wrong material used for rendering particle system "'+t.name+'"'),p=0);w=w[p];"HALO"===t.settings.render_type&&(x.halo_particles=!0);k(x,w);y(x,b);p=x;switch(t.settings.b4w_billboard_align){case "VIEW":A(p,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":A(p,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":A(p,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":A(p,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;
default:throw"Wrong billboard align value";}A(p,"BILLBOARD",0);x.dynamic_geometry=!0;x.odd_id_prop=a.name+"_"+s.uuid;v(x,l);x.particle_system=t;s=ia.generate_emitter_particles_submesh(x,r,t,w,a._render.tsr);ia.set_emitter_particles_uniforms(x,t,w);m.push({batch:x,submesh:s,mat_names:[w.name],render:b,rel_objects:[a]})}}else if("HAIR"==s.type){x=J.init_rand_r_seed(t.seed);s.b4w_dynamic_grass&&(b.do_not_cull=!0);if(t.transforms.length)var D=t.transforms;else for(var w=Q.geometry_random_points(g,s.count,
!1,x),D=new Float32Array(4*w.length),z=0;z<w.length;z++)p=.75+.5*J.rand_r(x),D[4*z]=w[z][0],D[4*z+1]=w[z][1],D[4*z+2]=w[z][2],D[4*z+3]=p;w=G.find_subs(c,"GRASS_MAP")?!0:!1;if("OBJECT"==s.render_type)p=[e(c,s.dupli_object._render)],t=S(a,b,q,g,[s.dupli_object],p,[D],s,t,w,x,!1),m=m.concat(t);else if("GROUP"==s.render_type){C=s.dupli_group.objects;B=!1;p=[];for(z=0;z<C.length;z++){var H=e(c,s.dupli_group.objects[z]._render);p.push(H)}if(s.use_whole_group){B=D;D=C;z={};for(H=0;H<B.length;H+=4)for(var Y=
0;Y<D.length;Y++){var I=ha.create();ha.scale(D[Y]._render.trans,D[Y]._render.scale,I);var da=ha.clone([B[H],B[H+1],B[H+2]]);ha.add(da,I,da);z[Y]||(z[Y]=new Float32Array(B.length));z[Y][H]=da[0];z[Y][H+1]=da[1];z[Y][H+2]=da[2];z[Y][H+3]=B[H+3]}D=z;B=!0}else if(s.use_group_count){for(var da=C,ja=s.dupli_weights,z=x,H={},Y=[],I=0;I<da.length;I++)for(var P=da[I],P=P.origin_name||P.name,K=0;K<ja.length;K++){var U=ja[K];P==U.name.split(": ")[0]&&Y.push(U)}ja.length!=Y.length&&V.error("B4W Error: dupli weights match failed");
for(I=0;I<D.length;I+=4){var L,ja=Y;L=[0];for(da=0;da<ja.length;da++)L[da+1]=L[da]+ja[da].count;ja=L[L.length-1]*J.rand_r(z);for(da=P=0;da<L.length;da++)if(ja>=L[da]&&ja<L[da+1]){P=da;break}L=P;H[L]=H[L]||[];H[L].push(D[I],D[I+1],D[I+2],D[I+3])}for(L in H)H[L]=new Float32Array(H[L]);D=H}else{z=x;H=C.length;Y={};for(I=0;I<D.length;I+=4){var M=Math.floor(H*J.rand_r(z));Y[M]=Y[M]||[];Y[M].push(D[I],D[I+1],D[I+2],D[I+3])}for(M in Y)Y[M]=new Float32Array(Y[M]);D=Y}t=S(a,b,q,g,C,p,D,s,t,w,x,B);m=m.concat(t)}"INSTANCE"==
s.b4w_wind_bend_inheritance&&(a._render.wind_bending_amp=0)}else throw"Unknown particle settings type";a=m;f=d?a:f.concat(a)}return f}function l(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function e(a,b){var c=["MAIN","NODES"];b.selectable&&(G.find_subs(a,"COLOR_PICKING")||G.find_subs(a,"GLOW_MASK"))&&c.push("COLOR_ID");G.find_subs(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(G.find_subs(a,"DEPTH")||G.find_subs(a,"SHADOW_CAST"))&&c.push("DEPTH");
G.find_subs(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.shadow_cast_only||b.reflexible_only){var d=null;b.shadow_cast_only&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.reflexible_only)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?J.array_intersect(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function k(a,b,c){var e,f;switch(a.type){case "MAIN":if(b.b4w_collision)a=!1;else if(b.use_nodes)a=!1;else{for(var h=0;4>h;h++)a.normalmap_uv_velocities[h]=
new Float32Array([0,0]);r(a,b);h=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.offset_z=b.offset_z;a.texture_scale.set([1,1,1]);var k=b.texture_slots;pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);switch(b.name){case "LENS_FLARES":m(a,"special_lens_flares.glslv","special_lens_flares.glslf");g(a,"a_position");g(a,"a_texcoord");var l=c?[1,1,1,0]:null,l=x(k[0],l);H(a,l);break;default:m(a,"main.glslv","main.glslf");var u=
n("use_map_color_diffuse",!0,k),s=n("use_map_color_spec",!0,k),p=n("use_map_normal",!0,k),v=n("use_map_mirror",!0,k),C=n("use_stencil",!0,k),h=u[0],s=s[0],p=p[0],v=v[0],u=u[1],k=C[0]&&n("use_rgb_to_intensity",!0,k)[0];if(h){switch(h.blend_type){case "MIX":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l="IMAGE"==h.texture._render.source&&c?[a.diffuse_color[0],a.diffuse_color[1],a.diffuse_color[2],1]:"ENVIRONMENT_MAP"==
h.texture._render.source&&c?[.8,.8,.8,1]:null;l=x(h,l);H(a,l,"u_colormap0");a.diffuse_color_factor=h.diffuse_color_factor;a.alpha_factor=h.use_map_alpha?h.alpha_factor:0;a.colormap0_uv_velocity.set(h.texture.b4w_uv_velocity_trans);a.texture_scale.set(h.scale)}C=h&&h==s;s&&(C||(l=c?[.5,.5,.5,1]:null,l=x(s,l),H(a,l,"u_specmap0")),a.specular_color_factor=s.specular_color_factor);if(p){g(a,"a_normal");g(a,"a_tangent");l=c?[.5,.5,1,1]:null;l=x(p,l);H(a,l,"u_normalmap0");a.normal_factor=p.normal_factor;
var D=p.texture;a.normalmap_uv_velocities[0].set(D.b4w_uv_velocity_trans);if(D.b4w_use_map_parallax&&Y.parallax){var l=fa.glsl_value(D.b4w_parallax_steps),y=fa.glsl_value(D.b4w_parallax_lod_dist);A(a,"PARALLAX",1);A(a,"PARALLAX_STEPS",l);A(a,"PARALLAX_LOD_DIST",y);a.parallax_scale=D.b4w_parallax_scale}}v&&(l=c?[0,0,.5,1]:null,l=x(v,l),H(a,l,"u_mirrormap"),a.mirror_factor=v.mirror_factor);if(D=h&&u&&k?1:0)l=c?[.8,.8,.8,1]:null,l=x(u,l),H(a,l,"u_colormap1"),l=c?[.5,.5,.5,1]:null,l=x(k,l),H(a,l,"u_stencil0");
(c=h||s||p)&&a.texture_scale.set(c.scale);A(a,"TEXTURE_SPEC",void 0==s?0:1);A(a,"TEXTURE_MIRROR",void 0==v?0:1);A(a,"ALPHA_AS_SPEC",C?1:0);A(a,"TEXTURE_STENCIL_ALPHA_MASK",D);g(a,"a_position");g(a,"a_normal");(h||s||p)&&g(a,"a_texcoord");if(b.b4w_water){a.water=!0;a.water_shore_smoothing=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;m(a,"special_water.glslv","special_water.glslf");g(a,"a_position");g(a,"a_texcoord");g(a,"a_normal");g(a,"a_tangent");Y.water_wireframe_debug?
(g(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_edge_color=[0,0,0],A(a,"DEBUG_WIREFRAME",1)):A(a,"DEBUG_WIREFRAME",0);C=n("use_map_normal",!0,c);v=n("use_map_mirror",!0,c)[0];C.length&&(D=x(C[0]),H(a,D,"u_normalmap0"));A(a,"NUM_NORMALMAPS",C.length);a.normalmap_scales=Array(C.length);for(D=0;D<C.length;D++)a.normalmap_uv_velocities[D].set(C[D].texture.b4w_uv_velocity_trans),a.normalmap_scales[D]=new Float32Array(2),a.normalmap_scales[D].set([C[D].scale[0],C[D].scale[1]]);v?(A(a,"TEXTURE_MIRROR",1),
C=x(v),H(a,C,"u_mirrormap"),a.mirror_factor=v.mirror_factor):A(a,"TEXTURE_MIRROR",0);v=null;for(D=0;D<c.length;D++)if(e=c[D],!0===e.texture.b4w_water_foam){v=e;break}v&&Y.foam?(A(a,"FOAM",1),C=x(v),H(a,C,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.foam_uv_freq.set(v.texture.b4w_foam_uv_freq),a.foam_mag.set(v.texture.b4w_foam_uv_magnitude),a.foam_scale[0]=v.scale[0],a.foam_scale[1]=v.scale[1]):A(a,"FOAM",0);for(D=0;D<c.length;D++)if(e=c[D],!0===e.texture.b4w_shore_dist_map){f=e;break}f&&Y.allow_vertex_textures?
(f=x(f),H(a,f,"u_shore_dist_map"),A(a,"SHORE_PARAMS",1),f=e.texture.b4w_shore_boundings,A(a,"MAX_SHORE_DIST",fa.glsl_value(e.texture.b4w_max_shore_dist)),A(a,"SHORE_MAP_SIZE_X",fa.glsl_value(f[0]-f[1])),A(a,"SHORE_MAP_SIZE_Y",fa.glsl_value(f[2]-f[3])),A(a,"SHORE_MAP_CENTER_X",fa.glsl_value((f[0]+f[1])/2)),A(a,"SHORE_MAP_CENTER_Y",fa.glsl_value((f[2]+f[3])/2))):A(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&Y.deferred_rendering?(A(a,"GENERATED_MESH",1),a.water_generated_mesh=!0,a.water_num_cascads=b.b4w_water_num_cascads,
a.water_subdivs=b.b4w_water_subdivs,a.water_detailed_dist=b.b4w_water_detailed_dist):A(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){e=fa.glsl_value(b.b4w_water_dst_noise_scale0);f=fa.glsl_value(b.b4w_water_dst_noise_scale1);c=fa.glsl_value(b.b4w_water_dst_noise_freq0);var v=fa.glsl_value(b.b4w_water_dst_noise_freq1),C=fa.glsl_value(b.b4w_water_dir_min_shore_fac),D=fa.glsl_value(b.b4w_water_dir_freq),l=fa.glsl_value(b.b4w_water_dir_noise_scale),y=fa.glsl_value(b.b4w_water_dir_noise_freq),z=fa.glsl_value(b.b4w_water_dir_min_noise_fac),
J=fa.glsl_value(b.b4w_water_dst_min_fac),G=fa.glsl_value(b.b4w_water_waves_hor_fac);A(a,"DST_NOISE_SCALE_0",e);A(a,"DST_NOISE_SCALE_1",f);A(a,"DST_NOISE_FREQ_0",c);A(a,"DST_NOISE_FREQ_1",v);A(a,"DIR_MIN_SHR_FAC",C);A(a,"DIR_FREQ",D);A(a,"DIR_NOISE_SCALE",l);A(a,"DIR_NOISE_FREQ",y);A(a,"DIR_MIN_NOISE_FAC",z);A(a,"DST_MIN_FAC",J);A(a,"WAVES_HOR_FAC",G)}w(a,b);B(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;
a.shore_water_col_fac=b.b4w_shore_water_col_fac;A(a,"ABSORB",fa.glsl_value(b.b4w_water_absorb_factor));A(a,"SSS_STRENGTH",fa.glsl_value(b.b4w_water_sss_strength));A(a,"SSS_WIDTH",fa.glsl_value(b.b4w_water_sss_width));e=a.shaders_info;f=a.common_attributes;a.shaders_info=e;a.common_attributes=f}"HALO"===b.type&&(e=b.halo,m(a,"halo.glslv","halo.glslf"),A(a,"NUM_RINGS",e.ring_count),A(a,"NUM_LINES",e.line_count),A(a,"NUM_STARS",e.star_tip_count),A(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.common_attributes=
["a_position"],a.halo_size=e.size,a.halo_hardness=e.hardness/20,a.halo_rings_color.set(e.b4w_halo_rings_color),a.halo_lines_color.set(e.b4w_halo_lines_color),a.halo_stars_blend=1/b.b4w_halo_stars_blend_height,a.halo_stars_height=b.b4w_halo_stars_min_height,a.halo=!0);A(a,"TEXCOORD",0);A(a,"NORMAL_TEXCOORD",0);h&&d(a,h,"TEXTURE_COLOR0_CO");u&&d(a,u,"TEXTURE_COLOR1_CO");k&&d(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");s&&d(a,s,"TEXTURE_SPEC_CO");p&&d(a,p,"TEXTURE_NORM_CO");A(a,"SHADELESS",b.use_shadeless?
1:0);a.use_shadeless=b.use_shadeless}h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);A(a,"ALPHA_CLIP","CLIP"===h?1:0);A(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(A(a,"VERTEX_COLOR",1),g(a,"a_color")):A(a,"VERTEX_COLOR",0);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;w(a,b);B(a,b);b.b4w_wettable?A(a,"WETTABLE",1):A(a,"WETTABLE",0);t(a,b);Y.glsl_unroll_hack?
A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0);a.refractive=b.b4w_refractive;a.refr_bump=b.b4w_refr_bump;a=!0}break;case "NODES":a=q(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(r(a,b),a.blend)a=!1;else{m(a,"depth.glslv","depth.glslf");g(a,"a_position");g(a,"a_normal");h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);a.texture_scale.set([1,1,1]);if((b=n("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===h){a.texture_scale.set(b.scale);
A(a,"TEXTURE_COLOR",1);g(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)h=x(b),H(a,h,"u_colormap0"),a.colormap0_uv_velocity.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture._render.source&&(h=x(b),H(a,h,"u_colormap0"),a.colormap0_uv_velocity.set(b.texture.b4w_uv_velocity_trans))}else A(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.use_ghost=b.b4w_use_ghost,a.collision_id=b.b4w_collision_id,a.collision_group=b.b4w_collision_group,
a.collision_mask=b.b4w_collision_mask,a.friction=b.physics.friction,a.elasticity=b.physics.elasticity,a=!0):b.b4w_water?(a.water=!0,a.water_dynamics=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=
b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_collision||"HALO"===b.type)a=!1;else{r(a,b);a.zsort_type=Q.ZSORT_DISABLED;a.depth_mask=!0;a.blend=!1;h=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;m(a,"color_id.glslv","color_id.glslf");g(a,"a_position");h=b.game_settings.alpha_blend;A(a,"ALPHA",
"OPAQUE"===h?0:1);a.texture_scale.set([1,1,1]);if((b=n("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===h){a.texture_scale.set(b.scale);A(a,"TEXTURE_COLOR",1);g(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)h=x(b),H(a,h,"u_colormap0"),a.colormap0_uv_velocity.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture._render.source&&(h=x(b),H(a,h,"u_colormap0"),a.colormap0_uv_velocity.set(b.texture.b4w_uv_velocity_trans))}else A(a,"TEXTURE_COLOR",
0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(r(a,b),a.blend=!1,a.zsort_type=Q.ZSORT_DISABLED,a.depth_mask=!0,m(a,"grass_map.glslv","grass_map.glslf"),g(a,"a_position"),h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},h?(a.vertex_colors_usage.a_grass_size.src.push({name:h,mask:4}),A(a,"DYNAMIC_GRASS_SIZE",1)):A(a,"DYNAMIC_GRASS_SIZE",0),a.vertex_colors_usage.a_grass_color=
{generate_buffer:!0,src:[]},b?(a.vertex_colors_usage.a_grass_color.src.push({name:b,mask:7}),A(a,"DYNAMIC_GRASS_COLOR",1)):A(a,"DYNAMIC_GRASS_COLOR",0),Y.glsl_unroll_hack?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(m(a,"wireframe.glslv","wireframe.glslf"),g(a,"a_position"),g(a,"a_normal"),g(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],Y.glsl_unroll_hack?
A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":h=b.texture_slots;if(a.halo_particles)m(a,"particles_color.glslv","particles_color.glslf");else if(m(a,"particles_texture.glslv","particles_texture.glslf"),h=n("use_map_color_diffuse",!0,h)[0]){A(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":A(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.diffuse_color_factor=h.diffuse_color_factor;a.alpha_factor=
h.use_map_alpha?h.alpha_factor:0;h=x(h);H(a,h)}pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;g(a,"a_position");g(a,"a_normal");h=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===h?0:1);A(a,"ALPHA_CLIP","CLIP"===h?1:0);A(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);w(a,b);B(a,b);r(a,b);h=b.game_settings.alpha_blend;
a.xray=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.offset_z=b.offset_z;Y.glsl_unroll_hack?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+a.type;}return a}function d(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":A(a,c,"TEXTURE_COORDS_UV_ORCO");A(a,"TEXCOORD",1);break;case "NORMAL":A(a,c,"TEXTURE_COORDS_NORMAL");A(a,"NORMAL_TEXCOORD",1);break;default:A(a,c,0)}}function r(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.blend=
!0;a.zsort_type=Q.ZSORT_BACK_TO_FRONT;a.depth_mask=!0;break;case "ALPHA":a.blend=!0;a.zsort_type=Q.ZSORT_DISABLED;a.depth_mask=!0;break;case "CLIP":a.blend=!1;a.zsort_type=Q.ZSORT_DISABLED;a.depth_mask=!0;break;case "ADD":a.blend=!0;a.zsort_type=Q.ZSORT_DISABLED;a.depth_mask=!1;break;case "OPAQUE":a.blend=!1;a.zsort_type=Q.ZSORT_DISABLED;a.depth_mask=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.use_backface_culling=c.use_backface_culling}function x(a,b){var c=a.texture,d=c._render,
c=c.image;d&&b&&c&&da.update_texture(d,b,c._is_dds,c.filepath);return d}function n(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&g.texture&&g.texture._render&&d.push(g)}return d}function t(a,b){var c=b.raytrace_transparency;a.fresnel_params[0]=c.fresnel;a.fresnel_params[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.fresnel_params[2]=c.fresnel;a.fresnel_params[3]=1-c.fresnel_factor/5}function w(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":A(a,
"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":A(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":A(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:V.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.specular_params[0]=b.specular_intensity;a.specular_params[1]=c;a.specular_params[2]=d}function B(a,b){switch(b.diffuse_shader){case "LAMBERT":A(a,
"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.diffuse_params[0]=0;a.diffuse_params[1]=0;break;case "OREN_NAYAR":A(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.diffuse_params[0]=b.roughness;a.diffuse_params[1]=0;break;case "FRESNEL":A(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.diffuse_params[0]=b.diffuse_fresnel;a.diffuse_params[1]=b.diffuse_fresnel_factor;break;default:V.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.diffuse_params[0]=0,a.diffuse_params[1]=0}}function q(a,
b){if(!b.use_nodes)return!1;var c=X.compose_nmat_graph(b.node_tree,b.uuid,!1);if(!c)return V.error('Failed to create node graph for material "'+b.name+'", disable nodes'),s(a,b),!0;m(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===d?0:1);A(a,"ALPHA_CLIP","CLIP"===d?1:0);A(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);g(a,"a_position");r(a,b);a.offset_z=b.offset_z;d=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=
d;pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.emit=b.emit;a.ambient=b.ambient;t(a,b);b.b4w_wettable?A(a,"WETTABLE",1):A(a,"WETTABLE",0);a.node_elements=X.compose_node_elements(c);var e=!1;T.traverse(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var f=d.data.name,h=d.data.value;a.uv_maps_usage||(a.uv_maps_usage={});a.uv_maps_usage[h]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=d.data.name;a.vertex_colors_usage[f]=
{generate_buffer:!0,src:[{name:d.data.value}]};h=0;if("GEOMETRY_VC"==d.type)h=7;else for(var k=0;k<d.outputs.length;k++){var l="RGB".indexOf(d.outputs[k].identifier);-1<l&&(h|=1<<2-l)}a.vertex_colors_usage[f].src[0].mask=h;break;case "GEOMETRY_NO":g(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":f=d.data.value;g(a,"a_normal");A(a,"DIFFUSE_SHADER","DIFFUSE_"+f.diffuse_shader);A(a,"SPECULAR_SHADER","SPECULAR_"+f.specular_shader);A(a,"SHADELESS_MAT",f.use_shadeless?1:0);a.use_shadeless=f.use_shadeless;
a.specular_alpha=f.specular_alpha;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":f=d.data.name;h=d.data.value;!1!==h._render.allow_node_dds&&(h._render.allow_node_dds="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);H(a,h._render,f);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "PARALLAX":A(a,"CALC_TBN_SPACE",1);g(a,"a_normal");g(a,"a_tangent");f=d.data.name;(h=d.data.value)?(h._render.allow_node_dds=
!1,H(a,h._render,f)):V.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.lamp_uuid_indexes=d.data);break;case "REFRACTION":a.refractive=!0}});e||(a.use_shadeless=!0);Y.glsl_unroll_hack?A(a,"UNROLL_LOOPS",1):A(a,"UNROLL_LOOPS",0);return!0}function s(a,b){m(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;A(a,"ALPHA","OPAQUE"===c?0:1);A(a,"ALPHA_CLIP","CLIP"===c?1:0);A(a,"SHADELESS",1);g(a,"a_position");g(a,"a_normal");pa.set(1,0,1,1,a.diffuse_color);
A(a,"VERTEX_COLOR",0);a.offset_z=b.offset_z;r(a,b);return!0}function y(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.is_hair_particles?A(a,"AU_QUALIFIER","attribute"):A(a,"AU_QUALIFIER","uniform"),A(a,"STATIC_BATCH",0)):(A(a,"AU_QUALIFIER","attribute"),A(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(M.get_standard_derivatives()?A(a,"WIREFRAME_QUALITY",1):A(a,"WIREFRAME_QUALITY",0),a.debug_sphere?(A(a,"DEBUG_SPHERE",1),a.debug_sphere_dynamic?A(a,"DEBUG_SPHERE_DYNAMIC",1):A(a,"DEBUG_SPHERE_DYNAMIC",
0)):A(a,"DEBUG_SPHERE",0),A(a,"ALPHA",1));b.wind_bending?(""!==b.main_bend_col?(a.vertex_colors_usage.a_bending_col_main={generate_buffer:!0,src:[{name:b.main_bend_col,mask:4}]},g(a,"a_bending_col_main"),""!==b.detail_bend_col.leaves_stiffness&&""!==b.detail_bend_col.leaves_phase&&""!==b.detail_bend_col.overall_stiffness?(a.vertex_colors_usage.a_bending_col_detail={generate_buffer:!0,src:[{name:b.detail_bend_col.leaves_stiffness,mask:4},{name:b.detail_bend_col.leaves_phase,mask:2},{name:b.detail_bend_col.overall_stiffness,
mask:1}]},g(a,"a_bending_col_detail"),g(a,"a_normal"),A(a,"DETAIL_BEND",1)):A(a,"DETAIL_BEND",0),A(a,"MAIN_BEND_COL",1)):A(a,"MAIN_BEND_COL",0),A(a,"WIND_BEND",1)):A(a,"WIND_BEND",0);b.bend_center_only?A(a,"BEND_CENTER_ONLY",1):A(a,"BEND_CENTER_ONLY",0);b.billboard?A(a,"BILLBOARD",1):A(a,"BILLBOARD",0);b.billboard&&b.is_hair_particles?A(a,"HAIR_BILLBOARD",1):A(a,"HAIR_BILLBOARD",0);b.billboard_spherical?A(a,"BILLBOARD_SPHERICAL",1):A(a,"BILLBOARD_SPHERICAL",0);switch(b.billboard_type){case "RANDOM":A(a,
"BILLBOARD_RANDOM",1);A(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":A(a,"BILLBOARD_RANDOM",0);A(a,"BILLBOARD_JITTERED",1);break;default:A(a,"BILLBOARD_RANDOM",0),A(a,"BILLBOARD_JITTERED",0)}b.dynamic_grass&&Y.allow_vertex_textures?A(a,"DYNAMIC_GRASS",1):A(a,"DYNAMIC_GRASS",0);a.dynamic_grass=b.dynamic_grass;a.dynamic_geometry=b.dynamic_geometry;a.shadow_cast=b.shadow_cast;a.shadow_cast_only=b.shadow_cast_only;a.shadow_receive=b.shadow_receive&&!a.use_shadeless&&!(a.blend&&Y.disable_blend_shadows_hack);
a.reflexible=b.reflexible;a.reflexible_only=b.reflexible_only;a.reflective=b.reflective;b.is_skinning?(g(a,"a_influence"),A(a,"SKINNED",1),b.frames_blending?A(a,"FRAMES_BLENDING",1):A(a,"FRAMES_BLENDING",0),A(a,"MAX_BONES",b.max_bones)):(A(a,"SKINNED",0),A(a,"FRAMES_BLENDING",0));b.vertex_anim?(A(a,"VERTEX_ANIM",1),Y.vert_anim_mix_normals_hack?A(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):A(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):A(a,"VERTEX_ANIM",0);if(b.is_skinning&&b.vertex_anim)throw"Skinning and vertex animation are mutually exlusive";
b.disable_fogging?A(a,"DISABLE_FOG",1):A(a,"DISABLE_FOG",0);b.bone_pointers&&(a.bone_pointers=b.bone_pointers);if(b.mats_anim_values&&"NODES"==a.type){for(var c=a.node_elements,d=b.mats_anim_inds,e=0;e<c.length;e++){var f=c[e];switch(f.id){case "ANIM_VALUE":for(var h=f.param_values[1],k=0;k<d.length;k+=2)if(d[k]==h){f.param_values[0]=d[k+1];break}}}A(a,"NUM_ANIM_VALUES",b.mats_anim_values.length)}}}function g(a,b){var c=a.common_attributes;-1==c.indexOf(b)&&c.push(b)}function A(a,b,c){fa.set_directive(a.shaders_info,
b,c)}function u(a,b){if("PHYSICS"==a.type)a.submesh=b;else{var c=a.zsort_type,d=a.draw_mode;a.halo&&(b=Q.extract_halo_submesh(b));a.water_generated_mesh&&(b=W.generate_multigrid(a.water_num_cascads,a.water_subdivs,a.water_detailed_dist));c=Q.submesh_to_bufs_data(b,c,d,a.vertex_colors_usage);a.dynamic_geometry||c.info_for_z_sort_updates||(c.ibo_array=null,c.vbo_array=null);a.bufs_data=c;c=b.va_frames.length;a.num_vertices=b.base_length*c;a:switch(a.draw_mode){case Q.DM_DEFAULT:case Q.DM_TRIANGLES:case Q.DM_DYNAMIC_TRIANGLES:d=
!0;break a;default:d=!1}d?Q.is_indexed(b)?a.num_triangles=b.indices.length/3*c:a.num_triangles=b.base_length/3*c:a.num_triangles=0}}function S(a,b,c,d,e,f,g,l,m,n,q,r){var u=[],t=l.b4w_dynamic_grass;if(!n&&t)return u;for(var s="INSTANCE"==l.b4w_wind_bend_inheritance,x="INSTANCE"==l.b4w_shadow_inheritance,w="INSTANCE"==l.b4w_reflection_inheritance,p=[],D=[],B=0;B<e.length;B++){var A=e[B],z=J.clone_object_nr(b);z.billboard=l.b4w_hair_billboard;z.billboard_type=l.b4w_hair_billboard_type;z.billboard_spherical=
"SPHERICAL"==l.b4w_hair_billboard_geometry;z.dynamic_grass=t;z.is_hair_particles=!0;z.mats_anim_values=A._render.mats_anim_values;z.mats_anim_inds=A._render.mats_anim_inds;s?(z.wind_bending=A._render.wind_bending,z.wind_bending_angle=A._render.wind_bending_angle,z.wind_bending_freq=A._render.wind_bending_freq,z.detail_bending_freq=A._render.detail_bending_freq,z.main_bend_col=A._render.main_bend_col,z.detail_bending_amp=A._render.detail_bending_amp,z.branch_bending_amp=A._render.branch_bending_amp,
z.wind_bending_amp=A._render.wind_bending_amp,z.detail_bend_col=A._render.detail_bend_col,z.bend_center_only=!1):(z.wind_bending=a._render.wind_bending,z.wind_bending_angle=a._render.wind_bending_angle,z.wind_bending_freq=a._render.wind_bending_freq,z.detail_bending_freq=a._render.detail_bending_freq,z.main_bend_col=a._render.main_bend_col,z.detail_bending_amp=a._render.detail_bending_amp,z.branch_bending_amp=a._render.branch_bending_amp,z.wind_bending_amp=a._render.wind_bending_amp,z.detail_bend_col=
a._render.detail_bend_col,z.bend_center_only=!0);x?(z.shadow_cast=A._render.shadow_cast,z.shadow_cast_only=A._render.shadow_cast_only,z.shadow_receive=A._render.shadow_receive):(z.shadow_cast=a._render.shadow_cast,z.shadow_cast_only=a._render.shadow_cast_only,z.shadow_receive=a._render.shadow_receive);w?(z.reflexible=A._render.reflexible,z.reflexible_only=A._render.reflexible_only,z.reflective=A._render.reflective):(z.reflexible=a._render.reflexible,z.reflexible_only=a._render.reflexible_only,z.reflective=
a._render.reflective);p.push(z);var H=g[B];H||(H=new Float32Array);r&&J.init_rand_r_seed(m.seed,q);for(var Y=new Float32Array(3),G=new Float32Array([0,0,0,1]),I=[],da=0;da<H.length;da+=4){Y[0]=H[da];Y[1]=H[da+1];Y[2]=H[da+2];var ja=H[da+3];if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var P=new Float32Array([J.rand_r(q),J.rand_r(q),J.rand_r(q)]);ha.normalize(P,P);break;case "Z":P=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+l.b4w_rotation_type;
}la.setAxisAngle(P,l.b4w_rand_rotation_strength*(2*Math.PI*J.rand_r(q)-Math.PI),G)}var K=C.create_sep(Y,ja,G);I.push(K)}D.push(I)}for(var S={},B=0;B<e.length;B++){var U=f[B],z=p[B],L=J.calc_variable_id(z,0),I=D[B];if(I.length)for(var M=e[B].data,T=M.materials,da=0;da<T.length;da++)if(!Q.has_empty_submesh(M,da))for(var W=0;W<U.length;W++){var Z=U[W];if("COLOR_ID"!==Z){var X=h(Z),ia=T[da];if(k(X,ia,!0)){X.draw_mode=M.draw_mode||Q.DM_DEFAULT;y(X,z);X.odd_id_prop=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&
(X.jitter_amp=l.b4w_hair_billboard_jitter_amp,X.jitter_freq=l.b4w_hair_billboard_jitter_freq);t&&(X.grass_scale_threshold=l.b4w_dynamic_grass_scale_threshold);s||(delete X.vertex_colors_usage.a_bending_col_main,delete X.vertex_colors_usage.a_bending_col_detail);v(X,L);var fa=Q.extract_submesh(M,da,X.common_attributes,X.bone_pointers,X.vertex_colors_usage,X.uv_maps_usage),nc=[];if(z.wind_bending||z.dynamic_grass||z.billboard)nc.au_wind_bending_amp=[z.wind_bending_amp],nc.au_wind_bending_freq=[z.wind_bending_freq],
nc.au_detail_bending_freq=[z.detail_bending_freq],nc.au_detail_bending_amp=[z.detail_bending_amp],nc.au_branch_bending_amp=[z.branch_bending_amp];var Pb=Q.make_clone_submesh(fa,nc,I),$b=Pb,cd=I;$b.va_common.au_center_pos=new Float32Array(3*$b.base_length);for(var oc=cd.length,Bc=$b.base_length/oc,ic=0;ic<oc;ic++)for(var Sc=cd[ic],Ba=3*Bc*ic,Ib=0;Ib<Bc;Ib++)$b.va_common.au_center_pos[Ba+3*Ib]=Sc[0],$b.va_common.au_center_pos[Ba+3*Ib+1]=Sc[1],$b.va_common.au_center_pos[Ba+3*Ib+2]=Sc[2];Pb=$b;if(z.bend_center_only){var rb=
Pb,za=a._render.world_matrix;rb.va_common.a_emitter_center=new Float32Array(3*rb.base_length);var fb=pa.fromValues(0,0,0,1);pa.transformMat4(fb,za,fb);for(var $=0;$<rb.base_length;$++)rb.va_common.a_emitter_center[3*$]=fb[0],rb.va_common.a_emitter_center[3*$+1]=fb[1],rb.va_common.a_emitter_center[3*$+2]=fb[2];Pb=rb}var Qa=l.b4w_vcol_from_name,mb=l.b4w_vcol_to_name,ta=X,qa=c,vb=!s,xa=M,gb=[];if(""!==Qa&&""!==mb){var ra,bb=mb,Da=ta.vertex_colors_usage,nb=[],Jb=void 0;for(Jb in Da)for(var Cc=Da[Jb].src,
Vb=0,ac=0;ac<Cc.length;ac++){var pc=Cc[ac].mask;bb==Cc[ac].name&&nb.push(Jb,pc,Vb);Vb+=J.rgb_mask_get_channels_count(pc)}ra=nb;if(0<ra.length)for(var wb=0;wb<ra.length;wb+=3)gb.push({emitter_attr:Qa,emitter_mask:7,particle_attr:ra[wb],particle_mask:ra[wb+1],dst_channel_offset:ra[wb+2]});else Q.has_attr(ta.common_attributes,"a_color")&&mb==xa.active_vcol_name&&gb.push({emitter_attr:Qa,emitter_mask:7,particle_attr:"a_color",particle_mask:7,dst_channel_offset:0})}vb&&("a_bending_col_main"in qa.vertex_colors_usage&&
gb.push({emitter_attr:"a_bending_col_main",emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in qa.vertex_colors_usage&&gb.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",particle_mask:7,dst_channel_offset:0}));for(var Mb=Pb,Wb=I,Sb=d,hb=gb,Xb=X.vertex_colors_usage,jc=!1,Xa=0;Xa<hb.length;Xa++){var bc=hb[Xa].emitter_attr,Kb=Sb.va_common[bc];if(Kb&&0<Kb.length){jc=!0;break}}if(jc){var gc,va=a._render.bb_local,
Oa=Sb.va_frames[0].a_position,R=Wb,N=S,wa=new Float32Array(3),oa=new Float32Array(3),Ua=new Uint32Array(R.length);if(!("verts_indices"in N)){N.cell_size=new Float32Array(3);N.base_point=new Float32Array(3);N.verts_indices=new Uint32Array(Oa.length/3);N.octs_indices=new Uint32Array(Oa.length/3);N.cell_size[0]=(va.max_x-va.min_x)/20;N.cell_size[1]=(va.max_y-va.min_y)/20;N.cell_size[2]=(va.max_z-va.min_z)/20;N.base_point[0]=va.min_x;N.base_point[1]=va.min_y;N.base_point[2]=va.min_z;for(var ka=0;ka<Oa.length/
3;ka++){var na=Oa[3*ka+1],Cb=Oa[3*ka+2],Ca=J.trunc((Oa[3*ka]-N.base_point[0])/N.cell_size[0]),cb=J.trunc((na-N.base_point[1])/N.cell_size[1]),Pa=J.trunc((Cb-N.base_point[2])/N.cell_size[2]),Ca=J.clamp(Ca,0,19),cb=J.clamp(cb,0,19),Pa=J.clamp(Pa,0,19);N.verts_indices[ka]=ka;N.octs_indices[ka]=Pa*Math.pow(20,2)+20*cb+Ca}Q.sort_two_arrays(N.octs_indices,N.verts_indices,!0);N.verts_offsets=new Uint32Array(Math.pow(20,3));for(ka=0;ka<N.octs_indices.length;ka++)N.verts_offsets[N.octs_indices[ka]]++;delete N.octs_indices;
for(ka=1;ka<N.verts_offsets.length;ka++)N.verts_offsets[ka]+=N.verts_offsets[ka-1]}for(var db=0;db<R.length;db++){wa[0]=R[db][0];wa[1]=R[db][1];wa[2]=R[db][2];for(var $a=1E10,Ga=-1,Ra=J.trunc((wa[0]-N.base_point[0])/N.cell_size[0]),ib=J.trunc((wa[1]-N.base_point[1])/N.cell_size[1]),Xc=J.trunc((wa[2]-N.base_point[2])/N.cell_size[2]),Ra=J.clamp(Ra,0,19),ib=J.clamp(ib,0,19),Xc=J.clamp(Xc,0,19),Dc=Xc*Math.pow(20,2)+20*ib+Ra,dd=N.verts_offsets[Dc],vc=0==Dc?0:N.verts_offsets[Dc-1];vc<dd;vc++){var Tc=N.verts_indices[vc];
oa[0]=Oa[3*Tc];oa[1]=Oa[3*Tc+1];oa[2]=Oa[3*Tc+2];ha.sub(oa,wa,oa);var xb=ha.sqrLen(oa);xb<=$a&&($a=xb,Ga=Tc)}if(-1==Ga)for(vc=0;vc<Oa.length/3;vc++)oa[0]=Oa[3*vc],oa[1]=Oa[3*vc+1],oa[2]=Oa[3*vc+2],ha.sub(oa,wa,oa),xb=ha.sqrLen(oa),xb<=$a&&($a=xb,Ga=vc);Ua[db]=Ga}gc=Ua;for(var qc=Mb.base_length/Wb.length,Xa=0;Xa<hb.length;Xa++){var Va=hb[Xa].particle_attr,Ec=hb[Xa].particle_mask,bc=hb[Xa].emitter_attr,kc=hb[Xa].emitter_mask,Kb=Sb.va_common[bc];switch(Va){case "a_bending_col_main":var eb=1;break;case "a_bending_col_detail":eb=
3;break;case "a_color":eb=3;break;default:for(var Ya=eb=0;Ya<Xb[Va].src.length;Ya++)eb+=J.rgb_mask_get_channels_count(Xb[Va].src[Ya].mask)}if(Kb&&0<Kb.length){var rc=J.rgb_mask_get_channels_count(kc),wc=J.rgb_mask_get_channels_count(Ec),yb=kc&Ec,Yb=J.rgb_mask_get_channels_presence(yb);yb!=Ec&&V.error("Wrong color extraction from "+bc+" to "+Va+".");if("a_bending_col_main"==Va||"a_bending_col_detail"==Va)Mb.va_common[Va]=new Float32Array(Mb.base_length*wc);for(Ya=0;Ya<Wb.length;Ya++){var Db=gc[Ya],
cc=Db*rc,Hc=Ya*qc*eb;if(-1!=Db)for(var Eb=0;Eb<qc;Eb++)for(var Yc=Eb*eb,Zb=0;Zb<Yb.length;Zb++)if(Yb[Zb]){var jb=J.rgb_mask_get_channel_presence_index(kc,Zb),lc=hb[Xa].dst_channel_offset+J.rgb_mask_get_channel_presence_index(Ec,Zb);Mb.va_common[Va][Hc+Yc+lc]=Kb[cc+jb]}}}else Mb.va_common[Va]=new Float32Array(0)}}Pb=Mb;u.push({batch:X,submesh:Pb,mat_names:[ia.name],render:z,rel_objects:[a]})}}}}return u}function I(a){return C.create_sep(a.trans,a.scale,a.quat)}function v(a,b){for(var c=null,d=null,
e=null,f=0;f<a.textures.length;f++){var g=a.textures[f].offscreen_scene;g&&(c||(c={}),c[f]=g,a.textures[f].offscreen_scene=null);if(g=a.textures[f].canvas_context)d||(d={}),d[f]=g,a.textures[f].canvas_context=null;if(g=a.textures[f].video_file)e||(e={}),e[f]=g,a.textures[f].video_file=null}a.id=0;a.render_id=b;a.id=J.calc_variable_id(a,b);if(c)for(f in c)a.textures[f].offscreen_scene=c[f];if(d)for(var h in d)a.textures[h].canvas_context=d[h];if(e)for(h in e)a.textures[h].video_file=e[h]}function K(a,
b,c,d,e){var f=h("WIREFRAME");m(f,"wireframe.glslv","wireframe.glslf");f.wireframe_mode=0;f.debug_sphere=!0;f.depth_mask=!0;f.odd_id_prop=c;e&&(f.debug_sphere_dynamic=!0);y(f,b);v(f,J.calc_variable_id(b,0));d?(b=W.generate_uv_sphere(16,8,1,a.center,!1,!1),Q.scale_submesh_xyz(b,[a.axis_x[0],a.axis_y[1],a.axis_z[2]],a.center)):b=W.generate_uv_sphere(16,8,a.radius,a.center,!1,!1);Q.submesh_drop_indices(b,1,!0);b.va_common.a_polyindex=Q.extract_polyindices(b);u(f,b);return f}function m(a,b,c){a.shaders_info=
{vert:b,frag:c,directives:[]};fa.set_default_directives(a.shaders_info)}function H(a,b,c){1==a.textures.length&&0==a.texture_names.length&&a.texture_names.push("default0");c=c||"default"+String(a.textures.length);-1==a.texture_names.indexOf(c)&&(a.textures.push(b),a.texture_names.push(c))}function D(a){if(!a.shaders_info)throw"No shaders info for batch "+a.name;a.shader=fa.get_compiled_shader(a.shaders_info,a.node_elements);L.assign_uniform_setters(a.shader);L.assign_attribute_setters(a)}function U(a,
b,c){var d=a.shaders_info;fa.set_directive(d,"SHADOW_SRC",b);fa.set_directive(d,"SHADOW_DST",c);return a}var P=p("__boundings"),Z=p("__config"),V=p("__print"),M=p("__extensions"),Q=p("__geometry"),T=p("__graph"),X=p("__nodemat"),z=p("__objects"),ia=p("__particles"),W=p("__primitives");p("__reformer");var L=p("__renderer"),G=p("__scenegraph");p("__scenes");var fa=p("__shaders"),da=p("__textures"),C=p("__tsr"),J=p("__util"),ha=p("vec3"),pa=p("vec4"),la=p("quat"),Y=Z.defaults,ja=["MAIN","NODES"];a.init_batch=
h;a.generate_main_batches=function(a,b,d,e,k){for(var l=[],n=[],q=0;q<d.length;q++){var r=d[q];switch(r._render.type){case "DYNAMIC":l.push(r);break;case "STATIC":n.push(r)}}d=[];d=d.concat(c(l,a,k));a=d=d.concat(f(n,a,b,k));q=[];r=[];b={};for(d=0;d<a.length;d++){l=a[d].batch;n=a[d].render;k=null;if(l.id in b){var t=b[l.id],s=r[t].render;J.strict_objs_is_equal(l,r[t].batch)&&J.strict_objs_is_equal(n,s)&&(k=r[t]);if(!k){do l.id++;while(b[l.id])}}k||(k={batch:l,render:a[d].render,rel_objects:[],submeshes:[],
mat_names:[]},b[l.id]=r.length,r.push(k));k.rel_objects=k.rel_objects.concat(a[d].rel_objects);a[d].submesh&&a[d].submesh.base_length&&k.submeshes.push(a[d].submesh);if(k.mat_names.length)for(l=0;l<a[d].mat_names.length;l++)n=a[d].mat_names[l],-1==k.mat_names.indexOf(n)&&k.mat_names.push(n);else k.mat_names=a[d].mat_names}for(d=0;d<r.length;d++){a=r[d].submeshes;if(0==a.length)a=J.create_empty_submesh(J.unique_name("%empty"));else if(1==a.length)a=a[0];else{b=[];for(l=0;l<a.length;l++)Q.is_long_submesh(a[l])||
b.push(l);if(b.length<a.length)for(l=0;l<b.length;l++)Q.submesh_drop_indices(a[b[l]]);a=Q.submesh_list_join(a)}q.push({batch:r[d].batch,render:r[d].render,submesh:a,mat_names:r[d].mat_names,rel_objects:r[d].rel_objects})}d=q;for(q=0;q<d.length;q++)u(d[q].batch,d[q].submesh),d[q].batch.material_names=d[q].mat_names;a=[];for(q=0;q<d.length;q++)if(b=d[q].batch,"STATIC"==d[q].render.type)r=J.init_object(J.unique_name("%meta"),"MESH"),r._render=d[q].render,r._batches=[b],a.push(r);else for(k=[],l=0;l<
d[q].rel_objects.length;l++)if(r=d[q].rel_objects[l],-1==k.indexOf(r.name)){for(n=0;n<r._batches.length;n++)if(r._batches[n]==b)throw"Batch already exist in object";r._batches.push(b);k.push(r.name)}if(Y.wireframe_debug){for(q=0;q<d.length;q++)b=d[q].render,"DYNAMIC"==b.type&&(r=d[q].rel_objects[0],-1<ja.indexOf(d[q].batch.type)&&(b=K(b.be_local,b,r.name,!0,!0),r._batches.push(b)));for(q=0;q<a.length;q++)r=a[q],b=r._render,-1<ja.indexOf(r._batches[0].type)&&(b=K(b.bs_local,b,r.name,!1),r._batches.push(b))}r=
null;if(e.texture_slots)for(q=0;q<e.texture_slots.length;q++)if(e.texture_slots[q].texture.b4w_use_as_skydome){r=x(e.texture_slots[q],null);break}if(e.b4w_sky_settings.procedural_skydome||r)b=h("MAIN"),m(b,"special_skydome.glslv","special_skydome.glslf"),e.b4w_sky_settings.procedural_skydome?b.procedural_sky=!0:H(b,r,"u_sky"),e.b4w_sky_settings.reflexible&&(b.reflexible=!0,e.b4w_sky_settings.reflexible_only&&(b.reflexible_only=!0)),g(b,"a_position"),b.offset_z=99999,e=W.generate_fullscreen_quad(),
u(b,e),r=J.init_object(J.unique_name("%meta"),"MESH"),r._render=z.create_render("DYNAMIC"),r._render.do_not_cull=!0,r._render.bb_local=P.zero_bounding_box(),r._render.bs_local=P.zero_bounding_sphere(),r._render.bb_world=P.zero_bounding_box(),r._render.bs_world=P.zero_bounding_sphere(),r._batches=[b],a.push(r);return a};a.wb_angle_to_amp=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";if(0==b)return 0;a=b*Math.tan(a/180*Math.PI);return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+
2)/2-1)/b};a.bb_bpy_to_b4w=l;a.get_batch_texture=x;a.assign_shadow_receive_dirs=function(a,b){A(a,"CSM_SECTION0",0);A(a,"CSM_SECTION1",0);A(a,"CSM_SECTION2",0);A(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)A(a,"CSM_SECTION"+String(c),1);A(a,"SHADOW_TEX_RES",fa.glsl_value(b.csm_resolution));A(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);A(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.set_batch_directive=A;a.get_batch_directive=function(a,b){return fa.get_directive(a.shaders_info,
b)};a.append_texture=H;a.replace_texture=function(a,b,c){c=a.texture_names.indexOf(c);-1<c&&(a.textures[c]=b)};a.create_shadeless_batch=function(a,b,c){var d=h("MAIN");1>c&&(d.blend=!0);pa.set(b[0],b[1],b[2],c,d.diffuse_color);d.draw_mode=Q.DM_TRIANGLES;u(d,a);m(d,"main.glslv","main.glslf");A(d,"SHADELESS",1);D(d);return d};a.update_shader=D;a.check_batch_perm_uniform=function(a,b){return a.shader.permanent_uniform_setters.length?a.shader.permanent_uniform_setters_table[b]?!0:!1:!1};a.create_shadow_batch_form_depth=
function(a,b,c){var d=h("DEPTH");d.use_backface_culling=a.use_backface_culling;d.texture_scale.set(a.texture_scale);d.dynamic_grass=a.dynamic_grass;d.bufs_data=a.bufs_data;d.id=a.id;d.render_id=a.render_id;a.textures.length&&(d.textures[0]=a.textures[0],d.texture_names[0]=a.texture_names[0]);d.colormap0_uv_velocity.set(a.colormap0_uv_velocity);d.common_attributes=a.common_attributes;d.jitter_amp=a.jitter_amp;d.jitter_freq=a.jitter_freq;d.grass_scale_threshold=a.grass_scale_threshold;d.num_triangles=
a.num_triangles;d.num_vertices=a.num_vertices;d.odd_id_prop=a.odd_id_prop;for(var e=0;e<a.material_names.length;e++)d.material_names.push(a.material_names[e]);d.particle_system=a.particle_system;a.childs||(a.childs=[]);a.childs.push(d);m(d,"depth.glslv","depth.glslf");fa.inherit_directives(d.shaders_info,a.shaders_info);return d=U(d,b,c)};a.update_batch_shadow_src_dst=U;a.create_depth_pack_batch=function(a){a=h("DEPTH_PACK");a.use_backface_culling=!0;a.depth_mask=!1;var b=W.generate_billboard();u(a,
b);m(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");D(a);return a};a.create_postprocessing_batch=function(a){var b=h("POSTPROCESSING");m(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":A(b,"POST_EFFECT","POST_EFFECT_NONE");b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "GRAYSCALE":A(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_BLUR":A(b,"POST_EFFECT","POST_EFFECT_X_BLUR");
b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_BLUR":A(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_EXTEND":A(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_EXTEND":A(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.use_backface_culling=!0;b.depth_mask=!1;a=W.generate_billboard();u(b,a);D(b);return b};a.create_edge_batch=function(a){a=
h("EDGE");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");D(a);return a};a.create_ssao_batch=function(a){var b=h("SSAO");b.depth_mask=!1;b.use_backface_culling=!0;b.texel_mask[0]=1;b.texel_mask[1]=1;var c=W.generate_billboard();u(b,c);m(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");A(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ssao_samples);A(b,"SSAO_HEMISPHERE",
a.ssao_hemisphere?1:0);a={texture:da.generate_texture("SSAO_TEXTURE",a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=x(a,c);H(b,a,"u_ssao_special_tex");D(b);return b};a.create_ssao_blur_batch=function(a){var b=h("SSAO_BLUR");b.depth_mask=!1;b.use_backface_culling=!0;b.texel_mask[0]=1;b.texel_mask[1]=
1;var c=W.generate_billboard();u(b,c);m(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");A(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);D(b);return b};a.create_dof_batch=function(a){a=h("DOF");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");A(a,"DEPTH_RGBA",1);D(a);return a};a.create_glow_batch=function(){var a=h("GLOW");a.depth_mask=!1;a.use_backface_culling=
!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");D(a);return a};a.create_god_rays_batch=function(a,b,c,d){a=h("GOD_RAYS");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var e=W.generate_billboard();u(a,e);m(a,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");A(a,"DEPTH_RGBA",b);A(a,"WATER_EFFECTS",c);A(a,"STEPS_PER_PASS",fa.glsl_value(d,1));D(a);return a};
a.create_god_rays_combine_batch=function(a,b){var c=h("GOD_RAYS_COM");c.depth_mask=!1;c.use_backface_culling=!0;c.texel_mask[0]=1;c.texel_mask[1]=1;var d=W.generate_billboard();u(c,d);m(c,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");D(c);return c};a.create_sky_batch=function(){var a=h("SKY");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_cube();u(a,b);m(a,"procedural_skydome.glslv","procedural_skydome.glslf");A(a,"NUM_LIGHTS",
1);A(a,"WATER_EFFECTS",1);D(a);return a};a.create_antialiasing_batch=function(){var a=h("ANTIALIASING");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;a.texel_size_multiplier=1/Y.resolution_factor;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");A(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");D(a);return a};a.create_smaa_batch=function(a){var b=h("SMAA"),c=W.generate_billboard();u(b,c);m(b,"postprocessing/smaa.glslv",
"postprocessing/smaa.glslf");A(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");A(b,"SMAA_PASS",a);A(b,"SMAA_PREDICATION",0);A(b,"SMAA_REPROJECTION",0);D(b);b.depth_mask=!1;b.use_backface_culling=!0;b.texel_mask[0]=1;b.texel_mask[1]=1;b.texel_size_multiplier=1/Y.resolution_factor;return b};a.create_lanczos_batch=function(a){var b=h("LANCZOS");b.depth_mask=!1;b.use_backface_culling=!0;b.texel_size_multiplier=1/Y.resolution_factor;"LANCZOS_X"==a?(b.texel_mask[0]=1,b.texel_mask[1]=0):"LANCZOS_Y"==a&&(b.texel_mask[0]=
0,b.texel_mask[1]=1);a=W.generate_billboard();u(b,a);m(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");D(b);return b};a.create_compositing_batch=function(){var a=h("COMPOSITING");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");D(a);return a};a.create_motion_blur_batch=function(a){var b=h("MOTION_BLUR");b.use_backface_culling=!0;b.depth_mask=
!1;var c=W.generate_billboard();u(b,c);m(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");A(b,"BLUR_DECAY_THRESHOLD",fa.glsl_value(a));D(b);return b};a.create_anaglyph_batch=function(a){a=h("ANAGLYPH");a.use_backface_culling=!0;a.depth_mask=!1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");D(a);return a};a.create_luminance_batch=function(){var a=h("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=
1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");D(a);return a};a.create_average_luminance_batch=function(){var a=h("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");D(a);return a};a.create_luminance_trunced_batch=function(){var a=h("LUMINANCE_X_BLUR");a.depth_mask=
!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");D(a);return a};a.create_bloom_blur_batch=function(a){var b=h("POSTPROCESSING");switch(a){case "X_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.use_backface_culling=!0;b.depth_mask=!1;a=W.generate_billboard();
u(b,a);m(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");D(b);return b};a.create_bloom_combine_batch=function(){var a=h("BLOOM");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");D(a);return a};a.create_velocity_batch=function(){var a=h("VELOCITY");a.depth_mask=!1;a.use_backface_culling=!0;a.texel_mask[0]=1;a.texel_mask[1]=1;var b=
W.generate_billboard();u(a,b);m(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");D(a);return a};a.set_texel_size=function(a,b,c){var d=a.texel_size_multiplier;a.texel_size[0]=b*a.texel_mask[0]*d;a.texel_size[1]=c*a.texel_mask[1]*d};a.set_texel_size_mult=function(a,b){a.texel_size_multiplier=b};a.find_batch_material=function(a,b,c){a=a._batches;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<f.material_names.indexOf(b)&&(c&&f.type==c||!c)){if(f.childs)return f;d=null===
d?f:d}}return d};a.clear_batch=function(a){for(var b=a.textures,c=0;c<b.length;c++)da.delete_texture(b[c].w_texture);Q.cleanup_bufs_data(a.bufs_data)}};b4w.module.__nodemat=function(a,p){function h(a,b,d){if(b in J)return J[b];for(var g=z.create(),h=a.nodes,m=a.links,n=a.animation_data,u=0;u<h.length;u++)if(!q(g,h[u],0,n))return J[b]=null;if(d&&-1==w(a,g,"GROUP_OUTPUT","group"))return null;u=U(g);if(!P(g,m,u))return null;if(d)return g;for(u=0;u<m.length;u++){d=m[u];for(var h=e(d.from_node,g),n=e(d.to_node,g),s=0;s<h.length;s++)for(var p=0;p<n.length;p++){for(var v=h[s],C=n[p],D=z.get_node_attr(g,v),B=z.get_node_attr(g,C),A=g,y=B,B=[],H=d.from_socket.identifier,
G=d.to_socket.identifier,I=D.outputs,D=0;D<I.length;D++)if(I[D].identifier==H){B.push(D);break}y=y.inputs;for(D=0;D<y.length;D++)if(y[D].identifier==G){B.push(D);break}2==B.length&&z.append_edge(A,v,C,B)}}l(g);a=w(a,g,"OUTPUT","material");if(-1==a)return J[b]=null;k(g);g=z.subgraph_node_conn(g,a,z.BACKWARD_DIR);f(g);r(g);x(g);t(g);return c(g)?J[b]=g:(X.error("Material has normalmap node but no material node"),J[b]=null)}function c(a){var b=!1,c=!1;z.traverse(a,function(a,d){if("MATERIAL"==d.type||
"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&!c?!1:!0}function f(a){z.traverse(a,function(c,d){for(var e=d.inputs,f=d.outputs,g=0;g<e.length;g++)b(a,e[g],c,g,1);for(g=0;g<f.length;g++)b(a,f[g],c,g,0)})}function b(a,b,c,d,e){if(b.is_linked){var f=!0;z.traverse_edges(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.is_linked=!1)}}function l(a){var b=[];z.traverse(a,function(c,d){switch(d.type){case "TRANSLUCENCY":z.traverse_edges(a,function(a,e,f){a==
c&&"Translucency"==d.outputs[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)z.append_edge(a,b[c],b[c+1],b[c+2])}function e(a,b){var c=[];z.traverse(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function k(a){var b=[];z.traverse(a,function(a,c){"PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var e=b[c],f=b[c+1];if("PARALLAX"==f.type){var g=d(a,e,1);if(-1!=g){var h=z.get_in_edge(a,g,0);z.remove_edge(a,
g,e,-1);-1!=h&&z.remove_edge(a,h,g,-1);e=z.get_node_attr(a,g);f.data=e.data;f.params[0]=e.params[0];z.remove_node(a,g)}f.inputs.splice(1,1)}else if("REROUTE"==f.type){for(var f=z.get_in_edge(a,e,0),k=z.out_edge_count(a,e),g=[],h=[],l=[],m=0;m<k;m++){var n=z.get_out_edge(a,e,m),q=h.indexOf(n);-1!=q?l[q]+=1:(h.push(n),l.push(1),g.push(e,n))}if(-1!=f)for(k=z.get_edge_attr(a,f,e,0)[0],m=0;m<h.length;m++)for(n=0;n<l[m];n++)q=z.get_edge_attr(a,e,h[m],n)[1],z.append_edge(a,f,h[m],[k,q]);for(m=0;m<g.length;m+=
2)z.remove_edge(a,g[m],g[m+1],-1)}}}function d(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function r(a){var b=[];z.traverse(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(n(f,k.attr)){g=[];h=z.out_edge_count(a,e);for(q=0;q<h;q++){var l=
z.get_out_edge(a,e,q),m=z.get_edge_attr(a,e,l,0);g.push(e,l,m);z.append_edge(a,k.id,l,m)}for(var q=0;q<g.length;q+=3)z.remove_edge(a,g[q],g[q+1],0);z.remove_node(a,e);g=!1;break}}g&&(k={id:e,attr:f},c.push(k))}}function x(a){var b=[];z.traverse(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(!(3<=k.merged_nodes.length)&&n(f,k.attr)){for(var h=[],l=z.in_edge_count(a,e),
g={},m=0;m<l;m++){var q=z.get_in_edge(a,e,m);q in g||(g[q]=0);var r=z.get_edge_attr(a,q,e,g[q]++);h.push(q,e,r)}for(var l=[],g=z.out_edge_count(a,e),u={},m=0;m<g;m++)q=z.get_out_edge(a,e,m),q in u||(u[q]=0),r=z.get_edge_attr(a,e,q,u[q]++),l.push(e,q,r);for(var g=h.concat(l),m=0;m<g.length;m+=3)z.remove_edge(a,g[m],g[m+1],0);z.remove_node(a,e);m={attr:f,edges_in:h,edges_out:l};k.merged_nodes.push(m);g=!1;break}}g&&(k={id:e,attr:f,merged_nodes:[]},c.push(k))}for(d=0;d<c.length;d++){k=c[d];e=k.merged_nodes.length;
l=k.attr.inputs.length;g=k.attr.outputs.length;for(h=0;h<e;h++){r=k.merged_nodes[h];m=r.attr;f=r.edges_in;u=r.edges_out;k.attr.inputs=k.attr.inputs.concat(m.inputs);k.attr.outputs=k.attr.outputs.concat(m.outputs);for(m=0;m<k.attr.inputs.length;m++)k.attr.inputs[m].identifier+=W.trunc(m/l)+1;for(m=0;m<k.attr.outputs.length;m++)k.attr.outputs[m].identifier+=W.trunc(m/g)+1;for(m=0;m<f.length;m+=3)q=f[m],r=f[m+2],r[1]+=(h+1)*l,z.append_edge(a,q,k.id,r);for(m=0;m<u.length;m+=3)q=u[m+1],r=u[m+2],r[0]+=
(h+1)*g,z.append_edge(a,k.id,q,r)}switch(e){case 1:k.attr.type+="2";break;case 2:k.attr.type+="3";break;case 3:k.attr.type+="4"}z.remove_node(a,k.id);z.append_node(a,k.id,k.attr)}}function n(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function t(a){var b=
[];z.traverse(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],l=z.out_edge_count(a,d),m=0;m<l;m++){var n=z.get_out_edge(a,d,m);if("SEPRGB"!=z.get_node_attr(a,n).type){f=!1;break}g.push(d,n);for(var q={},r=z.out_edge_count(a,n),f=0;f<r;f++){var u=z.get_out_edge(a,n,f);u in q||(q[u]=0);var t=z.get_edge_attr(a,n,u,q[u]++);g.push(n,u);k[t[0]].push(d,u,t)}h.push(n);f=!0}if(f){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,
d|=1<<2-m);if(l){e.type+=l;e.outputs=[];for(m=0;m<k.length;m++)if(k[m].length)for(e.outputs.push({default_value:0,identifier:"RGB"[m],is_linked:!0,name:"RGB"[m]}),f=0;f<k[m].length;f+=3)k[m][f+2][0]=W.rgb_mask_get_channel_presence_index(d,m);for(m=0;m<g.length;m+=2)z.remove_edge(a,g[m],g[m+1],0);for(m=0;m<h.length;m++)z.remove_node(a,h[m]);for(m=0;m<k.length;m++)for(f=0;f<k[m].length;f+=3)z.append_edge(a,k[m][f],k[m][f+1],k[m][f+2])}}}}function w(a,b,c,d){a=a.nodes;for(var f=null,g=0;g<a.length;g++){var h=
a[g];h.type==c&&(f=h)}return f?e(f,b)[0]:(X.error('No "'+c+'" node in node '+d),-1)}function B(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function q(a,b,c,d){var e=b.name,f=b.type,k=[],l=[],n=[],r=[],t=null;switch(f){case "CAMERA":l=[];n=K(b);break;case "COMBRGB":case "COMBHSV":l=v(b);n=K(b);break;case "GEOMETRY":a:{for(var f=b.outputs,x=0;x<f.length;x++)if(f[x].is_linked){f=!0;break a}f=!1}if(!f)return!0;f=g(b,c);if(!f)return X.error("Geometry output is not supported"),!1;switch(f){case "GEOMETRY_UV":if(!b.uv_layer)return X.error('Missing uv layer in node "',
b.name,'"'),!1;t=y("param_GEOMETRY_UV_a");x=y("param_GEOMETRY_UV_v");k.push(m(t));k.push(m(x));n.push(u(b,"UV"));r.push(m(x));t={name:t,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return X.error("Missing vertex color layer in node ",b.name),!1;t=y("param_GEOMETRY_VC_a");x=y("param_GEOMETRY_VC_v");k.push(m(t));k.push(m(x));n.push(u(b,"Vertex Color"));r.push(m(x));t={name:t,value:b.color_layer};break;case "GEOMETRY_NO":n.push(u(b,"Normal"));break;case "GEOMETRY_FB":n.push(u(b,"Front/Back"));
break;case "GEOMETRY_VW":n.push(u(b,"View"));break;case "GEOMETRY_GL":n.push(u(b,"Global"))}break;case "GROUP":x=b.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(x){case "LINEAR_TO_SRGB":f="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":case "VECTOR_VIEW":f="VECTOR_VIEW";break;case "SRGB_TO_LINEAR":f="SRGB_TO_LINEAR";break;case "REFLECT":f="REFLECT";break;case "REFRACTION":f="REFRACTION";break;case "PARALLAX":f="PARALLAX";if(!b.inputs[1].is_linked)return X.error('Missing texture in node "',b.name,'"'),
!1;var p=y("temp_texture");r.push(m(p));break;case "CLAMP":f="CLAMP";break;case "TRANSLUCENCY":f="TRANSLUCENCY";break;case "TIME":f="TIME";break;case "SMOOTHSTEP":f="SMOOTHSTEP";break;default:n=b.node_group.node_tree;l={};for(p in n)if("links"==p||"nodes"==p)for(l[p]=[],t=0;t<n[p].length;t++){l[p][t]={};for(var w in n[p][t])if("links"==p){l[p][t][w]={};for(var C in n[p][t][w])l[p][t][w][C]=s(n[p][t][w][C])}else l[p][t][w]=s(n[p][t][w])}else l[p]=s(n[p]);if("REPLACE"==x||"LEVELS_OF_QUALITY"==x)n=B("Group input",
"GROUP_INPUT",[],b.inputs),t=B("Group output","GROUP_OUTPUT",b.outputs,[]),p=null,p="REPLACE"==x||"LEVELS_OF_QUALITY"==x&&(la.quality==L.P_LOW||la.force_low_quality_nodes)?{from_node:n,from_socket:n.outputs[1],to_node:t,to_socket:t.inputs[0]}:{from_node:n,from_socket:n.outputs[0],to_node:t,to_socket:t.inputs[0]},l.nodes=[n,t],l.links=[p];n=b.name;t=l.nodes;p=l.links;for(w=0;w<t.length;w++)t[w].name=D(t[w].type,n,t[w].name);for(w=0;w<p.length;w++)p[w].from_node.name=D(p[w].from_node.type,n,p[w].from_node.name),
p[w].to_node.name=D(p[w].to_node.type,n,p[w].to_node.name);t={node_group_graph:h(l,b.node_group.uuid,!0),node_group_links:l.links}}l=v(b);n=K(b);"TRANSLUCENCY"==x&&(x=I("TranslucencyParams","TranslucencyParams",[0,0,0,0]),x.is_linked=n[0].is_linked,n.push(x));break;case "LAMP":t=b.lamp;if(!t)return X.error("There is no lamp in node: "+b.name),!1;n.push(u(b,"Color"));n.push(u(b,"Light Vector"));n.push(u(b,"Distance"));n.push(u(b,"Visibility Factor"));t.uuid in ha?r.push(m(y("param_LAMP_lamp_index"),
ha[t.uuid],1)):(ha[t.uuid]=pa,r.push(m(y("param_LAMP_lamp_index"),pa++,1)));t=ha;break;case "NORMAL":l=v(b);n=K(b);x=u(b,"Normal");r.push(m(y("param_NORMAL_Normal"),x.default_value,3));break;case "MAPPING":l.push(A(b,"Vector"));n.push(u(b,"Vector"));if(0!=G.length(b.translation)||0!=G.length(b.rotation)||b.use_max||b.use_min){var f="MAPPING_HEAVY",H=b.rotation,x=fa.create(),p=Math.cos(H[0]);w=Math.cos(H[1]);C=Math.cos(H[2]);var J=Math.sin(H[0]),P=Math.sin(H[1]),H=Math.sin(H[2]),S=p*C,U=p*H,M=J*C,
T=J*H;x[0]=w*C;x[1]=w*H;x[2]=-P;x[3]=P*M-U;x[4]=P*T+S;x[5]=w*J;x[6]=P*S+T;x[7]=P*U-M;x[8]=w*p;p=b.scale;w=new Float32Array([p[0],0,0,0,p[1],0,0,0,p[2]]);p=fa.create();fa.multiply(x,w,p);x=b.translation;p=W.mat3_to_mat4(p,da.create());p[12]=x[0];p[13]=x[1];p[14]=x[2];r.push(m(y("param_MAPPING_HEAVY_trs_matrix"),p,16));r.push(m(y("param_MAPPING_HEAVY_use_min"),~~b.use_min,1));r.push(m(y("param_MAPPING_HEAVY_use_max"),~~b.use_max,1));r.push(m(y("param_MAPPING_LIGHT_min_clip"),b.min,3));r.push(m(y("param_MAPPING_LIGHT_max_clip"),
b.max,3))}else f="MAPPING_LIGHT",r.push(m(y("param_MAPPING_LIGHT_scale"),b.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":t=b.material;if(!t)return X.error("Emtpy material slot in node: "+b.name),!1;p=A(b,"Color");p.default_value.splice(3);l.push(p);(p=A(b,"Alpha"))?l.push(p):l.push(I("Alpha","Alpha",1));p=A(b,"Spec");p.default_value.splice(3);l.push(p);x=A(b,"Normal");x.default_value.splice(3);l.push(x);n.push(u(b,"Color"));n.push(u(b,"Alpha"));n.push(u(b,"Normal"));"MATERIAL_EXT"==f&&((p=A(b,
"Emit"))?l.push(p):l.push(I("Emit","Emit",0)),p=A(b,"Translucency"),p.default_value=0,p.name="Translucency",p.identifier="Translucency",p?l.push(p):l.push(I(p.name,p.identifier,p.default_value)),p=A(b,"Translucency"),p.default_value=[0,0,0,0],p.name="TranslucencyParams",p.identifier="TranslucencyParams",p?l.push(p):l.push(I(p.name,p.identifier,p.default_value)),(p=A(b,"Ray Mirror"))?l.push(p):l.push(I("Ray Mirror","Ray Mirror",0)),(p=A(b,"SpecTra"))?l.push(p):l.push(I("SpecTra","SpecTra",0)),n.push(u(b,
"Diffuse")),n.push(u(b,"Spec")));w=0;switch(t.specular_shader){case "COOKTORR":case "PHONG":p=t.specular_hardness;break;case "WARDISO":p=t.specular_slope;break;case "TOON":p=t.specular_toon_size;w=t.specular_toon_smooth;break;default:X.error("B4W Error: unsupported specular shader: "+t.specular_shader+' (material "'+t.name+'")'),p=t.specular_hardness}switch(t.diffuse_shader){case "LAMBERT":J=C=0;break;case "OREN_NAYAR":C=t.roughness;J=0;break;case "FRESNEL":C=t.diffuse_fresnel;J=t.diffuse_fresnel_factor;
break;default:X.error("B4W Error: unsupported diffuse shader: "+t.diffuse_shader+' (material "'+t.name+'")'),J=C=0}r.push(m(y("param_MATERIAL_diffuse"),[b.use_diffuse?1:0,C,J],3));r.push(m(y("param_MATERIAL_spec"),[b.use_specular?1:0,t.specular_intensity,p,w],4));r.push(m(y("param_MATERIAL_norm"),x.is_linked?1:0,1));t={name:b.name,value:t};break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f=
"MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";
break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return X.error("Unsupported MATH operation: "+b.operation),!1}l=v(b);n=K(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f=
"MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return X.error("Unsupported MIX_RGB blend type: "+b.blend_type),
!1}l=v(b);n=K(b);break;case "OUTPUT":l=v(b);n=[];break;case "RGB":x=u(b,"Color");n.push(x);r.push(m(y("param_RGB_Color"),x.default_value,3));break;case "SEPRGB":case "SEPHSV":l=v(b);n=K(b);break;case "TEXTURE":if(!b.texture)return X.error("No texture attached to node: "+b.name),!1;a:{f=b.outputs;t=!1;for(x=0;x<f.length;x++)if(p=f[x],p.is_linked)switch(p.identifier){case "Color":f="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":f="TEXTURE_NORMAL";break a;
case "Value":t=!0;break;default:throw"Unknown texture output";}f=t?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}l.push(A(b,"Vector"));if("TEXTURE_COLOR"==f||"TEXTURE_ENVIRONMENT"==f)n.push(u(b,"Color")),n.push(u(b,"Value"));"TEXTURE_NORMAL"==f&&(n.push(u(b,"Normal")),n.push(u(b,"Value")));p=y("param_TEXTURE_texture");r.push(m(p));t={name:p,value:b.texture};break;case "VALUE":a:if(d){if(f=d.action)for(x in P=f._render.params,P)if(P=x.match(/"(.*?)"/)[1],P==b.name){p=
f.name+"_"+x;break a}p=d.nla_tracks;for(w=0;w<p.length;w++)for(C=p[w].strips,J=0;J<p[w].strips.length;J++)for(x in f=C[J].action,P=f._render.params,P)if(P=x.match(/"(.*?)"/)[1],P==b.name){p=f.name+"_"+x;break a}p=void 0}else p=null;x=u(b,"Value");p?(f="ANIM_VALUE",w={name:y("param_ANIM_VALUE_Value"),value:"0"},r.push(w),w={name:"-1",value:p},r.push(w)):(f="VALUE",r.push(m(y("param_value_value"),x.default_value,1)));n.push(x);break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";
break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return X.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=v(b);n=K(b);break;default:l=v(b),n=K(b)}e={name:e,type:f,vparams:k,inputs:l,outputs:n,params:r,data:t};z.append_node(a,z.gen_node_id(a),e);if(e="GEOMETRY"==b.type)a:{e=b.outputs;
for(r=k=0;r<e.length;r++)if(e[r].is_linked&&k++>c){e=!0;break a}e=!1}return e&&!q(a,b,++c,d)?!1:!0}function s(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?W.clone_object_nr(a):a}function y(a){C[a]||(C[a]=0);var b=a+C[a],b=b.replace(/ /g,"_").replace(/\//g,"_");C[a]++;return b}function g(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";
case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function A(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return S(e)}return null}function u(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return S(e)}return null}function S(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=W.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,is_linked:d,default_value:a}}
function I(a,b,c){return{name:a,identifier:b,is_linked:!1,default_value:c}}function v(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=S(a.inputs[c]);d.default_value.length&&d.default_value.splice(3);b.push(d)}return b}function K(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=S(a.outputs[c]);b.push(d)}return b}function m(a,b,c){b=null===b||void 0===b?null:ia.glsl_value(b,c);if(la.shader_constants_hack&&b){c=["param_MAPPING_HEAVY_trs_matrix","param_MAPPING_LIGHT_min_clip","param_MAPPING_LIGHT_max_clip",
"param_MAPPING_HEAVY_use_min","param_MAPPING_HEAVY_use_max"];for(var d=!1,e=0;e<c.length;e++)if(0<=a.indexOf(c[e])){d=!0;break}d&&(b=H(b))}return{name:a,value:b}}function H(a){a=a.replace(/(,)/g,"$1 ");a=a.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3");a=a.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3");return a=a.replace(/\s+/g,"")}function D(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function U(a){var b=[];z.traverse(a,
function(a,c){"GROUP"==c.type&&b.push(c)});return b}function P(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.node_group_graph,f=c[d].data.node_group_links;if(!e)return!1;z.traverse(e,function(b,c){z.append_node(a,z.gen_node_id(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);T(c[d],b,a)}return!0}function Z(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function V(a,
b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function M(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function Q(a,b,c,d){for(var f=0;f<d.length;f++){for(var g=d[f],h,k=0;k<c.inputs.length;k++)if(g.from_socket.identifier==
c.inputs[k].identifier){h=c.inputs[k].default_value;break}for(var k=g,l=b,m=h,n=e(k.to_node,l),q=0;q<n.length;q++)for(var r=z.get_node_attr(l,n[q]),t=0;t<r.inputs.length;t++)if(r.inputs[t].identifier==k.to_socket.identifier){r.inputs[t].default_value=m;break}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function T(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var l=b[k];Z(l.from_node,d,l,e,g,h);Z(l.to_node,d,l,f,g,h)}f=V(b,f,g);e=V(b,h,e);M(b,f);Q(b,c,a,f);if(e.length){var m;z.traverse(c,
function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});Q(b,c,m,e)}}var X=p("__print"),z=p("__graph"),ia=p("__shaders"),W=p("__util"),L=p("__config"),G=p("vec3"),fa=p("mat3"),da=p("mat4"),C={},J={},ha={},pa=0,la=L.defaults;a.compose_nmat_graph=h;a.compose_node_elements=function(a){var b=[],c={};C={};var d=z.topsort(a);z.traverse(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],l=[],m=0;m<d.inputs.length;m++){var n=d.inputs[m];if(n.is_linked)e.push(null),f.push(null);else{e.push(y("in_"+
d.type+"_"+n.identifier));var q=ia.glsl_value(n.default_value,0);la.shader_constants_hack&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier))&&(q=H(q));f.push(q)}}for(m=0;m<d.outputs.length;m++)n=d.outputs[m],n.is_linked?g.push(null):g.push(y("out_"+d.type+"_"+n.identifier));for(m=0;m<d.params.length;m++)n=d.params[m],h.push(n.name),k.push(n.value);for(m=0;m<d.vparams.length;m++)l.push(d.vparams[m].name);
e={id:d.type,inputs:e,input_values:f,outputs:g,params:h,param_values:k,vparams:l};b.push(e);c[a]=e});z.traverse_edges(d,function(a,b,e){var f=z.get_node_attr(d,a);z.get_node_attr(d,b);var g=f.outputs[e[0]];a=c[a].outputs;b=c[b].inputs;f=a[e[0]]||y("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in J)delete J[a];for(var b in ha)delete ha[b];pa=0}};b4w.module.__animation=function(a,p){function h(a,b){var c=a._anim_slots[b];c&&c.finish_callback&&c.exec_finish_callback&&(c.exec_finish_callback=!1,c.finish_callback(a))}function c(a,b,c){c=a._anim_slots[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.current_frame_float=d;c.animation_name=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.va_frame_offset=d}function f(a,b,c){a=a._anim_slots[c];
a.type=50;a.animation_name=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);a.particle_system=b}function b(a){return a.replace(/_B4W_BAKED$/,"")}function l(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ia.panic("Wrong animation behavior")}}function e(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&
b.push(d.action))}return b}function k(a){return ia.is_mesh(a)&&a._render.vertex_anim?!0:!1}function d(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function r(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function x(a,b,c){y(a,b,c);h(a,c);a._render.anim_mixing&&(u(a,b),A(a,b))}function n(a,b,c){var d=b.frame_range,e=b._render,f=a._anim_slots[c];f.animation_name=b.name;f.action_frame_range=d;f.action_step=e.pierce_step;
f.action_bflags=e.bflags;f.start=d[0];f.length=d[1]-d[0];f.current_frame_float=d[0];d=ia.get_dict_length(e.bones);if(ia.is_armature(a)&&d){f.type=10;var g=t(a,b);g||(g=q(a),g=S(a,b,g),a._action_anim_cache.push(b,g));f.trans=g.trans;f.quats=g.quats;var f=a._render,g=f.skinned_renders,h=a._anim_slots[c],e=h.skinning_data,k;a:{k=f.skinning_data_cache;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=k[l+1];break a}k=null}if(k)h.skinning_data=k;else{for(h=0;h<g.length;h++)k=S(a,b,g[h].bone_pointers),e.push(k);
f.skinning_data_cache.push(b,e)}f.anim_mixing&&(b=f.two_last_skeletal_slots,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),w(a))}else if(T.is_speaker(a)&&(e.params.volume||e.params.pitch))f.volume=e.params.volume||null,f.pitch=e.params.pitch||null,f.type=40;else if("MESH"==a.type&&s(b)){f.type=70;e=t(a,b);if(!e){e=[];h=[];k=b._render;l=a._render.mats_anim_inds;for(g in k.params)for(var m=b.name+"_"+g,n=0;n<l.length;n+=2)if(m==l[n]){e.push(l[n+1]);h.push(k.params[g]);break}e={value_inds:e,
values:h};a._action_anim_cache.push(b,e)}f.node_value_inds=e.value_inds;f.nodemat_values=e.values}else if(g=e.params.tsr){f.type=20;e=t(a,b);if(!e){e=b._render.num_pierced;h=[];k=[];for(l=0;l<e;l++)h.push(g.subarray(8*l,8*l+4)),k.push(g.subarray(8*l+4,8*l+8));e={trans:h,quats:k};a._action_anim_cache.push(b,e)}f.trans=e.trans;f.quats=e.quats;Z.has_particles(a)&&Z.update_start_pos(a,f.trans,f.quats)}else M.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),
f.type=60;ia.is_armature(a)&&!d&&B(a,c)}function t(a,b){for(var c=a._action_anim_cache,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function w(a){var b=a._render.two_last_skeletal_slots;if(-1!=b[0]&&-1!=b[1]){var c=a._anim_slots;a=c[b[1]].current_frame_float;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.current_frame_float;d=Math.floor(a);b.current_frame_float=d+e}}function B(a,b){var c=a._render.two_last_skeletal_slots,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a._anim_slots;0<=d;d--){var f=
e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function q(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={bone_index:d,deform_bone_index:d,pose_bone_index:ia.get_index_for_key_value(a,"name",e),vgroup_index:-1}}return c}function s(a){a=a._render;for(var b in a.params)if(-1!=b.indexOf("nodes"))return!0;return!1}function y(a,b,c){if((c=a._anim_slots[c])&&(c.play||0==b)){var d=a._render,e=c.current_frame_float,f=c.start,h=c.length,e=e+
c.speed*b*L.framerate,k=c.type,l=c.speed;if(0<=l&&e>=f+h||0>l&&e<f)switch(c.exec_finish_callback=!0,c.behavior){case 10:e=0<=l?(e-f)%h+f:f+h-1E-6;break;case 20:e=0<=l?f:f+h-1E-6;c.play=!1;break;case 30:e=0<=l?f+h-1E-6:f,c.play=!1}c.current_frame_float=e;switch(k){case 10:if(!d.anim_mixing){e=g(c,e,G);b=e[0];f=e[1];e=e[2];d.quats_before=c.quats[b];d.quats_after=c.quats[f];d.trans_before=c.trans[b];d.trans_after=c.trans[f];d.frame_factor=e;d=d.skinned_renders;c=c.skinning_data;for(h=0;h<d.length;h++)k=
d[h],l=c[h],k.quats_before=l.quats[b],k.quats_after=l.quats[f],k.trans_before=l.trans[b],k.trans_after=l.trans[f],k.frame_factor=e;X.update_transform(a)}break;case 20:k=e=g(c,e,G);(d=fa)||(d=new Float32Array(4));var f=k[0],h=k[1],k=k[2],l=c.trans,m=l[f][1],n=l[f][2],q=l[h][1],r=l[h][2];d[0]=(1-k)*l[f][0]+k*l[h][0];d[1]=(1-k)*m+k*q;d[2]=(1-k)*n+k*r;f=e;(h=C)||(h=new Float32Array(4));k=f[1];l=f[2];m=c.quats;W.slerp(m[f[0]].subarray(0,4),m[k].subarray(0,4),l,h);f=h;h=e[2];k=c.trans;e=(1-h)*k[e[0]][3]+
h*k[e[1]][3];c.trans_smooth_period&&(h=da,X.get_translation(a,h),ia.smooth_v(d,h,b,c.trans_smooth_period,d));c.quat_smooth_period&&(h=J,X.get_rotation(a,h),ia.smooth_q(f,h,b,c.quat_smooth_period,f));X.set_translation(a,d);X.set_rotation(a,f);X.set_scale(a,e);X.update_transform(a);V.sync_transform(a);break;case 30:(a=G)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=b-=1,f=1);c=c.va_frame_offset;a[0]=b+c;a[1]=e+c;a[2]=f;e=G;
d.va_frame=e[0];d.va_frame_factor=e[2];break;case 40:e=g(c,e,G);b=e[0];d=e[1];e=e[2];c.volume&&T.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&T.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:Z.set_time(c.particle_system,e/L.framerate);break;case 70:e=g(c,e,G);b=e[0];d=e[1];e=e[2];f=c.nodemat_values;c=c.node_value_inds;for(h=0;h<c.length;h++)k=f[h],a._render.mats_anim_values[c[h]]=(1-e)*k[b]+e*k[d];break;case 60:break;default:throw"Unknown animation type:"+k;}}}function g(a,b,c){c||
(c=Array(3));var d=a.action_frame_range[0],e=a.action_frame_range[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.action_step;e=Math.floor(b);a=a.action_bflags[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function A(a,b){var c=a._render,d=c.anim_mix_factor,e=c.two_last_skeletal_slots,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var h=a._anim_slots[f];if(h.play||0==b)var k=g(h,h.current_frame_float,G),l=k[0],m=k[1],k=k[2],n=h.quats[l],q=h.quats[m],l=h.trans[l],m=h.trans[m];else d=1}else d=1;e=a._anim_slots[e];if(e.play||0==
b)var k=g(e,e.current_frame_float,G),r=k[0],t=k[1],k=k[2];else if(-1!=f&&h.play)d=0;else return;f=e.quats[r];h=e.quats[t];r=e.trans[r];e=e.trans[t];if(1==d)c.quats_before.set(f),c.quats_after.set(h),c.trans_before.set(r),c.trans_after.set(e);else if(0==d)c.quats_before.set(n),c.quats_after.set(q),c.trans_before.set(l),c.trans_after.set(m);else{for(t=0;t<n.length;t+=4){for(var u=C,s=J,p=0;4>p;p++)u[p]=n[t+p],s[p]=f[t+p];W.slerp(u,s,d,u);for(p=0;4>p;p++)c.quats_before[t+p]=u[p];for(p=0;4>p;p++)u[p]=
q[t+p],s[p]=h[t+p];W.slerp(u,s,d,u);for(p=0;4>p;p++)c.quats_after[t+p]=u[p]}ia.blend_arrays(l,r,d,c.trans_before);ia.blend_arrays(m,e,d,c.trans_after)}d=c.skinned_renders;n=c.mesh_to_arm_bone_maps;for(t=0;t<d.length;t++){q=d[t];l=n[t];for(m=0;m<l.length;m+=2)for(r=l[m],f=l[m+1],h=0;4>h;h++)q.quats_before[r+h]=c.quats_before[f+h],q.quats_after[r+h]=c.quats_after[f+h],q.trans_before[r+h]=c.trans_before[f+h],q.trans_after[r+h]=c.trans_after[f+h];q.frame_factor=k}}}function u(a,b){var c=a._render,d=c.anim_mix_factor,
e=c.anim_mix_factor_change_speed;if(0!=e){var d=c.anim_destination_mix_factor-d,f=e*b;ia.sign(d)==ia.sign(e)&&Math.abs(f)<Math.abs(d)?c.anim_mix_factor+=f:(c.anim_mix_factor=c.anim_destination_mix_factor,c.anim_mix_factor_change_speed=0)}}function S(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b._render.num_pierced,h=0;h<g;h++){for(var k=0;k<d.length;k++){var l=d[k],m=z.create(),n=b._render.bones[l.name];n&&z.copy(n.subarray(8*h,8*h+8),m);l._tsr_basis=m;l._tsr_channel_cache_valid=!1}k=I(a,c);e.push(k.trans);
f.push(k.quats)}return{trans:e,quats:f}}function I(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],l=k.deform_bone_index,m=e[k.pose_bone_index],k=f,n=g,q=m._chain,r=q[q.length-1],t=r._tsr_channel_cache;r._tsr_channel_cache_valid||z.identity(t);for(r=q.length-1;0<=r;r--){var m=q[r],u=m._tsr_channel_cache;if(m._tsr_channel_cache_valid)t=u;else{var s=m._tsr_local,p=m._tsr_basis;z.invert(s,ha);z.multiply(p,ha,ha);z.multiply(s,ha,ha);z.multiply(t,
ha,u);t=u;m._tsr_channel_cache_valid=!0}}m=m._tsr_channel_cache;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=m[6];n[3]=m[7];W.normalize(n,n);for(k=0;4>k;k++)n=4*l+k,c[n]=f[k],d[n]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{trans:c,quats:d}}function v(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=K(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?v(a,h,c,d,e,f,g):v(h,b,c,d,e,f,g)}function K(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function m(a,b){a._anim_slots||(a._anim_slots=
[null,null,null,null,null,null,null,null]);a._anim_slots[b]={type:null,animation_name:null,quats:null,trans:null,skinning_data:[],play:!1,behavior:20,current_frame_float:0,start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,pitch:null,nodemat_values:[],node_value_inds:[]};a._action_anim_cache=a._action_anim_cache||[];-1==pa.indexOf(a)&&pa.push(a)}function H(a,b){X.update_transform(a);V.sync_transform(a);x(a,0,b)}function D(a,
b,d){d=d||0;if(ia.is_mesh(a)){var e=ia.keysearch("name",b,a.data.b4w_vertex_anim);if(e)return m(a,d),c(a,e,d),H(a,d),1;if((e=ia.keysearch("name",b,a.particle_systems))&&"EMITTER"==e.settings.type)return m(a,d),f(a,e,d),H(a,d),1}if(e=ia.keysearch("name",b,la)||ia.keysearch("name",b+"_B4W_BAKED",la)){if(!ia.get_dict_length(e.fcurves))return M.error('No fcurves in action "'+e.name+'"'),0;m(a,d);n(a,e,d);H(a,d);return 1}M.error('Unsupported object: "',a.name,'" or animation name: "',b,'"');return 0}function U(a){if("MESH"!=
a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var P=p("__config"),Z=p("__particles"),V=p("__physics"),M=p("__print"),Q=p("__scenes"),T=p("__sfx"),X=p("__transform"),z=p("__tsr"),ia=p("__util");p("mat4");var W=p("quat");p("vec4");var L=P.animation;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;
a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var G=Array(3),fa=new Float32Array(3),da=new Float32Array(3),C=new Float32Array(4),J=new Float32Array(4),ha=new Float32Array(8);new Float32Array(16);var pa=[],la=[];a.frame_to_sec=function(a){return a/L.framerate};a.update=function(a){for(var b=0;b<pa.length;b++){for(var c=pa[b],d=0;8>d;d++)y(c,
a,d);c._render.anim_mixing&&(u(c,a),A(c,a))}for(b=0;b<pa.length;b++)for(c=pa[b],d=0;8>d&&c._anim_slots;d++)h(c,d)};a.get_all_actions=function(){return la};a.get_current_animation_name=function(a,c){var d=a._anim_slots[c];return d&&d.animation_name?b(d.animation_name):null};a.get_anim_names=function(a){var c=[];if(k(a))for(var d=0;d<a.data.b4w_vertex_anim.length;d++)c.push(a.data.b4w_vertex_anim[d].name);var f,d=[];for(f=0;f<la.length;f++){var g=la[f],h=ia.get_dict_length(g._render.bones),l=g._render;
h?"ARMATURE"==a.type&&d.push(g):l.params.volume||l.params.pitch?T.is_speaker(a)&&d.push(g):s(g)||d.push(g)}"MESH"==a.type&&(d=d.concat(e(a)));f=d;for(d=0;d<f.length;d++)c.push(b(f[d].name));if(Z.has_particles(a)&&Z.has_anim_particles(a))for(d=0;d<a.particle_systems.length;d++)c.push(a.particle_systems[d].name);return c};a.strip_baked_suffix=b;a.get_anim_type=function(a,b){var c=a._anim_slots[b];return c?c.type:null};a.apply_def=function(a){var b=0,d;d=[];var g=a.animation_data;if(g&&g.action){var h=
ia.get_dict_length(g.action._render.bones);"ARMATURE"!=a.type&&h||d.push(g.action)}T.is_speaker(a)&&a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);"MESH"==a.type&&(d=d.concat(e(a)));for(g=0;g<d.length;g++)h=d[g],ia.get_dict_length(h.fcurves)?(m(a,b),n(a,h,b),H(a,b),a._anim_slots[b].behavior=l(a.b4w_anim_behavior),b++):M.error('No fcurves in action "'+h.name+'"');h=a.particle_systems;for(g=0;g<h.length;g++){var q=h[g],r=q.settings;"EMITTER"==r.type&&(m(a,
b),f(a,q,b),H(a,b),a._anim_slots[b].behavior=l(a.b4w_anim_behavior),r.b4w_cyclic&&(a._anim_slots[b].behavior=10),b++)}k(a)?(m(a,b),c(a,a.data.b4w_vertex_anim[0],b),H(a,b),a._anim_slots[b].behavior=l(a.b4w_anim_behavior)):d.length||Z.has_anim_particles(a)||(m(a,0),d=a._anim_slots[0],d.type=60,d.animation_name=a.name+"_STATIC",g=Q.get_scene_timeline(Q.get_active()),d.start=g[0],d.length=g[1]-g[0]+1,H(a,b))};a.get_first_armature_object=d;a.play=function(a,b,c){r(a._anim_slots,c,function(a){a.play=!0;
a.finish_callback=b?b:null;a.exec_finish_callback=!1});a._render.anim_mixing&&w(a)};a.stop=function(a,b){r(a._anim_slots,b,function(a){a.play=!1;a.finish_callback=null;a.exec_finish_callback=!1})};a.is_play=function(a,b){var c=a._anim_slots[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a._anim_slots;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.current_frame_float=b,x(a,0,c))}else if(e=d[c])e.current_frame_float=b,x(a,0,c)};a.get_current_frame_float=function(a,b){var c=a._anim_slots[b];
return c&&c.current_frame_float?c.current_frame_float:0};a.is_cyclic=function(a,b){var c=a._anim_slots[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){r(a._anim_slots,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a._anim_slots[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){r(a._anim_slots,d,function(a){a.trans_smooth_period=b||0;a.quat_smooth_period=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a._anim_slots[c]=null;else a._anim_slots[b]=
null;a._render.anim_mixing&&B(a,b)};a.update_object_animation=x;a.is_animatable=function(a){if("ARMATURE"==a.type||d(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||Z.has_particles(a)&&Z.has_anim_particles(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||U(a)?!0:!1};a.is_animated=function(a){return a._anim_slots?!0:!1};a.calc_armature_bone_pointers=q;a.calc_pose_data=I;a.append_action=function(a){a._render={};var b=a._render;
b.pierce_step=1/L.frame_steps;var c=new RegExp(/pose.bones\[\".+\"\]/g),d=z.create(),e=function(a,b,e,f){if(-1<e.search(c)){a=b;e=e.split('"')[1];var g=d}else-1<e.indexOf("location")?(e="tsr",g=d):-1<e.indexOf("rotation_quaternion")?(e="tsr",g=d):-1<e.indexOf("scale")?(e="tsr",g=d):g=0;if(!a[e]){b=a;var h=e;if("object"==typeof g&&g.length)for(var k=g.length,l=new Float32Array(f*k),m=0;m<f;m++)for(var n=0;n<k;n++)l[m*k+n]=g[n];else if("number"==typeof g)for(l=new Float32Array(f),m=0;m<f;m++)l[m]=g;
else throw"Wrong storage default value";b[h]=l}return a[e]},f=function(a,b){if(-1<a.indexOf("location"))var c=0,d=b;else-1<a.indexOf("rotation_quaternion")?(c=4,d=0==b?3:b-1):(c=-1<a.indexOf("scale")?3:0,d=0);return c+d},g=a.fcurves,h={},k={},l=0,m;for(m in g){var n=g[m],q;for(q in n){var r=n[q]._pierced_points;l||(l=r.length);for(var t=e(h,k,m,l),u=t.length/l,s=f(m,q|0),p=0;p<l;p++)t[p*u+s]=r[p]}}var e=function(a,b){for(var c=0;c<b;c++){var d=a.subarray(8*c+4,8*c+8);W.normalize(d,d)}},x;for(x in h)"tsr"==
x&&e(h[x],l);for(var w in k)e(k[w],l);b.params=h;b.bones=k;b.bflags=a._bflags;b.num_pierced=l;la.push(a)};a.get_approx_curve_length=function(a,b){return(b-a)*L.frame_steps+1};a.approximate_curve=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var u=0,s=0,p=null;e<=f;e++)if(e<q)for(var x=0;x<L.frame_steps;x++)c[u++]=r;else if(e>t)for(x=0;x<L.frame_steps;x++)c[u++]=
a;else{var w=b[s],C=3;0===w&&(C+=2);0===p&&(C+=2);var D=2===w?0:1;if(b[s+1]==b[s+C+1])p=w,s+=C;else{x=0;e==b[s+1]&&(D&&(d[u]=1),c[u]=b[s+2],u++,x++);if(e==t)for(;x<L.frame_steps;x++)c[u++]=a;else for(k[0]=b[s+1],k[1]=b[s+2],0!==w?(l[0]=0,l[1]=0):0===p?(l[0]=b[s+5],l[1]=b[s+6]):(l[0]=b[s+3],l[1]=b[s+4]),0!==w?(m[0]=0,m[1]=0):(m[0]=b[s+C+3],m[1]=b[s+C+4]),n[0]=b[s+C+1],n[1]=b[s+C+2];x<L.frame_steps;x++){var B=e+x/L.frame_steps;switch(w){case 0:g=k;h=l;var A=m,y=n,z=[],H=[],J=void 0,G=void 0,I=void 0,
J=void 0;z[0]=g[0]-h[0];z[1]=g[1]-h[1];H[0]=y[0]-A[0];H[1]=y[1]-A[1];I=y[0]-g[0];J=Math.abs(z[0]);G=Math.abs(H[0]);0!=J+G&&J+G>I&&(J=I/(J+G),h[0]=g[0]-J*z[0],h[1]=g[1]-J*z[1],A[0]=y[0]-J*H[0],A[1]=y[1]-J*H[1]);D&&(d[u]=1);g=u;h=k;A=l;y=m;z=n;B=v(0,1,B,h[0],A[0],y[0],z[0]);B=K(B,h[1],A[1],y[1],z[1]);c[g]=B;u++;break;case 1:h=k[0];A=k[1];g=y=(n[1]-A)/(n[0]-h);h=A-y*h;D&&(d[u]=1);c[u]=g*B+h;u++;break;case 2:D&&(d[u]=1);c[u]=b[s+2];u++;break;default:throw"Unknown keyframe intepolation mode: "+w;}}e+1==
b[s+C+1]&&(p=w,s+=C)}}};a.first_animated=function(a){for(var b=0;b<a.length;b++)if(a[b]._anim)return a[b];return!1};a.apply=D;a.get_slot_num_by_anim=function(a,c){for(var d=a._anim_slots,e=0;e<d.length;e++){var f=d[e];if(f&&b(f.animation_name)==b(c))return e}return-1};a.get_anim_by_slot_num=function(a,c){var d=a._anim_slots[c];return d&&d.animation_name?b(d.animation_name):null};a.remove=function(a){a._anim_slots=null;a=pa.indexOf(a);-1!=a&&pa.splice(a,1)};a.remove_actions=function(a){for(var b=la.length-
1;0<=b;b--)la[b]._data_id==a&&la.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a._anim_slots)return D(a,b,0)?0:-1;for(var c=0;c<a._anim_slots.length;c++)if(!a._anim_slots[c])return D(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a._render.anim_mix_factor_change_speed=(b-a._render.anim_mix_factor)/c;a._render.anim_destination_mix_factor=b};a.set_speed=function(a,b,c){r(a._anim_slots,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a._anim_slots[b].speed};a.get_anim_start_frame=
function(a,b){return a._anim_slots[b].start};a.get_anim_length=function(a,b){return a._anim_slots[b].length};a.has_animated_nodemats=U;a.cleanup=function(){pa.length=0;la.length=0};a.fcurves_replace_euler_by_quat=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2])._pierced_points.length,e=C,f=fa,g=Boolean(c[0]);g||(c[0]={_pierced_points:new Float32Array(d)});var h=Boolean(c[1]);h||(c[1]={_pierced_points:new Float32Array(d)});var k=Boolean(c[2]);k||(c[2]={_pierced_points:new Float32Array(d)});c[3]={_pierced_points:new Float32Array(d)};
for(var l=0;l<d;l++)f[0]=g?c[0]._pierced_points[l]:0,f[1]=h?c[1]._pierced_points[l]:0,f[2]=k?c[2]._pierced_points[l]:0,ia.euler_to_quat(f,e),c[0]._pierced_points[l]=e[3],c[1]._pierced_points[l]=e[0],c[2]._pierced_points[l]=e[1],c[3]._pierced_points[l]=e[2];d=b.replace("euler","quaternion");a[d]=c;delete a[b]}};b4w.module.__transform=function(a,p){function h(a){var n=a._render;b.update_constraint(a,g);f.update_camera(a);"CAMERA"==a.type&&f.clamp_limits(a);var q=n.trans,t=n.scale,s=n.quat;r.set_sep(q,t,s,n.tsr);var p=n.world_matrix;B.identity(p);B.fromQuat(s,p);"CAMERA"!=a.type&&x.scale_mat4(p,t,p);p[12]=q[0];p[13]=q[1];p[14]=q[2];B.invert(p,n.inv_world_matrix);a._anim_slots&&e.has_anim_particles(a)&&e.update_emitter_transform(a);n.bb_local&&n.bb_world&&(c.bounding_box_transform(n.bb_local,p,n.bb_world),
c.bounding_sphere_transform(n.bs_local,p,n.bs_world),c.bounding_ellipsoid_transform(n.be_local,n.tsr,n.be_world),n.shadow_cast&&k.schedule_shadow_update(k.get_active()));switch(a.type){case "SPEAKER":d.speaker_update_transform(a,g);break;case "CAMERA":f.update_camera_transform(a);k.check_active()&&d.listener_update_transform(k.get_active(),q,s,g);break;case "LAMP":l.update_light_transform(a);k.check_active()&&k.update_lamp_scene(a,k.get_active());break;case "EMPTY":a.field&&k.update_force(a)}"LAMP"!=
a.type&&"CAMERA"!=a.type||!k.check_active()||(n=k.get_active(),k.schedule_shadow_update(n),k.schedule_grass_map_update(n));a=a._descends;for(n=0;n<a.length;n++)h(a[n])}var c=p("__boundings"),f=p("__camera"),b=p("__constraints"),l=p("__lights"),e=p("__particles"),k=p("__scenes"),d=p("__sfx"),r=p("__tsr"),x=p("__util"),n=p("vec3"),t=p("quat"),w=p("mat3"),B=p("mat4"),q=new Float32Array(3),s=new Float32Array(4),y=new Float32Array(9),g=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){g=a};a.set_translation=
function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=b.get_child_of_offset(a);r.set_trans(c,d)}else a._render.trans.set(c)};a.get_translation=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=b.get_child_of_offset(a);n.copy(r.get_trans_view(d),c)}else n.copy(a._render.trans,c)};a.set_rotation=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=b.get_child_of_offset(a);r.set_quat(c,d)}else a._render.quat.set(c)};a.get_rotation=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=
b.get_child_of_offset(a);t.copy(r.get_quat_view(d),c)}else t.copy(a._render.quat,c)};a.set_rotation_euler=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=x.euler_to_quat(c,s),e=b.get_child_of_offset(a);r.set_quat(d,e)}else x.euler_to_quat(c,a._render.quat)};a.set_scale=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=b.get_child_of_offset(a);r.set_scale(c,d)}else a._render.scale=c};a.get_scale=function(a){return b.get_type(a)==b.CONS_TYPE_CHILD_OF?(a=b.get_child_of_offset(a),
r.get_scale(a)):a._render.scale};a.get_tsr=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=b.get_child_of_offset(a);r.copy(d,c)}else d=a._render,r.set_sep(d.trans,d.scale,d.quat,c)};a.set_tsr=function(a,c){if(b.get_type(a)==b.CONS_TYPE_CHILD_OF){var d=b.get_child_of_offset(a);r.copy(c,d)}else d=a._render,d.trans[0]=c[0],d.trans[1]=c[1],d.trans[2]=c[2],d.scale=c[3],d.quat[0]=c[4],d.quat[1]=c[5],d.quat[2]=c[6],d.quat[3]=c[7]};a.get_object_size=function(a){var b=a._render,c=a.data.b4w_bounding_box;
a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a._render,n.copy(b.bs_world.center,c)):(b=a._render,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,n.transformMat4(c,b.world_matrix,c));return c};a.move_local=function(a,b,c,d){a=a._render;q[0]=b;q[1]=c;q[2]=d;b=w.fromMat4(a.world_matrix,y);n.transformMat3(q,
b,q);n.add(a.trans,q,a.trans)};a.update_transform=h;a.distance=function(a,b){return n.dist(a._render.trans,b._render.trans)};a.obj_point_distance=function(a,b){return n.dist(a._render.trans,b)};a.get_object_bounding_box=function(a){return{max_x:a._render.bb_world.max_x,min_x:a._render.bb_world.min_x,max_y:a._render.bb_world.max_y,min_y:a._render.bb_world.min_y,max_z:a._render.bb_world.max_z,min_z:a._render.bb_world.min_z}}};b4w.module.__tsr=function(a,p){function h(a,b,c,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=b;e[4]=c[0];e[5]=c[1];e[6]=c[2];e[7]=c[3]}function c(a,b,c){var e=b[0],f=b[1],h=b[2],k=b[3],l=b[4],s=b[5],p=b[6];b=b[7];var g=a[0]*k,A=a[1]*k,u=a[2]*k;a=b*g+s*u-p*A;var k=b*A+p*g-l*u,S=b*u+l*A-s*g,g=-l*g-s*A-p*u;c[0]=a*b+g*-l+k*-p-S*-s;c[1]=k*b+g*-s+S*-l-a*-p;c[2]=S*b+g*-p+a*-s-k*-l;c[0]+=e;c[1]+=f;c[2]+=h;return c}var f=p("__util"),b=p("vec3"),l=p("quat");p("mat4");var e=new Float32Array(3),k=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,c,e){e||(e=new Float32Array(8));h(a,b,c,e);return e};a.set_sep=h;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.set_quat=function(a,b){b[4]=a[0];b[5]=
a[1];b[6]=a[2];b[7]=a[3]};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var e=a[0],f=a[1],h=a[2];k[0]=a[4];k[1]=a[5];k[2]=a[6];k[3]=a[7];l.invert(k,k);var p=k[0],q=k[1],s=k[2],y=k[3],e=e*c,f=f*c,g=h*c,h=y*e+q*g-s*f,A=y*f+s*e-p*g,u=y*g+p*f-q*e,e=-p*e-q*f-s*g;b[0]=-(h*y+e*-p+A*-s-u*-q);b[1]=-(A*y+e*-q+u*-p-h*-s);b[2]=-(u*y+e*-s+h*-q-A*-p);b[3]=c;b[4]=p;
b[5]=q;b[6]=s;b[7]=y;return b};a.from_mat4=function(a,b){var c=f.matrix_to_trans(a,e),l=f.matrix_to_scale(a),t=f.matrix_to_quat(a,k);h(c,l,t,b);return b};a.multiply=function(a,b,e){c(b,a,e);e[3]=a[3]*b[3];var f=a[4],h=a[5],k=a[6];a=a[7];var l=b[4],q=b[5],p=b[6];b=b[7];e[4]=f*b+a*l+h*p-k*q;e[5]=h*b+a*q+k*l-f*p;e[6]=k*b+a*p+f*q-h*l;e[7]=a*b-f*l-h*q-k*p;return e};a.transform_vec3=c;a.transform_vectors=function(a,b,c,e){e||(e=0);var f=a.length,h=b[0],k=b[1],l=b[2],p=b[3],y=b[4],g=b[5],A=b[6];b=b[7];for(var u=
0;u<f;u+=3){var S=a[u]*p,I=a[u+1]*p,v=a[u+2]*p,K=b*S+g*v-A*I,m=b*I+A*S-y*v,H=b*v+y*I-g*S,S=-y*S-g*I-A*v;c[e+u]=K*b+S*-y+m*-A-H*-g;c[e+u+1]=m*b+S*-g+H*-y-K*-A;c[e+u+2]=H*b+S*-A+K*-g-m*-y;c[e+u]+=h;c[e+u+1]+=k;c[e+u+2]+=l}return c};a.transform_dir_vectors=function(a,b,c,e){e||(e=0);var f=a.length,h=b[3],k=b[4],l=b[5],p=b[6];b=b[7];for(var y=0;y<f;y+=3){var g=a[y]*h,A=a[y+1]*h,u=a[y+2]*h,S=b*g+l*u-p*A,I=b*A+p*g-k*u,v=b*u+k*A-l*g,g=-k*g-l*A-p*u;c[e+y]=S*b+g*-k+I*-p-v*-l;c[e+y+1]=I*b+g*-l+v*-k-S*-p;c[e+
y+2]=v*b+g*-p+S*-l-I*-k}return c};a.transform_dir_vec3=function(a,b,c){var e=b[3],f=b[4],h=b[5],k=b[6];b=b[7];var l=a[0]*e,p=a[1]*e,y=a[2]*e;a=b*l+h*y-k*p;var e=b*p+k*l-f*y,g=b*y+f*p-h*l,l=-f*l-h*p-k*y;c[0]=a*b+l*-f+e*-k-g*-h;c[1]=e*b+l*-h+g*-f-a*-k;c[2]=g*b+l*-k+a*-h-e*-f;return c};a.transform_tangents=function(a,b,c,e){e||(e=0);var f=a.length,h=b[3],k=b[4],l=b[5],p=b[6];b=b[7];for(var y=0;y<f;y+=4){var g=a[y]*h,A=a[y+1]*h,u=a[y+2]*h,S=b*g+l*u-p*A,I=b*A+p*g-k*u,v=b*u+k*A-l*g,g=-k*g-l*A-p*u;c[e+y]=
S*b+g*-k+I*-p-v*-l;c[e+y+1]=I*b+g*-l+v*-k-S*-p;c[e+y+2]=v*b+g*-p+S*-l-I*-k;c[e+y+3]=a[y+3]}return c};a.translate=function(a,b,c){var e=a[3],f=a[4],h=a[5],k=a[6],l=a[7],p=b[0]*e,y=b[1]*e,g=b[2]*e;b=l*p+h*g-k*y;var e=l*y+k*p-f*g,A=l*g+f*y-h*p,p=-f*p-h*y-k*g;c[0]=a[0]+b*l+p*-f+e*-k-A*-h;c[1]=a[1]+e*l+p*-h+A*-f-b*-k;c[2]=a[2]+A*l+p*-k+b*-h-e*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,c,e,f){f||(f=new Float32Array(8));var h=a.subarray(0,3),k=c.subarray(0,3),
p=f.subarray(0,3);b.lerp(h,k,e,p);h=a[3];f[3]=h+e*(c[3]-h);a=a.subarray(4);c=c.subarray(4);h=f.subarray(4);l.slerp(a,c,e,h);return f};a.extrapolate=function(a,b,c,e){e||(e=new Float32Array(8));var f=a.subarray(0,3),h=b.subarray(0,3),k=e.subarray(0,3);k[0]=h[0]*(c+1)-f[0]*c;k[1]=h[1]*(c+1)-f[1]*c;k[2]=h[2]*(c+1)-f[2]*c;e[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);f=e.subarray(4);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;l.normalize(f,f);return e};
a.integrate=function(a,b,c,e,f){var h=a.subarray(0,3),k=f.subarray(0,3);k[0]=h[0]+b*c[0];k[1]=h[1]+b*c[1];k[2]=h[2]+b*c[2];f[3]=a[3];a=a.subarray(4);f=f.subarray(4);c=e[0];h=e[1];e=e[2];var k=a[0],q=a[1],p=a[2],y=a[3];f[0]=.5*(c*y+h*p-e*q);f[1]=.5*(h*y+e*k-c*p);f[2]=.5*(e*y+c*q-h*k);f[3]=.5*(-c*k-h*q-e*p);f[0]=a[0]+f[0]*b;f[1]=a[1]+f[1]*b;f[2]=a[2]+f[2]*b;f[3]=a[3]+f[3]*b;l.normalize(f,f)}};b4w.module.__util=function(a,p){function h(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function c(a,b){var d=a instanceof Array?[]:{},e;for(e in a)!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?d[e]=a[e]:d[e]=c(a[e],b);return d}function f(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return e(a,
c);case "string":return k(a,c);case "boolean":return e(a|0,c);case "function":case "undefined":return e(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=e(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var f in a)c=l(a[f],c)}else c=e(0,c)}return c}function e(a,b){var c=b;P[0]=a;c=(c<<5)-c+Z[0];c&=c;c=(c<<5)-c+Z[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)var e=a.charCodeAt(d),c=
(c<<5)-c+e,c=c&c;return c}function d(a){return(34*a+1)*a%289}function r(a){return a-Math.floor(a)}function x(a){return n((34*a+5)*a)}function n(a){return a-289*Math.floor(a/289)}function t(a){return a-7*Math.floor(a/7)}function w(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!B(a[c],
b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!B(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return w(a,b);default:return!0}}var q=p("__print"),s=p("vec3"),y=p("vec4"),g=p("quat"),A=p("mat3"),u=p("mat4"),S=0,I={},v=new Float32Array(3),K=new Float32Array(3),
m=new Float32Array(4),H=new Float32Array(4),D=new Float32Array(9),U=new Float32Array(16),P=new Float64Array(1),Z=new Uint32Array(P.buffer),V=new Float32Array([0,0,0]),M=new Float32Array([0,0,0,1]),Q=new Float32Array([0,0,0,1,0,0,0,1]),T=new Float32Array([1,0,0]),X=new Float32Array([0,1,0]),z=new Float32Array([0,0,1]),ia=new Float32Array([-1,0,0]),W=new Float32Array([0,-1,0]),L=new Float32Array([0,0,-1]),G=Math.floor(44488.07041494893);a.VEC3_IDENT=V;a.QUAT4_IDENT=M;a.TSR8_IDENT=Q;a.AXIS_X=T;a.AXIS_Y=
X;a.AXIS_Z=z;a.AXIS_MX=ia;a.AXIS_MY=W;a.AXIS_MZ=L;a.keyfind=h;a.float32_concat=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.uint32_concat=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.check_endians=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.array_intersect=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=
a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.keycheck=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.key2search=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.get_index_for_key_value=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.append_unique=function(a,
b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.check_uniqueness=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.objs_by_type=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.objs_by_name=function(a,b){var c=h("name",b,a);1<c.length&&q.error("obj_by_name(): name resolution ambiguity");return c};a.objs_by_name_r=function(a,b){var c=h("name",b,a),d=c.length;1<d&&q.error("obj_by_name(): name resolution ambiguity");
if(0>=d)return[];for(var e=[],f=0;f<d;f++){var g=c[f];if("EMPTY"==g.type&&g.dupli_group)for(var g=g.dupli_group.objects,k=0;k<g.length;k++)e.push(g[k])}return c=c.concat(e)};a.trans_matrix=function(a,b,c,d){d||(d=new Float32Array(16));u.identity(d);d[12]=a;d[13]=b;d[14]=c;return d};var fa=1;a.rand=function(){fa=(69069*fa+5)%Math.pow(2,32);return Math.round(fa/65536)%32768/32767};a.srand=function(a){fa=a};a.rand_r=function(a){var b=a[0]%G*48271-3399*Math.floor(a[0]/G);a[0]=0<b?b:b+2147483647;return(a[0]-
1)/2147483646};a.init_rand_r_seed=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=c*c,h=d*d,k=e*e,l=c*d+e*f;.499999<l?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>l?(b[0]=0,b[1]=-2*Math.atan2(c,
f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*g-2*k),b[1]=Math.atan2(2*d*f-2*c*e,1-2*h-2*k),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));s.transformQuat(b,a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=s.normalize(a,v);var d=s.dot(b,a);a=s.cross(b,a,K);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.trans_quat_to_plane=function(a,b,c,d){d||(d=new Float32Array(4));
s.transformQuat(c,b,d);d[3]=-s.dot(a,d);return d};a.dir_ground_proj_angle=function(a){var b=a._render.quat;switch(a.type){case "CAMERA":v[0]=0;v[1]=-1;v[2]=0;s.transformQuat(v,b,v);K[0]=0;K[1]=0;K[2]=-1;break;case "MESH":v[0]=0;v[1]=0;v[2]=1;s.transformQuat(v,b,v);K[0]=0;K[1]=0;K[2]=1;break;case "EMPTY":v[0]=0,v[1]=1,v[2]=0,s.transformQuat(v,b,v),K[0]=0,K[1]=1,K[2]=0}v[1]=0;s.normalize(v,v);a=s.dot(v,K);b=0<-v[0]*K[2]?-1:1;return Math.acos(a)*b};a.blend_arrays=function(a,b,c,d){if(0==c)return a;d=
d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.unique_id=function(){S++;return S.toString(16)};a.unique_name=function(a){I[a]||(I[a]=0);var b=a+I[a];I[a]++;return b};a.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.create_empty_submesh=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,base_length:0,indices:null,va_frames:[],
va_common:b}};a.init_object=function(a,b){return{name:a,type:b,modifiers:[],particle_systems:[],data:null}};a.clone_object_json=function(a){return JSON.parse(JSON.stringify(a))};a.clone_object=function(a,b){var d=[],e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return c(a,d)};a.clone_object_r=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):
b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.clone_object_r(b[d]):b[d];return c};a.clone_object_nr=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.is_dynamic_mesh=function(a){return"MESH"===a.type&&
a._render&&"DYNAMIC"===a._render.type?!0:!1};a.is_empty=function(a){return"EMPTY"===a.type?!0:!1};a.is_armature=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));A.fromMat4(a,D);var c=D[0],d=D[3],e=D[6],f=D[1],h=D[4],k=D[7],l=D[2],m=D[5],n=D[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+h*h+k*k)||1,l=Math.sqrt(l*l+m*m+n*n)||1;D[0]/=c;D[3]/=c;D[6]/=c;D[1]/=f;D[4]/=f;D[7]/=f;D[2]/=l;D[5]/=l;D[8]/=l;g.fromMat3(D,b);return b};a.matrix_to_trans=function(a,
b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.matrix_to_scale=function(a){m[0]=.577350269189626;m[1]=.577350269189626;m[2]=.577350269189626;m[3]=0;y.transformMat4(m,a,m);return y.length(m)};a.extract_frustum_planes=function(a,b){var c=b.left,d=b.right,e=b.top,g=b.bottom,h=b.near,k=b.far;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];
g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];f(c);f(d);f(e);f(g);f(h);f(k);return b};a.sphere_is_out_of_frustum=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||d<-b(a,c.near)||d<-b(a,c.far)?!0:!1};a.ellipsoid_is_out_of_frustum=function(a,c,d,e,f){g=s.dot(d,c.far);h=s.dot(e,c.far);k=s.dot(f,c.far);g=Math.sqrt(g*g+
h*h+k*k);if(g<-b(a,c.near)||g<-b(a,c.far))return!0;var g=s.dot(d,c.left),h=s.dot(e,c.left),k=s.dot(f,c.left);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.left))return!0;g=s.dot(d,c.right);h=s.dot(e,c.right);k=s.dot(f,c.right);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.right))return!0;g=s.dot(d,c.top);h=s.dot(e,c.top);k=s.dot(f,c.top);if(Math.sqrt(g*g+h*h+k*k)<-b(a,c.top))return!0;g=s.dot(d,c.bottom);h=s.dot(e,c.bottom);k=s.dot(f,c.bottom);return Math.sqrt(g*g+h*h+k*k)<-b(a,c.bottom)?!0:!1};a.positions_multiply_matrix=
function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}return c};a.vectors_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}return c};a.tangents_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=
4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}return c};a.vecdir_multiply_matrix=function(a,b,c){c||(c=new Float32Array(3));m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=0;y.transformMat4(m,b,m);c[0]=m[0];c[1]=m[1];c[2]=m[2]};a.flatten=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=
0;f<d;f++)b[e*d+f]=a[e][f];return b};a.vectorize=function(a,b){b||(b=[]);for(var c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.binary_search_max=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.binary_search_max(b,c,d,f-1):b[f]<c?a.binary_search_max(b,c,f+1,e):f};a.cmp_arr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.cmp_arr_float=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;
return!0};a.scale_mat4=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.transform_mat4=function(a,b,c,d,e){e||(e=new Float32Array(16));b=u.fromRotationTranslation(c,d,U);u.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));b=u.fromRotationTranslation(c,d,U);s.transformMat4(a,b,e);return e};a.transform_vec4=function(a,b,c,d,e){e||(e=new Float32Array(4));b=u.fromRotationTranslation(c,
d,U);y.transformMat4(a,b,e);return e};a.inverse_transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));b=u.fromRotationTranslation(c,d,U);u.invert(b,b);s.transformMat4(a,b,e);return e};a.transcale_quat_to_matrix=function(a,b,c){c||(c=new Float32Array(16));u.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.matrix_to_transcale_quat=function(b,c,d){a.matrix_to_trans(b,c);c[3]=a.matrix_to_scale(b);a.matrix_to_quat(b,d)};a.array_stringify=function(a){for(var b=[],c=0;c<
a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.rotate_point_pivot=function(a,b,c,d){d||(d=new Float32Array(3));s.subtract(b,a,v);s.transformQuat(v,c,v);s.subtract(b,v,d)};a.generate_cubemap_matrices=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);u.lookAt(a,[-1,0,0],[0,-1,0],b);u.scale(b,[-1,1,1],b);u.scale(b,[-1,1,-1],c);u.lookAt(a,[0,0,-1],[0,-1,0],d);u.scale(d,
[-1,1,1],d);u.scale(d,[-1,1,-1],e);u.lookAt(a,[0,-1,0],[0,0,-1],g);u.scale(g,[1,1,-1],g);u.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.calc_variable_id=function(a,b){return l(a,b)};a.hash_code=l;a.hash_code_string=k;a.mat4_translate=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,n,q,r,t,u,p;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];
n=a[6];q=a[7];r=a[8];t=a[9];u=a[10];p=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=q;c[8]=r;c[9]=t;c[10]=u;c[11]=p;c[12]=f*d+l*e+r*b+a[12];c[13]=g*d+m*e+t*b+a[13];c[14]=h*d+n*e+u*b+a[14];c[15]=k*d+q*e+p*b+a[15];return c};a.mat3_to_mat4=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<
c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.rad=function(a){return a*Math.PI/180};a.deg=function(a){return 180*a/Math.PI};a.snoise=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),e=Math.floor(a[1]+b),f=.211324865405187*c+.211324865405187*e,b=a[0]-c+f;a=a[1]-e+f;var g=b>a?1:0,h=1-g,f=b+.211324865405187-g,k=a+.211324865405187-
h,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,e=e%289,n=d(d(e)+c),h=d(d(e+h)+c+g),q=d(d(e+1)+c+1),c=Math.max(.5-(b*b+a*a),0),e=Math.max(.5-(f*f+k*k),0),g=Math.max(.5-(l*l+m*m),0),c=c*c*c*c,e=e*e*e*e,g=g*g*g*g,t=2*r(.024390243902439*n)-1,u=2*r(.024390243902439*h)-1,p=2*r(.024390243902439*q)-1,n=Math.abs(t)-.5,h=Math.abs(u)-.5,q=Math.abs(p)-.5,t=t-Math.floor(t+.5),u=u-Math.floor(u+.5),p=p-Math.floor(p+.5);return 130*(c*(1.79284291400159-.85373472095314*(t*t+n*n))*(t*b+n*a)+e*(1.79284291400159-
.85373472095314*(u*u+h*h))*(u*f+h*k)+g*(1.79284291400159-.85373472095314*(p*p+q*q))*(p*l+q*m))};a.cellular2x2=function(a){var b=1/7,c=b/2,d=n(Math.floor(a[0])),e=n(Math.floor(a[1])),f=r(a[0]);a=r(a[1]);var g=f-.5,h=f-1.5,f=a-.5;a-=1.5;var k=x(d),d=x(d+1),l=k,m=d,k=x(k+e),d=x(d+e),l=x(l+e+1),m=x(m+e+1),q=t(k)*b+c,u=t(d)*b+c,p=t(l)*b+c,e=t(m)*b+c,k=t(Math.floor(k*b))*b+c,d=t(Math.floor(d*b))*b+c,l=t(Math.floor(l*b))*b+c,b=t(Math.floor(m*b))*b+c,c=g+.7*q,u=h+.7*u,g=g+.7*p,h=h+.7*e,e=f+.7*k,f=f+.7*d,
k=a+.7*l;a+=.7*b;return Math.min(c*c+e*e,u*u+f*f,g*g+k*k,h*h+a*a)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=s.transformQuat(b,a,v);b=c[0];var f=c[1];c=c[2];D[0]=f*f+c*c;D[1]=-f*b;D[2]=-c*b;D[3]=-b*f;D[4]=b*b+c*c;D[5]=-c*f;D[6]=-b*c;D[7]=-f*c;D[8]=b*b+f*f;s.transformMat3(a,D,a);s.normalize(a,a);g.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=m,d=H,c=g.setAxisAngle([0,1,0],Math.PI,g.create()),d=g.setAxisAngle([1,0,0],Math.PI/
2,g.create());g.multiply(c,d,c);g.multiply(a,c,b);return b};a.cleanup=function(){S=0;I={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.smooth_q=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);g.slerp(a,b,c,e);return e};a.is_arr_buf_view=function(a){return"object"===
typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=A.fromQuat(a,D);K[0]=0;K[1]=1;K[2]=0;v[0]=c[3];v[1]=c[4];v[2]=c[5];var d=s.cross(K,v,v);s.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);K[0]=c[0];K[1]=c[1];K[2]=c[2];s.normalize(K,K);g.rotationTo(K,d,H);g.multiply(H,a,a)};a.get_array_smooth_value=function(a,
b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.rgb_mask_get_channels_count=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.rgb_mask_get_channels_presence=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.rgb_mask_get_channel_presence_index=function(a,
b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.gen_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.get_dict_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=
0;c[2]=a[2]-b[2];s.normalize(c,c)};a.transformQuatFast=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,n=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f;return c};a.panic=function(a){a&&q.error.apply(q,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_0_2pi=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.get_file_extension=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};
a.strict_objs_is_equal=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=w(e,f)}if(!d)return!1}return!0};a.quat_bpy_b4w=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c;return b};a.gen_color_id=function(a){a+=1;132651<a&&q.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){m.set(a);
m[3]=b;H.set(d);H[3]=0;a=y.dot(m,H);if(0==a)return null;H.set(c);H[3]=1;a=-y.dot(m,H)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.copy_array=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.rotation_to_stable=function(a,b,c){var d=s.dot(a,b);-.9999999>d?(s.cross(T,a,v),1E-6>s.length(v)&&s.cross(X,a,v),s.normalize(v,v),g.setAxisAngle(v,Math.PI,c)):(s.cross(a,b,v),c.set(v),c[3]=1+d,g.normalize(c,c));return c}};b4w.module.__nla=function(a,p){function h(){return{type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_slot:0,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,stop_video:!1}}function c(a,b){for(var c=a.b4w_nla_script,d=b.script,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",frame_start:f.frame_range[0],frame_end:f.frame_range[1],in_play:!1});break;case "SELECT":case "SELECT_PLAY":var g=B.get_object(B.GET_OBJECT_BY_NAME,
f.object,0),h=B.get_selectable_objects(a),k=h.indexOf(g);if(-1==k)return w.error("NLA script error: non-selectable object"),[];for(var f={type:f.type,slot_idx_hit:"SELECT"==f.type?f.target_slot:e+1,slot_idx_miss:e+1,sel_state:-1,sel_objs_len:h.length,sel_obj_idx:k,frame_start:f.frame_range[0],frame_end:f.frame_range[1],in_play:!1},k=[],l=0;l<h.length;l++)k.push(n.create_selection_sensor(h[l],!0));n.create_sensor_manifold(g,"NLA_SELECT_"+e,n.CT_SHOT,k,n.default_OR_logic_fun,function(a,c,d,e){if(!(b.curr_script_slot>=
b.script.length)&&(d=b.script[b.curr_script_slot],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.in_play)){for(d=0;d<e.sel_objs_len;d++)if(n.get_sensor_value(a,c,d)&&d==e.sel_obj_idx){e.sel_state=1;return}e.sel_state=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",slot_idx:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",slot_idx:f.target_slot,cond:f.condition,reg1:f.register1,reg2:f.register2,num1:f.number1,num2:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",reg:f.registerd,
num:f.number1});break;case "MATH":d.push({type:"MATH",op:f.operation,reg1:f.register1,reg2:f.register2,num1:f.number1,num2:f.number2,regd:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function f(a,c,d,e){if(a.script.length){if(a.curr_script_slot>=a.script.length)if(a.cyclic)a.curr_script_slot=0;else{a.frame_offset-=y.framerate*d;return}var g=l(a,c,e,!1),h=a.script[a.curr_script_slot];switch(h.type){case "PLAY":h.in_play?g>=h.frame_end&&(h.in_play=!1,a.curr_script_slot++,f(a,c,d,e)):(a.frame_offset+=
h.frame_start-g,h.in_play=!0,b(a,h));break;case "SELECT":case "SELECT_PLAY":-1<h.sel_state?"SELECT"==h.type||"SELECT_PLAY"==h.type&&0==h.sel_state?(a.curr_script_slot=h.sel_state?h.slot_idx_hit:h.slot_idx_miss,h.sel_state=-1,f(a,c,d,e)):h.in_play?g>=h.frame_end&&(h.in_play=!1,a.curr_script_slot=h.slot_idx_hit,h.sel_state=-1,f(a,c,d,e)):(a.frame_offset+=h.frame_start-g,h.in_play=!0,b(a,h)):a.frame_offset-=y.framerate*d;break;case "JUMP":a.curr_script_slot=h.slot_idx;f(a,c,d,e);break;case "CONDJUMP":var g=
-1==h.reg1?h.num1:a.registers[h.reg1],k=-1==h.reg2?h.num2:a.registers[h.reg2],n=!1;switch(h.cond){case "EQUAL":g==k&&(n=!0);break;case "NOTEQUAL":g!=k&&(n=!0);break;case "LESS":g<k&&(n=!0);break;case "GREATER":g>k&&(n=!0);break;case "LEQUAL":g<=k&&(n=!0);break;case "GEQUAL":g>=k&&(n=!0)}n?a.curr_script_slot=h.slot_idx:a.curr_script_slot++;f(a,c,d,e);break;case "REGSTORE":a.registers[h.reg]=h.num;a.curr_script_slot++;f(a,c,d,e);break;case "MATH":g=-1==h.reg1?h.num1:a.registers[h.reg1];k=-1==h.reg2?
h.num2:a.registers[h.reg2];switch(h.op){case "ADD":a.registers[h.regd]=g+k;break;case "MUL":a.registers[h.regd]=g*k;break;case "SUB":a.registers[h.regd]=g-k;break;case "DIV":0==k&&s.panic("Division by zero in NLA script"),a.registers[h.regd]=g/k}a.curr_script_slot++;f(a,c,d,e);break;case "NOOP":a.curr_script_slot++,f(a,c,d,e)}}}function b(a,b){for(var c=a.script,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.sel_state=-1)}}function l(a,b,c,d){b=(b-c)*y.framerate+a.frame_offset-a.frame_start;a.cyclic&&d&&
(b%=a.frame_end-a.frame_start+1);return b+=a.frame_start}function e(a,b){b?a.video_file.pause():(a.video_file.currentTime=a.frame_offset/y.framerate,a.video_file.play())}function k(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d].strips;if(e)for(var f=0;f<e.length;f++){var g=e[f],k=h();k.type=g.type;k.frame_start=g.frame_start;k.frame_end=g.frame_end;k.anim_name=g.action?g.action.name:"";k.anim_slot=b;k.action_frame_start=g.action_frame_start;k.action_frame_end=g.action_frame_end;c.push(k)}}return c}
function d(a){return q.is_speaker(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var r=p("__animation"),x=p("__camera"),n=p("__controls"),t=p("__config");p("__loader");p("__particles");var w=p("__print"),B=p("__scenes"),q=p("__sfx"),s=p("__util"),y=t.animation,g=[],A=-1;a.update_scene_nla=function(a,b){var e={frame_start:a.frame_start,frame_end:a.frame_end,frame_offset:0,last_frame:-1,cyclic:b,objects:[],textures:[],script:[],curr_script_slot:0,registers:{R1:0,R2:0,R3:0,
R4:0,R5:0,R6:0,R7:0,R8:0}};c(a,e);for(var f=B.get_scene_objs(a,"ALL",B.DATA_ID_ALL),l=0;l<f.length;l++){var m=f[l],n=0,t=[],p=m.animation_data;if(p&&p.nla_tracks.length&&(p=p.nla_tracks,s.is_armature(m)||x.is_camera(m)||s.is_mesh(m)||s.is_empty(m)||q.is_speaker(m))){var y=k(p,n);y.length&&(t=t.concat(y),n++)}d(m)&&(p=m.data.animation_data.nla_tracks,y=k(p,n),y.length&&(t=t.concat(y),n++));if(r.has_animated_nodemats(m))for(var A=m.data.materials,V=0;V<A.length;V++)if(y=A[V].node_tree,p=y.animation_data,
y&&p){for(var p=p.nla_tracks,y=k(p,-1),M=[],Q=0;Q<y.length;Q++)p=y[Q],-1==M.indexOf(p.anim_name)&&M.push(p.anim_name),p.anim_slot=n+M.indexOf(p.anim_name),t.push(p);n+=M.length}for(V=0;V<m.particle_systems.length;V++)A=m.particle_systems[V],p=A.settings,"EMITTER"==p.type&&p.b4w_allow_nla&&(p=h(),p.type="CLIP",p.frame_start=e.frame_start,p.frame_end=e.frame_end+1,p.anim_name=A.name,p.anim_slot=n,t.push(p),n++);A=n+1;if(s.is_mesh(m)&&m.data)for(V=0;V<m.data.b4w_vertex_anim.length;V++)y=m.data.b4w_vertex_anim[V],
y.allow_nla&&(n=A,p=h(),p.type="CLIP",p.frame_start=e.frame_start,p.frame_end=e.frame_end+1,p.anim_name=y.name,p.anim_slot=n,t.push(p));t.length&&(m._nla_events=t,e.objects.push(m))}f=a._render.video_textures;for(V=0;V<f.length;V++)p=h(),l=f[V]._render,p.type="VIDEO",p.frame_start=Math.min(l.frame_start,e.frame_end),p.frame_end=l.use_cyclic?e.frame_end:Math.min(l.frame_duration+l.frame_start+l.frame_offset,e.frame_end),p.anim_name=f[V].name,l._nla_tex_event=p,e.textures.push(l);V=e.frame_start;f=
e.frame_end;for(l=0;l<e.objects.length;l++)for(m=e.objects[l],n=m._nla_events,t=0;t<n.length;t++)p=n[t],A=m.name+" ["+p.frame_start+":"+p.frame_end+"]",p.frame_start=Math.max(V,p.frame_start),p.frame_end=Math.min(f+1,p.frame_end),p.frame_start>p.frame_end&&(w.warn("NLA: out of scene range: "+A),n.splice(t,1),t--);for(V=0;V<e.objects.length;V++)for(f=e.objects[V]._nla_events,l=0;l<f.length;l++){m=f[l];n=e.frame_start;t=e.frame_end+1;for(p=0;p<f.length;p++)A=f[p],m.anim_slot==A.anim_slot&&(A.frame_end<=
m.frame_start&&(n=m.frame_start),A.frame_start>=m.frame_end&&(t=Math.min(t,A.frame_start)));m.ext_frame_start=n;m.ext_frame_end=t}g.push(e)};a.start=function(){A=0};a.update=function(a,b){if(!(0>A)){0==A&&(A=a);for(var c=0;c<g.length;c++){var d=g[c];f(d,a,b,A);for(var h=l(d,a,A,!0),k=0;k<d.objects.length;k++){for(var n=d.objects[k],t=n._nla_events,p=0;p<t.length;p++){var s=t[p];"SOUND"==s.type&&h<d.last_frame&&(s.scheduled=!1)}for(p=0;p<t.length;p++)switch(s=t[p],s.type){case "CLIP":if(s.ext_frame_start<=
h&&h<s.ext_frame_end&&!s.scheduled){var w=n,x=s;r.apply(w,x.anim_name,x.anim_slot);r.set_behavior(w,r.AB_FINISH_STOP,x.anim_slot);for(w=0;w<t.length;w++)t[w]!=s&&t[w].anim_slot==s.anim_slot&&(t[w].scheduled=!1);s.scheduled=!0}s.scheduled&&(w=n,r.set_current_frame_float(w,h-s.frame_start+s.action_frame_start,s.anim_slot),r.update_object_animation(w,0,s.anim_slot));break;case "SOUND":(h<d.last_frame||d.last_frame<s.frame_start)&&s.frame_start<=h&&h<s.frame_end&&!s.scheduled&&(q.play(n,(s.frame_start-
h)/y.framerate,(s.frame_end-s.frame_start)/y.framerate),s.scheduled=!0),d.last_frame<s.frame_end&&s.frame_end<=h&&s.scheduled&&(s.scheduled=!1)}}for(k=0;k<d.textures.length;k++)s=d.textures[k]._nla_tex_event,s.frame_start<=Math.round(h)&&Math.round(h)<s.frame_end&&!s.stop_video&&(e(d.textures[k],s.stop_video),s.stop_video=!0),s.frame_end<=Math.round(h)&&s.stop_video&&(e(d.textures[k],s.stop_video),s.stop_video=!1);d.last_frame=h}}};a.cleanup=function(){g.length=0;A=-1};a.has_nla=function(a){var b=
a.animation_data;return b&&b.nla_tracks.length||d(a)||r.has_animated_nodemats(a)?!0:!1}};b4w.module.__sfx=function(a,p){function h(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;n.warn("B4W warning: deprecated WebAudio implementation");return null}n.warn("B4W warning: WebAudio is not supported");return null}function c(a,c,d){var f=a._sfx;if("NONE"!=f.behavior){d||(d=0);var g=f.loop,h=f.pitch;if(f.src&&(g||0<=d)){f.base_seed=Math.floor(5E4*Math.random());c=u.currentTime+c;f.start_time=c;f.state=20;var k=a._sfx;if(!k.proc_chain_in){var n=a._render.trans,
p=a._render.quat;if(B.mix_mode){var s=u.createBiquadFilter();s.type="peaking"}else s=null;var w=u.createGain();switch(k.behavior){case "POSITIONAL":var x=u.createPanner();x.panningModel=x.EQUALPOWER;x.distanceModel=x.INVERSE_DISTANCE;x.setPosition(n[0],n[1],n[2]);k.last_position.set(n);var v=q;t.quat_to_dir(p,t.AXIS_MY,v);x.setOrientation(v[0],v[1],v[2]);k.direction.set(v);x.refDistance=k.dist_ref;x.maxDistance=k.dist_max;x.rolloffFactor=k.attenuation;x.coneInnerAngle=k.cone_angle_inner;x.coneOuterAngle=
k.cone_angle_outer;x.coneOuterGain=k.cone_volume_outer;v=u.createGain();v.gain.value=r(k);s?(x.connect(s),s.connect(v)):x.connect(v);v.connect(w);k.proc_chain_in=x;if(k.volume_random){var y=u.createGain();w.connect(y);y.connect(u?S._sfx.proc_chain_in:null)}else y=null,w.connect(u?S._sfx.proc_chain_in:null);break;case "BACKGROUND_SOUND":x=null;v=u.createGain();v.gain.value=r(k);s?(k.proc_chain_in=s,s.connect(v)):k.proc_chain_in=v;v.connect(w);k.volume_random?(y=u.createGain(),w.connect(y),y.connect(u?
S._sfx.proc_chain_in:null)):(y=null,w.connect(u?S._sfx.proc_chain_in:null));break;case "BACKGROUND_MUSIC":y=x=null,v=u.createGain(),v.gain.value=r(k),s?(k.proc_chain_in=s,s.connect(v)):k.proc_chain_in=v,v.connect(w),w.connect(u?S._sfx.proc_chain_in:null)}k.panner_node=x;k.filter_node=s;k.gain_node=v;k.fade_gain_node=w;k.rand_gain_node=y}if("POSITIONAL"==f.behavior||"BACKGROUND_SOUND"==f.behavior)a=u.createBufferSource(),a.buffer=f.src,a.playbackRate.value=h,g?(f.source_node&&f.source_node.disconnect(),
a.loop=!0,a.start(c),f.duration=0):(g=a.buffer?a.buffer.duration:0,d>g?(g=c+d+f.fade_out,a.loop=!0,a.start(c),a.stop(g),f.duration=d):(a.loop=!1,a.start(c),f.duration=g)),a.connect(f.proc_chain_in),f.source_node=a,b(f),l(f);else if("BACKGROUND_MUSIC"==f.behavior){window.clearTimeout(f.bgm_stop_timeout);d=a._sfx;if(g=d.src)g.volume=1,g.loop=d.cyclic,d.source_node=d.source_node||u.createMediaElementSource(g),d.source_node.connect(d.proc_chain_in),20==d.state&&g.play();f.duration=1E6}e(f,c)}}}function f(a){var b=
a._sfx,d=b.duration,b=b.delay+b.delay_random*Math.random();c(a,b,d)}function b(a){a.volume_random&&a.rand_gain_node.gain.cancelScheduledValues(a.start_time);a.pitch_random&&a.source_node.playbackRate.cancelScheduledValues(a.start_time);a.vp_rand_end_time=a.start_time}function l(a){if(a.volume_random||a.pitch_random){var b=a.rand_gain_node,c=a.source_node,d=c.buffer?c.buffer.duration:0;if(d){var e=a.start_time;v[0]=a.base_seed;for(var f=0;5>f;){var g=a.pitch+a.pitch_random*t.rand_r(v);if(e>=a.vp_rand_end_time){if(a.volume_random){var h=
1-t.clamp(a.volume_random,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.pitch_random&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.vp_rand_end_time=e-.001}}}function e(a,b){if(a.fade_in||a.fade_out){var c=a.fade_gain_node;c.gain.cancelScheduledValues(b);a.fade_in?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.fade_in)):c.gain.setValueAtTime(1,b);a.fade_out&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.fade_out))}}function k(a){if("SPEAKER"!=
a.type)throw"Wrong object type";a=a._sfx;if(20==a.state||40==a.state){var b=a.fade_gain_node,c=u.currentTime;a.fade_out&&(b.gain.setValueAtTime(b.gain.value,c),b.gain.linearRampToValueAtTime(0,c+a.fade_out));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.bgm_stop_timeout=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.fade_out))}else b=a.source_node,a.duration<b.buffer.duration?a.fade_out&&20==a.state?b.stop(c+a.fade_out):20==a.state&&(b.stop(0),b.disconnect()):
b.disconnect(),a.start_time=0,a.pause_time=0,a.buf_offset=0;a.state=30}}function d(a){return!a._sfx||20!=a._sfx.state&&40!=a._sfx.state&&30!=a._sfx.state?!1:!0}function r(a){return a.muted?0:a.volume}var x=p("__config"),n=p("__print"),t=p("__util"),w=p("vec3"),B=x.sfx;a.AST_NONE=10;a.AST_ARRAY_BUFFER=20;a.AST_HTML_ELEMENT=30;var q=new Float32Array(3),s=new Float32Array(3),y=new Float32Array(3),g=[],A=[],u=null,S=null,I=[],v=[1],K=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");
a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(g.push("ogg"),g.push("ogv")),""!=a.canPlayType("audio/mpeg")&&g.push("mp3"),""!=a.canPlayType("audio/mp4")&&(g.push("mp4"),g.push("m4v")),""!=a.canPlayType("audio/webm")&&g.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&A.push("ogv"),""!=b.canPlayType("video/mp4")&&A.push("m4v"),""!=b.canPlayType("video/webm")&&A.push("webm"));(u=B.webaudio?h():null)&&n.log("%cINIT WEBAUDIO: "+u.sampleRate+"Hz","color: #00a")};a.attach_scene_sfx=function(a){var b=
{listener_last_eye:new Float32Array(3),listener_direction:new Float32Array(3),listener_speed_avg:new Float32Array(3)};a._sfx=b;if(u){var c=u.createGain(),d=u.createGain();b.gain_node=c;b.fade_gain_node=d;c.connect(d);d.connect(u.destination);if(a.b4w_enable_dynamic_compressor){var d=u.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.compressor_node=
d;b.proc_chain_in=d}else b.compressor_node=null,b.proc_chain_in=c;c=u.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.duck_time=0}};a.set_active_scene=function(a){S=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<g.indexOf(a)?a:"ogg"==a&&-1<g.indexOf("mp4")?"mp4":"mp3"==a&&-1<g.indexOf("ogg")?"ogg":"mp4"==a&&-1<g.indexOf("ogg")?"ogg":"ogv"==a&&-1<g.indexOf("m4v")?"m4v":"webm"==a&&-1<g.indexOf("m4v")?"m4v":"m4v"==a&&-1<g.indexOf("webm")?
"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<A.indexOf(a)?a:"ogv"==a&&-1<A.indexOf("m4v")?"m4v":"webm"==a&&-1<A.indexOf("m4v")?"m4v":"m4v"==a&&-1<A.indexOf("webm")?"webm":""};a.append_object=function(a,b){if("SPEAKER"!=a.type)throw"Wrong speaker object";var c=a.data;a._sfx={};switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a._sfx.behavior=u?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var d=a._sfx,e;u?(window.MediaElementAudioSourceNode?e=!0:(n.warn("B4W warning: MediaElementAudioSourceNode not found"),
e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";}c.sound||(a._sfx.behavior="NONE");a._sfx.disable_doppler=c.b4w_disable_doppler;a._sfx.muted=c.muted;a._sfx.volume=c.volume;a._sfx.pitch=c.pitch;a._sfx.attenuation=c.attenuation;a._sfx.dist_ref=c.distance_reference;a._sfx.dist_max=c.distance_max||1E4;a._sfx.cone_angle_inner=c.cone_angle_inner;a._sfx.cone_angle_outer=c.cone_angle_outer;a._sfx.cone_volume_outer=c.cone_volume_outer;a._sfx.cyclic=
c.b4w_cyclic_play;a._sfx.loop=c.b4w_loop;a._sfx.delay=c.b4w_delay;a._sfx.delay_random=c.b4w_delay_random;a._sfx.volume_random=c.b4w_volume_random;a._sfx.pitch_random=c.b4w_pitch_random;a._sfx.fade_in=c.b4w_fade_in;a._sfx.fade_out=c.b4w_fade_out;a._sfx.start_time=0;a._sfx.pause_time=0;a._sfx.buf_offset=0;a._sfx.duration=0;a._sfx.vp_rand_end_time=0;a._sfx.base_seed=1;a._sfx.src=null;a._sfx.state=10;a._sfx.last_position=new Float32Array(3);a._sfx.direction=new Float32Array(3);a._sfx.speed_avg=new Float32Array(3);
a._sfx.bgm_stop_timeout=null;a._sfx.duck_time=0;I.push(a)};a.source_type=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b._sfx.behavior){case "POSITIONAL":return a.AST_ARRAY_BUFFER;case "BACKGROUND_SOUND":return a.AST_ARRAY_BUFFER;case "BACKGROUND_MUSIC":return a.AST_HTML_ELEMENT;case "NONE":return a.AST_NONE;default:throw"Wrong speaker behavior";}};a.update_spkobj=function(a,b){var c=a._sfx;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.play_empty_sound=function(){var a=u.createBufferSource();a.buffer=u.createBuffer(1,22050,22050);a.connect(u.destination);a.start(0)};a.decode_audio_data=function(a,b,c){u?u.decodeAudioData(a,b,c):c()};a.speaker_remove=function(a){k(a);delete a._sfx;I.splice(I.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<I.length;a++){var b=I[a]._sfx;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.source_node&&b.source_node.disconnect()}S&&
S._sfx&&(a=S._sfx,a.listener_last_eye[0]=0,a.listener_last_eye[1]=0,a.listener_last_eye[2]=0,a.listener_speed_avg[0]=0,a.listener_speed_avg[1]=0,a.listener_speed_avg[2]=0);S=null;I.splice(0);K=null};a.update=function(a,b){if(u&&0!=I.length){for(var c=0;c<I.length;c++){var d=I[c],e=d._sfx,g=u.currentTime;!e.loop&&e.cyclic&&20==e.state&&e.duration&&u&&e.start_time+e.duration<g&&f(d);20==e.state&&3>e.vp_rand_end_time-g&&l(e)}K&&(-1==K.active||a>K.active_start_time+K.durations[K.active])&&(c=K,-1<c.active&&
k(c.speakers[c.active]),-1==c.active&&c.random?d=Math.round(Math.random()*(c.speakers.length-1)):c.random?(d=1+Math.round(Math.random()*(c.speakers.length-2)),d=(c.active+d)%c.speakers.length):d=(c.active+1)%c.speakers.length,f(c.speakers[d]),c.active=d,c.active_start_time=a)}};a.play=c;a.play_def=f;a.stop=k;a.is_play=function(a){return 20==a._sfx.state};a.playrate=function(a,c){var e=a._sfx;e.pitch=c;!d(a)||"POSITIONAL"!=e.behavior&&"BACKGROUND_SOUND"!=e.behavior||(e.source_node.playbackRate.value=
c,b(e),l(e))};a.get_playrate=function(a){return a._sfx.pitch};a.cyclic=function(a,b){a._sfx.cyclic=Boolean(b)};a.is_cyclic=function(a){return a._sfx.cyclic};a.listener_update_transform=function(a,b,c,d){if(u&&a._sfx){var e=q;e[0]=0;e[1]=-1;e[2]=0;w.transformQuat(e,c,e);s[0]=0;s[1]=0;s[2]=-1;w.transformQuat(s,c,s);c=u.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],s[0],s[1],s[2]);a._sfx.listener_direction.set(e);d&&(y[0]=(b[0]-a._sfx.listener_last_eye[0])/d,y[1]=(b[1]-a._sfx.listener_last_eye[1])/
d,y[2]=(b[2]-a._sfx.listener_last_eye[2])/d,t.smooth_v(y,a._sfx.listener_speed_avg,d,.3,y),c.setVelocity(y[0],y[1],y[2]),a._sfx.listener_speed_avg.set(y));a._sfx.listener_last_eye.set(b)}};a.listener_reset_speed=function(a,b){if(u&&S._sfx){var c=q;b?c.set(b):c.set(S._sfx.listener_direction);w.scale(c,a,c);u.listener.setVelocity(c[0],c[1],c[2]);S._sfx.listener_speed_avg.set(c)}};a.speaker_update_transform=function(a,b){var c=a._sfx;if(d(a)&&"POSITIONAL"==c.behavior){var e=a._render.trans,f=c.panner_node;
f.setPosition(e[0],e[1],e[2]);var g=q;t.quat_to_dir(a._render.quat,t.AXIS_MY,g);f.setOrientation(g[0],g[1],g[2]);g=c.last_position;!c.disable_doppler&&b&&(s[0]=(e[0]-g[0])/b,s[1]=(e[1]-g[1])/b,s[2]=(e[2]-g[2])/b,t.smooth_v(s,c.speed_avg,b,.3,s),f.setVelocity(s[0],s[1],s[2]),c.speed_avg.set(s));g.set(e)}};a.speaker_reset_speed=function(a,b,c){var e=a._sfx;if(d(a)&&"POSITIONAL"==e.behavior){var f=q;c?f.set(c):f.set(e.direction);w.scale(f,b,f);e.panner_node.setVelocity(f[0],f[1],f[2]);e.speed_avg.set(f);
e.last_position.set(a._render.trans)}};a.is_speaker=function(a){return a._sfx?!0:!1};a.get_spk_behavior=function(a){return a._sfx.behavior};a.check_active_speakers=function(){for(var a=0;a<I.length;a++)if(d(I[a]))return!0;return!1};a.set_master_volume=function(a){var b=S._sfx;b&&(b.volume=a,u&&(b.gain_node.gain.value=r(b)))};a.get_master_volume=function(){var a=S._sfx;return a?a.volume:0};a.set_volume=function(a,b){var c=a._sfx;c.volume=b;d(a)&&(c.gain_node.gain.value=r(c))};a.get_volume=function(a){return a._sfx.volume};
a.mute=function(a,b){a._sfx.muted=Boolean(b);d(a)&&(a._sfx.gain_node.gain.value=r(a._sfx))};a.is_muted=function(a){return a._sfx.muted};a.mute_master=function(a){var b=S._sfx;b&&(b.muted=Boolean(a),u&&(b.gain_node.gain.value=r(b)))};a.is_master_muted=function(){var a=S._sfx;return a?a.muted:!1};a.get_speaker_objects=function(){return I};a.pause=function(){for(var a=0;a<I.length;a++){var c=I[a]._sfx;if(20==c.state){if("BACKGROUND_MUSIC"==c.behavior){var d=c.src;d&&d.pause()}else{var e=u.currentTime;
c.pause_time=e;if(e>c.start_time){d=c;v[0]=d.base_seed;for(var f=d.source_node.buffer.duration,g=d.start_time,h=void 0;g<e;)h=d.pitch+d.pitch_random*t.rand_r(v),g+=f/h;d=(f/h-(g-e))*h}else d=0;c.buf_offset=d;c.source_node.stop(0);c.source_node.disconnect();b(c)}c.state=40}}};a.resume=function(){for(var a=0;a<I.length;a++){var b=I[a],c=b._sfx;if(40==c.state){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b._sfx,d=u.createBufferSource();d.loop=b.source_node.loop;d.buffer=b.source_node.buffer;
d.playbackRate.value=b.source_node.playbackRate.value;b.panner_node?d.connect(b.panner_node):d.connect(b.gain_node);b.source_node=d;b=u.currentTime;c.start_time+=b-c.pause_time;c.vp_rand_end_time=b;c.source_node.start(c.start_time,c.buf_offset);l(c);e(c,c.start_time)}c.state=20}}};a.set_compressor_params=function(a,b){if(a._sfx&&a._sfx.compressor_node){var c=a._sfx.compressor_node;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};
a.get_compressor_params=function(a){if(!a._sfx||!a._sfx.compressor_node)return null;a=a._sfx.compressor_node;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(d(a)){a=a._sfx;var e=a.fade_gain_node,f=u.currentTime;e.gain.setValueAtTime(e.gain.value,f);e.gain.linearRampToValueAtTime(b,f+c);a.duck_time=c}};a.unduck=function(a){if(d(a)){a=a._sfx;var b=a.fade_gain_node,c=u.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.duck_master=function(a,b){if(u){var c=S._sfx,d=c.fade_gain_node,e=u.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.duck_time=b}};a.unduck_master=function(){if(u){var a=S._sfx,b=a.fade_gain_node,c=u.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.apply_playlist=function(a,b,c){K={active:-1,active_start_time:0,random:c,speakers:[],
durations:[]};for(c=0;c<a.length;c++){var d=a[c];k(d);K.speakers.push(d);d=d._sfx;d=(d=d.src)?d.duration:0;K.durations.push(d+b)}};a.clear_playlist=function(){if(K)for(var a=K.speakers,b=0;b<a.length;b++)k(a[b]);K=null};a.get_positional_params=function(a){return(a=a._sfx)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a._sfx;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=
b.attenuation;var d=c.panner_node;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a._sfx;c&&c.filter_node&&(c.filter_node.frequency.value=b.freq,c.filter_node.Q.value=b.Q,c.filter_node.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a._sfx)&&a.filter_node?{freq:a.filter_node.frequency.value,Q:a.filter_node.Q.value,gain:a.filter_node.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a._sfx;if(!a||
!a.filter_node)return null;a.filter_node.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a,p){var h="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new h(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new h(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,c){var e=new h(3);e[0]=a;e[1]=b;e[2]=c;return e};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,c,e){e[0]=a;e[1]=b;e[2]=c;return e};a.add=function(a,b,c){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];
return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],
b[2]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};a.scaleAndAdd=function(a,b,c,e){e[0]=a[0]+b[0]*c;e[1]=a[1]+b[1]*c;e[2]=a[2]+b[2]*c;return e};a.distance=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],h=b[2]-a[2];return Math.sqrt(c*c+e*e+h*h)};a.dist=a.distance;a.squaredDistance=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],h=b[2]-a[2];return c*c+e*e+h*h};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};a.len=a.length;
a.squaredLength=function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var c=a[0],e=a[1],h=a[2],c=c*c+e*e+h*h;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,c){var e=a[0],h=a[1];a=a[2];var d=b[0],r=b[1];b=b[2];
c[0]=h*b-a*r;c[1]=a*d-e*b;c[2]=e*r-h*d;return c};a.lerp=function(a,b,c,e){var h=a[0],d=a[1];a=a[2];e[0]=h+c*(b[0]-h);e[1]=d+c*(b[1]-d);e[2]=a+c*(b[2]-a);return e};a.random=function(a,b){a=a||1;var h=2*c()*Math.PI,e=2*c()-1,k=Math.sqrt(1-e*e)*a;b[0]=Math.cos(h)*k;b[1]=Math.sin(h)*k;b[2]=e*a;return b};a.transformMat4=function(a,b,c){var e=a[0],h=a[1];a=a[2];var d=b[3]*e+b[7]*h+b[11]*a+b[15],d=d||1;c[0]=(b[0]*e+b[4]*h+b[8]*a+b[12])/d;c[1]=(b[1]*e+b[5]*h+b[9]*a+b[13])/d;c[2]=(b[2]*e+b[6]*h+b[10]*a+b[14])/
d;return c};a.transformMat3=function(a,b,c){var e=a[0],h=a[1];a=a[2];c[0]=e*b[0]+h*b[3]+a*b[6];c[1]=e*b[1]+h*b[4]+a*b[7];c[2]=e*b[2]+h*b[5]+a*b[8];return c};a.transformQuat=function(a,b,c){var e=a[0],h=a[1],d=a[2];a=b[0];var r=b[1],p=b[2];b=b[3];var n=b*e+r*d-p*h,t=b*h+p*e-a*d,w=b*d+a*h-r*e,e=-a*e-r*h-p*d;c[0]=n*b+e*-a+t*-p-w*-r;c[1]=t*b+e*-r+w*-a-n*-p;c[2]=w*b+e*-p+n*-r-t*-a;return c};a.rotateX=function(a,b,c,e){var h=[],d=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];d[0]=h[0];d[1]=h[1]*Math.cos(c)-
h[2]*Math.sin(c);d[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c);e[0]=d[0]+b[0];e[1]=d[1]+b[1];e[2]=d[2]+b[2];return e};a.rotateY=function(a,b,c,e){var h=[],d=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];d[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c);d[1]=h[1];d[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c);e[0]=d[0]+b[0];e[1]=d[1]+b[1];e[2]=d[2]+b[2];return e};a.rotateZ=function(a,b,c,e){var h=[],d=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];d[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c);d[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c);
d[2]=h[2];e[0]=d[0]+b[0];e[1]=d[1]+b[1];e[2]=d[2]+b[2];return e};a.forEach=function(){var c=a.create();return function(a,h,e,k,d,r){h||(h=3);e||(e=0);for(k=k?Math.min(k*h+e,a.length):a.length;e<k;e+=h)c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],d(c,r,c),a[e]=c[0],a[e+1]=c[1],a[e+2]=c[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a,p){var h="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new h(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new h(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,e){var k=new h(4);k[0]=a;k[1]=b;k[2]=c;k[3]=e;return k};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,c,e,h){h[0]=a;h[1]=b;h[2]=c;h[3]=e;return h};a.add=function(a,b,c){c[0]=
a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);c[3]=
Math.min(a[3],b[3]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);c[3]=Math.max(a[3],b[3]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};a.scaleAndAdd=function(a,b,c,e){e[0]=a[0]+b[0]*c;e[1]=a[1]+b[1]*c;e[2]=a[2]+b[2]*c;e[3]=a[3]+b[3]*c;return e};a.distance=function(a,b){var c=b[0]-a[0],e=b[1]-a[1],h=b[2]-a[2],d=b[3]-a[3];return Math.sqrt(c*c+e*e+h*h+d*d)};a.dist=a.distance;a.squaredDistance=
function(a,b){var c=b[0]-a[0],e=b[1]-a[1],h=b[2]-a[2],d=b[3]-a[3];return c*c+e*e+h*h+d*d};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1],e=a[2];a=a[3];return Math.sqrt(b*b+c*c+e*e+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],c=a[1],e=a[2];a=a[3];return b*b+c*c+e*e+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var c=a[0],e=a[1],h=a[2],d=a[3],c=c*c+e*e+h*h+d*d;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,c,e){var h=a[0],d=a[1],r=a[2];a=a[3];e[0]=h+c*(b[0]-h);e[1]=d+c*(b[1]-d);e[2]=r+c*(b[2]-r);e[3]=a+c*(b[3]-a);return e};a.random=function(f,b){f=f||1;b[0]=c();b[1]=c();b[2]=c();b[3]=c();a.normalize(b,b);a.scale(b,f,b);return b};a.transformMat4=function(a,b,c){var e=a[0],
h=a[1],d=a[2];a=a[3];c[0]=b[0]*e+b[4]*h+b[8]*d+b[12]*a;c[1]=b[1]*e+b[5]*h+b[9]*d+b[13]*a;c[2]=b[2]*e+b[6]*h+b[10]*d+b[14]*a;c[3]=b[3]*e+b[7]*h+b[11]*d+b[15]*a;return c};a.transformQuat=function(a,b,c){var e=a[0],h=a[1],d=a[2];a=b[0];var r=b[1],p=b[2];b=b[3];var n=b*e+r*d-p*h,t=b*h+p*e-a*d,w=b*d+a*h-r*e,e=-a*e-r*h-p*d;c[0]=n*b+e*-a+t*-p-w*-r;c[1]=t*b+e*-r+w*-a-n*-p;c[2]=w*b+e*-p+n*-r-t*-a;return c};a.forEach=function(){var c=a.create();return function(a,h,e,k,d,r){h||(h=4);e||(e=0);for(k=k?Math.min(k*
h+e,a.length):a.length;e<k;e+=h)c[0]=a[e],c[1]=a[e+1],c[2]=a[e+2],c[3]=a[e+3],d(c,r,c),a[e]=c[0],a[e+1]=c[1],a[e+2]=c[2],a[e+3]=c[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var h=p("vec3"),c=p("vec4"),f=p("mat3"),b="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new b(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=h.create(),c=h.fromValues(1,0,0),f=h.fromValues(0,1,0);return function(d,r,p){var n=h.dot(d,r);if(-.9999999>n)return h.cross(c,d,b),1E-6>h.length(b)&&h.cross(f,d,b),h.normalize(b,b),a.setAxisAngle(b,Math.PI,p),p;if(.9999999<n)return p[0]=0,p[1]=0,p[2]=0,p[3]=1,p;h.cross(d,
r,b);p[0]=b[0];p[1]=b[1];p[2]=b[2];p[3]=1+n;return a.normalize(p,p)}}();a.setAxes=function(){var b=f.create();return function(c,f,d,h){b[0]=f[0];b[3]=f[1];b[6]=f[2];b[1]=d[0];b[4]=d[1];b[7]=d[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,h),h)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],f=a[1],h=a[2];a=a[3];var n=b[0],t=b[1],p=b[2];b=b[3];c[0]=d*b+a*n+f*p-h*t;c[1]=f*b+a*t+h*n-d*p;c[2]=h*b+a*p+d*t-f*n;c[3]=a*b-d*n-f*t-h*p;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],f=a[1],h=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*n;c[1]=f*b+h*n;c[2]=h*b-f*n;c[3]=a*b-d*n;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],f=a[1],h=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*
b-h*n;c[1]=f*b+a*n;c[2]=h*b+d*n;c[3]=a*b-f*n;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],f=a[1],h=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+f*n;c[1]=f*b-d*n;c[2]=h*b+a*n;c[3]=a*b-h*n;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],f=a[2];b[0]=c;b[1]=d;b[2]=f;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-f*f));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var f=a[0],h=a[1],n=a[2];a=a[3];var t=b[0],p=b[1],B=b[2];b=b[3];var q,s,y;s=f*t+h*p+n*B+a*b;0>s&&(s=-s,t=-t,p=-p,
B=-B,b=-b);1E-6<1-s?(q=Math.acos(s),y=Math.sin(q),s=Math.sin((1-c)*q)/y,c=Math.sin(c*q)/y):s=1-c;d[0]=s*f+c*t;d[1]=s*h+c*p;d[2]=s*n+c*B;d[3]=s*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],f=a[2],h=a[3],n=c*c+d*d+f*f+h*h,n=n?1/n:0;b[0]=-c*n;b[1]=-d*n;b[2]=-f*n;b[3]=h*n;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var f=(d+1)%3,h=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*f+f]-a[3*h+h]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*f+h]-a[3*h+f])*c;b[f]=(a[3*f+d]+a[3*d+f])*c;b[h]=(a[3*h+d]+a[3*d+h])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a,p){var h="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new h(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[4];f[4]=a[5];f[5]=a[6];f[6]=a[8];f[7]=a[9];f[8]=a[10];return f};a.clone=function(a){var f=new h(9);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];return f};a.copy=function(a,f){f[0]=a[0];f[1]=a[1];f[2]=
a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];return f};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,f){if(f===a){var b=a[1],h=a[2],e=a[5];f[1]=a[3];f[2]=a[6];f[3]=b;f[5]=a[7];f[6]=h;f[7]=e}else f[0]=a[0],f[1]=a[3],f[2]=a[6],f[3]=a[1],f[4]=a[4],f[5]=a[7],f[6]=a[2],f[7]=a[5],f[8]=a[8];return f};a.invert=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=a[4],r=a[5],p=a[6],n=a[7],t=a[8],w=t*d-r*n,B=-t*k+r*p,q=
n*k-d*p,s=b*w+h*B+e*q;if(!s)return null;s=1/s;f[0]=w*s;f[1]=(-t*h+e*n)*s;f[2]=(r*h-e*d)*s;f[3]=B*s;f[4]=(t*b-e*p)*s;f[5]=(-r*b+e*k)*s;f[6]=q*s;f[7]=(-n*b+h*p)*s;f[8]=(d*b-h*k)*s;return f};a.adjoint=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=a[4],r=a[5],p=a[6],n=a[7],t=a[8];f[0]=d*t-r*n;f[1]=e*n-h*t;f[2]=h*r-e*d;f[3]=r*p-k*t;f[4]=b*t-e*p;f[5]=e*k-b*r;f[6]=k*n-d*p;f[7]=h*p-b*n;f[8]=b*d-h*k;return f};a.determinant=function(a){var f=a[3],b=a[4],h=a[5],e=a[6],k=a[7],d=a[8];return a[0]*(d*b-h*k)+a[1]*
(-d*f+h*e)+a[2]*(k*f-b*e)};a.multiply=function(a,f,b){var h=a[0],e=a[1],k=a[2],d=a[3],r=a[4],p=a[5],n=a[6],t=a[7];a=a[8];var w=f[0],B=f[1],q=f[2],s=f[3],y=f[4],g=f[5],A=f[6],u=f[7];f=f[8];b[0]=w*h+B*d+q*n;b[1]=w*e+B*r+q*t;b[2]=w*k+B*p+q*a;b[3]=s*h+y*d+g*n;b[4]=s*e+y*r+g*t;b[5]=s*k+y*p+g*a;b[6]=A*h+u*d+f*n;b[7]=A*e+u*r+f*t;b[8]=A*k+u*p+f*a;return b};a.mul=a.multiply;a.translate=function(a,f,b){var h=a[0],e=a[1],k=a[2],d=a[3],r=a[4],p=a[5],n=a[6],t=a[7];a=a[8];var w=f[0];f=f[1];b[0]=h;b[1]=e;b[2]=k;
b[3]=d;b[4]=r;b[5]=p;b[6]=w*h+f*d+n;b[7]=w*e+f*r+t;b[8]=w*k+f*p+a;return b};a.rotate=function(a,f,b){var h=a[0],e=a[1],k=a[2],d=a[3],r=a[4],p=a[5],n=a[6],t=a[7];a=a[8];var w=Math.sin(f);f=Math.cos(f);b[0]=f*h+w*d;b[1]=f*e+w*r;b[2]=f*k+w*p;b[3]=f*d-w*h;b[4]=f*r-w*e;b[5]=f*p-w*k;b[6]=n;b[7]=t;b[8]=a;return b};a.scale=function(a,f,b){var h=f[0];f=f[1];b[0]=h*a[0];b[1]=h*a[1];b[2]=h*a[2];b[3]=f*a[3];b[4]=f*a[4];b[5]=f*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.fromMat2d=function(a,f){f[0]=a[0];f[1]=
a[1];f[2]=0;f[3]=a[2];f[4]=a[3];f[5]=0;f[6]=a[4];f[7]=a[5];f[8]=1;return f};a.fromQuat=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=b+b,r=h+h,p=e+e,b=b*d,n=h*d,h=h*r,t=e*d,w=e*r,e=e*p,d=k*d,r=k*r,k=k*p;f[0]=1-h-e;f[3]=n-k;f[6]=t+r;f[1]=n+k;f[4]=1-b-e;f[7]=w-d;f[2]=t-r;f[5]=w+d;f[8]=1-b-h;return f};a.normalFromMat4=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=a[4],r=a[5],p=a[6],n=a[7],t=a[8],w=a[9],B=a[10],q=a[11],s=a[12],y=a[13],g=a[14],A=a[15],u=b*r-h*d,S=b*p-e*d,I=b*n-k*d,v=h*p-e*r,K=h*n-
k*r,m=e*n-k*p,H=t*y-w*s,D=t*g-B*s,t=t*A-q*s,U=w*g-B*y,w=w*A-q*y,B=B*A-q*g,q=u*B-S*w+I*U+v*t-K*D+m*H;if(!q)return null;q=1/q;f[0]=(r*B-p*w+n*U)*q;f[1]=(p*t-d*B-n*D)*q;f[2]=(d*w-r*t+n*H)*q;f[3]=(e*w-h*B-k*U)*q;f[4]=(b*B-e*t+k*D)*q;f[5]=(h*t-b*w-k*H)*q;f[6]=(y*m-g*K+A*v)*q;f[7]=(g*I-s*m-A*S)*q;f[8]=(s*K-y*I+A*u)*q;return f};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a,p){var h="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new h(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var f=new h(16);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];f[9]=a[9];f[10]=a[10];f[11]=a[11];f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};a.copy=function(a,f){f[0]=a[0];
f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=a[6];f[7]=a[7];f[8]=a[8];f[9]=a[9];f[10]=a[10];f[11]=a[11];f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,f){if(f===a){var b=a[1],h=a[2],e=a[3],k=a[6],d=a[7],r=a[11];f[1]=a[4];f[2]=a[8];f[3]=a[12];f[4]=b;f[6]=a[9];f[7]=a[13];f[8]=h;f[9]=k;f[11]=a[14];f[12]=e;f[13]=
d;f[14]=r}else f[0]=a[0],f[1]=a[4],f[2]=a[8],f[3]=a[12],f[4]=a[1],f[5]=a[5],f[6]=a[9],f[7]=a[13],f[8]=a[2],f[9]=a[6],f[10]=a[10],f[11]=a[14],f[12]=a[3],f[13]=a[7],f[14]=a[11],f[15]=a[15];return f};a.invert=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=a[4],r=a[5],p=a[6],n=a[7],t=a[8],w=a[9],B=a[10],q=a[11],s=a[12],y=a[13],g=a[14],A=a[15],u=b*r-h*d,S=b*p-e*d,I=b*n-k*d,v=h*p-e*r,K=h*n-k*r,m=e*n-k*p,H=t*y-w*s,D=t*g-B*s,U=t*A-q*s,P=w*g-B*y,Z=w*A-q*y,V=B*A-q*g,M=u*V-S*Z+I*P+v*U-K*D+m*H;if(!M)return null;
M=1/M;f[0]=(r*V-p*Z+n*P)*M;f[1]=(e*Z-h*V-k*P)*M;f[2]=(y*m-g*K+A*v)*M;f[3]=(B*K-w*m-q*v)*M;f[4]=(p*U-d*V-n*D)*M;f[5]=(b*V-e*U+k*D)*M;f[6]=(g*I-s*m-A*S)*M;f[7]=(t*m-B*I+q*S)*M;f[8]=(d*Z-r*U+n*H)*M;f[9]=(h*U-b*Z-k*H)*M;f[10]=(s*K-y*I+A*u)*M;f[11]=(w*I-t*K-q*u)*M;f[12]=(r*D-d*P-p*H)*M;f[13]=(b*P-h*D+e*H)*M;f[14]=(y*S-s*v-g*u)*M;f[15]=(t*v-w*S+B*u)*M;return f};a.adjoint=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=a[4],r=a[5],p=a[6],n=a[7],t=a[8],w=a[9],B=a[10],q=a[11],s=a[12],y=a[13],g=a[14],A=a[15];
f[0]=r*(B*A-q*g)-w*(p*A-n*g)+y*(p*q-n*B);f[1]=-(h*(B*A-q*g)-w*(e*A-k*g)+y*(e*q-k*B));f[2]=h*(p*A-n*g)-r*(e*A-k*g)+y*(e*n-k*p);f[3]=-(h*(p*q-n*B)-r*(e*q-k*B)+w*(e*n-k*p));f[4]=-(d*(B*A-q*g)-t*(p*A-n*g)+s*(p*q-n*B));f[5]=b*(B*A-q*g)-t*(e*A-k*g)+s*(e*q-k*B);f[6]=-(b*(p*A-n*g)-d*(e*A-k*g)+s*(e*n-k*p));f[7]=b*(p*q-n*B)-d*(e*q-k*B)+t*(e*n-k*p);f[8]=d*(w*A-q*y)-t*(r*A-n*y)+s*(r*q-n*w);f[9]=-(b*(w*A-q*y)-t*(h*A-k*y)+s*(h*q-k*w));f[10]=b*(r*A-n*y)-d*(h*A-k*y)+s*(h*n-k*r);f[11]=-(b*(r*q-n*w)-d*(h*q-k*w)+t*
(h*n-k*r));f[12]=-(d*(w*g-B*y)-t*(r*g-p*y)+s*(r*B-p*w));f[13]=b*(w*g-B*y)-t*(h*g-e*y)+s*(h*B-e*w);f[14]=-(b*(r*g-p*y)-d*(h*g-e*y)+s*(h*p-e*r));f[15]=b*(r*B-p*w)-d*(h*B-e*w)+t*(h*p-e*r);return f};a.determinant=function(a){var f=a[0],b=a[1],h=a[2],e=a[3],k=a[4],d=a[5],r=a[6],p=a[7],n=a[8],t=a[9],w=a[10],B=a[11],q=a[12],s=a[13],y=a[14];a=a[15];return(f*d-b*k)*(w*a-B*y)-(f*r-h*k)*(t*a-B*s)+(f*p-e*k)*(t*y-w*s)+(b*r-h*d)*(n*a-B*q)-(b*p-e*d)*(n*y-w*q)+(h*p-e*r)*(n*s-t*q)};a.multiply=function(a,f,b){var h=
a[0],e=a[1],k=a[2],d=a[3],r=a[4],p=a[5],n=a[6],t=a[7],w=a[8],B=a[9],q=a[10],s=a[11],y=a[12],g=a[13],A=a[14];a=a[15];var u=f[0],S=f[1],I=f[2],v=f[3];b[0]=u*h+S*r+I*w+v*y;b[1]=u*e+S*p+I*B+v*g;b[2]=u*k+S*n+I*q+v*A;b[3]=u*d+S*t+I*s+v*a;u=f[4];S=f[5];I=f[6];v=f[7];b[4]=u*h+S*r+I*w+v*y;b[5]=u*e+S*p+I*B+v*g;b[6]=u*k+S*n+I*q+v*A;b[7]=u*d+S*t+I*s+v*a;u=f[8];S=f[9];I=f[10];v=f[11];b[8]=u*h+S*r+I*w+v*y;b[9]=u*e+S*p+I*B+v*g;b[10]=u*k+S*n+I*q+v*A;b[11]=u*d+S*t+I*s+v*a;u=f[12];S=f[13];I=f[14];v=f[15];b[12]=u*h+
S*r+I*w+v*y;b[13]=u*e+S*p+I*B+v*g;b[14]=u*k+S*n+I*q+v*A;b[15]=u*d+S*t+I*s+v*a;return b};a.mul=a.multiply;a.translate=function(a,f,b){var h=f[0],e=f[1];f=f[2];var k,d,r,p,n,t,w,B,q,s,y,g;a===b?(b[12]=a[0]*h+a[4]*e+a[8]*f+a[12],b[13]=a[1]*h+a[5]*e+a[9]*f+a[13],b[14]=a[2]*h+a[6]*e+a[10]*f+a[14],b[15]=a[3]*h+a[7]*e+a[11]*f+a[15]):(k=a[0],d=a[1],r=a[2],p=a[3],n=a[4],t=a[5],w=a[6],B=a[7],q=a[8],s=a[9],y=a[10],g=a[11],b[0]=k,b[1]=d,b[2]=r,b[3]=p,b[4]=n,b[5]=t,b[6]=w,b[7]=B,b[8]=q,b[9]=s,b[10]=y,b[11]=g,
b[12]=k*h+n*e+q*f+a[12],b[13]=d*h+t*e+s*f+a[13],b[14]=r*h+w*e+y*f+a[14],b[15]=p*h+B*e+g*f+a[15]);return b};a.scale=function(a,f,b){var h=f[0],e=f[1];f=f[2];b[0]=a[0]*h;b[1]=a[1]*h;b[2]=a[2]*h;b[3]=a[3]*h;b[4]=a[4]*e;b[5]=a[5]*e;b[6]=a[6]*e;b[7]=a[7]*e;b[8]=a[8]*f;b[9]=a[9]*f;b[10]=a[10]*f;b[11]=a[11]*f;b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.rotate=function(a,f,b,h){var e=b[0],k=b[1];b=b[2];var d=Math.sqrt(e*e+k*k+b*b),r,p,n,t,w,B,q,s,y,g,A,u,S,I,v,K,m,H,D,U;if(1E-7>Math.abs(d))return null;
d=1/d;e*=d;k*=d;b*=d;r=Math.sin(f);p=Math.cos(f);n=1-p;f=a[0];d=a[1];t=a[2];w=a[3];B=a[4];q=a[5];s=a[6];y=a[7];g=a[8];A=a[9];u=a[10];S=a[11];I=e*e*n+p;v=k*e*n+b*r;K=b*e*n-k*r;m=e*k*n-b*r;H=k*k*n+p;D=b*k*n+e*r;U=e*b*n+k*r;e=k*b*n-e*r;k=b*b*n+p;h[0]=f*I+B*v+g*K;h[1]=d*I+q*v+A*K;h[2]=t*I+s*v+u*K;h[3]=w*I+y*v+S*K;h[4]=f*m+B*H+g*D;h[5]=d*m+q*H+A*D;h[6]=t*m+s*H+u*D;h[7]=w*m+y*H+S*D;h[8]=f*U+B*e+g*k;h[9]=d*U+q*e+A*k;h[10]=t*U+s*e+u*k;h[11]=w*U+y*e+S*k;a!==h&&(h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);
return h};a.rotateX=function(a,f,b){var h=Math.sin(f);f=Math.cos(f);var e=a[4],k=a[5],d=a[6],r=a[7],p=a[8],n=a[9],t=a[10],w=a[11];a!==b&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[4]=e*f+p*h;b[5]=k*f+n*h;b[6]=d*f+t*h;b[7]=r*f+w*h;b[8]=p*f-e*h;b[9]=n*f-k*h;b[10]=t*f-d*h;b[11]=w*f-r*h;return b};a.rotateY=function(a,f,b){var h=Math.sin(f);f=Math.cos(f);var e=a[0],k=a[1],d=a[2],r=a[3],p=a[8],n=a[9],t=a[10],w=a[11];a!==b&&(b[4]=a[4],b[5]=a[5],b[6]=a[6],
b[7]=a[7],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=e*f-p*h;b[1]=k*f-n*h;b[2]=d*f-t*h;b[3]=r*f-w*h;b[8]=e*h+p*f;b[9]=k*h+n*f;b[10]=d*h+t*f;b[11]=r*h+w*f;return b};a.rotateZ=function(a,f,b){var h=Math.sin(f);f=Math.cos(f);var e=a[0],k=a[1],d=a[2],r=a[3],p=a[4],n=a[5],t=a[6],w=a[7];a!==b&&(b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);b[0]=e*f+p*h;b[1]=k*f+n*h;b[2]=d*f+t*h;b[3]=r*f+w*h;b[4]=p*f-e*h;b[5]=n*f-k*h;b[6]=t*f-d*h;b[7]=w*f-r*h;return b};
a.fromRotationTranslation=function(a,f,b){var h=a[0],e=a[1],k=a[2],d=a[3],p=h+h,x=e+e,n=k+k;a=h*p;var t=h*x,h=h*n,w=e*x,e=e*n,k=k*n,p=d*p,x=d*x,d=d*n;b[0]=1-(w+k);b[1]=t+d;b[2]=h-x;b[3]=0;b[4]=t-d;b[5]=1-(a+k);b[6]=e+p;b[7]=0;b[8]=h+x;b[9]=e-p;b[10]=1-(a+w);b[11]=0;b[12]=f[0];b[13]=f[1];b[14]=f[2];b[15]=1;return b};a.fromQuat=function(a,f){var b=a[0],h=a[1],e=a[2],k=a[3],d=b+b,p=h+h,x=e+e,b=b*d,n=h*d,h=h*p,t=e*d,w=e*p,e=e*x,d=k*d,p=k*p,k=k*x;f[0]=1-h-e;f[1]=n+k;f[2]=t-p;f[3]=0;f[4]=n-k;f[5]=1-b-e;
f[6]=w+d;f[7]=0;f[8]=t+p;f[9]=w-d;f[10]=1-b-h;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};a.frustum=function(a,f,b,h,e,k,d){var p=1/(f-a),x=1/(h-b),n=1/(e-k);d[0]=2*e*p;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=2*e*x;d[6]=0;d[7]=0;d[8]=(f+a)*p;d[9]=(h+b)*x;d[10]=(k+e)*n;d[11]=-1;d[12]=0;d[13]=0;d[14]=k*e*2*n;d[15]=0;return d};a.perspective=function(a,f,b,h,e){a=1/Math.tan(a/2);var k=1/(b-h);e[0]=a/f;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(h+b)*k;e[11]=-1;e[12]=0;e[13]=0;
e[14]=2*h*b*k;e[15]=0;return e};a.ortho=function(a,f,b,h,e,k,d){var p=1/(a-f),x=1/(b-h),n=1/(e-k);d[0]=-2*p;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=-2*x;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=2*n;d[11]=0;d[12]=(a+f)*p;d[13]=(h+b)*x;d[14]=(k+e)*n;d[15]=1;return d};a.lookAt=function(c,f,b,h){var e,k,d,p,x,n,t,w,B=c[0],q=c[1];c=c[2];d=b[0];p=b[1];k=b[2];t=f[0];b=f[1];e=f[2];if(1E-7>Math.abs(B-t)&&1E-7>Math.abs(q-b)&&1E-7>Math.abs(c-e))return a.identity(h);f=B-t;b=q-b;t=c-e;w=1/Math.sqrt(f*f+b*b+t*t);f*=w;b*=w;t*=
w;e=p*t-k*b;k=k*f-d*t;d=d*b-p*f;(w=Math.sqrt(e*e+k*k+d*d))?(w=1/w,e*=w,k*=w,d*=w):d=k=e=0;p=b*d-t*k;x=t*e-f*d;n=f*k-b*e;(w=Math.sqrt(p*p+x*x+n*n))?(w=1/w,p*=w,x*=w,n*=w):n=x=p=0;h[0]=e;h[1]=p;h[2]=f;h[3]=0;h[4]=k;h[5]=x;h[6]=b;h[7]=0;h[8]=d;h[9]=n;h[10]=t;h[11]=0;h[12]=-(e*B+k*q+d*c);h[13]=-(p*B+x*q+n*c);h[14]=-(f*B+b*q+t*c);h[15]=1;return h};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a,p){a.parser=function(){function a(c,f,b,h,e,k){this.message=c;this.expected=f;this.found=b;this.offset=h;this.line=e;this.column=k;this.name="SyntaxError"}(function(a,f){function b(){this.constructor=a}b.prototype=f.prototype;a.prototype=new b})(a,Error);return{SyntaxError:a,parse:function(c){function f(a){if(wa!==a){wa>a&&(wa=0,oa={line:1,column:1,seenCR:!1});var b=oa,d,e;for(d=wa;d<a;d++)e=c.charAt(d),"\n"===e?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===e||
"\u2028"===e||"\u2029"===e?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1);wa=a}return oa}function b(a){N<Ua||(N>Ua&&(Ua=N,ka=[]),ka.push(a))}function l(){var a,d,f;a=N;d=z();d!==G?(d=e(),d!==G?(f=z(),f!==G?(na++,10===c.charCodeAt(N)?(f=Xa,N++):(f=G,0===na&&b(bc)),f===G&&(c.substr(N,2)===Kb?(f=Kb,N+=2):(f=G,0===na&&b(gc)),f===G&&(13===c.charCodeAt(N)?(f=va,N++):(f=G,0===na&&b(Oa)))),na--,f===G&&0===na&&b(jc),f===G&&(f=J),f!==G?a=d:(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C);return a}function e(){var a,
d,e,f,g,h,l,m;a=N;d=k();if(d!==G){e=[];f=N;g=z();g!==G?(44===c.charCodeAt(N)?(h=ha,N++):(h=G,0===na&&b(pa)),h!==G?(l=z(),l!==G?(m=k(),m!==G?f=g=[g,h,l,m]:(N=f,f=C)):(N=f,f=C)):(N=f,f=C)):(N=f,f=C);for(;f!==G;)e.push(f),f=N,g=z(),g!==G?(44===c.charCodeAt(N)?(h=ha,N++):(h=G,0===na&&b(pa)),h!==G?(l=z(),l!==G?(m=k(),m!==G?f=g=[g,h,l,m]:(N=f,f=C)):(N=f,f=C)):(N=f,f=C)):(N=f,f=C);e!==G?(0!=e.length&&(d=e[e.length-1]),a=d):(N=a,a=C)}else N=a,a=C;return a}function k(){var a,f,g,h;a=N;f=d();f!==G?(g=z(),g!==
G?(63===c.charCodeAt(N)?(g=la,N++):(g=G,0===na&&b(Y)),g!==G?(g=z(),g!==G?(g=e(),g!==G?(h=z(),h!==G?(58===c.charCodeAt(N)?(h=ja,N++):(h=G,0===na&&b(E)),h!==G?(h=z(),h!==G?(h=e(),h!==G?a=f?g:h:(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C);a===G&&(a=d());return a}function d(){var a,b,c,d,e,f,g,h;a=N;b=p();if(b!==G){c=[];d=N;e=z();e!==G?(f=X(),f!==G?(g=z(),g!==G?(h=p(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),
d=N,e=z(),e!==G?(f=X(),f!==G?(g=z(),g!==G?(h=p(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else N=a,a=C}else N=a,a=C;return a}function p(){var a,b,c,d,e,f,g,h;a=N;b=x();if(b!==G){c=[];d=N;e=z();e!==G?(f=T(),f!==G?(g=z(),g!==G?(h=x(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=T(),f!==G?(g=z(),g!==G?(h=x(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==
G)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else N=a,a=C}else N=a,a=C;return a}function x(){var a,b,c,d,e,f,g,h;a=N;b=n();if(b!==G){c=[];d=N;e=z();e!==G?(f=Q(),f!==G?(g=z(),g!==G?(h=n(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=Q(),f!==G?(g=z(),g!==G?(h=n(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else N=a,a=C}else N=a,a=C;return a}function n(){var a,b,c,d,e,f,g,h;a=N;b=
t();if(b!==G){c=[];d=N;e=z();e!==G?(f=M(),f!==G?(g=z(),g!==G?(h=t(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=M(),f!==G?(g=z(),g!==G?(h=t(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else N=a,a=C}else N=a,a=C;return a}function t(){var a,b,c,d,e,f,g,h;a=N;b=w();if(b!==G){c=[];d=N;e=z();e!==G?(f=V(),f!==G?(g=z(),g!==G?(h=w(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,
d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=V(),f!==G?(g=z(),g!==G?(h=w(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else N=a,a=C}else N=a,a=C;return a}function w(){var a,b,c,d,e,f,g,h;a=N;b=B();if(b!==G){c=[];d=N;e=z();e!==G?(f=Z(),f!==G?(g=z(),g!==G?(h=B(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=Z(),f!==G?(g=z(),g!==G?(h=B(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):
(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else N=a,a=C}else N=a,a=C;return a}function B(){var a,b,c,d,e,f,g,h;a=N;b=q();if(b!==G){c=[];d=N;e=z();e!==G?(f=P(),f!==G?(g=z(),g!==G?(h=q(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=P(),f!==G?(g=z(),g!==G?(h=q(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=
a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else N=a,a=C}else N=a,a=C;return a}function q(){var a,b,c,d,e,f,g,h;a=N;b=s();if(b!==G){c=[];d=N;e=z();e!==G?(f=U(),f!==G?(g=z(),g!==G?(h=s(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=U(),f!==G?(g=z(),g!==G?(h=s(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];
break;case ">>":a>>=c[b][3]}else N=a,a=C}else N=a,a=C;return a}function s(){var a,b,c,d,e,f,g,h;a=N;b=y();if(b!==G){c=[];d=N;e=z();e!==G?(f=D(),f!==G?(g=z(),g!==G?(h=y(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=D(),f!==G?(g=z(),g!==G?(h=y(),h!==G?d=e=[e,f,g,h]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else N=a,a=C}else N=a,a=C;return a}function y(){var a,
b,c,d,e,f,h,k;a=N;b=g();if(b!==G){c=[];d=N;e=z();e!==G?(f=H(),f!==G?(h=z(),h!==G?(k=g(),k!==G?d=e=[e,f,h,k]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);for(;d!==G;)c.push(d),d=N,e=z(),e!==G?(f=H(),f!==G?(h=z(),h!==G?(k=g(),k!==G?d=e=[e,f,h,k]:(N=d,d=C)):(N=d,d=C)):(N=d,d=C)):(N=d,d=C);if(c!==G)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else N=a,a=C}else N=a,a=C;return a}function g(){var a,d,e;a=N;c.substr(N,7)===ca?
(d=ca,N+=7):(d=G,0===na&&b(ua));d!==G?(e=z(),e!==G?(e=u(),e!==G?a=e:(N=a,a=C)):(N=a,a=C)):(N=a,a=C);if(a===G){a=N;d=A();if(d!==G)if(e=z(),e!==G)if(c.substr(N,2)===Ta?(e=Ta,N+=2):(e=G,0===na&&b(Wa)),e===G&&(c.substr(N,2)===tc?(e=tc,N+=2):(e=G,0===na&&b(pb))),e!==G){a:{a=d;switch(e){case "++":d=++a;break a;case "--":d=--a;break a}d=void 0}a=d}else N=a,a=C;else N=a,a=C;else N=a,a=C;a===G&&(a=A());a===G&&(a=N,c.substr(N,2)===Ta?(d=Ta,N+=2):(d=G,0===na&&b(Wa)),d===G&&(c.substr(N,2)===tc?(d=tc,N+=2):(d=
G,0===na&&b(pb)),d===G&&(43===c.charCodeAt(N)?(d=uc,N++):(d=G,0===na&&b(sb)),d===G&&(45===c.charCodeAt(N)?(d=Rb,N++):(d=G,0===na&&b(ub)),d===G&&(126===c.charCodeAt(N)?(d=ud,N++):(d=G,0===na&&b(nd)),d===G&&(33===c.charCodeAt(N)?(d=fc,N++):(d=G,0===na&&b(qd))))))),d!==G?(e=z(),e!==G?(e=g(),e!==G?a=d=ea(d,e):(N=a,a=C)):(N=a,a=C)):(N=a,a=C))}return a}function A(){var a,d,f;na++;var g;a=N;48===c.charCodeAt(N)?(d=Ja,N++):(d=G,0===na&&b(ab));if(d!==G)if(Bb.test(c.charAt(N))?(d=c.charAt(N),N++):(d=G,0===
na&&b(Za)),d!==G){d=N;f=[];g=I();if(g!==G)for(;g!==G;)f.push(g),g=I();else f=C;f!==G&&(f=c.substring(d,N));d=f;d!==G?a=d=parseInt("0x"+d):(N=a,a=C)}else N=a,a=C;else N=a,a=C;if(a===G){a=N;48===c.charCodeAt(N)?(d=Ja,N++):(d=G,0===na&&b(ab));if(d===G)if(d=N,Ab.test(c.charAt(N))?(f=c.charAt(N),N++):(f=G,0===na&&b(Hb)),f!==G){var h;g=[];h=S();if(h!==G)for(;h!==G;)g.push(h),h=S();else g=C;g===G&&(g=J);g!==G?d=f=[f,g]:(N=d,d=C)}else N=d,d=C;d!==G&&(d=c.substring(a,N));a=d;a!==G&&(a=parseInt(a))}na--;a===
G&&0===na&&b(Ha);a===G&&(d=v(),d!==G&&(d=0),a=d,a===G&&(a=N,40===c.charCodeAt(N)?(d=ma,N++):(d=G,0===na&&b(Aa)),d!==G?(d=z(),d!==G?(d=e(),d!==G?(f=z(),f!==G?(41===c.charCodeAt(N)?(f=O,N++):(f=G,0===na&&b(Ea)),f!==G?a=d:(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)):(N=a,a=C)));return a}function u(){var a,d,e,f,g;d=v();d!==G&&(d=0);a=d;if(a===G){d=[];f=e=N;na++;40===c.charCodeAt(N)?(g=ma,N++):(g=G,0===na&&b(Aa));g===G&&(41===c.charCodeAt(N)?(g=O,N++):(g=G,0===na&&b(Ea)));na--;g===G?f=ba:(N=f,f=C);f!==
G?(g=W(),g!==G?e=f=[f,g]:(N=e,e=C)):(N=e,e=C);if(e!==G)for(;e!==G;)d.push(e),f=e=N,na++,40===c.charCodeAt(N)?(g=ma,N++):(g=G,0===na&&b(Aa)),g===G&&(41===c.charCodeAt(N)?(g=O,N++):(g=G,0===na&&b(Ea))),na--,g===G?f=ba:(N=f,f=C),f!==G?(g=W(),g!==G?e=f=[f,g]:(N=e,e=C)):(N=e,e=C);else d=C;d!==G&&(d=1);a=d;a===G&&(a=N,40===c.charCodeAt(N)?(d=ma,N++):(d=G,0===na&&b(Aa)),d!==G?(e=z(),e!==G?(f=u(),f!==G?(g=z(),g!==G?(41===c.charCodeAt(N)?(d=O,N++):(d=G,0===na&&b(Ea)),d!==G?a=f:(N=a,a=C)):(N=a,a=C)):(N=a,a=
C)):(N=a,a=C)):(N=a,a=C))}return a}function S(){var a;Ka.test(c.charAt(N))?(a=c.charAt(N),N++):(a=G,0===na&&b(zb));return a}function I(){var a;lb.test(c.charAt(N))?(a=c.charAt(N),N++):(a=G,0===na&&b(qb));return a}function v(){var a,d;na++;d=a=N;na++;var e,f,g,h;e=N;c.substr(N,7)===ca?(f=ca,N+=7):(f=G,0===na&&b(ua));f!==G?(g=N,na++,h=m(),na--,h===G?g=ba:(N=g,g=C),g!==G?e=f=[f,g]:(N=e,e=C)):(N=e,e=C);na--;e===G?d=ba:(N=d,d=C);if(d!==G){na++;d=N;e=K();if(e!==G){f=[];for(g=m();g!==G;)f.push(g),g=m();
f!==G?d=e+=f.join(""):(N=d,d=C)}else N=d,d=C;na--;d===G&&0===na&&b(tb);d!==G?a=d:(N=a,a=C)}else N=a,a=C;na--;a===G&&0===na&&b(tb);return a}function K(){var a;Ma.test(c.charAt(N))?(a=c.charAt(N),N++):(a=G,0===na&&b(Ia));a===G&&(36===c.charCodeAt(N)?(a=kb,N++):(a=G,0===na&&b(Na)),a===G&&(95===c.charCodeAt(N)?(a=La,N++):(a=G,0===na&&b(Fa))));return a}function m(){var a;a=K();a===G&&(a=S());return a}function H(){var a,d,e,f;a=N;42===c.charCodeAt(N)?(d=ad,N++):(d=G,0===na&&b(nc));d===G&&(47===c.charCodeAt(N)?
(d=Pb,N++):(d=G,0===na&&b($b)),d===G&&(37===c.charCodeAt(N)?(d=cd,N++):(d=G,0===na&&b(oc))));d!==G?(e=N,na++,61===c.charCodeAt(N)?(f=Bc,N++):(f=G,0===na&&b(ic)),na--,f===G?e=ba:(N=e,e=C),e!==G?a=d:(N=a,a=C)):(N=a,a=C);return a}function D(){var a,d,e;a=N;43===c.charCodeAt(N)?(d=uc,N++):(d=G,0===na&&b(sb));d!==G?(d=N,na++,43===c.charCodeAt(N)?(e=uc,N++):(e=G,0===na&&b(sb)),e===G&&(61===c.charCodeAt(N)?(e=Bc,N++):(e=G,0===na&&b(ic))),na--,e===G?d=ba:(N=d,d=C),d!==G?a="+":(N=a,a=C)):(N=a,a=C);a===G&&
(a=N,45===c.charCodeAt(N)?(d=Rb,N++):(d=G,0===na&&b(ub)),d!==G?(d=N,na++,45===c.charCodeAt(N)?(e=Rb,N++):(e=G,0===na&&b(ub)),e===G&&(61===c.charCodeAt(N)?(e=Bc,N++):(e=G,0===na&&b(ic))),na--,e===G?d=ba:(N=d,d=C),d!==G?a="-":(N=a,a=C)):(N=a,a=C));return a}function U(){var a;c.substr(N,2)===Sc?(a=Sc,N+=2):(a=G,0===na&&b(Ba));a===G&&(c.substr(N,2)===Ib?(a=Ib,N+=2):(a=G,0===na&&b(rb)));return a}function P(){var a;c.substr(N,2)===za?(a=za,N+=2):(a=G,0===na&&b(fb));a===G&&(c.substr(N,2)===$?(a=$,N+=2):
(a=G,0===na&&b(Qa)),a===G&&(60===c.charCodeAt(N)?(a=mb,N++):(a=G,0===na&&b(ta)),a===G&&(62===c.charCodeAt(N)?(a=qa,N++):(a=G,0===na&&b(vb)))));return a}function Z(){var a;c.substr(N,2)===xa?(a=xa,N+=2):(a=G,0===na&&b(gb));a===G&&(c.substr(N,2)===ra?(a=ra,N+=2):(a=G,0===na&&b(bb)));return a}function V(){var a,d,e;a=N;38===c.charCodeAt(N)?(d=Da,N++):(d=G,0===na&&b(nb));d!==G?(d=N,na++,38===c.charCodeAt(N)?(e=Da,N++):(e=G,0===na&&b(nb)),na--,e===G?d=ba:(N=d,d=C),d!==G?a="&":(N=a,a=C)):(N=a,a=C);return a}
function M(){var a,d,e;a=N;94===c.charCodeAt(N)?(d=Jb,N++):(d=G,0===na&&b(Cc));d!==G?(d=N,na++,94===c.charCodeAt(N)?(e=Jb,N++):(e=G,0===na&&b(Cc)),na--,e===G?d=ba:(N=d,d=C),d!==G?a="^":(N=a,a=C)):(N=a,a=C);return a}function Q(){var a,d,e;a=N;124===c.charCodeAt(N)?(d=Vb,N++):(d=G,0===na&&b(ac));d!==G?(d=N,na++,124===c.charCodeAt(N)?(e=Vb,N++):(e=G,0===na&&b(ac)),na--,e===G?d=ba:(N=d,d=C),d!==G?a="|":(N=a,a=C)):(N=a,a=C);return a}function T(){var a;c.substr(N,2)===pc?(a=pc,N+=2):(a=G,0===na&&b(wb));
a!==G&&(a="&&");return a}function X(){var a;c.substr(N,2)===Mb?(a=Mb,N+=2):(a=G,0===na&&b(Wb));a!==G&&(a="||");return a}function z(){var a,b;a=[];for(b=ia();b!==G;)a.push(b),b=ia();return a}function ia(){var a;na++;hb.test(c.charAt(N))?(a=c.charAt(N),N++):(a=G,0===na&&b(Xb));na--;a===G&&0===na&&b(Sb);return a}function W(){var a;c.length>N?(a=c.charAt(N),N++):(a=G,0===na&&b(R));return a}var L=1<arguments.length?arguments[1]:{},G={},fa={start:l},da=l,C=G,J=null,ha=",",pa={type:"literal",value:",",description:'","'},
la="?",Y={type:"literal",value:"?",description:'"?"'},ja=":",E={type:"literal",value:":",description:'":"'},ca="defined",ua={type:"literal",value:"defined",description:'"defined"'},ea=function(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}},ma="(",Aa={type:"literal",value:"(",description:'"("'},O=")",Ea={type:"literal",value:")",description:'")"'},ba=void 0,Ha={type:"other",description:"number"},Ja="0",ab={type:"literal",
value:"0",description:'"0"'},Ka=/^[0-9]/,zb={type:"class",value:"[0-9]",description:"[0-9]"},Ab=/^[1-9]/,Hb={type:"class",value:"[1-9]",description:"[1-9]"},Bb=/^[xX]/,Za={type:"class",value:"[xX]",description:"[xX]"},lb=/^[0-9a-fA-F]/,qb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},tb={type:"other",description:"identifier"},kb="$",Na={type:"literal",value:"$",description:'"$"'},La="_",Fa={type:"literal",value:"_",description:'"_"'},Ma=/^[a-zA-Z]/,Ia={type:"class",value:"[a-zA-Z]",
description:"[a-zA-Z]"},Ta="++",Wa={type:"literal",value:"++",description:'"++"'},tc="--",pb={type:"literal",value:"--",description:'"--"'},uc="+",sb={type:"literal",value:"+",description:'"+"'},Rb="-",ub={type:"literal",value:"-",description:'"-"'},ud="~",nd={type:"literal",value:"~",description:'"~"'},fc="!",qd={type:"literal",value:"!",description:'"!"'},ad="*",nc={type:"literal",value:"*",description:'"*"'},Pb="/",$b={type:"literal",value:"/",description:'"/"'},cd="%",oc={type:"literal",value:"%",
description:'"%"'},Bc="=",ic={type:"literal",value:"=",description:'"="'},Sc="<<",Ba={type:"literal",value:"<<",description:'"<<"'},Ib=">>",rb={type:"literal",value:">>",description:'">>"'},za="<=",fb={type:"literal",value:"<=",description:'"<="'},$=">=",Qa={type:"literal",value:">=",description:'">="'},mb="<",ta={type:"literal",value:"<",description:'"<"'},qa=">",vb={type:"literal",value:">",description:'">"'},xa="==",gb={type:"literal",value:"==",description:'"=="'},ra="!=",bb={type:"literal",value:"!=",
description:'"!="'},Da="&",nb={type:"literal",value:"&",description:'"&"'},Jb="^",Cc={type:"literal",value:"^",description:'"^"'},Vb="|",ac={type:"literal",value:"|",description:'"|"'},pc="&&",wb={type:"literal",value:"&&",description:'"&&"'},Mb="||",Wb={type:"literal",value:"||",description:'"||"'},Sb={type:"other",description:"whitespace"},hb=/^[\t\x0B\f ]/,Xb={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},jc={type:"other",description:"end of line"},Xa="\n",bc={type:"literal",
value:"\n",description:'"\\n"'},Kb="\r\n",gc={type:"literal",value:"\r\n",description:'"\\r\\n"'},va="\r",Oa={type:"literal",value:"\r",description:'"\\r"'},R={type:"any",description:"any character"},N=0,wa=0,oa={line:1,column:1,seenCR:!1},Ua=0,ka=[],na=0,Cb;if("startRule"in L){if(!(L.startRule in fa))throw Error("Can't start parsing from rule \""+L.startRule+'".');da=fa[L.startRule]}Cb=da();if(Cb!==G&&N===c.length)return Cb;Cb!==G&&N<c.length&&b({type:"end",description:"end of input"});throw function(b,
d,e){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function k(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,
function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var l=f(e),m=e<c.length?c.charAt(e):null;null!==d&&g(d);return new a(null!==b?b:k(d,m),d,m,e,l.line,l.column)}(null,ka,Ua);}}}()};b4w.module.__gpp_parser=function(a,p){a.parser=function(){function a(c,f,b,h,e,k){this.message=c;this.expected=f;this.found=b;this.offset=h;this.line=e;this.column=k;this.name="SyntaxError"}(function(a,f){function b(){this.constructor=a}b.prototype=f.prototype;a.prototype=new b})(a,Error);return{SyntaxError:a,parse:function(c){function f(a){if(Ad!==a){Ad>a&&(Ad=0,Gd={line:1,column:1,seenCR:!1});var b=Gd,d,e;for(d=Ad;d<a;d++)e=c.charAt(d),"\n"===e?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===
e||"\u2028"===e||"\u2029"===e?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1);Ad=a}return Gd}function b(a){F<Cd||(F>Cd&&(Cd=F,Hd=[]),Hd.push(a))}function l(){var a,b,c;a=F;b=H();b!==z?(b=e(),b!==z?(c=H(),c!==z?a=b:(F=a,a=L)):(F=a,a=L)):(F=a,a=L);return a}function e(){var a,b,c,d,e,f;a=F;b=k();if(b!==z){c=[];d=F;e=H();e!==z?(f=k(),f!==z?d=e=[e,f]:(F=d,d=L)):(F=d,d=L);for(;d!==z;)c.push(d),d=F,e=H(),e!==z?(f=k(),f!==z?d=e=[e,f]:(F=d,d=L)):(F=d,d=L);c!==z?a=b=fa(b,c):(F=a,a=L)}else F=a,a=
L;a===z&&(a=G);a!==z&&(a={type:"group",parts:null!==a?a:[]});return a}function k(){var a,f,g,h,k,l,q,t,u;f=F;var s,w,v,x,y,B,A,D,E,I;s=F;35===c.charCodeAt(F)?(w=da,F++):(w=z,0===aa&&b(C));w!==z?(v=K(),v!==z?(c.substr(F,2)===J?(x=J,F+=2):(x=z,0===aa&&b(ha)),x!==z?(y=m(),y!==z?(B=p(),B!==z?(A=K(),A!==z?(D=P(),D!==z?(E=H(),E!==z?(I=e(),I!==z?s=w={type:"if",expression:B,group:I}:(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L);s===z&&(s=F,35===c.charCodeAt(F)?
(w=da,F++):(w=z,0===aa&&b(C)),w!==z?(v=K(),v!==z?(c.substr(F,5)===pa?(x=pa,F+=5):(x=z,0===aa&&b(la)),x!==z?(y=m(),y!==z?(B=n(),B!==z?(A=K(),A!==z?(D=P(),D!==z?(E=H(),E!==z?(I=e(),I!==z?s=w={type:"ifdef",name:B,group:I}:(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L),s===z&&(s=F,35===c.charCodeAt(F)?(w=da,F++):(w=z,0===aa&&b(C)),w!==z?(v=K(),v!==z?(c.substr(F,6)===Y?(x=Y,F+=6):(x=z,0===aa&&b(ja)),x!==z?(y=m(),y!==z?(B=n(),B!==z?(A=K(),A!==z?(D=P(),
D!==z?(E=H(),E!==z?(I=e(),I!==z?s=w={type:"ifndef",name:B,group:I}:(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)):(F=s,s=L)));g=s;if(g!==z)if(h=H(),h!==z){k=[];for(l=d();l!==z;)k.push(l),l=d();if(k!==z)if(l=H(),l!==z){var S,M,N,Q,U,R,V,W;S=F;35===c.charCodeAt(F)?(M=da,F++):(M=z,0===aa&&b(C));M!==z?(N=K(),N!==z?(c.substr(F,4)===ua?(Q=ua,F+=4):(Q=z,0===aa&&b(ea)),Q!==z?(U=K(),U!==z?(R=P(),R!==z?(V=H(),V!==z?(W=e(),W!==z?S=M={type:"else",group:W}:(F=S,S=L)):(F=
S,S=L)):(F=S,S=L)):(F=S,S=L)):(F=S,S=L)):(F=S,S=L)):(F=S,S=L);q=S;q===z&&(q=G);if(q!==z)if(t=H(),t!==z){var X,ca,ia,fa,ka,na;X=F;35===c.charCodeAt(F)?(ca=da,F++):(ca=z,0===aa&&b(C));ca!==z?(ia=K(),ia!==z?(c.substr(F,5)===ma?(fa=ma,F+=5):(fa=z,0===aa&&b(Aa)),fa!==z?(ka=K(),ka!==z?(na=Z(),na!==z?X=ca=[ca,ia,fa,ka,na]:(F=X,X=L)):(F=X,X=L)):(F=X,X=L)):(F=X,X=L)):(F=X,X=L);u=X;if(u!==z){for(var ta=q,sa=[g],ya=0;ya<k.length;ya++)sa.push(k[ya]);null!==ta&&sa.push(ta);f=g={type:"condition",parts:sa}}else F=
f,f=L}else F=f,f=L;else F=f,f=L}else F=f,f=L;else F=f,f=L}else F=f,f=L;else F=f,f=L;a=f;if(a===z){var ga,oa,xa,ra,qa,va,wa,Da,Ga,Oa,Xa,$a,Qa,gb,hb;ga=F;35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C));if(oa!==z)if(xa=K(),xa!==z)if(c.substr(F,7)===O?(ra=O,F+=7):(ra=z,0===aa&&b(Ea)),ra!==z)if(qa=K(),qa!==z){var Ca,Ra,ib,bb,ob,mb;Ca=F;60===c.charCodeAt(F)?(Ra=ic,F++):(Ra=z,0===aa&&b(Sc));if(Ra!==z)if(ib=K(),ib!==z){var nb,Sa,Va,Ua;nb=[];Va=Sa=F;aa++;Ua=Z();Ua===z&&(62===c.charCodeAt(F)?(Ua=Ba,F++):
(Ua=z,0===aa&&b(Ib)));aa--;Ua===z?Va=fb:(F=Va,Va=L);Va!==z?(Ua=T(),Ua!==z?Sa=Va=[Va,Ua]:(F=Sa,Sa=L)):(F=Sa,Sa=L);for(;Sa!==z;)nb.push(Sa),Va=Sa=F,aa++,Ua=Z(),Ua===z&&(62===c.charCodeAt(F)?(Ua=Ba,F++):(Ua=z,0===aa&&b(Ib))),aa--,Ua===z?Va=fb:(F=Va,Va=L),Va!==z?(Ua=T(),Ua!==z?Sa=Va=[Va,Ua]:(F=Sa,Sa=L)):(F=Sa,Sa=L);nb!==z&&(nb=$(nb));bb=nb;bb!==z?(ob=K(),ob!==z?(62===c.charCodeAt(F)?(mb=Ba,F++):(mb=z,0===aa&&b(Ib)),mb!==z?Ca=Ra=bb:(F=Ca,Ca=L)):(F=Ca,Ca=L)):(F=Ca,Ca=L)}else F=Ca,Ca=L;else F=Ca,Ca=L;if(Ca===
z)if(Ca=F,34===c.charCodeAt(F)?(Ra=rb,F++):(Ra=z,0===aa&&b(za)),Ra!==z)if(ib=K(),ib!==z){var vb,cb,db,Ya;vb=[];db=cb=F;aa++;Ya=Z();Ya===z&&(34===c.charCodeAt(F)?(Ya=rb,F++):(Ya=z,0===aa&&b(za)));aa--;Ya===z?db=fb:(F=db,db=L);db!==z?(Ya=T(),Ya!==z?cb=db=[db,Ya]:(F=cb,cb=L)):(F=cb,cb=L);for(;cb!==z;)vb.push(cb),db=cb=F,aa++,Ya=Z(),Ya===z&&(34===c.charCodeAt(F)?(Ya=rb,F++):(Ya=z,0===aa&&b(za))),aa--,Ya===z?db=fb:(F=db,db=L),db!==z?(Ya=T(),Ya!==z?cb=db=[db,Ya]:(F=cb,cb=L)):(F=cb,cb=L);vb!==z&&(vb=$(vb));
bb=vb;bb!==z?(ob=K(),ob!==z?(34===c.charCodeAt(F)?(mb=rb,F++):(mb=z,0===aa&&b(za)),mb!==z?Ca=Ra=bb:(F=Ca,Ca=L)):(F=Ca,Ca=L)):(F=Ca,Ca=L)}else F=Ca,Ca=L;else F=Ca,Ca=L;va=Ca;va!==z?(wa=K(),wa!==z?(Da=Z(),Da!==z?ga=oa={type:"include",file:va}:(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)}else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;if(ga===z&&(ga=F,35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C)),oa!==z?(xa=K(),xa!==z?(c.substr(F,6)===ba?(ra=ba,F+=6):(ra=z,0===aa&&b(Ha)),ra===z&&(c.substr(F,
6)===Ja?(ra=Ja,F+=6):(ra=z,0===aa&&b(ab))),ra!==z?(qa=F,va=m(),va!==z?(wa=p(),wa!==z?qa=va=[va,wa]:(F=qa,qa=L)):(F=qa,qa=L),qa===z&&(qa=G),qa!==z?(va=K(),va!==z?(wa=Z(),wa!==z?ga=oa={type:ra}:(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L),ga===z)){ga=F;35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C));if(oa!==z)if(xa=K(),xa!==z)if(c.substr(F,6)===Ka?(ra=Ka,F+=6):(ra=z,0===aa&&b(zb)),ra===z&&(c.substr(F,3)===Ab?(ra=Ab,F+=3):(ra=z,0===aa&&b(Hb))),ra!==z)if(qa=m(),qa!==
z)if(va=n(),va!==z)if(wa=F,Da=m(),Da!==z?(Ga=p(),Ga!==z?wa=Da=[Da,Ga]:(F=wa,wa=L)):(F=wa,wa=L),wa===z&&(wa=G),wa!==z)if(Da=K(),Da!==z)if(Ga=Z(),Ga!==z){var Nb=ra,Ob=va,Jb=wa,Mb=[];if(null!==Jb)for(var Lb=0;Lb<Jb[1].length;Lb++)Mb.push(Jb[1][Lb]);ga=oa={type:Nb,name:Ob,tokens:Mb}}else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;if(ga===z){ga=F;35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C));if(oa!==z)if(xa=K(),xa!==z)if(c.substr(F,
6)===Ka?(ra=Ka,F+=6):(ra=z,0===aa&&b(zb)),ra!==z)if(qa=m(),qa!==z)if(va=n(),va!==z)if(40===c.charCodeAt(F)?(wa=Bb,F++):(wa=z,0===aa&&b(Za)),wa!==z)if(Da=K(),Da!==z){var wb,Kb,Cb,Pa,xb,yb,Db,Eb;wb=F;Kb=n();if(Kb!==z){Cb=[];Pa=F;xb=K();xb!==z?(44===c.charCodeAt(F)?(yb=Id,F++):(yb=z,0===aa&&b(Jd)),yb!==z?(Db=K(),Db!==z?(Eb=n(),Eb!==z?Pa=xb=[xb,yb,Db,Eb]:(F=Pa,Pa=L)):(F=Pa,Pa=L)):(F=Pa,Pa=L)):(F=Pa,Pa=L);for(;Pa!==z;)Cb.push(Pa),Pa=F,xb=K(),xb!==z?(44===c.charCodeAt(F)?(yb=Id,F++):(yb=z,0===aa&&b(Jd)),
yb!==z?(Db=K(),Db!==z?(Eb=n(),Eb!==z?Pa=xb=[xb,yb,Db,Eb]:(F=Pa,Pa=L)):(F=Pa,Pa=L)):(F=Pa,Pa=L)):(F=Pa,Pa=L);if(Cb!==z){for(var Vb=[Kb],Sb=0;Sb<Cb.length;Sb++)Vb.push(Cb[Sb][3]);wb=Kb=Vb}else F=wb,wb=L}else F=wb,wb=L;Ga=wb;Ga===z&&(Ga=G);Ga!==z?(Oa=K(),Oa!==z?(41===c.charCodeAt(F)?(Xa=lb,F++):(Xa=z,0===aa&&b(qb)),Xa!==z?($a=K(),$a!==z?(Qa=p(),Qa===z&&(Qa=G),Qa!==z?(gb=K(),gb!==z?(hb=Z(),hb!==z?ga=oa={type:"define",name:va,params:null!==Ga?Ga:[],tokens:null!==Qa?Qa:[]}:(F=ga,ga=L)):(F=ga,ga=L)):(F=
ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)}else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;if(ga===z){ga=F;35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C));if(oa!==z)if(xa=K(),xa!==z)if(c.substr(F,5)===tb?(ra=tb,F+=5):(ra=z,0===aa&&b(kb)),ra!==z)if(qa=F,va=m(),va!==z?(wa=p(),wa!==z?qa=va=[va,wa]:(F=qa,qa=L)):(F=qa,qa=L),qa===z&&(qa=G),qa!==z)if(va=K(),va!==z)if(wa=Z(),wa!==z){var Tb=qa,ac=[];if(null!==Tb)for(var Wb=0;Wb<
Tb[1].length;Wb++)ac.push(Tb[1][Wb]);ga=oa={type:"error",tokens:ac}}else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;if(ga===z&&(ga=F,35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C)),oa!==z?(xa=K(),xa!==z?(c.substr(F,4)===Na?(ra=Na,F+=4):(ra=z,0===aa&&b(La)),ra!==z?(qa=m(),qa!==z?(va=p(),va!==z?(wa=K(),wa!==z?(Da=Z(),Da!==z?ga=oa={type:"line",tokens:va}:(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L),ga===z&&(ga=
F,35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C)),oa!==z?(xa=K(),xa!==z?(c.substr(F,6)===Fa?(ra=Fa,F+=6):(ra=z,0===aa&&b(Ma)),ra!==z?(qa=m(),qa!==z?(va=n(),va!==z?(wa=m(),wa!==z?(Da=p(),Da!==z?(Ga=K(),Ga!==z?(Oa=Z(),Oa!==z?ga=oa={type:"pragma",name:va,tokens:Da}:(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L),ga===z&&(ga=F,35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C)),oa!==z?(xa=K(),xa!==z?(c.substr(F,5)===Ia?(ra=Ia,F+=
5):(ra=z,0===aa&&b(Ta)),ra!==z?(qa=m(),qa!==z?(va=n(),va!==z?(wa=K(),wa!==z?(Da=Z(),Da!==z?ga=oa={type:"undef",name:va}:(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L),ga===z)))){ga=F;35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C));if(oa!==z)if(xa=K(),xa!==z)if(c.substr(F,7)===Wa?(ra=Wa,F+=7):(ra=z,0===aa&&b(tc)),ra!==z)if(qa=F,va=m(),va!==z?(wa=p(),wa!==z?qa=va=[va,wa]:(F=qa,qa=L)):(F=qa,qa=L),qa===z&&(qa=G),qa!==z)if(va=K(),va!==z)if(wa=Z(),wa!==z){var Xb=
qa,bc=[];if(null!==Xb)for(var Yb=0;Yb<Xb[1].length;Yb++)bc.push(Xb[1][Yb]);ga=oa={type:"warning",tokens:bc}}else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;if(ga===z){ga=F;35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C));if(oa!==z)if(xa=K(),xa!==z)if(c.substr(F,9)===pb?(ra=pb,F+=9):(ra=z,0===aa&&b(uc)),ra!==z)if(qa=F,va=m(),va!==z?(wa=p(),wa!==z?qa=va=[va,wa]:(F=qa,qa=L)):(F=qa,qa=L),qa===z&&(qa=G),qa!==z)if(va=K(),va!==z)if(wa=Z(),wa!==z){var Zb=qa,ec=
[];if(null!==Zb)for(var cc=0;cc<Zb[1].length;cc++)ec.push(Zb[1][cc]);ga=oa={type:"extension",tokens:ec}}else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;else F=ga,ga=L;ga===z&&(ga=F,35===c.charCodeAt(F)?(oa=da,F++):(oa=z,0===aa&&b(C)),oa!==z?(xa=K(),xa!==z?(ra=Z(),ra!==z?ga=oa={type:"#"}:(F=ga,ga=L)):(F=ga,ga=L)):(F=ga,ga=L))}}}}}a=ga;if(a===z){var jb,dc,jc,kc;jb=F;var eb,gc,qc,lc,vc,rc,Ac,Cc,Ec,wc;eb=F;35===c.charCodeAt(F)?(gc=da,F++):(gc=z,0===aa&&b(C));gc!==z?(qc=K(),
qc!==z?(c.substr(F,4)===sb?(lc=sb,F+=4):(lc=z,0===aa&&b(Rb)),lc!==z?(vc=m(),vc!==z?(rc=n(),rc!==z?(Ac=K(),Ac!==z?(Cc=P(),Cc!==z?(Ec=H(),Ec!==z?(wc=e(),wc!==z?eb=gc={type:"node",name:rc,group:wc}:(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L)):(F=eb,eb=L);dc=eb;if(dc!==z)if(jc=H(),jc!==z){var Fb,pc,Dc,yc,Ic,zc;Fb=F;35===c.charCodeAt(F)?(pc=da,F++):(pc=z,0===aa&&b(C));pc!==z?(Dc=K(),Dc!==z?(c.substr(F,7)===ub?(yc=ub,F+=7):(yc=z,0===aa&&b(ud)),
yc!==z?(Ic=K(),Ic!==z?(zc=Z(),zc===z&&(zc=G),zc!==z?Fb=pc=[pc,Dc,yc,Ic,zc]:(F=Fb,Fb=L)):(F=Fb,Fb=L)):(F=Fb,Fb=L)):(F=Fb,Fb=L)):(F=Fb,Fb=L);kc=Fb;kc!==z?jb=dc:(F=jb,jb=L)}else F=jb,jb=L;else F=jb,jb=L;if(jb===z){var Gb,Hc,Pc,Mc,hc,Fc,Kc;Gb=F;35===c.charCodeAt(F)?(Hc=da,F++):(Hc=z,0===aa&&b(C));if(Hc!==z)if(Pc=K(),Pc!==z)if(c.substr(F,7)===nd?(Mc=nd,F+=7):(Mc=z,0===aa&&b(fc)),Mc!==z)if(hc=F,Fc=m(),Fc!==z?(Kc=p(),Kc!==z?hc=Fc=[Fc,Kc]:(F=hc,hc=L)):(F=hc,hc=L),hc===z&&(hc=G),hc!==z)if(Fc=K(),Fc!==z)if(Kc=
P(),Kc!==z){var Qc=hc,Rc=[];if(null!==Qc)for(var Tc=0;Tc<Qc[1].length;Tc++)Rc.push(Qc[1][Tc]);Gb=Hc={type:"node_in",name:Rc.pop(),qualifier:Rc}}else F=Gb,Gb=L;else F=Gb,Gb=L;else F=Gb,Gb=L;else F=Gb,Gb=L;else F=Gb,Gb=L;else F=Gb,Gb=L;jb=Gb;if(jb===z){var Qb,Nc,$c,Uc,mc,Jc,Lc;Qb=F;35===c.charCodeAt(F)?(Nc=da,F++):(Nc=z,0===aa&&b(C));if(Nc!==z)if($c=K(),$c!==z)if(c.substr(F,8)===qd?(Uc=qd,F+=8):(Uc=z,0===aa&&b(ad)),Uc!==z)if(mc=F,Jc=m(),Jc!==z?(Lc=p(),Lc!==z?mc=Jc=[Jc,Lc]:(F=mc,mc=L)):(F=mc,mc=L),mc===
z&&(mc=G),mc!==z)if(Jc=K(),Jc!==z)if(Lc=P(),Lc!==z){var Wc=mc,Xc=[];if(null!==Wc)for(var Zc=0;Zc<Wc[1].length;Zc++)Xc.push(Wc[1][Zc]);Qb=Nc={type:"node_out",name:Xc.pop(),qualifier:Xc}}else F=Qb,Qb=L;else F=Qb,Qb=L;else F=Qb,Qb=L;else F=Qb,Qb=L;else F=Qb,Qb=L;else F=Qb,Qb=L;jb=Qb;if(jb===z){var Ub,Vc,dd,bd,xc,Oc,Yc;Ub=F;35===c.charCodeAt(F)?(Vc=da,F++):(Vc=z,0===aa&&b(C));if(Vc!==z)if(dd=K(),dd!==z)if(c.substr(F,10)===nc?(bd=nc,F+=10):(bd=z,0===aa&&b(Pb)),bd!==z)if(xc=F,Oc=m(),Oc!==z?(Yc=p(),Yc!==
z?xc=Oc=[Oc,Yc]:(F=xc,xc=L)):(F=xc,xc=L),xc===z&&(xc=G),xc!==z)if(Oc=K(),Oc!==z)if(Yc=P(),Yc!==z){var ed=xc,fd=[];if(null!==ed)for(var hd=0;hd<ed[1].length;hd++)fd.push(ed[1][hd]);Ub=Vc={type:"node_param",name:fd.pop(),qualifier:fd}}else F=Ub,Ub=L;else F=Ub,Ub=L;else F=Ub,Ub=L;else F=Ub,Ub=L;else F=Ub,Ub=L;else F=Ub,Ub=L;jb=Ub;if(jb===z){var sc,gd,jd,id,md,od;sc=F;35===c.charCodeAt(F)?(gd=da,F++):(gd=z,0===aa&&b(C));gd!==z?(jd=K(),jd!==z?(c.substr(F,12)===$b?(id=$b,F+=12):(id=z,0===aa&&b(cd)),id!==
z?(md=K(),md!==z?(od=Z(),od!==z?sc=gd={type:"nodes_global"}:(F=sc,sc=L)):(F=sc,sc=L)):(F=sc,sc=L)):(F=sc,sc=L)):(F=sc,sc=L);jb=sc;if(jb===z){var Gc,kd,rd,pd,sd,td;Gc=F;35===c.charCodeAt(F)?(kd=da,F++):(kd=z,0===aa&&b(C));kd!==z?(rd=K(),rd!==z?(c.substr(F,10)===oc?(pd=oc,F+=10):(pd=z,0===aa&&b(Bc)),pd!==z?(sd=K(),sd!==z?(td=Z(),td!==z?Gc=kd={type:"nodes_main"}:(F=Gc,Gc=L)):(F=Gc,Gc=L)):(F=Gc,Gc=L)):(F=Gc,Gc=L)):(F=Gc,Gc=L);jb=Gc}}}}}a=jb;if(a===z){var ld;ld=p();ld!==z&&(ld={type:"textline",tokens:ld});
a=ld}}}return a}function d(){var a,d,f,g;a=F;35===c.charCodeAt(F)?(d=da,F++):(d=z,0===aa&&b(C));d!==z?(d=K(),d!==z?(c.substr(F,4)===E?(d=E,F+=4):(d=z,0===aa&&b(ca)),d!==z?(d=m(),d!==z?(d=p(),d!==z?(f=K(),f!==z?(f=P(),f!==z?(f=H(),f!==z?(f=e(),f!==z?(g=H(),g!==z?a=d={type:"elif",expression:d,group:f}:(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L)):(F=a,a=L);return a}function p(){var a,b,c,d,e,f;a=F;b=x();if(b!==z){c=[];d=F;e=K();e!==z?(f=x(),f!==z?
d=e=[e,f]:(F=d,d=L)):(F=d,d=L);for(;d!==z;)c.push(d),d=F,e=K(),e!==z?(f=x(),f!==z?d=e=[e,f]:(F=d,d=L)):(F=d,d=L);c!==z?a=b=fa(b,c):(F=a,a=L)}else F=a,a=L;return a}function x(){var a;a=n();if(a===z){var d,e,f;aa++;a=F;var h;d=F;48===c.charCodeAt(F)?(e=ka,F++):(e=z,0===aa&&b(na));if(e!==z)if(Cb.test(c.charAt(F))?(e=c.charAt(F),F++):(e=z,0===aa&&b(Ca)),e!==z){e=F;f=[];h=g();if(h!==z)for(;h!==z;)f.push(h),h=g();else f=L;f!==z&&(f=c.substring(e,F));e=f;e!==z?d=e=String(parseInt("0x"+e)):(F=d,d=L)}else F=
d,d=L;else F=d,d=L;if(d===z){var k,l;e=d=F;f=B();f!==z?(46===c.charCodeAt(F)?(h=oa,F++):(h=z,0===aa&&b(Ua)),h!==z?(k=q(),k===z&&(k=G),k!==z?(l=y(),l===z&&(l=G),l!==z?e=f=[f,h,k,l]:(F=e,e=L)):(F=e,e=L)):(F=e,e=L)):(F=e,e=L);e!==z&&(e=c.substring(d,F));d=e;d===z&&(e=d=F,46===c.charCodeAt(F)?(f=oa,F++):(f=z,0===aa&&b(Ua)),f!==z?(h=q(),h!==z?(k=y(),k===z&&(k=G),k!==z?e=f=[f,h,k]:(F=e,e=L)):(F=e,e=L)):(F=e,e=L),e!==z&&(e=c.substring(d,F)),d=e,d===z&&(e=d=F,f=B(),f!==z?(h=y(),h===z&&(h=G),h!==z?e=f=[f,
h]:(F=e,e=L)):(F=e,e=L),e!==z&&(e=c.substring(d,F)),d=e))}d!==z?(e=F,aa++,f=t(),aa--,f===z?e=fb:(F=e,e=L),e!==z?a=d:(F=a,a=L)):(F=a,a=L);aa--;a===z&&0===aa&&b(wa);if(a===z){aa++;a=F;34===c.charCodeAt(F)?(d=rb,F++):(d=z,0===aa&&b(za));if(d!==z){e=[];f=A();if(f!==z)for(;f!==z;)e.push(f),f=A();else e=L;e!==z&&(e=e.join(""));e===z&&(e=G);e!==z?(34===c.charCodeAt(F)?(f=rb,F++):(f=z,0===aa&&b(za)),f!==z?a=d=[d,e,f]:(F=a,a=L)):(F=a,a=L)}else F=a,a=L;if(a===z)if(a=F,39===c.charCodeAt(F)?(d=Tc,F++):(d=z,0===
aa&&b(xb)),d!==z){e=[];f=u();if(f!==z)for(;f!==z;)e.push(f),f=u();else e=L;e!==z&&(e=e.join(""));e===z&&(e=G);e!==z?(39===c.charCodeAt(F)?(f=Tc,F++):(f=z,0===aa&&b(xb)),f!==z?a=d=[d,e,f]:(F=a,a=L)):(F=a,a=L)}else F=a,a=L;a!==z&&(a='"'+a[1]+'"');aa--;a===z&&0===aa&&b(vc);a===z&&(aa++,c.substr(F,2)===Yb?(a=Yb,F+=2):(a=z,0===aa&&b(Db)),a===z&&(c.substr(F,2)===cc?(a=cc,F+=2):(a=z,0===aa&&b(Hc)),a===z&&(c.substr(F,2)===Eb?(a=Eb,F+=2):(a=z,0===aa&&b(Yc)),a===z&&(c.substr(F,2)===Zb?(a=Zb,F+=2):(a=z,0===
aa&&b(jb)),a===z&&(c.substr(F,2)===lc?(a=lc,F+=2):(a=z,0===aa&&b(Tb)),a===z&&(c.substr(F,2)===id?(a=id,F+=2):(a=z,0===aa&&b(Zc)),a===z&&(c.substr(F,2)===Ic?(a=Ic,F+=2):(a=z,0===aa&&b(hd)),a===z&&(c.substr(F,2)===ob?(a=ob,F+=2):(a=z,0===aa&&b(Qb)),a===z&&(c.substr(F,2)===hc?(a=hc,F+=2):(a=z,0===aa&&b(Ub)),a===z&&(c.substr(F,2)===bd?(a=bd,F+=2):(a=z,0===aa&&b(Nb)),a===z&&(c.substr(F,3)===Nc?(a=Nc,F+=3):(a=z,0===aa&&b($c)),a===z&&(c.substr(F,3)===Uc?(a=Uc,F+=3):(a=z,0===aa&&b(xc)),a===z&&(c.substr(F,
2)===mc?(a=mc,F+=2):(a=z,0===aa&&b(Vc)),a===z&&(c.substr(F,2)===Fc?(a=Fc,F+=2):(a=z,0===aa&&b(Lc)),a===z&&(c.substr(F,2)===Oc?(a=Oc,F+=2):(a=z,0===aa&&b(Pc)),a===z&&(c.substr(F,2)===yc?(a=yc,F+=2):(a=z,0===aa&&b(zc)),a===z&&(c.substr(F,2)===Wc?(a=Wc,F+=2):(a=z,0===aa&&b(od)),a===z&&(c.substr(F,2)===Fb?(a=Fb,F+=2):(a=z,0===aa&&b(sc)),a===z&&(c.substr(F,2)===Jc?(a=Jc,F+=2):(a=z,0===aa&&b(Kc)),a===z&&(c.substr(F,2)===ed?(a=ed,F+=2):(a=z,0===aa&&b(Mc)),a===z&&(123===c.charCodeAt(F)?(a=ya,F++):(a=z,0===
aa&&b(Lb)),a===z&&(125===c.charCodeAt(F)?(a=fd,F++):(a=z,0===aa&&b(Qc)),a===z&&(91===c.charCodeAt(F)?(a=Ob,F++):(a=z,0===aa&&b(sa)),a===z&&(93===c.charCodeAt(F)?(a=dc,F++):(a=z,0===aa&&b(Gb)),a===z&&(40===c.charCodeAt(F)?(a=Bb,F++):(a=z,0===aa&&b(Za)),a===z&&(41===c.charCodeAt(F)?(a=lb,F++):(a=z,0===aa&&b(qb)),a===z&&(59===c.charCodeAt(F)?(a=gd,F++):(a=z,0===aa&&b(Sa)),a===z&&(58===c.charCodeAt(F)?(a=ec,F++):(a=z,0===aa&&b(kd)),a===z&&(63===c.charCodeAt(F)?(a=Ac,F++):(a=z,0===aa&&b(jd)),a===z&&(46===
c.charCodeAt(F)?(a=oa,F++):(a=z,0===aa&&b(Ua)),a===z&&(43===c.charCodeAt(F)?(a=rd,F++):(a=z,0===aa&&b(ld)),a===z&&(45===c.charCodeAt(F)?(a=Rc,F++):(a=z,0===aa&&b(Gc)),a===z&&(42===c.charCodeAt(F)?(a=pd,F++):(a=z,0===aa&&b(vd)),a===z&&(47===c.charCodeAt(F)?(a=sd,F++):(a=z,0===aa&&b(md)),a===z&&(37===c.charCodeAt(F)?(a=xd,F++):(a=z,0===aa&&b(Bd)),a===z&&(94===c.charCodeAt(F)?(a=zd,F++):(a=z,0===aa&&b(wd)),a===z&&(38===c.charCodeAt(F)?(a=Fd,F++):(a=z,0===aa&&b(Od)),a===z&&(124===c.charCodeAt(F)?(a=Pd,
F++):(a=z,0===aa&&b(Qd)),a===z&&(126===c.charCodeAt(F)?(a=Rd,F++):(a=z,0===aa&&b(Sd)),a===z&&(33===c.charCodeAt(F)?(a=Td,F++):(a=z,0===aa&&b(Ud)),a===z&&(61===c.charCodeAt(F)?(a=Vd,F++):(a=z,0===aa&&b(Wd)),a===z&&(60===c.charCodeAt(F)?(a=ic,F++):(a=z,0===aa&&b(Sc)),a===z&&(62===c.charCodeAt(F)?(a=Ba,F++):(a=z,0===aa&&b(Ib)),a===z&&(44===c.charCodeAt(F)?(a=Id,F++):(a=z,0===aa&&b(Jd))))))))))))))))))))))))))))))))))))))))))))),aa--,a===z&&0===aa&&b(yb))}}return a}function n(){var a,d;aa++;d=a=F;aa++;
var e,f,g,h;e=F;c.substr(F,7)===ra?(f=ra,F+=7):(f=z,0===aa&&b(bb));f===z&&(c.substr(F,5)===Da?(f=Da,F+=5):(f=z,0===aa&&b(nb)),f===z&&(c.substr(F,5)===Jb?(f=Jb,F+=5):(f=z,0===aa&&b(Cc)),f===z&&(c.substr(F,6)===Vb?(f=Vb,F+=6):(f=z,0===aa&&b(ac)),f===z&&(c.substr(F,6)===pc?(f=pc,F+=6):(f=z,0===aa&&b(wb)),f===z&&(c.substr(F,3)===Mb?(f=Mb,F+=3):(f=z,0===aa&&b(Wb)),f===z&&(c.substr(F,6)===Sb?(f=Sb,F+=6):(f=z,0===aa&&b(hb)),f===z&&(c.substr(F,7)===Xb?(f=Xb,F+=7):(f=z,0===aa&&b(jc)),f===z&&(c.substr(F,8)===
Xa?(f=Xa,F+=8):(f=z,0===aa&&b(bc)),f===z&&(c.substr(F,5)===Kb?(f=Kb,F+=5):(f=z,0===aa&&b(gc)),f===z&&(c.substr(F,7)===va?(f=va,F+=7):(f=z,0===aa&&b(Oa)),f===z&&(c.substr(F,8)===R?(f=R,F+=8):(f=z,0===aa&&b(N)),f===z&&(c.substr(F,3)===Ab?(f=Ab,F+=3):(f=z,0===aa&&b(Hb)),f===z&&(c.substr(F,6)===ba?(f=ba,F+=6):(f=z,0===aa&&b(Ha)),f===z&&(c.substr(F,6)===Ja?(f=Ja,F+=6):(f=z,0===aa&&b(ab))))))))))))))));f!==z?(g=F,aa++,h=w(),aa--,h===z?g=fb:(F=g,g=L),g!==z?e=f=[f,g]:(F=e,e=L)):(F=e,e=L);aa--;e===z?d=fb:
(F=d,d=L);if(d!==z){aa++;d=F;e=t();if(e!==z){f=[];for(g=w();g!==z;)f.push(g),g=w();f!==z?d=e+=f.join(""):(F=d,d=L)}else F=d,d=L;aa--;d===z&&0===aa&&b(Qa);d!==z?a=d:(F=a,a=L)}else F=a,a=L;aa--;a===z&&0===aa&&b(Qa);return a}function t(){var a;xa.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===aa&&b(gb));a===z&&(36===c.charCodeAt(F)?(a=mb,F++):(a=z,0===aa&&b(ta)),a===z&&(95===c.charCodeAt(F)?(a=qa,F++):(a=z,0===aa&&b(vb))));return a}function w(){var a;a=t();a===z&&(a=s());return a}function B(){var a,
d,e;48===c.charCodeAt(F)?(a=ka,F++):(a=z,0===aa&&b(na));a===z&&(a=F,db.test(c.charAt(F))?(d=c.charAt(F),F++):(d=z,0===aa&&b($a)),d!==z?(e=q(),e===z&&(e=G),e!==z?a=d=[d,e]:(F=a,a=L)):(F=a,a=L));return a}function q(){var a,b;a=[];b=s();if(b!==z)for(;b!==z;)a.push(b),b=s();else a=L;return a}function s(){var a;cb.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===aa&&b(Pa));return a}function y(){var a,d,e;a=F;Ga.test(c.charAt(F))?(d=c.charAt(F),F++):(d=z,0===aa&&b(Ra));if(d!==z){var f,g;e=F;ib.test(c.charAt(F))?
(f=c.charAt(F),F++):(f=z,0===aa&&b(Xc));f===z&&(f=G);f!==z?(g=q(),g!==z?e=f=[f,g]:(F=e,e=L)):(F=e,e=L);e!==z?a=d=[d,e]:(F=a,a=L)}else F=a,a=L;return a}function g(){var a;Dc.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===aa&&b(dd));return a}function A(){var a,d,e;d=a=F;aa++;34===c.charCodeAt(F)?(e=rb,F++):(e=z,0===aa&&b(za));e===z&&(92===c.charCodeAt(F)?(e=qc,F++):(e=z,0===aa&&b(Va)),e===z&&(e=U()));aa--;e===z?d=fb:(F=d,d=L);d!==z?(e=T(),e!==z?a=e:(F=a,a=L)):(F=a,a=L);a===z&&(a=F,92===c.charCodeAt(F)?
(d=qc,F++):(d=z,0===aa&&b(Va)),d!==z?(e=I(),e!==z?a=e:(F=a,a=L)):(F=a,a=L),a===z&&(a=S()));return a}function u(){var a,d,e;d=a=F;aa++;39===c.charCodeAt(F)?(e=Tc,F++):(e=z,0===aa&&b(xb));e===z&&(92===c.charCodeAt(F)?(e=qc,F++):(e=z,0===aa&&b(Va)),e===z&&(e=U()));aa--;e===z?d=fb:(F=d,d=L);d!==z?(e=T(),e!==z?a=e:(F=a,a=L)):(F=a,a=L);a===z&&(a=F,92===c.charCodeAt(F)?(d=qc,F++):(d=z,0===aa&&b(Va)),d!==z?(e=I(),e!==z?a=e:(F=a,a=L)):(F=a,a=L),a===z&&(a=S()));return a}function S(){var a,d;a=F;92===c.charCodeAt(F)?
(d=qc,F++):(d=z,0===aa&&b(Va));d!==z?(d=Z(),d!==z?a=d:(F=a,a=L)):(F=a,a=L);return a}function I(){var a,d,e;a=v();a===z&&(d=a=F,aa++,e=v(),e===z&&(e=s(),e===z&&(120===c.charCodeAt(F)?(e=eb,F++):(e=z,0===aa&&b(Ya)),e===z&&(117===c.charCodeAt(F)?(e=rc,F++):(e=z,0===aa&&b(wc))))),aa--,e===z?d=fb:(F=d,d=L),d===z&&(d=U()),d!==z?(d=T(),d!==z?a=d:(F=a,a=L)):(F=a,a=L));if(a===z&&(a=F,48===c.charCodeAt(F)?(d=ka,F++):(d=z,0===aa&&b(na)),d!==z?(d=F,aa++,e=s(),aa--,e===z?d=fb:(F=d,d=L),d!==z?a="\x00":(F=a,a=L)):
(F=a,a=L),a===z)){var f,h;a=F;120===c.charCodeAt(F)?(d=eb,F++):(d=z,0===aa&&b(Ya));d!==z?(e=d=F,f=g(),f!==z?(h=g(),h!==z?e=f=[f,h]:(F=e,e=L)):(F=e,e=L),e!==z&&(e=c.substring(d,F)),d=e,d!==z?a=d=String.fromCharCode(parseInt("0x"+d)):(F=a,a=L)):(F=a,a=L)}return a}function v(){var a;Ec.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===aa&&b(kc));a!==z&&(a=a.replace("b","\b").replace("f","\f").replace("n","\n").replace("r","\r").replace("t","\t").replace("v","\x0B"));return a}function K(){var a,b;a=[];b=
D();b===z&&(b=S(),b===z&&(b=M(),b===z&&(b=Q())));for(;b!==z;)a.push(b),b=D(),b===z&&(b=S(),b===z&&(b=M(),b===z&&(b=Q())));return a}function m(){var a,b;a=[];b=D();b===z&&(b=S(),b===z&&(b=M(),b===z&&(b=Q())));if(b!==z)for(;b!==z;)a.push(b),b=D(),b===z&&(b=S(),b===z&&(b=M(),b===z&&(b=Q())));else a=L;return a}function H(){var a,b;a=[];b=D();b===z&&(b=S(),b===z&&(b=P(),b===z&&(b=V())));for(;b!==z;)a.push(b),b=D(),b===z&&(b=S(),b===z&&(b=P(),b===z&&(b=V())));return a}function D(){var a;aa++;Xd.test(c.charAt(F))?
(a=c.charAt(F),F++):(a=z,0===aa&&b(Yd));aa--;a===z&&0===aa&&b(Zd);return a}function U(){var a;$d.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===aa&&b(ae));return a}function P(){var a;aa++;10===c.charCodeAt(F)?(a=be,F++):(a=z,0===aa&&b(ce));a===z&&(c.substr(F,2)===Kd?(a=Kd,F+=2):(a=z,0===aa&&b(de)),a===z&&(13===c.charCodeAt(F)?(a=ee,F++):(a=z,0===aa&&b(fe))));aa--;a===z&&0===aa&&b(ge);return a}function Z(){var a;a=P();if(a===z){var d;a=F;aa++;c.length>F?(d=c.charAt(F),F++):(d=z,0===aa&&b(Ld));aa--;
d===z?a=fb:(F=a,a=L)}return a}function V(){var a;aa++;var d,e,f,g,h;a=F;c.substr(F,2)===Dd?(d=Dd,F+=2):(d=z,0===aa&&b(Md));if(d!==z){e=[];g=f=F;aa++;c.substr(F,2)===td?(h=td,F+=2):(h=z,0===aa&&b(yd));aa--;h===z?g=fb:(F=g,g=L);g!==z?(h=T(),h!==z?f=g=[g,h]:(F=f,f=L)):(F=f,f=L);for(;f!==z;)e.push(f),g=f=F,aa++,c.substr(F,2)===td?(h=td,F+=2):(h=z,0===aa&&b(yd)),aa--,h===z?g=fb:(F=g,g=L),g!==z?(h=T(),h!==z?f=g=[g,h]:(F=f,f=L)):(F=f,f=L);e!==z?(c.substr(F,2)===td?(f=td,F+=2):(f=z,0===aa&&b(yd)),f!==z?a=
d=[d,e,f]:(F=a,a=L)):(F=a,a=L)}else F=a,a=L;a===z&&(a=Q());aa--;a===z&&0===aa&&b(he);return a}function M(){var a,d,e,f,g,h;a=F;c.substr(F,2)===Dd?(d=Dd,F+=2):(d=z,0===aa&&b(Md));if(d!==z){e=[];g=f=F;aa++;c.substr(F,2)===td?(h=td,F+=2):(h=z,0===aa&&b(yd));h===z&&(h=U());aa--;h===z?g=fb:(F=g,g=L);g!==z?(h=T(),h!==z?f=g=[g,h]:(F=f,f=L)):(F=f,f=L);for(;f!==z;)e.push(f),g=f=F,aa++,c.substr(F,2)===td?(h=td,F+=2):(h=z,0===aa&&b(yd)),h===z&&(h=U()),aa--,h===z?g=fb:(F=g,g=L),g!==z?(h=T(),h!==z?f=g=[g,h]:(F=
f,f=L)):(F=f,f=L);e!==z?(c.substr(F,2)===td?(f=td,F+=2):(f=z,0===aa&&b(yd)),f!==z?a=d=[d,e,f]:(F=a,a=L)):(F=a,a=L)}else F=a,a=L;return a}function Q(){var a,d,e,f,g,h;a=F;c.substr(F,2)===Nd?(d=Nd,F+=2):(d=z,0===aa&&b(ie));if(d!==z){e=[];g=f=F;aa++;h=U();aa--;h===z?g=fb:(F=g,g=L);g!==z?(h=T(),h!==z?f=g=[g,h]:(F=f,f=L)):(F=f,f=L);for(;f!==z;)e.push(f),g=f=F,aa++,h=U(),aa--,h===z?g=fb:(F=g,g=L),g!==z?(h=T(),h!==z?f=g=[g,h]:(F=f,f=L)):(F=f,f=L);e!==z?a=d=[d,e]:(F=a,a=L)}else F=a,a=L;return a}function T(){var a;
c.length>F?(a=c.charAt(F),F++):(a=z,0===aa&&b(Ld));return a}var X=1<arguments.length?arguments[1]:{},z={},ia={start:l},W=l,L=z,G=null,fa=function(a,b){for(var c=[a],d=0;d<b.length;d++)c.push(b[d][1]);return c},da="#",C={type:"literal",value:"#",description:'"#"'},J="if",ha={type:"literal",value:"if",description:'"if"'},pa="ifdef",la={type:"literal",value:"ifdef",description:'"ifdef"'},Y="ifndef",ja={type:"literal",value:"ifndef",description:'"ifndef"'},E="elif",ca={type:"literal",value:"elif",description:'"elif"'},
ua="else",ea={type:"literal",value:"else",description:'"else"'},ma="endif",Aa={type:"literal",value:"endif",description:'"endif"'},O="include",Ea={type:"literal",value:"include",description:'"include"'},ba="import",Ha={type:"literal",value:"import",description:'"import"'},Ja="export",ab={type:"literal",value:"export",description:'"export"'},Ka="define",zb={type:"literal",value:"define",description:'"define"'},Ab="var",Hb={type:"literal",value:"var",description:'"var"'},Bb="(",Za={type:"literal",value:"(",
description:'"("'},lb=")",qb={type:"literal",value:")",description:'")"'},tb="error",kb={type:"literal",value:"error",description:'"error"'},Na="line",La={type:"literal",value:"line",description:'"line"'},Fa="pragma",Ma={type:"literal",value:"pragma",description:'"pragma"'},Ia="undef",Ta={type:"literal",value:"undef",description:'"undef"'},Wa="warning",tc={type:"literal",value:"warning",description:'"warning"'},pb="extension",uc={type:"literal",value:"extension",description:'"extension"'},sb="node",
Rb={type:"literal",value:"node",description:'"node"'},ub="endnode",ud={type:"literal",value:"endnode",description:'"endnode"'},nd="node_in",fc={type:"literal",value:"node_in",description:'"node_in"'},qd="node_out",ad={type:"literal",value:"node_out",description:'"node_out"'},nc="node_param",Pb={type:"literal",value:"node_param",description:'"node_param"'},$b="nodes_global",cd={type:"literal",value:"nodes_global",description:'"nodes_global"'},oc="nodes_main",Bc={type:"literal",value:"nodes_main",description:'"nodes_main"'},
ic="<",Sc={type:"literal",value:"<",description:'"<"'},Ba=">",Ib={type:"literal",value:">",description:'">"'},rb='"',za={type:"literal",value:'"',description:'"\\""'},fb=void 0,$=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c][1];return b},Qa={type:"other",description:"identifier"},mb="$",ta={type:"literal",value:"$",description:'"$"'},qa="_",vb={type:"literal",value:"_",description:'"_"'},xa=/^[a-zA-Z]/,gb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},ra="#define",bb={type:"literal",
value:"#define",description:'"#define"'},Da="#elif",nb={type:"literal",value:"#elif",description:'"#elif"'},Jb="#else",Cc={type:"literal",value:"#else",description:'"#else"'},Vb="#endif",ac={type:"literal",value:"#endif",description:'"#endif"'},pc="#error",wb={type:"literal",value:"#error",description:'"#error"'},Mb="#if",Wb={type:"literal",value:"#if",description:'"#if"'},Sb="#ifdef",hb={type:"literal",value:"#ifdef",description:'"#ifdef"'},Xb="#ifndef",jc={type:"literal",value:"#ifndef",description:'"#ifndef"'},
Xa="#include",bc={type:"literal",value:"#include",description:'"#include"'},Kb="#line",gc={type:"literal",value:"#line",description:'"#line"'},va="#pragma",Oa={type:"literal",value:"#pragma",description:'"#pragma"'},R="#warning",N={type:"literal",value:"#warning",description:'"#warning"'},wa={type:"other",description:"number"},oa=".",Ua={type:"literal",value:".",description:'"."'},ka="0",na={type:"literal",value:"0",description:'"0"'},Cb=/^[xX]/,Ca={type:"class",value:"[xX]",description:"[xX]"},cb=
/^[0-9]/,Pa={type:"class",value:"[0-9]",description:"[0-9]"},db=/^[1-9]/,$a={type:"class",value:"[1-9]",description:"[1-9]"},Ga=/^[eE]/,Ra={type:"class",value:"[eE]",description:"[eE]"},ib=/^[\-+]/,Xc={type:"class",value:"[\\-+]",description:"[\\-+]"},Dc=/^[0-9a-fA-F]/,dd={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},vc={type:"other",description:"string"},Tc="'",xb={type:"literal",value:"'",description:'"\'"'},qc="\\",Va={type:"literal",value:"\\",description:'"\\\\"'},Ec=/^['"\\bfnrtv]/,
kc={type:"class",value:"['\"\\\\bfnrtv]",description:"['\"\\\\bfnrtv]"},eb="x",Ya={type:"literal",value:"x",description:'"x"'},rc="u",wc={type:"literal",value:"u",description:'"u"'},yb={type:"other",description:"punctuation"},Yb="+=",Db={type:"literal",value:"+=",description:'"+="'},cc="-=",Hc={type:"literal",value:"-=",description:'"-="'},Eb="*=",Yc={type:"literal",value:"*=",description:'"*="'},Zb="/=",jb={type:"literal",value:"/=",description:'"/="'},lc="%=",Tb={type:"literal",value:"%=",description:'"%="'},
id="^=",Zc={type:"literal",value:"^=",description:'"^="'},Ic="&=",hd={type:"literal",value:"&=",description:'"&="'},ob="|=",Qb={type:"literal",value:"|=",description:'"|="'},hc="<<",Ub={type:"literal",value:"<<",description:'"<<"'},bd=">>",Nb={type:"literal",value:">>",description:'">>"'},Nc="<<=",$c={type:"literal",value:"<<=",description:'"<<="'},Uc=">>=",xc={type:"literal",value:">>=",description:'">>="'},mc="==",Vc={type:"literal",value:"==",description:'"=="'},Fc="!=",Lc={type:"literal",value:"!=",
description:'"!="'},Oc="<=",Pc={type:"literal",value:"<=",description:'"<="'},yc=">=",zc={type:"literal",value:">=",description:'">="'},Wc="&&",od={type:"literal",value:"&&",description:'"&&"'},Fb="||",sc={type:"literal",value:"||",description:'"||"'},Jc="++",Kc={type:"literal",value:"++",description:'"++"'},ed="--",Mc={type:"literal",value:"--",description:'"--"'},ya="{",Lb={type:"literal",value:"{",description:'"{"'},fd="}",Qc={type:"literal",value:"}",description:'"}"'},Ob="[",sa={type:"literal",
value:"[",description:'"["'},dc="]",Gb={type:"literal",value:"]",description:'"]"'},gd=";",Sa={type:"literal",value:";",description:'";"'},ec=":",kd={type:"literal",value:":",description:'":"'},Ac="?",jd={type:"literal",value:"?",description:'"?"'},rd="+",ld={type:"literal",value:"+",description:'"+"'},Rc="-",Gc={type:"literal",value:"-",description:'"-"'},pd="*",vd={type:"literal",value:"*",description:'"*"'},sd="/",md={type:"literal",value:"/",description:'"/"'},xd="%",Bd={type:"literal",value:"%",
description:'"%"'},zd="^",wd={type:"literal",value:"^",description:'"^"'},Fd="&",Od={type:"literal",value:"&",description:'"&"'},Pd="|",Qd={type:"literal",value:"|",description:'"|"'},Rd="~",Sd={type:"literal",value:"~",description:'"~"'},Td="!",Ud={type:"literal",value:"!",description:'"!"'},Vd="=",Wd={type:"literal",value:"=",description:'"="'},Id=",",Jd={type:"literal",value:",",description:'","'},Zd={type:"other",description:"whitespace"},Xd=/^[\t\x0B\f ]/,Yd={type:"class",value:"[\\t\\x0B\\f ]",
description:"[\\t\\x0B\\f ]"},$d=/^[\n\r]/,ae={type:"class",value:"[\\n\\r]",description:"[\\n\\r]"},ge={type:"other",description:"end of line"},be="\n",ce={type:"literal",value:"\n",description:'"\\n"'},Kd="\r\n",de={type:"literal",value:"\r\n",description:'"\\r\\n"'},ee="\r",fe={type:"literal",value:"\r",description:'"\\r"'},he={type:"other",description:"comment"},Dd="/*",Md={type:"literal",value:"/*",description:'"/*"'},td="*/",yd={type:"literal",value:"*/",description:'"*/"'},Nd="//",ie={type:"literal",
value:"//",description:'"//"'},Ld={type:"any",description:"any character"},F=0,Ad=0,Gd={line:1,column:1,seenCR:!1},Cd=0,Hd=[],aa=0,Ed;if("startRule"in X){if(!(X.startRule in ia))throw Error("Can't start parsing from rule \""+X.startRule+'".');W=ia[X.startRule]}Ed=W();if(Ed!==z&&F===c.length)return Ed;Ed!==z&&F<c.length&&b({type:"end",description:"end of input"});throw function(b,d,e){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:
0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function k(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var l=f(e),m=e<c.length?c.charAt(e):null;null!==d&&g(d);return new a(null!==b?b:k(d,m),d,m,e,l.line,l.column)}(null,Hd,Cd);}}}()};b4w.module.__md5=function(a,p){function h(a,d){var e=a[0],h=a[1],n=a[2],p=a[3],e=f(e,h,n,p,d[0],7,-680876936),p=f(p,e,h,n,d[1],12,-389564586),n=f(n,p,e,h,d[2],17,606105819),h=f(h,n,p,e,d[3],22,-1044525330),e=f(e,h,n,p,d[4],7,-176418897),p=f(p,e,h,n,d[5],12,1200080426),n=f(n,p,e,h,d[6],17,-1473231341),h=f(h,n,p,e,d[7],22,-45705983),e=f(e,h,n,p,d[8],7,1770035416),p=f(p,e,h,n,d[9],12,-1958414417),n=f(n,p,e,h,d[10],17,-42063),h=f(h,n,p,e,d[11],22,-1990404162),e=f(e,h,n,p,d[12],7,1804603682),p=f(p,e,h,
n,d[13],12,-40341101),n=f(n,p,e,h,d[14],17,-1502002290),h=f(h,n,p,e,d[15],22,1236535329),e=b(e,h,n,p,d[1],5,-165796510),p=b(p,e,h,n,d[6],9,-1069501632),n=b(n,p,e,h,d[11],14,643717713),h=b(h,n,p,e,d[0],20,-373897302),e=b(e,h,n,p,d[5],5,-701558691),p=b(p,e,h,n,d[10],9,38016083),n=b(n,p,e,h,d[15],14,-660478335),h=b(h,n,p,e,d[4],20,-405537848),e=b(e,h,n,p,d[9],5,568446438),p=b(p,e,h,n,d[14],9,-1019803690),n=b(n,p,e,h,d[3],14,-187363961),h=b(h,n,p,e,d[8],20,1163531501),e=b(e,h,n,p,d[13],5,-1444681467),
p=b(p,e,h,n,d[2],9,-51403784),n=b(n,p,e,h,d[7],14,1735328473),h=b(h,n,p,e,d[12],20,-1926607734),e=c(h^n^p,e,h,d[5],4,-378558),p=c(e^h^n,p,e,d[8],11,-2022574463),n=c(p^e^h,n,p,d[11],16,1839030562),h=c(n^p^e,h,n,d[14],23,-35309556),e=c(h^n^p,e,h,d[1],4,-1530992060),p=c(e^h^n,p,e,d[4],11,1272893353),n=c(p^e^h,n,p,d[7],16,-155497632),h=c(n^p^e,h,n,d[10],23,-1094730640),e=c(h^n^p,e,h,d[13],4,681279174),p=c(e^h^n,p,e,d[0],11,-358537222),n=c(p^e^h,n,p,d[3],16,-722521979),h=c(n^p^e,h,n,d[6],23,76029189),
e=c(h^n^p,e,h,d[9],4,-640364487),p=c(e^h^n,p,e,d[12],11,-421815835),n=c(p^e^h,n,p,d[15],16,530742520),h=c(n^p^e,h,n,d[2],23,-995338651),e=l(e,h,n,p,d[0],6,-198630844),p=l(p,e,h,n,d[7],10,1126891415),n=l(n,p,e,h,d[14],15,-1416354905),h=l(h,n,p,e,d[5],21,-57434055),e=l(e,h,n,p,d[12],6,1700485571),p=l(p,e,h,n,d[3],10,-1894986606),n=l(n,p,e,h,d[10],15,-1051523),h=l(h,n,p,e,d[1],21,-2054922799),e=l(e,h,n,p,d[8],6,1873313359),p=l(p,e,h,n,d[15],10,-30611744),n=l(n,p,e,h,d[6],15,-1560198380),h=l(h,n,p,e,
d[13],21,1309151649),e=l(e,h,n,p,d[4],6,-145523070),p=l(p,e,h,n,d[11],10,-1120210379),n=l(n,p,e,h,d[2],15,718787259),h=l(h,n,p,e,d[9],21,-343485551);a[0]=e+a[0]&4294967295;a[1]=h+a[1]&4294967295;a[2]=n+a[2]&4294967295;a[3]=p+a[3]&4294967295}function c(a,b,c,e,f,h){b=(b+a&4294967295)+(e+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function f(a,b,e,f,h,l,p){return c(b&e|~b&f,a,b,h,l,p)}function b(a,b,e,f,h,l,p){return c(b&f|e&~f,a,b,h,l,p)}function l(a,b,e,f,h,l,p){return c(e^(b|~f),
a,b,h,l,p)}var e="0123456789abcdef".split("");a.hexdigest=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var f;for(f=64;f<=b.length;f+=64){for(var l=b.substring(f-64,f),p=[],w=void 0,w=0;64>w;w+=4)p[w>>2]=l.charCodeAt(w)+(l.charCodeAt(w+1)<<8)+(l.charCodeAt(w+2)<<16)+(l.charCodeAt(w+3)<<24);h(a,p)}b=b.substring(f-64);l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(f=0;f<b.length;f++)l[f>>2]|=b.charCodeAt(f)<<(f%4<<3);l[f>>2]|=128<<(f%4<<3);if(55<f)for(h(a,l),f=0;16>f;f++)l[f]=
0;l[14]=8*c;h(a,l);for(b=0;b<a.length;b++){c=a;f=b;l=a[b];p="";for(w=0;4>w;w++)p+=e[l>>8*w+4&15]+e[l>>8*w&15];c[f]=p}return a.join("")}};b4w.module.animation=function(a,p){var h=p("__animation"),c=p("__constraints");p("__physics");var f=p("__print"),b=p("__util");a.SLOT_0=h.SLOT_0;a.SLOT_1=h.SLOT_1;a.SLOT_2=h.SLOT_2;a.SLOT_3=h.SLOT_3;a.SLOT_4=h.SLOT_4;a.SLOT_5=h.SLOT_5;a.SLOT_6=h.SLOT_6;a.SLOT_7=h.SLOT_7;a.SLOT_ALL=h.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=h.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=h.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=h.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=h.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
h.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=h.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=h.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=h.AB_CYCLIC;a.AB_FINISH_RESET=h.AB_FINISH_RESET;a.AB_FINISH_STOP=h.AB_FINISH_STOP;var l=new Float32Array(4);a.is_animated=function(a){return h.is_animated(a)};a.get_actions=function(){for(var a=[],b=h.get_all_actions(),c=0;c<b.length;c++)a.push(h.strip_baked_suffix(b[c].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=
function(a){return h.is_animatable(a)?h.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!h.is_animated(a))return null;b=b||h.SLOT_0;return h.get_current_animation_name(a,b)};a.apply=function(a,b,c){if(c>h.SLOT_7)f.error("Can't apply animation to slot "+c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||h.SLOT_0;if(h.is_animated(a)){var l=h.get_slot_num_by_anim(a,b);if(-1!=l&&l!=c){f.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+
l+'").');return}}h.apply(a,b,c)}};a.remove=function(a){h.remove(a)};a.remove_slot_animation=function(a,b){h.is_animated(a)&&(b=b||h.SLOT_0,h.remove_slot_animation(a,b))};a.apply_def=function(a){h.apply_def(a)};a.play=function(a,b,c){h.is_animated(a)?(c=c||h.SLOT_0,h.play(a,b,c),h.update_object_animation(a,0,c)):f.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){h.is_animated(a)&&(b=b||h.SLOT_0,h.stop(a,b))};a.is_play=function(a,b){if(!h.is_animated(a))return!1;b=b||h.SLOT_0;
return h.is_play(a,b)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.set_current_frame_float(a,b,c),h.update_object_animation(a,0,c))};a.get_frame=function(a,b){if(!h.is_animated(a))return 0;b=b||h.SLOT_0;return h.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!h.is_animated(a))return 0;
b=b||h.SLOT_0;return h.get_speed(a,b)};a.get_frame_range=function(a,b){if(h.is_animated(a)){b=b||h.SLOT_0;var c=a._anim_slots[b];if(c)return[c.start,c.start+c.length]}return null};a.get_anim_start_frame=function(a,b){return h.is_animated(a)?(b=b||h.SLOT_0,h.get_anim_start_frame(a,b)):-1};a.get_anim_length=function(a,b){return h.is_animated(a)?(b=b||h.SLOT_0,h.get_anim_length(a,b)):-1};a.cyclic=function(b,c,d){a.set_behavior(b,c?h.AB_CYCLIC:h.AB_FINISH_RESET,d)};a.is_cyclic=function(a,b){if(!h.is_animated(a))return!1;
b=b||h.SLOT_0;return h.is_cyclic(a,b)};a.set_behavior=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!h.is_animated(a))return null;b=b||h.SLOT_0;return h.get_behavior(a,b)};a.apply_smoothing=function(a,b,c,f){f=f||h.SLOT_0;h.is_animated(a)&&h.apply_smoothing(a,b,c,f)};a.update_object_animation=function(a,b,c){h.is_animated(a)&&(c=c||h.SLOT_0,h.update_object_animation(a,b||0,c))};a.frame_to_sec=function(a){return h.frame_to_sec(a)};a.get_bone_translation=
function(a,f,d){if(!b.is_armature(a))return null;d||(d=new Float32Array(3));c.get_bone_pose(a,f,!1,l,null);d[0]=l[0];d[1]=l[1];d[2]=l[2];return d};a.get_first_armature_object=function(a){return b.is_mesh(a)?h.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return h.is_animated(a)&&b?h.get_slot_num_by_anim(a,b):null};a.get_anim_name=function(a,b){if(!h.is_animated(a))return null;b=b||h.SLOT_0;return h.get_anim_by_slot_num(a,b)};a.get_anim_type=function(a,b){return h.is_animated(a)?
h.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return h.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a._render.anim_mix_factor};a.set_skel_mix_factor=function(a,c,d){b.is_armature(a)?(c=Math.min(Math.max(c,0),1),a._render.anim_mix_factor!=c&&h.set_skel_mix_factor(a,c,d||0)):f.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,p){var h=p("__assets");a.AT_ARRAYBUFFER=h.AT_ARRAYBUFFER;a.AT_JSON=h.AT_JSON;a.AT_TEXT=h.AT_TEXT;a.AT_AUDIOBUFFER=h.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=h.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=h.AT_AUDIO_ELEMENT;a.enqueue=function(a,f,b){h.enqueue(a,f,b)}};b4w.module.material=function(a,p){function h(a,b){for(var c=a._batches,d=0;d<c.length;d++){var e=c[d];if(-1<e.material_names.indexOf(b))return"MAIN"==e.type}return!1}function c(a,c){var d=b.find_batch_material(a,c,"MAIN");return Boolean(d&&d.specular_params[0])}function f(a,c){var d=b.find_batch_material(a,c,"MAIN");return Boolean(d&&d.specular_params[1])}var b=p("__batch"),l=p("__config"),e=p("__print"),k=p("__shaders"),d=p("__util");p("vec4");var r=l.defaults,x="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");
a.max_bones=function(){e.error("max_bones() deprecated, return default value");return r.max_bones};a.set_max_bones=function(a){e.error("set_max_bones() deprecated")};a.set_batch_param=function(){e.error("set_batch_param() deprecated")};a.inherit_material=function(a,c,f,h){if(d.is_dynamic_mesh(f)&&d.is_dynamic_mesh(a)){for(var k=["MAIN","DEPTH","COLOR_ID"],l=!1,p=0;p<k.length;p++){var g=k[p],r=b.find_batch_material(a,c,g),u=b.find_batch_material(f,h,g);if(r&&u)for(l=!0,"MAIN"==g&&(u.diffuse_color.set(r.diffuse_color),
u.diffuse_intensity=r.diffuse_intensity,u.specular_color.set(r.specular_color),u.specular_params.set(r.specular_params),u.emit=r.emit,u.ambient=r.ambient,u.ambient=r.ambient,u.diffuse_color_factor=r.diffuse_color_factor,u.alpha_factor=r.alpha_factor),g=0;g<u.texture_names.length;g++){var S=u.texture_names[g];if(-1!==x.indexOf(S)){var I=r.texture_names.indexOf(S);if(-1!==I&&(u.textures[g]=r.textures[I],u.childs))for(g=0;g<u.childs.length;g++){var v=u.childs[g],K=v.texture_names.indexOf(S);-1!==K&&
(v.textures[K]=r.textures[I])}}}}l||e.error("Wrong objects for inheriting material!")}else e.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,c,d){(a=b.find_batch_material(a,c,"MAIN"))?a.diffuse_color.set(d):e.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d){var f=Array(4);f[0]=d.diffuse_color[0];
f[1]=d.diffuse_color[1];f[2]=d.diffuse_color[2];f[3]=d.diffuse_color[3];return f}e.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,c,d){(a=b.find_batch_material(a,c,"MAIN"))?a.diffuse_intensity=d:e.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d)return d.diffuse_intensity;e.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,c,d){(a=b.find_batch_material(a,
c,"MAIN"))?a.specular_color.set(d):e.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d){var f=Array(3);f[0]=d.specular_color[0];f[1]=d.specular_color[1];f[2]=d.specular_color[2];return f}e.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,d,f){c(a,d)||e.error('Property "specular_intensity" is missing!');b.find_batch_material(a,d,"MAIN").specular_params[0]=f};a.get_specular_intensity=
function(a,d){c(a,d)||e.error('Property "specular_intensity" is missing!');return b.find_batch_material(a,d,"MAIN").specular_params[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,c,d){f(a,c)||e.error('Property "specular_hardness" is missing!');b.find_batch_material(a,c,"MAIN").specular_params[1]=d};a.get_specular_hardness=function(a,c){f(a,c)||e.error('Property "specular_hardness" is missing!');return b.find_batch_material(a,c,"MAIN").specular_params[1]};a.check_specular_hardness=
f;a.set_emit_factor=function(a,c,d){(a=b.find_batch_material(a,c,"MAIN"))?a.emit=d:e.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d)return d.emit;e.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,c,d){(a=b.find_batch_material(a,c,"MAIN"))?a.ambient=d:e.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d)return d.ambient;
e.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,c,d){(a=b.find_batch_material(a,c,"MAIN"))?a.diffuse_color_factor=d:e.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d)return d.diffuse_color_factor;e.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,c,d){(a=b.find_batch_material(a,c,"MAIN"))?a.alpha_factor=alpha_factor:e.error('Couldn\'t set property "alpha_factor"!')};
a.get_alpha_factor=function(a,c){var d=b.find_batch_material(a,c,"MAIN");if(d)return d.alpha_factor;e.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,c){if(!a||!c)return e.error("B4W Error: missing arguments in get_material_params"),null;if(!h(a,c))return null;var d=b.find_batch_material(a,c,"MAIN");if(!d)return null;var f={};"MAIN"==d.type&&(f.reflect_factor=d.reflect_factor,f.fresnel=d.fresnel_params[2],f.fresnel_factor=5*(1-d.fresnel_params[3]),f.parallax_scale=
d.parallax_scale,f.parallax_steps=b.get_batch_directive(d,"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,c){if(!a||!c)return e.error("B4W Error: missing arguments in get_water_material_params"),null;if(!h(a,c))return null;var d=b.find_batch_material(a,c,"MAIN");if(!d||!d.water)return null;if(!d)return e.warn("B4W Warning: material not found"),null;var f={};if("MAIN"==d.type){if(r.shore_distance){var k=f.shallow_water_col=Array(3);k[0]=d.shallow_water_col[0];k[1]=d.shallow_water_col[1];
k[2]=d.shallow_water_col[2];k=f.shore_water_col=Array(3);k[0]=d.shore_water_col[0];k[1]=d.shore_water_col[1];k[2]=d.shore_water_col[2];f.shallow_water_col_fac=d.shallow_water_col_fac;f.shore_water_col_fac=d.shore_water_col_fac}f.foam_factor=d.foam_factor;f.absorb_factor=b.get_batch_directive(d,"ABSORB")[1];f.sss_strength=b.get_batch_directive(d,"SSS_STRENGTH")[1];f.sss_width=b.get_batch_directive(d,"SSS_WIDTH")[1];f.dst_noise_scale0=b.get_batch_directive(d,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=
b.get_batch_directive(d,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=b.get_batch_directive(d,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=b.get_batch_directive(d,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=b.get_batch_directive(d,"DIR_MIN_SHR_FAC")[1];f.dir_freq=b.get_batch_directive(d,"DIR_FREQ")[1];f.dir_noise_scale=b.get_batch_directive(d,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=b.get_batch_directive(d,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=b.get_batch_directive(d,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=
b.get_batch_directive(d,"DST_MIN_FAC")[1];f.waves_hor_fac=b.get_batch_directive(d,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,c,d){if(a&&c&&d){if(!h(a,c))return e.warn("B4W Warning: setting material params is not possible"),null;a=b.find_batch_material(a,c,"MAIN");a?"MAIN"==a.type&&("number"==typeof d.material_reflectivity&&(a.reflect_factor=d.material_reflectivity),"number"==typeof d.material_fresnel&&(a.fresnel_params[2]=d.material_fresnel),"number"==typeof d.material_fresnel_factor&&
(a.fresnel_params[3]=1-d.material_fresnel_factor/5),"number"==typeof d.material_parallax_scale&&(a.parallax_scale=d.material_parallax_scale),"number"==typeof d.material_parallax_steps&&(d=k.glsl_value(parseFloat(d.material_parallax_steps)),b.set_batch_directive(a,"PARALLAX_STEPS",d),b.update_shader(a,!0))):e.warn("B4W Warning: material not found")}else e.error("B4W Error: missing arguments in set_material_params")};a.set_water_material_params=function(a,c,d){if(!a||!c||!d)return e.error("B4W Error: missing arguments in set_water_material_params"),
null;if(!h(a,c))return e.warn("B4W Warning: setting water material params is not possible"),null;a=b.find_batch_material(a,c,"MAIN");if(!a)return e.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(r.shore_distance&&("object"==typeof d.shallow_water_col&&a.shallow_water_col.set(d.shallow_water_col),"number"==typeof d.shallow_water_col_fac&&(a.shallow_water_col_fac=d.shallow_water_col_fac),"object"==typeof d.shore_water_col&&a.shore_water_col.set(d.shore_water_col),"number"==typeof d.shore_water_col_fac&&
(a.shore_water_col_fac=d.shore_water_col_fac)),r.shore_smoothing&&a.water_shore_smoothing&&("boolean"==typeof d.shore_smoothing&&(d.shore_smoothing?b.set_batch_directive(a,"SHORE_SMOOTHING",1):b.set_batch_directive(a,"SHORE_SMOOTHING",0)),"number"==typeof d.absorb_factor&&(c=k.glsl_value(parseFloat(d.absorb_factor)),b.set_batch_directive(a,"ABSORB",c))),"number"==typeof d.foam_factor&&r.foam&&(a.foam_factor=d.foam_factor),r.water_dynamic&&a.water_dynamic&&("boolean"==typeof d.water_dynamic&&(d.water_dynamic?
b.set_batch_directive(a,"DYNAMIC",1):b.set_batch_directive(a,"DYNAMIC",0)),"number"==typeof d.waves_height&&(c=k.glsl_value(parseFloat(d.waves_height)),b.set_batch_directive(a,"WAVES_HEIGHT",c)),"number"==typeof d.waves_length&&(c=k.glsl_value(parseFloat(d.waves_length)),b.set_batch_directive(a,"WAVES_LENGTH",c)),"number"==typeof d.sss_strength&&(c=k.glsl_value(parseFloat(d.sss_strength)),b.set_batch_directive(a,"SSS_STRENGTH",c)),"number"==typeof d.sss_width&&(c=k.glsl_value(parseFloat(d.sss_width)),
b.set_batch_directive(a,"SSS_WIDTH",c)),"number"==typeof d.dst_noise_scale0&&(c=k.glsl_value(parseFloat(d.dst_noise_scale0)),b.set_batch_directive(a,"DST_NOISE_SCALE_0",c)),"number"==typeof d.dst_noise_scale1&&(c=k.glsl_value(parseFloat(d.dst_noise_scale1)),b.set_batch_directive(a,"DST_NOISE_SCALE_1",c)),"number"==typeof d.dst_noise_freq0&&(c=k.glsl_value(parseFloat(d.dst_noise_freq0)),b.set_batch_directive(a,"DST_NOISE_FREQ_0",c)),"number"==typeof d.dst_noise_freq1&&(c=k.glsl_value(parseFloat(d.dst_noise_freq1)),
b.set_batch_directive(a,"DST_NOISE_FREQ_1",c)),"number"==typeof d.dir_min_shore_fac&&(c=k.glsl_value(parseFloat(d.dir_min_shore_fac)),b.set_batch_directive(a,"DIR_MIN_SHR_FAC",c)),"number"==typeof d.dir_freq&&(c=k.glsl_value(parseFloat(d.dir_freq)),b.set_batch_directive(a,"DIR_FREQ",c)),"number"==typeof d.dir_noise_scale&&(c=k.glsl_value(parseFloat(d.dir_noise_scale)),b.set_batch_directive(a,"DIR_NOISE_SCALE",c)),"number"==typeof d.dir_noise_freq&&(c=k.glsl_value(parseFloat(d.dir_noise_freq)),b.set_batch_directive(a,
"DIR_NOISE_FREQ",c)),"number"==typeof d.dir_min_noise_fac&&(c=k.glsl_value(parseFloat(d.dir_min_noise_fac)),b.set_batch_directive(a,"DIR_MIN_NOISE_FAC",c)),"number"==typeof d.dst_min_fac&&(c=k.glsl_value(parseFloat(d.dst_min_fac)),b.set_batch_directive(a,"DST_MIN_FAC",c)),"number"==typeof d.waves_hor_fac&&(d=k.glsl_value(parseFloat(d.waves_hor_fac)),b.set_batch_directive(a,"WAVES_HOR_FAC",d))),b.update_shader(a,!0));return!0}};b4w.module.camera=function(a,p){function h(a,d){c.is_target_camera(a)?(r.copy(d,a._render.pivot),k.update_transform(a),b.sync_transform(a)):l.error("set_pivot(): Wrong object or camera move style")}var c=p("__camera"),f=p("__config"),b=p("__physics"),l=p("__print"),e=p("__constraints"),k=p("__transform"),d=p("__util"),r=p("vec3"),x=p("vec4"),n=p("quat"),t=p("mat3"),w=p("mat4"),B=f.controls,q=new Float32Array(3),s=new Float32Array(3),y=new Float32Array(4),g=new Float32Array(4),A=new Float32Array(9);
a.MS_STATIC=c.MS_STATIC;a.MS_ANIMATION=c.MS_ANIMATION;a.MS_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.is_camera=function(a){return c.is_camera(a)};a.set_move_style=function(a,b){a._render.move_style=b};a.get_move_style=function(a){return c.is_camera(a)?c.get_move_style(a):(l.error("Wrong object"),null)};a.change_eye_target_dist=function(){l.error("change_eye_target_dist() deprecated")};a.change_trans_speed=
function(a,b){var c=a._render,d=c.trans_speed[0],d=d*(1+b*B.cam_zoom_base_speed);c.trans_speed=[d,d,d]};a.get_trans_speed=function(a){return c.is_camera(a)?a._render.trans_speed[0]:(l.error("Wrong object"),0)};a.set_look_at=function(a,d,e,f){var g=a._render;c.eye_target_up_to_trans_quat(d,e,f,g.trans,g.quat);k.update_transform(a);b.sync_transform(a)};a.get_eye=function(a){return a._render.trans};a.set_pivot=h;a.get_pivot=function(a,b){if(c.is_target_camera(a))return b||(b=new Float32Array(3)),r.copy(a._render.pivot,
b),b;l.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,e,f){if(c.is_target_camera(a)){var g=a._render;q[0]=0;q[1]=1;q[2]=0;n.setAxisAngle(q,e,y);d.rotate_point_pivot(g.trans,g.pivot,y,g.trans);q[0]=1;q[1]=0;q[2]=0;r.transformQuat(q,g.quat,q);n.setAxisAngle(q,f,y);d.rotate_point_pivot(g.trans,g.pivot,y,g.trans);k.update_transform(a);b.sync_transform(a)}else l.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,d,e){if(c.is_target_camera(a)){var f=a._render;
if(f.use_panning){var g=t.fromMat4(f.world_matrix,A),h=r.subtract(f.trans,f.pivot,s);q[0]=d;q[1]=0;q[2]=e;r.scale(q,r.len(h),q);r.transformMat3(q,g,q);r.add(f.pivot,q,f.pivot);r.add(f.trans,q,f.trans);k.update_transform(a);b.sync_transform(a)}}else l.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,e){if(c.is_hover_camera(a)){var f=a._render;if(f.use_distance_limits&&f.enable_hover_hor_rotation&&e){var g=n.setAxisAngle(d.AXIS_Y,e,y);n.normalize(g,g);n.multiply(g,f.quat,f.quat);k.update_transform(a);
b.sync_transform(a)}}else l.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return c.is_hover_camera(a)?c.get_hover_angle(a):(l.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,e){if(c.is_hover_camera(a)){var f=a._render;if(f.use_distance_limits){var g=d.quat_to_dir(f.quat,d.AXIS_X,q),h=c.get_hover_angle(a)-e,g=n.setAxisAngle(g,h,y),f=n.multiply(g,f.quat,y);k.set_rotation(a,f);k.update_transform(a);b.sync_transform(a)}else l.warn("set_hover_cam_angle(): undefined without distance limits")}else l.error("set_hover_cam_angle(): wrong object or camera move style")};
a.get_hover_angle_limits=function(a,b){if(c.is_hover_camera(a))return a._render.hover_angle_limits?(b||(b=new Float32Array(2)),b[0]=a._render.hover_angle_limits.up,b[1]=a._render.hover_angle_limits.down):l.warn("get_hover_angle_limits(): camera hasn't angle limits"),b;l.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,b){if(c.is_hover_camera(a)||c.is_target_camera(a))return a._render.use_distance_limits?(b||(b=new Float32Array(2)),b[0]=a._render.distance_max,b[1]=
a._render.distance_min):l.warn("get_cam_dist_limits(): camera hasn't distance limits"),b;l.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,d){if(c.is_hover_camera(a)){var e=a._render;e.use_distance_limits?r.copy(d,e.hover_pivot):k.set_translation(a,d);k.update_transform(a);b.sync_transform(a)}else l.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,b){if(!c.is_hover_camera(a))return l.error("get_hover_cam_pivot(): wrong object"),null;
b||(b=new Float32Array(3));r.copy(a._render.hover_pivot,b);return b};a.is_use_distance_limits=function(a){return c.is_target_camera(a)||c.is_hover_camera(a)?a._render.use_distance_limits:(l.error("is_use_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,d,e,f){if(c.is_target_camera(a)||c.is_eye_camera(a)){var g=a._render;g.vertical_limits={down:d,up:e};f==k.SPACE_LOCAL&&c.vertical_limits_local_to_world(a);c.vertical_limits_correct(a)}else if(c.is_hover_camera(a)){if(d>e){l.error("apply_vertical_limits(): wrong horizontal limits");
return}g=a._render;g.vertical_limits={down:-e,up:-d}}else{l.error("apply_vertical_limits(): wrong object");return}k.update_transform(a);b.sync_transform(a)};a.clear_vertical_limits=function(a){a._render.vertical_limits=null;(c.is_target_camera(a)||c.is_eye_camera(a))&&c.vertical_limits_correct(a)};a.apply_horizontal_limits=function(a,d,e,f){if(c.is_target_camera(a)||c.is_eye_camera(a)){var g=a._render;g.horizontal_limits={left:d,right:e};f==k.SPACE_LOCAL&&c.horizontal_limits_local_to_world(a);c.vertical_limits_correct(a)}else if(c.is_hover_camera(a)){if(d>
e){l.error("apply_horizontal_limits(): wrong horizontal limits");return}g=a._render;g.horizontal_limits={left:d,right:e}}else{l.error("apply_horizontal_limits(): wrong object");return}k.update_transform(a);b.sync_transform(a)};a.clear_horizontal_limits=function(a){a._render.horizontal_limits=null};a.apply_hover_angle_limits=function(a,d,e){c.is_hover_camera(a)?d>e?l.error("apply_horizontal_limits(): wrong horizontal limits"):(a._render.hover_angle_limits={down:d,up:e},k.update_transform(a),b.sync_transform(a)):
l.error("apply_horizontal_limits(): wrong object")};a.clear_hover_angle_limits=function(a){a._render.hover_angle_limits=null};a.apply_distance_limits=function(a,d,e){if(c.is_target_camera(a)||c.is_hover_camera(a))if(d>e)l.error("apply_distance_limits(): wrong distance limits");else{var f=a._render;f.use_distance_limits=!0;f.distance_min=d;f.distance_max=e;k.update_transform(a);b.sync_transform(a)}else l.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){c.is_target_camera(a)||
c.is_hover_camera(a)?a._render.use_distance_limits=!1:l.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(a,d,e){n.identity(a._render.quat);c.rotate_v_local(a,Math.PI/2);c.rotate_h(a,d);c.rotate_v_local(a,-e);k.update_transform(a);b.sync_transform(a)};a.is_look_up=function(a){d.quat_to_dir(a._render.quat,d.AXIS_MY,q);return 0<=q[1]?!0:!1};a.rotate=function(a,d,e){c.rotate_h(a,d);c.rotate_v_local(a,-e);k.update_transform(a);b.sync_transform(a)};a.get_angles=function(a,b){b||
(b=new Float32Array(2));c.get_angles(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a._render.cameras,e=0;e<d.length;e++){var f=d[e];f.type!=c.TYPE_STEREO_LEFT&&f.type!=c.TYPE_STEREO_RIGHT||c.set_stereo_params(f,b,f.stereo_eye_dist)}};a.get_stereo_distance=function(a,b){for(var d=a._render.cameras,e=0;e<d.length;e++){var f=d[e];if(f.type==c.TYPE_STEREO_LEFT||f.type==c.TYPE_STEREO_RIGHT)return f.stereo_conv_dist}return 0};a.is_underwater=function(a){return a._render.underwater};a.translate_view=
function(a,b,d,e){a=a._render.cameras;for(var f=0;f<a.length;f++){var g=a[f];g.reflection_plane||c.set_projection(g,g.aspect);var h=q;h[0]=-b;h[1]=-d;h[2]=0;w.translate(g.proj_matrix,h,g.proj_matrix);w.rotateZ(g.proj_matrix,e,g.proj_matrix);w.multiply(g.proj_matrix,g.view_matrix,g.view_proj_matrix);c.calc_view_proj_inverse(g);c.calc_sky_vp_inverse(g)}};a.correct_up=function(a,b){b||(b=d.AXIS_Y);e.correct_up(a,b)};a.zoom_object=function(a,d){if(c.is_target_camera(a)){k.get_object_center(d,!1,q);h(a,
q);k.update_transform(a);var e=k.get_object_size(d),f=c.get_angular_diameter(a)/2,e=e/Math.sin(f),f=k.obj_point_distance(a,q);k.move_local(a,0,e-f,0);k.update_transform(a);b.sync_transform(a)}else l.error("zoom_object(): wrong object")};a.calc_ray=function(a,b,d,e){e||(e=new Float32Array(3));var f=a._render.cameras[0];switch(f.type){case c.TYPE_PERSP:case c.TYPE_PERSP_ASPECT:case c.TYPE_STEREO_LEFT:case c.TYPE_STEREO_RIGHT:var h=Math.tan(f.fov*Math.PI/360);g[0]=(2*b/f.width-1)*h*f.aspect;g[1]=-1;
g[2]=(2*d/f.height-1)*h;g[3]=0;x.transformMat4(g,a._render.world_matrix,g);e[0]=g[0];e[1]=g[1];e[2]=g[2];r.normalize(e,e);return e;default:return l.error("Non-compatible camera"),e}};a.project_point=function(a,b,d){d||(d=new Float32Array(2));var e=a._render.cameras[0];switch(e.type){case c.TYPE_PERSP:case c.TYPE_PERSP_ASPECT:case c.TYPE_STEREO_LEFT:case c.TYPE_STEREO_RIGHT:return k.get_translation(a,q),r.subtract(b,q,q),g.set(q),g[3]=0,x.transformMat4(g,e.view_proj_matrix,g),a=-g[1]/g[3],d[0]=(g[0]/
g[3]+1)/2*e.width|0,d[1]=(a+1)/2*e.height|0,d;default:return l.error("Non-compatible camera"),d}}};b4w.module.config=function(a,p){var h=p("__config");a.P_LOW=h.P_LOW;a.P_HIGH=h.P_HIGH;a.P_ULTRA=h.P_ULTRA;a.P_CUSTOM=h.P_CUSTOM;a.set=h.set;a.get=h.get;a.reset=h.reset};b4w.module.controls=function(a,p){var h=p("__controls");p("__print");a.CT_CONTINUOUS=h.CT_CONTINUOUS;a.CT_TRIGGER=h.CT_TRIGGER;a.CT_SHOT=h.CT_SHOT;a.CT_LEVEL=h.CT_LEVEL;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=
74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=
221;a.KEY_SINGLE_QUOTE=222;a.create_custom_sensor=h.create_custom_sensor;a.create_keyboard_sensor=h.create_keyboard_sensor;a.create_collision_sensor=h.create_collision_sensor;a.create_collision_impulse_sensor=h.create_collision_impulse_sensor;a.create_ray_sensor=h.create_ray_sensor;a.create_mouse_click_sensor=h.create_mouse_click_sensor;a.create_mouse_wheel_sensor=h.create_mouse_wheel_sensor;a.create_mouse_move_sensor=h.create_mouse_move_sensor;a.create_touch_move_sensor=h.create_touch_move_sensor;
a.create_touch_zoom_sensor=h.create_touch_zoom_sensor;a.create_motion_sensor=h.create_motion_sensor;a.create_vertical_velocity_sensor=h.create_vertical_velocity_sensor;a.create_timer_sensor=h.create_timer_sensor;a.reset_timer_sensor=h.reset_timer_sensor;a.create_elapsed_sensor=h.create_elapsed_sensor;a.create_timeline_sensor=h.create_timeline_sensor;a.create_selection_sensor=function(a,f){return h.create_selection_sensor(a,f||!1)};a.set_custom_sensor=function(a,f){h.sensor_set_value(a,f)};a.get_custom_sensor=
function(a,f){return a.value};a.get_sensor_value=h.get_sensor_value;a.get_sensor_payload=h.get_sensor_payload;a.sensor_make_positive=function(a){throw"Deprecated method execution";};a.sensor_make_negative=function(a){throw"Deprecated method execution";};a.create_sensor_lock=function(a,f,b){a.lock_sensors=f.slice(0);a.lock_sensor_values=Array(f.length);a.lock_logic_fun=b||h.default_AND_logic_fun};a.remove_sensor_lock=function(a){a.lock_sensors=null;a.lock_sensor_values=null;a.lock_logic_fun=null};
a.create_sensor_manifold=function(a,f,b,l,e,k,d){e=e||h.default_AND_logic_fun;h.create_sensor_manifold(a,f,b,l,e,k,void 0===d?null:d)};a.create_kb_sensor_manifold=function(a,f,b,l,e,k){l=h.create_keyboard_sensor(l);h.create_sensor_manifold(a,f,b,[l],h.default_AND_logic_fun,e,void 0===k?null:k)};a.check_sensor_manifolds=function(a){return h.check_sensor_manifold(a,null)};a.check_sensor_manifold=h.check_sensor_manifold;a.remove_sensor_manifolds=function(a){h.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=
h.remove_sensor_manifold;a.reset=h.reset;a.register_keyboard_events=h.register_keyboard_events;a.register_mouse_events=h.register_mouse_events;a.register_wheel_events=h.register_wheel_events;a.register_touch_events=h.register_touch_events;a.unregister_keyboard_events=h.unregister_keyboard_events;a.unregister_mouse_events=h.unregister_mouse_events;a.unregister_wheel_events=h.unregister_wheel_events;a.unregister_touch_events=h.unregister_touch_events};b4w.module.constraints=function(a,p){var h=p("__constraints"),c=p("__physics"),f=p("__transform");a.append_stiff=function(a,l,e,k){l instanceof Array&&2==l.length?h.append_stiff_bone(a,l[0],l[1],e,k):h.append_stiff_obj(a,l,e,k);f.update_transform(a);c.sync_transform(a)};a.append_semi_stiff=function(a,l,e,k){h.append_semi_stiff_obj(a,l,e,k);f.update_transform(a);c.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,e,k,d,p,x,n){h.append_semi_stiff_cam_obj(a,l,e,k,d,p,x,n);f.update_transform(a);
c.sync_transform(a)};a.append_semi_soft_cam=function(a,l,e,k){if(!k||0>k)k=.25;h.append_semi_soft_cam_obj(a,l,e,k);f.update_transform(a);c.sync_transform(a)};a.append_stiff_trans=function(a,l,e){h.append_stiff_trans_obj(a,l,e);f.update_transform(a);c.sync_transform(a)};a.append_copy_trans=function(a,l,e){h.append_copy_trans_obj(a,l,e);f.update_transform(a);c.sync_transform(a)};a.append_stiff_trans_rot=function(a,l,e,k){h.append_stiff_trans_rot_obj(a,l,e,k,1);f.update_transform(a);c.sync_transform(a)};
a.append_track=function(a,l){3==l.length?h.append_track_point(a,l):h.append_track_obj(a,l);f.update_transform(a);c.sync_transform(a)};a.append_follow=function(a,l,e,k){3==l.length?h.append_follow_point(a,l,e,k):h.append_follow_obj(a,l,e,k);f.update_transform(a);c.sync_transform(a)};a.remove=function(a){a._constraint&&h.remove(a)}};b4w.module.data=function(a,p){var h=p("__data");p("__print");var c=p("__util");a.load=h.load;a.unload=function(a){h.unload(a|0)};a.set_debug_resources_root=h.set_debug_resources_root;a.is_primary_loaded=h.is_primary_loaded;a.load_and_add_new=h.load;a.get_bpy_world=function(a){c.panic("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,p){p("__batch");var h=p("__print"),c=p("__controls"),f=p("__debug"),b=p("__physics"),l=p("__scenegraph"),e=p("__scenes"),k=p("__sfx"),d=p("__textures"),r=p("__util"),x=p("vec3");a.physics_worker=function(){b.debug_worker()};a.physics_id=function(a){h.log("O",b.find_obj_by_body_id(a));for(var c=b.get_active_scene()._physics.bundles,d=0;d<c.length;d++){var e=c[d];e.physics.body_id==a&&h.log("B",e)}};a.visible_objects=function(){for(var a=e.get_active(),b=e.get_scene_objs(a,
"MESH",e.DATA_ID_ALL),a=e.get_subs(a,"MAIN_OPAQUE").bundles,c=0;c<b.length;c++){var d=b[c],f=d._render;if("DYNAMIC"==f.type)for(var k=0;k<a.length;k++){var l=a[k];if(l.do_render&&l.obj_render==f){h.log(d.name,d);break}}}};a.object_info=function(a){for(var b=e.get_active(),c=e.get_scene_objs(b,"MESH",e.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){h.log("Object",f);for(var k=e.get_all_subscenes(b),l=0;l<k.length;l++){for(var g=k[l],p=g.bundles,r=[],x=0;x<p.length;x++)p[x].obj_render==f._render&&
r.push(p[x]);h.log("Subscene "+g.type,r)}}}};a.objects_stat=function(){var a=e.get_active();console.log("Armatures: "+e.get_scene_objs(a,"ARMATURE",e.DATA_ID_ALL).length);console.log("Cameras: "+e.get_scene_objs(a,"CAMERA",e.DATA_ID_ALL).length);console.log("Curves: "+e.get_scene_objs(a,"CURVE",e.DATA_ID_ALL).length);console.log("Empties: "+e.get_scene_objs(a,"EMPTY",e.DATA_ID_ALL).length);console.log("Lamps: "+e.get_scene_objs(a,"LAMP",e.DATA_ID_ALL).length);console.log("Meshes: "+e.get_scene_objs(a,
"MESH",e.DATA_ID_ALL).length);console.log("Speakers: "+e.get_scene_objs(a,"SPEAKER",e.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=e.get_active(),b=[e.get_subs(b,"MAIN_OPAQUE"),e.get_subs(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,f=0;f<d.length;f++){var h=d[f].batch;h&&(a+=h.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=e.get_active(),b=[e.get_subs(b,"MAIN_OPAQUE"),e.get_subs(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=
d.bundles,f=0;f<d.length;f++){var h=d[f].batch;h&&(a+=h.num_triangles)}}return a};a.num_draw_calls=function(){var a=e.get_active(),a=[e.get_subs(a,"MAIN_OPAQUE"),e.get_subs(a,"MAIN_BLEND")];return a[0].bundles.length+a[1].bundles.length};a.geometry_stats=function(){for(var a=e.get_active(),b=e.get_all_subscenes(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var f=d.bundles,h=0;h<f.length;h++){var k=f[h].batch,g=f[h].obj_render;k&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=
d.type||g.origin_selectable)&&(a[k.id]=k)}}var f=d=c=b=0,l;for(l in a)k=a[l],k=k.bufs_data,k.debug_ibo_bytes&&(d++,f+=k.debug_ibo_bytes/1048576),b++,c+=k.debug_vbo_bytes/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:f}};a.num_textures=function(){for(var a=[],b=0,c=e.get_active(),c=[e.get_subs(c,"MAIN_OPAQUE"),e.get_subs(c,"MAIN_BLEND")],d=0;d<c.length;d++){var f=c[d];if(f)for(var f=f.bundles,h=0;h<f.length;h++){var k=f[h].batch;if(k)for(var k=k.textures,g=0;g<k.length;g++){var l=
k[g];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var p=l.w_texture;-1===a.indexOf(p)&&(a.push(p),l=l.width*l.height*4/1048576/l.compress_ratio,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=e.get_active(),c=e.get_all_subscenes(c),f=0;f<c.length;f++){var h=c[f];if("SINK"!=h.type){var k=h.camera,l=[k.color_attachment,k.depth_attachment];l.push.apply(l,h.textures_internal);for(h=0;h<l.length;h++){var g=l[h];d.is_texture(g)&&-1==a.indexOf(g)&&
(a.push(g),b+=k.width*k.height*d.get_texture_channel_size(g))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=e.get_active();(a=e.get_subs(a,"MAIN_OPAQUE"))&&e.make_frustum_shot(a.camera,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=e.get_active(),b=e.get_subs(a,"MAIN_OPAQUE"),a=e.subs_array(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],f;switch(c){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=[1,
0,1]}e.make_frustum_shot(d.camera,b,f)}};a.scenegraph_to_dot=function(){var a=e.get_active(),a=e.get_graph(a);h.log(l.debug_convert_to_dot(a))};a.controls_info=c.debug;a.object_distance=function(a,b){return x.dist(a._render.trans,b._render.trans)};a.msg=f.msg;a.fbmsg=f.fbmsg;a.print_telemetry=f.print_telemetry;a.plot_telemetry=f.plot_telemetry;a.fbres=function(a,b){b||(b=16);var c=function(){f.fbmsg("FBRES",a());setTimeout(c,b)};c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,
0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),h=new Float32Array([0,-1,0]),g=new Float32Array([0,0,-1]);if(!r.cmp_arr(a,r.VEC3_IDENT))throw"Wrong VEC3_IDENT";if(!r.cmp_arr(b,r.QUAT4_IDENT))throw"Wrong QUAT4_IDENT";if(!r.cmp_arr(c,r.AXIS_X))throw"Wrong AXIS_X";if(!r.cmp_arr(d,r.AXIS_Y))throw"Wrong AXIS_Y";if(!r.cmp_arr(e,r.AXIS_Z))throw"Wrong AXIS_Z";if(!r.cmp_arr(f,r.AXIS_MX))throw"Wrong AXIS_MX";if(!r.cmp_arr(h,r.AXIS_MY))throw"Wrong AXIS_MY";
if(!r.cmp_arr(g,r.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=k.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==k.get_spk_behavior(c)&&k.mute(c,!0)}};a.check_finite=function(a){f.check_finite(a)};a.set_debug_params=function(a){var b=e.get_active();if(b=e.get_subs(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&e.set_wireframe_mode(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&e.set_wireframe_edge_color(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";
};a.get_error_quantity=function(){return h.get_error_count()};a.get_warning_quantity=function(){return h.get_warning_count()};a.clear_errors_warnings=function(){return h.clear_errors_warnings()}};b4w.module.hud=function(a,p){var h=p("__hud");p("__print");a.draw_mixer_strip=h.draw_mixer_strip;a.plot_array=h.plot_array};b4w.module.geometry=function(a,p){function h(a){return a&&a._render&&a._render.dynamic_geometry?!0:!1}var c=p("__batch"),f=p("__geometry"),b=p("__print"),l=p("__renderer");a.extract_vertex_array=function(a,k,d){if(!h(a))return b.error("Wrong object:",a.name),null;if(a=c.find_batch_material(a,k,"MAIN")||c.find_batch_material(a,k,"NODES")){if((k=a.bufs_data)&&k.pointers&&k.pointers[d])return f.extract_array(k,d);b.error("Attribute not found:"+d);return null}b.error("Wrong material:",k);return null};
a.extract_index_array=function(a,f){if(!h(a))return b.error("Wrong object:",a.name),null;var d=c.find_batch_material(a,f,"MAIN")||c.find_batch_material(a,f,"NODES");if(d){if((d=d.bufs_data)&&d.pointers)return d.ibo_array;b.error("Buffer data not found");return null}b.error("Wrong material:",f);return null};a.update_vertex_array=function(a,k,d,l){var p=["MAIN","NODES","DEPTH","COLOR_ID"];if(h(a))for(var n=0;n<p.length;n++){var t=c.find_batch_material(a,k,p[n]);t&&(t=t.bufs_data)&&t.pointers&&t.pointers[d]&&
f.update_bufs_data_array(t,d,0,l)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,k,d,p,x){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(h(a))if(d instanceof Uint16Array||d instanceof Uint32Array)if(p instanceof Float32Array)for(var t=0;t<n.length;t++){var w=c.find_batch_material(a,k,n[t]);if(w){var B=w.bufs_data;if(B){f.update_bufs_data_index_array(B,w.draw_mode,d);var q=0,s;for(s in B.pointers)var y=B.pointers[s],q=q+p.length/3*y.num_comp;B.vbo_array=new Float32Array(q);var q=
B.vbo_array,g=0;for(s in B.pointers)switch(y=B.pointers[s],s){case "a_position":q.set(p,g);y.offset=g;y.length=p.length;g+=y.length;break;case "a_normal":var A;x&&(A=f.calc_shared_indices(d,p,p));var u=f.calc_normals(d,p,A);q.set(u,g);y.offset=g;y.length=p.length;g+=y.length;break;case "a_tangent":y.offset=g;y.length=p.length/3*y.num_comp;for(var S=new Float32Array(y.length),u=0;u<S.length;u+=4)S[u]=1,S[u+3]=1;q.set(S,g);g+=y.length;break;default:y.offset=g,y.length=p.length/3*y.num_comp,u=new Float32Array(y.length),
q.set(u,g),g+=y.length}f.update_gl_buffers(B);l.assign_attribute_setters(w);if(w.childs)for(u=0;u<w.childs.length;u++)(y=w.childs[u])&&y.bufs_data&&(y.bufs_data=B)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)}};b4w.module.lights=function(a,p){function h(a){for(var h=b.get_active(),n=b.get_scene_objs(h,"LAMP",b.DATA_ID_ALL),p=0;p<n.length;p++){var r=n[p];if("SUN"==r._light.type){var g=r;break}}if(!g)return c.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(n=(90-a.vert_position)/180*Math.PI,p=g._render,l.set_rotation_euler(g,[n,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),e.quat_to_dir(p.quat,e.AXIS_Y,a),p=k.length(p.trans),k.copy(a,
d),k.scale(d,p,d),l.set_translation(g,d),l.update_transform(g),a=g._light,a.dynamic_intensity&&(r=g.data.energy,p=h.world.light_settings.environment_energy,n=Math.cos(Math.abs(n)),r*=Math.max(Math.min(3*n,1),0),n=Math.max(n,.1)*p,f.set_light_energy(a,r),b.set_environment_colors(h,n,null,null)),b.update_lamp_scene(g,h))}var c=p("__print"),f=p("__lights"),b=p("__scenes"),l=p("__transform"),e=p("__util"),k=p("vec3"),d=new Float32Array(3),r,x,n,t=60;a.get_lamps=function(a){var c=b.get_active(),c=b.get_scene_objs(c,
"LAMP",b.DATA_ID_ALL);if(!a)return c;for(var d=[],e=0;e<c.length;e++){var f=c[e];f._light.type===a&&d.push(f)}return d};a.get_sun_params=function(){for(var a=b.get_active(),a=b.get_scene_objs(a,"LAMP",b.DATA_ID_ALL),c=null,d=0;d<a.length;d++){var e=a[d];if("SUN"==e._light.type){c=e;break}}return c?(c=c._light.direction,a=180*Math.atan2(c[2],c[0])/Math.PI+90,180<a&&(a-=360),c=180*Math.atan2(c[1],Math.sqrt(c[0]*c[0]+c[2]*c[2]))/Math.PI,d={},d.hor_position=a,d.vert_position=c,d):null};a.set_sun_params=
h;a.set_day_time=function(a){for(var d=b.get_active(),d=b.get_scene_objs(d,"LAMP",b.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("SUN"==f._light.type){var k=f;break}}if(!k)return c.error("There is no sun on the scene"),null;k=12>a?15*a:15*(a-24);a=-Math.cos(a/12*Math.PI)*t;d={};d.hor_position=k;d.vert_position=a;h(d)};a.set_date=function(a){r=a.getDate();x=a.getMonth();n=a.getFullYear();if(r)if(1582==r&&10==a.m&&4<a.d&&15>a.d)c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!");
else{a=r;var b=x,d=n,e,f;2<b?(e=a,f=b+1):(e=a-1,f=b+13);f=Math.floor(Math.floor(365.25*e)+Math.floor(30.6001*f)+d+1720995);588829<=d+31*(b+12*a)&&(a=Math.floor(.01*e),f+=2-a+Math.floor(.25*a));a=1E5*f;b=Math.floor(a);.5<a-b&&++b}else c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){t=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var d=b.get_active();if(!d)return c.error("No active scene"),!1;for(var d=b.get_scene_objs(d,"LAMP",b.DATA_ID_ALL),e=0;e<
d.length;e++){var f=d[e];if(f.name===a){var h=f._light;break}}return h?{light_color:h.color,light_energy:h.energy}:!1};a.set_light_params=function(a,d){var e=b.get_active();if(!e)return c.error("No active scene"),!1;for(var h=b.get_scene_objs(e,"LAMP",b.DATA_ID_ALL),k=0;k<h.length;k++){var g=h[k];if(g.name===a){var l=g._light;break}}if(!l)return c.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof d.light_energy&&(f.set_light_energy(l,d.light_energy),b.update_lamp_scene(g,e));"object"==
typeof d.light_color&&(f.set_light_color(l,d.light_color),b.update_lamp_scene(g,e))};a.get_lights_names=function(){var a=b.get_active();if(!a)return c.error("No active scene"),!1;for(var d=[],a=b.get_scene_objs(a,"LAMP",b.DATA_ID_ALL),e=0;e<a.length;e++)d.push(a[e]._light.name);return d}};b4w.module.physics=function(a,p){var h=p("__print"),c=p("__physics"),f=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):h.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):h.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,f){c.has_physics(a)?c.set_gravity(a,f):h.error("No physics for object "+a.name)};a.set_damping=function(a,f,e){c.has_physics(a)?c.post_msg("set_damping",a._physics.body_id,f,e):h.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var f=a.game;c.post_msg("set_damping",a._physics.body_id,f.damping,f.rotation_damping)}else h.error("No physics for object "+a.name)};a.set_transform=function(a,f,
e){c.has_physics(a)?c.set_transform.apply(this,arguments):h.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):h.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):h.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):h.error("No physics for object "+a.name)};a.apply_force=function(a,f,
e,k){c.has_physics(a)?c.apply_force.apply(this,arguments):h.error("No physics for object "+a.name)};a.apply_torque=function(a,f,e,k){c.has_physics(a)?c.apply_torque.apply(this,arguments):h.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object"),c.vehicle_throttle(a,f.clamp(l,-1,1))):h.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,l,e){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||h.error("Wrong object");l=f.clamp(l,0,1);var k=a._vehicle.engine_force;-1==e||1==e?k=Math.max(-1,Math.min(k+e*l,1)):0==e&&0<=k?(k-=l,k=Math.max(0,k)):0==e&&0>k?(k+=l,k=Math.min(0,k)):h.error("Wrong steering direction");c.vehicle_throttle(a,f.clamp(k,-1,1))}else h.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object"),c.vehicle_steer(a,f.clamp(l,-1,1))):h.error("No physics for object "+
a.name)};a.vehicle_steer_inc=function(a,l,e){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object");l=f.clamp(l,0,1);var k=a._vehicle.steering;-1==e||1==e?k=Math.max(-1,Math.min(k+e*l,1)):0==e&&0<=k?(k-=l,k=Math.max(0,k)):0==e&&0>k?(k+=l,k=Math.min(0,k)):h.error("Wrong steering direction");c.vehicle_steer(a,f.clamp(k,-1,1))}else h.error("No physics for object "+a.name)};a.vehicle_brake=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||
h.error("Wrong object"),c.vehicle_brake(a,f.clamp(l,0,1))):h.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,l){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||h.error("Wrong object");l=f.clamp(l,-1,1);var e=a._vehicle.brake_force;c.vehicle_brake(a,f.clamp(e+e*l,0,1))}else h.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=
function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;h.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a._vehicle.engine_force;h.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return h.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a._vehicle.steering;h.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a._vehicle.brake_force;h.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return h.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);
h.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,f,e){c.has_physics(a)?c.set_character_move_dir(a,f,e):h.error("No physics for object "+a.name)};a.set_character_move_type=function(a,f){c.has_physics(a)?c.set_character_move_type(a,f):h.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(a,c){h.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,f){c.has_physics(a)?
c.set_character_walk_velocity(a,f):h.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,f){c.has_physics(a)?c.set_character_run_velocity(a,f):h.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,f){c.has_physics(a)?c.set_character_fly_velocity(a,f):h.error("No physics for object "+a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):h.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,f,e){c.has_physics(a)?
c.character_rotation_inc(a,f,e):h.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,f){c.has_physics(a)?c.set_character_rotation_quat(a,f):h.error("No physics for object "+a.name)};a.set_character_rotation=function(a,f,e){c.has_physics(a)?c.set_character_rotation(a,f,e):h.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,f){c.has_physics(a)?c.set_character_rotation_v(a,f):h.error("No physics for object "+a.name)};a.set_character_rotation_h=
function(a,f){c.has_physics(a)?c.set_character_rotation_h(a,f):h.error("No physics for object "+a.name)};a.append_collision_test=function(a,f,e,k){c.has_physics(a)?c.append_collision_test(a,f,e,k):h.error("No physics for object "+a.name)};a.remove_collision_test=function(a,f){c.has_physics(a)?c.remove_collision_test(a,f):h.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,f){c.has_physics(a)?c.apply_collision_impulse_test(a,f):h.error("No physics for object "+a.name)};
a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):h.error("No physics for object "+a.name)};a.append_ray_test=function(a,f,e,k,d,p){c.has_physics(a)?c.append_ray_test(a,f,e,k,d,p):h.error("No physics for object "+a.name)};a.remove_ray_test=function(a,f,e,k,d){c.has_physics(a)?c.remove_ray_test(a,f,e,k,d):h.error("No physics for object "+a.name)};a.apply_constraint=function(a,f,e,k,d,p,x,n,t,w){c.has_physics(f)&&c.has_physics(d)?c.apply_constraint(a,f,e,
k,d,p,x,n,t,w):h.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.has_constraint(a)?c.clear_constraint(a):h.error("Wrong object")};a.pull_to_constraint_pivot=function(a,f,e,k,d,p){c.has_physics(a)&&c.has_physics(k)?c.pull_to_constraint_pivot(a,f,e,k,d,p):h.error("Wrong objects")}};b4w.module.particles=function(a,p){var h=p("__particles"),c=p("__print");a.set_size=function(a,b,l){h.has_particles(a)?h.set_size(a,b,l):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,b,l){h.has_particles(a)?h.set_normal_factor(a,b,l):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,b,l){h.has_particles(a)?(l=Math.min(l,1),l=Math.max(l,0),h.set_factor(a,b,l)):c.error('"',a.name,'" has no particle systems')}};b4w.module.scenes=function(a,p){var h=p("__batch"),c=p("__camera"),f=p("__graph"),b=p("__print"),l=p("__physics"),e=p("__scenes"),k=p("__util");a.DATA_ID_ALL=e.DATA_ID_ALL;a.set_active=function(a){var b=e.get_all_scenes();e.set_active(k.keysearch("name",a,b))};a.get_active=function(){return e.check_active()?e.get_active().name:""};a.get_scenes=function(){for(var a=e.get_all_scenes(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(e.check_active())return e.get_active().camera;
b.error("No active scene");return!1};a.get_object_by_name=function(a,b){return e.get_object(e.GET_OBJECT_BY_NAME,a,b)};a.get_object_by_dupli_name=function(a,b,c){return e.get_object(e.GET_OBJECT_BY_DUPLI_NAME,a,b,c)};a.get_object_by_dupli_name_list=function(a,b){return e.get_object(e.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b)};a.get_object_by_empty_name=function(c,e,f){b.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(c,e,f)};a.get_object_data_id=
function(a){return e.get_object_data_id(a)};a.pick_object=e.pick_object;a.set_glow_intensity=function(a,b){for(var c=0;c<a._batches.length;c++){var e=a._batches[c];"COLOR_ID"==e.type&&(e.glow_intensity=b)}};a.apply_glow_anim=function(a,b,c,f){a._render&&a._render.selectable&&e.apply_glow_anim(a,b,c,f)};a.apply_glow_anim_def=function(a){if(a._render&&a._render.selectable){var b=a._render.glow_anim_settings;e.apply_glow_anim(a,b.glow_duration,b.glow_period,b.glow_relapses)}};a.clear_glow_anim=function(a){a._render&&
a._render.selectable&&e.clear_glow_anim(a)};a.set_glow_color=function(a){var b=e.get_active();if(b=e.get_subs(b,"GLOW"))b.glow_color.set(a),b.need_perm_uniforms_update=!0};a.get_shadow_params=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active(),c=e.get_subs(a,"SHADOW_CAST");if(!c)return null;var f=a._render.shadow_params,h=e.get_subs(a,"MAIN_OPAQUE"),k=e.get_subs(a,"DEPTH"),l={};l.csm_resolution=f.csm_resolution;l.self_shadow_polygon_offset=c.self_shadow_polygon_offset;
k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.b4w_enable_csm=f.b4w_enable_csm;l.csm_num=f.csm_num;l.csm_first_cascade_border=f.csm_first_cascade_border;l.first_cascade_blur_radius=f.first_cascade_blur_radius;l.csm_last_cascade_border=f.csm_last_cascade_border;l.last_cascade_blur_radius=f.last_cascade_blur_radius;l.fade_last_cascade=f.fade_last_cascade;l.blend_between_cascades=f.blend_between_cascades;f.b4w_enable_csm?(l.csm_borders=e.get_csm_borders(a,h.camera),l.blur_radii=new Float32Array(f.csm_num),
l.blur_radii.set(h.camera.pcf_blur_radii.subarray(0,f.csm_num))):(l.csm_borders=null,l.blur_radii=null);return l};a.set_shadow_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var k=e.get_active();"number"==typeof a.self_shadow_polygon_offset&&f.traverse(k._render.graph,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var l=e.get_subs(k,"DEPTH");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=
a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var n=e.get_subs(k,"MAIN_BLEND");n&&("number"==typeof a.self_shadow_normal_offset&&(n.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(n.pcf_blur_radius=a.pcf_blur_radius),n.need_perm_uniforms_update=!0);n=k._render.shadow_params;"number"==typeof a.csm_first_cascade_border&&(n.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&
(n.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(n.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(n.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var p=l.bundles,w=0;w<p.length;w++){var B=p[w];B.obj_render.shadow_receive&&(B=B.batch,h.assign_shadow_receive_dirs(B,n),h.update_shader(B))}l.need_perm_uniforms_update=!0}l=k.camera._render.cameras;for(w=0;w<l.length;w++)c.update_camera_shadows(l[w],
n);e.schedule_shadow_update(k)};a.get_environment_colors=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active();return e.get_environment_colors(a)};a.set_environment_colors=function(a,c,f){if(!e.check_active())return b.error("No active scene"),!1;var h=e.get_active();e.set_environment_colors(h,parseFloat(a),c,f)};a.get_fog_color_density=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();return e.get_fog_color_density(c,a)};
a.set_fog_color_density=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_fog_color_density(c,a)};a.get_ssao_params=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active();return e.get_ssao_params(a)};a.set_ssao_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_ssao_params(c,a)};a.get_color_correction_params=function(){if(!e.check_active())return b.error("No active scene"),
null;var a=e.get_active(),a=e.get_subs(a,"COMPOSITING");if(!a)return null;var c={};c.brightness=a.brightness;c.contrast=a.contrast;c.exposure=a.exposure;c.saturation=a.saturation;return c};a.set_color_correction_params=function(a){if(!e.check_active())return b.error("No active scene"),null;var c=e.get_active(),c=e.get_subs(c,"COMPOSITING");if(!c)return null;"number"==typeof a.brightness&&(c.brightness=a.brightness);"number"==typeof a.contrast&&(c.contrast=a.contrast);"number"==typeof a.exposure&&
(c.exposure=a.exposure);"number"==typeof a.saturation&&(c.saturation=a.saturation);c.need_perm_uniforms_update=!0};a.get_sky_params=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active();return e.get_sky_params(a)};a.set_sky_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_sky_params(c,a)};a.get_dof_params=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active();return e.get_subs(a,
"DOF")?e.get_dof_params(a):null};a.set_dof_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_dof_params(c,a)};a.get_god_rays_params=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active();return e.get_subs(a,"GOD_RAYS")?e.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_god_rays_params(c,a)};a.get_bloom_params=function(){if(!e.check_active())return b.error("No active scene"),
!1;var a=e.get_active();return e.get_subs(a,"BLOOM")?e.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_bloom_params(c,a)};a.get_wind_params=function(){return e.get_wind_params()};a.set_wind_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.set_wind_params(c,a)};a.get_water_surface_level=e.get_water_surface_level;a.set_water_params=function(a){if(!e.check_active())return b.error("No active scene"),
!1;var c=e.get_active();e.set_water_params(c,a)};a.get_water_mat_params=function(a){if(!e.check_active())return b.error("No active scene"),!1;var c=e.get_active();e.get_water_mat_params(c,a)};a.update_scene_materials_params=function(){if(!e.check_active())return b.error("No active scene"),!1;var a=e.get_active();e.update_scene_permanent_uniforms(a)};a.hide_object=function(a){e.hide_object(a)};a.show_object=function(a){e.show_object(a)};a.is_visible=function(a){return a._render.is_visible};a.check_object=
function(a){return e.check_active()?e.check_object(a,e.get_active()):(b.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=e.get_active();a||(a="ALL");b||0===b||(b=e.DATA_ID_ALL);return e.get_scene_objs(c,a,b)};a.get_appended_objs=function(c,e){b.warn("get_appended_objs() deprecated, use get_all_objects() instead");return a.get_all_objects(c,e)};a.get_object_name=function(a){return a?a.name:(b.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(b.error("Wrong object ID"),
"UNDEFINED")};a.get_object_dg_parent=function(a){return a._dg_parent};a.get_object_children=function(a){return a._descends.slice(0)};a.get_first_character=function(){for(var a=e.get_scene_objs(e.get_active(),"MESH",e.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return e.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return e.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?
a._render.type:null};a.append_object=function(a){k.panic('Method "append_object" is deprecated')};a.add_object=function(a){k.panic('Method "add_object" is deprecated')};a.remove_object=function(a){k.panic('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){k.panic("get_screen_scenes() deprecated")};a.set_light_pos=function(){k.panic("set_light_pos() deprecated, use lights module instead")};a.set_light_direction=function(){k.panic("set_light_direction() deprecated, use lights module instead")};
a.set_dir_light_color=function(a,b){k.panic("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){k.panic("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){k.panic("remove_all() deprecated, use lights module instead")};a.check_collision=function(){k.panic("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){k.panic("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,p){var h=p("__scenes"),c=p("__sfx");a.play=function(a,b,h){c.play(a,b,h)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,b,h,e){c.cyclic(a,b);e&&c.playrate(a,e);c.play(a,0,h)};a.speaker_stop=function(a){c.stop(a)};a.stop=function(a){c.stop(a)};a.speaker_playback_rate=function(a,b){c.playrate(a,b)};a.playrate=function(a,b){c.playrate(a,b)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};
a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,h){c.speaker_reset_speed(a,b,h)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.get_master_volume()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.set_master_volume(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.mute_master(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.is_master_muted()};a.get_speaker_objects=
function(){return c.get_speaker_objects().slice(0)};a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=function(a){c.set_compressor_params(h.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(h.get_active())};a.duck=function(a,b,h){a&&"object"===typeof a?c.duck(a,b,h):c.duck_master(b,h)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.unduck_master()};a.apply_playlist=c.apply_playlist;
a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response};b4w.module.shaders=function(a,p){function h(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function f(a){for(var b=k.get_all_scenes(),c=0;c<b.length;c++)for(var d=k.get_scene_objs(b[c],"MESH",k.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f._batches)for(var h=0;h<f._batches.length;h++){var l=f._batches[h];if(l.shader==a&&l.material_names.length)return l.material_names}}return null}function b(a){a.sort(function(a,b){return b.fstats.ALU_OPS-a.fstats.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fstats,
e=c.vstats,h=f(c.cshader),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";l.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,h);l.groupCollapsed("directives");for(var h=c.shaders_info.directives,k=0;k<h.length;k++){var p=h[k];l.log(p[0],p[1])}l.groupEnd();l.groupCollapsed("vert src");l.log(c.vsrc);l.groupEnd();l.groupCollapsed("vert stats");for(var y in e)"ALU_OPS"!=y&&"TEX_OPS"!=y&&l.log(y,e[y]);l.groupEnd();l.groupCollapsed("frag src");l.log(c.fsrc);
l.groupEnd();l.groupCollapsed("frag stats");for(y in d)"ALU_OPS"!=y&&"TEX_OPS"!=y&&l.log(y,d[y]);l.groupEnd();l.groupEnd()}}p("__config");var l=p("__print"),e=p("__extensions"),k=p("__scenes"),d=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=d.debug_get_compilation_stats(),b=0,c;for(c in a){var e=a[c],f=e.count;1<f&&l.log(f-1,e.shader_filename,e.hc);b+=f-1}l.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var f=d.get_compiled_shaders(),k=0,p;for(p in f)a&&-1===
p.indexOf(a)||k++;var k="of "+k+" analyzing...",w={};for(p in f)if(!a||-1!==p.indexOf(a)){var B=f[p],q;var s=B.vshader;q=B.fshader;var y=e.get_debug_shaders();if(y){s=y.getTranslatedShaderSource(s);q=y.getTranslatedShaderSource(q);var y=c("/nvidia_vert",s),g=h(y),A=c("/nvidia_frag",q),u=h(A);q={vsrc:s,vout:y,vstats:g,fsrc:q,fout:A,fstats:u}}else l.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),q=void 0;y=B.shaders_info;s=y.vert+" + "+y.frag;
q.cshader=B;q.shaders_info=y;B=w[s]=w[s]||[];B.push(q);l.log(k)}for(s in w)l.group("%c"+s,"color: #800"),B=w[s],b(B),l.groupEnd()}};b4w.module.transform=function(a,p){var h=p("__print"),c=p("__physics"),f=p("__transform"),b=p("__util"),l=new Float32Array(3),e=new Float32Array(4);a.SPACE_LOCAL=f.SPACE_LOCAL;a.SPACE_WORLD=f.SPACE_WORLD;a.set_translation=function(a,b,e,h){l[0]=b;l[1]=e;l[2]=h;f.set_translation(a,l);f.update_transform(a);c.sync_transform(a)};a.set_translation_v=function(a,b){f.set_translation(a,b);f.update_transform(a);c.sync_transform(a)};a.set_translation_rel=function(a,d,e,h,n){l[0]=d;l[1]=e;l[2]=h;b.transform_vec3(l,
1,n._render.quat,n._render.trans,l);f.set_translation(a,l);f.update_transform(a);c.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));f.get_translation(a,b);return b};a.set_rotation=function(a,b,h,l,n){e[0]=b;e[1]=h;e[2]=l;e[3]=n;f.set_rotation(a,e);f.update_transform(a);c.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){f.set_rotation(a,b);f.update_transform(a);c.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=
function(a,b){b||(b=new Float32Array(4));f.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;a.set_rotation_euler=function(a,b,e,h){l[0]=b;l[1]=e;l[2]=h;f.set_rotation_euler(a,l);f.update_transform(a);c.sync_transform(a)};a.set_rotation_euler_v=function(a,b){f.set_rotation_euler(a,b);f.update_transform(a);c.sync_transform(a)};a.set_scale=function(a,b){f.set_scale(a,b);f.update_transform(a)};a.get_scale=function(a){return f.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=
a.type)return h.error("Wrong object: "+a.name),!1;f.set_translation(a,[0,0,0]);f.set_rotation(a,[0,0,0,1]);f.set_scale(a,1);f.update_transform(a);c.sync_transform(a)};a.get_object_size=function(a){return b.is_mesh(a)?f.get_object_size(a):(h.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,e){return b.is_mesh(a)?f.get_object_center(a,c,e):(h.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,e,h){f.move_local(a,b,e,h);f.update_transform(a);c.sync_transform(a)};a.get_object_bounding_box=
function(a){return f.get_object_bounding_box(a)}};b4w.module.util=function(a,p){var h=p("__print"),c=p("__util"),f=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,f){f||(f=new Float32Array(4));return c.euler_to_quat(a,f)};a.quat_to_euler=
function(a,f){f||(f=new Float32Array(3));return c.quat_to_euler(a,f)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,f){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,f)};a.cam_quat_to_mesh_quat=function(a,f){return c.cam_quat_to_mesh_quat(a,f)};a.quat_project=function(a,l,e,k,d){return 0!=f.dot(e,k)?(h.error("Wrong in-plane direction"),null):c.quat_project(a,l,e,k,d)};a.hash_code=c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;
a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var h=p("__version");a.version=h.version;a.type=h.type;a.date=h.date};"object"==typeof module&&module.exports&&b4w.module.version(exports);b4w.module.textures=function(a,p){var h=p("__textures"),c=p("__print");a.get_canvas_texture_context=function(a){var b=h.get_canvas_context(a);if(b)return b;c.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){h.update_canvas_context(a)||c.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){h.play_video(a)||c.error('Texture with name "'+a+'" not found!')};a.stop_video=function(a){h.stop_video(a)||c.error('Texture with name "'+a+
'" not found!')}};b4w.module.main=function(a,p){function h(){T=0;window.performance||(t.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();t.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function c(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();t.error("B4W Error: WebGL context lost");b()},!1);s.setup_context(c);var f=s.get_renderer_info();f&&t.log("%cRENDERER INFO:",
"color: #00a",c.getParameter(f.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(f.UNMASKED_RENDERER_WEBGL));I.setup_context(c);y.setup_context(c);H.setup_context(c);m.setup_context(c);q.setup_context(c);B.setup_context(c);v.setup_dim(a.width,a.height);K.init();L=d();e()}function f(){G=function(){}}function b(){l()||(z=performance.now()/1E3,K.pause(),S.pause(),H.pause())}function l(){return ia<z}function e(){C(e);var a=performance.now()/1E3;X||(X=a);var b=a-X;b<1/V.max_fps||(l()||(ia>X&&(b-=ia-Math.max(z,
X)),T+=b,q.update(),u.update(),B.update(),k(T,b),L(b)),X=a)}function k(a,b){B.is_primary_loaded()&&(g.reset(),D.update(b),A.update(a,b),K.update(a,b),r.update(b),B.is_primary_loaded()&&(S.update(a,b),B.is_primary_loaded()&&(G(b,a),B.is_primary_loaded()&&(w.update(a,b),B.is_primary_loaded()&&(v.update(a,b),fa&&(fa(M.toDataURL()),fa=null))))))}function d(){var a=60,b=0,c=0,d=V.fps_measurement_interval,e=V.fps_callback_interval;return function(f){a=U.smooth(1/f,a,f,d);b=U.smooth(S.get_fps(),b,f,d);c=
(c+1)%e;0==c&&W(Math.round(a),Math.round(b))}}var r=p("__animation"),x=p("__compat"),n=p("__config"),t=p("__print"),w=p("__controls"),B=p("__data"),q=p("__debug"),s=p("__extensions"),y=p("__geometry"),g=p("__hud"),A=p("__nla"),u=p("__assets"),S=p("__physics"),I=p("__renderer"),v=p("__scenes"),K=p("__sfx"),m=p("__shaders"),H=p("__textures"),D=p("__transform"),U=p("__util"),P=p("__version"),Z=n.context,V=n.defaults,M=null,Q=null,T=0,X=0,z=0,ia=0,W=function(){},L=function(){},G=function(){},fa=null,
da=["webgl","experimental-webgl"],C=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/V.max_fps)}}();a.init=function(a,b){n.set_resources_paths();t.set_verbose(V.console_verbose);var d=P.version()+" "+P.type()+" ("+P.date()+")";t.log("%cINIT B4W ENGINE","color: #00a",d);if(!window.WebGLRenderingContext)return null;d=h();M=a;var e;
e=null;for(var f=0;f<da.length;f++){var k=da[f];try{e=a.getContext(k,Z)}catch(l){}if(e)break}if(!e)return null;c(M,e);n.apply_quality();x.set_hardware_defaults(e);t.log("%cSET PRECISION:","color: #00a",V.precision);b?(g.init(b),Q=b):(n.defaults.show_hud_debug_info=!1,n.sfx.mix_mode=!1);S.init_engine(d);return e};a.set_check_gl_errors=function(a){q.set_check_gl_errors(a)};a.resize=function(a,b){M.style.width=a+"px";M.style.height=b+"px";Q&&(Q.style.width=a+"px",Q.style.height=b+"px");M.width=a*V.canvas_resolution_factor;
M.height=b*V.canvas_resolution_factor;Q&&(Q.width=a,Q.height=b);g.update_dim();v.setup_dim(a*V.canvas_resolution_factor,b*V.canvas_resolution_factor);I.clear();k(T,0);B.update_media_controls(M.width,M.height)};a.set_fps_callback=function(a){W=a};a.clear_fps_callback=function(){W=function(){}};a.set_on_before_render_callback=function(a){G=a};a.set_render_callback=function(a){G=a};a.clear_on_before_render_callback=function(){f()};a.clear_render_callback=function(){f()};a.global_timeline=function(){return T};
a.redraw=function(){k(T,0)};a.pause=b;a.resume=function(){l()&&(ia=performance.now()/1E3,K.resume(),S.resume(),H.play())};a.is_paused=l;a.reset=function(){B.unload();Q=M=null;ia=z=X=T=0;W=function(){};L=function(){};G=function(){}};a.canvas_data_url=function(a){fa=a};a.get_canvas_elem=function(){return M};a.set_texture_quality=function(){U.panic("set_texture_quality() deprecated")};a.set_shaders_dir=function(){U.panic("set_shaders_dir() deprecated")}};b4w.module.camera_anim=function(a,p){var h=p("camera"),c=p("controls"),f=p("scenes"),b=p("transform"),l=p("util"),e=new Float32Array(3),k=new Float32Array(3),d=new Float32Array(3),r=new Float32Array(4),x=p("vec3"),n=p("quat");a.track_to_target=function(a,f,p,q,s,y,g,A){if(a&&f){if(l.is_vector(f))var u=f;else u=d,b.get_object_center(f,!1,u);f=p||1;p=q||2;var S=s||1;s=y||1;k[0]=0;k[1]=-1;k[2]=0;var I=b.get_rotation_quat(a);y=l.quat_to_dir(I,k);q=h.get_angles(a);var v=b.get_translation(a);x.subtract(u,
v,e);x.normalize(e,e);var K=n.rotationTo(y,e,n.create());n.multiply(K,I,r);l.correct_cam_quat_up(r,!1);x.subtract(u,v,k);var m=x.length(k)*(1-1/p),u=Math.asin(e[1]);p=Math.acos(-e[2]/Math.abs(Math.cos(u)));0<e[0]&&(p=2*Math.PI-p);var H=p-q[0],D=u-q[1];d[0]=0;d[1]=0;d[2]=-1;p=b.get_rotation_quat(a);0>l.quat_to_dir(p,d)[1]?(D=0<y[1]?u-Math.PI+q[1]:u+Math.PI+q[1],H=0<H?-Math.PI+H:Math.PI+H):Math.abs(H)>Math.PI&&(H=0<H?H-2*Math.PI:H+2*Math.PI);var D=-D,U=0,u=c.create_elapsed_sensor();y=Math.abs(H/f);
f=Math.abs(D/f);var P=y>f?y:f,Z=P+S,V=Z+s,M=V+S,Q=H,T=D,X=m;c.create_sensor_manifold(a,"TRACK_TO_TARGET",c.CT_CONTINUOUS,[u],null,function(a,d,e){if(e)if(e=c.get_sensor_value(a,d,0),U+=e,U<P){var f=H/P*e;e*=D/P;d=U/P;d=6*d*(1-d);f*=d;e*=d;Q-=f;T-=e;h.rotate(a,f,e)}else U<Z?(Q&&(h.rotate(a,Q,T),Q=0,A&&A()),d=(U-P)/S,e=-m*e/S,X-=f,b.move_local(a,0,6*e*d*(1-d),0)):U<V?X&&(b.move_local(a,0,X,0),X=0):U<M?(d=(U-V)/S,e=m*e/S,e=6*e*d*(1-d),b.move_local(a,0,e,0)):(b.set_translation_v(a,v),c.remove_sensor_manifold(a,
d),g&&g())})}};a.auto_rotate=function(a,b){function d(b,e,f){if(1==f)switch(e=c.get_sensor_value(b,e,0),l){case h.MS_TARGET_CONTROLS:h.rotate_pivot(b,e*a,0);break;case h.MS_EYE_CONTROLS:h.rotate(b,e*a,0);break;case h.MS_HOVER_CONTROLS:h.rotate_hover_cam(b,e*a)}}function e(){c.remove_sensor_manifold(k,"AUTO_ROTATE");c.remove_sensor_manifold(k,"DISABLE_AUTO_ROTATE");b()}b=b||function(){};var k=f.get_active_camera(),l=h.get_move_style(k);if(l==h.MS_STATIC)throw"wrong camera type";if(c.check_sensor_manifold(k,
"AUTO_ROTATE"))e();else{var g=c.create_mouse_move_sensor("X"),n=c.create_mouse_move_sensor("Y"),p=c.create_mouse_click_sensor(),r=c.create_elapsed_sensor();c.create_sensor_manifold(k,"DISABLE_AUTO_ROTATE",c.CT_LEVEL,[g,n,p],function(a){return a[0]&&a[2]||a[1]&&a[2]},e);c.create_sensor_manifold(k,"AUTO_ROTATE",c.CT_CONTINUOUS,[r],function(a){return a[0]},d)}}};b4w.module.mixer=function(a,p){function h(){s=q.length=0;y=c(100);g=new Float32Array(y.length);A=new Float32Array(y.length);var a=w.get_speakers();if(a.length){q.push(f());for(var b=0;b<a.length;b++)q.push(l(a[b]));q.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(a){for(var b=new Float32Array(a),c=0,d=0;d<a;d++)b[d]=20*Math.pow(1E3,c),c+=1/(a-1);
return b}function f(){var a=b("MASTER");a.params.push(["VOLUME",w.get_volume(null),0,1,50,!1]);var c=w.get_compressor_params();c&&(a.params.push(["THRESHOLD",c.threshold,-100,0,100,!1]),a.params.push(["KNEE",c.knee,0,40,40,!1]),a.params.push(["RATIO",c.ratio,1,20,20,!1]),a.params.push(["ATTACK",c.attack,0,1,1E3,!1]),a.params.push(["RELEASE",c.release,0,1,1E3,!1]));a.mute=w.is_muted(null)?1:0;a.solo=-1;return a}function b(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function l(a){var c=
b(t.get_object_name(a));c.mute=w.is_muted(a)?1:0;c.solo=0;c.speaker=a;return c}function e(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",w.get_volume(a.speaker),0,1,50,!1]);var b=w.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=w.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",b.Q,
0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);B.clamp(a.active_param,0,a.params.length-1)}}function k(a){for(var b=0;b<q.length;b++){var c=q[b];if(c!=a&&1==c.solo)return!0}return!1}function d(a){for(var b=0;b<q.length;b++){var c=q[b];c!=a&&0==c.mute&&0==c.solo&&w.mute(c.speaker,!1)}}function r(){if(0==q.length)return[0,-1];var a=8*Math.floor(s/8),b=a+7,a=B.clamp(a,0,q.length-1),b=B.clamp(b,0,q.length-1);return[a,b]}var x=p("controls");p("debug");var n=p("hud"),t=p("scenes"),w=p("sfx"),
B=p("util"),q=[],s=0,y=null,g=null,A=null;a.enable_mixer_controls=function(){h();var a=x.create_keyboard_sensor(x.KEY_LEFT_SQ_BRACKET),b=x.create_keyboard_sensor(x.KEY_RIGHT_SQ_BRACKET),c=x.create_keyboard_sensor(x.KEY_SEMI_COLON),f=x.create_keyboard_sensor(x.KEY_SINGLE_QUOTE),l=x.create_keyboard_sensor(x.KEY_SHIFT),m=x.create_timer_sensor(.15),p=x.create_timer_sensor(.05),a=[a,b,c,f,l,m,p],b=function(a,b,c){if(1==c){c=Boolean(x.get_sensor_value(a,b,0))?-1:1;if(q.length){1==c&&s<q.length-1?s++:-1==
c&&0<s&&s--;c=r();for(var d=c[0];d<=c[1];d++)e(q[d])}"SWITCH_STRIP"==b?x.reset_timer_sensor(a,b,5,.3):x.reset_timer_sensor(a,b,5,0)}else x.reset_timer_sensor(a,b,5,10)};x.create_sensor_manifold(null,"SWITCH_STRIP",x.CT_TRIGGER,a,function(a){return(a[0]||a[1])&&!a[4]},b);x.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",x.CT_SHOT,a,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);x.create_sensor_manifold(null,"SWITCH_PARAM",x.CT_SHOT,a,function(a){return(a[0]||a[1])&&a[4]},function(a,b,c){a=Boolean(x.get_sensor_value(a,
b,0))?-1:1;(b=q[s])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});b=function(a,b,c){if(1==c){var d=Boolean(x.get_sensor_value(a,b,2))?-1:1,e=q[s];if(e)switch(c=e.params[e.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],d/c[4]):c[1]+(c[3]-c[2])/c[4]*d,c[1]=B.clamp(c[1],c[2],c[3]),c[0]){case "VOLUME":"MASTER"!=e.id?w.set_volume(e.speaker,c[1]):w.set_volume(null,c[1]);break;case "DIST_REF":d=w.get_positional_params(e.speaker);d.dist_ref=c[1];w.set_positional_params(e.speaker,
d);break;case "ATTENUATION":d=w.get_positional_params(e.speaker);d.attenuation=c[1];w.set_positional_params(e.speaker,d);break;case "DIST_MAX":d=w.get_positional_params(e.speaker);d.dist_max=c[1];w.set_positional_params(e.speaker,d);break;case "EQ_FREQ":d=w.get_filter_params(e.speaker);d.freq=c[1];w.set_filter_params(e.speaker,d);break;case "EQ_Q":d=w.get_filter_params(e.speaker);d.Q=c[1];w.set_filter_params(e.speaker,d);break;case "EQ_GAIN":d=w.get_filter_params(e.speaker);d.gain=c[1];w.set_filter_params(e.speaker,
d);break;case "THRESHOLD":e=w.get_compressor_params();e.threshold=c[1];w.set_compressor_params(e);break;case "KNEE":e=w.get_compressor_params();e.knee=c[1];w.set_compressor_params(e);break;case "RATIO":e=w.get_compressor_params();e.ratio=c[1];w.set_compressor_params(e);break;case "ATTACK":e=w.get_compressor_params();e.attack=c[1];w.set_compressor_params(e);break;case "RELEASE":e=w.get_compressor_params();e.release=c[1];w.set_compressor_params(e);break;default:throw"Unknown strip param";}"INC_DEC"==
b?x.reset_timer_sensor(a,b,6,.3):x.reset_timer_sensor(a,b,6,0)}else x.reset_timer_sensor(a,b,6,10)};x.create_sensor_manifold(null,"INC_DEC",x.CT_TRIGGER,a,function(a){return(a[2]||a[3])&&!a[4]},b);x.create_sensor_manifold(null,"INC_DEC_HOLD",x.CT_SHOT,a,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},b);x.create_sensor_manifold(null,"MUTE_SOLO",x.CT_SHOT,a,function(a){return(a[2]||a[3])&&a[4]},function(a,b,c){if(Boolean(x.get_sensor_value(a,b,2)))(a=q[s])&&0<=a.mute&&("MASTER"!=a.id?0==a.mute?(a.mute=
1,w.mute(a.speaker,!0),1==a.solo&&(a.solo=0,k(a)||d(a))):(a.mute=0,k(a)||w.mute(a.speaker,!1)):0==a.mute?(a.mute=1,w.mute(null,!0)):(a.mute=0,w.mute(null,!1)));else if((a=q[s])&&0<=a.solo)if(0==a.solo)for(a.solo=1,w.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<q.length;b++)c=q[b],c!=a&&0==c.mute&&0==c.solo&&w.mute(c.speaker,!0);else a.solo=0,k(a)?w.mute(a.speaker,!0):d(a)});a=x.create_elapsed_sensor();x.create_sensor_manifold(null,"MIXER_DRAW",x.CT_CONTINUOUS,[a],null,function(){if(q[s])for(var a=
r(),b=a[0];b<=a[1];b++){var c=q[b];n.draw_mixer_strip(c.id,b==s,b%8,c.params,c.active_param,c.mute,c.solo);if(c.speaker&&w.get_filter_params(c.speaker)){w.get_filter_freq_response(c.speaker,y,g,A);for(c=0;c<g.length;c++)g[c]=20*Math.log(g[c])/Math.LN10;n.plot_array("EQ",b%8,g,20,2E4,-10,10)}}});a=x.create_timer_sensor(1);x.create_sensor_manifold(null,"MIXER_UPDATE",x.CT_TRIGGER,[a],null,function(){for(var a=r(),b=a[0];b<=a[1];b++)e(q[b])})}};b4w.module.storage=function(a,p){function h(a){b=a;try{l=window.localStorage}catch(c){f.warn("Applying chrome localStorage bug workaround"),l=null}l||(f.warn("localStorage is not available, initializing temporary storage"),l={})}function c(){return l[b]?JSON.parse(l[b]):{}}var f=p("__print"),b="",l=null;a.init=h;a.set=function(a,f){var d=c();d[a]=String(f);l[b]=JSON.stringify(d)};a.cleanup=function(){delete l[b]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){f.log(c())};h("b4w")};b4w.module.app=function(a,p){function h(){var a=n.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=n.is_paused(),n.pause()):a||n.resume()},!1)}function c(a,b){var c=String(a);b&&(c+="/"+String(b));u.innerHTML=c}function f(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function b(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=
document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}p("animation");var l=p("camera"),e=p("config"),
k=p("constraints"),d=p("controls"),r=p("data"),x=p("debug"),n=p("main"),t=p("physics"),w=p("print"),B=p("scenes"),q=p("transform"),s=p("util"),y=p("vec3");p("quat");var g=null,A=null,u=null,S=new Float32Array(2),I=new Float32Array(3),v=new Float32Array(3),K=new Float32Array(4);new Float32Array(4);a.init=function(a){a=a||{};var f=null,k=function(){},l=!1,p=null,q=null,s=null,t=!0,v=!1,x=!0,y=!0,z=!1,B=!1,I;for(I in a)switch(I){case "canvas_container_id":f=a.canvas_container_id;break;case "callback":k=
a.callback;break;case "do_not_use_onload":break;case "gl_debug":l=a.gl_debug;break;case "show_hud_debug_info":B=a.show_hud_debug_info;break;case "sfx_mix_mode":v=a.sfx_mix_mode;break;case "show_fps":z=a.show_fps;break;case "fps_wrapper_id":s=a.fps_wrapper_id;break;case "fps_elem_id":q=a.fps_elem_id;break;case "error_purge_elements":p=a.error_purge_elements;break;case "report_init_failure":y=a.report_init_failure;break;case "pause_invisible":x=a.pause_invisible;break;case "key_pause_enabled":t=a.key_pause_enabled;
break;default:e.set(I,a[I])}a=function(a){a.keyCode==d.KEY_P&&(n.is_paused()?n.resume():n.pause())};t&&document.addEventListener("keydown",a,!1);e.set("show_hud_debug_info",B);e.set("sfx_mix_mode",v);var L=B||v||null,t=function(){var a;a=f;var d=y,e=p,m=document.createElement("canvas");m.style.cssText="position: absolute;left:0px; top:0px;";if(L){var r=document.createElement("canvas");r.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else r=null;n.init(m,r)?
(A=m,d=document.getElementById(a),d||(w.error('Warning: canvas container "'+a+'" not found, appending to body'),d=document.body),d.appendChild(m),r&&d.appendChild(r),a=d):(d&&b("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",e),a=null);a?(g=a,n.set_check_gl_errors(l),z&&((a=q)?(s&&(document.getElementById(s).style.display="block"),u=document.getElementById(a)):(u=document.createElement("div"),u.innerHTML=0,u.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",
document.body.appendChild(u)),n.set_fps_callback(c)),x&&h(),k(A,!0)):k(A,!1)};"complete"==document.readyState?window.setTimeout(t,0):window.addEventListener("load",t,!1);window.addEventListener("unload",function(){r.cleanup()},!1)};a.get_canvas_container=function(){return g};a.set_onclick=function(a,b){var c=f(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};a.set_onchange=function(a,b){var c=f(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=
function(a,b){var c=f(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=function(a,b,c,e){a||(a=1);b||(b=1);c||(c=1);var f=B.get_active_camera(),g=!1,h=null,n=!1;switch(l.get_move_style(f)){case l.MS_TARGET_CONTROLS:g=!e;break;case l.MS_EYE_CONTROLS:h=B.get_first_character();break;case l.MS_STATIC:return;case l.MS_HOVER_CONTROLS:n=!0}e=d.create_elapsed_sensor();if(t.has_simulated_physics(f)){var p=d.create_collision_sensor(f,null,!0);d.create_sensor_manifold(f,
"CAMERA_COLLISION",d.CT_CONTINUOUS,[e,p],null,function(a,b,c){1==c&&(b=d.get_sensor_payload(a,b,1),c=q.get_translation(a,I),y.sub(c,b,v),y.normalize(v,v),y.scale(v,.01,v),y.add(c,v,c),q.set_translation_v(a,c))})}if(h){var r=q.get_translation(f),u=q.get_rotation(f),u=s.cam_quat_to_mesh_quat(u);r[1]-=.5;t.set_transform(h,r,u);k.append_stiff_trans(f,h,[0,.5,0]);var w=new Float32Array(2),x=!0;t.set_character_move_type(h,t.CM_FLY);d.create_kb_sensor_manifold(f,"TOGGLE_CHAR_MOVE_TYPE",d.CT_SHOT,d.KEY_C,
function(){x=!x;t.set_character_move_type(h,x?t.CM_FLY:t.CM_WALK)})}var A=function(a,b,c){if(l.is_use_distance_limits(a))var d=q.get_translation(a,I),e=l.get_hover_cam_pivot(a,v),d=y.subtract(d,e,I),d=Math.max(y.len(d),1);else d=10;e=q.get_rotation_quat(a,K);b=s.quat_to_dir(e,b,I);b[1]=0;y.normalize(b,b);y.scale(b,d*c,b);l.is_use_distance_limits(a)?(e=l.get_hover_cam_pivot(a,v),y.add(e,b,e),l.translate_hover_cam_v(a,e)):(d=q.get_translation(a,v),y.add(d,b,d),l.translate_hover_cam_v(a,d))},L=function(a,
b){if(l.is_use_distance_limits(a)){var c=l.get_hover_angle_limits(a,S);if(c[0]-c[1]){var d=l.get_hover_cam_angle(a),c=(d-c[1])/(c[0]-c[1]),e=l.get_cam_dist_limits(a),c=Math.max(c,2/e[0]);l.set_hover_cam_angle(a,d-c*b)}}else d=q.get_translation(a,I),c=y.scale(s.AXIS_Y,-b,v),y.add(d,c,d),l.translate_hover_cam_v(a,d)},r=function(c,e,f){if(!p||!d.get_sensor_value(c,"CAMERA_COLLISION",1)){if(1==f){f=d.get_sensor_value(c,e,0);var k=l.get_trans_speed(c);switch(e){case "FORWARD":h?w[0]=1:n?Math.abs(l.get_hover_cam_angle(c))>
Math.PI/4?A(c,s.AXIS_MZ,.1*a*k*f):A(c,s.AXIS_MY,.1*a*k*f):q.move_local(c,0,-a*k*f,0);break;case "BACKWARD":h?w[0]=-1:n?Math.abs(l.get_hover_cam_angle(c))>=Math.PI/4?A(c,s.AXIS_Z,.1*a*k*f):A(c,s.AXIS_Y,.1*a*k*f):q.move_local(c,0,a*k*f,0);break;case "UP":n?L(c,.3*-a*k*f):h||q.move_local(c,0,0,-a*k*f);break;case "DOWN":n?L(c,.3*a*k*f):h||q.move_local(c,0,0,a*k*f);break;case "LEFT":h?w[1]=1:n?A(c,s.AXIS_MX,.1*a*k*f):q.move_local(c,-a*k*f,0,0);break;case "RIGHT":h?w[1]=-1:n?A(c,s.AXIS_X,.1*a*k*f):q.move_local(c,
a*k*f,0,0);break;case "ROT_LEFT":g?l.rotate_pivot(c,2*-b*f,0):l.rotate(c,2*b*f,0);break;case "ROT_RIGHT":g?l.rotate_pivot(c,2*b*f,0):l.rotate(c,2*-b*f,0);break;case "ROT_UP":g?l.rotate_pivot(c,0,2*-b*f):l.rotate(c,0,2*-b*f);break;case "ROT_DOWN":g?l.rotate_pivot(c,0,2*b*f):l.rotate(c,0,2*b*f)}}else switch(e){case "FORWARD":case "BACKWARD":h&&(w[0]=0);break;case "LEFT":case "RIGHT":h&&(w[1]=0)}h&&(t.set_character_move_dir(h,w[0],w[1]),l.get_angles(c,S),S[0]+=Math.PI,S[1]*=-1,t.set_character_rotation(h,
S[0],S[1]))}},u=d.create_keyboard_sensor(d.KEY_W),G=d.create_keyboard_sensor(d.KEY_S),fa=d.create_keyboard_sensor(d.KEY_A),da=d.create_keyboard_sensor(d.KEY_D),C=d.create_keyboard_sensor(d.KEY_R),J=d.create_keyboard_sensor(d.KEY_F),ha=d.create_keyboard_sensor(d.KEY_UP),pa=d.create_keyboard_sensor(d.KEY_DOWN),la=d.create_keyboard_sensor(d.KEY_LEFT),Y=d.create_keyboard_sensor(d.KEY_RIGHT),ja=function(a){return a[0]&&(a[1]||a[2])};n||(d.create_sensor_manifold(f,"FORWARD",d.CT_CONTINUOUS,[e,u],null,r),
d.create_sensor_manifold(f,"BACKWARD",d.CT_CONTINUOUS,[e,G],null,r));g?(d.create_sensor_manifold(f,"ROT_UP",d.CT_CONTINUOUS,[e,ha,C],ja,r),d.create_sensor_manifold(f,"ROT_DOWN",d.CT_CONTINUOUS,[e,pa,J],ja,r),d.create_sensor_manifold(f,"ROT_LEFT",d.CT_CONTINUOUS,[e,la,fa],ja,r),d.create_sensor_manifold(f,"ROT_RIGHT",d.CT_CONTINUOUS,[e,Y,da],ja,r)):n?(d.create_sensor_manifold(f,"LEFT",d.CT_CONTINUOUS,[e,la,fa],ja,r),d.create_sensor_manifold(f,"RIGHT",d.CT_CONTINUOUS,[e,Y,da],ja,r),d.create_sensor_manifold(f,
"FORWARD",d.CT_CONTINUOUS,[e,ha,u],ja,r),d.create_sensor_manifold(f,"BACKWARD",d.CT_CONTINUOUS,[e,pa,G],ja,r),d.create_sensor_manifold(f,"UP",d.CT_CONTINUOUS,[e,J],ja,r),d.create_sensor_manifold(f,"DOWN",d.CT_CONTINUOUS,[e,C],ja,r)):(d.create_sensor_manifold(f,"UP",d.CT_CONTINUOUS,[e,C],ja,r),d.create_sensor_manifold(f,"DOWN",d.CT_CONTINUOUS,[e,J],ja,r),d.create_sensor_manifold(f,"LEFT",d.CT_CONTINUOUS,[e,fa],ja,r),d.create_sensor_manifold(f,"RIGHT",d.CT_CONTINUOUS,[e,da],ja,r),d.create_sensor_manifold(f,
"ROT_UP",d.CT_CONTINUOUS,[e,ha],ja,r),d.create_sensor_manifold(f,"ROT_DOWN",d.CT_CONTINUOUS,[e,pa],ja,r),d.create_sensor_manifold(f,"ROT_LEFT",d.CT_CONTINUOUS,[e,la],ja,r),d.create_sensor_manifold(f,"ROT_RIGHT",d.CT_CONTINUOUS,[e,Y],ja,r));var E=0,r=d.create_mouse_wheel_sensor();d.create_sensor_manifold(f,"MOUSE_WHEEL",d.CT_LEVEL,[r],null,function(b,e,f){1==f&&(e=d.get_sensor_value(b,e,0),g?(f=l.get_eye(b),l.get_pivot(b,I),b=y.dist(I,f),b=-e*b*.1*a,E+=b):n?(q.get_translation(b,I),b=.1*-e*a,E+=b):
(b=e*c,e=B.get_active_camera(),l.change_trans_speed(e,b)))});var ca=0,r=d.create_touch_zoom_sensor();d.create_sensor_manifold(f,"TOUCH_ZOOM",d.CT_LEVEL,[r],null,function(b,c,e,f){1==e&&(c=d.get_sensor_value(b,c,0),g?(e=l.get_eye(b),l.get_pivot(b,I),b=y.dist(I,e),b=-c*b*.005*a,ca+=b):n&&(q.get_translation(b,I),b=.005*-c*a,ca+=b))});d.create_sensor_manifold(f,"ZOOM_INTERPOL",d.CT_CONTINUOUS,[e],null,function(a,b,c){1==c&&(.001<Math.abs(E)||.001<Math.abs(ca))&&(g||n)&&(c=d.get_sensor_value(a,b,0),b=
s.smooth(E,0,c,.1),E-=b,c=s.smooth(ca,0,c,.15),ca-=c,p&&d.get_sensor_value(a,"CAMERA_COLLISION",1)||(n?L(a,.5*-(b+c)):q.move_local(a,0,b+c,0)))});var ua=0,ea=0,ma=0,Aa=0,r=d.create_mouse_move_sensor("X"),u=d.create_mouse_move_sensor("Y"),G=d.create_mouse_click_sensor(),fa=function(a,c,e,f){if(1==e){e=d.get_sensor_value(a,c,1);var g=.003*b,h=.001*b;if(1===d.get_sensor_payload(a,c,0))ua+="X"==f?-e*g:0,ea+="Y"==f?-e*g:0;else if(2===d.get_sensor_payload(a,c,0)||3===d.get_sensor_payload(a,c,0))ma+="X"==
f?-e*h:0,Aa+="Y"==f?-e*h:0}};d.create_sensor_manifold(f,"MOUSE_X",d.CT_LEVEL,[G,r],null,fa,"X");d.create_sensor_manifold(f,"MOUSE_Y",d.CT_LEVEL,[G,u],null,fa,"Y");var O=0,Ea=0,r=d.create_touch_move_sensor("X"),u=d.create_touch_move_sensor("Y"),G=function(a,c,e,f){1==e&&(e=.005*b,a=d.get_sensor_value(a,c,0),O+="X"==f?-a*e:0,Ea+="Y"==f?-a*e:0)};d.create_sensor_manifold(f,"TOUCH_X",d.CT_LEVEL,[r],null,G,"X");d.create_sensor_manifold(f,"TOUCH_Y",d.CT_LEVEL,[u],null,G,"Y");d.create_sensor_manifold(f,"ROT_TRANS_INTERPOL",
d.CT_CONTINUOUS,[e],null,function(a,b,c){if(1==c&&(.001<Math.abs(ua)||.001<Math.abs(ea)||.001<Math.abs(O)||.001<Math.abs(Ea)||.001<Math.abs(ma)||.001<Math.abs(Aa))){var e=d.get_sensor_value(a,b,0);b=s.smooth(ua,0,e,.08);c=s.smooth(ea,0,e,.08);ua-=b;ea-=c;var f=s.smooth(O,0,e,.12),k=s.smooth(Ea,0,e,.12);O-=f;Ea-=k;var m=s.smooth(ma,0,e,.08),e=s.smooth(Aa,0,e,.08);ma-=m;Aa-=e;g?(l.rotate_pivot(a,b+f,c+k),l.move_pivot(a,m,e)):n?(b+f&&A(a,s.AXIS_X,.2*(b+f)),c+k&&(Math.abs(l.get_hover_cam_angle(a))>Math.PI/
4?A(a,s.AXIS_Z,.2*(c+k)):A(a,s.AXIS_Y,.2*(c+k))),l.rotate_hover_cam(a,m-e)):(l.rotate(a,.5*(b+f),.5*-(c+k)),h&&(l.get_angles(a,S),S[0]+=Math.PI,S[1]*=-1,t.set_character_rotation(h,S[0],S[1])))}});d.create_kb_sensor_manifold(f,"DEC_STEREO_DIST",d.CT_SHOT,d.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=l.get_stereo_distance(a);l.set_stereo_distance(a,.9*b)});d.create_kb_sensor_manifold(f,"INC_STEREO_DIST",d.CT_SHOT,d.KEY_RIGHT_SQ_BRACKET,function(a,b,c){b=l.get_stereo_distance(a);l.set_stereo_distance(a,1.1*
b)})};a.disable_camera_controls=function(){for(var a=B.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)d.remove_sensor_manifold(a,b[c])};a.enable_object_controls=function(a){var b=t.is_vehicle_chassis(a)||t.is_vehicle_hull(a),c=function(a,c,e){if(1==e)switch(e=d.get_sensor_value(a,c,0),c){case "FORWARD":b?t.vehicle_throttle(a,1):q.move_local(a,
0,0,1*e);break;case "BACKWARD":b?t.vehicle_throttle(a,-1):q.move_local(a,0,0,-1*e);break;case "LEFT":b?t.vehicle_steer(a,-1):q.move_local(a,1*e,0,0);break;case "RIGHT":b?t.vehicle_steer(a,1):q.move_local(a,-1*e,0,0)}else switch(c){case "FORWARD":case "BACKWARD":b&&t.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":b&&t.vehicle_steer(a,0)}},e=d.create_elapsed_sensor(),f=d.create_keyboard_sensor(d.KEY_W),g=d.create_keyboard_sensor(d.KEY_S),h=d.create_keyboard_sensor(d.KEY_A),k=d.create_keyboard_sensor(d.KEY_D),
l=d.create_keyboard_sensor(d.KEY_UP),n=d.create_keyboard_sensor(d.KEY_DOWN),p=d.create_keyboard_sensor(d.KEY_LEFT),r=d.create_keyboard_sensor(d.KEY_RIGHT),s=function(a){return a[0]&&(a[1]||a[2])};d.create_sensor_manifold(a,"FORWARD",d.CT_CONTINUOUS,[e,f,l],s,c);d.create_sensor_manifold(a,"BACKWARD",d.CT_CONTINUOUS,[e,g,n],s,c);d.create_sensor_manifold(a,"LEFT",d.CT_CONTINUOUS,[e,h,p],s,c);d.create_sensor_manifold(a,"RIGHT",d.CT_CONTINUOUS,[e,k,r],s,c)};a.disable_object_controls=function(a){for(var b=
["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)d.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){d.register_keyboard_events(document,!1);d.register_mouse_events(a,!0);d.register_wheel_events(a,!0);d.register_touch_events(a,!0)};a.disable_controls=function(a){d.unregister_keyboard_events(document);d.unregister_mouse_events(a);d.unregister_wheel_events(a);d.unregister_touch_events(a)};a.enable_debug_controls=function(){d.create_kb_sensor_manifold(null,"CAMERA_SHOT",d.CT_SHOT,
d.KEY_K,function(){x.make_camera_frustum_shot()});d.create_kb_sensor_manifold(null,"LIGHT_SHOT",d.CT_SHOT,d.KEY_L,function(){x.make_light_frustum_shot()});d.create_kb_sensor_manifold(null,"TELEMETRY",d.CT_SHOT,d.KEY_T,function(){x.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",
d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||
a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||
window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=b;a.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=1<d.length?d[1]:""}return b}};b4w.module.preloader=function(a,p){var h,c,f,b,l,e,k,d,r=null;a.create_simple_preloader=function(a){var d=null,e=null,k="#bf9221",p="#000",q;for(q in a)switch(q){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":e=a.background_container_id;break;case "bg_color":p=a.bg_color;break;case "bar_color":k=a.bar_color}a=document.createElement("div");q=document.createElement("div");var s=document.createElement("div"),y=document.createElement("div"),e=document.getElementById(e);
r=document.getElementById(d);a.style.cssText="         z-index: 4;        background-color: "+p+";        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";q.style.cssText="         position: absolute;        left: 50%;        top: 82%;        width: 400px;        height: 20px;        margin-left: -200px;        margin-top: -10px;        border-style:solid;        border-width:2px;        border-color: "+k+";        border-radius: 6px;    ";s.style.cssText=
"         position: absolute;        left: 0px;        top: 1px;        width: 0px;        height: 18px;        background-color: "+k+";        border-radius: 4px;    ";y.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 100%;        height: 100%;        margin-left: -200px;        margin-top: -10px;        text-align: center;        font-size: 17px;        color: #ffffff;        font-family: Verdana;    ";q.appendChild(s);q.appendChild(y);a.appendChild(q);
document.body.appendChild(a);h="SIMPLE";c=a;f=s;b=y;l=e};a.create_rotation_preloader=function(a){var d=null,f=null,k="rgba(0,0,0,0)",p="",q="",s;for(s in a)switch(s){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":f=a.background_container_id;break;case "frame_bg_color":k=a.frame_bg_color;break;case "frame_class":p=a.frame_class;break;case "anim_elem_class":q=a.anim_elem_class}a=document.createElement("div");s=document.createElement("div");var y=document.createElement("div"),
g=document.createElement("div"),f=document.getElementById(f);r=document.getElementById(d);a.style.cssText="         z-index: 4;        background-color: rgba(0,0,0,0);        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";s.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 117px;        height: 117px;        margin-left: -58px;        margin-top: -58px;        background-color: "+k+";    ";y.style.cssText=
"         position: absolute;        left: 0px;        top: 0px;        width: 100%;        height: 100%;        background-position: center;        background-repeat: no-repeat;    ";g.style.cssText="         position: absolute;        width: 100%;        height: 100%;        text-align: center;        margin-top: 38px;        font-size: 36px;        color: #ffffff;        font-family: Arial;        font-weight: bold;    ";y.className=q;s.appendChild(y);s.className=p;s.appendChild(g);a.appendChild(s);
document.body.appendChild(a);h="ROTATION";c=a;e=y;b=g;l=f};a.create_advanced_preloader=function(a){var e=a.preloader_width,p=a.canvas_container_id,e=e/(e-a.img_width),w=document.getElementById(a.preloader_bar_id),B=document.getElementById(a.fill_band_id),q=document.getElementById(a.preloader_caption_id),s=document.getElementById(a.preloader_container_id);a=document.getElementById(a.background_container_id);r=document.getElementById(p);h="ADVANCED";f=w;k=B;d=e;b=q;c=s;l=a};a.update_preloader=function(a){b.innerHTML=
a+"%";"SIMPLE"==h&&(f.style.width=a+"%");"ADVANCED"==h&&(f.style.width=a/d+"%",k.style.width=100-a+"%");"ROTATION"==h&&(e.style.transform="rotate("+a+"deg)");100==a&&(c.style.zIndex=0,r.style.zIndex=1,l&&(l.style.zIndex=0))}};b4w.module.screenshooter=function(a,p){var h=p("main");a.shot=function(){h.canvas_data_url(function(a){console.log("Sending screenshot to server");var f=new XMLHttpRequest;f.open("POST","/screenshot",!1);f.send(a);if(200==f.status||0==f.status)if(f.responseText.length)console.log("Screenshot sent");else throw"Error XHR: responce is empty, POST /screenshot";else throw"Error XHR: "+f.status+", POST /screenshot";})}};if(!window.b4w)throw"Failed to register module ns_compat, load b4w first";b4w.module.ns_compat=function(a,p){for(var h in b4w.module)b4w[h]=b4w.require(h)};b4w.require("ns_compat");
