b4w={module:{},register:function(a,q){var c=b4w.module;if(c[a])throw Error('Module "'+a+'" already registered');c[a]=q},require:function(a){var q=b4w.require,c=b4w.module[a];if(!c)throw Error('Module "'+a+'" not found');c.$j||(c.$j={},c(c.$j,q));return c.$j},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Qk&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function q(){return"24.12.2014 04:04:49"}a.version=function(){return"14.12"};a.type=function(){return"RELEASE"};a.date=q;a.timestamp=function(){var a=q(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Qk&&b4w.module.__version(exports);b4w.module.__config=function(a,q){function c(){return b4w.module_check(a.yb.xi)}var b=q("__print"),g=q("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Ut=g.ra(a.context);a.n={alpha_sort:!0,alpha_sort_threshold:.1,zp:5,$d:1E4,console_verbose:!1,do_not_load_resources:!1,Rj:!1,fv:1.5,ev:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,gf:.01,resolution_factor:1,Ai:1,Hj:3,Ug:!1,Vk:!1,oi:!0,show_hud_debug_info:!1,
hA:!0,ge:"DEPTH",anaglyph_use:!1,wj:!0,Oh:.5,jg:!0,glow:!0,yf:!0,Rf:!0,$f:!0,Jf:!0,gg:!0,Nf:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Vj:!1,Vf:!0,Eh:!0,ya:!0,Kh:!0,water_dynamic:!0,shore_smoothing:!0,ng:!0,kf:1024,zl:512,max_bones:53,hr:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,ek:!0,Ue:!1,Mw:!1,Yl:!1,fo:!1,mr:!1,Ze:!1,gp:!1,cp:!1,Jn:!1,vo:!1,Cq:!1};a.Gu=g.ra(a.n);a.Jd={ua:-1,zo:!1,Re:1};a.controls={Kw:1/120};a.ad={dir:"ASSETS=../../assets/",Fw:15,dq:!0,Bl:!1,Kk:!1};a.mt=g.ra(a.ad);
a.yb={shaders_dir:"../../shaders/",Sx:"include/",yq:"shader_texts",xi:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",px:"./",nq:["b4w.min.js","b4w.full.min.js","webplayer.min.js","src/data.js"]};a.gb={enabled:!0,$d:60,Gg:""};a.Uw=g.ra(a.gb);a.Sh={Jl:1024,Si:1024,bh:384};a.wx=g.ra(a.Sh);a.Ad={jz:!0,hj:!1,hn:!1,Fn:!1,ho:!1};a.Rx=g.ra(a.Ad);a.eh={enabled:!1,ty:"MAIN_OPAQUE",sy:0,Vx:"COLOR"};a.Cu=g.ra(a.eh);a.jt=function(){var b=a.n,c=a.gb,f=a.Sh;switch(b.quality){case a.P_ULTRA:b.ge=
"DEPTH";b.shore_smoothing=!0;b.glow=!0;b.yf=!0;b.Rf=!0;b.$f=!0;b.Jf=!0;b.wj=!0;b.Oh=1;b.jg=!0;b.Vf=!0;b.Eh=!0;b.ya=!0;b.Kh=!0;b.resolution_factor=1.75;f.Jl=2048;f.Si=2048;b.Hj=3;b.oi=!0;b.Rj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.ng=!0;b.antialiasing=!0;b.smaa=!0;b.Nf=!0;b.gg=!0;c.$d=120;break;case a.P_HIGH:b.ge="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.yf=!0;b.Rf=!0;b.$f=!0;b.Jf=!0;b.wj=!0;b.Oh=.5;b.jg=!0;b.Vf=!0;b.Eh=!0;b.ya=!0;b.Kh=!0;b.resolution_factor=1;f.Jl=1024;f.Si=1024;
b.Hj=3;b.oi=!0;b.Rj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.ng=!0;b.antialiasing=!0;b.smaa=!1;b.Nf=!0;b.gg=!0;c.$d=60;break;case a.P_LOW:b.ge="NONE",b.shore_smoothing=!1,b.glow=!1,b.yf=!1,b.Rf=!1,b.$f=!1,b.Jf=!1,b.wj=!1,b.Oh=.5,b.jg=!1,b.Vf=!1,b.Eh=!1,b.ya=!1,b.Kh=!1,b.resolution_factor=1,f.Jl=512,f.Si=512,b.Hj=2,b.oi=!1,b.Rj=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.ng=!1,b.antialiasing=!1,b.smaa=!1,b.Nf=!1,b.gg=!1,c.$d=60}};a.set=function(c,g){switch(c){case "all_objs_selectable":a.n.all_objs_selectable=
g;break;case "alpha":a.context.alpha=g;break;case "alpha_sort":a.n.alpha_sort=g;break;case "alpha_sort_threshold":a.n.alpha_sort_threshold=g;break;case "allow_cors":a.n.Ug=g;break;case "anaglyph_use":a.n.anaglyph_use=g;break;case "animation_framerate":a.Jd.ua=g;break;case "antialiasing":a.n.antialiasing=g;break;case "assets_dds_available":a.ad.Kk=g;break;case "assets_min50_available":a.ad.Bl=g;break;case "background_color":a.n.background_color=g;break;case "built_in_module_name":a.yb.xi=g;break;case "console_verbose":a.n.console_verbose=
g;break;case "context_antialias":a.context.antialias=g;break;case "debug_subs_enabled":a.eh.enabled=g;break;case "deferred_rendering":a.n.deferred_rendering=g;break;case "do_not_load_resources":a.n.do_not_load_resources=g;break;case "force_selectable":a.n.force_selectable=g;break;case "glow":a.n.glow=g;break;case "physics_enabled":a.gb.enabled=g;break;case "physics_uranium_path":a.gb.Gg=g;break;case "precision":a.n.precision=g;break;case "quality":a.n.quality=g;break;case "resolution_factor":a.n.resolution_factor=
g;break;case "sfx_mix_mode":a.Ad.hj=g;break;case "shaders_dir":a.yb.shaders_dir=g;break;case "show_hud_debug_info":a.n.show_hud_debug_info=g;break;case "smaa":a.n.smaa=g;break;case "smaa_search_texture_path":a.yb.smaa_search_texture_path=g;break;case "smaa_area_texture_path":a.yb.smaa_area_texture_path=g;break;case "wireframe_debug":a.n.wireframe_debug=g;break;case "water_wireframe_debug":a.n.Vj=g;break;default:b.error("B4W config set - property unknown: "+c)}};a.get=function(c){switch(c){case "all_objs_selectable":return a.n.all_objs_selectable;
case "allow_cors":return a.n.Ug;case "alpha":return a.context.alpha;case "alpha_sort":return a.n.alpha_sort;case "alpha_sort_threshold":return a.n.alpha_sort_threshold;case "anaglyph_use":return a.n.anaglyph_use;case "animation_framerate":return a.Jd.ua;case "antialiasing":return a.n.antialiasing;case "assets_dds_available":return a.ad.Kk;case "assets_min50_available":return a.ad.Bl;case "background_color":return a.n.background_color;case "built_in_module_name":return a.yb.xi;case "console_verbose":return a.n.console_verbose;
case "context_antialias":return a.context.antialias;case "debug_subs_enabled":return a.eh.enabled;case "deferred_rendering":return a.n.deferred_rendering;case "do_not_load_resources":return a.n.do_not_load_resources;case "force_selectable":return a.n.force_selectable;case "glow":return a.n.glow;case "physics_enabled":return a.gb.enabled;case "physics_uranium_path":return a.gb.Gg;case "precision":return a.n.precision;case "quality":return a.n.quality;case "resolution_factor":return a.n.resolution_factor;
case "sfx_mix_mode":return a.Ad.hj;case "shaders_dir":return a.yb.shaders_dir;case "show_hud_debug_info":return a.n.show_hud_debug_info;case "smaa":return a.n.smaa;case "smaa_search_texture_path":return a.yb.smaa_search_texture_path;case "smaa_area_texture_path":return a.yb.smaa_area_texture_path;case "wireframe_debug":return a.n.wireframe_debug;case "water_wireframe_debug":return a.n.Vj;default:b.error("B4W config get - property unknown: "+c)}};a.reset=function(){a.context=g.ra(a.Ut);a.n=g.ra(a.Gu);
a.ad=g.ra(a.mt);a.gb=g.ra(a.Uw);a.Sh=g.ra(a.wx);a.Ad=g.ra(a.Rx);a.eh=g.ra(a.Cu)};a.ml=c;a.Jx=function(){var d=a.yb,g=a.gb;if(c())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==d.smaa_area_texture_path||""==g.Gg){for(var f=null,h=document.getElementsByTagName("script"),k=0;k<h.length;k++){for(var l=h[k].src,s=0;s<d.nq.length;s++)if(0<=l.indexOf(d.nq[s])){f=l;break}if(null!==f)break}f||(b.warn("Couldn't determine path to external resources, fallback to current page URL"),
f=document.location.href);h=f.indexOf("?");0<=h&&(f=f.substring(0,h));f=f.substring(0,f.lastIndexOf("/")+1)+d.px;g.Gg=g.Gg||f+"uranium.js";d.smaa_search_texture_path=d.smaa_search_texture_path||f+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||f+"smaa_area_texture.png"}};a.get_std_assets_path=function(){return a.ad.dir.replace("ASSETS=","")}};b4w.module.__boundings=function(a,q){function c(a,b){for(var c=a[0],d=a[1],p=a[2],k=a[0],e=a[1],f=a[2],g=3;g<a.length;g+=3)var n=a[g],h=a[g+1],y=a[g+2],c=Math.max(c,n),d=Math.max(d,h),p=Math.max(p,y),k=Math.min(k,n),e=Math.min(e,h),f=Math.min(f,y);b.max_x=c;b.max_y=d;b.max_z=p;b.min_x=k;b.min_y=e;b.min_z=f;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,p=a.max_z,k=a.min_x,e=a.min_y,f=a.min_z;b[0]=k;b[1]=e;b[2]=f;b[3]=c;b[4]=e;b[5]=f;b[6]=c;b[7]=d;b[8]=f;b[9]=k;b[10]=
d;b[11]=f;b[12]=k;b[13]=e;b[14]=p;b[15]=c;b[16]=e;b[17]=p;b[18]=c;b[19]=d;b[20]=p;b[21]=k;b[22]=d;b[23]=p;return b}function g(a,b,c){h.add(b,c,a.t);h.scale(a.t,.5,a.t);a.ma=h.distance(a.t,b);return a}var d=q("__geometry"),m=q("__util"),f=q("__tsr"),h=q("vec3"),k=new Float32Array(24),l=new Float32Array(3),s=new Float32Array(3),n=new Float32Array(3);a.Rn=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.Nz=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Xc=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.mo=function(a,b){var c=a.max_y,d=a.max_z,p=a.min_x,k=a.min_y,e=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,p);a.min_y=Math.min(b.min_y,k);a.min_z=Math.min(b.min_z,e)};a.rt=c;a.pk=function(d,f,g){g||(g=a.Xc());d=b(d,k);m.ce(d,f,d);return c(d,g)};a.Vu=b;a.wB=function(b,c,d){d||
(d=a.Xc());var k=c.min_x,p=c.max_x,f=c.min_y,e=c.max_y,g=c.min_z;c=c.max_z;if(k>=b.max_x||p<=b.min_x||f>=b.max_y||e<=b.min_y||g>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,k);d.max_x=Math.min(b.max_x,p);d.min_y=Math.max(b.min_y,f);d.max_y=Math.min(b.max_y,e);d.min_z=Math.max(b.min_z,g);d.max_z=Math.min(b.max_z,c);return d};a.zB=function(b,c,d){d||(d=a.Xc());var k=b.max_x-b.min_x,p=b.max_y-b.min_y,f=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*k;d.max_x=b.max_x+.5*(c-1)*k;d.min_y=b.min_y-.5*(c-1)*p;d.max_y=b.max_y+.5*(c-1)*p;d.min_z=b.min_z-.5*(c-1)*f;d.max_z=b.max_z+.5*(c-1)*f;return d};a.rk=function(b,c,d){d||(d=a.hi());h.transformMat4(b.t,c,d.t);d.ma=b.ma*m.dj(c);return d};a.qk=function(a,b,c){c||(c={Be:new Float32Array(3),Ce:new Float32Array(3),De:new Float32Array(3),t:new Float32Array([0,0,0])});f.Yh(a.t,b,c.t);h.copy(a.Be,c.Be);h.copy(a.Ce,c.Ce);h.copy(a.De,c.De);f.Ij(c.Be,b,c.Be);f.Ij(c.Ce,b,c.Ce);f.Ij(c.De,b,c.De);
return c};a.Ek=function(a,b){return{ma:a,t:new Float32Array(b)}};a.hi=function(){return{t:new Float32Array([0,0,0]),ma:0}};a.Dk=function(a,b,c,d){return{Be:new Float32Array(a),Ce:new Float32Array(b),De:new Float32Array(c),t:new Float32Array([d[0],d[1],d[2]])}};a.tt=function(){return{t:new Float32Array([0,0,0]),ma:1E12}};a.Tu=function(a,b){var c=h.subtract(b.t,a.t,h.create());0==h.length(c)&&h.set(1,0,0,c);var d=h.normalize(c,h.create()),c=h.scale(d,a.ma,h.create());h.add(c,a.t,c);var p=h.scale(d,
-a.ma,h.create());h.add(p,a.t,p);var k=h.scale(d,b.ma,h.create());h.add(k,b.t,k);var e=h.scale(d,-b.ma,h.create());h.add(e,b.t,e);c=[c,p,k,e];d=h.normalize(d,h.create());p=c[0];k=c[0];for(e=1;e<c.length;e++){var f=h.dot(c[e],d);f<h.dot(p,d)&&(p=c[e]);f>h.dot(k,d)&&(k=c[e])}d=[p,k];c=d[0];d=d[1];a.t=h.scale(h.add(c,d,h.create()),.5,h.create());a.ma=h.length(h.subtract(d,c,h.create()))/2};a.Sn=function(a,b){var c=b.max_y,d=b.min_y,p=Math.max(0,c-d-2*a);return{ma:a,height:p,t:new Float32Array([0,(c+
d)/2,0])}};a.Un=function(a,b){var c=b.max_y,d=b.min_y,p=Math.max(0,c-d);return{ma:a,height:p,t:new Float32Array([0,(c+d)/2,0])}};a.Tn=function(a,b){var c=b.max_y,d=b.min_y,p=Math.max(0,c-d);return{ma:a,height:p,t:new Float32Array([0,(c+d)/2,0])}};a.Rz=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.gx=function(a){for(var b=0,c=0,d=0,p=0,k=0,e=0,f=0,g=0,n=0;n<a.submeshes.length;n++){var h=a.submeshes[n];if(h.position.length){b=
p=h.position[0];c=k=h.position[1];d=e=h.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var h=a.submeshes[n],h=h.position,y=0;y<h.length/3;y++)var l=h[3*y],r=h[3*y+1],D=h[3*y+2],b=Math.max(l,b),c=Math.max(r,c),d=Math.max(D,d),p=Math.min(l,p),k=Math.min(r,k),e=Math.min(D,e),f=Math.max(Math.sqrt(l*l+r*r+D*D),f),g=Math.max(Math.sqrt(l*l+D*D),g);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=p;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=k;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
e;a.b4w_bounding_sphere_radius=f;a.b4w_bounding_cylinder_radius=g};a.Mv=function(b){var c=b.subarray(0,3),k=b.subarray(6,9),f=b.subarray(12,15),p=b.subarray(18,21);b=h.subtract(k,c,l);h.normalize(b,b);var m=d.Ov(c,k,f,s),m=h.cross(m,b,m);h.normalize(m,m);var e=h.create(),t=h.create();h.subtract(k,c,n);t[0]=h.dot(n,b);t[1]=h.dot(n,m);k=h.create();h.subtract(f,c,n);k[0]=h.dot(n,b);k[1]=h.dot(n,m);f=h.create();h.subtract(p,c,n);f[0]=h.dot(n,b);f[1]=h.dot(n,m);p=a.hi();f=[e,t,k,f];e=g(p,f[0],f[1]);for(p=
2;p<f.length;p++)if(h.distance(e.t,f[p])>e.ma){for(var x=e,e=f,t=f[p],k=p-1,x=g(x,t,e[0]),K=1;K<=k;K++)if(h.distance(x.t,e[K])>x.ma){for(var H=x,x=e,y=t,L=e[K],r=K-1,H=g(H,y,L),D=0;D<=r;D++)if(h.distance(H.t,x[D])>H.ma){var G=y,V=L,N=x[D],Z=h.subtract(V,N,n),Z=h.squaredLength(Z),P=h.subtract(G,N,n),M=h.squaredLength(P),P=h.subtract(G,V,n),q=h.squaredLength(P),P=Z*(M+q-Z),Q=M*(q+Z-M),Z=q*(Z+M-q),M=P+Q+Z;h.copy(G,H.t);h.scale(H.t,P/M,H.t);h.scaleAndAdd(H.t,V,Q/M,H.t);h.scaleAndAdd(H.t,N,Z/M,H.t);H.ma=
h.distance(H.t,G)}x=H}e=x}p=e;b=h.scale(b,p.t[0],n);h.scaleAndAdd(b,m,p.t[1],b);h.add(b,c,p.t);return p}};b4w.module.__compat=function(a,q){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}var g=q("__config"),d=q("__extensions"),m=q("__print"),f=q("__util");a.Gx=function(a){var k=g.Jd,l=g.n,s=g.context,
n=g.Sh,w=g.Ad;l.kf=a.getParameter(a.MAX_TEXTURE_SIZE);l.zl=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var u=Boolean(d.Jv());c("Firefox")&&g.ml()&&(m.warn("Firefox detected for single HTML version, disable video textures."),l.vo=!0);c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(m.warn("Firefox 28 detected, applying depth hack"),u=!1);c("iPad")||c("iPhone")?(m.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
s.alpha||(l.background_color[3]=1),l.mr=!0,l.smaa=!1,l.yf=!1,l.precision="highp",l.gp=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(m.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),w.hn=!0,w.Fn=!0);c("Windows")&&(c("Firefox/33")||c("Firefox/34"))&&(m.warn("Windows/Firefox33-34 detected. Applying procedural skydome update hack."),l.Cq=!0);c("Windows")&&(c("Chrome/40")||c("Chrome/41"))&&(m.warn("Windows/Chrome40-41 detected. Applying clear procedural skydome hack."),
l.Jn=!0);b()&&(m.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),l.Ue=!0,l.Ze=!0,c("iPad")||c("iPhone")||(m.warn("Mobile (not iOS) detected, disable playback rate for video textures."),w.ho=!0));10>a.getParameter(a.MAX_VARYING_VECTORS)&&(m.warn("Not enough varyings, disable shadows on blend objects"),l.fo=!0);if(s=d.Mo())c("Macintosh")&&-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(m.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),
u=!1,l.Ue=!0),-1<a.getParameter(s.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(m.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),u=!1,k.zo=!0),-1<a.getParameter(s.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(m.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),l.precision="highp",l.ge="NONE"),-1<a.getParameter(s.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&
-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(m.warn("Qualcomm Adreno detected, applying shader constants hack."),l.Yl=!0,-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(m.warn('Qualcomm Adreno305 detected, set "highp" precision.'),l.precision="highp"),-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(m.warn('Qualcomm Adreno330 detected, set "highp" precision.'),l.precision="highp")),-1<a.getParameter(s.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(s.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&
(m.warn("NVIDIA Tegra 3 detected, force low quality for LEVELS_OF_QUALITY nodes."),l.Vk=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(m.warn("Vertex textures are not allowed. Disabling vertex textures"),l.ek=!1);u||(l.deferred_rendering=!1,l.Vf=!1,l.Eh=!1,l.ya=!1,l.Kh=!1,l.water_dynamic=!1,l.shore_smoothing=!1,l.ng=!1,l.smaa=!1);l.hr=Boolean(d.No());k=f.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);l.max_bones=f.trunc((k-50)/4);l.kB=f.trunc((k-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(l.precision="mediump");!window.ActiveXObject&&"ActiveXObject"in window&&(m.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),n.bh=512,l.cp=!0);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(m.warn("Not enough fragment uniforms, force low quality for LEVELS_OF_QUALITY nodes."),l.Vk=!0)};a.detect_mobile=b};b4w.module.__constraints=function(a,q){function c(a){var b={};b.type=a;return b}function b(a,b){a.$a&&a.$a.K&&g(a.$a.K,a);if(b.K){var r=b.K;if(-1==r.Fd.indexOf(a))r.Fd.push(a);else throw"Descendant object override is forbidden";}a.$a=b}function g(a,b){var r=a.Fd.indexOf(b);if(-1!=r)a.Fd.splice(r,1);else throw"No descendant object";}function d(a,b,c){switch(b.type){case 1:var d=a.d.quat,k=b.K.d.H;c=b.K.d.quat;b.ee?(u.copy(b.ee,d),u.multiply(c,d,d)):u.copy(c,d);w.transformMat4(b.offset,k,a.d.e);a.d.scale=
b.yj*b.K.d.scale;break;case 9:var g=a.d.e,d=a.d.quat,k=b.K.d.H;c=b.K.d.quat;u.multiply(u.invert(b.sf,b.sf),d,d);u.multiply(c,d,d);w.transformMat4(b.offset,k,g);u.copy(c,b.sf);break;case 10:g=a.d.e;d=a.d.quat;k=b.K.d.H;c=b.K.d.quat;u.multiply(u.invert(b.sf,b.sf),d,d);u.multiply(c,d,d);w.transformMat4(b.offset,k,g);u.copy(c,b.sf);var d=a.d.quat,g=b.K.d.quat,x=w.transformQuat(n.AXIS_Y,d,F),k=u.invert(g,t),H=w.transformQuat(x,k,p),q=B;q[0]=H[0];q[1]=0;q[2]=H[2];var R=w.length(q),k=-q[2]/R,k=Math.acos(k)*
n.sign(q[0]),R=R/w.length(H),R=Math.acos(R)*n.sign(H[1]),H=!1;k<-b.En&&(k=-b.En,H=!0);k>b.Gn&&(k=b.Gn,H=!0);R<-b.Hn&&(R=-b.Hn,H=!0);R>b.Dn&&(R=b.Dn,H=!0);H&&(b=Math.sin(R),R=Math.cos(R),H=Math.sin(k),k=Math.cos(k),q=p,q[0]=R*H,q[1]=b,q[2]=-R*k,w.transformQuat(q,g,q),b=u.rotationTo(x,q,t),u.multiply(b,d,d),u.normalize(d,d));"CAMERA"==a.d.type&&(b=w.transformQuat(n.AXIS_Y,c,p),h(a,b));break;case 12:g=a.d.e;d=a.d.quat;k=b.K.d.H;R=b.K.d.e;a=b.Xx;H=F;x=t;w.transformMat4(b.offset,k,H);n.smooth_v(H,g,c,
a,g);b=F;w.sub(R,g,b);w.normalize(b,b);q=d;g=y;k=g.subarray(0,3);R=g.subarray(3,6);H=g.subarray(6,9);w.copy(b,R);w.negate(R,R);w.normalize(R,R);Boolean(.999999<Math.abs(w.dot(b,n.AXIS_Y)))?(b=z.fromQuat(u.normalize(q,x),L),w.copy(b.subarray(0,3),k)):w.cross(n.AXIS_Y,R,k);w.normalize(k,k);w.cross(k,R,H);w.normalize(H,H);u.fromMat3(g,x);u.normalize(x,x);n.Eq(x,d,c,.16*a,d);break;case 2:d=a.d.quat;g=e;c=t;l(b.K,b.xt,!0,g,c);b.ee?(u.copy(b.ee,d),u.multiply(c,d,d)):u.copy(c,d);a.d.scale=b.yj*g[3];n.Yh(b.offset,
g[3],c,g,a.d.e);break;case 3:g=a.d.e;d=a.d.quat;c=b.K.d.e;m(g,d,c);"CAMERA"==a.d.type&&h(a,n.AXIS_Y);break;case 4:g=a.d.e;d=a.d.quat;c=b.target;m(g,d,c);"CAMERA"==a.d.type&&h(a,n.AXIS_Y);break;case 5:g=a.d.e;d=a.d.quat;c=b.K.d.e;d=f(g,d,c,b.wd,r);x=w.dist(g,c);if(b=d?x+b.wd:x>b.Ch?x-b.Ch:x<b.wd?x-b.wd:0)w.sub(c,g,F),w.normalize(F,F),w.scale(F,b,F),w.add(g,F,g);"CAMERA"==a.d.type&&h(a,n.AXIS_Y);break;case 6:g=a.d.e;d=a.d.quat;c=b.target;d=f(g,d,c,b.wd,r);x=w.dist(g,c);if(b=d?x+b.wd:x>b.Ch?x-b.Ch:x<
b.wd?x-b.wd:0)w.sub(c,g,F),w.normalize(F,F),w.scale(F,b,F),w.add(g,F,g);"CAMERA"==a.d.type&&h(a,n.AXIS_Y);break;case 7:k=b.K.d.H;w.transformMat4(b.offset,k,a.d.e);break;case 8:R=b.K.d.e;g=a.d.e;w.add(R,b.offset,g);break;case 13:d=a.d.quat;k=b.K.d.H;c=b.K.d.quat;b.ee?(u.copy(b.ee,d),u.multiply(c,d,d)):u.copy(c,d);w.transformMat4(b.offset,k,a.d.e);break;case 11:c=b.K.d,c=s.Of(c.e,c.scale,c.quat,K),s.multiply(c,b.br,c),g=a.d.e,g[0]=c[0],g[1]=c[1],g[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],
d[2]=c[6],d[3]=c[7]}}function m(a,b,r){var c=F;n.quat_to_dir(b,n.AXIS_MY,c);w.normalize(c,c);var d=p;w.subtract(r,a,d);w.normalize(d,d);a=e;n.sq(c,d,a);u.multiply(a,b,b)}function f(a,b,r,c,d){var k=!1,g=F;n.quat_to_dir(b,n.AXIS_MY,g);w.normalize(g,g);var f=p;w.subtract(r,a,f);a=w.length(f);w.normalize(f,f);w.dot(g,f)<Math.cos(d)&&(w.scale(f,-1,f),k=!0);a>c-.001&&(c=n.sq(g,f,e),u.multiply(c,b,b),u.normalize(b,b));return k}function h(a,b){var r=a.d.quat,c=k(r,b,t);u.multiply(c,r,r)}function k(a,b,r){a=
z.fromQuat(a,y);var c=F;c[0]=a[3];c[1]=a[4];c[2]=a[5];if(.999999<Math.abs(w.dot(b,c)))return u.identity(r),r;b=w.cross(b,c,c);w.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);c=p;c[0]=a[0];c[1]=a[1];c[2]=a[2];w.normalize(c,c);u.rotationTo(c,b,r);return r}function l(a,b,r,c,d){var p=a.d,k=p.Qe,g=p.gc[b];b=g.fh;a=a.pose.bones[g.Ol];var g=a.Um,f=e,n=p.dc,h=p.cc,y=p.Vb,l=p.Ub,m=n[4*b+1],L=n[4*b+2],B=n[4*b+3],w=h[4*b+1],v=h[4*b+2],I=h[4*b+3];f[0]=(1-k)*n[4*b]+k*h[4*b];f[1]=(1-k)*m+k*w;f[2]=(1-k)*
L+k*v;f[3]=(1-k)*B+k*I;n=t;h=x;n[0]=y[4*b];n[1]=y[4*b+1];n[2]=y[4*b+2];n[3]=y[4*b+3];h[0]=l[4*b];h[1]=l[4*b+1];h[2]=l[4*b+2];h[3]=l[4*b+3];u.slerp(n,h,k,n);k=K;s.Nx(f,k);s.Xl(n,k);r?(r=H,s.translate(g,a.Ps,r),s.multiply(k,r,k)):s.multiply(k,g,k);s.multiply(p.Tc,k,k);c[0]=k[0];c[1]=k[1];c[2]=k[2];c[3]=k[3];d&&(d[0]=k[4],d[1]=k[5],d[2]=k[6],d[3]=k[7])}var s=q("__tsr"),n=q("__util"),w=q("vec3"),u=q("quat"),z=q("mat3");q("mat4");a.uz=1;a.tz=2;a.xz=3;a.yz=4;a.oz=5;a.pz=6;a.vz=7;a.nz=8;a.sz=9;a.rz=10;a.Yc=
11;a.qz=12;a.wz=13;var F=new Float32Array(3),p=new Float32Array(3),B=new Float32Array(3),e=new Float32Array(4),t=new Float32Array(4),x=new Float32Array(4),K=new Float32Array(16),H=new Float32Array(16),y=new Float32Array(9),L=new Float32Array(9),K=new Float32Array(8),r=9*Math.PI/10;a.wr=r;a.bn=function(a,r,e,p,k){var g=c(1);g.K=r;g.offset=new Float32Array(e);g.ee=p?new Float32Array(p):null;g.yj=k;b(a,g);d(a,g,0)};a.an=function(a,r,e,p,k,g){var f=c(2);f.K=r;f.xt=e;f.offset=new Float32Array(p);f.ee=
k?new Float32Array(k):null;f.yj=g;b(a,f);d(a,f,0)};a.bt=function(a,r,e,p){var k=c(9),g=a.d.quat,f=r.d.quat;k.K=r;k.offset=new Float32Array(e);k.sf=new Float32Array(f);p&&(u.copy(p,g),u.multiply(f,g,g));b(a,k);d(a,k,0)};a.at=function(a,r,e,p,k,g,f,n){var h=c(10),y=a.d.quat,l=r.d.quat;h.K=r;h.offset=new Float32Array(e);h.sf=new Float32Array(l);h.En=k;h.Gn=g;h.Hn=f;h.Dn=n;p&&(u.copy(p,y),u.multiply(l,y,y));b(a,h);d(a,h,0)};a.$s=function(a,r,e,p){var k=c(12);k.K=r;k.offset=new Float32Array(e);k.Xx=p;
b(a,k);d(a,k,0)};a.dt=function(a,r,e,p){var k=c(13);k.K=r;k.offset=new Float32Array(e);k.yj=1;k.ee=p?new Float32Array(p):null;b(a,k);d(a,k,0)};a.ft=function(a,r){var e=c(3);e.K=r;b(a,e);d(a,e,0)};a.gt=function(a,r){var e=c(4);e.target=new Float32Array(r);b(a,e);d(a,e,0)};a.Xs=function(a,r,e,p){var k=c(5);k.K=r;k.wd=e;k.Ch=p;b(a,k);d(a,k,0)};a.Ys=function(a,r,e,p){var k=c(6);k.target=new Float32Array(r);k.wd=e;k.Ch=p;b(a,k);d(a,k,0)};a.ct=function(a,r,e){var p=c(7);p.K=r;p.offset=new Float32Array(e);
b(a,p);d(a,p,0)};a.Ws=function(a,r,e){var p=c(8);p.K=r;p.offset=new Float32Array(e);b(a,p);d(a,p,0)};a.Vs=function(a,r,e){var p=c(11);p.K=r;p.br=new Float32Array(e);b(a,p);d(a,p,0)};a.Ky=function(a,b){a.$a&&d(a,a.$a,b)};a.qx=m;a.rx=f;a.correct_up=h;a.Pz=k;a.remove=function(a){a.$a.K&&g(a.$a.K,a);a.$a=null};a.rd=function(a){return a.$a?a.$a.type:null};a.EA=function(a){return a.$a&&a.$a.K?a.$a.K:null};a.qd=function(a){return a.$a&&11==a.$a.type?a.$a.br:null};a.Cv=l};b4w.module.__controls=function(a,q){function c(a){return{type:a,value:0,Tb:null,wl:null,vl:null,cj:null,Pd:!1,key:0,Qb:"",yk:null,Dl:!1,xk:function(){},wk:null,Kn:function(){},Nc:null,im:new Float32Array(3),Pk:new Float32Array(3),ul:!1,iq:function(){},axis:"",bc:0,Dg:new Float32Array(3),uj:new Float32Array(4),threshold:0,gq:new Float32Array(4),ri:0,qi:0,rq:0,si:0,Gh:0,jn:!1}}function b(a,b){var r;if(a.cj){r=a.wl;for(var e=a.vl,c=0;c<r.length;c++)e[c]=r[c].value;r=a.cj(e)}else r=!1;r||(a.value=Number(b))}
function g(a){a=y.indexOf(a);-1<a?y.splice(a,1):p.error("Wrong object")}function d(a,b){for(var r=0,e=0;e<b.length;e++)for(var c=b[e].xe,p=0;p<c.length;p++)for(var A=c[p].Lc,d=0;d<A.length;d++)A[d]===a&&r++;return r}function m(a,b){switch(a.type){case 80:B.remove_collision_test(a.yk,a.Qb,a.xk);a.Pd=!0;break;case 90:B.clear_collision_impulse_test(a.wk);a.Pd=!0;break;case 100:B.remove_ray_test(a.Nc,a.Qb,a.im,a.Pk,a.ul),a.Pd=!0}var r=b.indexOf(a);-1<r&&b.splice(r,1)}function f(a){for(var r=0;r<L.length;r++){var e=
L[r];20==e.type&&a.keyCode==e.key&&b(e,1)}E&&a.preventDefault()}function h(a){for(var r=0;r<L.length;r++){var e=L[r];20==e.type&&0==a.keyCode&&16==e.key&&b(e,0);20==e.type&&a.keyCode==e.key&&b(e,0)}E&&a.preventDefault()}function k(a){var r=!1,c=null;G=a.clientX;V=a.clientY;for(var p=0;p<L.length;p++){var d=L[p];50==d.type&&(b(d,1),d.Tb=a.which);160==d.type&&(r||(c=e.pick_object(a.clientX,a.clientY),r=!0),d.value=c==d.Nc?1:0)}aa&&a.preventDefault()}function l(a){for(var r=0;r<L.length;r++){var e=L[r];
50==e.type&&b(e,0);160==e.type&&e.jn&&(e.value=0)}aa&&a.preventDefault()}function s(a){var r=a.clientX,e=a.clientY;G=r;V=e;for(var r=r-N,e=e-Z,c=Math.sqrt(r*r+e*e),p=0;p<L.length;p++){var d=L[p];if(40===d.type)switch(d.axis){case "X":b(d,r);break;case "Y":b(d,e);break;case "XY":b(d,c)}}aa&&a.preventDefault()}function n(a){var r=a.wheelDelta||-40*a.detail,r=r*H.Kw;D+=r;for(r=0;r<L.length;r++){var e=L[r];30===e.type&&b(e,D)}ma&&a.preventDefault()}function w(a){a=a.targetTouches;if(1==a.length){var b=
a[0];a=b.pageX;for(var b=b.pageY,r=!1,c=null,p=0;p<L.length;p++){var d=L[p];160==d.type&&(r||(c=e.pick_object(a,b),r=!0),d.value=c==d.Nc)}O[0]=a;O[1]=-1;Q[0]=b;Q[1]=-1}else 1<a.length&&(R=T=z(a),O[0]=a[0].pageX,O[1]=a[1].pageX,Q[0]=a[0].pageY,Q[1]=a[1].pageY);P.set(O);M.set(Q)}function u(a){var r=a.targetTouches;if(0!==r.length){if(1===r.length){P[0]=r[0].pageX;P[1]=-1;M[0]=r[0].pageY;M[1]=-1;var r=P[0]-O[0],e=M[0]-Q[0],c=Math.sqrt(r*r+e*e);if(-1!=O[1]&&-1!=Q[1]){var p=P[0]-O[1],d=M[0]-Q[1],A=Math.sqrt(p*
p+d*d);A<c&&(r=p,e=d,c=A)}for(p=0;p<L.length;p++)if(d=L[p],60===d.type)switch(d.axis){case "X":b(d,r);break;case "Y":b(d,e);break;case "XY":b(d,c)}}else if(1<r.length)for(P[0]=r[0].pageX,P[1]=r[1].pageX,M[0]=r[0].pageY,M[1]=r[1].pageY,R=z(r),r=R-T,p=0;p<L.length;p++)d=L[p],70===d.type&&b(d,r);v&&a.preventDefault()}}function z(a){var b=a[0],r=a[1];a=b.pageX;var b=b.pageY,e=r.pageX,r=r.pageY;return Math.sqrt((a-e)*(a-e)+(b-r)*(b-r))}var F=q("__config"),p=q("__print"),B=q("__physics"),e=q("__scenes"),
t=q("__util"),x=q("vec3"),K=q("quat"),H=F.controls,y=[],L=[],r={},D=0,G=0,V=0,N=0,Z=0,P=new Float32Array(2),M=new Float32Array(2),O=new Float32Array(2),Q=new Float32Array(2),R=0,T=0,ja=0,Y=!1,W=0,E=!1,aa=!1,ma=!1,v=!1;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(e,c){ja=e;for(var p=0;p<L.length;p++){var d=L[p],k=e,g=c;if(g)switch(d.type){case 110:var A=d.Nc,f=A.d.e,A=A.d.quat,v=x.dist(d.Dg,f),n=d.gq;K.invert(d.uj,n);K.multiply(A,n,n);K.normalize(n,n);n=Math.abs(2*
Math.acos(n[3]));v/=g;d.ri=t.smooth(v,d.ri,g,.3);d.Tb[0]=v;v=n/g;d.qi=t.smooth(v,d.qi,g,.3);d.Tb[1]=v;d.ri>=d.threshold||d.qi>=d.rq?b(d,1):b(d,0);x.copy(f,d.Dg);K.copy(A,d.uj);d.bc=k;break;case 120:A=d.Nc;f=A.d.e;A=Math.abs(f[1]-d.Dg[1])/g;d.si=t.smooth(A,d.si,g,.3);d.Tb=A;d.si>=d.threshold?b(d,1):b(d,0);x.copy(f,d.Dg);d.bc=k;break;case 130:k-d.bc>=d.Gh&&(b(d,1),d.bc=k);break;case 140:d.bc||(d.bc=k);b(d,k-d.bc);d.bc=k;break;case 150:b(d,k)}}for(p=0;p<y.length;p++)for(g=y[p],d=g.xe,k=0;k<d.length;k++)if(f=
d[k],f.er!=W){f.er=W;for(var A=f,v=A.Lc,n=A.Bx,h=0;h<v.length;h++)n[h]=v[h].value;var A=A.Aw(n),v=f,n=v.qp,l=h=void 0;switch(v.type){case a.CT_CONTINUOUS:A?l=h=1:1==n?l=h=-1:h=0;break;case a.CT_TRIGGER:A&&-1==n?l=h=1:A||1!=n?h=0:l=h=-1;break;case a.CT_SHOT:A&&-1==n?l=h=1:A||1!=n?h=0:(h=0,l=-1);break;case a.CT_LEVEL:h=v.pp!=A?1:0;break;default:t.da("Wrong sensor manifold type: "+v.type)}l&&(v.qp=l);if(v=h)if(n=g==r?null:g,Y=!1,f.callback(n,f.id,v,f.Bt),f.pp=A,Y){p=-1;break}}for(p=0;p<y.length;p++)for(g=
y[p],d=g.xe,k=0;k<d.length;k++)for(f=d[k],g=f.Lc,f=0;f<g.length;f++)switch(A=g[f],A.type){case 30:b(A,0);break;case 40:b(A,0);break;case 60:b(A,0);break;case 70:b(A,0);break;case 130:b(A,0)}D=0;N=G;Z=V;O.set(P);Q.set(M);T=R;W++};a.create_custom_sensor=function(a){var r=c(10);b(r,a);return r};a.create_keyboard_sensor=function(a){var b=c(20);b.key=a;return b};a.create_collision_sensor=function(a,r,e){if(!a||!a.j)return p.error("Wrong collision object"),null;var d=c(80);d.yk=a;d.Qb=r||"ANY";d.Dl=e;d.xk=
function(a,r){b(d,a);a&&r&&e&&(d.Tb=d.Tb||new Float32Array(3),d.Tb[0]=r[0],d.Tb[1]=r[1],d.Tb[2]=r[2])};d.Pd=!0;return d};a.create_collision_impulse_sensor=function(a){if(!a||!a.j)return p.error("Wrong collision impulse object"),null;var r=c(90);r.wk=a;r.Kn=function(a){b(r,a)};r.Pd=!0;return r};a.create_ray_sensor=function(a,r,e,d,k){if(!a)return p.error("Wrong collision object"),null;var g=c(100);g.Nc=a;g.im=r;g.Pk=e;g.ul=d;g.Qb=k||"ANY";g.iq=function(a,r){b(g,a);a&&(g.Tb=r)};g.Pd=!0;return g};a.create_mouse_click_sensor=
function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var b=c(40);b.axis=a||"XY";return b};a.create_touch_move_sensor=function(a){var b=c(60);b.axis=a||"XY";return b};a.create_touch_zoom_sensor=function(){return c(70)};a.create_motion_sensor=function(a,b,r){if(!a)return p.error("Wrong collision object"),null;var e=c(110);e.Nc=a;var d=a.d.e;a=a.d.quat;e.gq=new Float32Array(4);e.Dg=new Float32Array(d);e.uj=new Float32Array(a);e.ri=0;e.qi=
0;e.threshold=b;e.rq=r;e.bc=0;e.Tb=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=function(a,b){if(!a)return p.error("Wrong collision object"),null;var r=c(120);r.Nc=a;var e=a.d.quat;r.Dg=new Float32Array(a.d.e);r.uj=new Float32Array(e);r.si=0;r.threshold=b;r.bc=0;r.Tb=0;return r};a.create_timer_sensor=function(a){var b=c(130);b.Gh=a;b.bc=ja;return b};a.reset_timer_sensor=function(a,b,e,c){a=a||r;c=c||0;a=a.Ac;if(!a||!a[b])return p.error("reset_timer_sensor(): wrong object"),
null;b=a[b].Lc[e];if(!b)return p.error("reset_timer_sensor(): sensor not found"),null;b.bc=ja+c};a.create_elapsed_sensor=function(){var a=c(140);a.bc=0;return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,b){var r=c(160);r.Nc=a;r.jn=b;return r};a.Ax=b;a.get_sensor_value=function(a,b,e){a=a||r;a=a.Ac;if(!a||!a[b])return p.error("get_sensor_value(): wrong object"),null;b=a[b].Lc[e];return b?b.value:(p.error("get_sensor_value(): sensor not found"),null)};
a.get_sensor_payload=function(a,b,e){a=a||r;a=a.Ac;if(!a||!a[b])return p.error("get_sensor_payload(): wrong object"),null;b=a[b].Lc[e];return b?b.Tb:(p.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){y=[];L=[];r={};ja=0};a.check_sensor_manifold=function(a,b){a=a||r;if(!a.Ac)return!1;if(b&&a.Ac[b])return!0;if(!b)for(var e in a.Ac)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||r;var e=a.Ac,c=a.xe;if(b){var p=e[b];if(p){for(var k=p.Lc,A=0;A<k.length;A++)1===
d(k[A],y)&&m(k[A],L);delete e[b];p=c.indexOf(p);-1<p?c.splice(p,1):t.da("Incorrect manifolds array");Object.getOwnPropertyNames(e).length||g(a)}}else{for(b in e){p=e[b];k=p.Lc;for(A=0;A<k.length;A++)1===d(k[A],y)&&m(k[A],L);delete e[b];p=c.indexOf(p);-1<p?c.splice(p,1):t.da("Incorrect manifolds array")}g(a);Y=!0}};a.create_sensor_manifold=function(a,b,e,c,p,k,A){a=a||r;a.Ac=a.Ac||{};a.xe=a.xe||[];var g=a.Ac,f=a.xe,G=g[b];if(G){c=G.Lc;for(var v=0;v<c.length;v++)1===d(c[v],y)&&m(c[v],L);G=f.indexOf(G);
-1<G?f.splice(G,1):t.da("Incorrect manifolds array")}e={id:b,type:e,Lc:c.slice(0),Aw:p,Bx:Array(c.length),callback:k,Bt:A,qp:-1,pp:0,er:-1};g[b]=e;f.push(e);-1==y.indexOf(a)&&y.push(a);a=e.Lc;for(b=0;b<a.length;b++){g=a[b];if(g.Pd){switch(g.type){case 80:B.append_collision_test(g.yk,g.Qb,g.xk,g.Dl);break;case 90:B.apply_collision_impulse_test(g.wk,g.Kn);break;case 100:B.append_ray_test(g.Nc,g.Qb,g.im,g.Pk,g.ul,g.iq)}g.Pd=!1}-1==L.indexOf(g)&&L.push(g)}Y=!0};a.Mk=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];
return a[a.length-1]};a.Fu=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<y.length;a++){var b=y[a],r=b.Ac,b=b.xe,e;for(e in r)delete r[e];b.splice(0,b.length)}for(a=0;a<L.length;a++)m(L[a],L),a--;y.splice(0,y.length)};a.debug=function(){p.log(String(y.length)+" objects with manifolds",y);p.log(String(L.length)+" sensors",L);for(var a=[],b=[],r=0;r<L.length;r++){var e=L[r];80==e.type&&a.push(e);100==e.type&&b.push(e)}p.log(String(a.length)+
" collision sensors",a);p.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",f,!1);a.addEventListener("keyup",h,!1);E=b};a.register_mouse_events=function(a,b){a.addEventListener("mousedown",k,!1);a.addEventListener("mousemove",s,!1);a.addEventListener("mouseout",l,!1);a.addEventListener("mouseup",l,!1);aa=b};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",n,!1);a.addEventListener("DOMMouseScroll",n,!1);ma=b};a.register_touch_events=
function(a,b){a.addEventListener("touchstart",w,!1);a.addEventListener("touchmove",u,!1);document.addEventListener("touchstart",function(){});v=b};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",f,!1);a.removeEventListener("keyup",h,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",k,!1);a.removeEventListener("mousemove",s,!1);a.removeEventListener("mouseout",l,!1);a.removeEventListener("mouseup",l,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",
n,!1);a.removeEventListener("DOMMouseScroll",n,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",w,!1);a.removeEventListener("touchmove",u,!1);document.removeEventListener("touchstart",function(){})}};b4w.module.__curve=function(a,q){function c(a,b,c,d,g){var s=d.length;g||(g=new Float32Array(s));for(var n=s+a,w=new Float32Array(n),u=1;u<=n-1;u++)w[u-1]=b>=c[u-1]&&b<c[u+1-1]?1:0;for(var z=2;z<=a;z++)for(u=1;u<=n-z;u++)w[u-1]=(0!=w[u-1]?(b-c[u-1])*w[u-1]/(c[u+z-1-1]-c[u-1]):0)+(0!=w[u+1-1]?(c[u+z-1]-b)*w[u+1-1]/(c[u+z-1]-c[u+1-1]):0);b==c[n-1]&&(w[s-1]=1);a=0;for(u=1;u<=s;u++)a+=w[u-1]*d[u-1];for(u=1;u<=s;u++)g[u-1]=0!=a?w[u-1]*d[u-1]/a:0;return g}function b(a){a=a.aj;return a[a.length-1]}function g(a){a=
a.Zn;return a[a.length-1]}var d=q("__util");a.ru=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var k=a.order_u;b.be=k;a=a.points;var g=a.length/5,s=[],n=g+k,g=g+2;s[0]=0;for(var w=2;w<=n;w++)s[w-1]=w>k&&w<g?s[w-2]+1:s[w-2];b.aj=s;if("2D"==d.dimensions)b.Xd=!1;else if("3D"==d.dimensions)b.Xd=!0;else throw"Wrong curve dimensions";k=[];s=[];for(d=0;d<a.length;d+=5)k.push(a[d]),k.push(a[d+1]),k.push(a[d+2]),b.Xd&&k.push(a[d+3]),s.push(a[d+4]);b.Ck=
k;b.Fm=s;a=[];for(var d=b.Ck,k=b.Xd?4:3,s=b.Fm,n=b.aj,g=b.be,w=d.length/k,u=w+g,z=0,F=n[u-1]/999,p=0;1E3>p;p++){5E-6>n[u-1]-z&&(z=n[u-1]);for(var B=c(g,z,n,s),e=0;e<k;e++)for(var t=a[k*p+e]=0;t<w;t++)a[k*p+e]+=B[t]*d[k*t+e];z+=F}k=b.Xd?4:3;s=new Float32Array(1E3);s[0]=0;for(d=1;1E3>d;d+=1)n=a[(d-1)*k],g=a[(d-1)*k+1],w=a[(d-1)*k+2],u=a[d*k],z=a[d*k+1],F=a[d*k+2],s[d]=s[d-1]+Math.sqrt((u-n)*(u-n)+(z-g)*(z-g)+(F-w)*(F-w));b.Zn=s;return b};a.iy=function(a,d,g){g||(g=[]);var k=d,l=Math.max(k,0);d=l=Math.min(k,
b(a));var k=a.Ck,l=a.Xd?4:3,s=a.Fm,n=a.aj,w=a.be;a=k.length/l;var u=a+w;5E-6>n[u-1]-d&&(d=n[u-1]);u=new Float32Array(a);c(w,d,n,s,u);for(d=0;d<l;d++)for(s=g[d]=0;s<a;s++)g[d]+=u[s]*k[l*s+d]};a.fy=function(a,b,c){c||(c=[]);var d=a.Ck,g=a.Xd?4:3,s=a.Fm,n=a.aj,w=a.be;a=d.length/g;var u=a+w;5E-6>n[u-1]-b&&(b=n[u-1]);var u=new Float32Array(a),z=b;b=u;var F=s.length;b||(b=new Float32Array(F));var p=new Float32Array(F),B=new Float32Array(F),e=p,t=B;e||(e=new Float32Array(F));t||(t=new Float32Array(F));for(var x=
F+w,K=new Float32Array(x),H=new Float32Array(x),y=1;y<=x-1;y++)K[y-1]=z>=n[y-1]&&z<n[y+1-1]?1:0;z==n[x-1]&&(K[F-1]=1);for(var L=2;L<=w;L++)for(y=1;y<=x-L;y++){var r=0!=K[y-1]?K[y-1]/(n[y+L-1-1]-n[y-1]):0,D=0!=K[y+1-1]?-K[y+1-1]/(n[y+L-1]-n[y+1-1]):0,G=0!=H[y-1]?(z-n[y-1])*H[y-1]/(n[y+L-1-1]-n[y-1]):0,V=0!=H[y+1-1]?(n[y+L-1]-z)*H[y+1-1]/(n[y+L-1]-n[y+1-1]):0;K[y-1]=(0!=K[y-1]?(z-n[y-1])*K[y-1]/(n[y+L-1-1]-n[y-1]):0)+(0!=K[y+1-1]?(n[y+L-1]-z)*K[y+1-1]/(n[y+L-1]-n[y+1-1]):0);H[y-1]=r+D+G+V}for(y=1;y<=
F;y++)e[y-1]=K[y-1],t[y-1]=H[y-1];n=0;for(w=1;w<=F;w++)n+=p[w-1]*s[w-1];z=0;for(w=1;w<=F;w++)z+=B[w-1]*s[w-1];for(w=1;w<=F;w++)b[w-1]=0!=n?B[w-1]*s[w-1]/n+p[w-1]*s[w-1]*z/(n*n):0;for(s=0;s<g;s++)for(n=c[s]=0;n<a;n++)c[s]+=u[n]*d[g*n+s]};a.xB=b;a.hy=g;a.gy=function(a,c){if(0>=c)return 0;var h=b(a);if(c>=g(a))return h;var k=a.Zn,l=d.ui(k,c,0,k.length-1);return h*(l+(c-k[l])/(k[l+1]-k[l]))/1E3}};b4w.module.__dds=function(a,q){function c(a,b,c,d){var k=new Uint16Array(4),g=new Uint16Array(c*d),p=0,f=0,e=0,h=f=p=0,l=0,m=0,H=0,y=c/4;d/=4;for(var L=0;L<d;L++)for(var r=0;r<y;r++)e=b+4*(L*y+r),k[0]=a[e],k[1]=a[e+1],p=k[0]&31,f=k[0]&2016,h=k[0]&63488,l=k[1]&31,m=k[1]&2016,H=k[1]&63488,k[2]=5*p+3*l>>3|5*f+3*m>>3&2016|5*h+3*H>>3&63488,k[3]=5*l+3*p>>3|5*m+3*f>>3&2016|5*H+3*h>>3&63488,p=a[e+2],f=4*L*c+4*r,g[f]=k[p&3],g[f+1]=k[p>>2&3],g[f+2]=k[p>>4&3],g[f+3]=k[p>>6&3],f+=c,g[f]=k[p>>8&3],g[f+1]=k[p>>
10&3],g[f+2]=k[p>>12&3],g[f+3]=k[p>>14],p=a[e+3],f+=c,g[f]=k[p&3],g[f+1]=k[p>>2&3],g[f+2]=k[p>>4&3],g[f+3]=k[p>>6&3],f+=c,g[f]=k[p>>8&3],g[f+1]=k[p>>10&3],g[f+2]=k[p>>12&3],g[f+3]=k[p>>14];return g}function b(a,b,d,g){var z=new Int32Array(d,0,31),F,p,B,e,t,x;if(542327876!=z[0])return f.error("Invalid magic number in DDS header"),0;if(!z[20]&4)return f.error("Unsupported format, must contain a FourCC code"),0;F=z[21];switch(F){case h:p=8;B=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case k:p=16;B=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case l:p=16;B=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return f.error("Unsupported FourCC code:",m(F)),null}x=1;z[2]&131072&&!1!==g&&(x=Math.max(1,z[7]));e=z[4];t=z[3];z=z[1]+4;if(b)for(F=0;F<x;++F)g=Math.max(4,e)/4*Math.max(4,t)/4*p,b=new Uint8Array(d,z,g),a.compressedTexImage2D(a.TEXTURE_2D,F,B,e,t,0,b),z+=g,e=Math.max(.5*e,1),t=Math.max(.5*t,1);else if(F==h)Math.max(4,e),Math.max(4,t),b=new Uint16Array(d),d=c(b,z/2,e,t),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,e,t,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),g&&a.generateMipmap(a.TEXTURE_2D);else return f.error("No manual decoder for",m(F),"and no native support"),0;return x}function g(a,c,d,k,g,f){var p=new XMLHttpRequest;p.open("GET",d,!0);p.responseType="arraybuffer";p.onload=function(){if(200==p.status){a.bindTexture(a.TEXTURE_2D,k);var d=b(a,c,p.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}f&&
f(k)};p.send(null);return k}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function m(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var f=q("__print"),h=d("DXT1"),k=d("DXT3"),l=d("DXT5");a.jA=c;a.Wy=b;a.Ro=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Gv=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case h:b=6;break;case k:case l:b=4;break;default:f.error("Unsupported FourCC code:",m(a))}return b};
a.eB=g;a.dB=function(a,b,c,d){var k=a.createTexture();g(a,b,c,k,!0,d);return k}};b4w.module.__debug=function(a,q){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&f.da("Structure assertion failed: incompatible types");for(var e in a)e in b||f.da("Structure assertion failed: missing key in the first object: "+e);for(e in b)e in a||f.da("Structure assertion failed: missing key in the second object: "+e),typeof a[e]!=typeof b[e]&&f.da("Structure assertion failed: incompatible types for key "+e)}var g=
q("__extensions"),d=q("__print"),m=q("__textures"),f=q("__util"),h=null,k={},l=!1,s={},n=[],w=-1,u=null,z=!1;a.Qm={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Xb=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),e;for(e in b){var c=b[e];c in a&&(k[a[c]]=c)}h=a};a.It=function(a){if(l){var b=h.getError();if(b!=h.NO_ERROR){if(b in k)throw"B4W Error: "+b+", gl."+k[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Ft=function(){if(l)switch(h.checkFramebufferStatus(h.FRAMEBUFFER)){case h.FRAMEBUFFER_COMPLETE:break;case h.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case h.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case h.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case h.FRAMEBUFFER_UNSUPPORTED:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.Bn=function(){if(-1!=w)return w;h.bindFramebuffer(h.FRAMEBUFFER,h.createFramebuffer());var a=m.Gi("DEBUG",m.Pg);m.resize(a,1,1);h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,a.Ab,a.Ha,0);h.checkFramebufferStatus(h.FRAMEBUFFER)!=h.FRAMEBUFFER_COMPLETE?(w=!0,d.warn("B4W warning: depth-only issue was found")):w=!1;h.bindFramebuffer(h.FRAMEBUFFER,
null);return w};a.Jt=function(a,b,e){if(l&&!h.getShaderParameter(a,h.COMPILE_STATUS))throw e=c(e),d.error("B4W Error: shader compilation failed:\n"+e+"\n"+h.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Kt=function(a,b,e,k,f,n){if(l&&!h.getProgramParameter(a,h.LINK_STATUS)){var H=g.Fo();H&&(f=H.getTranslatedShaderSource(e),n=H.getTranslatedShaderSource(k));f=c(f);n=c(n);d.error("B4W Error: shader linking failed:\n"+f+"\n\n\n"+n+"\n"+h.getProgramInfoLog(a)+" ("+
b+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){l=a};a.kA=function(a){s[a]=a in s?s[a]+1:1};a.update=function(){for(var a in s)d.log(a,s[a]),s[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var e=arguments[b];if(f.is_vector(e))for(var c=0;c<e.length;c++)a.push(e[c]);else a.push(arguments[b])}n.push(a)};a.msg=function(){for(var a=1,b=0;b<n.length;b++){var e=n[b];e[1]==arguments[0]&&a++}e=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],f.is_vector(a))for(var c=0;c<a.length;c++)e.push(a[c]);else e.push(arguments[b]);n.push(e)};var F=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,e={},c=Math.max(0,performance.now()-1E3*a),k=0;k<n.length;k++){var g=n[k];a=g[0];if(!(a<c)){var f=String(g[1]);e[f]||(e[f]=F[b++%F.length]);a=["%c"+(a/1E3).toFixed(6),e[f],f];for(f=2;f<g.length;f++)a.push(g[f]);d.log.apply(this,a)}}n.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},e=Math.max(0,performance.now()-1E3*a),c=0;c<n.length;c++){var k=n[c];a=k[0];if(!(a<e))for(var g=2;g<k.length;g++){var f=String(k[1]);3<k.length&&(f+="_"+String(g-2));b[f]||(b[f]=f+"\n");b[f]+=String(a)+" "+k[g]+"\n"}}a="";for(f in b)a+=b[f]+"\n\n";d.log(a);n.splice(0)};a.Sz=function(a){function b(a){return-1<e.indexOf(a)?!0:!1}var e=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(f.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.Lz=function(a,b){typeof a!=b&&f.da("Type assertion failed: value type is not a {"+b+"}:",a)};a.Jz=b;a.Kz=function(a){z?b(a,
u):z=!0;u=a}};b4w.module.__extensions=function(a,q){function c(a){if(a in d)return d[a];var c=g.getExtension(a)||null;d[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var b=q("__print"),g=null,d={};a.Xb=function(a){g=a};a.No=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.Jv=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.zv=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.Fo=function(){return c("WEBGL_debug_shaders")};a.Mo=function(){return c("WEBGL_debug_renderer_info")};a.Go=function(){return c("OES_element_index_uint")};a.Sv=function(){return c("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function q(a,b,e){e||(e=null);if(c(a,b))throw"Graph already has node with given ID";a.za.push(b,e)}function c(a,b){for(var e=a.za,c=0;c<e.length;c+=2)if(e[c]==b)return!0;return!1}function b(a,b,e,d){d||(d=null);if(c(a,b)&&c(a,e))a.sa.push(b,e,d);else throw"Wrong node IDs";}function g(a,b){if(!c(a,b))throw"Node not found";for(var e=a.za,d=0;d<e.length;d+=2)e[d]==b&&(e.splice(d,2),d-=2)}function d(a){a=a.za;for(var b=-1,e=0;e<a.length;e+=2)b=Math.max(b,a[e]);return++b}
function m(a,b){for(var e=a.za,c=0;c<e.length;c+=2)if(e[c+1]==b)return e[c];return-1}function f(a){var b=[],e={};h(a,e);for(var c=a.za,d=0;d<c.length;d+=2)0==B(a,c[d])&&k(a,c[d],e,b);return{za:b,sa:a.sa.slice(0)}}function h(a,b){for(var e=a.za,c=0;c<e.length;c+=2)b[e[c]]=!1}function k(a,b,c,d){if(!c[b]){c[b]=!0;for(var g=0;g<p(a,b);g++)k(a,e(a,b,g),c,d);d.unshift(b,F(a,b))}}function l(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var k=0;k<p(a,b);k++){var g=e(a,b,k);l(a,g,c,d)}if(20==d||30==d)for(k=
0;k<B(a,b);k++)g=t(a,b,k),l(a,g,c,d)}}function s(a){var b=a.za;a=a.sa;for(var e=[],c=[],d=[],p=0;p<b.length;p++)d[b[2*p]]=p,e.push(p,b[2*p+1]);for(p=0;p<a.length;p+=3)c.push(d[a[p]],d[a[p+1]],a[p+2]);return{za:e,sa:c}}function n(a,b,c){if(c.Dc==c.ae){for(var d=0,k=0;d<c.ae;d++)-1!=c.gd[d]&&(a[k]=d,b[k]=c.gd[d],k++);return!0}if(c.ae>c.hg||c.me>c.ne||c.zg>c.Bg||c.yg>c.Ag)return!1;for(var k=d=-1,g=!1;!g&&w(c,L,d,k);)if(d=L[0],k=L[1],u(c,d,k)){var f;f=c;g={};g.nh=f.nh;g.oh=f.oh;g.Fl=f.Fl;g.Ki=f.Ki;g.ae=
f.ae;g.hg=f.hg;g.be=f.be;g.Dc=g.lj=f.Dc;g.yg=f.yg;g.zg=f.zg;g.me=f.me;g.Ag=f.Ag;g.Bg=f.Bg;g.ne=f.ne;g.Tg=-1;g.gd=f.gd;g.Je=f.Je;g.We=f.We;g.Xe=f.Xe;g.pf=f.pf;g.qf=f.qf;g.Bj=f.Bj;f.Bj[0]+=1;var g=f=g,y=d,h=k,l=g.nh,x=g.oh,H=g.ae,m=g.hg,s=g.gd,F=g.Je,K=g.We,aa=g.Xe,q=g.pf,v=g.qf;z(y<H);z(h<m);z(g.Dc<H);z(g.Dc<m);H=++g.Dc;g.Tg=y;K[y]||(K[y]=H,g.yg++,q[y]&&g.me++);q[y]||(q[y]=H,g.zg++,K[y]&&g.me++);aa[h]||(aa[h]=H,g.Ag++,v[h]&&g.ne++);v[h]||(v[h]=H,g.Bg++,aa[h]&&g.ne++);s[y]=h;F[h]=y;for(s=0;s<B(l,y);s++)F=
t(l,y,s),K[F]||(K[F]=H,g.yg++,q[F]&&g.me++);for(s=0;s<p(l,y);s++)F=e(l,y,s),q[F]||(q[F]=H,g.zg++,K[F]&&g.me++);for(s=0;s<B(x,h);s++)F=t(x,h,s),aa[F]||(aa[F]=H,g.Ag++,v[F]&&g.ne++);for(s=0;s<p(x,h);s++)F=e(x,h,s),v[F]||(v[F]=H,g.Bg++,aa[F]&&g.ne++);g=n(a,b,f);z(1>=f.Dc-f.lj);z(-1!=f.Tg);F=f.nh;y=f.oh;h=f.Dc;l=f.Tg;x=f.gd;K=f.Je;H=f.We;aa=f.Xe;m=f.pf;q=f.qf;if(f.lj<h){H[l]==h&&(H[l]=0);for(v=0;v<B(F,l);v++)s=t(F,l,v),H[s]==h&&(H[s]=0);m[l]==h&&(m[l]=0);for(v=0;v<p(F,l);v++)s=e(F,l,v),m[s]==h&&(m[s]=
0);F=x[l];aa[F]==h&&(aa[F]=0);for(v=0;v<B(y,F);v++)s=t(y,F,v),aa[s]==h&&(aa[s]=0);q[F]==h&&(q[F]=0);for(v=0;v<p(y,F);v++)s=e(y,F,v),q[s]==h&&(q[s]=0);x[l]=-1;K[F]=-1;f.Dc=f.lj;f.Tg=-1}}return g}function w(a,b,c,e){-1==c&&(c=0);-1==e?e=0:e++;var d=a.me,g=a.ne,p=a.zg,k=a.Bg,f=a.yg,n=a.Ag,y=a.Dc,h=a.ae,l=a.hg,x=a.gd,t=a.Je,H=a.We,u=a.Xe,m=a.pf,v=a.qf;if(d>y&&g>y)for(;c<h&&(-1!=x[c]||0==m[c]||0==H[c]);)c++,e=0;else if(p>y&&k>y)for(;c<h&&(-1!=x[c]||0==m[c]);)c++,e=0;else if(f>y&&n>y)for(;c<h&&(-1!=x[c]||
0==H[c]);)c++,e=0;else if(0==c&&0!=a.be){for(H=0;H<h&&-1!=x[c=a.be[H]];)H++;H==h&&(c=h)}else for(;c<h&&-1!=x[c];)c++,e=0;if(d>y&&g>y)for(;e<l&&(-1!=t[e]||0==v[e]||0==u[e]);)e++;else if(p>y&&k>y)for(;e<l&&(-1!=t[e]||0==v[e]);)e++;else if(f>y&&n>y)for(;e<l&&(-1!=t[e]||0==u[e]);)e++;else for(;e<l&&-1!=t[e];)e++;return c<h&&e<l?(b[0]=c,b[1]=e,!0):!1}function u(a,b,c){var d=a.nh,g=a.oh,k=a.hg,f=a.gd,n=a.Je,y=a.We,h=a.Xe,l=a.pf,H=a.qf;z(b<a.ae);z(c<k);z(-1==f[b]);z(-1==n[c]);if(!(0,a.Fl)(F(d,b),F(g,c)))return!1;
for(var u=k=0,m=0,L=0,s=0,w=0,q=0;q<p(d,b);q++){var v=e(d,b,q);if(-1!=f[v]){var I=f[v];if(!x(g,c,I)||!K(a.Ki,d,b,v,g,c,I))return!1}else y[v]&&m++,l[v]&&k++,y[v]||l[v]||s++}for(q=0;q<B(d,b);q++)if(v=t(d,b,q),-1!=f[v]){if(I=f[v],!x(g,I,c)||!K(a.Ki,d,v,b,g,I,c))return!1}else y[v]&&m++,l[v]&&k++,y[v]||l[v]||s++;for(q=0;q<p(g,c);q++)if(I=e(g,c,q),-1!=n[I]){if(v=n[I],!x(d,b,v))return!1}else h[I]&&L++,H[I]&&u++,h[I]||H[I]||w++;for(q=0;q<B(g,c);q++)if(I=t(g,c,q),-1!=n[I]){if(v=n[I],!x(d,v,b))return!1}else h[I]&&
L++,H[I]&&u++,h[I]||H[I]||w++;return m<=L&&k<=u&&s<=w}function z(a){if(!a)throw"Assertion failed";}function F(a,b){for(var c=a.za,e=0;e<c.length;e+=2)if(c[e]==b)return c[e+1];return null}function p(a,b){for(var c=a.sa,e=0,d=0;d<c.length;d+=3)c[d]==b&&e++;return e}function B(a,b){for(var c=a.sa,e=0,d=0;d<c.length;d+=3)c[d+1]==b&&e++;return e}function e(a,b,c){a=a.sa;for(var e=0,d=0;d<a.length;d+=3)if(a[d]==b){if(e==c)return a[d+1];e++}return-1}function t(a,b,c){a=a.sa;for(var e=0,d=0;d<a.length;d+=
3)if(a[d+1]==b){if(e==c)return a[d];e++}return-1}function x(a,b,c){a=a.sa;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c)return!0;return!1}function K(a,b,c,e,d,g,p){for(var k=H(b,c,e),f=H(d,g,p),n=0;n<k;n++){for(var h=!1,l=0;l<f;l++)if(a(y(b,c,e,n),y(d,g,p,l))){h=!0;break}if(!h)return!1}return!0}function H(a,b,c){var e=0;a=a.sa;for(var d=0;d<a.length;d+=3)a[d]==b&&a[d+1]==c&&e++;return e}function y(a,b,c,e){a=a.sa;for(var d=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(d==e)return a[g+2];d++}return null}
var L=[-1,-1];a.Mm=-1;a.Az=10;a.vr=20;a.Dz=30;a.create=function(){for(var a=arguments,b=[],c=[],e=0;e<a.length;e++){var d=a[e];switch(d.length){case 2:b.push(d[0],d[1]);break;case 3:c.push(d[0],d[1],d[2]);break;default:throw"Wrong graph constructor params";}}return{za:b,sa:c}};a.cA=function(a,b){for(var c=[],e=[],d=0;d<a.length;d++)c.push(a[d][0],a[d][1]);for(d=0;d<b.length;d++)e.push(b[d][0],b[d][1],b[d][2]);return{za:c,sa:e}};a.hk=q;a.KA=c;a.Ae=b;a.lg=g;a.kg=function(a,b,c,e){if(!x(a,b,c))throw"Edge not found";
a=a.sa;for(var d=0,g=0;g<a.length;g+=3)if(a[g]==b&&a[g+1]==c){if(-1==e)a.splice(g,3);else{if(e==d){a.splice(g,3);break}d++}g-=3}};a.o=function(a,b){if(-1==m(a,b))q(a,d(a),b);else throw"Non-unique attribute";};a.nx=function(a,b,c,e,d){a=a.sa;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&a[g+2]==e&&(a[g+2]=d)};a.Co=d;a.Ah=m;a.i=function(a,c,e,d){c=m(a,c);e=m(a,e);if(-1!=c&&-1!=e)b(a,c,e,d);else throw"Attributes not found";};a.L=function(a,b){for(var c=a.za,e=0;e<c.length&&!b(c[e],c[e+1]);e+=2);};
a.oe=function(a,b){for(var c=a.sa,e=0;e<c.length&&!b(c[e],c[e+1],c[e+2]);e+=3);};a.pe=function(a,b,c){for(var e=a.sa,d=0;d<e.length;d+=3)if(e[d+1]==b){var g=e[d];if(c(g,F(a,g),e[d+2]))break}};a.qe=function(a,b,c){for(var e=a.sa,d=0;d<e.length;d+=3)if(e[d]==b){var g=e[d+1];if(c(g,F(a,g),e[d+2]))break}};a.Zq=f;a.zy=function(a){a=f(a).za;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.UA=function(){};a.my=function(a,b,e){if(!c(a,b))throw"No such node";var d={};h(a,d);l(a,b,d,e);b=[];for(var g in d)d[g]&&
(g=Number(g),b.push(g,F(a,g)));a={za:b,sa:a.sa.slice(0)};d=a.sa;for(g=0;g<d.length;g+=3)b=d[g+1],c(a,d[g])&&c(a,b)||(d.splice(g,3),g-=3);return a};a.Rv=function(a){for(var b=[],c=a.za,e=0;e<c.length;e+=2){var d=c[e];B(a,d)||b.push(d)}return b};a.Po=function(a){for(var b=[],c=a.za,e=0;e<c.length;e+=2){var d=c[e];p(a,d)||b.push(d)}return b};a.match=function(a,b,c,e){var d={};d.nh=s(a);d.oh=s(b);d.Fl=c||function(a,b){return a==b};d.Ki=e||function(a,b){return a==b};e=a.za.length/2;var g=b.za.length/2;
d.ae=e;d.hg=g;d.be=0;d.Dc=d.lj=0;d.me=d.yg=d.zg=0;d.ne=d.Ag=d.Bg=0;d.Tg=-1;d.gd=Array(e);d.Je=Array(g);d.We=Array(e);d.Xe=Array(g);d.pf=Array(e);d.qf=Array(g);d.Bj=[1];for(c=0;c<e;c++)d.gd[c]=-1,d.We[c]=0,d.pf[c]=0;for(c=0;c<g;c++)d.Je[c]=-1,d.Xe[c]=0,d.qf[c]=0;g=Array(e);e=Array(e);if(n(g,e,d)){for(c=0;c<g.length;c++)g[c]=a.za[2*g[c]],e[c]=b.za[2*e[c]];return[g,e]}return null};a.Ea=F;a.ig=p;a.ep=B;a.Yf=e;a.Ni=t;a.AA=H;a.Xf=y;a.replace=function(a,b,c){for(var e=a.sa,p=d(a),k=0;k<b.length;k++){var f=
b[k];g(a,f);for(var n=0;n<e.length;n+=3)e[n]==f&&(e[n]=p),e[n+1]==f&&(e[n+1]=p),e[n]==e[n+1]&&(e.splice(n,3),n-=3)}q(a,p,c)};a.dA=function(a,b){var c=a.za,e=a.sa,d;d="digraph debug {\n    node [shape=box];\n";for(var g=0;g<c.length;g+=2){var p=c[g],k=c[g+1],k=b?b(p,k):String(p);d+="    ";d+=String(p)+' [label="'+k.replace(/\"/g,'\\"')+'"];\n'}for(g=0;g<e.length;g+=3)c=e[g],p=e[g+1],d+="    ",d+=String(c)+" -> "+String(p)+";\n";return d+="}"}};b4w.module.__ipc=function(a){var q=a.Ar=0;a.Br=1;a.Cr=2;a.Dr=3;a.Er=4;a.Fr=5;var c=a.Hr=6,b=a.Ir=7,g=a.Jr=8;a.Kr=9;a.Gr=10;a.js=11;a.yc=12;a.Lr=13;a.Mr=14;a.Nr=15;a.Pr=16;a.Or=17;a.Qr=18;a.Rr=19;a.Sr=20;a.Tr=21;a.Ur=22;a.Vr=23;a.Wr=24;a.Xr=25;a.Yr=26;a.Zr=27;a.$r=28;a.as=29;a.bs=30;a.cs=31;a.ds=32;a.es=33;a.gs=34;a.hs=35;a.ks=36;a.Om=37;a.ls=38;a.ms=39;a.ns=40;a.os=41;a.ps=42;a.qs=43;a.rs=44;a.ss=45;a.ts=46;a.us=47;a.vs=48;a.ws=49;a.xs=50;a.Pm=51;var d=a.Ff=52;a.ys=53;a.Nm=54;a.zs=55;a.As=56;a.Bz=
57;a.fs=58;for(var m=null,f=[],h=[],k=[],l=[],s=0;59>s;s++)f.push(null),h.push(null),k.push(null),l.push(null);h[g]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};h[c]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};h[b]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};h[q]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};h[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};l[g]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];l[c]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];l[b]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];l[q]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];l[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(l[a]){for(var d=h[a],g=l[a],k=0,e=0;e<g.length;e+=2){var f=g[e],n=g[e+1];if(1==n)d[f]="msg_id"==f||"body_id"==f||"body_id_a"==f||"body_id_b"==f?c[k]|0:c[k];else for(var m=0;m<n;m++)d[f][m]=c[k+m];k+=n}c=d}b(a,c)},!1);m=a};a.cleanup=function(){m=null};a.m=function(){var a=arguments[0]|0;if(l[a]){var b=h[a],c=l[a],d=0;if(!k[a]){for(var g=0,p=1;p<c.length;p+=2)g+=c[p];k[a]=new Float32Array(g)}g=k[a];for(p=0;p<c.length;p+=2){var s=b[c[p]],e=c[p+1];1==e?g[d]=s:g.set(s,
d);d+=e}f[a]||(f[a]=g);a=f[a]}else for(b=arguments.length,f[a]||(f[a]=Array(b),f[a][0]=a),a=f[a],c=1;c<b;c++)a[c]=arguments[c];m.postMessage(a)};a.Ko=function(a){return h[a]}};b4w.module.__hud=function(a,q){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){g(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;h.L(a.d.Na,function(a,d){if("SINK"==d.type)g(" (F)",d.type);else{var k=d.type,p=Math.round(d.h.width)+"x"+Math.round(d.h.height),f=d.l.length,e=d.dh,h=d.enqueue&&d.R;h?g(" (A)",k,d.mf,p,e,"of",f):g(" (P)",k,d.mf,p,e,"of",f);d.dh=0;h&&(b+=f,c+=e)}});return[b,c]}g("No INFO")}function g(){for(var a=80+20*l[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var g="",f=0;f<b[d]-String(arguments[d]).length;f++)g+=" ";c+=g+arguments[d]}l[0]++;k.fillText(c,30,a)}function d(a,b,c){b*=a.oa;c.x=a.x+b;c.y=a.y;c.oa=a.oa-2*b;c.ha=a.ha}function m(a){return a.x+a.oa/2}function f(a){var b=k,c={x:0,y:0,oa:0,ha:0},g=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.oa=g;c.ha=b;d(c,.01,c);g=.02*c.ha;c.x=c.x;c.y+=g;c.oa=c.oa;c.ha-=2*g;g=c.oa/8;c.x+=g*a;c.y=c.y;c.oa=g;c.ha=c.ha;d(c,.02,c);return c}var h=q("__graph"),
k=null,l=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return k=a};a.Fg=function(){k&&c(k)};a.reset=function(){var a=k;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),l[0]=0,l[1]=0)};a.Ux=function(a,c){var d=k;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";g(" FPS",(1/c).toFixed(2));l[0]++;for(var f=d=0,h=0;h<a.length;h++){var m=b(a[h]),d=d+m[0],f=f+m[1];l[0]++}g(" ---------------------------------------------");
g("    ","TOTAL ACTIVE","","",f,"of",d)}};a.print=function(){var a=k;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",g.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,h,p){var l=k;if(l){b=f(b);var e=b.ha/5;b.x=b.x;b.y+=4*e;b.oa=b.oa;b.ha=e;l.textAlign="center";l.fillStyle="#00FF00";k.fillText(a,m(b),b.y-10);l.strokeStyle="#00FF00";l.lineWidth=.5;l.beginPath();l.moveTo(b.x,b.y);l.lineTo(b.x+b.oa,b.y);l.lineTo(b.x+b.oa,b.y+b.ha);l.lineTo(b.x,b.y+b.ha);l.closePath();l.stroke();if(!h&&
!p)for(h=1E6,p=-1E6,a=0;a<c.length;a++)h=Math.min(h,c[a]),p=Math.max(p,c[a]);l.textAlign="right";k.fillText(String(h),b.x-10,b.y+b.ha);k.fillText(String(p),b.x-10,b.y);l.textAlign="center";k.fillText(String(d),b.x,b.y+b.ha+15);k.fillText(String(g),b.x+b.oa,b.y+b.ha+15);l.strokeStyle="#FF0000";l.lineWidth=1.5;l.beginPath();d=b.oa/(c.length-1);p=b.ha/(p-h);for(a=0;a<c.length;a++)g=b.x+d*a,e=b.y+b.ha-(c[a]-h)*p,0==a?l.moveTo(g,e):l.lineTo(g,e);l.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,h,p){var l=
k;if(l)for(l.textAlign="center",l.fillStyle="#00FF00",l.font="bold 12px Courier",c=f(c),k.fillText(b?"["+a+"]":a,m(c),c.y),0<=h&&k.fillText(h?"[M]":"[ ]",m(c)-15,c.y+30),0<=p&&k.fillText(p?"[S]":"[ ]",m(c)+15,c.y+30),a={x:0,y:0,oa:0,ha:0},b=0;b<d.length;b++){h=d[b];var e="VOLUME"==h[0];if(e){p=c.y+350;var t=c.oa,x=a;x.x=c.x;x.y=p;x.oa=t;x.ha=250}else{p=c.y+10+50*b;var t=c.oa,x=c.ha,K=a;K.x=c.x;K.y=p;K.oa=t;K.ha=x}p=l;var t=a,K=b==g,H=h[0],x=h[1],y=h[2],L=h[3],r=(L-y)/h[4],r=1>r?Math.floor(1/r-1E-5).toFixed(0).length:
0;h=h[5]?Math.log(x/y)/Math.log(L/y):(x-y)/(L-y);p.textAlign="center";K?p.fillText("["+H+"]",m(t),t.y):p.fillText(H,m(t),t.y);p.strokeStyle="#00FF00";p.lineWidth=e?3:1;e?(p.textAlign="right",p.fillText(L.toFixed(r),m(t)-10,t.y+15),p.textAlign="right",p.fillText(y.toFixed(r),m(t)-10,t.y+t.ha-15)):(p.textAlign="right",p.fillText(y.toFixed(r),t.x+28,t.y+15),p.textAlign="left",p.fillText(L.toFixed(r),t.x+t.oa-28,t.y+15));p.beginPath();if(e){var D=t.y+15+(t.ha-30)*(1-h);p.moveTo(m(t),t.y+15);p.lineTo(m(t),
t.y+t.ha-15);p.moveTo(m(t)-5,t.y+15);p.lineTo(m(t)+5,t.y+15);p.moveTo(m(t)-5,t.y+t.ha-15);p.lineTo(m(t)+5,t.y+t.ha-15);p.moveTo(m(t)-5,D);p.lineTo(m(t)+5,D)}else{var G=t.x+30+(t.oa-60)*h;p.moveTo(t.x+30,t.y+15);p.lineTo(t.x+t.oa-30,t.y+15);p.moveTo(t.x+30,t.y+15-5);p.lineTo(t.x+30,t.y+15+5);p.moveTo(t.x+t.oa-30,t.y+15-5);p.lineTo(t.x+t.oa-30,t.y+15+5);p.moveTo(G,t.y+15-5);p.lineTo(G,t.y+15+5)}p.stroke();"EQ_Q"==H?(h=Math.log(1+1/(2*x*x)+Math.sqrt((2+1/(x*x))*(2+1/(x*x))/4-1))/Math.log(2),e?(p.textAlign=
"left",p.fillText(x.toFixed(r),m(t)+10,D),p.textAlign="left",p.fillText("("+h.toFixed(r+1)+")",m(t)+10,D+10)):(p.textAlign="right",p.fillText(x.toFixed(r),G,t.y+30),p.textAlign="left",p.fillText("("+h.toFixed(r+1)+")",G,t.y+30))):e?(p.textAlign="left",p.fillText(x.toFixed(r),m(t)+10,D)):(p.textAlign="center",p.fillText(x.toFixed(r),G,t.y+30))}}};b4w.module.__renderer=function(a,q){function c(a){if(a){var b=(a.aa?z.COLOR_BUFFER_BIT:0)|(a.fa?z.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=s;break;case "DEPTH":a=n;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=w;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=u;break;default:a=l.background_color}}else b=z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT,a=l.background_color;z.colorMask(!0,!0,!0,!0);z.depthMask(!0);z.clearColor(a[0],
a[1],a[2],a[3]);z.clear(b)}function b(a,b,c){z.bindBuffer(z.ARRAY_BUFFER,a.Bf);for(var d=0;d<b.length;d++){var g=b[d];z.enableVertexAttribArray(g.ff);z.vertexAttribPointer(g.ff,g.Ic,z.FLOAT,!1,0,g.pt+g.gv*c)}a.sd?(z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,a.sd),z.drawElements(a.mode,a.count,a.kl,0)):z.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)g=b[d],z.disableVertexAttribArray(g.ff)}function g(a){switch(a){case 0:return z.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return z.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return z.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return z.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return z.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return z.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.Zh,c=[],d=[],g={},k;for(k in b){var f=!1;switch(k){case "u_proj_matrix":var h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ia)},f=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ea)};f=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,
b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.zq)};f=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.ax)};f=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Lg)};f=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.Mc)};f=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,e,g){a.uniform3fv(b,g.Sd)};f=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,e,g){a.uniform3fv(b,g.uo)};f=
!0;break;case "u_camera_quat":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.quat)};f=!0;break;case "u_view_max_depth":h=function(a,b,c,d,e,g){a.uniform1f(b,g.La)};f=!0;break;case "u_camera_range":h=function(a,b,c,d,e,g){a.uniform2f(b,g.Fa,g.La)};break;case "u_csm_center_dists":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.Xn)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.tk)};f=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.te)};break;case "u_waves_length":h=function(a,
b,c){a.uniform1f(b,c.Ef)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.Eb)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.xc)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};f=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.fi)};break;case "u_horizon_color":h=function(a,
b,c){a.uniform3fv(b,c.ic)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.nc)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.Rd)};break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.pg)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.df)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.af)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.$e)};break;case "u_light_factors1":h=function(a,b,c){a.uniform4fv(b,c.bf)};break;case "u_light_factors2":h=function(a,b,c){a.uniform4fv(b,c.cf)};break;case "u_shadow_lamp_id":h=function(a,b,c){a.uniform1i(b,c.Aq)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.Vq)};break;
case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.Uq)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.Gj)};break;case "u_height":h=function(a,b,c,d,e,g){a.uniform1f(b,g.height)};f=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.H)};f=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.dc)};f=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.cc)};f=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.quat)};f=!0;break;
case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.Vb)};f=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.Ub)};f=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Qe)};f=!0;break;case "au_center_pos":h=function(){};f=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Wc)};f=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.ue)};f=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Nd)};f=!0;break;case "au_detail_bending_amp":h=
function(a,b,c,d){a.uniform1f(b,d.Md)};f=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Kd)};f=!0;break;case "u_anim_values":h=function(a,b,c,d){a.uniform1fv(b,d.jf)};f=!0;break;case "u_diffuse_color":h=function(a,b,c,d,e){a.uniform4fv(b,e.ob)};f=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.Le)};f=!0;break;case "u_diffuse_params":h=function(a,b,c,d,e){a.uniform2fv(b,e.kd)};f=!0;break;case "u_emit":h=function(a,b,c,d,e){a.uniform1f(b,e.Qd)};f=
!0;break;case "u_ambient":h=function(a,b,c,d,e){a.uniform1f(b,e.Bc)};f=!0;break;case "u_specular_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.Bd)};f=!0;break;case "u_specular_alpha":h=function(a,b,c,d,e){a.uniform1f(b,e.rg)};f=!0;break;case "u_specular_params":h=function(a,b,c,d,e){a.uniform3fv(b,e.lc)};f=!0;break;case "u_reflect_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Nh)};f=!0;break;case "u_mirror_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Cl)};f=!0;break;case "u_grass_map_dim":h=function(a,
b,c,d,e){a.uniform3fv(b,e.Ib)};f=!0;break;case "u_grass_size":h=function(a,b,c,d,e){a.uniform1f(b,e.gl)};f=!0;break;case "u_scale_threshold":h=function(a,b,c,d,e){a.uniform1f(b,e.Ri)};f=!0;break;case "u_cube_fog":h=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Ec)};break;case "u_jitter_amp":h=function(a,b,c,d,e){a.uniform1f(b,e.Zi)};f=!0;break;case "u_jitter_freq":h=function(a,b,c,d,e){a.uniform1f(b,e.$i)};f=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;
case "u_wireframe_edge_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":h=function(a,b,c){a.uniform2fv(b,c.ww)};f=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.xw)};f=!0;break;case "u_refr_bump":h=function(a,b,c,d,e){a.uniform1f(b,e.jq)};f=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,e){a.uniform3fv(b,e.ql)};break;case "u_lamp_light_directions":h=function(a,b,c,d,e){a.uniform3fv(b,e.ol)};break;case "u_lamp_light_color_intensities":h=
function(a,b,c,d,e){a.uniform3fv(b,e.nl)};break;case "u_lamp_light_factors":h=function(a,b,c,d,e){a.uniform4fv(b,e.pl)};break;case "u_halo_size":h=function(a,b,c,d,e){a.uniform1f(b,e.Xo)};f=!0;break;case "u_halo_hardness":h=function(a,b,c,d,e){a.uniform1f(b,e.Uo)};f=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.Wo)};f=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.Vo)};f=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,e){a.uniform1f(b,e.Yo)};
f=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,e){a.uniform1f(b,e.Zo)};f=!0;break;case "u_fresnel_params":h=function(a,b,c,d,e){a.uniform4fv(b,e.pd)};f=!0;break;case "u_texture_scale":h=function(a,b,c,d,e){a.uniform3fv(b,e.Qc)};f=!0;break;case "u_parallax_scale":h=function(a,b,c,d,e){a.uniform1f(b,e.Fh)};f=!0;break;case "u_color_id":h=function(a,b,c,d,e){a.uniform3fv(b,e.Nn)};f=!0;break;case "u_line_points":h=function(a,b,c,d,e){a.uniform3fv(b,e.cB)};f=!0;break;case "u_diffuse_color_factor":h=
function(a,b,c,d,e){a.uniform1f(b,e.Ke)};f=!0;break;case "u_alpha_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.ye)};f=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Gq)};f=!0;break;case "u_normal_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Ep)};f=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.lf[0])};f=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.lf[1])};f=!0;break;case "u_normalmap2_scale":h=function(a,b,c,
d,e){a.uniform2fv(b,e.lf[2])};f=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.lf[3])};f=!0;break;case "u_foam_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};f=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,e){a.uniform2fv(b,e.xo)};f=!0;break;case "u_foam_mag":h=function(a,b,c,d,e){a.uniform2fv(b,e.wo)};f=!0;break;case "u_foam_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.Uk)};f=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,e){a.uniform1f(b,
e.Uj)};f=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};f=!0;break;case "u_shore_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};f=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};f=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};f=!0;break;case "u_p_length":h=function(a,b,c,d,e){a.uniform1f(b,e.Rp)};f=!0;break;case "u_p_cyclic":h=
function(a,b,c,d,e){a.uniform1i(b,e.Np)};f=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,e){a.uniform1f(b,e.Tp)};f=!0;break;case "u_p_fade_in":h=function(a,b,c,d,e){a.uniform1f(b,e.Op)};f=!0;break;case "u_p_fade_out":h=function(a,b,c,d,e){a.uniform1f(b,e.Pp)};f=!0;break;case "u_p_size":h=function(a,b,c,d,e){a.uniform1f(b,e.Ll)};f=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,e){a.uniform1f(b,e.Kp)};f=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,e){a.uniform1f(b,e.Jp)};f=!0;break;case "u_p_nfactor":h=
function(a,b,c,d,e){a.uniform1f(b,e.Kl)};f=!0;break;case "u_p_gravity":h=function(a,b,c,d,e){a.uniform1f(b,e.Qp)};f=!0;break;case "u_p_mass":h=function(a,b,c,d,e){a.uniform1f(b,e.Sp)};f=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,e){a.uniform2fv(b,e.Up)};f=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,e){a.uniform4fv(b,e.Lp)};f=!0;break;case "u_p_wind":h=function(a,b,c,d,e){a.uniform3fv(b,e.nj)};f=!0;break;case "u_texel_size":h=function(a,b,c,d,e){a.uniform2fv(b,e.om)};f=!0;break;case "u_p_time":h=
function(a,b,c,d,e){a.uniform1f(b,e.Jc.I.time)};f=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.kr)};f=!0;break;case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.sj)};break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.jr)};f=!0;break;case "u_b_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ln)};break;case "u_p_light_matrix0":h=function(a,
b,c){a.uniformMatrix4fv(b,!1,c.rf[0])};f=!0;break;case "u_p_light_matrix1":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[1])};f=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[2])};f=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[3])};f=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.Ap)};f=!0;break;case "u_refl_plane":h=function(a,b,c){a.uniform4fv(b,c.hb)};break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,
c.vj)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.ug)};break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};f=!0;break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.tg)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.sg)};break;case "u_dof_dist":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_distance)};f=!0;break;
case "u_dof_front":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_front)};f=!0;break;case "u_dof_rear":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_rear)};f=!0;break;case "u_glow_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.Zf)};f=!0;break;case "u_glow_color":h=function(a,b,c){a.uniform3fv(b,c.ph)};break;case "u_draw_glow":h=function(a,b,c){a.uniform1f(b,c.Ok)};f=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.contrast)};
break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:h=null}h&&(h={name:k,$k:h,ff:b[k]},f?c.push(h):(d.push(h),g[k]=h))}a.ar=c;a.Hh=d;a.Nl=g}var m=q("__config"),f=q("__debug"),h=q("__textures"),k=q("__util"),l=m.n,s=[1,1,1,1],n=[1,1,1,1],w=[0,0,0,1],u=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var z=null,F=new Uint8Array(4);
a.Xb=function(a){var b=l.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);z=a};a.gh=function(a){if(a.R){var k=a.h;z.bindFramebuffer(z.FRAMEBUFFER,k.Td);if(a.jk){var e=k.cb;z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,e.Ab,e.Ha,0)}z.viewport(0,0,k.width,k.height);c(a);a.qa?z.enable(z.BLEND):z.disable(z.BLEND);
a.wb?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST);if(a.ta){for(var k=a.h,e=a.l,h=0;h<e.length;h++){var n=e[h],m=n.k,u=m.Yb;z.useProgram(u.tj);n=n.Va;u.Hh.length||d(u);for(var u=u.Hh,y=u.length;y--;){var s=u[y];s.$k(z,s.ff,a,n,m,k)}}a.ta=!1}switch(a.type){case "SHADOW_CAST":z.enable(z.POLYGON_OFFSET_FILL);z.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);z.cullFace(z.BACK);break;case "MAIN_REFLECT":z.disable(z.POLYGON_OFFSET_FILL);z.cullFace(z.FRONT);break;default:z.disable(z.POLYGON_OFFSET_FILL),
z.cullFace(z.BACK)}k=a.h;e=a.l;for(h=0;h<e.length;h++)if(n=e[h],n.R){var m=a,s=k,u=n.Va,r=n.k,n=r.Yb;z.useProgram(n.tj);for(var w=r.bb,y=r.gn,G=n.ar,V=G.length;V--;){var N=G[V];N.$k(z,N.ff,m,u,r,s)}s=r.On;z.colorMask(s,s,s,s);z.depthMask(r.N);r.ka?z.enable(z.CULL_FACE):z.disable(z.CULL_FACE);s=r.D;r=r.ac;G=n.Zh;V=s.length|0;if(0!==V)if(1===V)z.activeTexture(z.TEXTURE0),z.bindTexture(s[0].Ab,s[0].Ha);else for(N=0;N<V;N++){var q=s[N],P=r[N];z.activeTexture(z.TEXTURE0+N);z.bindTexture(q.Ab,q.Ha);z.uniform1i(G[P],
N)}if("SKY"==m.type){s=m;n=n.Zh;r=s.h.cb.Ha;G=s.Yn;for(V=0;6>V;V++)if(N=g(V),l.Jn?(q=new Uint8Array([91.8,142.8,.96*255,255]),z.bindTexture(z.TEXTURE_CUBE_MAP,r),z.texImage2D(N,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,q)):(z.uniformMatrix4fv(n.u_cube_view_matrix,!1,G[V]),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,N,r,0),b(w,y,u.vm)),s.ij&&0!=V){var N=s,q=V,M=F;z.readPixels(191,191,1,1,z.RGBA,z.UNSIGNED_BYTE,M);255!=M[0]&&255!=M[1]&&255!=M[2]||z.readPixels(191,220,1,1,z.RGBA,z.UNSIGNED_BYTE,
M);var P=M[0],O=M[1],M=M[2],P=P/255,O=O/255,M=M/255;1===q?(N.Ec[3]=P,N.Ec[7]=O,N.Ec[11]=M):(N.Ec[4*(q-2)]=P,N.Ec[4*(q-2)+1]=O,N.Ec[4*(q-2)+2]=M)}m.dh+=6}else b(w,y,u.vm),m.dh++}f.It("draw subscene: "+a.type);z.bindFramebuffer(z.FRAMEBUFFER,null)}};a.clear=c;a.dn=function(a){var b=a.gn;b.length=0;var c=a.bb;a=a.Yb;c&&a||k.da("Incomplete batch");c=c.Kb;a=a.attributes;for(var d in a){var g=c[d];b.push({ff:a[d],pt:4*g.offset,gv:1<g.frames?4*g.length:0,Ic:g.Ic})}};a.ot=d;a.fx=function(a,b,c){var d,g,f;
d||(d=1);g||(g=1);f||(f=new Uint8Array(4*d*g));f.length!=4*d*g&&k.da("read_pixels(): Wrong storage");z.bindFramebuffer(z.FRAMEBUFFER,a);z.readPixels(b,c,d,g,z.RGBA,z.UNSIGNED_BYTE,f);z.bindFramebuffer(z.FRAMEBUFFER,null);return f};a.Fy=function(a){var b=a.Yb;z.useProgram(b.tj);b.Hh.length||d(b);b=b.Nl.u_cube_fog;b.$k(z,b.ff,null,null,a,null)};a.lq=function(a,b){var c=z.createFramebuffer();z.bindFramebuffer(z.FRAMEBUFFER,c);if(a){var d=a,g=d.Ha,d=d.Ab==z.TEXTURE_CUBE_MAP?z.TEXTURE_CUBE_MAP_NEGATIVE_Z:
d.Ab;z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,d,g,0)}h.lp(b)?z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,b.Ng):h.vh(b)&&(d=b,g=d.Ha,d=d.Ab,z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,d,g,0));f.Ft();z.bindFramebuffer(z.FRAMEBUFFER,null);return c};a.mx=function(a,b,c,d,g){null==a?(z.bindFramebuffer(z.FRAMEBUFFER,a),z.viewport(0,0,d,g),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT)):(h.vh(b)&&z.deleteTexture(b.Ha),h.lp(c)?z.deleteRenderbuffer(c.Ng):
h.vh(c)&&z.deleteTexture(c.Ha),z.deleteFramebuffer(a))};a.NA=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,q){function c(a,c,d){var e=a.Od;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.Od,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function g(a,b){var c=a+b;if(t[c])return t[c];if(p){var d=p[b];if(!d)return null}else{d=z.Tv(a+b);if(!d)return null;d=B.$p.parse(d)}return t[c]=d}function d(a,b,c,d){function e(b){b=b.a;for(var c=0;c<b.length;c++){var h=b[c];switch(h.type){case "condition":a:for(var h=
h.a,x=0;x<h.length;x++){var y=h[x];switch(y.type){case "if":case "elif":var t=y.c;try{var s,z=m(t,f,p,!0);s=u.$p.parse(z)}catch(w){throw"Failed to process #"+y.type+" expression: "+t.join(" ");}if(s){e(y.group);break a}break;case "else":e(y.group);break;case "ifdef":y.name in f&&e(y.group);break;case "ifndef":y.name in f||e(y.group)}}break;case "include":h=g(F.shaders_dir,F.Sx+h.file);e(h);break;case "var":case "export":case "import":break;case "define":x=h.name;f[x]=h.b;h.va&&(p[x]=h.va);break;case "error":throw"Shader error: #error "+
h.b.join(" ");case "line":break;case "pragma":k.push("#pragma "+h.name+" "+h.b.join(" "));break;case "undef":h=h.name;delete f[h];delete p[h];break;case "warning":n.warn("Shader warning: #warning "+h.b.join(" "));break;case "extension":k.push("#extension "+m(h.b,f,p,!1));break;case "#":break;case "node":l[h.name]=h.group.a;break;case "nodes_global":h=d;for(x=0;x<h.length;x++)if(y=h[x],t=l[y.id])for(var B=0,K=0;K<t.length;K++){var v=t[K];"node_param"==v.type&&(v=v.qualifier.join(" ")+" ","vert"==a?
v+=y.ei[B]:"frag"==a&&(v+=y.va[B],null!==y.pj[B]&&(v+=" = "+y.pj[B])),v+=";",k.push(v),B++)}break;case "nodes_main":h=d;x={};for(y=0;y<h.length;y++)if(v=h[y],t=l[v.id]){var I=0,U=0,q=0;x[y]={};for(B=0;B<t.length;B++)switch(K=t[B],K.type){case "node_in":var fa=v.B[I];if(null!==v.hp[I]){var S=K.qualifier.join(" ")+" ",S=S+fa,S=S+(" = "+v.hp[I]),S=S+";";k.push(S)}x[y][K.name]=fa;I++;break;case "node_out":fa=v.Pa[U];S=K.qualifier.join(" ")+" ";S+=fa;S+=";";k.push(S);x[y][K.name]=fa;U++;break;case "node_param":"vert"==
a?fa=v.ei[q]:"frag"==a&&(fa=v.va[q]),x[y][K.name]=fa,q++}}for(y=0;y<h.length;y++)if(v=h[y],t=l[v.id])for(B=0;B<t.length;B++)if(K=t[B],"textline"==K.type){v=[];for(I=0;I<K.b.length;I++)U=K.b[I],U in x[y]?v.push(x[y][U]):v.push(U);k.push(m(v,f,p,!1))}break;case "textline":k.push(m(h.b,f,p,!1));break;default:throw"Unknown element type: "+h.type;}}}for(var k=[],f={},h=0;h<c.length;h++)f[c[h][0]]=[c[h][1]];for(h=0;h<d.length;h++)f["USE_NODE_"+d[h].id]=[1];var p={},l={};e(b);return k.join("\n")}function m(a,
b,c,d){var e=[];f(a,b,c,d,e);return e.join(" ")}function f(a,b,c,d,e){for(var g=0;g<a.length;g++){var k=a[g];k in b?(k=b[k],0==k.length&&d?e.push(0):f(k,b,c,d,e)):e.push(k)}}function h(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);w.Jt(d,b,c);return d}function k(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return l(a);case 2:return"vec2("+l(a[0])+","+l(a[1])+")";case 3:return"vec3("+l(a[0])+","+l(a[1])+","+l(a[2])+")";case 4:return"vec4("+l(a[0])+","+l(a[1])+","+l(a[2])+
","+l(a[3])+")";case 9:return"mat3("+l(a[0])+","+l(a[1])+","+l(a[2])+","+l(a[3])+","+l(a[4])+","+l(a[5])+","+l(a[6])+","+l(a[7])+","+l(a[8])+")";case 16:return"mat4("+l(a[0])+","+l(a[1])+","+l(a[2])+","+l(a[3])+","+l(a[4])+","+l(a[5])+","+l(a[6])+","+l(a[7])+","+l(a[8])+","+l(a[9])+","+l(a[10])+","+l(a[11])+","+l(a[12])+","+l(a[13])+","+l(a[14])+","+l(a[15])+")";default:throw"Wrong glsl value dimension";}}function l(a){return a%1?String(a):String(a)+".0"}var s=q("__config"),n=q("__print"),w=q("__debug"),
u=q("__gpp_eval"),z=q("__assets");q("__util");var F=s.yb;if(b4w.module_check(s.yb.yq))var p=q(s.yb.yq),B=null;else p=null,B=q("__gpp_parser");var e={},t={},x=[],K=null;a.Xb=function(a){K=a};a.J=c;a.Kv=b;a.VA=function(a,b){for(var c=a.Od,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Dx=function(a){a.Od=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var e=b[d],g;switch(e){case "ALPHA":case "ALPHA_CLIP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=k(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_SRC":g="SHADOW_SRC_NONE";break;case "SHADOW_DST":g=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":g="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=s.n.precision;break;case "EPSILON":g="highp"==s.n.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:n.error("Unknown directive ("+a.bi+", "+a.kh+"): "+e)}c(a,e,g)}};a.GA=function(a){return a.bi};a.Ho=function(a){return a.kh};a.kw=function(a,d){for(var e=
d.Od,g=0;g<e.length;g++){var k=e[g][0],f=e[g][1];b(a,k)&&c(a,k,f)}};a.Ev=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),k=e[c];if(k)return k;var f=a.kh,k=g(F.shaders_dir,a.bi),f=g(F.shaders_dir,f);if(!k||!f)return null;var p=a.Od||[],l=d("vert",k,p,b),p=d("frag",f,p,b),k=K,x=h(k,c,l,k.VERTEX_SHADER),m=h(k,c,p,k.FRAGMENT_SHADER),f=k.createProgram();k.attachShader(f,x);k.attachShader(f,m);k.linkProgram(f);k.validateProgram(f);k.getProgramParameter(f,k.VALIDATE_STATUS)==k.zz&&n.error("B4W Error - shader program is not valid",
c);w.Kt(f,c,x,m,l,p);l={Bm:x,Bo:m,tj:f,attributes:{},Zh:{},Hh:[],Nl:{},ar:[],Xa:a};x=k.getProgramParameter(f,k.ACTIVE_ATTRIBUTES);for(p=0;p<x;p++)m=k.getActiveAttrib(f,p).name,l.attributes[m]=k.getAttribLocation(f,m);x=k.getProgramParameter(f,k.ACTIVE_UNIFORMS);for(p=0;p<x;p++)m=k.getActiveUniform(f,p).name.split("[0]").join(""),l.Zh[m]=k.getUniformLocation(f,m);return e[c]=k=l};a.Bu=function(){return x};a.Fv=function(){return e};a.cleanup=function(){for(var a in e){var b=e[a];K.deleteProgram(b.tj);
K.deleteShader(b.Bm);K.deleteShader(b.Bo);delete e[a]}for(var c in t)delete t[c];for(var d in x)delete x[d]};a.eA=function(a){var b=a.Od;n.log("Shader: "+a.bi+" "+a.kh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.u=k;a.Cn=function(a,b){return b in a.Zh?!0:!1};a.Wv=function(a){return(K.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,q){function c(a){return 65536<a.C?K.Go()?!1:!0:!1}function b(a){return 0<a.Y.length?!0:!1}function g(a,c,g){if(!b(a))return a;g||e.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.C*(c||1)+", will use drawArrays","color: #aa0");c=a.Y;g=a.C;var k=a.A,f=a.r,h;for(h in k){var p=k[h],r=w(p,g);k[h]=d(c,p,r)}for(k=0;k<f.length;k++){var l=f[k];for(h in l)p=l[h],r=w(p,g),l[h]=d(c,p,r)}a.C=c.length;a.Y=new Uint16Array(0);return a}function d(a,b,c){if(0==
b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var g=a[e],k=0;k<c;k++)d[c*e+k]=b[c*g+k];return d}function m(a,b){var c=a.Uc,d=a.Kb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function f(b,c){var d,e;switch(c){case a.Og:case a.ii:d=D.TRIANGLES;e=D.STATIC_DRAW;break;case a.Jm:d=D.POINTS;e=D.STATIC_DRAW;break;case a.Im:d=D.TRIANGLES;e=D.DYNAMIC_DRAW;break;case a.xr:d=D.POINTS;e=D.DYNAMIC_DRAW;
break;case a.yr:d=D.LINES;e=D.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.$h=e}function h(a){a.Vd?(a.sd||(a.sd=D.createBuffer()),D.bindBuffer(D.ELEMENT_ARRAY_BUFFER,a.sd),D.bufferData(D.ELEMENT_ARRAY_BUFFER,a.Vd,a.$h),a.Hi=a.Vd.byteLength):a.Hi=0;a.Bf||(a.Bf=D.createBuffer());D.bindBuffer(D.ARRAY_BUFFER,a.Bf);D.bufferData(D.ARRAY_BUFFER,a.Uc,a.$h);a.bo=a.Uc.byteLength}function k(a){for(var b=x.mb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].Y.length;b.Y=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].C;b.C=c;var e=a[0],g;for(g in e.A){for(d=c=0;d<a.length;d++)c+=a[d].A[g].length;b.A[g]=new Float32Array(c)}for(g in e.r[0]){for(d=c=0;d<a.length;d++)c+=a[d].r[0][g].length;for(d=0;d<e.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][g]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){g=a[e];for(var k=g.Y,f=g.C,h=g.A,p=0;p<k.length;p++)b.Y[c+p]=k[p]+d;var c=c+k.length,r;for(r in h){var k=h[r],l=d*w(k,f);b.A[r].set(k,l)}for(p=0;p<g.r.length;p++){var h=g.r[p],n=b.r[p];for(r in h)k=
h[r],l=d*w(k,f),n[r].set(k,l)}d+=f}return b}function l(a,b,c,d,k,f){var h=x.mb("SUBMESH_"+a.name+"_"+b),r=a.submeshes[b],l=r.base_length,m=a.materials[b];h.C=l;if(s(c,"a_texcoord")){var t=null,u=a.materials[b];b=a.submeshes[b];if(u.texture_slots.length)switch(u=u.texture_slots[0],u.texture_coords){case "UV":u=a.uv_textures.indexOf(u.uv_layer);-1==u||0==u?t=new Float32Array(b.texcoord):1==u&&(t=new Float32Array(b.texcoord2));break;case "ORCO":for(var z=a.b4w_bounding_box,t=new Float32Array(2*b.base_length),
u=(z.max_x+z.min_x)/2,w=(z.max_z+z.min_z)/2,B=z.max_x-z.min_x,z=z.max_z-z.min_z,F=0,v=0;v<b.position.length;v+=3)t[F++]=(b.position[v]-u)/B+.5,t[F++]=(w-b.position[v+2])/z+.5}null===t&&(t=new Float32Array(b.texcoord));b=t}else b=new Float32Array(0);var I,t=r.group;if(s(c,"a_influence")&&d){u=new Float32Array(4*l);w=t.length/l;B=new Float32Array(w);for(z=0;z<w;z++)for(I in B[z]=-1,d)if(F=d[I],F.nr===z){B[z]=F.fh;break}v=3<w?w:4;d=new Float32Array(v);I=new Uint32Array(v);for(var z=new Float32Array(4),
F=new Float32Array(v),v=new Uint32Array(v),U=new Float32Array(4),K=0;K<l;K++)d.set(F),I.set(v),z.set(U),u.set(n(t,w,K,l,B,d,I,z),4*K)}else u=new Float32Array(0);I=u;d=k?x.ra(k):{};d.a_color={Se:!0};d.a_color.src=s(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,jc:7}]:[];k={a_texcoord:b,a_influence:I};I=r.vertex_colors;b=r.color;t=a.name;u=[];for(w=0;w<I.length;w++)u.push(I[w].name);for(var fa in d)if(w=d[fa].src,w.length){for(z=B=0;z<w.length;z++)B+=x.vf(w[z].jc);k[fa]=new Float32Array(B*
l);for(z=F=0;z<w.length;z++){var S=w[z].name,v=w[z].jc,U=x.oq(v),ea=u.indexOf(S);if(-1==ea)throw'B4W Error: vertex color "'+S+'" for mesh "'+t+'" not found.';var K=I[ea].mask,A=x.vf(K);(v&K)!==v&&e.error("B4W Error: Wrong color extraction from "+S+" to "+fa+".");for(var da=S=0;da<ea;da++)S+=x.vf(I[da].mask);ea=S*l;for(S=0;S<l;S++)for(da=0;3>da;da++)U[da]&&(k[fa][S*B+(F+x.Rh(v,da))]=b[ea+S*A+x.Rh(K,da)]);F+=A}}else k[fa]=new Float32Array(0);fa=a.uv_textures;d=r.texcoord;I=r.texcoord2;b=a.name;if(f)for(var ga in f){t=
fa.indexOf(ga);if(-1==t)throw'B4W Error: uv map "'+ga+'" for mesh "'+b+'" not found';if(0==t)var D=new Float32Array(d);else 1==t&&(D=new Float32Array(I));k[f[ga]]=D}h.A=k;h.Y=new Uint32Array(r.indices);f=r.position.length/l/3;D=(ga=s(c,"a_normal")&&r.normal.length?!0:!1)&&s(c,"a_tangent")&&r.tangent.length?!0:!1;fa=ga&&m.texture_slots.length&&s(c,"a_tangent")&&"ORCO"==m.texture_slots[0].texture_coords?!0:!1;for(k=0;k<f;k++){m={};d=new Float32Array(3*l);I=new Float32Array(ga?3*l:0);b=new Float32Array(D||
fa?4*l:0);t=k*l*3;u=t+3*l;d.set(r.position.subarray(t,u),0);ga&&(t=k*l*3,u=t+3*l,I.set(r.normal.subarray(t,u),0));if(D)t=k*l*4,u=t+4*l,b.set(r.tangent.subarray(t,u),0);else if(fa)for(t=I,u=b,w=l,e.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),B=0;B<w;B++)z=y,F=L,z[0]=t[3*B],z[1]=t[3*B+1],z[2]=t[3*B+2],H.cross(z,x.AXIS_Z,F),0==H.length(F)&&H.cross(z,x.AXIS_X,F),H.normalize(F,F),u[4*B]=F[0],u[4*B+1]=
F[1],u[4*B+2]=F[2],u[4*B+3]=1;else if(ga&&s(c,"a_tangent"))for(b=new Float32Array(4*l),k=0;k<b.length;k++)b[k]=1;m.a_position=d;m.a_normal=I;m.a_tangent=b;h.r.push(m)}if(1<f){a=h.r[0];var m={},q;for(q in a)m[q]=new Float32Array(a[q]);h.r.push(m)}s(c,"a_polyindex")&&(g(h,1,!0),h.A.a_polyindex=p(h));return h}function s(a,b){return-1<a.indexOf(b)?!0:!1}function n(a,b,c,d,e,g,k,f){for(var h=!0,p=0;p<b;p++){var r=a[p*d+c];if(-1!==r){var l=e[p];-1!==l&&(g[p]=r,k[p]=l,h=!1)}}if(h)return f;u(g,k,!1);for(p=
a=0;4>p;p++)a+=g[p];if(.01>a)return f;for(p=0;4>p;p++)g[p]/=a;if(.01>Math.abs(g[0]-1))f[0]=k[0]+1;else for(p=0;4>p;p++)f[p]=k[p]+g[p];return f}function w(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function u(a,b,c){var d=a.length,e=d,g=!1;for(c=c?-1:1;1<e||g;){1<e&&(e=Math.floor(e/1.247330950103979));for(var g=!1,k=0;e+k<d;k++)0>c*(a[k]-a[k+e])&&(g=a[k],a[k]=a[k+e],a[k+e]=g,g=b[k],
b[k]=b[k+e],b[k+e]=g,g=!0)}}function z(a,b,c){var d=[],e=[];H.subtract(b,a,d);H.subtract(c,a,e);H.normalize(d,d);H.normalize(e,e);return Math.acos(H.dot(d,e))}function F(a,c,d){c||(c=[]);d=d?a.r[0].a_normal:a.r[0].a_position;if(b(a)){a=a.Y;for(var e=a.length/3,g=0;g<e;g++){var k=new Float32Array(9),f=a[3*g];k[0]=d[3*f];k[1]=d[3*f+1];k[2]=d[3*f+2];f=a[3*g+1];k[3]=d[3*f];k[4]=d[3*f+1];k[5]=d[3*f+2];f=a[3*g+2];k[6]=d[3*f];k[7]=d[3*f+1];k[8]=d[3*f+2];c[g]=k}}else for(g=0;g<d.length;g++)k=new Float32Array(9),
k[0]=d[9*g],k[1]=d[9*g+1],k[2]=d[9*g+2],k[3]=d[9*g+3],k[4]=d[9*g+4],k[5]=d[9*g+5],k[6]=d[9*g+6],k[7]=d[9*g+7],k[8]=d[9*g+8],c[g]=k;return c}function p(a){for(var b=new Float32Array(a.C),c=0;c<a.C;c++)b[c]=c%3;return b}function B(a,b,c){var d=H.dist(a,b);a=H.dist(a,c);b=H.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var e=q("__print"),t=q("__tsr"),x=q("__util"),K=q("__extensions"),H=q("vec3"),y=new Float32Array(3),L=new Float32Array(3),r=new Float32Array(3);a.Zc=10;a.Rm=20;a.Ez=30;a.ii=10;a.Jm=
20;a.Im=30;a.xr=40;a.yr=50;a.Og=a.ii;var D=null;a.Xb=function(a){D=a};a.gA=function(a){var b=_buffers[a];D.deleteBuffer(b.sd);D.deleteBuffer(b.Bf);delete _buffers[a]};a.qy=function(d,e,k,p){c(d)&&g(d);var r=d.Y,l=d.C,n=d.r,x={},t;for(t in d.A)t in p&&!p[t].Se||(x[t]=d.A[t]);p={Vd:null,Uc:null,kl:0,count:0,Kb:{},mode:0,$h:0,Hi:0,bo:0,Bf:null,sd:null,Ui:null};if(r.length)if(t=r.length,65536>=l)var m=new Uint16Array(r),y=D.UNSIGNED_SHORT;else m=new Uint32Array(r),y=D.UNSIGNED_INT;else t=l,m=null;var u=
0,s=n.length,z;for(z in n[0])var B=n[0][z],u=u+B.length*s;for(z in x)B=x[z],u+=B.length;z=new Float32Array(u);var u=0,s={},H;for(H in x){var v=x[H];if(B=v.length)z.set(v,u),s[H]={Mz:H,Ic:w(v,l),offset:u,frames:1,length:B},u+=B}x=n.length;for(H in n[0])if(v=n[0][H],B=v.length,v=w(v,l),B){s[H]={Ic:v,offset:u,frames:x,length:B};1<x&&(s[H+"_next"]={Ic:v,offset:u+B,frames:x,length:B});for(var I=0;I<x;I++)v=n[I][H],z.set(v,u),u+=B}p.count=t;p.Vd=m;p.Uc=z;p.kl=y;p.Kb=s;f(p,k);h(p);e!=a.Zc&&b(d)&&(p.Ui={Iw:new Float32Array(r.length),
Jw:new Float32Array(r.length),Mu:new Float32Array(r.length/3),type:e});return p};a.uw=c;a.tw=b;a.lm=g;a.Hy=function(a,b,c){f(a,b);a.count=c.length;a.Vd=c;a.kl=c instanceof Uint16Array?D.UNSIGNED_SHORT:D.UNSIGNED_INT};a.Mj=function(a,b,c,d){var e=a.Uc,g=a.Kb,k=g[b];if(k){if(c&&k.Ic!=c)throw'Error: invalid num_comp for "'+b+'"';e.set(d,k.offset)}else e=e.length,k=new Float32Array(e+d.length),k.set(a.Uc),k.set(d,e),a.Uc=k,g[b]={Ic:c,offset:e};h(a)};a.Uu=m;a.hB=function(a){a.$h=D.STATIC_DRAW};a.Dw=function(a){a.$h=
D.DYNAMIC_DRAW};a.My=h;a.In=function(a){a.sd&&D.deleteBuffer(a.sd);a.Bf&&D.deleteBuffer(a.Bf)};a.$o=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Sq=function(a,b){for(var c=0;c<a.r.length;c++){var d=a.r[c].a_position;t.Eg(d,b,d,0);d=a.r[c].a_normal;0<d.length&&t.Jj(d,b,d,0);d=a.r[c].a_tangent;0<d.length&&t.$q(d,b,d,0)}(c=a.A.au_center_pos)&&c.length&&t.Eg(c,b,c,0);return a};a.oy=function(a,b){var c=a.A.au_center_pos;if(c&&c.length){var d=new Float32Array(c);t.Eg(d,b,d,0);for(var e=0;e<
a.r.length;e++)for(var g=0;g<d.length;g++)a.r[e].a_position[g]+=d[g]-c[g];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.ny=function(a,b){var c=a.C,d;for(d in b){var e=b[d].length;a.A[d]=new Float32Array(e*c);for(var g=0;g<c;g++)for(var k=0;k<e;k++)a.A[d][g*e+k]=b[d][k]}};a.py=k;a.Cw=function(a,b,c){if(!a.C)return x.mb("EMPTY");var d=c.length;65536<a.C*d&&!K.Go()&&g(a,d);var e=a.Y,k=a.C,f=a.A;a=a.r;for(var h in b){var p=b[h].length,r=p*k;f[h]=new Float32Array(r);
for(var l=0;l<k;l++)for(r=0;r<p;r++)f[h][l*p+r]=b[h][r]}b=x.mb("CLONE_"+d+"_SUBMESHES");b.C=k*d;b.Y=new Uint32Array(e.length*d);for(l=0;l<d;l++)for(p=e.length*l,h=k*l,r=0;r<e.length;r++)b.Y[p+r]=e[r]+h;for(var n in f)for(e=f[n],r=e.length*d,p=w(e,k),b.A[n]=new Float32Array(r),l=0;l<d;l++)h=k*p*l,b.A[n].set(e,h);for(n in a[0])for(l=0;l<a.length;l++)for(e=a[l][n],r=e.length*d,p=w(e,k),b.r[l]=b.r[l]||{},b.r[l][n]=new Float32Array(r),r=0;r<d;r++)switch(f=c[r],h=k*p*r,n){case "a_position":t.Eg(e,f,b.r[l][n],
h);break;case "a_normal":t.Jj(e,f,b.r[l][n],h);break;case "a_tangent":t.$q(e,f,b.r[l][n],h);break;default:throw"Wrong attribute name: "+n;}return b};a.so=l;a.Xu=function(a){var b=a.C,c=a.r[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.Y.length);for(var g=0;g<b;g++)d[12*g]=c[3*g],d[12*g+1]=c[3*g+1],d[12*g+2]=c[3*g+2],d[12*g+3]=c[3*g],d[12*g+4]=c[3*g+1],d[12*g+5]=c[3*g+2],d[12*g+6]=c[3*g],d[12*g+7]=c[3*g+1],d[12*g+8]=c[3*g+2],d[12*g+9]=c[3*g],d[12*g+10]=c[3*g+
1],d[12*g+11]=c[3*g+2],e[8*g]=-.5,e[8*g+1]=-.5,e[8*g+2]=-.5,e[8*g+3]=.5,e[8*g+4]=.5,e[8*g+5]=.5,e[8*g+6]=.5,e[8*g+7]=-.5,a[6*g]=4*g+2,a[6*g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=x.mb("HALO");c.r=[];c.r[0]={};c.C=4*b;c.r[0].a_position=d;c.A.a_halo_bb_vertex=e;c.Y=a;return c};a.ew=s;a.Yu=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=l(a,d,b,null,null,null);e.C&&c.push(e)}return 0==c.length?x.mb("EMPTY"):1==c.length?c[0]:k(c)};a.Gy=
function(a,b,c){for(var d=a.Vd,e=m(a,"a_position"),g=a.Ui,k=g.Iw,f=g.Jw,g=g.Mu,h=d,p=h.length/3,r=0;r<p;r++){var l=h[3*r],n=h[3*r+1],t=h[3*r+2],u=e[3*l+1],y=e[3*l+2],v=e[3*n+1],I=e[3*n+2],U=e[3*t+1],s=e[3*t+2];k[3*r]=(e[3*l]+e[3*n]+e[3*t])/3;k[3*r+1]=(u+v+U)/3;k[3*r+2]=(y+I+s)/3}x.ce(k,b,f);b=k.length/3;for(e=0;e<b;e++)f=k[3*e]-c[0],h=k[3*e+1]-c[1],p=k[3*e+2]-c[2],g[e]=f*f+h*h+p*p;c=d;d=g.length;if(!(2>d))for(k=d,e=!1;1<k||e;)for(1<k&&(k=Math.floor(k/1.247330950103979)),e=!1,b=0;k+b<d;b++)0>g[b]-
g[b+k]&&(e=g[b],g[b]=g[b+k],g[b+k]=e,e=c,f=b,h=b+k,p=e[3*f],r=e[3*f+1],l=e[3*f+2],e[3*f]=e[3*h],e[3*f+1]=e[3*h+1],e[3*f+2]=e[3*h+2],e[3*h]=p,e[3*h+1]=r,e[3*h+2]=l,e=!0);d=c;D.bindBuffer(D.ELEMENT_ARRAY_BUFFER,a.sd);D.bufferData(D.ELEMENT_ARRAY_BUFFER,d,D.DYNAMIC_DRAW)};a.$x=u;a.un=function(a,b,c){for(var d=b.length/3,e=a.length/3,g=[],k=Array(3),f=Array(3),h=Array(3),p=0;p<e;p++){for(var r=a[3*p],l=a[3*p+1],n=a[3*p+2],x=0;3>x;x++)k[x]=b[3*r+x],f[x]=b[3*l+x],h[x]=b[3*n+x];if(c)var x=z(k,f,h),t=z(f,
h,k),m=Math.PI-x-t;else m=t=x=1;var v=g,I;I=k;var U=h,u=[],y=[],S=[];H.subtract(f,I,u);H.subtract(U,I,y);H.cross(u,y,S);H.normalize(S,S);I=S;for(U=0;3>U;U++)u=3*l+U,y=3*n+U,v[3*r+U]=x*I[U],v[u]=t*I[U],v[y]=m*I[U]}if(c)for(var s in c)for(p=c[s],a=0;3>a;a++){b=3*p[0]+a;for(e=1;e<p.length;e++)k=3*p[e]+a,g[b]+=g[k];for(e=1;e<p.length;e++)k=3*p[e]+a,g[k]=g[b]}for(p=0;p<d;p++){c=p;s=g;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=s[e];H.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,s[e]=a[b]}return g};a.wn=
function(a,b,c){for(var d={},e=b.length/3,g=0;g<e;g++){var k=String(b[3*g])+String(b[3*g+1])+String(b[3*g+2]);d[k]=[]}e=a.length;for(g=0;g<e;g++)b=a[g],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in d&&d[k].push(b);return d};a.al=function(a,b,c,d){var e=F(a,null,!1);if(c)var g=F(a,null,!0);var k=e.length,f=new Float32Array(k),h=y,p=L;for(a=0;a<k;a++){var l=e[a];h.set(l.subarray(0,3));p.set(l.subarray(3,6));r.set(l.subarray(6));f[a]=Math.sqrt(B(h,p,r))}h=new Float32Array(k);h[0]=f[0];for(a=
1;a<k;a++)h[a]=h[a-1]+f[a];k=h[f.length-1];f=[];for(a=0;a<b;a++){var p=k*x.kc(d),p=x.ui(h,p,0,h.length-1),l=c?g[p]:e[p],p=a,n=l,t=d,l=void 0,l=new Float32Array(3),m=n[0],u=n[1],s=n[2],v=n[3],I=n[4],U=n[5],z=n[6],fa=n[7],S=n[8],n=x.kc(t),t=x.kc(t);1<n+t&&(n=1-n,t=1-t);var w=1-n-t,u=w*u+n*I+t*fa,s=w*s+n*U+t*S;l[0]=w*m+n*v+t*z;l[1]=u;l[2]=s;f[p]=l}return f};a.lA=F;a.ro=p;a.DB=B;a.Ov=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],k=b[1]-a[1],f=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=k*a-b*f;d[1]=g*b-e*
a;d[2]=e*f-k*g;return d};a.ux=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,q){function c(a){a={type:a,jd:0,dw:[0,0],e:new Float32Array(3),quat:new Float32Array(4),Tc:new Float32Array(8),H:new Float32Array(16),ip:new Float32Array(16),Wa:new Float32Array(3),Ud:new Float32Array(3),ir:!1,T:0,xm:1,wm:1,ym:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,cr:!1,Fc:0,Pf:0,zb:!1,pb:null,Aa:null,Oa:null,lo:!0,M:null,Pi:null,mh:0,hh:0,Wk:0,yh:0,gf:0,aq:"",Qj:!1,Nb:!1,rb:!1,Ob:!1,Wb:!1,Mb:!1,uc:!1,Ge:!1,Vc:!1,Ii:!1,md:!1,ya:!1,Qf:!1,qh:!1,
bj:!1,Kc:!1,mj:!1,Yi:!1,is_visible:!1,gi:0,Wc:0,ue:0,Nd:0,Md:0,Kd:0,ud:"",xb:null,ti:!1,cd:!1,Vg:"",ok:!1,Qe:0,time:0,vm:0,kr:0,max_bones:0,lh:!1,ci:!1,uh:!1,Hd:!1,Gd:1,gk:0,fk:1,Kj:new Int8Array([-1,-1]),Dj:[],yp:[],Bq:[],Vb:null,Ub:null,dc:null,cc:null,gc:null,bq:null,jf:null,zh:null,Db:null,nk:null,lk:null,mk:null,Ia:null,rc:null,kb:null,Ee:null,Fe:null,scale:1,Zd:1E4};B.identity(a.quat);F.identity(a.Tc);t.identity(a.H);t.identity(a.ip);return a}function b(a,b,c,d){var e=a.d.va,g;for(g in e){var k=
a.name+"_"+g;g in d||(d[g]=b.length,b.push(e[g][0]));c.push(k,d[g])}}var g=q("__animation"),d=q("__batch"),m=q("__boundings"),f=q("__camera"),h=q("__config"),k=q("__constraints"),l=q("__curve"),s=q("__lights"),n=q("__nla"),w=q("__particles");q("__print");var u=q("__scenes"),z=q("__transform"),F=q("__tsr"),p=q("__util"),B=q("quat"),e=q("vec3"),t=q("mat4"),x=h.n,K=0,H=new Float32Array(4);a.Fi=c;a.um=function(a,h){var r;r=a.parent;if(!(r=r&&r.Ls)){if(!(r="ARMATURE"===a.type||"CAMERA"===a.type)&&(r="MESH"===
a.type)){var B=g.Wi(a),q=a.b4w_do_not_batch,V=a.b4w_dynamic_geometry,N=a.b4w_collision,Z=a.b4w_vehicle,P=a.b4w_floating;r=a.b4w_character;var M=a.b4w_billboard,O=w.gw(a),Q=n.ap(a);if(!(B=B||q||V||N||Z||P))a:{B=a.data;for(q=0;q<B.materials.length;q++)if("LENS_FLARES"===B.materials[q].name){B=!0;break a}B=!1}r=B||O||r||M||Q}!r&&(r="EMPTY"===a.type)&&(r=g.Wi(a),M=n.ap(a),r=r||M)}r=r?!0:!1;a.Ls=r;a.d=c("MESH"===a.type?r?"DYNAMIC":"STATIC":a.type);a.$a=null;a.Fd=[];a.Cb||(a.Cb=null);r=a.d;O=a.location;
M=a.scale[0];p.cx(a.rotation_quaternion,H);z.set_translation(a,O);z.set_rotation(a,H);z.set_scale(a,M);switch(a.type){case "ARMATURE":O=a.pose.bones;for(M=0;M<O.length;M++)Q=O[M],B=Q.bone,q=new Float32Array(B.matrix_local),V=new Float32Array(16),t.invert(q,V),N=new Float32Array(Q.matrix_basis),Z=new Float32Array(3),e.subtract(B.tail_local,B.head_local,Z),p.bz(Z,V,Z),Q.Ps=Z,Q.Is=[Q].concat(Q.parent_recursive),Q.Um=F.Ao(q,F.create()),Q.Tm=F.Ao(N,F.create()),Q.ck=F.create(),Q.mi=!1;O=g.yt(a);r.gc=O;
O=g.vn(a,O);a.b4w_animation_mixing?(r.Vb=new Float32Array(O.ja),r.Ub=new Float32Array(O.ja),r.dc=new Float32Array(O.e),r.cc=new Float32Array(O.e)):(r.Vb=O.ja,r.Ub=O.ja,r.dc=O.e,r.cc=O.e);r.bq=O;r.Qe=0;r.Hd=a.b4w_animation_mixing;break;case "MESH":r.Kc=x.all_objs_selectable||a.b4w_selectable;r.mj=a.b4w_selectable;r.cd=a.b4w_billboard;r.Vg="BASIC";r.ok="SPHERICAL"==a.b4w_billboard_geometry;r.Pi={Zv:a.b4w_glow_settings.glow_duration,aw:a.b4w_glow_settings.glow_period,bw:a.b4w_glow_settings.glow_relapses};
r.Kc&&(a.Sm=p.jv(K),K++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.ci=a.data.b4w_vertex_anim.length?!0:!1;if(M=g.get_first_armature_object(a)){O=a.d;Q=a.data.vertex_groups;if(Q.length){B=M.data.bones;q=M.pose.bones;V=0;N={};for(Z=0;Z<B.length;Z++){var P=B[Z].name,R=p.keysearch("name",P,Q);if(R){var T=p.el(q,"name",P);N[P]={sn:Z,fh:V++,Ol:T,nr:R.index}}}O.gc=N;O.max_bones=V;O.uh=!0}O=a.d.gc;O=g.vn(M,O);M.b4w_animation_mixing?(r.Vb=new Float32Array(O.ja),r.Ub=new Float32Array(O.ja),r.dc=
new Float32Array(O.e),r.cc=new Float32Array(O.e)):(r.Vb=O.ja,r.Ub=O.ja,r.dc=O.e,r.cc=O.e);r.bq=O;r.Qe=0}if(g.hl(a)){M=a.d;O=a.data.materials;Q=[];B=[];for(q=0;q<O.length;q++)if((V=O[q].node_tree)&&V.animation_data)for(Z=V.animation_data,V={},(N=Z.action)&&b(N,Q,B,V),Z=Z.nla_tracks,P=0;P<Z.length;P++)for(R=Z[P].strips,T=0;T<Z[P].strips.length;T++)N=R[T].action,b(N,Q,B,V);M.jf=Q;M.zh=B}a.P=[];r.Nb=a.b4w_shadow_cast;r.rb=a.b4w_shadow_receive;r.Ob=a.b4w_shadow_cast_only&&r.Nb;r.Wb=a.b4w_reflexible;r.Mb=
a.b4w_reflexible_only&&r.Wb;r.uc=a.b4w_reflective;r.Ge=a.b4w_caustics;r.Vc=a.b4w_wind_bending;r.gi=a.b4w_wind_bending_angle;M=d.iz(a.b4w_wind_bending_angle,d.qt(a.data.b4w_bounding_box),a.scale[0]);r.Wc=M;r.ue=a.b4w_wind_bending_freq;r.Nd=a.b4w_detail_bending_freq;r.Md=a.b4w_detail_bending_amp;r.Kd=a.b4w_branch_bending_amp;r.qh=!1;r.ud=a.b4w_main_bend_stiffness_col;M=a.b4w_detail_bend_colors;r.xb={};r.xb.sp=M.leaves_stiffness_col;r.xb.rp=M.leaves_phase_col;r.xb.Ip=M.overall_stiffness_col;r.Qf=a.b4w_do_not_cull;
r.Ii=a.b4w_disable_fogging;r.md=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";M=a.data.materials[0];r.mh=M.physics.friction;r.hh=M.physics.elasticity;r.yh=0;r.Zd=1E4;r.gf=a.b4w_lod_transition;r.bj=!0;break;case "CAMERA":f.Ct(a);f.nt(a);break;case "LAMP":s.yw(a);break;case "CURVE":if(M=l.ru(a))a.Os=M;break;case "EMPTY":r.Db=m.Xc(),M=m.hi(),r.rc=M}if(!h&&(a.parent&&"OBJECT"==a.parent_type?(O=r.e,Q=r.quat,M=r.scale,k.bn(a,a.parent,O,Q,M)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==
a.parent.type?(O=r.e,Q=r.quat,M=r.scale,k.an(a,a.parent,a.parent_bone,O,Q,M)):a.Cb&&a.Cb.b4w_group_relative?(M=F.Of(r.e,r.scale,r.quat),k.Vs(a,a.Cb,M)):a.Cb&&!a.Cb.b4w_group_relative&&(z.v(a),Q=r.H,t.multiply(a.Cb.d.H,Q,Q),O=p.hf(Q),M=p.dj(Q),Q=p.matrix_to_quat(Q),z.set_translation(a,O),z.set_rotation(a,Q),z.set_scale(a,M)),M=a.dupli_group))for(O=M.objects,M=0;M<O.length;M++)O[M].Cb=a;a.field&&(r.Wk=a.field.strength,u.fr(a));r.Qj=a.game.use_collision_compound;r.aq=a.game.physics_type;z.v(a)};a.Py=
function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||z.v(c);c.b4w_use_default_animation&&g.Wi(c)&&(g.apply_def(c),g.play(c,null,g.SLOT_ALL))}};a.cleanup=function(){K=0}};b4w.module.__particles=function(a,q){function c(){throw"_rand() undefined";}function b(a,b,c,d,g,e,f){var h=a.I.Nk,l=a.I.Gc,m=a.I.time;a=a.I.cq;for(var s=b?4:1,q=0;q<h.length;q+=s){var r=h[q];if(r>a&&r<=m)for(r=0;8>r;r++)l[8*q+r]=g[r];for(r=0;8>r;r++)n[r]=l[8*q+r];r=w;r[0]=c[3*q];r[1]=c[3*q+1];r[2]=c[3*q+2];k.Yh(r,n,r);e[3*q]=r[0];e[3*q+1]=r[1];e[3*q+2]=r[2];var D=w;D[0]=d[3*q];D[1]=d[3*q+1];D[2]=d[3*q+2];k.Ij(D,n,D);f[3*q]=D[0];f[3*q+1]=D[1];f[3*q+2]=D[2];if(b)for(r=1;4>r;r++)e[3*(q+r)]=e[3*q],e[3*
(q+r)+1]=e[3*q+1],e[3*(q+r)+2]=e[3*q+2],f[3*(q+r)]=D[0],f[3*(q+r)+1]=D[1],f[3*(q+r)+2]=D[2]}}function g(a){a?(h.jy(a),c=function(){return h.ex()}):c=function(){return Math.random()}}var d=q("__config"),m=q("__geometry"),f=q("__scenes"),h=q("__util"),k=q("__tsr"),l=q("vec3"),s=d.Jd,n=new Float32Array(8),w=new Float32Array(3);a.ag=function(a){return 0<a.particle_systems.length?!0:!1};a.Ti=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.IA=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.gw=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.ov=function(a,d,f,p){f.I=f.I||{};var n=m.Yu(d),e=f.settings.count,t=f.settings.frame_start/s.ua,x=f.settings.frame_end/s.ua,w=f.settings.lifetime/s.ua,H=f.settings.lifetime_random,y=f.settings.emit_from,q=
f.settings.factor_random,r=f.settings.angular_velocity_mode,D=f.settings.angular_velocity_factor,G=f.settings.b4w_randomize_emission,V=f.settings.b4w_cyclic;g(f.seed);var N=f.I.Zy="WORLD"==f.settings.b4w_coordinate_system?!0:!1;f.I.frame=0;if(d=!a.Ve){var Z;Z=[];for(var P=0;P<e;P++)Z.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);Z=new Float32Array(Z);for(var P=[],M=0;M<e;M++)P.push(4*M,4*M+2,4*M+1,4*M,4*M+3,4*M+2);P=new Uint16Array(P)}switch(y){case "VERT":for(var M=n.r[0].a_position,n=n.r[0].a_normal,O=M.length/
3,y=[],Q=0;Q<e;Q++){var R=Math.round((O-1)*c());y.push(R);d&&(y.push(R),y.push(R),y.push(R))}O=[];for(Q=0;Q<y.length;Q++)O.push(M[3*y[Q]]),O.push(M[3*y[Q]+1]),O.push(M[3*y[Q]+2]);M=new Float32Array(O);O=[];for(Q=0;Q<y.length;Q++)O.push(n[3*y[Q]]),O.push(n[3*y[Q]+1]),O.push(n[3*y[Q]+2]);y=new Float32Array(O);break;case "FACE":M=[];y=[];Q=[];h.Vi(0,Q);O=m.al(n,e,!1,Q);h.Vi(0,Q);n=m.al(n,e,!0,Q);for(Q=0;Q<O.length;Q++)M.push(O[Q][0],O[Q][1],O[Q][2]),d&&(M.push(O[Q][0],O[Q][1],O[Q][2]),M.push(O[Q][0],
O[Q][1],O[Q][2]),M.push(O[Q][0],O[Q][1],O[Q][2])),y.push(n[Q][0],n[Q][1],n[Q][2]),d&&(y.push(n[Q][0],n[Q][1],n[Q][2]),y.push(n[Q][0],n[Q][1],n[Q][2]),y.push(n[Q][0],n[Q][1],n[Q][2]));M=new Float32Array(M);y=new Float32Array(y);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}y=[M,y];n=y[0];y=y[1];f.I.Xw=new Float32Array(n);f.I.Pw=new Float32Array(y);f.I.Yw=new Float32Array(n.length);f.I.Qw=new Float32Array(y.length);f.I.time=0;f.I.cq=
-1;M=[];x=(x-t)/e;for(O=0;O<e;O++)Q=G?x*O+10*x*(.5-c()):x*O,V||(Q+=t),M.push(Q),d&&(M.push(Q),M.push(Q),M.push(Q));t=new Float32Array(M);f.I.Nk=new Float32Array(t);f.I.co=new Float32Array(t);f.I.Gc=new Float32Array(8*t.length);for(G=0;G<8*t.length;G++)for(V=0;8>V;V++)f.I.Gc[8*G+V]=p[V];N?b(f,d,n,y,p,n,y):(k.Eg(n,p,n,0),k.Jj(y,p,y,0));f=[];p=w*H;for(H=0;H<e;H++)N=p*c(),f.push(w-N),d&&(f.push(w-N),f.push(w-N),f.push(w-N));w=new Float32Array(f);f=[];for(p=0;p<e;p++){H=[c()-.5,c()-.5,c()-.5];l.normalize(H,
H);f.push(q*H[0]);f.push(q*H[1]);f.push(q*H[2]);switch(r){case "NONE":f.push(0);break;case "SPIN":case "VELOCITY":f.push(D);break;case "RAND":f.push(2*D*(c()-.5));break;default:throw"Undefined velocity factor";}if(d)for(H=f.slice(-4),N=0;12>N;N++)f.push(H[N%4])}e=new Float32Array(f);q=h.mb("EMITTER_PARTICLES");r=h.hd();r.a_position=n;r.a_normal=y;q.r[0]=r;d?q.Y=P:(a.ld=m.Jm,q.Y=new Uint16Array(0));q.C=n.length/3;q.A.a_p_delay=t;q.A.a_p_lifetime=w;q.A.a_p_vels=e;d&&(q.A.a_p_bb_vertex=Z);return q};
a.Ly=function(a){for(var c=a.P,d=0;d<c.length;d++){var g=c[d],f=c[d].Jc;if(f){var e=g.bb,h=f.I.Yw,l=f.I.Qw,n=f.I.Xw,s=f.I.Pw;f.I.Zy?b(f,!g.Ve,n,s,a.d.Tc,h,l):(g=s,f=a.d.Tc,s=l,k.Eg(n,f,h,0),k.Jj(g,f,s,0));m.Dw(e);m.Mj(e,"a_position",3,h);m.Mj(e,"a_normal",3,l)}}};a.Ex=function(a,b,c){var d=b.settings.lifetime/s.ua,g=b.settings.normal_factor,e=9.81*b.settings.effector_weights.gravity,k=b.settings.effector_weights.wind,h=b.settings.mass,l=b.settings.b4w_fade_in/s.ua,n=b.settings.b4w_fade_out/s.ua,m=
b.settings.b4w_cyclic;a.Rp=b.settings.frame_end/s.ua-b.settings.frame_start/s.ua;a.Np=m?1:0;a.Kl=g;a.Qp=e;g=f.Yv();a.nj[0]=g[0]*k;a.nj[1]=g[1]*k;a.nj[2]=g[2]*k;a.Tp=d;a.Sp=h;a.Op=l;a.Pp=n;a.Ve?(d=c.halo.size,k=c.halo.hardness,30>k?(k=.5,h=.9):40>k?(k=.1,h=1):50>k?(k=0,h=.8):(k=0,h=.5)):(d=b.settings.particle_size,h=k=1);a.Ll=d;a.Kp=k;a.Jp=h;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;
k=Math.min(2*d.length,b.length);for(h=0;h<k;h+=2)l=d[h/2],b[h]=l.position,b[h+1]=(l.color[0]+l.color[1]+l.color[2])/3;a.Vp=d.length}a.Up.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;k=Math.min(4*d.length,c.length);for(h=0;h<k;h+=4)l=d[h/4],c[h]=l.position,c[h+1]=l.color[0],c[h+2]=l.color[1],c[h+3]=l.color[2];a.Mp=d.length}a.Lp.set(c)};
a.Lx=function(a,b){a.I.cq=a.I.time;a.I.time=b};a.Zw=function(a){for(var b=a.C,c=a.r[0].a_position,d=a.A.a_texcoord,g=[],e=[],k=0;k<b;k++)e.push(c[3*k]),e.push(c[3*k+1]),g.push(c[3*k+2]);g=new Float32Array(g);e=new Float32Array(e);a.A.a_lf_dist=g;a.A.a_lf_bb_vertex=e;a.A.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.P;for(var d=0;d<a.length;d++){var g=a[d],e=g.Jc;e&&e.name==b&&(g.Ll=c)}};a.set_normal_factor=function(a,b,c){a=a.P;for(var d=0;d<a.length;d++){var g=a[d],e=g.Jc;e&&e.name==b&&(g.Kl=
c)}};a.set_factor=function(a,b,c){a=a.P;for(var d=0;d<a.length;d++){var g=a[d],e=g.Jc;if(e&&e.name==b){var k=e.I.Nk;if(1==c)e=k;else if(0==c)for(var f=!g.Ve,h=f?4:1,e=e.I.co,l=0;l<e.length;l+=h)e[l]=1E4,f&&(e[l+1]=e[l],e[l+2]=e[l],e[l+3]=e[l]);else for(var n=1/c,e=e.I.co,h=(f=!g.Ve)?4:1,s=0,l=0;l<e.length;l+=h)l>=s?(e[l]=k[l],s+=n):e[l]=1E4,f&&(e[l+1]=e[l],e[l+2]=e[l],e[l+3]=e[l]);m.Mj(g.bb,"a_p_delay",1,e)}}};a.Uy=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var g=a[d];if("EMITTER"==
g.settings.type)for(var e=g.I.Nk,d=0;d<8*e.length;d++)g.I.Gc[8*d]=b[0],g.I.Gc[8*d+1]=b[1],g.I.Gc[8*d+2]=b[2],g.I.Gc[8*d+3]=b[3],g.I.Gc[8*d+4]=c[0],g.I.Gc[8*d+5]=c[1],g.I.Gc[8*d+6]=c[2],g.I.Gc[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,q){function c(a,b,c,d){for(var g=[],h=[],m=[],q=[],p=2*c/(a-1),B=2*d/(b-1),e=0;e<a;e++)for(var t=-c+e*p,x=0;x<b;x++)if(h.push(t,0,-d+x*B),m.push(0,1,0),q.push(e/(a-1),x/(b-1)),e&&x){var K=e*b+x,H=K-1,y=(e-1)*b+x,L=y-1;g.push(K,H,y);g.push(H,L,y)}a=f.hd();a.a_position=new Float32Array(h);a.a_normal=new Float32Array(m);m=f.mb("GRID_PLANE");m.r[0]=a;m.A.a_texcoord=new Float32Array(q);m.Y=new Uint32Array(g);m.C=h.length/3;return m}function b(a){var b=a.length;if(b%4)throw"Wrong array";
for(var c=[],g=[],h=0;h<b;h+=4){var m=a[h+1],z=a[h+2],q=a[h+3];d(a[h],g);d(m,g);d(z,g);d(q,g);c.push(h,h+1,h+2);c.push(h,h+2,h+3)}a=f.hd();a.a_position=new Float32Array(g);b=f.mb("FROM_QUADS");b.r[0]=a;b.Y=new Uint32Array(c);b.C=g.length/3;return b}function g(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var m=q("__geometry"),f=q("__util"),h=q("__config").n;a.xA=function(a){for(var b=f.mb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=f.hd();d.a_point=new Float32Array(c);
b.r[0]=d;b.Y=new Uint32Array(c);b.C=2*a;return b};a.yA=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.wA=c;a.sv=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==q-1)||1==b%2&&(0==a||a==z-1)?!0:!1}var g=c/=Math.pow(2,a-1),u=c,z=b+1,q=b+1;b=[];c=[];for(var p=0,B=0,e=-1,t=[],x=0;x<a;x++){for(var K=2*g/(z-1),H=2*u/(q-1),y=[],L=[],r=0,D=0;D<z;D++){for(var G=-g+D*K,V=[],N=0;N<q;N++){var Z=-u+N*H;if(G>-p&&G<p&&Z>-B&&Z<B)V.push(-1),r++;else{for(var P=null,M=0;M<t.length;M+=3)if(G==t[M]&&
Z==t[M+1]){P=t[M+2];break}M=null!==P?P:e+1;d(D,N)?(V.push(-2),r++):(null==P&&(0==N||N==q-1||0==D||D==z-1?(P=x==a-1?K:2*K,y.push(G,Z,M)):P=K,c.push(G,P,Z),e++),V.push(M));if(D&&N)if(1==D)if(d(D-1,N)){if(1<N){var Z=M-1,P=L[D-1][N+1],O=P-1;b.push(M,Z,O)}else P=L[D-1][N+1],O=P-1;b.push(M,O,P)}else d(D,N)||(Z=M-1,P=L[D-1][N],b.push(M,Z,P));else if(D==z-1){if(!d(D,N))if(N==q-1)Z=M-1,P=L[D-1][N-1],O=L[D-2][N],b.push(M,Z,P),b.push(M,P,O);else{var Z=M-1,P=L[D-1][N],O=P-1,Q=P+1;b.push(M,Z,O);b.push(M,O,P);
b.push(M,P,Q);2==N&&(Q=L[D-2][N-2],b.push(Z,Q,O))}}else 1==N?d(D,N-1)?(Z=L[D-1][N],P=L[D-1][N-1],b.push(M,P,Z)):(Z=V[N-1],P=L[D-1][N],O=L[D-2][N-1],b.push(M,Z,P),b.push(Z,O,P)):N==q-1?d(D,N)||(Z=V[N-1],P=L[D-1][N-1],O=L[D-2][N],b.push(M,Z,P),b.push(M,P,O)):-1!=L[D-1][N]&&-1!=L[D-1][N-1]&&-1!=V[N-1]?(Z=V[N-1],P=L[D-1][N],O=L[D-1][N-1],b.push(M,Z,P),b.push(Z,O,P),N==q-2&&d(D,N+1)&&(Q=L[D-1][N+1],b.push(M,P,Q))):N==q-2&&d(D,N+1)&&(P=L[D-1][N],Q=L[D-1][N+1],b.push(M,P,Q))}}L.push(V)}t=y;p=g;B=u;g*=2;
u*=2}2E4>p&&(a=-(2*p)/(z-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-p,a,-B),c.push(-p,a,B),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(p,a,-B),c.push(p,a,B),M=e+1,b.push(M+3,M+2,M+1,M+2,M+0,M+1,M+6,M+4,M+2,M+4,M+0,M+2,M+5,M+7,M+1,M+7,M+3,M+1,M+5,M+4,M+7,M+7,M+4,M+6));a=f.hd();a.a_position=new Float32Array(c);g=f.mb("multigrid_plane");g.r[0]=a;g.Y=new Uint32Array(b);g.C=c.length/3;h.Vj&&(m.lm(g,1,!0),a.a_polyindex=m.ro(g));return g};a.vA=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],g=[],h=0;h<b;h+=3){var m=a[h+1],z=a[h+2];d(a[h],g);d(m,g);d(z,g);c.push(h,h+1,h+2)}a=f.hd();a.a_position=new Float32Array(g);b=f.mb("FROM_TRIANGLES");b.r[0]=a;b.Y=new Uint32Array(c);b.C=g.length/3;return b};a.uA=b;a.pv=function(a){a=f.cz(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.qv=function(){var a=f.mb("BILLBOARD"),
b=f.hd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,1,2,3]);a.C=4;return a};a.Da=function(){var a=f.mb("BILLBOARD"),b=f.hd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,0,3,2]);a.C=4;return a};a.mv=function(){var a=f.mb("CUBEMAP_BOARD"),b=f.hd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,0,3,2]);a.C=4;return a};a.Do=function(a,b){var c=f.mb("UV_SPHERE"),
h,w,u=[],z=[],q=[];for(w=0;8>=w;w++)for(h=0;16>=h;h++){var p=h/16,B=w/8;z.push(-a*Math.cos(2*p*Math.PI)*Math.sin(B*Math.PI)+b[0],a*Math.cos(B*Math.PI)+b[1],a*Math.sin(2*p*Math.PI)*Math.sin(B*Math.PI)+b[2])}for(w=p=0;8>w;w++)for(h=0;16>h;h++){var B=g(z,17*w+h+1),e=g(z,17*w+h),t=g(z,17*(w+1)+h),x=g(z,17*(w+1)+h+1);Math.abs(B[1])==a+b[1]?(d(B,u),d(t,u),d(x,u),q.push(p,p+1,p+2),p+=3):Math.abs(t[1])==a+b[1]?(d(B,u),d(e,u),d(t,u),q.push(p,p+1,p+2),p+=3):(d(B,u),d(e,u),d(t,u),d(x,u),q.push(p,p+1,p+2),q.push(p,
p+2,p+3),p+=4)}h={};h.a_position=u;z=m.wn(q,z,u);h.a_normal=m.un(q,u,z);h.a_tangent=[];c.A.a_influence=[];c.A.a_color=[];c.A.a_texcoord=[];c.r[0]=h;c.Y=q;c.C=u.length/3;return c}};b4w.module.__prerender=function(a,q){var c=q("__config"),b=q("__debug"),g=q("__geometry"),d=q("__util"),m=q("vec3"),f=c.n,h="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Pl=function(a){if(-1<h.indexOf(a.type)){for(var c=!1,s=a.l,n=0;n<s.length;n++){var w=s[n],u=w,z=a,q=u.Va,p=z.h;u.R=!0;q.is_visible=!1;if(q)if(q.qh)u.R=!1;else{var B=p.Sd,e=q.kb.t,t=q.Zd,B=Math.sqrt((e[0]-B[0])*(e[0]-B[0])+(e[1]-B[1])*(e[1]-B[1])+
(e[2]-B[2])*(e[2]-B[2])),e=q.gf*q.kb.ma;B>=q.yh&&B<t+e?(q.is_visible=!0,"GLOW_MASK"!=z.type||Boolean(u.k.Zf)?(p=p.Yk,q.Qf?q=!1:"STATIC"===q.type?(t=q.kb,q=t.t,q=d.ey(q,p,t.ma)):(t=q.Fe,q=t.t,q=d.Ru(q,p,t.Be,t.Ce,t.De)),q?u.R=!1:"WIREFRAME"==z.type&&(u.R=u.k.wireframe_mode==b.Qm.WM_DEBUG_SPHERES?u.k.Lk:!u.k.Lk)):u.R=!1):u.R=!1}else u.R=!1;w.R&&(c=!0)}switch(a.type){case "WIREFRAME":break;default:a.R="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||c?!0:!1}}if("MAIN_BLEND"==a.type&&(c=a.h.Sd,m.dist(c,a.ur)>
f.alpha_sort_threshold&&f.alpha_sort&&a.l)){for(s=0;s<a.l.length;s++)w=a.l[s],u=w.k,n=w.Va.H,u&&u.qa&&u.Ed!=g.Zc&&(u=u.bb)&&w.R&&(w=u.Ui)&&w.type==g.Rm&&g.Gy(u,n,c);a.ur.set(c)}}};b4w.module.__print=function(a){var q=!1,c=0,b=0;a.Ox=function(a){q=a};a.log=function(){q&&console.log.apply(console,arguments)};a.error=function(){c++;console.error.apply(console,arguments)};a.warn=function(){b++;console.warn.apply(console,arguments)};a.time=function(){q&&console.time.apply(console,arguments)};a.timeEnd=function(){q&&console.timeEnd.apply(console,arguments)};a.group=function(){q&&console.group.apply(console,arguments)};a.groupCollapsed=function(){q&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){q&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Xv=function(){return b};a.Lv=function(){return c};a.clear_errors_warnings=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,q){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader")),"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness")),"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope")),"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size")),"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth")),"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity")),"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader")),"roughness"in a||(a.roughness=.5,b("node material",a,"roughness")),"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel")),"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"))}}function b(a,b,c){c=c+">>"+a;c in u||(u[c]={km:[],mq:"undefined",type:a});u[c].km.push(b.name)}function g(a,b){param_id in u||(u[param_id]={km:[],mq:"deprecated",type:a});u[param_id].km.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=k.Ie(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var g=
k.Zg(d[c]);e.submeshes.push(g)}return e}var m=q("__boundings"),f=q("__curve"),h=q("__print"),k=q("__util"),l=q("vec3"),s=q("vec4"),n=q("quat"),w=q("mat4"),u={};a.Gt=function(a){u={};var d=a.worlds;if(0==d.length){h.warn("WARNING Datablock world is missing, reexport scene");var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(f)}for(var d=a.worlds,
l=0;l<d.length;l++){var f=d[l],e=f.b4w_shadow_settings;"csm_resolution"in e||(b("world",f,"b4w_shadow_settings.csm_resolution"),e.csm_resolution=2048);"self_shadow_polygon_offset"in e||(b("world",f,"b4w_shadow_settings.self_shadow_polygon_offset"),e.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in e||(b("world",f,"b4w_shadow_settings.self_shadow_normal_offset"),e.self_shadow_normal_offset=.01);"b4w_enable_csm"in e||(b("world",f,"b4w_shadow_settings.b4w_enable_csm"),e.b4w_enable_csm=!1);
"csm_num"in e||(b("world",f,"b4w_shadow_settings.csm_num"),e.csm_num=1);"csm_first_cascade_border"in e||(b("world",f,"b4w_shadow_settings.csm_first_cascade_border"),e.csm_first_cascade_border=10);"first_cascade_blur_radius"in e||(b("world",f,"b4w_shadow_settings.first_cascade_blur_radius"),e.first_cascade_blur_radius=3);"csm_last_cascade_border"in e||(b("world",f,"b4w_shadow_settings.csm_last_cascade_border"),e.csm_last_cascade_border=100);"last_cascade_blur_radius"in e||(b("world",f,"b4w_shadow_settings.last_cascade_blur_radius"),
e.last_cascade_blur_radius=1.5);"fade_last_cascade"in e||(b("world",f,"b4w_shadow_settings.fade_last_cascade"),e.fade_last_cascade=!0);"blend_between_cascades"in e||(b("world",f,"b4w_shadow_settings.blend_between_cascades"),e.blend_between_cascades=!0);e=f.b4w_ssao_settings;"dist_factor"in e||(b("world",f,"b4w_ssao_settings.dist_factor"),e.dist_factor=0,e.samples=16);"hemisphere"in e||(b("world",f,"b4w_ssao_settings.hemisphere"),e.hemisphere=!1);"blur_depth"in e||(b("world",f,"b4w_ssao_settings.blur_depth"),
e.blur_depth=!1);"blur_discard_value"in e||(b("world",f,"b4w_ssao_settings.blur_discard_value"),e.blur_discard_value=1);"b4w_glow_color"in f||(f.b4w_glow_color=[1,1,1],b("object",f,"b4w_glow_color"));"b4w_glow_factor"in f||(f.b4w_glow_factor=1,b("object",f,"b4w_glow_factor"));"b4w_fog_density"in f||(b("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in f?("blur"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.blur"),f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(b("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),f.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in f||(b("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(b("world",f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(l=0;l<d.length;l++)f=d[l],"b4w_use_nla"in f||(f.b4w_use_nla=!1,b("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,b("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",
f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(g("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,b("scene",f,"b4w_enable_antialiasing"));f=a.meshes;for(l=0;l<f.length;l++)for(e=f[l],e.b4w_bounding_box||(b("mesh",e,"b4w_bounding_box"),e.b4w_bounding_box=
{max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),e.uv_textures||(b("mesh",e,"uv_textures"),e.uv_textures=[]),e.b4w_bounding_sphere_center||(e.b4w_bounding_sphere_center=[0,0,0]),e.b4w_bounding_cylinder_center||(e.b4w_bounding_cylinder_center=[0,0,0]),e.b4w_bounding_ellipsoid_center||(e.b4w_bounding_ellipsoid_center=[0,0,0]),e.b4w_bounding_ellipsoid_axes||(d=e.b4w_bounding_box,e.b4w_bounding_ellipsoid_axes=[(d.max_x-d.min_x)/2,(d.max_y-d.min_y)/2,(d.max_z-d.min_z)/2]),d=0;d<e.b4w_vertex_anim.length;d++){var n=
e.b4w_vertex_anim[d];"allow_nla"in n||(b('mesh["b4w_vertex_anim"]',e,"allow_nla"),n.allow_nla=!0)}d=a.cameras;for(l=0;l<d.length;l++)f=d[l],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,g("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,b("camera",f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,b("camera",f,"b4w_rot_velocity")),"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=.1,b("camera",f,"b4w_zoom_velocity")),
"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=-100,b("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in f||(f.b4w_horizontal_translation_max=100,b("camera",f,"b4w_horizontal_translation_max")),
"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,b("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,b("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,b("camera",f,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=
Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in
f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,b("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,b("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||(f.b4w_enable_hover_hor_rotation=!0,b("camera",f,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in f||(f.b4w_use_panning=!0,b("camera",f,"b4w_use_panning"));d=a.lamps;for(l=0;l<d.length;l++)f=
d[l],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));d=a.speakers;for(l=0;l<d.length;l++)f=d[l],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=
!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id="");d=a.textures;for(l=0;l<d.length;l++)f=d[l],"b4w_anisotropic_filtering"in
f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,b("material",f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,b("material",
f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=!1,b("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",
b("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",b("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,b("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,b("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(l=0;l<f.length;l++){e=f[l];"b4w_node_mat_type"in e&&g("material",e);"b4w_skydome"in e&&g("material",e);"b4w_procedural_skydome"in e&&g("material",e);e.b4w_water&&("b4w_water_shore_smoothing"in
e||(e.b4w_water_shore_smoothing=!1,b("material",e,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in e||(e.b4w_water_dynamic=!1,b("material",e,"b4w_water_dynamic")),"b4w_waves_height"in e||(e.b4w_waves_height=1,b("material",e,"b4w_waves_height")),"b4w_waves_length"in e||(e.b4w_waves_length=1,b("material",e,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in e||(e.b4w_water_dst_noise_scale0=.05,b("material",e,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in e||(e.b4w_water_dst_noise_scale1=
.03,b("material",e,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in e||(e.b4w_water_dst_noise_freq0=1.3,b("material",e,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in e||(e.b4w_water_dst_noise_freq1=1,b("material",e,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in e||(e.b4w_water_dir_min_shore_fac=.4,b("material",e,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in e||(e.b4w_water_dir_freq=.5,b("material",e,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in
e||(e.b4w_water_dir_noise_scale=.05,b("material",e,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in e||(e.b4w_water_dir_noise_freq=.07,b("material",e,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in e||(e.b4w_water_dir_min_noise_fac=.5,b("material",e,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in e||(e.b4w_water_dst_min_fac=.2,b("material",e,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in e||(e.b4w_water_waves_hor_fac=5,b("material",e,"b4w_water_waves_hor_fac")),
"b4w_water_absorb_factor"in e||(e.b4w_water_absorb_factor=6,b("material",e,"b4w_water_absorb_factor")),"b4w_water_fog_color"in e||(e.b4w_water_fog_color=new Float32Array(3),e.b4w_water_fog_color=[.5,.7,.7],b("material",e,"b4w_water_fog_color")),"b4w_foam_factor"in e||(e.b4w_foam_factor=5,b("material",e,"b4w_foam_factor")),"b4w_generated_mesh"in e||(e.b4w_generated_mesh=!1,b("material",e,"b4w_generated_mesh")),"b4w_water_num_cascads"in e||(e.b4w_water_num_cascads=5,b("material",e,"b4w_water_num_cascads")),
"b4w_water_subdivs"in e||(e.b4w_water_subdivs=64,b("material",e,"b4w_water_subdivs")),"b4w_water_detailed_dist"in e||(e.b4w_water_detailed_dist=1E3,b("material",e,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in e||(e.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in e||(e.b4w_dynamic_grass_color="");"diffuse_intensity"in e||(e.diffuse_intensity=1,b("material",e,"diffuse_intensity"));"b4w_use_ghost"in e||(e.b4w_use_ghost=!1);"b4w_collision_group"in e||(e.b4w_collision_group=128,b("material",
e,"b4w_collision_group"));"b4w_collision_mask"in e||(e.b4w_collision_mask=127,b("material",e,"b4w_collision_mask"));"HALO"!=e.type||"b4w_halo_sky_stars"in e||(e.b4w_halo_sky_stars=!1,b("material",e,"b4w_halo_sky_stars"));"HALO"!=e.type||"b4w_halo_stars_blend_height"in e||(e.b4w_halo_stars_blend_height=10,b("material",e,"b4w_halo_stars_blend_height"));"HALO"!=e.type||"b4w_halo_stars_min_height"in e||(e.b4w_halo_stars_min_height=0,b("material",e,"b4w_halo_stars_min_height"));"specular_shader"in e||
(e.specular_shader="COOKTORR",b("material",e,"specular_shader"));"diffuse_shader"in e||(e.diffuse_shader="LAMBERT",b("material",e,"diffuse_shader"));"roughness"in e||(e.roughness=.5,b("material",e,"roughness"));"diffuse_fresnel"in e||(e.diffuse_fresnel=.1,b("material",e,"diffuse_fresnel"));"diffuse_fresnel_factor"in e||(e.diffuse_fresnel_factor=.5,b("material",e,"diffuse_fresnel_factor"));"specular_slope"in e||(e.specular_slope=.2,b("material",e,"specular_slope"));"specular_toon_size"in e||(e.specular_toon_size=
.5,b("material",e,"specular_toon_size"));"specular_toon_smooth"in e||(e.specular_toon_smooth=.1,b("material",e,"specular_toon_smooth"));"specular_alpha"in e||(e.specular_alpha=1,b("material",e,"specular_alpha"));"b4w_wettable"in e||(e.b4w_wettable=!1,b("material",e,"b4w_wettable"));"b4w_refractive"in e||(e.b4w_refractive=!1,b("material",e,"b4w_refractive"));"b4w_refr_bump"in e||(e.b4w_refr_bump=0,b("material",e,"b4w_refr_bump"));"b4w_shallow_water_col"in e||(e.b4w_shallow_water_col=[0,.8,.3],b("material",
e,"b4w_shallow_water_col"));"b4w_shore_water_col"in e||(e.b4w_shore_water_col=[0,.9,.2],b("material",e,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in e||(e.b4w_shallow_water_col_fac=1,b("material",e,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in e||(e.b4w_shore_water_col_fac=.5,b("material",e,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in e||(e.b4w_water_sss_strength=5.9,b("material",e,"b4w_water_sss_strength"));"b4w_water_sss_width"in e||(e.b4w_water_sss_width=.45,b("material",
e,"b4w_water_sss_width"));"b4w_render_above_all"in e||(e.b4w_render_above_all=!1,b("material",e,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in e||(e.b4w_water_norm_uv_velocity=.05,b("material",e,"b4w_water_norm_uv_velocity"));n=e.texture_slots;for(d=0;d<n.length;d++){var m=n[d];"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"))}if(e.node_tree)for(e=e.node_tree.nodes,d=0;d<e.length;d++)c(e[d])}f=a.node_groups;for(l=0;l<f.length;l++)for(e=f[l].node_tree.nodes,d=0;d<e.length;d++)c(e[d]);
f=a.objects;for(l=0;l<f.length;l++){e=f[l];switch(e.type){case "MESH":"b4w_dynamic_geometry"in e||(e.b4w_dynamic_geometry=!1);"b4w_reflexible"in e||(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_wind_bending"in e||(e.b4w_wind_bending=!1,b("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=.25,b("object",e,"wind bending params"));"b4w_detail_bending_amp"in e||
(e.b4w_detail_bending_amp=.1,e.b4w_branch_bending_amp=.3,b("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=1,b("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",b("object",e,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||(e.b4w_caustics=
!1);"vertex_groups"in e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,b("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,delete e.b4w_vertex_anim,b("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=
!1);"velocity_min"in e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=1);"collision_mask"in e.game||(e.game.collision_mask=255);"b4w_vehicle_settings"in e?e.b4w_vehicle_settings&&("steering_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_ratio=10),"steering_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_max=1),"inverse_control"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.inverse_control=
!1),"force_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500),"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=100),"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.floating_factor=3),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=.9)):(e.b4w_vehicle_settings=null,b("object",e,"b4w_vehicle_settings"));"b4w_floating_settings"in e?e.b4w_floating_settings&&("floating_factor"in e.b4w_floating_settings||(e.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_rot_damp=.8)):(e.b4w_floating_settings=null,b("object",e,"b4w_floating_settings"));"b4w_character_settings"in e?e.b4w_character_settings&&("walk_speed"in e.b4w_character_settings||(e.b4w_character_settings.walk_speed=4),"run_speed"in e.b4w_character_settings||(e.b4w_character_settings.run_speed=8),"step_height"in e.b4w_character_settings||
(e.b4w_character_settings.step_height=.25),"jump_strength"in e.b4w_character_settings||(e.b4w_character_settings.jump_strength=5),"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0)):(e.b4w_character_settings=null,b("object",e,"b4w_character_settings"));"b4w_selectable"in e||(e.b4w_selectable=!1,b("object",e,"b4w_selectable"));"b4w_billboard"in e||(e.b4w_billboard=!1,b("object",e,"b4w_billboard"));"b4w_billboard_geometry"in e||(e.b4w_billboard_geometry="SPHERICAL",b("object",
e,"b4w_billboard_geometry"));"b4w_glow_settings"in e||(e.b4w_glow_settings={},e.b4w_glow_settings.glow_duration=1,e.b4w_glow_settings.glow_period=1,e.b4w_glow_settings.glow_relapses=0,b("object",e,"b4w_glow_settings"));"b4w_lod_transition"in e||(e.b4w_lod_transition=.01,b("object",e,"b4w_lod_transition"));"lod_levels"in e||(e.lod_levels=[],b("object",e,"lod_levels"));"b4w_animation_mixing"in e||(e.b4w_animation_mixing=!1,b("object",e,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in
e||(e.b4w_group_relative=!1,b("object",e,"b4w_group_relative"))}"b4w_anim_behavior"in e||(e.b4w_anim_behavior=e.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",e,"b4w_anim_behavior"));if(!("rotation_quaternion"in e)){d=[0,0,0,1];k.euler_to_quat(e.rotation_euler,d);var n=d,m=d[0],s=d[1],w=d[2];n[0]=d[3];n[1]=m;n[2]=s;n[3]=w;e.rotation_quaternion=d;b("object",e,"rotation_quaternion")}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&g("object",e);"b4w_shadow_cast_only"in e||
(e.b4w_shadow_cast_only=!1,b("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",b("object",e,"b4w_correct_bounding_offset"));n=e.particle_systems;for(d=0;d<n.length;d++)m=n[d],s=m.settings,"use_whole_group"in s||(s.use_whole_group=!1,b("object",s,"use_whole_group")),m.transforms||(m.transforms=new Float32Array,b("particle_system",m,"transforms")),"b4w_billboard_align"in s||(s.b4w_billboard_align="VIEW",b("particle_settings",s,"b4w_billboard_align")),
"b4w_dynamic_grass"in s||(s.b4w_dynamic_grass=!1,b("object",s,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in s||(s.b4w_dynamic_grass_scale_threshold=.01,b("object",s,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in s||(s.b4w_initial_rand_rotation=!1,b("particle_settings",s,"b4w_initial_rand_rotation")),"b4w_rotation_type"in s||(s.b4w_rotation_type="Z",b("particle_settings",s,"b4w_rotation_type")),"b4w_rand_rotation_strength"in s||(s.b4w_rand_rotation_strength=1,b("particle_settings",
s,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in s||(s.b4w_hair_billboard=!1,b("particle_settings",s,"b4w_hair_billboard")),"b4w_hair_billboard_type"in s||(s.b4w_hair_billboard_type="BASIC",b("particle_settings",s,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in s||(s.b4w_hair_billboard_jitter_amp=0,b("particle_settings",s,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in s||(s.b4w_hair_billboard_jitter_freq=0,b("particle_settings",s,"b4w_hair_billboard_jitter_freq")),
"b4w_hair_billboard_geometry"in s||(s.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",s,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in s||(s.b4w_wind_bend_inheritance="PARENT",b("particle_settings",s,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in s||(s.b4w_shadow_inheritance="PARENT",b("particle_settings",s,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in s||(s.b4w_reflection_inheritance="PARENT",b("particle_settings",s,"b4w_reflection_inheritance")),
"b4w_vcol_from_name"in s||(s.b4w_vcol_from_name="",b("particle_settings",s,"b4w_vcol_from_name")),"b4w_vcol_to_name"in s||(s.b4w_vcol_to_name="",b("particle_settings",s,"b4w_vcol_to_name")),"b4w_coordinate_system"in s||(s.b4w_coordinate_system="LOCAL",b("particle_settings",s,"b4w_coordinate_system")),"b4w_allow_nla"in s||(s.b4w_allow_nla=!0,b("particle_settings",s,"b4w_allow_nla"));"constraints"in e||(e.constraints=[],b("object",e,"constraints"));n=e.modifiers;for(d=0;d<n.length;d++){a:{m=n[d];switch(m.type){case "ARRAY":if(!("fit_type"in
m)){h.error("WARNING Incomplete modifier "+String(m.type)+' for "'+e.name+'", reexport '+(e.library?"library"+e.library.split("/").slice(-1)[0]:"main scene"));m=!1;break a}}m=!0}m||(n.splice(d,1),d--)}"animation_data"in e||(e.animation_data={action:null,nla_tracks:[]},b("object",e,"animation_data"));if(e.animation_data)for(("action"in e.animation_data)||(e.animation_data.action=null,h.warn("B4W Warning: no action in animation data "+e.name)),("nla_tracks"in e.animation_data)||(e.animation_data.nla_tracks=
[],h.warn("B4W Warning: no NLA in animation data "+e.name)),n=e.animation_data.nla_tracks,d=0;d<n.length;d++)for(m=n[d],s=0;s<m.strips.length;s++)w=m.strips[s],"action"in w||(w.action=null,h.warn("B4W Warning: no action in NLA strip "+e.name)),"action_frame_start"in w||(w.action_frame_start=0,h.warn("B4W Warning: no action_frame_start in NLA strip "+e.name)),"action_frame_end"in w||(w.action_frame_end=w.frame_end-w.frame_start,h.warn("B4W Warning: no action_frame_start in NLA strip "+e.name));"b4w_collision_id"in
e||(e.b4w_collision_id="",b("material",e,"b4w_collision_id"));d=e.scale;n=Math.abs((d[1]-d[2])/d[1]);.001>Math.abs((d[0]-d[1])/d[0])&&.001>n||h.warn("B4W Warning: non-uniform scale for object "+e.name)}for(var y in u)l=u[y],d=y.match(/.*?(?=>>|$)/i)[0],h.warn("WARNING "+String(d)+" is "+l.mq+" for "+l.type+", reexport "+a.b4w_filepath_blend)};a.it=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var g=b[c].type;if("ARRAY"==g||"CURVE"==g){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,
a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var g=b,h=e,x=0,u=0,q=0,y=new Float32Array(16),e=[],L=1;L<h.count;L++){h.use_constant_offset&&(x+=h.constant_offset_displace[0],u+=h.constant_offset_displace[1],q+=h.constant_offset_displace[2]);if(h.use_relative_offset)var r=g.b4w_bounding_box,x=x+(r.max_x-r.min_x)*h.relative_offset_displace[0],u=u+(r.max_y-r.min_y)*h.relative_offset_displace[1],q=q+(r.max_z-r.min_z)*h.relative_offset_displace[2];
k.Ay(x,u,q,y);for(var D=r=d(g),G=y,V=0;V<D.submeshes.length;V++){var N=D.submeshes[V];k.ce(N.position,G,N.position,0);k.dz(N.normal,G,N.normal);k.xy(N.tangent,G,N.tangent)}e.push(r)}for(L=0;L<e.length;L++)for(h=g,x=e[L],u=0;u<h.submeshes.length;u++){q=h.submeshes[u];y=x.submeshes[u];r=q.base_length;D=q.indices.length;q.base_length+=y.base_length;for(var Z in q)if("base_length"!=Z)if("indices"==Z)for(q[Z]=k.Dy(q[Z],y[Z]),G=D;G<q.indices.length;G++)q.indices[G]+=r;else q[Z]=k.dv(q[Z],y[Z])}break;case "CURVE":for(var g=
b,L=e.object.Os,h=new Float32Array(16),u=L.Xd?4:3,x=new Float32Array(u),u=new Float32Array(u),q=new Float32Array(3),y=new Float32Array(4),r=new Float32Array(4),D=new Float32Array(3),G=new Float32Array(3),V=new Float32Array(3),N=new Float32Array(4),P=new Float32Array(4),M=0;M<g.submeshes.length;M++){var O=g.submeshes[M],Q=O.position,R=O.normal,O=O.tangent,T;a:switch(T=e.deform_axis,T){case "POS_X":case "NEG_X":T=0;break a;case "POS_Y":case "NEG_Y":T=1;break a;case "POS_Z":case "NEG_Z":T=2;break a;
default:throw"Wrong deform axis value "+T;}D[0]=0;D[1]=0;D[2]=0;D[T]=1;for(var ja=f.hy(L),Y=0;Y<Q.length/3;Y++){V[0]=Q[3*Y];V[1]=Q[3*Y+1];V[2]=Q[3*Y+2];var W=V[T],E=f.gy(L,W);f.iy(L,E,x);q[0]=x[0];q[1]=x[1];q[2]=x[2];f.fy(L,E,u);G[0]=u[0];G[1]=0;G[2]=u[2];l.normalize(G,G);n.rotationTo(D,G,y);0>W?(x[0]=G[0],x[1]=G[1],x[2]=G[2],l.scale(x,W,x),l.add(q,x,q)):W>ja&&(x[0]=G[0],x[1]=G[1],x[2]=G[2],l.scale(x,W-ja,x),l.add(q,x,q));w.fromRotationTranslation(y,q,h);L.Xd&&(n.setAxisAngle(D,x[3],r),l.transformQuat(V,
r,V));V[T]=0;l.transformMat4(V,h,V);Q[3*Y]=V[0];Q[3*Y+1]=V[1];Q[3*Y+2]=V[2];R.length&&(N[0]=R[3*Y],N[1]=R[3*Y+1],N[2]=R[3*Y+2],N[3]=0,s.transformMat4(N,h,N),R[3*Y]=N[0],R[3*Y+1]=N[1],R[3*Y+2]=N[2]);O.length&&(P[0]=O[3*Y],P[1]=O[3*Y+1],P[2]=O[3*Y+2],P[3]=0,s.transformMat4(P,h,P),O[3*Y]=P[0],O[3*Y+1]=P[1],O[3*Y+2]=P[2])}}}m.gx(b)}return b};a.bA=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,
fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,
b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,q){function c(a){a=qa.ra(a);a.Td=null;a.cb=null;a.hc=null;return a}function b(a,b){var c=[];J.oe(a,function(b,d,e){-1<c.indexOf(e)?J.nx(a,b,d,e,m(e)):c.push(e)});J.L(a,function(b,d){for(var e=0;e<d.Z.length;e++){var f=d.Z[e];-1<c.indexOf(f)?d.Z[e]=m(f):c.push(f)}"ANTIALIASING"==d.type&&J.pe(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.Z.length;c++){var d=b.Z[c];d.ca=ba.s;d.ba=ba.s}})});J.L(a,function(c){var e={};g(a,c,e);for(var f in e){c=e[f];if(b)for(var h=
0;h<c.length;h++){var k=c[h];if("DEPTH"==k.G){if(d(k))throw"Failed to use renderbuffer as input texture: "+k.G+"->"+k.V;k.Ig=!0}}k=c[0];for(h=0;h<c.length;h++)if(c[h].ca==ba.s){k=c[h];break}for(var A=c[0],h=0;h<c.length;h++)if(c[h].ba==ba.s){A=c[h];break}for(var r=c[0],h=0;h<c.length;h++)if(!c[h].Ig){r=c[h];break}for(h=0;h<c.length;h++)c[h].ca=k.ca,c[h].ba=A.ba,c[h].Ig=r.Ig}})}function g(a,b,c){J.pe(a,b,function(b,d,e){e.xa&&e.G==e.V&&(c[e.G]=c[e.G]||[],-1==c[e.G].indexOf(e)&&c[e.G].push(e),g(a,b,
c))});J.qe(a,b,function(a,b,d){d.xa&&(c[d.G]=c[d.G]||[],-1==c[d.G].indexOf(d)&&c[d.G].push(d))});b=J.Ea(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.Z.length;d++){var e=b.Z[d];c[e.G].push(e)}}function d(a){switch(a.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function m(a){if(a.na)throw"Failed to clone slink with attached texture";return qa.Ie(a)}function f(a){var b=J.Zq(a),c=[];J.L(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=
[];break;default:e=c}for(var f=0;f<d.Z.length;f++){var g=d.Z[f],h=n(e,g,k(g));g.na=h;d.Rc[f]=h}for(f=0;f<d.Rc.length;f++)h=d.Rc[f],s(e,h);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}J.qe(b,a,function(c,d,f){if((c=l(b,a,f.G))&&f.xa&&!f.na){d=e;for(var g=c,h=0;h<d.length;h++){var A=d[h];A.nm===g&&A.Mh++}}else c=n(e,f,k(f));f.na=c});J.pe(b,a,function(a,b,c){s(e,c.na)});J.qe(b,a,function(a,b,c){c.na&&"NONE"==c.V&&s(e,c.na)})})}function h(a){u(a,
function(b,c,d){b.Fg&&(ka(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ka(a,d,"ANTIALIASING"))&&(b.ke*=Xa.resolution_factor)})}function k(a){a=qa.Ie(a);delete a.V;delete a.xa;return JSON.stringify(a)}function l(a,b,c){var d=null;J.pe(a,b,function(a,b,e){if(e.xa&&e.G==e.V&&e.G==c&&e.na)return d=e.na,!0});J.qe(a,b,function(a,b,e){if(e.xa&&e.G==c&&e.na)return d=e.na,!0});return d}function s(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.nm===b&&d.Mh&&d.Mh--}}function n(a,b,
c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Mh){d=f;break}}if(d)return d.Mh++,d.nm;b=w(b);a.push({id:c,Mh:1,nm:b});return b}function w(a){var b=a.ke*a.size;switch(a.G){case "COLOR":var c=ba.Gi("COLOR",ba.Hf);ba.resize(c,b,b);ba.Aj(c,a.ca,a.ba);return c;case "DEPTH":return a.Ig?(c=ba.Gi("DEPTH_RBUF",ba.Gf),ba.resize(c,b,b)):(c=ba.Gi("DEPTH_TEX",ba.Pg),ba.resize(c,b,b),ba.Aj(c,a.ca,a.ba)),c;case "CUBEMAP":return c=ba.au(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.G;}}function u(a,b){var c=!1;J.oe(a,function(d,e,f){if(f&&(d=J.Ea(a,d),e=J.Ea(a,e),b(f,!1,d,e)))return c=!0});c||J.L(a,function(a,c){for(var d=0;d<c.Z.length;d++)if(b(c.Z[d],!0,c,null))return!0})}function z(a){J.L(a,function(b,c){if("SINK"!=c.type){var d=c.h;J.qe(a,b,function(a,b,c){c.xa&&c.na&&(ha.zj(d,c.G,c.na),c.G==c.V&&b.h&&ha.zj(b.h,c.G,c.na))});for(var e=0;e<c.Z.length;e++){var f=c.Z[e];f.xa&&f.G==f.V&&ha.zj(d,f.G,c.Rc[e])}!d.cb&&!d.hc||d.Td||(d.Td=va.lq(d.cb,d.hc))}})}function F(a,b){var c=
p("SHADOW_CAST");c.Fk=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;c.h=ha.lb(ha.Rg);return c}function p(a){return{type:a,qa:!1,Wp:!1,jk:!1,ij:!1,dh:0,time:0,h:null,Yn:null,hb:null,l:[],Z:[],Rc:[],fi:new Float32Array(3),ur:new Float32Array(3),Ib:new Float32Array(3),Eb:new Float32Array(4),Ec:new Float32Array(16),Rd:0,mf:0,Aq:0,af:null,df:null,$e:null,bf:null,cf:null,ic:new Float32Array(3),nc:new Float32Array(3),Uq:new Float32Array([0,0,0]),Gj:new Float32Array(3),Vq:new Float32Array(4),
qg:null,Qi:0,Ok:0,th:!1,ph:new Float32Array(3),re:0,Ba:null,Sj:!1,he:new Float32Array(2),ie:new Float32Array(2),og:0,fg:0,tk:0,xc:null,te:0,Ef:0,se:0,Ge:!1,yn:0,zn:new Float32Array(2),xn:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,pg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,
ug:0,tg:0,sg:0,Mq:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,eg:0,vj:0,xg:0,Fk:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,jr:null,ln:null,rf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,qn:0,po:0,ej:0,fj:0,Ap:0,Jh:"",ww:new Float32Array(2),R:!0,enqueue:!0,aa:!0,fa:!0,wb:!0,ta:!0}}function B(a,b,c,d,e){return{G:a,V:b,size:c,ke:d,Fg:e,xa:!0,na:null,Ig:!1,ca:ba.oc,ba:ba.oc}}function e(){var a=p("GRASS_MAP");a.h=ha.lb(ha.Qg);return a}
function t(a){var b=p("POSTPROCESSING");b.aa=!1;b.fa=!1;b.wb=!1;b.h=ha.lb(ha.Za);b.Jh=a;return b}function x(a){var b=p("BLOOM_BLUR");b.aa=!1;b.fa=!1;b.wb=!1;b.h=ha.lb(ha.Za);b.Jh=a;return b}function K(a,b,c,d,e,f,g,h,k){var A=p("MAIN_"+a);if("OPAQUE"===a)A.aa=!0,A.fa=c,A.qa=!1;else if("BLEND"===a)A.aa=!1,A.fa=!1,A.qa=!0;else if("XRAY"===a)A.aa=!1,A.fa=!0,A.qa=!0;else if("REFLECT"===a)A.aa=!0,A.fa=!0,A.qa=!1;else throw"wrong main subscene type";A.qa&&h&&(A.self_shadow_normal_offset=h.self_shadow_normal_offset);
A.h=b;A.ic.set(g.ic);A.nc.set(g.nc);A.Rd=g.Rd;A.qg=g.qg;A.Eb=f;d&&(A.Ba=d,d.Eb&&(A.xc=new Float32Array(d.Eb)),A.te=d.waves_height,A.Ef=d.waves_length,A.se=d.se,d.Bi&&k&&(A.Ge=!0,A.yn=d.Bi,A.zn.set(d.vk),A.xn=d.uk),d.Cj&&(A.Sj=!0,a=d.Tx,A.he[0]=(a[0]+a[1])/2,A.he[1]=(a[2]+a[3])/2,A.ie[0]=a[0]-a[1],A.ie[1]=a[2]-a[3],A.og=d.og,A.fg=d.fg));A.af=new Float32Array(3*e);A.df=new Float32Array(3*e);A.$e=new Float32Array(3*e);A.bf=new Float32Array(4*e);A.cf=new Float32Array(4*e);return A}function H(a,b){var c=
p("COLOR_PICKING");b&&(c.type+="_XRAY",c.aa=!1,c.fa=!0);c.enqueue=!1;c.h=a;return c}function y(a){var b=p("WIREFRAME");b.R=!1;b.aa=!1;b.fa=!1;b.h=a;return b}function L(a,b){var c=p("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function r(a){var b=p("DEPTH_PACK");b.aa=!1;b.fa=!1;b.h=a;return b}function D(a,b,c){var d=p("SSAO");d.aa=!1;d.fa=!1;d.wb=!1;d.h=a;d.Eb=b;d.xc=new Float32Array(b);d.ug=c.radius_increase;d.ssao_hemisphere=c.iw;d.tg=c.influence;d.sg=c.dist_factor;
d.Mq=c.sx;return d}function G(a,b){var c=p("SSAO_BLUR");c.aa=!1;c.fa=!1;c.wb=!1;c.ssao_blur_depth=b.vt;c.ssao_blur_discard_value=b.pn;c.h=a;return c}function V(){var a=p("ANTIALIASING");a.aa=!1;a.fa=!1;a.wb=!1;a.h=ha.lb(ha.Za);return a}function N(a){var b=p(a);b.aa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.fa=!1;b.wb=!1;b.h=ha.lb(ha.Za);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.xw=new Float32Array(4));return b}function Z(a,b,c,d){var e=p("COMPOSITING");e.aa=!1;e.fa=!1;
e.wb=!1;e.h=ha.lb(ha.Za);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function P(a,b){var c=p("MOTION_BLUR");c.aa=!1;c.fa=!1;c.wb=!1;c.h=ha.lb(ha.Za);c.jk=!0;c.ej=a;c.fj=b;return c}function M(a){var b=p("DOF");b.aa=!1;b.fa=!1;b.wb=!1;b.h=a;return b}function O(a){var b=p("GLOW_MASK");b.h=a;b.wb=!1;return b}function Q(a){var b=p("GLOW");b.ph.set(a.ph);b.Qi=a.Qi;b.po=5;b.qn=3;b.wb=!1;b.h=ha.lb(ha.Za);return b}function R(){var a=p("REFRACT");a.aa=!1;a.fa=!1;a.wb=!1;a.h=ha.lb(ha.Za);
return a}function T(a,b,c,d,e,f,g){var h=p("GOD_RAYS");h.aa=!1;h.fa=!1;h.wb=!1;h.ic[0]=1;h.ic[1]=1;h.ic[2]=1;h.nc[0]=1;h.nc[1]=1;h.nc[2]=1;h.Rd=1;h.Wp=d;h.re=b;h.vj=e;h.eg=c;h.xg=g;h.h=a;h.mf=f;h.af=new Float32Array(3*f);h.df=new Float32Array(3*f);h.$e=new Float32Array(3*f);h.bf=new Float32Array(4*f);h.cf=new Float32Array(4*f);return h}function ja(a,b){var c=p("GOD_RAYS_COMBINE");c.aa=!1;c.fa=!1;c.wb=!1;c.h=ha.lb(ha.Za);c.god_rays_intensity=a;c.mf=b;c.af=new Float32Array(3*b);c.df=new Float32Array(3*
b);c.$e=new Float32Array(3*b);c.bf=new Float32Array(4*b);c.cf=new Float32Array(4*b);return c}function Y(a,b){var c=p("SKY");c.enqueue=!1;c.aa=!1;c.fa=!1;c.wb=!1;var d=ha.lb(ha.Za);d.width=Da.bh;d.height=Da.bh;c.h=d;c.Yn=qa.nv();c.mf=a;c.af=new Float32Array(3*a);c.df=new Float32Array(3*a);c.$e=new Float32Array(3*a);c.bf=new Float32Array(4*a);c.cf=new Float32Array(4*a);c.ic[0]=1;c.ic[1]=1;c.ic[2]=1;c.nc[0]=1;c.nc[1]=1;c.nc[2]=1;c.Rd=1;c.pg.set(b.pg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=
b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function W(){var a=p("SCREEN");a.aa=!1;a.fa=!1;a.h=ha.lb(ha.Za);return a}function E(){var a=p("ANAGLYPH");
a.aa=!1;a.fa=!1;a.h=ha.lb(ha.Za);return a}function aa(){var a=p("LUMINANCE");a.aa=!1;a.fa=!1;a.h=ha.lb(ha.Za);return a}function ma(){var a=p("AVERAGE_LUMINANCE");a.aa=!1;a.fa=!1;a.h=ha.lb(ha.Za);return a}function v(a,b,c,d){var e=p("LUMINANCE_TRUNCED");e.aa=!1;e.fa=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.h=d;e.af=new Float32Array(3*c);e.df=new Float32Array(3*c);e.$e=new Float32Array(3*c);e.bf=new Float32Array(4*c);e.cf=new Float32Array(4*c);return e}function I(a){var b=p("BLOOM");b.aa=!1;b.fa=!1;b.h=
ha.lb(ha.Za);b.bloom_blur=a;return b}function U(){var a=p("SINK");a.enqueue=!1;return a}function ka(a,b,c){if(b.type===c)return!0;b=A(a,b);for(var d=0;d<b.length;d++)if(ka(a,b[d],c))return!0;return!1}function fa(a,b,c){if(b.type===c)return!0;b=ea(a,b);for(var d=0;d<b.length;d++)if(fa(a,b[d],c))return!0;return!1}function S(a,b,c){if(b.type===c)return b;b=ea(a,b);for(var d=0;d<b.length;d++){var e=S(a,b[d],c);if(e)return e}return null}function ea(a,b){var c=J.Ah(a,b);if(c==J.Mm)throw"Subscene not in graph";
for(var d=[],e=J.ep(a,c),f=0;f<e;f++){var g=J.Ni(a,c,f);g!=c&&d.push(J.Ea(a,g))}return d}function A(a,b){var c=J.Ah(a,b);if(c==J.Mm)throw"Subscene not in graph";for(var d=[],e=J.ig(a,c),f=0;f<e;f++){var g=J.Yf(a,c,f);g!=c&&d.push(J.Ea(a,g))}return d}function da(a){var b=[],c=[];u(a,function(a){a.na&&-1==b.indexOf(a.na)&&(b.push(a.na),c.push(a.na,b.length-1))});return c}function ga(a,b){var c;c=""+(a.G+"\\n");c+="NONE"!=a.V?a.V+"\\n":"";c+="(";if(a.Fg){var d=a.ke;Math.round(d)!=d&&(d=d.toFixed(2));
d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.G){c+=" ";if(a.Ig)c+="RR";else{var d=a.ca,e=a.ba,f="";d==ba.s?f+="L":d==ba.oc&&(f+="N");e==ba.s?f+="L":e==ba.oc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.na&&(c+=" "+b[d+1])}return c+")\\n"}var ha=q("__camera"),la=q("__config"),Qa=q("__debug"),J=q("__graph"),va=q("__renderer"),ba=q("__textures"),qa=q("__util");q("vec4");var Ma=la.eh,Xa=la.n,Da=la.Sh;a.lu=function(a,d){var e=J.create(),g=a.M[0],A=d.rl,k=d.tr,r=d.Eb,v=d.Ba,l=
K("OPAQUE",g,!0,v,A,r,k,null,d.Dd);J.o(e,l);var I=K("BLEND",g,!0,v,A,r,k,null,null);J.o(e,I);J.i(e,l,I,B("SCREEN","NONE",1,1,!0));if(d.mc){var n=K("XRAY",g,!1,v,A,r,k,null,d.Dd);J.o(e,n);J.i(e,I,n,B("SCREEN","NONE",1,1,!0))}k=U();J.o(e,k);Xa.wireframe_debug?(g=y(g),J.o(e,g),d.mc?J.i(e,n,g,B("SCREEN","NONE",1,1,!0)):J.i(e,I,g,B("SCREEN","NONE",1,1,!0)),J.i(e,g,k,B("SCREEN","NONE",1,1,!0))):J.i(e,I,k,B("SCREEN","NONE",1,1,!0));d.zk&&(g=c(l.h),a.M.push(g),I=H(g,!1),J.o(e,I),d.mc?(g=c(l.h),a.M.push(g),
l=H(g,!0),J.o(e,l),J.i(e,I,l,B("COLOR","COLOR",1,1,!0)),J.i(e,l,k,B("COLOR","NONE",1,1,!0)),J.i(e,l,k,B("DEPTH","NONE",1,1,!0))):(J.i(e,I,k,B("COLOR","NONE",1,1,!0)),J.i(e,I,k,B("DEPTH","NONE",1,1,!0))));d.Wh.procedural_skydome&&(A=Y(A,d.Wh),J.o(e,A),J.i(e,A,k,B("CUBEMAP","u_sky",Da.bh,1,!1)));b(e,!0);1<Xa.resolution_factor&&h(e);f(e);z(e);return e};a.Lt=d;a.Cy=u;a.ku=function(a,d,g){var A=J.create(),k=[],l=[],n=[],p=[],m=[],da=[],S=[],s=[],u=[],fa=[],w=[],ga=d.rl,ea=d.Ba,q=d.Tl,ka=d.yf,va=d.$f,la=
d.jg,eb=d.hx,bd=d.Jf,Sc=d.gg,cd=d.Nf,Tc=d.antialiasing,uc=d.tr,pb=d.Eb,$a=d.wc,Ab=d.Hw,dc=d.ut,Mb=d.Dt,Vb=d.cw,Wb=d.$v,lc=d.Rf,wa=[];if(Xa.anaglyph_use&&!a){var Nb=g.M[0],fb=c(Nb);ha.xp(Nb,ha.tb);ha.xp(fb,ha.Bb);wa.push(Nb,fb);g.M.push(fb)}else{var sa=g.M[0];wa.push(sa)}if(q){ha.Nj(wa[0],$a);for(var Bb=$a.csm_num,ca=0;ca<Bb;ca++){var Ta=F(ca,$a);J.o(A,Ta);fa.push(Ta);var gb=$a.csm_resolution,sa=Ta.h;sa.width=gb;sa.height=gb;Ta.aa=!1;w.push(B("DEPTH","u_shadow_map"+ca,gb,1,!1));Qa.Bn()&&Ta.Z.push(B("COLOR",
"COLOR",gb,1,!1))}}if(0<eb.length&&!a)for(ca=0;ca<wa.length;ca++){sa=c(wa[ca]);g.M.push(sa);var oa=K("REFLECT",sa,!1,ea,ga,pb,uc,null,d.Dd);oa.hb=eb[0];oa.h.hb=eb[0];J.o(A,oa);da.push(oa);S.push(B("COLOR","u_reflectmap",1,Xa.Oh,!0));oa.Z.push(B("DEPTH","DEPTH",1,Xa.Oh,!0))}k=[];l=[];if(d.ya){var Ia=e();J.o(A,Ia);gb=Da.Si;Ia.h.width=gb;Ia.h.height=gb;var hb=B("DEPTH","u_grass_map_depth",gb,1,!1);hb.ca=ba.s;hb.ba=ba.s;var ta=B("COLOR","u_grass_map_color",gb,1,!1);ta.ca=ba.s;ta.ba=ba.s}else ta=hb=Ia=
null;for(ca=0;ca<wa.length;ca++){var sa=wa[ca],Ua=c(sa);g.M.push(Ua);if(q){var pa=L(Ua,$a);J.o(A,pa);for(var Ja=0;Ja<fa.length;Ja++){var Ta=fa[Ja],Cb=w[Ja];J.i(A,Ta,pa,Cb)}var ec=B("COLOR","u_color",1,1,!0),Zb=B("DEPTH","u_depth",1,1,!0);if(ka){var $b=c(sa);g.M.push($b);var vb=d.ky,Db=D($b,pb,vb);J.o(A,Db);var mc=B("COLOR","u_ssao_mask",1,1,!0);J.i(A,pa,Db,ec);J.i(A,pa,Db,Zb);var Eb=c(sa);g.M.push(Eb);var wb=G(Eb,vb);J.o(A,wb);var nc=B("COLOR","u_shadow_mask",1,1,!0);J.i(A,Db,wb,mc);J.i(A,pa,wb,Zb)}var Ob=
c(Ua);g.M.push(Ob);var Ka=r(Ob);J.o(A,Ka);J.i(A,pa,Ka,B("DEPTH","u_depth",1,1,!0));n.push(Ka);var ac=B("DEPTH","DEPTH",1,1,!0);m.push(ac)}else pa=L(Ua,$a),J.o(A,pa),ac=B("DEPTH","DEPTH",1,1,!0),m.push(ac),Qa.Bn()&&pa.Z.push(B("COLOR","COLOR",1,1,!0)),Ob=c(Ua),g.M.push(Ob),Ka=r(Ob),J.o(A,Ka),J.i(A,pa,Ka,B("DEPTH","u_depth",1,1,!0)),n.push(Ka);Ia&&(J.i(A,Ia,pa,hb),J.i(A,Ia,pa,ta));oa=K("OPAQUE",sa,!1,ea,ga,pb,uc,null,d.Dd);J.o(A,oa);l.push(oa);J.i(A,pa,oa,m[ca]);mc?J.i(A,wb,oa,nc):J.i(A,pa,oa,B("COLOR",
"u_shadow_mask",1,1,!0));var oc=B("COLOR","u_color",1,1,!0);p.push(B("COLOR","COLOR",1,1,!0));Ia&&(J.i(A,Ia,oa,hb),J.i(A,Ia,oa,ta));da.length&&(J.i(A,da[ca],oa,S[ca]),oa.hb=eb[0])}k=l;l=[];if(!a&&d.zk){sa=c(k[0].h);g.M.push(sa);var Na=H(sa,!1);J.o(A,Na);if(d.mc){sa=c(k[0].h);g.M.push(sa);var qb=H(sa,!0);J.o(A,qb);J.i(A,Na,qb,B("COLOR","COLOR",1,1,!0));J.i(A,Na,qb,B("DEPTH","DEPTH",1,1,!0))}}else Na=null;if(la&&!a)for(ca=0;ca<wa.length;ca++){var Fb=R();J.o(A,Fb);J.i(A,k[ca],Fb,oc);s.push(Fb);u.push(B("COLOR",
"u_refractmap",1,1,!0))}for(var pc=[],ca=0;ca<wa.length;ca++){pa=n[ca];sa=c(wa[ca]);g.M.push(sa);oa=K("BLEND",sa,!1,ea,ga,pb,uc,$a,d.Dd);l.push(oa);J.o(A,oa);J.i(A,k[ca],oa,p[ca]);J.i(A,k[ca],oa,m[ca]);Ia&&(J.i(A,Ia,oa,hb),J.i(A,Ia,oa,ta));for(Ja=0;Ja<fa.length;Ja++)Ta=fa[Ja],Cb=w[Ja],J.i(A,Ta,oa,Cb);if("DEPTH_PACK"==pa.type){var Fa=B("COLOR","u_scene_depth",1,1,!0);Fa.ca=ba.oc;Fa.ba=ba.oc}else Fa=B("DEPTH","u_scene_depth",1,1,!0),Fa.ca=ba.s,Fa.ba=ba.s;J.i(A,pa,oa,Fa);da.length&&(J.i(A,da[ca],oa,
S[ca]),oa.hb=eb[0]);s.length&&J.i(A,s[ca],oa,u[ca]);pc.push(oa)}k=l;l=[];if(d.mc){for(ca=0;ca<wa.length;ca++){pa=n[ca];sa=c(wa[ca]);g.M.push(sa);oa=K("XRAY",sa,!1,ea,ga,pb,uc,$a,d.Dd);l.push(oa);J.o(A,oa);J.i(A,k[ca],oa,p[ca]);J.i(A,k[ca],oa,m[ca]);Ia&&(J.i(A,Ia,oa,hb),J.i(A,Ia,oa,ta));for(Ja=0;Ja<fa.length;Ja++)Ta=fa[Ja],Cb=w[Ja],J.i(A,Ta,oa,Cb);"DEPTH_PACK"==pa.type?(Fa=B("COLOR","u_scene_depth",1,1,!0),Fa.ca=ba.oc,Fa.ba=ba.oc):(Fa=B("DEPTH","u_scene_depth",1,1,!0),Fa.ca=ba.s,Fa.ba=ba.s);J.i(A,
pa,oa,Fa);da.length&&(J.i(A,da[ca],oa,S[ca]),oa.hb=eb[0]);s.length&&J.i(A,s[ca],oa,u[ca])}k=l;l=[]}if(Xa.wireframe_debug){for(ca=0;ca<wa.length;ca++){sa=qa.ra(wa[ca]);g.M.push(sa);var La=y(sa);l.push(La);J.o(A,La);J.i(A,k[ca],La,p[ca]);J.i(A,k[ca],La,m[ca]);Ia&&(J.i(A,Ia,La,hb),J.i(A,Ia,La,ta))}k=l;l=[]}if(va&&!a){for(ca=0;ca<wa.length;ca++){var C=Vb.eg,na=Vb.nw,Ba=Vb.xg,ra=k[ca],Xb=ea?1:0,X=B("DEPTH","u_input",1,1,!0);X.ca=ba.s;X.ba=ba.s;var lb=B("COLOR","u_input",1,.25,!0);lb.ca=ba.s;lb.ba=ba.s;
var mb=C/Ba,Pb=c(wa[ca]);g.M.push(Pb);var rb=T(Pb,Xb,C,!0,mb,ga,Ba);J.o(A,rb);J.i(A,ra,rb,X);var mb=C/Ba*.5,Qb=c(wa[ca]);g.M.push(Qb);var xb=T(Qb,Xb,C,!1,mb,ga,Ba);J.o(A,xb);J.i(A,rb,xb,lb);var mb=C/Ba*.25,Gb=c(wa[ca]);g.M.push(Gb);var Rb=T(Gb,Xb,C,!1,mb,ga,Ba);J.o(A,Rb);J.i(A,xb,Rb,lb);da.length&&(rb.hb=eb[0],xb.hb=eb[0],Rb.hb=eb[0]);var Aa=ja(na,ga);l.push(Aa);J.o(A,Aa);J.i(A,ra,Aa,B("COLOR","u_main",1,1,!0));J.i(A,Rb,Aa,B("COLOR","u_god_rays",1,1,!0))}k=l;l=[]}if(bd&&!a){for(ca=0;ca<wa.length;ca++){var ra=
k[ca],Ga=aa();J.o(A,Ga);J.i(A,ra,Ga,B("COLOR","u_input",1,1,!0));var Ec=ma();J.o(A,Ec);Ec.h.width=1;Ec.h.height=1;var Hb=B("COLOR","u_input",1,.25,!0);Hb.ca=ba.s;Hb.ba=ba.s;var vc=B("COLOR","u_luminance",1,.25,!0);vc.ca=ba.s;vc.ba=ba.s;J.i(A,Ga,Ec,Hb);var Fc=dc.key,jd=dc.Ou,Ib=c(wa[ca]);g.M.push(Ib);var fc=v(Fc,jd,ga,Ib);J.o(A,fc);J.i(A,ra,fc,B("COLOR","u_main",1,1,!0));J.i(A,Ga,fc,vc);J.i(A,Ec,fc,B("COLOR","u_average_lum",1,1,!1));var Sb=B("COLOR","u_color",1,.25,!0);Sb.ca=ba.s;Sb.ba=ba.s;var Jb=
x("X_BLUR");J.o(A,Jb);J.i(A,fc,Jb,Sb);var sb=x("Y_BLUR");J.o(A,sb);J.i(A,Jb,sb,Sb);var gc=I(dc.blur);J.o(A,gc);var wc=B("COLOR","u_bloom",1,.25,!0);wc.ca=ba.s;wc.ba=ba.s;J.i(A,sb,gc,wc);J.i(A,ra,gc,B("COLOR","u_main",1,1,!0));l.push(gc)}k=l;l=[]}if(Sc&&!a){for(ca=0;ca<k.length;ca++){var xc=k[ca],yb=P(Ab.ej,Ab.fj);l.push(yb);J.o(A,yb);J.i(A,xc,yb,B("COLOR","u_mb_tex_curr",1,1,!0));yb.Z.push(B("COLOR","u_mb_tex_accum",1,1,!0))}k=l;l=[]}if(lc&&!a){for(ca=0;ca<k.length;ca++){var ra=k[ca],Kb=c(wa[ca]);
g.M.push(Kb);Sb=B("COLOR","u_color",1,1,!0);Sb.ca=ba.s;Sb.ba=ba.s;var Lb=t("X_BLUR");J.o(A,Lb);J.i(A,ra,Lb,Sb);var ib=t("Y_BLUR");J.o(A,ib);J.i(A,Lb,ib,Sb);var pa=pc[ca],Tb=M(Kb);Kb.dof_distance=g.dof_distance;Kb.Me=g.Me;Kb.dof_front=g.dof_front;Kb.dof_rear=g.dof_rear;Kb.dof_power=g.dof_power;Kb.dof_on=1;l.push(Tb);J.o(A,Tb);J.i(A,ra,Tb,B("COLOR","u_sharp",1,1,!0));J.i(A,ib,Tb,B("COLOR","u_blurred",1,1,!0));J.i(A,pa,Tb,B("DEPTH","u_depth",1,1,!0))}k=l;l=[]}if(!a&&d.glow){for(ca=0;ca<wa.length;ca++){var ra=
k[ca],yc=c(wa[ca]);g.M.push(yc);var jb=O(yc);J.o(A,jb);var zc=t("X_EXTEND"),Uc=B("COLOR","u_color",1,1,!0),ld=B("COLOR","u_glow_mask",1,1,!0);zc.th=!0;J.o(A,zc);J.i(A,jb,zc,Uc);var hc=B("COLOR","u_color",1,.5,!0);hc.ca=ba.s;hc.ba=ba.s;var qc=t("Y_EXTEND");qc.th=!0;J.o(A,qc);J.i(A,zc,qc,hc);Lb=t("X_BLUR");Lb.th=!0;J.o(A,Lb);J.i(A,qc,Lb,hc);var Gc=B("COLOR","u_color",1,.25,!0);Gc.ca=ba.s;Gc.ba=ba.s;var tb=B("COLOR","u_glow_mask_blurred",1,.25,!0);tb.ca=ba.s;tb.ba=ba.s;ib=t("Y_BLUR");ib.th=!0;J.o(A,
ib);J.i(A,Lb,ib,Gc);var Ac=Q(Wb);J.o(A,Ac);J.i(A,ra,Ac,B("COLOR","u_glow_src",1,1,!0));J.i(A,jb,Ac,ld);J.i(A,ib,Ac,tb);l.push(Ac)}k=l;l=[]}if(cd&&!a){for(ca=0;ca<k.length;ca++){var ra=k[ca],Vc=Z(Mb.brightness,Mb.contrast,Mb.exposure,Mb.saturation);J.o(A,Vc);J.i(A,ra,Vc,B("COLOR","u_color",1,1,!0));l.push(Vc)}k=l;l=[]}if(Tc&&!a){for(ca=0;ca<k.length;ca++)if(ra=k[ca],Xa.smaa){var rc=B("COLOR","u_color",1,1,!0);rc.ca=ba.s;rc.ba=ba.s;var Hc=N("SMAA_EDGE_DETECTION");J.o(A,Hc);J.i(A,ra,Hc,rc);var Oa=N("SMAA_BLENDING_WEIGHT_CALCULATION");
J.o(A,Oa);J.i(A,Hc,Oa,rc);var sc=B("COLOR","u_search_tex",1,1,!1),Ic=B("COLOR","u_area_tex",1,1,!1);sc.ca=ba.s;sc.ba=ba.s;Ic.ca=ba.s;Ic.ba=ba.s;Oa.Z.push(sc);Oa.Z.push(Ic);var tc=N("SMAA_NEIGHBORHOOD_BLENDING");J.o(A,tc);J.i(A,ra,tc,rc);var Wc=B("COLOR","u_blend",1,1,!0);Wc.ca=ba.s;Wc.ba=ba.s;J.i(A,Oa,tc,Wc);l.push(tc)}else{var Bc=V();J.o(A,Bc);var Jc=B("COLOR","u_color",1,1,!0);Jc.ca=ba.s;Jc.ba=ba.s;J.i(A,ra,Bc,Jc);if(1<Xa.resolution_factor){var Xc=t("NONE");J.o(A,Xc);J.i(A,Bc,Xc,Jc);l.push(Xc)}else l.push(Bc)}k=
l;l=[]}if(Xa.anaglyph_use&&!a){var Kc=E();J.o(A,Kc);J.i(A,k[0],Kc,B("COLOR","u_sampler_left",1,1,!0));J.i(A,k[1],Kc,B("COLOR","u_sampler_right",1,1,!0));l.push(Kc)}else l.push(k[0]);var kd=J.Ah(A,k[0]),Yc=!1;J.pe(A,kd,function(a,b,c){if(c.G==c.V)return Yc=!0});if(Yc||a){var bc=W();J.o(A,bc);J.i(A,k[0],bc,B("COLOR","u_color",1,1,!0));k=l;l=[];l.push(bc)}Na&&(qb?l.push(qb):l.push(Na));if(!a&&d.Wh.procedural_skydome){var jc=Y(ga,d.Wh);J.o(A,jc);l.push(jc)}var Ub=U();J.o(A,Ub);if(Ma.enabled){var Lc=t("NONE");
J.o(A,Lc)}for(ca=0;ca<l.length;ca++)switch(l[ca].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":J.i(A,l[ca],Ub,B("COLOR","NONE",1,1,!0));J.i(A,l[ca],Ub,B("DEPTH","NONE",1,1,!0));break;case "SKY":J.i(A,jc,Ub,B("CUBEMAP","u_sky",Da.bh,1,!1));break;default:J.i(A,l[ca],Ma.enabled?Lc:Ub,B("SCREEN","NONE",1,1,!0))}if(Ma.enabled){var Cc=null,Zc=0;J.L(A,function(a,b){if(b.type==Ma.ty){if(Zc==Ma.sy)return Cc=b,!0;Zc++}});if(Cc){var ed=J.Ah(A,Cc);J.oe(A,function(a,b,c){if(a==ed)return J.i(A,Cc,Lc,B(Ma.Vx,
"u_color",c.size,c.ke,c.Fg)),J.i(A,Lc,Ub,B("SCREEN","NONE",.5,.5,!0)),!0})}}for(var Mc=J.Po(A),ca=0;ca<Mc.length;ca++)for(var $c=Mc[ca],Ja=0;Ja<n.length;Ja++)pa=n[Ja],J.Ea(A,$c)==pa&&J.lg(A,$c);b(A,!1);1<Xa.resolution_factor&&h(A);f(A);z(A);return A};a.QA=p;a.nA=function(a){var b=null;J.L(a,function(a,c){return c.h&&null===c.h.Td?(b=c,!0):!1});return b};a.eb=function(a,b,c){a=ea(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.JA=ka;a.hw=fa;a.cv=S;a.Jo=ea;a.DA=A;a.Ma=function(a,
b){var c=null;J.L(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Au=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=da(a);J.L(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.Jh.replace(/_/g," ")+")");if(d.h){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.cb&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.hc&&
(f+="D"+c[g+1])}d.Z.length&&(f+="\\n-----\\n");for(g=0;g<d.Z.length;g++)f+=ga(d.Z[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});J.oe(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ga(e,c)+'" style="'+(e.xa?"solid":"dotted")+'"];\n'});return b+="}"};a.Wn=function(a){a=J.zy(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,q){function c(){return{name:"",type:0,source:"",width:0,height:0,Bk:1,ni:!0,em:1024,ko:!1,dd:null,wa:null,Tj:!1,bg:!1,O:0,Ta:0,Xk:0,Xy:!1,ai:!1,Bp:0,Pe:0,Ab:0,Ha:null,Ng:null}}function b(b,d,f){var h=b.type,k=new Uint8Array([204,204,204,255]),r=c();switch(h){case "DATA_TEX2D":case "IMAGE":var m=e.createTexture(),s=e.TEXTURE_2D;e.bindTexture(s,m);e.texImage2D(s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,k);b.image&&"MOVIE"==b.image.source&&(r.bg=!0,r.O=b.frame_start,r.Ta=
b.frame_offset,r.Xk=b.frame_duration,r.Xy=b.use_auto_refresh,r.ai=b.use_cyclic,r.Bp=b.movie_length,0!=r.Ta&&l.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":m=e.createTexture();s=e.TEXTURE_2D;e.bindTexture(s,m);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=w.keysearch("name",b.b4w_source_id,f)))r.kj=f,r.em=b.b4w_source_size,f.bk=!0,e.texImage2D(s,0,e.RGBA,1,1,
0,e.RGBA,e.UNSIGNED_BYTE,k);else return null;break;case "ENVIRONMENT_MAP":m=e.createTexture();s=e.TEXTURE_CUBE_MAP;e.bindTexture(s,m);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var q=0;6>q;q++)e.texImage2D(e["TEXTURE_CUBE_MAP_"+f[q]],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,k);break;case "VORONOI":case "BLEND":return null;default:return l.error('B4W warning: texture "'+b.name+'" has unsupported type "'+h+'"'),null}("NONE"!=h||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=h?e.texParameteri(s,e.TEXTURE_MIN_FILTER,t[u.Hj]):e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.LINEAR);k=s;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=d);"OFF"!==f&&u.oi&&(d=n.zv())&&(f=parseFloat(f.split("x")[0]),e.texParameterf(k,d.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):
(e.texParameteri(s,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(s,e.TEXTURE_WRAP_T,e.REPEAT));r.type=a.Hf;r.width=1;r.height=1;r.Ha=m;r.Ab=s;"CANVAS"==b.b4w_source_type&&"NONE"==h?(h=b.b4w_source_id,m=b.b4w_source_size,r.ko=b.b4w_enable_canvas_mipmapping,r.name=h,r.source="CANVAS",s=document.createElement("canvas"),s.setAttribute("id",h),s.width=m,s.height=m,r.dd=s.getContext("2d"),p[h]=r,g(r)):(r.name=b.name,r.source=h,e.generateMipmap(s),e.bindTexture(s,null));return b.d=r}function g(a){if("CANVAS"!=
a.source)throw"Wrong texture";var b=a.Ab;e.bindTexture(b,a.Ha);var c=f(a),d=h(a),g=a.dd.canvas;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0);e.texImage2D(b,0,c,c,d,g);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);a.ko&&e.generateMipmap(b);e.bindTexture(b,null);a.width=g.width;a.height=g.height}function d(a){e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.LINEAR)}function m(a,
b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function f(b){switch(b.type){case a.Hf:b=e.RGBA;break;case a.Zj:b=e.RGB;break;case a.ji:b=e.RGBA;break;case a.ki:b=e.RGB;break;case a.Pg:b=e.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function h(b){switch(b.type){case a.Hf:b=e.UNSIGNED_BYTE;break;case a.Zj:b=e.UNSIGNED_BYTE;break;case a.ji:b=e.FLOAT;break;case a.ki:b=e.FLOAT;break;case a.Pg:b=e.UNSIGNED_INT;break;default:throw"Wrong texture type";
}return b}var k=q("__config"),l=q("__print"),s=q("__dds"),n=q("__extensions"),w=q("__util"),u=k.n,z=k.Jd,F=k.Ad;a.oc=0;a.s=0;a.Fs=0;a.Ds=0;a.Es=0;a.Cs=0;a.Hf=10;a.Zj=20;a.ji=30;a.ki=40;a.Pg=50;a.Gf=60;var p={},B={},e=null,t;a.Xb=function(b){t=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.oc=b.NEAREST;a.s=b.LINEAR;a.Fs=b.NEAREST_MIPMAP_NEAREST;a.Ds=b.LINEAR_MIPMAP_NEAREST;a.Es=b.NEAREST_MIPMAP_LINEAR;a.Cs=b.LINEAR_MIPMAP_LINEAR;e=b};a.Dv=function(a){return a in
p?p[a].dd:null};a.Jy=function(a){return a in p?(g(p[a]),!0):!1};a.Gi=function(b,d){var f=c();f.name=b;f.type=d;f.source="NONE";if(d==a.Gf)f.Ng=e.createRenderbuffer();else{var g=e.TEXTURE_2D,h=e.createTexture();e.bindTexture(g,h);e.texParameteri(g,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(g,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(g,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(g,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(g,null);f.Ab=g;f.Ha=h}return f};a.au=function(b){var d=e.createTexture(),
f=e.TEXTURE_CUBE_MAP;e.bindTexture(f,d);e.texParameteri(f,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(f,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(f,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(f,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);for(var g="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)e.texImage2D(e[g[h]],0,e.RGBA,b,b,0,e.RGBA,e.UNSIGNED_BYTE,
null);e.bindTexture(f,null);f=c();f.name="CUBEMAP";f.type=a.Hf;f.source="NONE";f.width=3*b;f.height=2*b;f.Bk=1;f.Ha=d;f.Ab=e.TEXTURE_CUBE_MAP;return f};a.Aj=function(b,c,d){if(b.type!=a.Gf){var f=b.Ab;e.bindTexture(f,b.Ha);c&&e.texParameteri(f,e.TEXTURE_MIN_FILTER,c);d&&e.texParameteri(f,e.TEXTURE_MAG_FILTER,d);e.bindTexture(f,null)}};a.BA=function(b){if(b.type==a.Gf)return{min:a.oc,Bw:a.oc};var c=b.Ab;e.bindTexture(c,b.Ha);b=e.getTexParameter(c,e.TEXTURE_MIN_FILTER);var d=e.getTexParameter(c,e.TEXTURE_MAG_FILTER);
e.bindTexture(c,null);return{min:b,Bw:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Gf)e.bindRenderbuffer(e.RENDERBUFFER,b.Ng),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,c,d),e.bindRenderbuffer(e.RENDERBUFFER,null);else{var g=b.Ab;e.bindTexture(g,b.Ha);var k=f(b),r=h(b);e.texImage2D(g,0,k,c,d,0,k,r,null);e.bindTexture(g,null)}c>u.kf||d>u.kf?l.error("B4W warning: texture has unsupported size",filepath):(b.width=c,b.height=d)}};a.uu=
b;a.Vy=function(a){var b=a.Ab;e.bindTexture(b,a.Ha);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0);4!=a.wa.length?e.texImage2D(b,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.wa):e.texImage2D(b,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a.wa);e.bindTexture(b,null)};a.Pj=function(a,b,c,f){var g=a.source,h=a.Ab;e.bindTexture(h,a.Ha);if(4==b.length){var k=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(k)e.texImage2D(h,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=s.Ro(b);
if(c.width>u.kf||c.height>u.kf){l.error("B4W warning: texture has unsupported size",f);return}s.Wy(e,n.No(),b,!0);m(c.width,c.height)&&(a.kn||l.warn("B4W warning: using NPOT texture",f),d(h));a.width=c.width;a.height=c.height;a.Bk=s.Gv(b)}else{e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>u.kf||b.height>u.kf){l.error("B4W warning: texture has unsupported size",f);return}a.bg?(a.wa=b,a.wa.loop=a.ai,b&&(B[a.name]=a),a.Pe=z.ua,b.duration&&(a.Pe=a.Bp/b.duration),F.ho||(b.playbackRate=z.ua/a.Pe,F.Fn&&
2<b.playbackRate&&(b.playbackRate=2))):e.texImage2D(h,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,b);a.width=b.width;a.height=b.height;m(b.width,b.height)?(a.kn||(a.bg?l.warn("B4W warning: using NPOT video texture",f):l.warn("B4W warning: using NPOT texture",f)),d(h)):a.bg||e.generateMipmap(h)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],k){for(k=0;6>k;k++)g=c[k],e.texImage2D(e["TEXTURE_CUBE_MAP_"+g[0]],0,
e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1);var p=b.width/3;if(p>u.zl||p>u.zl){l.error("B4W warning: cubemap has unsupported size",f);return}for(k=0;6>k;k++){var g=c[k],t=document.createElement("canvas");t.width=p;t.height=p;var w=t.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(w.translate(0,p),w.scale(1,-1)):(w.translate(p,0),w.scale(-1,1));w.drawImage(b,g[1]*p,g[2]*p,p,p,0,0,p,p);e.texImage2D(e["TEXTURE_CUBE_MAP_"+g[0]],0,e.RGBA,
e.RGBA,e.UNSIGNED_BYTE,t)}a.width=3*p;a.height=2*p;m(b.width/3,b.height/2)?(l.warn("B4W warning: using NPOT cube map texture",f),d(h)):e.generateMipmap(h)}else"DATA_TEX2D"==g&&(e.texImage2D(h,0,e.RGBA,b.width,b.height,0,e.RGBA,e.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);e.bindTexture(h,null)};a.Iu=function(a){e.deleteTexture(a)};a.vh=function(a){return a&&a.name&&(a.Ha||a.Ng)?!0:!1};a.lp=function(a){return a&&a.name&&a.Ng?!0:!1};a.WA=function(b){return b.type==a.ji||b.type==a.ki?!0:
!1};a.Uv=function(b){var c=0;switch(b.type){case a.Hf:case a.Zj:c=4;break;case a.ji:case a.ki:c=16;break;case a.Pg:c=3;break;case a.Gf:c=2}return c};a.uv=function(a){var c=null,c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a);c.image={filepath:null};return c};a.cleanup=function(){p={};B={}};a.play_video=function(a){return a in B?(B[a].wa.play(),!0):null};a.reset_video=function(a){return a in B?(a=B[a],a.wa.currentTime=a.Ta/a.Pe,!0):null};
a.stop_video=function(a){return a in B?(B[a].wa.pause(),!0):null};a.pause=function(){for(var a in B)B[a].wa.paused||(B[a].wa.pause(),B[a].Tj=!0)};a.reset=function(){for(var a in B)B[a].currentTime=B[a].Ta/B[a].Pe,B[a].Tj=!1};a.play=function(a){for(var b in B)if(!a||B[b].Tj)B[b].wa.play(),B[b].Tj=!1}};b4w.module.__assets=function(a,q){function c(){return w.ml()?q(w.yb.xi).data:null}function b(){var a={li:null,Ns:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.li=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.li in b&&(a.status=200,b[a.li]&&(a.response=a.Ns(b[a.li])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function g(b){for(var c=0,e=0;e<b.length;e++){var g=b[e];20===g.state&&c++;if(c>=B.Fw)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:d(g,"arraybuffer");break;case a.AT_JSON:d(g,"json");break;case a.AT_TEXT:d(g,"text");break;case a.AT_AUDIOBUFFER:m(g);break;case a.AT_IMAGE_ELEMENT:f(g);
break;case a.AT_AUDIO_ELEMENT:h(g);break;case a.Xj:k(g);break;default:throw"Wrong asset type: "+g.type;}}}function d(a,d){var e=c(),f=e&&a.q in e?new b:new XMLHttpRequest;f.open("GET",a.q,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&"string"==typeof b)try{b=
JSON.parse(b)}catch(c){a.ub(null,a.uri,a.type,a.q);u.error(c+" (parsing JSON "+a.q+")");return}a.ub(b,a.uri,a.type,a.q)}else a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: empty responce when trying to get "+a.q)}else a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: "+f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.bx(b.loaded/b.total)},!1);f.send(null)}function m(a){var d=c(),e=d&&a.q in d?new b:new XMLHttpRequest;e.open("GET",a.q,
!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?z.Eu(b,function(b){a.ub(b,a.uri,a.type,a.q);a.state=30},function(){a.ub(null,a.uri,a.type,a.q);u.error("B4W Error: failed to decode "+a.q);a.state=30}):(a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: empty responce when trying to get "+a.q),a.state=30)}else a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: "+e.status+" when trying to get "+a.q),a.state=
30};e.send(null)}function f(a){var b=document.createElement("img");e.Ug&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: could not load image: "+a.q),a.state=30)},!1);var d=c();if(d&&a.q in d)if(d[a.q]){var f=l(a.q);b.src="data:"+f+";base64,"+d[a.q]}else d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.q}function h(a){var b=document.createElement("audio");
e.Ug&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: could not load sound: "+a.q),a.state=30)},!1);var d=c();if(d&&a.q in d)if(d[a.q]){var f=s(a.q);b.src="data:"+f+";base64,"+d[a.q];40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)}else d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.q,e.Ze&&b.load();setTimeout(function(){b.Yx=
1},5E3)}function k(a){var b=document.createElement("video");b.muted=!0;if(e.Ug||e.Ze)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),u.error("B4W Error: could not load video: "+a.q),a.state=30)},!1);var d=c();if(d&&a.q in d)if(d[a.q]){var f=n(a.q);b.src="data:"+f+";base64,"+d[a.q];40!=a.state&&(a.ub(b,a.uri,a.type,a.q),a.state=30)}else d=new CustomEvent("error"),
b.dispatchEvent(d);else b.src=a.q,e.Ze&&b.load();setTimeout(function(){b.Yx=1},1E4)}function l(a){var b="image";switch(F.cl(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function s(a){var b="audio";switch(F.cl(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function n(a){var b="video";switch(F.cl(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+=
"/webm";break;case "m4v":b+="/mp4"}return b}var w=q("__config"),u=q("__print"),z=q("__sfx"),F=q("__util"),p=q("__version"),B=w.ad,e=w.n;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Xj=70;var t=[],x=0,K={};a.Ej=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Tv=function(a){if(K[a])return K[a];var b=B.dq?a+p.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");
c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return K[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<t.length;a++)t[a].state=40;t=[];x=0;K={}};a.enqueue=function(a,b,d,e){for(var f=0;f<a.length;f++){var h=a[f],h={uri:h[0],type:h[1],q:h[2],name:h[3],state:10,ub:b||function(){},Xp:d||function(){},bx:e||function(){},Yp:x};if(B.dq){var k=c();k&&h.q in k||(h.q+=p.timestamp())}t.push(h)}g(t);
x++};a.update=function(){g(t);for(var a=t,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.Yp===a[b].Yp?30!==e.state&&(c=!1):(c&&(a[d-1].Xp(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].Xp(),a.splice(b))}}};b4w.module.__loader=function(a,q){function c(c,d,e,f,g){var h=F,k=w.create(),l;for(l in d){var m=b(d[l]);(f&&m.Ua||!c&&m.qb)&&n(m);w.o(k,m)}for(l in d)for(m=d[l],m.name=l,c=0;c<m.B.length;c++)w.i(k,d[m.B[c]],m,null);d=b({name:"out",Ga:a.zr,Ja:function(a,b,c,d,e){0===b.id&&(h.eq=!0);3!=b.status&&(b.status=2);g(b.id);e(b,c);u.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")}});var r=[];if(e)for(e=w.Po(k),c=0;c<e.length;c++)r.push(w.Ea(k,e[c]));else w.L(k,function(a,b){b.Sa||r.push(b)});w.o(k,
d);for(c=0;c<r.length;c++)d.B.push(r[c].name),w.i(k,r[c],d,null);return k}function b(a){a.Sa=a.Sa||!1;a.Ga||0===a.Ga||(a.Ga=a.zc);a.B=a.B||[];a.sh=a.sh||!1;a.am=a.am||!1;a.ib=a.ib||0;a.Ua=a.Ua||!1;a.qb=a.qb||!1;a.status=0;a.fB=0;a.tl=0;a.He=a.He||null;return a}function g(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var g=b[f];w.Ea(a.Oc,g).sh&&(w.qe(a.Oc,g,function(d){var f=!0;w.pe(a.Oc,d,function(a,b){if(!b.sh)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=d.length-
1;0<=f;f--)b.splice(d[f],1);return c}function d(a){function b(c,d){var e=w.Ea(a.Oc,c),f=w.Ea(a.Oc,d),g=f.Ga-e.Ga;0==g&&(g=e.Sa-f.Sa);return g}var c=[],d=a.Cd,f=!1;do{var h=g(a,d);c.push.apply(c,d);0<h.length&&(f=!0);d=h}while(0<h.length);f&&c.sort(b);a.Cd=c;return a.Cd.length}function m(a,b,c){if(b.am)return b.sh=!0,h(a,b),!1;if(!b.Ja&&!b.Kf&&!b.Yg)return h(a,b),!1;if(0==b.status&&(b.status++,b.Ja))return b.Ja(c,a,b,b.He,h,k),!0;if(1==b.status){if(b.Kf)return b.Kf(c,a,b,b.He,h,k),!0;b.status++}return 2==
b.status&&(b.status++,b.Yg)?(b.Yg(c,a,b,b.He,h,k),!0):!1}function f(a){if(0==a.Fj)return 100;var b=0;w.L(a.Oc,function(c,d){a.do_not_load_resources&&d.Ua||(b+=d.tl*d.ib)});return z.trunc(100*b/a.Fj)}function h(a,b){b.sh=!0;b.status=3;l(a,b,1)}function k(a,b,c){1>c?l(a,b,c):b.status++}function l(a,b,c){var d=F;if(b.Ja||b.Kf||b.Yg)if(b.tl=c,b=f(a),a.$n!=b||1==c)a.hm(b,performance.now()-a.Yq),a.$n=b,d.xl=!0}function s(a,b){var c=null;w.L(a.Oc,function(a,d){if(d.name==b)return c=d,1});return c}function n(a){a.am=
!0;a.tl=1}var w=q("__graph"),u=q("__print"),z=q("__util");a.zc=0;a.ve=1;a.zr=2;var F=null;a.Oo=function(){return F};a.mu=function(){var a={Sc:[],Jk:0,dk:0,eq:!1,xl:!1};return F=a};a.vu=function(a,b,d,f,g,h,k,l){var n=F,r={id:n.Sc.length,status:0,q:b,nn:"",vp:l||!1,HB:h,Yq:0,$n:0,Fj:0,Ul:!1,hm:f||function(){},Pn:g||function(){},Oc:null,Cd:null,jl:!1,il:!1,ll:!1};a=c(0===r.id,a,h,k,d||function(){});r.Oc=a;b=[];d=w.Rv(a);for(f=0;f<d.length;f++)b.push(d[f]);r.Cd=b;w.L(a,function(a,b){!(b.Ja||b.Kf||b.Yg)||
r.do_not_load_resources&&b.Ua||(r.Fj+=b.ib)});n.Sc.push(r);n.dk++;return r.id};a.Ry=function(b){var c=F;if(c&&0!=F.dk)if(c.xl)c.xl=!1;else{var e=performance.now();do{var f=c.Sc[c.Jk],g=b[f.id];if(3!=f.status)if(0==f.status&&(f.status=1,f.Yq=performance.now(),f.hm(0,0)),d(f)){var h=f,k=h.Cd.length;do{var l=w.Ea(h.Oc,h.Cd[0]),n=m(h,l,g);l.Ga==a.ve&&(h.Ul=!0);l=h.Cd.shift();h.Cd.push(l);k--}while(!n&&0!=k)}else f.Pn(g,f),f.status=3,c.dk--,h=f,h.hm=null,h.Pn=null,h.Oc=null,h.Cd=null;c.eq&&(c.Jk=(c.Jk+
1)%c.Sc.length);if(f.Ul){f.Ul=!1;break}}while(16>performance.now()-e)}};a.yB=k;a.bm=function(a,b){var c=s(a,b);null!==c&&n(c)};a.yy=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=F;if(!b)return!1;a|=0;return b.Sc[a]&&(3==b.Sc[a].status||2==b.Sc[a].status)};a.cleanup=function(){F=null}};b4w.module.__nla=function(a,q){function c(){return{type:"CLIP",O:0,X:0,zd:!1,paused:!1,Id:"",fc:0,Wm:0,Rs:0,oo:0,no:0,stop_video:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.wf,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",O:f.frame_range[0],X:f.frame_range[1],Wd:!1});break;case "SELECT":case "SELECT_PLAY":var g=z.Oi(z.Yj,f.object,0),h=z.Qv(a),k=h.indexOf(g);if(-1==k){u.error("NLA script error: non-selectable object");return}for(var f={type:f.type,Dq:"SELECT"==
f.type?f.target_slot:e+1,Wx:e+1,fe:-1,zx:h.length,yx:k,O:f.frame_range[0],X:f.frame_range[1],Wd:!1},k=[],l=0;l<h.length;l++)k.push(n.create_selection_sensor(h[l],!0));n.create_sensor_manifold(g,"NLA_SELECT_"+e,n.CT_SHOT,k,n.Fu,function(a,c,d,e){if(!(b.Hb>=b.wf.length)&&(d=b.wf[b.Hb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Wd)){for(d=0;d<e.zx;d++)if(n.get_sensor_value(a,c,d)&&d==e.yx){e.fe=1;return}e.fe=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",cm:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
cm:f.target_slot,Qt:f.condition,Ph:f.register1,Qh:f.register2,Hl:f.number1,Il:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",ix:f.registerd,Rw:f.number1});break;case "MATH":d.push({type:"MATH",Tw:f.operation,Ph:f.register1,Qh:f.register2,Hl:f.number1,Il:f.number2,xj:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function g(a,b,c,e){if(a.wf.length){if(a.Hb>=a.wf.length)if(a.cyclic)a.Hb=0;else{a.Ta-=B.ua*c;return}var f=m(a,b,e,!1),h=a.wf[a.Hb];switch(h.type){case "PLAY":h.Wd?f>=
h.X&&(h.Wd=!1,a.Hb++,g(a,b,c,e)):(a.Ta+=h.O-f,h.Wd=!0,d(a,h));break;case "SELECT":case "SELECT_PLAY":-1<h.fe?"SELECT"==h.type||"SELECT_PLAY"==h.type&&0==h.fe?(a.Hb=h.fe?h.Dq:h.Wx,h.fe=-1,g(a,b,c,e)):h.Wd?f>=h.X&&(h.Wd=!1,a.Hb=h.Dq,h.fe=-1,g(a,b,c,e)):(a.Ta+=h.O-f,h.Wd=!0,d(a,h)):a.Ta-=B.ua*c;break;case "JUMP":a.Hb=h.cm;g(a,b,c,e);break;case "CONDJUMP":var f=-1==h.Ph?h.Hl:a.xd[h.Ph],k=-1==h.Qh?h.Il:a.xd[h.Qh],l=!1;switch(h.Qt){case "EQUAL":f==k&&(l=!0);break;case "NOTEQUAL":f!=k&&(l=!0);break;case "LESS":f<
k&&(l=!0);break;case "GREATER":f>k&&(l=!0);break;case "LEQUAL":f<=k&&(l=!0);break;case "GEQUAL":f>=k&&(l=!0)}l?a.Hb=h.cm:a.Hb++;g(a,b,c,e);break;case "REGSTORE":a.xd[h.ix]=h.Rw;a.Hb++;g(a,b,c,e);break;case "MATH":f=-1==h.Ph?h.Hl:a.xd[h.Ph];k=-1==h.Qh?h.Il:a.xd[h.Qh];switch(h.Tw){case "ADD":a.xd[h.xj]=f+k;break;case "MUL":a.xd[h.xj]=f*k;break;case "SUB":a.xd[h.xj]=f-k;break;case "DIV":0==k&&p.da("Division by zero in NLA script"),a.xd[h.xj]=f/k}a.Hb++;g(a,b,c,e);break;case "NOOP":a.Hb++,g(a,b,c,e)}}}
function d(a,b){for(var c=a.wf,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.fe=-1)}}function m(a,b,c,d){b=(b-c)*B.ua+a.Ta-a.O;a.cyclic&&d&&(b%=a.X-a.O+1);return b+=a.O}function f(a,b){b?a.wa.pause():(a.wa.currentTime=a.Ta/B.ua,a.wa.play())}function h(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],k=c();k.type=h.type;k.O=h.frame_start;k.X=h.frame_end;k.Id=h.action?h.action.name:"";k.fc=b;k.Wm=h.action_frame_start;k.Rs=h.action_frame_end;d.push(k)}}return d}
function k(a){return F.Yd(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var l=q("__animation"),s=q("__camera"),n=q("__controls"),w=q("__config");q("__loader");q("__particles");var u=q("__print"),z=q("__scenes"),F=q("__sfx"),p=q("__util"),B=w.Jd,e=[],t=-1;a.Qy=function(a,d){var f={O:a.frame_start,X:a.frame_end,Ta:0,wh:-1,cyclic:d,vd:[],D:[],wf:[],Hb:0,xd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,f);for(var g=z.la(a,"ALL",z.DATA_ID_ALL),n=0;n<g.length;n++){var r=g[n],
m=0,t=[],w=r.animation_data;if(w&&w.nla_tracks.length&&(w=w.nla_tracks,p.Ye(r)||s.is_camera(r)||p.sc(r)||p.qw(r)||F.Yd(r))){var q=h(w,m);q.length&&(t=t.concat(q),m++)}k(r)&&(w=r.data.animation_data.nla_tracks,q=h(w,m),q.length&&(t=t.concat(q),m++));if(l.hl(r))for(var B=r.data.materials,P=0;P<B.length;P++)if(q=B[P].node_tree,w=q.animation_data,q&&w){for(var w=w.nla_tracks,q=h(w,-1),M=[],O=0;O<q.length;O++)w=q[O],-1==M.indexOf(w.Id)&&M.push(w.Id),w.fc=m+M.indexOf(w.Id),t.push(w);m+=M.length}for(P=0;P<
r.particle_systems.length;P++)B=r.particle_systems[P],w=B.settings,"EMITTER"==w.type&&w.b4w_allow_nla&&(w=c(),w.type="CLIP",w.O=f.O,w.X=f.X+1,w.Id=B.name,w.fc=m,t.push(w),m++);B=m+1;if(p.sc(r)&&r.data)for(P=0;P<r.data.b4w_vertex_anim.length;P++)q=r.data.b4w_vertex_anim[P],q.allow_nla&&(m=B,w=c(),w.type="CLIP",w.O=f.O,w.X=f.X+1,w.Id=q.name,w.fc=m,t.push(w));t.length&&(r.ak=t,f.vd.push(r))}g=a.d.Kg;for(P=0;P<g.length;P++)w=c(),n=g[P].d,w.type="VIDEO",w.O=Math.min(n.O,f.X),w.X=n.ai?f.X:Math.min(n.Xk+
n.O+n.Ta,f.X),w.Id=g[P].name,n.Ms=w,f.D.push(n);P=f.O;g=f.X;for(n=0;n<f.vd.length;n++)for(r=f.vd[n],m=r.ak,t=0;t<m.length;t++)w=m[t],B=r.name+" ["+w.O+":"+w.X+"]",w.O=Math.max(P,w.O),w.X=Math.min(g+1,w.X),w.O>w.X&&(u.warn("NLA: out of scene range: "+B),m.splice(t,1),t--);for(P=0;P<f.vd.length;P++)for(g=f.vd[P].ak,n=0;n<g.length;n++){r=g[n];m=f.O;t=f.X+1;for(w=0;w<g.length;w++)B=g[w],r.fc==B.fc&&(B.X<=r.O&&(m=r.O),B.O>=r.X&&(t=Math.min(t,B.O)));r.oo=m;r.no=t}e.push(f)};a.start=function(){t=0};a.update=
function(a,b){if(!(0>t)){0==t&&(t=a);for(var c=0;c<e.length;c++){var d=e[c];g(d,a,b,t);for(var h=m(d,a,t,!0),k=0;k<d.vd.length;k++){for(var n=d.vd[k],p=n.ak,s=0;s<p.length;s++){var u=p[s];"SOUND"==u.type&&h<d.wh-1E-6&&(u.zd=!1)}for(s=0;s<p.length;s++)switch(u=p[s],u.type){case "CLIP":if(u.oo<=h&&h<u.no&&!u.zd){var w=n,q=u;l.apply(w,q.Id,q.fc);l.set_behavior(w,l.AB_FINISH_STOP,q.fc);for(w=0;w<p.length;w++)p[w]!=u&&p[w].fc==u.fc&&(p[w].zd=!1);u.zd=!0}u.zd&&(w=n,l.set_current_frame_float(w,h-u.O+u.Wm,
u.fc),l.update_object_animation(w,0,u.fc));break;case "SOUND":(h<d.wh-1E-6||d.wh<u.O)&&u.O<=h&&h<u.X&&!u.zd&&(F.play(n,(u.O-h)/B.ua,(u.X-u.O)/B.ua),u.zd=!0),d.wh<u.X&&u.X<=h&&u.zd&&(u.zd=!1)}}for(k=0;k<d.D.length;k++)u=d.D[k].Ms,u.O<=Math.round(h)&&Math.round(h)<u.X&&!u.stop_video&&(f(d.D[k],u.stop_video),u.stop_video=!0),u.X<=Math.round(h)&&u.stop_video&&(f(d.D[k],u.stop_video),u.stop_video=!1);d.wh=h}}};a.cleanup=function(){e.length=0;t=-1};a.ap=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||
k(a)||l.hl(a)?!0:!1}};b4w.module.__camera=function(a,q){function c(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",ke:1,width:0,height:0,Td:null,cb:null,hc:null,jb:0,od:0,Fa:0,La:0,left:0,right:0,top:0,bottom:0,Sd:new Float32Array(3),uo:new Float32Array(3),quat:new Float32Array(4),ea:new Float32Array(16),Oz:new Float32Array(16),ia:new Float32Array(16),
Lg:new Float32Array(16),ax:new Float32Array(16),Mc:new Float32Array(16),zq:new Float32Array(16),Df:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,dof_on:0,Yk:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Fa:new Float32Array([0,0,0,0]),La:new Float32Array([0,0,0,0])},Xh:0,Pc:0,hb:null,ah:null,Gk:null,Xn:new Float32Array(4),sj:new Float32Array(4)};if(b==a.Za)return c;switch(b){case a.pc:m(c,
40,.1,1E3);break;case a.If:m(c,2.5,.1,1E3);break;case a.we:break;case a.Qg:break;case a.Rg:break;case a.tb:case a.Bb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function g(b,c,d){if(b.type!=a.tb&&b.type!=a.Bb)throw"set_stereo_params(): wrong camera type";b.Xh=c;b.Pc=d;z(b,b.jb);if(r.W())for(c=r.get_active(),b=c.d.wc,c=c.camera.d.M,d=0;d<c.length;d++)t(c[d],b)}function d(a,b){var c=a.d,d=D.quat_to_dir(c.quat,D.AXIS_MY,O),e=Math.asin(d[1]/
G.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?D.quat_to_dir(c.quat,D.AXIS_MZ,Q):D.quat_to_dir(c.quat,D.AXIS_Z,Q)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function m(b,c,d,e,f){switch(b.type){case a.pc:case a.tb:case a.Bb:b.od=c;b.jb=1;break;case a.If:b.top=c;b.jb=1;break;case a.we:delete b.od;b.od=c;b.jb=f/c;break;case a.Qg:b.top=c;b.jb=f/c;break;default:L.error("set_frustum(): Unsupported camera type: "+b.type)}b.Fa=
d;b.La=e}function f(b,c){var d=c.d.e,e=c.d.quat,f=W;P.rotateX(c.d.H,-Math.PI/2,f);P.invert(f,b.ea);if(b.hb){var f=b.hb[0],g=b.hb[1],h=b.hb[2],k=b.hb[3],l=W;l[0]=1-2*f*f;l[1]=-2*f*g;l[2]=-2*f*h;l[3]=0;l[4]=-2*f*g;l[5]=1-2*g*g;l[6]=-2*g*h;l[7]=0;l[8]=-2*f*h;l[9]=-2*g*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*f*k;l[13]=-2*g*k;l[14]=-2*h*k;l[15]=1;P.multiply(b.ea,l,b.ea);z(b,b.jb,!0);f=T;g=W;P.invert(b.ea,g);P.transpose(g,g);V.transformMat4(b.hb,g,f);g=ja;g[0]=(D.sign(f[0])+b.ia[8])/b.ia[0];g[1]=(D.sign(f[1])+
b.ia[9])/b.ia[5];g[2]=-1;g[3]=(1+b.ia[10])/b.ia[14];V.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.ia[2]=f[0];b.ia[6]=f[1];b.ia[10]=f[2]+1;b.ia[14]=f[3]}b.type==a.tb?b.ea[12]+=b.Pc/2:b.type==a.Bb&&(b.ea[12]-=b.Pc/2);P.multiply(b.ia,b.ea,b.Df);p(b);F(b);G.copy(b.Sd,b.uo);G.copy(d,b.Sd);N.copy(e,b.quat)}function h(b,c,d,e){P.lookAt(c,d,e,b.ea);b.type==a.tb?b.ea[12]+=b.Pc/2:b.type==a.Bb&&(b.ea[12]-=b.Pc/2);P.multiply(b.ia,b.ea,b.Df);p(b);F(b);G.copy(c,b.Sd)}function k(b){b=b.d;if(b.pb){var c=
O;b.T==a.MS_TARGET_CONTROLS?G.subtract(b.e,b.Wa,c):D.quat_to_dir(b.quat,D.AXIS_MY,c);c[1]=0;G.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.T==a.MS_EYE_CONTROLS&&(d*=-1);b.pb.left+=d;b.pb.right+=d}}function l(b){b=b.d;if(b.Aa){var c=O;b.T==a.MS_TARGET_CONTROLS?G.subtract(b.e,b.Wa,c):D.quat_to_dir(b.quat,D.AXIS_MY,c);G.normalize(c,c);c=Math.asin(c[1]);b.Aa.Qa+=c;b.Aa.Ka+=c}}function s(a){a=a.d;if(a.pb)if(a.Aa){var b=D.ze(a.Aa.Qa+Math.PI/2),c=D.ze(a.Aa.Ka+Math.PI/2);if(c>Math.PI)a.Aa=
{Ka:-Math.PI/2,Qa:Math.PI/2};else if(b>Math.PI||b<c)a.Aa.Qa=Math.PI/2}else a.Aa={Ka:-Math.PI/2,Qa:Math.PI/2}}function n(a){a=D.quat_to_dir(a.d.quat,D.AXIS_MY,O);G.normalize(a,a);return-Math.asin(a[1])}function w(a,b,c){if(b==c)return c-a;a=D.ze(a);b=D.ze(b);c=D.ze(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=D.ze(c+b);a=D.ze(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function u(a,b,c){a=a.d;var d=G.subtract(a.Wa,a.e,O);b=N.setAxisAngle(b,c,R);G.transformQuat(d,
b,d);G.subtract(a.Wa,d,a.e);N.multiply(b,a.quat,a.quat)}function z(b,c,d){switch(b.type){case a.pc:if(!c)throw"No aspect ratio";b.jb=c;case a.we:P.perspective(D.dx(b.od),b.jb,b.Fa,b.La,b.ia);break;case a.If:if(!c)throw"No aspect ratio";b.jb=c;case a.Qg:c=b.top*b.jb;P.ortho(-c,c,-b.top,b.top,b.Fa,b.La,b.ia);break;case a.Rg:P.ortho(b.left,b.right,b.bottom,b.top,b.Fa,b.La,b.ia);break;case a.tb:case a.Bb:if(!c)throw"No aspect ratio";b.jb=c;var e=Math.tan(b.od*Math.PI/360);c=b.Fa*e;var f=b.jb*b.Xh*e;b.type==
a.tb?(e=f-b.Pc/2,f+=b.Pc/2):(e=f+b.Pc/2,f-=b.Pc/2);e=-(b.Fa/b.Xh*e);f*=b.Fa/b.Xh;P.frustum(e,f,-c,c,b.Fa,b.La,b.ia);b.left=e;b.right=f;break;case a.Za:return;default:throw"Wrong camera type: "+b.type;}d||(P.multiply(b.ia,b.ea,b.Df),p(b),F(b))}function F(a){P.copy(a.ea,a.Mc);a.Mc[12]=0;a.Mc[13]=0;a.Mc[14]=0;a.Mc[15]=1;P.multiply(a.ia,a.Mc,a.Mc);P.invert(a.Mc,a.Mc)}function p(a){P.copy(a.ea,a.Lg);P.multiply(a.ia,a.Lg,a.Lg);P.invert(a.Lg,a.Lg)}function B(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=
b.Fa);d||(d=b.La);var g,h,k,l,A,n,m,r;switch(b.type){case a.Za:throw"Extraction from NONE camera is not possible";case a.pc:case a.we:g=c*Math.tan(b.od*Math.PI/360);l=-g;h=g*b.jb;k=-h;A=d/c*g;r=-A;n=A*b.jb;m=-n;break;case a.If:case a.Qg:k=b.top*b.jb;g=A=b.top;h=n=k;l=r=-b.top;k=m=-k;break;case a.Rg:g=A=b.top;h=n=b.right;l=r=b.bottom;k=m=b.left;break;case a.tb:case a.Bb:A=c/b.Fa;g=c*Math.tan(b.od*Math.PI/360);l=-g;h=b.right*A;k=b.left*A;m=d/c;A=g*m;r=-A;n=h*m;m*=k;break;default:throw"Wrong camera type: "+
b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=h;e[4]=l;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=k;e[10]=g;e[11]=-c;e[12]=m;e[13]=r;e[14]=-d;e[15]=m;e[16]=A;e[17]=-d;e[18]=n;e[19]=A;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=W,P.invert(b.ea,c),D.ce(e,c,e,0));return e}function e(a){return"CAMERA"===a.type?!0:!1}function t(a,b){if(b.b4w_enable_csm){var c=b.csm_num;if(!a.ah){var d=b.csm_num;a.ah=Array(d);for(var e=0;e<d;e++)a.ah[e]=new Float32Array(3);a.Gk=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Fa:x(b,a,d-1),
f=x(b,a,d),e=B(a,e,f,E),e=H.Mv(e);a.ah[d].set(e.t);a.Gk[d]=e.ma;a.Xn[d]=G.length(e.t);a.sj[d]=K(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.sj[0]=b.first_cascade_blur_radius}function x(a,b,c){var d=a.csm_num,e=D.clamp(a.csm_first_cascade_border,b.Fa,b.La);a=D.clamp(a.csm_last_cascade_border,b.Fa,b.La);return D.clamp(K(e,a,d,c),b.Fa,b.La)}function K(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var H=q("__boundings");q("__config");
var y=q("__constraints"),L=q("__print"),r=q("__scenes"),D=q("__util"),G=q("vec3"),V=q("vec4"),N=q("quat"),Z=q("mat3"),P=q("mat4");a.Za=10;a.pc=20;a.If=30;a.we=40;a.Qg=50;a.Rg=60;a.tb=70;a.Bb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var M=new Float32Array(2),O=new Float32Array(3),Q=new Float32Array(3),R=new Float32Array(4);new Float32Array(4);var T=new Float32Array(4),ja=new Float32Array(4),Y=new Float32Array(16),W=new Float32Array(16),E=new Float32Array(24);
a.Ct=function(d){var e=d.d,f=d.data;switch(f.type){case "PERSP":var g=b(a.pc);if(f.angle_y)var h=f.angle_y/Math.PI*180;m(g,h,f.clip_start,f.clip_end);break;case "ORTHO":g=b(a.If),m(g,f.ortho_scale/2,f.clip_start,f.clip_end)}g.name=d.name;e.cr=!1;e.T=c(f.b4w_move_style);e.dof_distance=d.data.dof_distance;e.Me=d.data.dof_object;e.dof_front=d.data.b4w_dof_front;e.dof_rear=d.data.b4w_dof_rear;e.dof_power=d.data.b4w_dof_power;e.lo=d.data.b4w_enable_hover_hor_rotation;e.M=[g];if(e.T==a.MS_TARGET_CONTROLS||
e.T==a.MS_EYE_CONTROLS||e.T==a.MS_HOVER_CONTROLS)e.xm=d.data.b4w_trans_velocity,e.wm=d.data.b4w_rot_velocity,e.ym=d.data.b4w_zoom_velocity;e.T==a.MS_TARGET_CONTROLS&&e.Wa.set(f.b4w_target);e=d.d;if(e.T===a.MS_TARGET_CONTROLS||e.T===a.MS_EYE_CONTROLS||e.T===a.MS_HOVER_CONTROLS)f=d.data,e.T===a.MS_TARGET_CONTROLS||e.T===a.MS_EYE_CONTROLS?(f.b4w_use_horizontal_clamping&&(e.pb={left:f.b4w_rotation_left_limit,right:f.b4w_rotation_right_limit}),f.b4w_use_vertical_clamping&&(e.Aa={Ka:f.b4w_rotation_down_limit,
Qa:f.b4w_rotation_up_limit}),"LOCAL"==f.b4w_horizontal_clamping_type&&k(d),"LOCAL"==f.b4w_vertical_clamping_type&&l(d),s(d),f.b4w_use_panning&&(e.ir=f.b4w_use_panning)):e.T===a.MS_HOVER_CONTROLS&&(f.b4w_use_horizontal_clamping&&f.b4w_horizontal_translation_min<=f.b4w_horizontal_translation_max&&(e.pb={left:f.b4w_horizontal_translation_min,right:f.b4w_horizontal_translation_max}),f.b4w_use_vertical_clamping&&f.b4w_vertical_translation_min<=f.b4w_vertical_translation_max&&(e.Aa={Ka:-f.b4w_vertical_translation_max,
Qa:-f.b4w_vertical_translation_min}),f.b4w_use_distance_limits&&f.b4w_hover_angle_min<=f.b4w_hover_angle_max&&(e.Oa={Ka:f.b4w_hover_angle_min,Qa:f.b4w_hover_angle_max})),e.zb=f.b4w_use_distance_limits&&f.b4w_distance_min<=f.b4w_distance_max,e.zb&&(e.Fc=f.b4w_distance_min,e.Pf=f.b4w_distance_max);e=d.d;if(e.T===a.MS_HOVER_CONTROLS&&e.zb)if(e.Oa){if(f=n(d),g=D.quat_to_dir(e.quat,D.AXIS_Z,O),d=0,0<g[1]&&(d-=Math.asin(g[1]/G.len(g))),f>e.Oa.Qa?d+=f-e.Oa.Qa:f<e.Oa.Ka&&(d+=e.Oa.Ka-f),(d||0>f)&&L.warn("B4W Warning: Active hover camera has wrong orientation"),
d&&(f=D.quat_to_dir(e.quat,D.AXIS_X,Q),d=N.setAxisAngle(f,-d,R),N.normalize(d,d),N.multiply(d,e.quat,e.quat)),d=D.quat_to_dir(e.quat,D.AXIS_MY,O),f=T,f.set(D.AXIS_Y),f[3]=0,d=D.line_plane_intersect(f,0,e.e,d,e.Ud),!d||100<G.len(d))e.Ud[0]=e.e[0],e.Ud[1]=0,e.Ud[2]=e.e[2]}else e.zb=!1};a.lb=b;a.Qz=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.cb);case "DEPTH":return Boolean(a.hc);case "SCREEN":return!Boolean(a.cb)&&!Boolean(a.hc);default:throw"Wrong attachment type: "+b;}};a.zj=
function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.cb=c;break;case "DEPTH":a.hc=c;break;case "SCREEN":a.cb=null;a.hc=null;break;default:throw"Wrong attachment type: "+b;}};a.zA=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.cb;case "DEPTH":return a.hc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.xp=function(b,c){if(b.type!=a.pc||c!=a.tb&&c!=a.Bb)throw"make_stereo(): wrong camera type";b.type=c;g(b,6,.065)};a.Kx=g;a.pq=function(a,b){var c=a.d.quat,d=R,
e=O;e[0]=0;e[1]=1;e[2]=0;N.setAxisAngle(e,b,d);N.multiply(d,c,c)};a.rB=function(a,b){var c=a.d.quat,d=R,e=O;e[0]=1;e[1]=0;e[2]=0;N.setAxisAngle(e,b,d);N.multiply(d,c,c)};a.qB=function(a,b){var c=a.d.quat;N.invert(c,c);var d=R,e=O;e[0]=0;e[1]=0;e[2]=1;N.setAxisAngle(e,-b,d);N.multiply(d,c,c);N.invert(c,c)};a.Vl=function(a,b){var c=a.d.quat;N.invert(c,c);var d=R,e=O;e[0]=1;e[1]=0;e[2]=0;N.setAxisAngle(e,-b,d);N.multiply(d,c,c);N.invert(c,c)};a.get_angles=d;a.tq=m;a.Fx=function(b,c,d,e,f,g,h){switch(b.type){case a.Rg:b.left=
c;b.right=d;b.bottom=e;b.top=f;b.Fa=g;b.La=h;break;default:L.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.T};a.tB=f;a.uB=h;a.wq=function(a,b,c){var d=O;d[0]=0;d[1]=-1;d[2]=0;G.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=Q;e[0]=0;e[1]=0;e[2]=-1;G.transformQuat(e,c,e);h(a,b,d,e)};a.sB=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e.set(b);a.quat.set(c)};a.Zu=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];
d[2]=a[2];P.lookAt(a,b,c,W);P.invert(W,W);P.rotateX(W,Math.PI/2,W);Z.fromMat4(W,Y);N.fromMat3(Y,e)};a.dr=function(a){var b=a.d.M;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];f(e,a);D.qo(e.Df,e.Yk);if(e.Me)if(e.dof_on){var g=G.dist(c.e,e.Me.location);e.dof_distance=g}else e.dof_distance=0}};a.Iy=function(b){var c=b.d;if(c.T==a.MS_TARGET_CONTROLS)if(c.zb){if(y.rx(c.e,c.quat,c.Wa,c.Fc,y.wr)){var d=G.subtract(c.e,c.Wa,O);G.scale(d,-c.Fc/G.length(d),d);G.add(c.Wa,d,c.e)}}else y.qx(c.e,
c.quat,c.Wa);c.T!=a.MS_TARGET_CONTROLS&&c.T!=a.MS_EYE_CONTROLS||y.correct_up(b,D.AXIS_Y)};a.jw=k;a.ez=l;a.zm=s;a.Mt=function(b){var c=b.d;if(c.T===a.MS_TARGET_CONTROLS||c.T===a.MS_EYE_CONTROLS){if(c.pb){var e=c.pb.left,f=c.pb.right,g=d(b,M),g=g[0],g=c.T==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=w(g,e,f))c.T==a.MS_TARGET_CONTROLS?u(b,D.AXIS_Y,g):(g=N.setAxisAngle(D.AXIS_MY,g,R),N.multiply(g,b.d.quat,b.d.quat))}c.Aa&&(e=c.Aa.Ka,f=c.Aa.Qa,g=d(b,M),g=g[1],c.T==a.MS_TARGET_CONTROLS&&(g*=-1),g=0<D.quat_to_dir(c.quat,
D.AXIS_Z,O)[1]?D.sign(g)*Math.PI-g:g,g=w(g,e,f))&&(c.T==a.MS_TARGET_CONTROLS?(e=D.quat_to_dir(b.d.quat,D.AXIS_MX,Q),u(b,e,g)):(e=g,g=b.d,f=D.quat_to_dir(g.quat,D.AXIS_X,O),e=N.setAxisAngle(f,e,R),N.multiply(e,g.quat,g.quat)));c.T===a.MS_TARGET_CONTROLS&&c.zb&&(g=b.d,e=G.subtract(g.e,g.Wa,O),f=G.length(e),f>g.Pf?(G.scale(e,g.Pf/f,e),G.add(g.Wa,e,g.e)):f<g.Fc&&(f=D.quat_to_dir(g.quat,D.AXIS_MY,Q),G.scale(f,100*g.Fc,f),G.add(e,f,e),G.scale(e,-g.Fc/G.length(e),e),G.add(g.Wa,e,g.e)))}c.T===a.MS_HOVER_CONTROLS&&
(c=b.d,g=c.zb?c.Ud:c.e,c.pb&&(g[0]=D.clamp(g[0],c.pb.left,c.pb.right)),c.Aa&&(g[2]=D.clamp(g[2],c.Aa.Ka,c.Aa.Qa)),c=b.d,c.zb&&(e=D.quat_to_dir(c.quat,D.AXIS_Z,O),g=0,0<e[1]&&(g=Math.asin(e[1]/G.len(e))),e=G.negate(d(b,M),M),e[1]<c.Oa.Ka?g+=e[1]-c.Oa.Ka:e[1]>c.Oa.Qa&&(g+=e[1]-c.Oa.Qa),g&&(e=D.quat_to_dir(c.quat,D.AXIS_X,Q),G.normalize(e,e),g=N.setAxisAngle(e,g,R),N.normalize(g,g),N.multiply(g,c.quat,c.quat)),g=O,b=b.d,b.zb?(e=D.quat_to_dir(b.quat,D.AXIS_MY,O),G.normalize(e,e),b.Oa.Qa-b.Oa.Ka?(f=(-Math.asin(e[1])-
b.Oa.Ka)/(b.Oa.Qa-b.Oa.Ka),f=Math.max(f,0)):f=0,b=G.scale(e,-(f*(b.Pf-b.Fc)+b.Fc),g)):b=null,G.add(c.Ud,b,c.e)))};a.Io=n;a.XA=function(b){switch(b.type){case a.pc:case a.If:case a.tb:case a.Bb:return!0;default:return!1}};a.xv=function(b){b=b.d.M[0];switch(b.type){case a.pc:case a.we:case a.tb:case a.Bb:return Math.PI*b.od/180;default:return L.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.mg=z;a.zt=F;a.At=p;a.Wu=B;a.nt=function(a){a=a.d;var b=H.Xc();b.min_x=-1;b.max_x=1;b.min_y=-1;
b.max_y=1;b.min_z=-1;b.max_z=1;a.Db=b;var c=H.Ek(1,[0,0,0]);a.rc=c;a.lk=H.Sn(1,b);a.nk=H.Un(1,b);a.mk=H.Tn(1,b)};a.is_camera=e;a.Jb=function(b){return e(b)&&b.d&&b.d.T==a.MS_TARGET_CONTROLS?!0:!1};a.Fb=function(b){return e(b)&&b.d&&b.d.T==a.MS_HOVER_CONTROLS?!0:!1};a.rh=function(b){return e(b)&&b.d&&b.d.T==a.MS_EYE_CONTROLS?!0:!1};a.Nj=t;a.yu=x};b4w.module.__lights=function(a,q){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Lf:new Float32Array(3),Lq:0,Kq:0,tv:!1,jo:!1,Hg:!0,Jg:!0,Tf:1,distance:25,$u:"INVERSE_SQUARE"}}function b(a){a.Lf[0]=a.color[0]*a.Tf;a.Lf[1]=a.color[1]*a.Tf;a.Lf[2]=a.color[2]*a.Tf}var g=q("__util"),d=q("vec3");a.PA=c;a.yw=function(a){var f=a.data,h=c(f.type);h.name=a.name;h.Hg=f.use_diffuse;h.Jg=f.use_specular;var k=g.quat_to_dir(a.d.quat,g.AXIS_Y,[]);d.normalize(k,
k);h.direction[0]=k[0];h.direction[1]=k[1];h.direction[2]=k[2];h.color[0]=f.color[0];h.color[1]=f.color[1];h.color[2]=f.color[2];h.Tf=f.energy;b(h);h.distance=f.distance;if("POINT"===h.type||"SPOT"===h.type)h.$u=f.falloff_type;"SPOT"===h.type&&(h.Lq=f.spot_size,h.Kq=f.spot_blend);h.tv=f.b4w_generate_shadows;h.jo=f.b4w_dynamic_intensity;a.Ca=h};a.Hx=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.uq=function(a,c){a.Tf=c;b(a)};a.Ny=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var b=a.Ca;b&&g.quat_to_dir(a.d.quat,g.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,q){function c(){if(!xa)throw"no active scene";return xa}function b(){return xa?!0:!1}function g(a,b,c,d){d|=0;for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.jd==d){e=g;break}}return e}function d(a,b){b||(b="ALL");var c=[];m(a.objects,b,c);return c}function m(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&m(e.objects,b,c)}}function f(b){if("NONE"==qa.ge||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==y(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=y(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function h(a,b,c){c=U.Ah(a,b);U.pe(a,c,function(a,c,d){if(d.xa){switch(d.G){case "COLOR":case "CUBEMAP":a=c.h.cb;break;case "DEPTH":a=c.h.hc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";
c=b.l;for(var e=0;e<c.length;e++){var f=c[e].k;la.Cn(f.Yb,d.V)&&W.pi(f,a,d.V)}}}});for(a=0;a<b.Z.length;a++){var d=b.Z[a],e=b.Rc[a];switch(d.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.l,g=0;g<f.length;g++)c=f[g].k,la.Cn(c.Yb,d.V)&&W.pi(c,e,d.V)}}}function k(a,b,c,d,e){for(var f=b.d,g=b.P,k=0;k<g.length;k++){var m=g[k];if(!(m.Ob||m.Mb||"MAIN"!=m.type&&"NODES"!=m.type&&"PARTICLES"!=m.type||z(a,m))){if("OPAQUE"===d){if(m.qa)continue;var I=ga.Ma(c,
"SHADOW_CAST")&&m.rb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!m.qa)continue;if("XRAY"==d!=m.mc)continue;if(ga.Ma(c,"SHADOW_CAST")&&m.rb)switch(qa.ge){case "DEPTH":I="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else I="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==m.type&&m.Ts&&(b.d.Hz.push(m.Ts),b.d.Gz.push(m.Iz));var p=m.Xa,v=e.d.wc;la.J(p,"SHADOW_SRC",I);W.ik(m,v);la.J(p,"NUM_LIGHTS",a.mf);"special_skydome.glslf"==la.Ho(p)&&la.J(p,
"REFLECTION_PASS",0);la.J(p,"SSAO_ONLY",0);a.Ba&&a.xc?la.J(p,"WATER_EFFECTS",1):la.J(p,"WATER_EFFECTS",0);a.Ba&&a.Ge&&f.Ge?(la.J(p,"CAUSTICS",1),la.J(p,"CAUST_SCALE",a.yn),la.J(p,"CAUST_SPEED",la.u(a.zn,2)),la.J(p,"CAUST_BRIGHT",a.xn)):la.J(p,"CAUSTICS",0);a.Ba&&(la.J(p,"WAVES_HEIGHT",la.u(a.te)),la.J(p,"WAVES_LENGTH",la.u(a.Ef)),la.J(p,"WATER_LEVEL",la.u(a.se)));m.uc&&ga.Ma(c,"MAIN_REFLECT")&&-1===m.ac.indexOf("u_mirrormap")?la.J(p,"REFLECTIVE",1):la.J(p,"REFLECTIVE",0);if(v=ga.Ma(c,"SKY"))if(m.fq){var S=
v.h.cb;W.pi(m,S,"u_sky")}else qa.Kh?(m.Ec=v.Ec,la.J(p,"PROCEDURAL_FOG",1)):la.J(p,"PROCEDURAL_FOG",0);else la.J(p,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){S=null;if(e.d.Wh.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)S=v.h.cb;else for(k=0;k<a.qg.length;k++)if(a.qg[k].texture.b4w_use_as_environment_lighting){S=W.Bv(a.qg[k],!1);break}S?(la.J(p,"SKY_TEXTURE",1),W.pi(m,S,"u_sky_texture")):A.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}m.ya&&
(v=ga.Ma(c,"GRASS_MAP"))&&u(m,v,f);ga.Ma(c,"REFRACT")&&m.Rl?la.J(p,"REFRACTIVE",1):la.J(p,"REFRACTIVE",0);m.re&&(m.Em&&ga.Ma(c,"DEPTH")?la.J(p,"SHORE_SMOOTHING",1):la.J(p,"SHORE_SMOOTHING",0),m.water_dynamic&&a.Ba&&a.te?la.J(p,"DYNAMIC",1):la.J(p,"DYNAMIC",0));"PARTICLES"==m.type&&(la.J(p,"SIZE_RAMP_LENGTH",m.Vp),la.J(p,"COLOR_RAMP_LENGTH",m.Mp));for(var v=m.D,t=0;t<v.length;t++){var S=v[t],fa=S.kj;if(fa){var q=fa.d.Na,ea=null,x=null;U.oe(q,function(a,b,c){if("SCREEN"==c.G)return ea=U.Ea(q,a),x=c,
!0});if(!ea||!x)throw"Failed to assign RTT";Qa.Aj(S,Qa.s,Qa.s);x.na=S;var y=ea.h;y.cb=S;y.Td=da.lq(S,null);r(fa,S.em,S.em,!0);S=ga.Wn(q);for(y=S.length-1;0<=y;y--){var J=S[y],B=J.h;aa.mg(B,1);"MAIN_OPAQUE"==a.type&&B.type==aa.pc&&aa.Nj(B,fa.d.wc);e.d.uf.unshift(J)}}}if(m.cg){var v=0,D;for(D in m.cg)v++;la.J(p,"NUM_LAMP_LIGHTS",v);m.ql=new Float32Array(3*v);m.ol=new Float32Array(3*v);m.nl=new Float32Array(3*v);m.pl=new Float32Array(4*v);for(t=0;t<e.ab.LAMP.length;t++)l(m,e.ab.LAMP[t])}w(c,a,I);W.sb(m);
I={R:!0,Va:f,k:m};s(m);a.l.push(I);h(c,a,m);n(m)}}a.l.sort(function(a,b){var c;if(a.k&&b.k){c=a.k.qa;var d=b.k.qa;(c=c==d?0:c>d?1:-1)||(c=a.k.of,d=b.k.of,c=c==d?0:c>d?1:-1)}else c=0;return c})}function l(a,b){var c=b.uuid;if(c in a.cg){c=a.cg[c];a.ql.set(b.d.e,3*c);a.ol.set(b.Ca.direction,3*c);a.nl.set(b.Ca.Lf,3*c);var d=za;x(b.Ca,zb,d);a.pl.set(d,4*c)}}function s(a){var b=a.Yb.attributes,c=a.bb.Kb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==
a.type)b=la.Wv(a.Yb.Bm),10<b&&("MAIN"==a.type&&A.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials: "'+a.tc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.Af&&(c=J.Te(a.Af)),a.Ra&&(d=J.Te(a.Ra)),A.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.tc.join(", ")+'"')))}function n(a){8<a.D.length&&A.warn("B4W Warning: too many textures used - "+a.D.length+' (max 8), materials "'+a.tc.join(", ")+'"')}function w(a,b,c){for(var d=
0,e=ga.Jo(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=ga.cv(a,g,"SHADOW_CAST").h,b.jr=g.ea,b.ln=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.rf=b.rf||[],b.rf[d]=g.ia,d++)}}function u(a,b,c){a.Ib=b.Ib;var d=b.Ib[0],e=b.Ib[1],f=b.Ib[2];c=c.Db;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Ib[2]=f;b=b.h;aa.tq(b,f/2,-e,-d,f/2);aa.mg(b);d=a.gl||0;d=0==d?c:Math.max(d,c);a.gl=d}function z(a,b){for(var c=
a.l,d=0;d<c.length;d++){var e=c[d].k;if(e&&e.id==b.id)return!0}return!1}function F(a){var b=V(a,"MAIN_OPAQUE"),c=!0;U.L(a.d.Na,function(d,e){"SHADOW_CAST"===e.type&&(p(e,b,e.l,a,c),c=!1)})}function p(b,c,d,e,f){if(0!=d.length){var g=b.h;c=c.h;var h=y(e,"LAMP",a.DATA_ID_ALL),h=(B(h)||h[0]).d;aa.wq(g,h.e,h.quat);va.copy(c.Sd,g.Sd);ba.copy(c.ea,g.zq);h=ob;E.Xc(h);for(var A=0;A<d.length;A++){var k=d[A].Va;0==A?E.Rn(k.Ia,h):E.mo(h,k.Ia)}d=E.Vu(h,Yb);J.ce(d,g.ea,d);if(e.d.wc.b4w_enable_csm){e=va.copy(c.ah[b.Fk],
ya);h=ba.invert(c.ea,Ea);J.ce(e,h,e);J.ce(e,g.ea,e);b=c.Gk[b.Fk];if(f)for(eb=0,f=2;f<d.length;f+=3)eb=Math.min(eb,d[f]);f=ob;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=eb}else{b=f=ob;c=db;c.set(d);e=ub/9;d=ba.identity(Ea);ba.rotate(d,e,J.AXIS_MZ,d);A=h=-1;for(k=0;10>k;k++){var l=E.rt(c,Sa),n=(l.max_x-l.min_x)*(l.max_y-l.min_y);if(-1==h||n<h)h=n,A=k,E.Rn(l,b);J.ce(c,d,c)}b=A*e;0<b&&(c=ba.identity(Ea),ba.rotate(c,b,J.AXIS_MZ,c),ba.multiply(c,g.ea,g.ea));b=f.max_x-
f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}aa.Fx(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);aa.mg(g);J.qo(g.Df,g.Yk)}}function B(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function e(a,b){for(var c=b.d,d=b.P,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=d[f];if(g.mc==e&&"COLOR_ID"==
g.type&&!z(a,g)){W.U(g,"USE_GLOW",0);W.sb(g);var h={R:!0,Va:c,k:g};s(g);a.l.push(h)}}}function t(a){var b=J.Zg(a);a.Xa=JSON.parse(JSON.stringify(a.Xa));return b}function x(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.Hg?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.Jg?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.Lq/2),c[1]=a.Kq*(1-b)}}function K(a,b){for(var c=G(b,ab),d=a.Ca,e=a.d,f=d.index,g=0;g<c.length;g++){var h=c[g];h.df.set(e.e,
3*f);h.af.set(d.direction,3*f);h.$e.set(d.Lf,3*f);var k=zb,n=za;x(d,k,n);switch(d.type){case "SUN":if(h.Vq.set(e.quat),h.Uq=d.Lf,"SKY"===h.type){var m=ya;m[0]=m[1]=m[2]=1;var r=Math.acos(va.dot(h.Gj,m)),m=Math.acos(va.dot(d.direction,m));h.ij=Math.floor(r/.025)!=Math.floor(m/.025)?!0:!1;va.copy(d.direction,h.Gj);H(b,h)}else va.copy(d.direction,h.Gj);case "HEMI":case "POINT":case "SPOT":break;default:A.error("B4W Warning: unknown light type: "+d.type)}h.bf.set(k,4*f);h.cf.set(n,4*f);h.ta=!0;for(k=
0;k<h.l.length;k++)n=h.l[k].k,n.cg&&l(n,a)}}function H(a,b){da.gh(b);if(b.ij)for(var c=G(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].l,f=0;f<e.length;f++){var g=e[f];g.R&&(g=g.k,W.Et(g)&&da.Fy(g))}}function y(b,c,d){if(!b.ab)throw"Access to uninitialized scene";b=b.ab[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.jd==d&&c.push(f)}return c}function L(b){var c=[];b=y(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,
f=0;f<e.materials.length;f++){var g=e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function r(a,b,c,d){for(var e=a.d,f=a.camera.d.M,g=0;g<f.length;g++){var h=f[g];aa.mg(h,b/c);e.Tl&&aa.Nj(h,e.wc)}e.Tl&&(e.jj=!0,V(a,"DEPTH").ta=!0,V(a,"MAIN_BLEND").ta=!0);aa.dr(a.camera);ga.Cy(e.Na,function(e,f,g){if(d||e.Fg){var h=e.ke*b,A=e.ke*c;if(f)for(f=0;f<g.Z.length;f++)g.Z[f]==e&&Qa.resize(e.na,h,A);else Qa.vh(e.na)&&Qa.resize(e.na,h,A),e=g.h,e.width=h,e.height=A,"DOF"==g.type&&N(a,{dof_power:g.h.dof_power,
dof_on:g.h.dof_on}),D(g,1/b,1/c)}})}function D(a,b,c){a=a.l;for(var d=0;d<a.length;d++){var e=a[d].k;e&&W.Vh(e,b,c)}}function G(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];U.L(a.d.Na,function(a,b){b.type==e&&c.push(b)})}return c}function V(a,b){return ga.Ma(a.d.Na,b)}function N(a,b){var c=V(a,"DOF");if(!c)return A.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Na;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.h.dof_distance=
b.dof_distance);"number"==typeof b.dof_front&&(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;for(var e=ga.eb(d,c,"POSTPROCESSING"),d=ga.eb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].l[0].k;f&&(W.xf(f,c.h.dof_power),D(e[d],1/c.h.width,1/c.h.height))}}c.ta=!0}function Z(a,b){var c=V(xa,"MAIN_OPAQUE");if(!c||!c.Ba)return A.error("get_water_surface_level() - no water parameters on this scene"),
0;var d=c.te,e=c.Ef,f=c.se,g=c.Ba;if(!d||!g.Sf)return g.se;var h=va.length(c.fi),k=c.time;h&&(k*=h);var l=Ca;l[0]=20/e*(a-.25*k);l[1]=20/e*(b-.25*k);h=J.An(l);l[0]=17/e*(b+.1*k);l[1]=17/e*(a+.1*k);var l=J.An(l),h=h+l-1,n=g.dst_noise_scale0,l=g.dst_noise_scale1,m=g.dst_noise_freq0,r=g.dst_noise_freq1,p=Ca;p[0]=n*(a+m*k);p[1]=n*(b+m*k);n=J.dm(p);p[0]=l*(b-r*k);p[1]=l*(a-r*k);l=J.dm(p);l*=d*n;if(c.Sj)if(r=(a-c.he[0])/c.ie[0],p=(c.he[1]+b)/c.ie[1],r+=.5,p+=.5,1<r||0>r||1<p||0>p)d=l;else var r=J.Eo(xa.d.Zl,
c.og,r,p),n=g.dir_freq,I=g.dir_noise_scale,v=g.dir_noise_freq,m=g.dir_min_noise_fac,p=g.dst_min_fac,c=e/c.fg/Math.PI,I=[I/e*(a+v*k),I/e*(b+v*k)],e=Math.sqrt(r),d=d*Math.max(r,g.dir_min_shore_fac)*Math.sin(e/c+n*k)*Math.max(J.dm(I),m),g=Math.max(e,p),d=d*(1-g)+l*g,h=h*r;else d=l;return f+(d+.05*h)}function P(a,b){a.th&&"POSTPROCESSING"==a.type&&b.R!=a.R&&(a.R=b.R);b.R||"GLOW"!=a.type||(a.Ok=0)}function M(a,b,c,d){var e=U.Ea(a,b);aa.zj(e.h,c,d);e.jk=!0;U.qe(a,b,function(b,e,f){f.xa&&f.G==c&&ga.Lt(f)&&
O(a,b,f.V,d)});U.pe(a,b,function(b,e,f){f.xa&&f.G==c&&f.G==f.V&&M(a,b,c,d)})}function O(a,b,c,d){a=U.Ea(a,b).l;for(b=0;b<a.length;b++)W.ox(a[b].k,d,c)}function Q(a){var b=V(a,"GRASS_MAP");if(b){var c=b.h,d=a.camera.d,e=d.e;a=ya;a[0]=0;a[1]=-b.Ib[2]/2;a[2]=0;va.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=ua;b[0]=0;b[1]=0;b[2]=0;b[3]=1;aa.wq(c,a,b)}}function R(a,b){U.L(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.Z[0]||!d.Rc[0])throw"Wrong MOTION_BLUR subscene";var e=d.Z[0],f=d.Rc[0];
d.Rc[0]=d.h.cb;U.qe(a,c,function(b,c,d){d.xa&&O(a,b,d.V,f)});M(a,c,e.G,f);O(a,c,e.V,d.Rc[0]);d.Ap=Math.exp(-b/d.fj)}})}function T(b,c){var d=0,e=b.Ks;0==e.pm&&(e.pm=c);var f=c-e.pm;if(e.kq&&f/e.Gh>=e.kq)a.clear_glow_anim(b);else{f%=e.Gh;if(f<e.So)switch(e=f/(e.So/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b.P.length;e++)f=b.P[e],"COLOR_ID"==f.type&&(f.Zf=d)}}function ja(a){U.L(a.d.Na,function(a,b){b.ta=
!0})}function Y(a){if("WIND"==a.field.type){a=a.d;J.quat_to_dir(a.quat,J.AXIS_Y,Ya);va.normalize(Ya,Ya);va.scale(Ya,a.Wk,Ya);a=Va;for(var b=0;b<a.length;b++)for(var c=G(a[b],Ra),d=0;d<c.length;d++)c[d].fi.set(Ya)}}var W=q("__batch"),E=q("__boundings"),aa=q("__camera"),ma=q("__config"),v=q("__debug"),I=q("__geometry"),U=q("__graph"),ka=q("__hud"),fa=q("__objects");q("__particles");var S=q("__prerender"),ea=q("__primitives"),A=q("__print"),da=q("__renderer"),ga=q("__scenegraph"),ha=q("__sfx"),la=q("__shaders"),
Qa=q("__textures"),J=q("__util"),va=q("vec3"),ba=q("mat4"),qa=ma.n,Ma="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Xa=["ARMATURE","EMPTY","MESH","SPEAKER"],Da="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),ab="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),kb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Ra="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),
cc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],xa=null,Va=[],bb=[],Wa,cb,ub=Math.PI/2;a.Yj=0;a.Km=1;a.Lm=2;a.DATA_ID_ALL=-1;var Ca=new Float32Array(2),ya=new Float32Array(3),zb=new Float32Array(4),za=new Float32Array(4),ua=new Float32Array(4),Ea=new Float32Array(16),Yb=new Float32Array(24),db=new Float32Array(24),ob=E.Xc(),Sa=E.Xc(),Ya=new Float32Array(3),eb=null;a.set_active=function(a){xa=a;ha.Cx(a)};a.$w=function(a){var b=a.d;if(!a.bk){for(var c=ga.Wn(b.Na),d=0;d<c.length;d++)b.uf.push(c[d]);
r(a,Wa,cb,!1)}a=G(a,Ra);for(c=0;c<a.length;c++)a[c].fi.set(Ya);for(d=0;d<b.uf.length;d++)"SHADOW_CAST"==b.uf[d].type&&da.gh(b.uf[d])};a.get_active=c;a.W=b;a.Mi=function(){return Va};a.Oi=function(b,c,d,e){for(var f=Va,h=null,k="",l=0;l<f.length;l++){var n=y(f[l],"ALL",a.DATA_ID_ALL);switch(b){case a.Yj:k=c;h=g(c,n,!1,d);break;case a.Km:k=d;h=null;(n=g(c,n,!1,e))&&n.dupli_group&&(h=g(d,n.dupli_group.objects,!0,e));break;case a.Lm:for(var k=c[c.length-1],h=null,m=0;m<c.length;m++)if((h=g(c[m],n,0!=
m,d))&&h.dupli_group)n=h.dupli_group.objects;else break}if(h)break}h||A.warn("get object "+k+": not found");return h};a.et=function(a,b,c){for(var e in Xa){var f=Xa[e],g=d(a,f),h=b.d.Kg,k=!1;for(e=0;e<c.length;e++)if(k=!0,c[e].d&&c[e].d.bg){for(var A=0;A<h.length;A++)h[A]==c[e]&&(k=!1);k&&h.push(c[e])}f in b.ab||(b.ab[f]=[]);for(A=0;A<g.length;A++)J.Ye(g[A])&&g[A].proxy||(b.ab.ALL.push(g[A]),b.ab[f].push(g[A]))}};a.Zs=function(b,c){b.ab={ALL:[]};for(var e in Ma){var g=Ma[e],h=d(b,g);b.ab[g]=[];for(var k=
0;k<h.length;k++)J.Ye(h[k])&&h[k].proxy||(b.ab.ALL.push(h[k]),b.ab[g].push(h[k]))}b.d=b.d||{};g=b.d;h=b.camera.d;e=b.world.b4w_shadow_settings;k=g.wc={};k.csm_resolution=e.csm_resolution;k.self_shadow_polygon_offset=e.self_shadow_polygon_offset;k.self_shadow_normal_offset=e.self_shadow_normal_offset;k.b4w_enable_csm=e.b4w_enable_csm;k.b4w_enable_csm?(k.csm_num=e.csm_num,k.csm_first_cascade_border=e.csm_first_cascade_border,k.first_cascade_blur_radius=e.first_cascade_blur_radius,k.csm_last_cascade_border=
e.csm_last_cascade_border,k.last_cascade_blur_radius=e.last_cascade_blur_radius,k.fade_last_cascade=e.fade_last_cascade,k.blend_between_cascades=e.blend_between_cascades):(k.csm_num=1,k.csm_first_cascade_border=e.csm_first_cascade_border,k.first_cascade_blur_radius=e.first_cascade_blur_radius,k.csm_last_cascade_border=e.csm_last_cascade_border,k.last_cascade_blur_radius=e.last_cascade_blur_radius,k.fade_last_cascade=!1,k.blend_between_cascades=!1);g.Kg=[];for(e=0;e<c.length;e++)c[e].d&&c[e].d.bg&&
g.Kg.push(c[e]);e=b.world.b4w_fog_color;g.Eb=new Float32Array([e[0],e[1],e[2],b.world.b4w_fog_density]);a:{if(b.ab)for(e=b.ab.LAMP,k=0;k<e.length;k++)if("SUN"==e[k].Ca.type){e=!0;break a}e=!1}g.Dd=e;e=g.Dd;var k={},l=b.world.b4w_sky_settings;k.procedural_skydome=l.procedural_skydome&&e;k.use_as_environment_lighting=l.use_as_environment_lighting;k.pg=l.color;k.rayleigh_brightness=l.rayleigh_brightness;k.mie_brightness=l.mie_brightness;k.spot_brightness=l.spot_brightness;k.scatter_strength=l.scatter_strength;
k.rayleigh_strength=l.rayleigh_strength;k.mie_strength=l.mie_strength;k.rayleigh_collection_power=l.rayleigh_collection_power;k.mie_collection_power=l.mie_collection_power;k.mie_distribution=l.mie_distribution;!e&&l.procedural_skydome&&A.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");g.Wh=k;var n=b.world;e=[0,0,0];var k=[0,0,0],l=n.light_settings,m=n.texture_slots;if(l.use_environment_light)if("SKY_COLOR"==l.environment_color||"SKY_TEXTURE"==l.environment_color)e=
n.horizon_color.slice(0),k=n.zenith_color.slice(0);else if("PLAIN"==l.environment_color)e=[1,1,1],k=[1,1,1];else throw"Unsupported world environment color"+l.environment_color;n={};n.Rd=l.environment_energy;n.ic=e;n.nc=k;n.qg=m;g.tr=n;g.rl=y(b,"LAMP",a.DATA_ID_ALL).length;e=L(b);k=[];l=y(b,"MESH",a.DATA_ID_ALL);for(m=0;m<e.length;m++){var r=e[m];if(r.b4w_water){for(var n={},p=0;p<l.length;p++)for(var I=l[p],v=I.data.materials,da=0;da<v.length;da++)v[da]==r&&(n.se=I.location[1]);if(qa.deferred_rendering)for(n.Eb=
r.b4w_water_fog_color.slice(0),n.Eb.push(r.b4w_water_fog_density),r.b4w_water_dynamic?(n.Sf=!0,n.waves_height=r.b4w_waves_height,n.waves_length=r.b4w_waves_length,n.dst_noise_scale0=r.b4w_water_dst_noise_scale0,n.dst_noise_scale1=r.b4w_water_dst_noise_scale1,n.dst_noise_freq0=r.b4w_water_dst_noise_freq0,n.dst_noise_freq1=r.b4w_water_dst_noise_freq1,n.dir_min_shore_fac=r.b4w_water_dir_min_shore_fac,n.dir_freq=r.b4w_water_dir_freq,n.dir_noise_scale=r.b4w_water_dir_noise_scale,n.dir_noise_freq=r.b4w_water_dir_noise_freq,
n.dir_min_noise_fac=r.b4w_water_dir_min_noise_fac,n.dst_min_fac=r.b4w_water_dst_min_fac,n.waves_hor_fac=r.b4w_water_waves_hor_fac):(n.Sf=!1,n.waves_height=0,n.waves_length=0),n.Bi=null,n.uk=null,n.vk=new Float32Array(2),n.Cj=null,r=r.texture_slots,p=0;p<r.length;p++)I=r[p].texture,"VORONOI"==I.type&&(n.Bi=I.noise_scale,n.vk.set([.3,.7]),n.uk=I.noise_intensity),!0===I.b4w_shore_dist_map&&(n.Cj=I.image,n.og=I.image.size[0],n.Tx=I.b4w_shore_boundings,n.fg=I.b4w_max_shore_dist);else n.waves_height=0,
n.waves_length=0,n.Bi=null,n.uk=null,n.vk=null,n.Eb=null,n.Sf=!1;k.push(n)}}if(0<k.length){n=k[0];if(!n.Sf)for(m=0;m<k.length;m++)k[m].Sf&&(n=k[m]);e=n}else e=null;g.Ba=e;a:{e=y(b,"MESH",a.DATA_ID_ALL);for(k=0;k<e.length;k++)if(e[k].d.Kc){e=!0;break a}e=!1}g.zk=e||qa.force_selectable;a:{e=y(b,"MESH",a.DATA_ID_ALL);for(k=0;k<e.length;k++)for(l=e[k].data.materials,m=0;m<l.length;m++)if(n=l[m],p=n.game_settings.alpha_blend,n.b4w_render_above_all&&"OPAQUE"!=p&&"CLIP"!=p){e=!0;break a}e=!1}g.mc=e;g.Fp=
0;if(qa.deferred_rendering){e=b.bk;g.Tl=f(b);g.qA=b.world.b4w_fog_color;a:{if(qa.shore_smoothing)for(k=L(b),l=0;l<k.length;l++)if(m=k[l],m.b4w_water&&m.b4w_water_shore_smoothing){k=!0;break a}k=!1}g.shore_smoothing=k;if(qa.wj&&b.b4w_render_reflections)for(k=[],l=y(b,"MESH",a.DATA_ID_ALL),m=0;m<l.length;m++){if(n=l[m],n.b4w_reflective){b:{n=n.constraints;for(p=0;p<n.length;p++)if(r=n[p],"LOCKED_TRACK"==r.type&&"REFLECTION PLANE"==r.name){p=r.target;break b}p=null}p&&(n=p.location,p=p.d.quat,r=new Float32Array(4),
J.By(n,p,J.AXIS_Y,r),k.push(r))}}else k=!1;g.hx=k;k={};l=b.world.b4w_bloom_settings;k.blur=l.blur;k.Ou=l.edge_lum;k.key=l.key;g.ut=k;k={};l=b.world.b4w_motion_blur_settings;k.ej=l.motion_blur_decay_threshold;k.fj=l.motion_blur_factor;g.Hw=k;k={};l=b.world.b4w_color_correction_settings;k.brightness=l.brightness;k.contrast=l.contrast;k.exposure=l.exposure;k.saturation=l.saturation;g.Dt=k;k={};l=b.world.b4w_god_rays_settings;k.nw=l.intensity;k.eg=l.max_ray_length;k.xg=l.steps_per_pass;g.cw=k;k={};l=
b.world;k.ph=l.b4w_glow_color;k.Qi=l.b4w_glow_factor;g.$v=k;g.Rf=qa.Rf&&(0<h.dof_distance||h.Me);a:{if(qa.ya)for(l=k=!1,m=y(b,"MESH",a.DATA_ID_ALL),n=0;n<m.length;n++){r=m[n];I=r.data.materials;for(p=0;p<I.length;p++)I[p].b4w_terrain&&(k=!0);r=r.particle_systems;for(p=0;p<r.length;p++)I=r[p].settings,"HAIR"==I.type&&I.b4w_dynamic_grass&&(l=!0);if(k&&l){k=!0;break a}}k=!1}g.ya=k;g.gg=qa.gg&&b.b4w_enable_motion_blur;g.Nf=qa.Nf&&b.b4w_enable_color_correction;g.antialiasing=qa.antialiasing&&b.b4w_enable_antialiasing;
g.Jf=qa.Jf&&b.b4w_enable_bloom&&g.Dd;g.yf=qa.yf&&b.b4w_enable_ssao;k={};l=b.world.b4w_ssao_settings;k.radius_increase=l.radius_increase;k.iw=l.hemisphere;k.vt=l.blur_depth;k.pn=l.blur_discard_value;k.influence=l.influence;k.dist_factor=l.dist_factor;k.sx=l.samples;g.ky=k;g.$f=qa.$f&&b.b4w_enable_god_rays&&g.Dd;g.jg=qa.jg&&b.b4w_render_refractions;g.glow=qa.glow?g.zk:!1;g.Na=ga.ku(e,g,h)}else g.Na=ga.lu(h,g);g.uf=[];g.jj=!1;g.El=!1;Va.push(b)};a.Ak=d;a.dl=function(a){return a.d.Na};a.lv=function(a){U.L(a,
function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=W.Vn(c.Jh);break;case "SSAO":d=W.su(c);break;case "SSAO_BLUR":d=W.tu(c);W.Vh(d,1/c.h.width,1/c.h.height);break;case "DEPTH_PACK":d=W.bu();break;case "REFRACT":case "SCREEN":d=W.Vn("NONE");break;case "GOD_RAYS":ga.eb(a,c,"WIREFRAME")||ga.eb(a,c,"MAIN_BLEND")||ga.eb(a,c,"GOD_RAYS");d=W.eu(c.Wp|0,(c.hb&&c.re)|0,c.xg);break;case "GOD_RAYS_COMBINE":ga.eb(a,c,"WIREFRAME")||ga.eb(a,c,"MAIN_BLEND");ga.eb(a,c,"GOD_RAYS");d=W.fu();break;case "MOTION_BLUR":d=
W.ju(c.ej);break;case "DOF":d=W.cu();W.xf(d,c.h.dof_power);for(var e=ga.eb(a,c,"POSTPROCESSING"),f=ga.eb(a,e,"POSTPROCESSING"),g=[e,f],k=0;k<g.length;k++){var A=g[k].l;(e=A[0].k)&&W.xf(e,c.h.dof_power)}break;case "GLOW":g=ga.eb(a,c,"POSTPROCESSING");k=ga.eb(a,g,"POSTPROCESSING");e=ga.eb(a,k,"POSTPROCESSING");f=ga.eb(a,e,"POSTPROCESSING");d=W.du();g=[k,g];for(k=0;k<g.length;k++)A=g[k].l,(A=A[0].k)&&W.xf(A,c.qn);g=[f,e];for(k=0;k<g.length;k++)A=g[k].l,(A=A[0].k)&&W.xf(A,c.po*c.Qi);break;case "COMPOSITING":d=
W.$t();break;case "ANTIALIASING":d=W.Wt();break;case "LANCZOS":d=W.gu(c.bB);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=W.qu(c.type);break;case "ANAGLYPH":d=W.Vt();break;case "SKY":d=W.pu();W.Vh(d,1/c.h.width,1/c.h.height);break;case "LUMINANCE":d=W.hu();break;case "AVERAGE_LUMINANCE":d=W.Xt();break;case "LUMINANCE_TRUNCED":d=W.iu();break;case "BLOOM_BLUR":d=W.Yt(c.Jh);W.Vh(d,1/c.h.width,1/c.h.height);break;case "BLOOM":d=
ga.eb(a,c,"BLOOM_BLUR");g=[ga.eb(a,d,"BLOOM_BLUR"),d];for(k=0;k<g.length;k++)A=g[k].l,(A=A[0].k)&&W.xf(A,c.bloom_blur);d=W.Zt();break;case "VELOCITY":d=W.wu()}d&&(e={R:!0,Va:fa.Fi("NONE"),k:d},s(d),c.l.push(e),h(a,c,d),n(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.Na,d=b.d;!ga.Ma(c,"SHADOW_CAST")&&d.rb&&(d.rb=!1);for(var d=G(a,Da),f=0;f<d.length;f++){var g=d[f],A=b,l=c,m=a;switch(g.type){case "MAIN_OPAQUE":k(g,A,l,"OPAQUE",m);break;case "MAIN_BLEND":k(g,A,l,"BLEND",m);
break;case "MAIN_XRAY":k(g,A,l,"XRAY",m);break;case "MAIN_REFLECT":l=A.d;A=A.P;for(m=0;m<A.length;m++){var r=A[m],I=t(r);if(!("MAIN"!=I.type&&"NODES"!=I.type&&"PARTICLES"!=I.type||z(g,I)||I.qa)&&I.Wb){var v=I.Xa;la.J(v,"DISABLE_FOG",0);la.J(v,"WATER_EFFECTS",0);"special_skydome.glslf"==la.Ho(v)&&la.J(v,"REFLECTION_PASS",1);la.J(v,"SHADOW_SRC","SHADOW_SRC_NONE");la.J(v,"TEXTURE_NORM",0);W.sb(I);v={R:!0,Va:l,k:I};s(I);g.l.push(v);"MAIN"==I.type&&(r.vb||(r.vb=[]),r.vb.push(I))}}break;case "DEPTH":r=
A.d;A=A.P;for(I=0;I<A.length;I++){var da=A[I];if("DEPTH"==da.type&&!z(g,da)&&!da.Ob){if(ga.hw(l,g,"SHADOW_CAST"))if(da.rb){switch(qa.ge){case "DEPTH":var v="SHADOW_SRC_DEPTH",S="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}da=W.tm(da,v,S);W.ik(da,m.d.wc);ga.Jo(l,g);w(l,g,v)}else da=W.tm(da,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else da=W.tm(da,"SHADOW_SRC_NONE","SHADOW_DST_NONE");da.ya&&(v=ga.Ma(l,"GRASS_MAP"))&&u(da,v,r);W.sb(da);v={R:!0,Va:r,k:da};s(da);g.l.push(v);h(l,g,da);n(da)}}break;
case "SHADOW_CAST":r=!1;I=A.d;A=A.P;for(v=0;v<A.length;v++)if(da=A[v],da.Nb||da.rb)if(r=!0,"DEPTH"==da.type&&!z(g,da)&&da.Nb){switch(qa.ge){case "DEPTH":S="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}da=W.ou(da,S);da.ya&&(S=ga.Ma(l,"GRASS_MAP"))&&u(da,S,I);W.U(da,"SHADOW_TEX_RES",la.u(m.d.wc.csm_resolution));W.sb(da);S={R:!0,Va:I,k:da};s(da);g.l.push(S)}r&&p(g,ga.Ma(l,"MAIN_OPAQUE"),g.l,m,!0);break;case "COLOR_PICKING":e(g,A);break;case "COLOR_PICKING_XRAY":e(g,A);break;case "GRASS_MAP":l=
A.d;A=A.P;for(m=0;m<A.length;m++)r=A[m],"GRASS_MAP"!=r.type||z(g,r)||(W.sb(r),I={R:!0,Va:l,k:r},s(r),g.l.push(I),r=g.h,S=l.Ia,I=g.Ib[0],v=g.Ib[1],da=g.Ib[2],0==I&&0==v?(I=S.min_y,v=S.max_y):(I=Math.min(I,S.min_y),v=Math.max(v,S.max_y)),S=1E-4*(v-I),g.Ib[0]=I-S,g.Ib[1]=v+S,aa.tq(r,da/2,-v,-I,da/2),aa.mg(r));break;case "GLOW_MASK":l=A.d;A=A.P;for(m=0;m<A.length;m++)r=A[m],"COLOR_ID"!=r.type||z(g,r)||(I=t(r),W.U(I,"USE_GLOW",1),W.sb(I),A.push(I),v={R:!0,Va:l,k:I},s(I),g.l.push(v),r.vb||(r.vb=[]),r.vb.push(I));
break;case "WIREFRAME":for(m=A.d,A=A.P,r=0;r<A.length;r++)I=A[r],"WIREFRAME"!=I.type||z(g,I)||(I.ya&&(v=ga.Ma(l,"GRASS_MAP"))&&u(I,v,m),W.sb(I),v={R:!0,Va:m,k:I},s(I),g.l.push(v),h(l,g,I),n(I))}}break;case "LAMP":b.Ca.index=a.d.Fp++;c=G(a,ab);for(d=0;d<c.length;d++)c[d].mf++;K(b,a)}};a.HA=z;a.Wl=function(a){a.d.jj=!0};a.Hv=function(a,b){for(var c=a.d.wc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=aa.yu(c,b,e);return d};a.hide_object=function(a){a.d.qh=!0};a.show_object=function(a){a.d.qh=
!1};a.lx=function(a,b){for(var c=b.d,d=G(a,Da),e=0;e<d.length;e++)for(var f=d[e].l,g=f.length-1;0<=g;g--){var k=f[g];k.Va==c&&(k.k&&I.In(k.k.bb),f.splice(g,1))}};a.check_object=function(a,b){return b.ab[a.type]&&-1<b.ab[a.type].indexOf(a)?!0:!1};a.Zx=function(a){var b=a.ab.LAMP;if(b.length==a.d.Fp){for(var c=[],d=0;d<b.length;d++)c[b[d].Ca.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].Ca,g=b[c[e]].Ca;if(g.Hg&&g.Jg&&(!f.Hg||!f.Jg)||!f.Hg&&(g.Hg||!f.Jg&&g.Jg))f=c[d],
c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].Ca.index=d,K(b[c[d]],a)}};a.Oj=K;a.Sy=function(b){var c=y(b,"LAMP",a.DATA_ID_ALL);if(c=B(c)||c[0]){b=G(b,ab);for(var d=0;d<b.length;d++)b[d].Aq=c.Ca.index}};a.cleanup=function(){for(var a=0;a<Va.length;a++){var b=Va[a];U.L(b.d.Na,function(a,b){if("SINK"!=b.type){var c=b.h;da.mx(c.Td,c.cb,c.hc,c.width,c.height);for(var c=b.l,d=0;d<c.length;d++){var e=c[d].k;e&&W.Nt(e)}}});b.d.Na=[];b.d.uf=[]}xa=null;Va.length=0;bb.length=0;Ya[0]=0;Ya[1]=0;Ya[2]=0};a.wp=
function(a,b,c){a=aa.Wu(a,a.Fa,a.La,null,!0);var d=ea.pv(a);a=fa.Fi("DYNAMIC");a.Ia=a.Db={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.kb=a.rc=E.tt();var e=a.kb.ma;a.Fe=a.Ee=E.Dk([e,0,0],[0,e,0],[0,0,e],a.kb.t);c=W.nu(d,c);b.l.push({R:!0,Va:a,k:c})};a.la=y;a.Pv=function(a){return[a.frame_start,a.frame_end]};a.xq=function(a,b){Wa=a;cb=b;xa&&r(xa,a,b,!1)};a.Vh=D;a.ry=G;a.ga=V;a.get_environment_colors=function(a){a=G(a,ab)[0];var b=a.ic,c=a.nc,d=[],e=[];d[0]=b[0];d[1]=b[1];
d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Rd,d,e]};a.set_environment_colors=function(a,b,c,d){a=G(a,ab);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Rd=b);c&&f.ic.set(c);d&&f.nc.set(d);f.ta=!0}};a.get_sky_params=function(a){if(a=V(a,"SKY")){var b={};b.color=Array(3);va.copy(a.pg,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=
a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=V(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=
b.use_as_environment_lighting),"object"==typeof b.color&&c.pg.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=
b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ta=!0,c.ij=!0,H(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=G(a,kb)[0].Eb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=G(a,kb),d=0;d<c.length;d++){var e=
c[d];e.Eb.set(b);e.ta=!0}};a.get_ssao_params=function(a){var b=V(a,"SSAO");a=V(a,"SSAO_BLUR");if(!b)return null;var c=b.l[0].k,d={};d.ssao_quality=W.fb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.pn=a.ssao_blur_discard_value;d.radius_increase=b.ug;d.influence=b.tg;d.dist_factor=b.sg;d.ssao_only=b.ssao_only;d.ssao_white=W.fb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=V(a,"SSAO"),d=V(a,"SSAO_BLUR");if(!c)return A.error("SSAO is not enabled on scene"),
0;if("string"==typeof b.ssao_quality){var e=c.l[0].k;W.U(e,"SSAO_QUALITY",b.ssao_quality);W.sb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.l[0].k,W.U(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),W.sb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.l[0].k,W.U(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),W.sb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ug&&(c.ug=b.ug);"number"==typeof b.tg&&(c.tg=b.tg);"number"==typeof b.sg&&(c.sg=
b.sg);if("number"==typeof b.ssao_only){c=V(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.l.length;f++)e=c.l[f].k,W.U(e,"SSAO_ONLY",b.ssao_only),W.sb(e,!0)}"number"==typeof b.ssao_white&&(e=c.l[0].k,W.U(e,"SSAO_WHITE",b.ssao_white),W.sb(e,!0));c.ta=!0;d.ta=!0};a.get_dof_params=function(a){a=V(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=a.h.dof_power;return b};a.set_dof_params=N;a.get_god_rays_params=function(a){var b=
G(a,["GOD_RAYS"]);a=V(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].eg;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=W.fb(b[0].l[0].k,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=G(a,["GOD_RAYS"]),d=V(a,"GOD_RAYS_COMBINE");if(!c||!d)return A.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=
b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].eg=e,c[f].vj=e/c[f].xg/(f+1),c[f].ta=!0;if("number"==typeof b.god_rays_steps)for(var g=la.u(b.god_rays_steps,1),e=c[0].eg,f=0;f<c.length;f++){c[f].xg=g;c[f].vj=e/g/(f+1);c[f].ta=!0;var k=c[f].l[0].k;W.U(k,"STEPS_PER_PASS",g);W.sb(k,!0)}d.ta=!0};a.get_bloom_params=function(a){var b=V(a,["LUMINANCE_TRUNCED"]);a=V(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=
function(a,b){var c=V(a,"LUMINANCE_TRUNCED"),d=V(a,"BLOOM");if(!c||!d)return A.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ta=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ta=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.Na,c=ga.eb(e,d,"BLOOM_BLUR"),e=ga.eb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].l[0].k;f&&(W.xf(f,b.bloom_blur),D(c[e],1/d.h.width,1/d.h.height))}};a.get_wind_params=function(){var a=
Ya,b=va.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=y(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return A.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(ya=[0,c.wind_dir/180*Math.PI,-Math.PI/2],J.euler_to_quat(ya,ua),d.quat.set(ua),Y(g));"number"==typeof c.wind_strength&&(d.Wk=c.wind_strength,
Y(g));ja(b)};a.xx=function(a){a.d.El=!0};a.get_water_surface_level=Z;a.get_water_mat_params=function(a,b){var c=V(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.te,b.waves_length=c.Ef,c.xc)){b.water_fog_density=c.xc[3];var d=b.water_fog_color=[];d[0]=c.xc[0];d[1]=c.xc[1];d[2]=c.xc[2]}};a.set_water_params=function(a,b){var c=V(a,"MAIN_OPAQUE");if(!c||!c.Ba)return A.error("set_water_params() - no water parameters on this scene"),null;c=c.Ba;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);
"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);
"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Sf=b.water_dynamic);for(var d=G(a,cc),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Eb&&(f.xc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Eb&&f.xc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.te=b.waves_height);
"number"==typeof b.waves_length&&(f.Ef=b.waves_length);f.ta=!0}};a.get_shore_dist=function(a,b){var c=V(xa,"MAIN_OPAQUE");if(!c.Sj)return 100;var d=c.fg,e=c.se,f=(a[0]-c.he[0])/c.ie[0],g=(c.he[1]+a[2])/c.ie[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*J.Eo(xa.d.Zl,c.og,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().camera.d,e=0;e<Va.length;e++){var f=Va[e],g=f.d.Na;if(f.d.Ba)var k=d.e[1]-Z(d.e[0],d.e[2]);for(var h=f.d.Kg,A=0;A<h.length;A++){var l=h[A].d.wa,
n=h[A].d.Xk+h[A].d.Ta;if(l){var m=h[A].d,r=Math.round(l.currentTime*m.Pe),I=m.Ta/m.Pe;if(r<m.Ta-(qa.Ze?5:0)||h[A].d.ai&&r>n)l.currentTime=I;!h[A].d.ai&&r>n&&l.pause();2<=l.readyState&&Qa.Vy(m)}}U.L(g,function(b,c){-1<Ra.indexOf(c.type)&&(c.time=a);-1<cc.indexOf(c.type)&&f.d.Ba&&(c.tk=k)})}if(qa.deferred_rendering)for(e=0;e<bb.length;e++)T(bb[e],a);for(e=0;e<Va.length;e++)if(f=Va[e],A=f.d,d=A.uf,A.jj&&(F(f),A.jj=!1),A.El&&(Q(f),A.El=!1),d.length){f.b4w_enable_motion_blur&&R(A.Na,b);if(qa.deferred_rendering&&
A.glow){for(var g=V(f,"GLOW_MASK").l,p=0,A=0;A<g.length;A++)p+=g[A].k.Zf;U.L(f.d.Na,function(a,b){"GLOW"===b.type&&(b.Ok=p)})}g=null;for(A=0;A<d.length;A++)"GLOW_MASK"==d[A].type&&(g=A);for(A=0;A<d.length;A++)h=d[A],S.Pl(h),null!==g&&P(h,d[g]),da.gh(h)}qa.show_hud_debug_info&&ka.Ux(Va,b)};a.bl=function(a){var b=[];U.L(a.d.Na,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.Ks={pm:0,So:b,Gh:c,kq:d};-1==bb.indexOf(a)&&bb.push(a)};a.clear_glow_anim=function(a){if(a.P)for(var b=
0;b<a.P.length;b++){var c=a.P[b];"COLOR_ID"==c.type&&(c.Zf=0)}a=bb.indexOf(a);-1!=a&&bb.splice(a,1)};a.Xz=function(){bb=[]};a.get_cam_water_depth=function(){var a=V(xa,"MAIN_BLEND"),b=xa;return a||b.d.Ba?a.tk:null};a.get_object_data_id=function(a){return a.d.jd};a.gr=ja;a.Qx=function(a,b){switch(b){case "WM_NONE":a.R=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_mode=v.Qm[b];a.R=
!0}a.qa="WM_TRANSPARENT_WIREFRAME"==b;a.ta=!0};a.Px=function(a,b){for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_edge_color=b,a.ta=!0};a.Ym=function(a,b){for(var c=0;c<b.length;c++)a.ab.ALL.push(b[c]),a.ab.MESH.push(b[c])};a.fr=Y;a.pick_object=function(d,e){if(!b())return A.error("No active scene"),null;var f=c(),g=V(f,"COLOR_PICKING");if(g){S.Pl(g);da.gh(g);var k=V(f,"COLOR_PICKING_XRAY");k?(S.Pl(k),da.gh(k),g=k.h):g=g.h;e=g.height-e;g=da.fx(g.Td,d,e);f=y(f,"MESH",a.DATA_ID_ALL);for(k=0;k<f.length;k++){var h=
f[k].Sm;if(h&&5>Math.abs(255*h[0]-g[0])&&5>Math.abs(255*h[1]-g[1])&&5>Math.abs(255*h[2]-g[2]))return f[k]}}else A.error("Color picking is not available");return null};a.Yv=function(){return Ya};a.Qv=function(b){var c=[];b=y(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.Kc&&c.push(e)}return c}};b4w.module.__physics=function(a,q){function c(a,b){for(var d=a.Fd,e=0;e<d.length;e++)d[e].d.Qj&&b.push(d[e]),c(d[e],b)}function b(a,b){if(Q)switch(a){case y.Fr:K.log(b);break;case y.Cr:K.error(b);break;case y.Dr:H.fbmsg.apply(this,b.slice(1));break;case y.Jr:var c=g(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,k=b.angvel,c=c.j;c.Hk=b.time;D.Uh(d,1,e,c.Ik);N.copy(f,c.tp);N.copy(k,c.$m)}break;case y.Hr:(d=g(b.chassis_hull_body_id))&&D.Uh(b.trans,1,b.quat,d.f.Lh[b.prop_ind]);break;case y.Er:if(c=
g(b[1]))d=b[4],c=c.qc.vi[b[2]],r.set_translation(c,b[3]),r.set_rotation(c,d),r.v(c);break;case y.Kr:if(c=g(b[1]))c.f.speed=b[2];break;case y.Ar:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),k=Q.j.l,h=0;h<k.length;h++)for(var l=k[h].gb,n=0;n<l.Cc.length;n++){for(var m=l.Cc[n],p=m.oj,v=!1,s=0;s<p.length;s++){var u=p[s];if(u[0]===d&&u[1]===c){m.Zp[s]=e;v=!0;break}}if(v){p=m.Zp;for(s=v=0;s<p.length;s++)v=v||p[s];m.callback(v,f)}}break;case y.Br:if(c=g(b[1]))c=c.j,c.Di&&c.Di(b[2]);
break;case y.Ir:if(c=g(b.body_id))for(c=c.j,e=b.from,f=b.to,k=b.local,h=b.body_id_b_hit,l=b.cur_result,n=0;n<c.de.length;n++)if(p=c.de[n],G.Ci(p.G,e)&&G.Ci(p.V,f)&&p.local==k){for(d in p.yd)p.yd[d]=1;-1!=h&&(p.yd[h]=l);for(var m=p.Qb,s=p.callback,p=p.yd,v=!1,u=1,t=0;t<Q.j.l.length;t++){var w=Q.j.l[t].gb;if(("ANY"==m||w.id==m)&&w.F in p&&1!==p[w.F]){v=!0;u=p[w.F];break}}s(v,u)}break;case y.Gr:console.log("Physics message ping: ",performance.now()-b[1]);break;default:K.error("Wrong message: "+a)}}function g(a){return T[a]||
null}function d(){ja.body++;return ja.body}function m(a){return{F:a,yl:0,Xi:!1,je:!0,ZA:!1,is_character:!1,rw:!1,Ei:null,id:"",Zz:{},Cc:[],Di:null,de:[],Hk:0,Ik:new Float32Array([0,0,0,1,0,0,0,1]),tp:new Float32Array(3),$m:new Float32Array(3),zi:new Float32Array(3),yi:new Float32Array(4)}}function f(a,b){switch(a){case "BOX":var c=b.Db;break;case "CYLINDER":c=b.nk;break;case "CONE":c=b.mk;break;case "SPHERE":c=b.rc;break;case "CAPSULE":c=b.lk}return c}function h(a){if(!a)return null;var b={};"number"===
typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.t&&(b.center=a.t);"number"===typeof a.ma&&(b.radius=a.ma);"number"===typeof a.height&&(b.height=a.height);return b}function k(a,b,c,d){var e=a.d.e,f=b.d.H,g=new Float32Array(16);P.invert(f,g);f=new Float32Array(3);N.transformMat4(e,
g,f);switch(b.f.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Db;y.m(y.Mr,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:y.m(y.Lr,c,f,a.AB)}}function l(a){return a.j&&a.j.Ei?!0:!1}function s(a,b,c,d,e,f,g,k,h,l){var n;ja.Qn++;n=ja.Qn.toString(16);y.m(y.Tr,n,a,k,b.j.F,c,d,e.j.F,f,g,h,l);b.j.Ei=n}function n(a){var b=a.j;if(b&&(0===b.yl||!0===b.Xi||!1===b.je||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.j.zi[0]||a.d.e[1]!=a.j.zi[1]||a.d.e[2]!=a.j.zi[2]||
a.d.quat[0]!=a.j.yi[0]||a.d.quat[1]!=a.j.yi[1]||a.d.quat[2]!=a.j.yi[2])){a.j.zi.set(a.d.e);a.j.yi.set(a.d.quat);var b=a.j,c=y.Ko(y.Ff);c.msg_id=y.Ff;c.body_id=a.j.F;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=W,Z.identity(W)):c.quat=a.d.quat;y.m(y.Ff,c)}a=a.Fd;for(b=0;b<a.length;b++)n(a[b])}function w(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;N.transformQuat(e,a,e)}function u(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.j.l.length;e++){var f=b.j.l[e];
if("ANY"==a||f.gb.id==a)f=f.gb.F,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function z(a,b){y.m(y.yc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=G.cn(e.G)+G.cn(e.V)+String(e.local);c[f]=c[f]||{G:e.G,V:e.V,local:e.local,rn:[]};var g=c[f].rn,k;for(k in e.yd)-1==g.indexOf(k)&&g.push(k)}for(f in c)d=c[f].G,e=c[f].V,k=c[f].local,g=c[f].rn,y.m(y.Om,a,d,e,k,g)}else y.m(y.Om,a,null,null,!1,null)}function F(a,b){if(b.wg){var c=a.j.F,d=b.Uf*b.yo,e=b.Wg*b.tn,f=-b.vg*b.jm*2*Math.PI/b.Oq;b.jp&&
(f*=-1);switch(b.type){case 10:y.m(y.yc,c);y.m(y.As,c,d,e,f);break;case 20:y.m(y.yc,c),y.m(y.zs,c,d,e,f)}}}function p(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function B(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function e(a){return a.b4w_character?!0:!1}function t(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}q("__camera");var x=q("__config");q("__constraints");var K=q("__print"),H=q("__debug"),y=q("__ipc");q("__renderer");
var L=q("__scenes"),r=q("__transform"),D=q("__tsr"),G=q("__util"),V=q("__version"),N=q("vec3"),Z=q("quat"),P=q("mat4"),M=x.gb,O=x.n,Q=null,R=[],T=[],ja={sr:0,body:0,Qn:0,shape:0},Y=new Float32Array(3),W=new Float32Array(4),E=new Float32Array(4),aa=new Float32Array(16),ma=new Float32Array(8),v=new Float32Array(8);a.lw=function(a){if(M.enabled){var c=M.Gg+V.timestamp();K.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+M.$d);c=new Worker(c);y.init(c,b);y.m(y.js,a,M.$d)}};a.en=function(a){var b;ja.sr++;
b=ja.sr;y.m(y.Yr,b);a.j={};a.j.mz=b;a.j.l=[]};a.cleanup=function(){if(M.enabled){y.m(y.ds);Q=null;R.length=0;T.length=0;for(var a in ja)ja[a]=0}};a.append_object=function(a,b){Q=b;y.m(y.os,b.j.mz);var g=a.d;if(!g)throw"No object render: "+a.name;if(a.parent&&g.Qj)return null;var n=[];g.Qj&&c(a,n);for(var r=a.P||[],v=0;v<r.length;v++){var A=r[v],da;if(da="PHYSICS"==A.type){var u;a:{for(var w=b.j.l,q=0;q<w.length;q++){var z=w[q].k;if(z&&z.id==A.id){u=!0;break a}}u=!1}da=!u}if(da)if(A.$b.C)if(A.re&&
b.d.Ba){var x=A;y.m(y.Xr);var D=Q,ba=L.ga(D,"MAIN_OPAQUE");if(ba.Ba&&x.hz){var H={};H.dst_noise_scale0=x.dst_noise_scale0;H.dst_noise_scale1=x.dst_noise_scale1;H.dst_noise_freq0=x.dst_noise_freq0;H.dst_noise_freq1=x.dst_noise_freq1;H.dir_min_shore_fac=x.dir_min_shore_fac;H.dir_freq=x.dir_freq;H.dir_noise_scale=x.dir_noise_scale;H.dir_noise_freq=x.dir_noise_freq;H.dir_min_noise_fac=x.dir_min_noise_fac;H.dst_min_fac=x.dst_min_fac;H.waves_hor_fac=x.waves_hor_fac;var V=ba.te,M=ba.Ef,O=ba.se;ba.Sj?y.m(y.Nm,
H,ba.ie[0],ba.ie[1],ba.he[0],ba.he[1],ba.fg,V,M,O,ba.og,D.d.Zl):y.m(y.Nm,H,0,0,0,0,0,V,M,O,0,null)}}else{var ab;if(A.Yy){var W=a,Y=A,ja=d(),xa=Y.$b;y.m(y.Vr,ja,xa.r[0].a_position,xa.Y||null,W.d.e,Y.Ln,Y.Mn);var Va=m(ja);Va.Xi=!0;ab=Va}else{var bb=a,Wa=A,cb=d(),ub=Wa.$b;y.m(y.Wr,cb,ub.r[0].a_position,ub.Y||null,bb.d.e,Wa.mh,Wa.hh,Wa.Ln,Wa.Mn);ab=m(cb)}var Ca=ab;Ca.id=A.Qb;var ya={k:A,gb:Ca};b.j.l.push(ya)}else K.error("Object "+a.name+" has collision material with no assigned vertices")}if(p(a)||B(a)||
e(a)||t(a)||a.b4w_collision){var ma=a,za=g.aq,ua=ma.d,Ea=ma.game,Yb=d();if("CAMERA"==ma.type)var db=Ea.use_collision_bounds?Ea.collision_bounds_type:"BOX",ob=f(db,ua),Sa=ua.mh,Ya=ua.hh,Sa=.5,Ya=0;else"EMPTY"==ma.type?(db="EMPTY",ob=null,Ya=Sa=0):(db=Ea.use_collision_bounds?Ea.collision_bounds_type:"BOX",ob=f(db,ua),Sa=ua.mh,Ya=ua.hh);var eb=ua.e,bd=ua.quat,Sc=Ea.use_ghost,cd=Ea.use_sleep,Tc=Ea.mass,uc=Ea.velocity_min,pb=Ea.velocity_max,$a=Ea.damping,Ab=Ea.rotation_damping,dc=Ea.collision_group,Mb=
Ea.collision_mask,Vb=ua.rc.ma,Wb=h(ob),lc=ma.b4w_correct_bounding_offset,wa;var Nb=db;if(n.length){var fb=[],sa={};sa.quat=new Float32Array([0,0,0,1]);sa.trans=new Float32Array(3);sa.worker_bounding=Wb;sa.bounding_type=Nb;fb.push(sa);P.invert(ua.H,aa);Z.invert(ua.quat,E);for(var Bb=0;Bb<n.length;Bb++){var ca={},Ta=n[Bb],gb=Ta.game.collision_bounds_type,oa=new Float32Array(4),Ia=new Float32Array(3);N.transformMat4(Ta.d.e,aa,Ia);Z.multiply(E,Ta.d.quat,oa);ca.trans=Ia;ca.quat=oa;ca.bounding_type=gb;
ca.worker_bounding=h(f(gb,Ta.d));fb.push(ca)}wa=fb}else wa=[];y.m(y.Pr,Yb,eb,bd,za,Sc,cd,Tc,uc,pb,$a,Ab,dc,Mb,db,Wb,Vb,Sa,Ya,wa,lc);R.push(ma);T[Yb]=ma;var hb=m(Yb);hb.type=za;hb.yl=Tc;hb.Xi=Sc;Ca=hb;a.j=Ca;ya={k:null,gb:Ca};b.j.l.push(ya)}if(p(a)||B(a)){var ta=a,Ua=ta.j.F;p(ta)?(ta.f.type=10,y.m(y.Qr,Ua,ta.f.uy,ta.f.wy,ta.f.vy,ta.f.kz,ta.f.Gw)):B(ta)&&(ta.f.type=20,y.m(y.Or,Ua,ta.f.Tk,ta.f.Cm,ta.f.Dm));if(ta.f.tf){var pa=ta.f.tf;switch(ta.f.type){case 10:k(pa[1],ta,Ua,!0);k(pa[0],ta,Ua,!0);k(pa[3],
ta,Ua,!1);k(pa[2],ta,Ua,!1);break;case 20:for(var Ja=0;Ja<pa.length;Ja++)k(pa[Ja],ta,Ua,!1)}}ta.j.id=ta.b4w_vehicle_settings.name;F(a,a.f)}else if(e(a)){var Cb=a.d,ec=a.j,Zb=Cb.Db.max_y-Cb.Db.min_y,$b=ec.F,vb=a.b4w_character_settings,Db=vb.walk_speed,mc=vb.run_speed,Eb=vb.step_height,wb=vb.jump_strength,nc=vb.waterline,Ob=G.Ku(a);y.m(y.Rr,$b,Ob,Zb,Db,mc,Eb,wb,nc);ec.is_character=!0}else if(t(a)){var Ka=a,ac=Ka.j.F;y.m(y.Ur,ac,Ka.qc.Tk,Ka.qc.Cm,Ka.qc.Dm);if(Ka.qc.vi)for(var oc=Ka.qc.vi,Na=0;Na<oc.length;Na++){var qb=
oc[Na],Fb=qb.d.e,pc=Ka.d.H,Fa=new Float32Array(16);P.invert(pc,Fa);var La=new Float32Array(3);N.transformMat4(Fb,Fa,La);y.m(y.Nr,ac,La,qb.wt)}Ka.j.rw=!0}else a.b4w_collision&&(Ca.id=a.b4w_collision_id);for(v=0;v<R.length;v++)if(a=R[v],a.j){var C=a;if(!l(C))for(var na=0;na<C.constraints.length;na++){var Ba=C.constraints[na],ra=Ba.target,Xb=Ba.pivot_type;if("RIGID_BODY_JOINT"==Ba.type&&ra.j){var X=new Float32Array([Ba.pivot_x,Ba.pivot_y,Ba.pivot_z]),lb,mb=new Float32Array([Ba.axis_x,Ba.axis_y,Ba.axis_z]);
lb=G.euler_to_quat(mb,new Float32Array(4));var Pb=P.fromRotationTranslation(lb,X,new Float32Array(16)),rb=P.multiply(C.d.H,Pb,new Float32Array(16)),Qb=P.invert(ra.d.H,new Float32Array(16)),xb=P.multiply(Qb,rb,Qb),Gb=G.hf(xb),Rb=G.matrix_to_quat(xb),Aa=Ba,Ga={};Ga.use_limit_x=Aa.use_limit_x;Ga.use_limit_y=Aa.use_limit_y;Ga.use_limit_z=Aa.use_limit_z;Ga.use_angular_limit_x=Aa.use_angular_limit_x;Ga.use_angular_limit_y=Aa.use_angular_limit_y;Ga.use_angular_limit_z=Aa.use_angular_limit_z;Ga.limit_max_x=
Aa.limit_max_x;Ga.limit_min_x=Aa.limit_min_x;Ga.limit_max_y=Aa.limit_max_y;Ga.limit_min_y=Aa.limit_min_y;Ga.limit_max_z=Aa.limit_max_z;Ga.limit_min_z=Aa.limit_min_z;Ga.limit_angle_max_x=Aa.limit_angle_max_x;Ga.limit_angle_min_x=Aa.limit_angle_min_x;Ga.limit_angle_max_y=Aa.limit_angle_max_y;Ga.limit_angle_min_y=Aa.limit_angle_min_y;Ga.limit_angle_max_z=Aa.limit_angle_max_z;Ga.limit_angle_min_z=Aa.limit_angle_min_z;s(Xb,C,X,lb,ra,Gb,Rb,Ga,null,null)}}}};a.bv=g;a.update=function(){for(var a=0;a<R.length;a++){var b=
R[a],c=b.j;if(c.je&&c.Hk){var d=performance.now()/1E3-c.Hk,d=Math.min(d,10/60);O.Mw&&(d=0);var e=ma;D.mw(c.Ik,d,c.tp,c.$m,ma);r.set_translation(b,D.Qo(e));r.set_rotation(b,D.Lo(e));r.v(b);n(b);if(b.f)for(var c=b,d=c.f.tf,e=c.d.Tc,f=ma,g=0;g<d.length;g++){var k=d[g];D.multiply(e,c.f.Lh[g],f);r.vq(k,f);r.v(k)}b.f&&b.f.wg&&(c=b.f,d=c.wg)&&(e=b.f.Pq,k=aa,f=b.d.e,g=b.d.quat,G.rm(b.f.Qq,g,f,k),G.hf(k,d.d.e),G.matrix_to_quat(k,d.d.quat),k=W,G.sm(e,g,f,k),e=E,Z.setAxisAngle(k,-c.vg*c.jm*2*Math.PI,e),Z.multiply(e,
d.d.quat,d.d.quat),r.v(d));b.f&&b.f.gm&&(c=b.f,d=c.gm)&&(f=b.f.Iq,e=aa,g=b.d.e,k=b.d.quat,G.rm(b.f.Jq,k,g,e),G.hf(e,d.d.e),G.matrix_to_quat(e,d.d.quat),e=W,G.sm(f,k,g,e),f=E,g=Math.abs(c.speed)*c.Hq,g>c.Al&&(g=c.Al),Z.setAxisAngle(e,-g,f),Z.multiply(f,d.d.quat,d.d.quat),r.v(d));b.f&&b.f.mm&&(c=b.f,d=c.mm)&&(e=b.f.Wq,k=aa,f=b.d.e,g=b.d.quat,G.rm(b.f.Xq,g,f,k),G.hf(k,d.d.e),G.matrix_to_quat(k,d.d.quat),b=W,G.sm(e,g,f,b),e=E,Z.setAxisAngle(b,-Math.abs(c.Uf)*c.eo,e),Z.multiply(e,d.d.quat,d.d.quat),r.v(d))}}if(a=
Q)a=L.ga(a,"MAIN_OPAQUE"),a.Ba&&0<a.Ba.waves_height&&(b=N.length(a.fi),y.m(y.ys,a.time*b))};a.vv=function(){return Q};a.pause=function(){M.enabled&&y.m(y.ks)};a.resume=function(){M.enabled&&y.m(y.ns)};a.enable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(!a.je){var b=a.F;a.je=!0;y.m(y.hs,b)}};a.disable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(a.je){var b=a.F;a.je=!1;y.m(y.gs,b)}};a.has_physics=function(a){return a.j?!0:!1};a.has_dynamic_physics=function(a){return(a=
a.j)&&a.je&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.yl&&0==a.Xi?!0:!1};a.has_simulated_physics=function(a){return(a=a.j)&&a.je?!0:!1};a.set_gravity=function(a,b){y.m(y.xs,a.j.F,b)};a.fw=l;a.apply_constraint=s;a.clear_constraint=function(a){a=a.j;y.m(y.ms,a.Ei);a.Ei=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=D.Of(c,1,d,ma);f=D.Of(f,1,g,v);D.invert(c,c);D.multiply(f,c,c);r.Vv(e,f);D.multiply(f,c,c);r.vq(b,c);r.v(b);a.set_transform(b,b.d.e,b.d.quat)};a.set_transform=function(a,b,
c){D.Uh(a.d.e,1,a.d.quat,a.j.Ik);var d=y.Ko(y.Ff);d.msg_id=y.Ff;d.body_id=a.j.F;d.trans=b;d.quat=c;y.m(y.yc,a.j.F);y.m(y.Ff,d)};a.sync_transform=n;a.apply_velocity=function(a,b,c,d){w(a,b,c,d,Y);a=a.j.F;y.m(y.yc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(Y[0]),f=Math.abs(Y[1]),g=Math.abs(Y[2]);Y[0]=e?Y[0]/e*Math.max(e,b):0;Y[1]=f?Y[1]/f*Math.max(f,c):0;Y[2]=g?Y[2]/g*Math.max(g,d):0;y.m(y.Pm,a,Y[0],Y[1],Y[2])};a.apply_velocity_world=function(a,b,c,d){a=a.j.F;y.m(y.yc,a);y.m(y.Pm,a,
b,c,d)};a.apply_force=function(a,b,c,d){w(a,b,c,d,Y);a=a.j.F;y.m(y.yc,a);y.m(y.Zr,a,Y[0],Y[1],Y[2])};a.apply_torque=function(a,b,c,d){w(a,b,c,d,Y);a=a.j.F;y.m(y.yc,a);y.m(y.as,a,Y[0],Y[1],Y[2])};a.set_character_move_dir=function(a,b,c){a=a.j.F;y.m(y.yc,a);y.m(y.rs,a,b,c)};a.set_character_move_type=function(a,b){y.m(y.ss,a.j.F,b)};a.set_character_walk_velocity=function(a,b){y.m(y.ws,a.j.F,b)};a.set_character_run_velocity=function(a,b){y.m(y.us,a.j.F,b)};a.set_character_fly_velocity=function(a,b){y.m(y.ps,
a.j.F,b)};a.character_jump=function(a){y.m(y.bs,a.j.F)};a.character_rotation_inc=function(a,b,c){y.m(y.cs,a.j.F,b,c)};a.set_character_rotation=function(a,b,c){y.m(y.ts,a.j.F,b,c)};a.set_character_rotation_h=function(a,b){y.m(y.qs,a.j.F,b)};a.set_character_rotation_v=function(a,b){y.m(y.vs,a.j.F,b)};a.Vz=function(){return!1};a.Uz=function(){return!1};a.check_collision=function(){K.error("check_collision() deprecated");return!1};a.Tz=function(){K.error("check_collision_any() deprecated");return!1};
a.check_ray_hit=function(){K.error("check_ray_hit() deprecated");return!1};a.FB=function(){K.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.j,f=e.F;b=b||"ANY";for(var g=0;g<e.Cc.length;g++){var k=e.Cc[g];if(k.Qb==b&&k.callback==c)return}g=[];a=a.j.F;k=[];u(b,Q,k,null);for(var h=0;h<k.length;h++){var l=k[h];a<l?g.push([a,l]):a>l&&g.push([l,a])}k={Qb:b,callback:c,oj:g,Zp:new Uint8Array(g.length),Dl:d||!1};e.Cc.push(k);y.m(y.yc,f);y.m(y.Sr,g,d)};a.remove_collision_test=
function(a,b,c){a=a.j;b=b||"ANY";for(var d=0;d<a.Cc.length;d++){var e=a.Cc[d];if(e.Qb==b&&e.callback==c){a.Cc.splice(d,1);d--;for(var e=e.oj,f=Q.j.l,g=0;g<f.length;g++)for(var k=f[g].gb,h=0;h<k.Cc.length;h++)for(var l=k.Cc[h],n=0;n<l.oj.length;n++)for(var m=l.oj[n],r=0;r<e.length;r++){var p=e[r];m[0]===p[0]&&m[1]===p[1]&&(e.splice(r,1),r--)}e.length&&y.m(y.ls,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.j;c?(y.m(y.$r,c.F),c.Di=b):K.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=
function(a){var b=a.j;b?(y.m(y.es,b.F),b.Di=null):K.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.j;if(g){a=g.F;b=b||"ANY";c={G:new Float32Array(c),V:new Float32Array(d),local:e,callback:f,Qb:b,yd:{}};u(b,Q,null,c.yd);delete c.yd[a];for(var k in c.yd)c.yd[k]=1;g.de.push(c);z(a,g.de)}else K.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.j){a=b.F;for(var f=0;f<b.de.length;f++){var g=b.de[f];G.Ci(g.G,c)&&G.Ci(g.V,d)&&
g.local==e&&(b.de.splice(f,1),f--)}z(a,b.de)}else K.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.f;c.Uf=b;F(a,c)};a.vehicle_steer=function(a,b){var c=a.f;c.vg=b;F(a,c)};a.vehicle_brake=function(a,b){var c=a.f;c.Wg=b;F(a,c)};a.is_vehicle_chassis=p;a.is_vehicle_hull=B;a.pw=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.ow=function(a){return a.b4w_vehicle?
"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.sw=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.np=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.mp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.op=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.f.speed};a.lz=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=e;a.YA=t;a.CA=function(){return 0};a.Du=function(){y.m(y.fs)};a.kx=function(a){var b=R.indexOf(a);-1!=b?(R.splice(b,1),a=T.indexOf(a),-1!=a&&T.splice(a,1)):K.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,q){function c(a,b){for(var c=Y(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}Wa[b.id]=null;cb[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ka.Ro(a));d=a.width;a=a.height;ha.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ub)&&c&&ha.warn("B4W Warning: image",b,"is not from app root.")}function g(a,b,c,d,e,f){d=b.q;if(!d)throw"Nothing requested";ea.enqueue([[d,ea.AT_JSON,
d]],function(d,f,g,k){if(d){ha.log("%cLOAD METADATA","color: #616",k);f=d.b4w_format_version;if(Number(f)<Ra.zp)throw"Incompatible file version: "+f+". Required: "+Ra.zp;for(var h in d)a[h]=d[h];(d=a.binaries[0].binfile)?b.nn=d:(S.bm(b,"load_binaries"),S.bm(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)ha.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)ha.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=R(b.q)+b.nn;if(!d)throw"Binary data is missing";ea.enqueue([[d,ea.AT_ARRAYBUFFER,d]],function(d,f,g,k){d&&(ha.log("%cLOAD BINARY","color: #616",k),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function m(a,b,c,d,e){d=a.bin_data;var g=a.binaries[0],k=a.objects,h=a.meshes;a=a.actions;for(var A=Da.Ht(),l=["indices"],n=["normal","tangent"],m=["color","group"],r=["position","texcoord","texcoord2"],p=0;p<h.length;p++)for(var v=h[p].submeshes,
da=0;da<v.length;da++)for(var s in v[da]){var u=v[da][s][1];if(-1!=l.indexOf(s)){var t=4*v[da][s][0]+g["int"],w=v[da],S=s,I=d;if(A)var fa=new Uint32Array(I,t,u);else for(var fa=new Uint32Array(u),I=new DataView(I),q=0;q<u;q++)fa[q]=I.getUint32(t+4*q,!0);w[S]=fa}else if(-1!=r.indexOf(s))t=4*v[da][s][0]+g["float"],v[da][s]=f(d,t,u,A);else if(-1!=n.indexOf(s)){t=2*v[da][s][0]+g["short"];w=v[da];S=s;I=d;fa=new Float32Array(u);I=new DataView(I);for(q=0;q<u;q++)fa[q]=I.getInt16(t+2*q,!0)/32767;w[S]=fa}else if(-1!=
m.indexOf(s)){t=2*v[da][s][0]+g.ushort;w=v[da];S=s;I=d;fa=new Float32Array(u);I=new DataView(I);for(q=0;q<u;q++)fa[q]=I.getUint16(t+2*q,!0)/65535;w[S]=fa}}for(s=0;s<k.length;s++)for(h=k[s].particle_systems,l=0;l<h.length;l++)n=h[l],n.transforms=f(d,4*n.transforms[0]+g["float"],n.transforms[1],A);for(k=0;k<a.length;k++){s=a[k];var h=s.fcurves,n=s.frame_range,l=n[0],n=n[1],m=ma.Av(l,n),r=null,v=p=!1,ga;for(ga in h)p|=-1<ga.indexOf("rotation_euler"),v|=-1<ga.indexOf("rotation_quaternion");for(ga in h)if(p&&
v&&-1<ga.indexOf("rotation_euler"))delete h[ga];else{var da=h[ga],z;for(z in da)u=da[z],t=f(d,g["float"]+4*u.bin_data_pos[0],u.bin_data_pos[1],A),w=new Float32Array(m),null===r&&(r=new Int8Array(m)),ma.kt(u,t,w,r,l,n),u.Pb=w;-1<ga.indexOf("rotation_euler")&&ma.av(h,ga)}s.Hs=r}e(b,c)}function f(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function h(a,b,c,d,e){var f=a.cameras,g=a.groups,k=a.materials,h=
a.meshes,A=a.node_groups,l=a.objects,n=a.particles,m=a.scenes,r=a.speakers,p=a.textures,v=a.worlds;A||(ha.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),A=a.node_groups=[]);for(var s="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),t={},S=0;S<s.length;S++)for(var I=a[s[S]],q=0;q<I.length;q++){var fa=I[q];t[fa.uuid]=fa}for(var z=0;z<m.length;z++){for(var x=m[z],ea=x.objects,
U=0;U<ea.length;U++)u(ea,U,t);x.camera&&u(x,"camera",t);x.world&&u(x,"world",t)}for(z=0;z<g.length;z++)for(var B=g[z].objects,U=0;U<B.length;U++)u(B,U,t);for(z=0;z<l.length;z++){var D=l[z];D.dupli_group&&u(D,"dupli_group",t);D.parent&&u(D,"parent",t);if(D.animation_data){var F=D.animation_data;F.action&&u(F,"action",t);if(F.nla_tracks)for(U=0;U<F.nla_tracks.length;U++)for(var ba=F.nla_tracks[U],G=0;G<ba.strips.length;G++)ba.strips[G].action&&u(ba.strips[G],"action",t)}switch(D.type){case "MESH":if(!D.data)throw"mesh not found for object "+
D.name;u(D,"data",t);for(var va=D.modifiers,U=0;U<va.length;U++){var Qa=va[U];"ARMATURE"==Qa.type?u(Qa,"object",t):"CURVE"==Qa.type&&u(Qa,"object",t)}var E=D.particle_systems;if(E)for(U=0;U<E.length;U++)u(E[U],"settings",t);break;case "ARMATURE":u(D,"data",t);for(var K=D.pose.bones,ka=D.data.bones,U=0;U<K.length;U++){var H=K[U];H.bone=ka[H.bone];for(var qa=H.parent_recursive,G=0;G<qa.length;G++)qa[G]=K[qa[G]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":u(D,"data",t)}var N=D.constraints;
if(N)for(U=0;U<N.length;U++){var V=N[U];V.target&&u(V,"target",t)}var P=D.lod_levels;if(P)for(U=0;U<P.length;U++){var M=P[U];M.object&&u(M,"object",t)}}for(z=0;z<h.length;z++)for(var O=h[z].materials,U=0;U<O.length;U++)u(O,U,t);for(z=0;z<k.length;z++){for(var Q=k[z],R=Q.texture_slots,U=0;U<R.length;U++)u(R[U],"texture",t);var T=Q.node_tree;T&&w(T,t)}for(z=0;z<A.length;z++)(T=A[z].node_tree)&&w(T,t);for(z=0;z<p.length;z++){var Z=p[z],Xa=Z.type;"IMAGE"!=Xa&&"ENVIRONMENT_MAP"!=Xa||u(Z,"image",t)}for(z=
0;z<f.length;z++){var cb=f[z];cb.dof_object&&u(cb,"dof_object",t)}for(z=0;z<r.length;z++){var aa=r[z];aa.sound&&u(aa,"sound",t);if(aa.animation_data&&(F=aa.animation_data,F.action&&u(F,"action",t),F.nla_tracks))for(U=0;U<F.nla_tracks.length;U++)for(ba=F.nla_tracks[U],G=0;G<ba.strips.length;G++)ba.strips[G].action&&u(ba.strips[G],"action",t)}for(z=0;z<n.length;z++){for(var C=n[z],R=C.texture_slots,U=0;U<R.length;U++)u(R[U],"texture",t);C.dupli_group&&u(C,"dupli_group",t);C.dupli_object&&u(C,"dupli_object",
t)}for(z=0;z<v.length;z++)if(R=v[z].texture_slots)for(U=0;U<R.length;U++)u(R[U],"texture",t);la.Gt(a);Ca=0===b.id;ya||(ya=a.scenes[0]);for(var Wa=a.textures,ja=Ca?a.scenes[0].b4w_anisotropic_filtering:ya.b4w_anisotropic_filtering,xa=0;xa<Wa.length;xa++)Ca||"SCENE"!=Wa[xa].b4w_source_type||(Wa[xa].b4w_source_id=""),Ma.uu(Wa[xa],ja,a.scenes);for(var bb={},X=a.objects,za=0;za<X.length;za++){var mb=X[za];if("MESH"===mb.type&&!mb.particle_systems.length)for(var Pb=mb.data,rb=Pb.name,Qb=Pb.submeshes,xb=
Pb.materials,Gb=0;Gb<Qb.length;Gb++)0!==Qb[Gb].base_length||bb[rb]||(xb[Gb]?ha.warn('B4W Warning: material "'+xb[Gb].name+'" is not assigned to any face (object "'+mb.name+'").'):ha.warn('B4W Warning: Mesh "'+Pb.name+'" has no faces (object "'+mb.name+'").'),bb[rb]=!0)}for(var Rb=a.meshes,Aa=0;Aa<Rb.length;Aa++){var ub=Rb[Aa];ub.materials.length||ub.uv_textures.length&&ha.warn('B4W Warning: mesh "'+ub.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,
diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var cc=a.meshes,ua=Da.keysearch("name","DEFAULT",a.materials),zb=0;zb<cc.length;zb++){var Ea=cc[zb];0==Ea.materials.length&&Ea.materials.push(ua)}for(var db=a.actions,Ib=b.id,Sa=0;Sa<db.length;Sa++){var ob=db[Sa];ob.Js=Ib;ma.Us(ob)}for(var Jb=a.scenes,sb=0;sb<Jb.length;sb++){for(var gc=Jb[sb],wc=J.Ak(gc,"ALL"),xc=[],yb=0;yb<wc.length;yb++)for(var Kb=wc[yb].particle_systems,Lb=0;Lb<Kb.length;Lb++){var ib=Kb[Lb].settings;if("HAIR"==ib.type)if("OBJECT"==ib.render_type)da.um(ib.dupli_object,!0);else if("GROUP"==
ib.render_type){for(var Tb=ib.dupli_group,yc=J.Ak(gc,"EMPTY"),jb=0;jb<yc.length;jb++)yc[jb].dupli_group==Tb&&xc.push(yc[jb]);for(jb=0;jb<Tb.objects.length;jb++)da.um(Tb.objects[jb],!0)}else ha.warn("B4W Warning: render type",ib.render_type,"not supported for particle systems ("+ib.name+").")}for(yb=0;yb<xc.length;yb++)L(xc[yb],[gc])}W(a,b.id);for(var zc=a.scenes,Uc=0;Uc<zc.length;Uc++){for(var ld=zc[Uc],hc=[],qc=[],Gc=zc[Uc].objects,tb=0;tb<Gc.length;tb++){var Ac=Gc[tb];y(Gc,Ac,hc,qc);var Vc=Ac.dupli_group;
if(Vc)for(var rc=Vc.objects,Hc=0;Hc<rc.length;Hc++)y(rc,rc[Hc],hc,qc)}for(tb=0;tb<qc.length;tb++)L(qc[tb],[ld]);for(tb=0;tb<hc.length;tb++)Da.ht(hc[tb][0],hc[tb][1])}W(a,b.id);for(var Oa=Y(a,b.id),xa=0;xa<Oa.length;xa++){var sc=Oa[xa];!Ca&&sc.parent&&-1<Yb.indexOf(sc.parent.type)&&(sc.parent="");da.um(sc,!1);sc.d.jd=b.id}for(var Ic=0;Ic<Oa.length;Ic++){var tc=Oa[Ic];if("MESH"==tc.type){var Wc=ma.get_first_armature_object(tc);if(Wc){var Bc=Wc.d;if(Bc.Hd){var Jc=tc.d.gc,Xc=[],Kc;for(Kc in Jc){var kd=
Jc[Kc];Xc.push(4*kd.fh,4*kd.sn)}Bc.yp.push(Xc)}Bc.Dj.push(tc.d)}}}for(var Yc=-1,bc=0;bc<Oa.length;bc++){var jc=Oa[bc],Ub=jc.d;if(Da.sc(jc)&&Ub.uh){var Lc=Ub.max_bones;Lc>Yc&&(Yc=Lc)}}for(bc=0;bc<Oa.length;bc++)if(jc=Oa[bc],Ub=jc.d,Da.sc(jc)&&Ub.uh){Ub.max_bones=Yc;var Cc=jc,Zc=Ub.max_bones,ed=Ra.max_bones,Mc=Cc.d;Zc>2*ed?Da.da('B4W Error: too many bones for "'+Cc.name+'"'):Zc>ed?(ha.warn('B4W Warning: too many bones for "'+Cc.name+'" / '+Zc+" bones (max "+ed+"). Blending between frames will be disabled."),
Mc.lh=!1):Mc.lh=!0;Mc.lh=Mc.lh&&!Va.zo}for(var $c=0;$c<Oa.length;$c++){var ic=Oa[$c];if(Da.sc(ic)){var pd=ic.lod_levels.length;if(pd)for(var dd=ic,Dc=0;Dc<pd;Dc++){var Nc=ic.lod_levels[Dc].object;if(!Nc){dd.d.bj=!0;dd.d.Zd=ic.lod_levels[Dc].distance;break}Nc.d.gf=ic.d.gf;dd.d.Zd=ic.lod_levels[Dc].distance;Nc.d.yh=ic.lod_levels[Dc].distance;if(ic.lod_levels[Dc+1])Nc.d.Zd=ic.lod_levels[Dc+1].distance;else{Nc.d.bj=!0;Nc.d.Zd=1E4;break}dd.d.bj=!1;dd=Nc}}}for(var md=0;md<Oa.length;md++){var ia=Oa[md];
if(ia.b4w_vehicle){var Pa=ia.b4w_vehicle_settings;if("CHASSIS"==Pa.part){ia.f={};ia.f.yo=Pa.force_max;ia.f.tn=Pa.brake_max;ia.f.uy=Pa.suspension_compression;ia.f.wy=Pa.suspension_stiffness;ia.f.vy=Pa.suspension_damping;ia.f.kz=Pa.wheel_friction;ia.f.pB=Pa.roll_influence;ia.f.Gw=Pa.max_suspension_travel_cm;ia.f.Uf=0;ia.f.Wg=1;ia.f.vg=0;ia.f.speed=0;ia.f.tf=[];ia.f.Lh=[];ia.f.wg=null;for(var qd=ia.Cb?ia.Cb.dupli_group.objects:Oa,Oc=0;Oc<qd.length;Oc++){var Ha=qd[Oc];if(Ha.b4w_vehicle){var Za=Ha.b4w_vehicle_settings;
if(ga.pw(Ha)&&Pa.name==Za.name){var rd=ga.lz(Ha.b4w_vehicle_settings.part);ia.f.tf[rd]=Ha;ia.f.Lh[rd]=new Float32Array(8)}else if(ga.np(Ha)&&Pa.name==Za.name){ia.f.wg=Ha;ia.f.jm=Za.steering_max;ia.f.Oq=Za.steering_ratio;ia.f.jp=Za.inverse_control;var nb=kb.invert(ia.d.H,new Float32Array(16)),fd=kb.multiply(nb,Ha.d.H,nb);ia.f.Qq=fd;var Pc=new Float32Array([1,0,0,0]);ab.transformMat4(Pc,fd,Pc);ia.f.Pq=Pc}else if(ga.mp(Ha)&&Pa.name==Za.name){ia.f.gm=Ha;ia.f.Hq=Za.speed_ratio;ia.f.Al=Za.max_speed_angle;
var nb=kb.invert(ia.d.H,new Float32Array(16)),gd=kb.multiply(nb,Ha.d.H,nb);ia.f.Jq=gd;var Qc=new Float32Array([1,0,0,0]);ab.transformMat4(Qc,gd,Qc);ia.f.Iq=Qc}else if(ga.op(Ha)&&Pa.name==Za.name){ia.f.mm=Ha;ia.f.eo=Za.delta_tach_angle;var nb=kb.invert(ia.d.H,new Float32Array(16)),hd=kb.multiply(nb,Ha.d.H,nb);ia.f.Xq=hd;var Rc=new Float32Array([1,0,0,0]);ab.transformMat4(Rc,hd,Rc);ia.f.Wq=Rc}}}if(4!=ia.f.tf.length)throw"Not enough wheels for chassis "+ia.name;}else if("HULL"==Pa.part){ia.f={};ia.f.tf=
[];ia.f.Lh=[];ia.f.yo=Pa.force_max;ia.f.tn=Pa.brake_max;ia.f.Tk=Pa.floating_factor;ia.f.Cm=Pa.water_lin_damp;ia.f.Dm=Pa.water_rot_damp;ia.f.Uf=0;ia.f.Wg=1;ia.f.vg=0;ia.f.speed=0;ia.f.wg=null;for(var sd=ia.Cb?ia.Cb.dupli_group.objects:Oa,Oc=0;Oc<sd.length;Oc++)Ha=sd[Oc],Ha.b4w_vehicle&&(Za=Ha.b4w_vehicle_settings,ga.ow(Ha)&&Pa.name==Za.name?(ia.f.tf.push(Ha),ia.f.Lh.push(new Float32Array(8))):ga.np(Ha)&&Pa.name==Za.name?(ia.f.wg=Ha,ia.f.jm=Za.steering_max,ia.f.Oq=Za.steering_ratio,ia.f.jp=Za.inverse_control,
nb=kb.invert(ia.d.H,new Float32Array(16)),fd=kb.multiply(nb,Ha.d.H,nb),ia.f.Qq=fd,Pc=new Float32Array([1,0,0,0]),ab.transformMat4(Pc,fd,Pc),ia.f.Pq=Pc):ga.mp(Ha)&&Pa.name==Za.name?(ia.f.gm=Ha,ia.f.Hq=Za.speed_ratio,ia.f.Al=Za.max_speed_angle,nb=kb.invert(ia.d.H,new Float32Array(16)),gd=kb.multiply(nb,Ha.d.H,nb),ia.f.Jq=gd,Qc=new Float32Array([1,0,0,0]),ab.transformMat4(Qc,gd,Qc),ia.f.Iq=Qc):ga.op(Ha)&&Pa.name==Za.name&&(ia.f.mm=Ha,ia.f.eo=Za.delta_tach_angle,nb=kb.invert(ia.d.H,new Float32Array(16)),
hd=kb.multiply(nb,Ha.d.H,nb),ia.f.Xq=hd,Rc=new Float32Array([1,0,0,0]),ab.transformMat4(Rc,hd,Rc),ia.f.Wq=Rc))}}}for(var nd=0;nd<Oa.length;nd++){var kc=Oa[nd];if(kc.b4w_floating){var id=kc.b4w_floating_settings;if("MAIN_BODY"==id.part){kc.qc={};kc.qc.Tk=id.floating_factor;kc.qc.Cm=id.water_lin_damp;kc.qc.Dm=id.water_rot_damp;kc.qc.vi=[];for(var td=kc.Cb?kc.Cb.dupli_group.objects:Oa,od=0;od<td.length;od++){var ad=td[od];if(ad.b4w_floating){var ud=ad.b4w_floating_settings;ga.sw(ad)&&id.name==ud.name&&
(kc.qc.vi.push(ad),ad.wt=ad.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function k(a,b,c,d,e){!Ca&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],ha.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==Va.ua&&Ca&&(Va.ua=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(Ca&&!f.camera)throw"Scene check failed: No camera";for(var g=J.Ak(f,"MESH"),k=0;k<g.length;k++){var h=g[k],A=la.it(h);A&&(a.meshes.push(A),h.data=A)}for(var k=
Y(a,b.id),h=a.meshes,A=h.slice(0),l=0;l<k.length;l++){var n=k[l];"MESH"==n.type&&(n=A.indexOf(n.data),-1<n&&A.splice(n,1))}for(l=0;l<A.length;l++)h.splice(h.indexOf(A[l]),1);Ca?(J.Zs(f,a.textures),f.d.Kg.length&&(b.jl=!0),xa.enabled&&f.b4w_enable_physics&&ga.en(f),f.b4w_enable_audio&&ba.fn(f),k=J.dl(f),h=f.b4w_batch_grid_size):(J.et(f,ya,a.textures),xa.enabled&&f.b4w_enable_physics&&!ya.j&&ga.en(ya),f.b4w_enable_audio&&!ya.g&&ba.fn(ya),k=J.dl(ya),h=ya.b4w_batch_grid_size);g=v.rv(k,h,g,f.world,ya.d.rl);
Ca?(J.Ym(f,g),J.lv(k)):J.Ym(ya,g)}d=a.materials;if(cc.Kk&&Ra.hr)for(a=0;a<d.length;a++){f=d[a];h=f.texture_slots;for(g=0;g<h.length;g++)if(A=h[g],l=A.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)k=l.image,k.ec||(-1<k.filepath.indexOf(".dds")?k.ec=!0:(k.ec=!l.b4w_disable_compression&&!A.use_map_normal&&"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=k.source,k.ec&&(k.filepath+=".dds")));if(g=f.node_tree)for(h=g.nodes,g=0;g<h.length;g++)k=h[g],"TEXTURE"==k.type&&((A=k.texture)?(k=A.image)&&
!k.ec&&(k.ec=A.d.ni&&!A.b4w_disable_compression&&"MOVIE"!=k.source,k.ec&&(k.filepath+=".dds")):ha.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.ec=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function l(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},k={},h={},A=0;A<d.length;A++){var l=d[A];f[l.uuid]=l;k[l.uuid]=l}for(A=0;A<a.length;A++)l=a[A],g[l.uuid]=l,h[l.uuid]=l;s(a,null,h,k);for(var n in k)n in f||d.push(k[n]);
for(n in h)n in g||a.push(h[n]);e(b,c)}function s(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],k=c[g.uuid];if(g=k.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var h=c[g.uuid],l=h.constraints,g=0;g<l.length;g++){var m=Da.Ie(l[g]);m.name+="_CLONE";k.constraints.push(m)}"b4w_proxy_inherit_anim"in k&&!k.b4w_proxy_inherit_anim||(k.animation_data&&(h.animation_data=Da.Ie(k.animation_data)),h.b4w_use_default_animation=k.b4w_use_default_animation,h.b4w_auto_skel_anim=k.b4w_auto_skel_anim,h.b4w_anim_behavior=
k.b4w_anim_behavior,h.b4w_cyclic_animation=k.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)k=Da.el(a,"uuid",e[f]),-1<k&&a.splice(k,1);e={};for(f=0;f<a.length;f++)g=a[f],k=c[g.uuid],b&&(l=Da.Ie(k),k="origin_name"in k?k.origin_name:k.name,l.name=b+"*"+k,l.origin_name=k,n(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),k=c[g.uuid],k.dupli_group&&(g=k.dupli_group,l=d[g.uuid],h=Da.Ie(l),h.name=Da.Lj(l.name+"_CLONE"),h.uuid=A.bp("Group"+h.name),d[h.uuid]=h,g.uuid=h.uuid,s(h.objects,k.name,c,d));if(b)for(f=
0;f<a.length;f++){g=a[f];k=c[g.uuid];k.parent&&k.parent.uuid in e?k.parent.uuid=e[k.parent.uuid]:k.parent&&(ha.warn("B4W Warning: Object's \""+k.name+'" parent is not in dupli group. Disabling parenting.'),k.parent=null);l=k.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=k.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((k=k.lod_levels)&&k.length)for(g=0;g<k.length;g++)b=k[g],b.object&&
b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var r in e)zb[r]=e[r]}function n(a){a.uuid=A.bp("Object"+a.name)}function w(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&u(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in zb&&(e.lamp.uuid=zb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&u(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];z(f,"from_node",c);z(f,"to_node",c);F(f,"from_socket",f.from_node.outputs);
F(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&u(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&u(e.strips[f],"action",b)}function u(a,b,c){(c=c[a[b].uuid])||ha.error("Dangling link found:",b,a);a[b]=c}function z(a,b,c){c=Da.keysearch("name",a[b].name,c);a[b]=c}function F(a,b,c){c=Da.keysearch("identifier",a[b].identifier,c);a[b]=c}function p(a,c,d,e,f,g){if(!Ra.do_not_load_resources){for(var k=
R(c.q),h=a.images,A={},l=[],n=0;n<h.length;n++){var m=h[n],r=m.uuid;if("FILE"===m.source||"MOVIE"===m.source){var p=B(m,a.textures);if(!p.length)ha.warn("B4W Warning: image ",m.name," has no users.");else if(!(p[0].b4w_shore_dist_map||"MOVIE"===m.source&&Ra.vo)){p=ja(k+m.filepath);if("FILE"===m.source){var v=m.ec?ea.AT_ARRAYBUFFER:ea.AT_IMAGE_ELEMENT;cc.Bl&&Ra.Rj&&(p=ea.Ej(p),"dds"==p[1]?(p=ea.Ej(p[0]),p=p[0]+".min50."+p[1]+".dds"):p=p[0]+".min50."+p[1])}else"MOVIE"!==m.source||Ra.cp||(p=ea.Ej(p),
v=ba.detect_video_container(p[1]),p=v!=p[1]?p[0]+".lossconv."+v:p[0]+"."+v,v=ea.Xj);l.push([r,v,p,m.name]);A[r]=m}}}l.length?(e.dp=0,ea.enqueue(l,function(f,k,h,n){if(f){if(h==ea.Xj){h=f.videoWidth;var m=f.videoHeight;ha.log("%cLOAD VIDEO "+h+"x"+m,"color: #"+(2048<h||2048<m?"a00":1024<h||1024<m?"aa0":"0a0"),n);-1==n.indexOf(ub)&&ha.warn("B4W Warning: video",n,"is not from app root.")}else b(f,n,!0);k=A[k];n=B(k,a.textures);for(h=0;h<n.length;h++)m=n[h],Ma.Pj(m.d,f,k.ec,m.image.filepath)}f=++e.dp/
l.length;g(c,d,f)},function(){ha.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):f(c,d)}}function B(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function e(a,b,c,d,e,f){if(!Ra.do_not_load_resources){a=Y(a,b.id);for(var g=R(b.q),k=[],h={},A=0;A<a.length;A++){var l=a[A];if(t(l)){var n=l.data.sound,m=n.uuid;"BACKGROUND_MUSIC"==ba.fl(l)?(m=Da.kv(),b.il=!0):"NONE"!=ba.fl(l)&&Ra.gp&&(b.ll=!0);if(!(m in h)){h[m]=[];n=ja(g+n.filepath);switch(ba.Fq(l)){case ba.Wj:var r=
ea.AT_AUDIOBUFFER;break;case ba.Gm:r=ea.AT_AUDIO_ELEMENT}var n=ea.Ej(n),p=ba.detect_audio_container(n[1]);if(p!=n[1]){if(I.ml()){S.bm(b,"load_speakers");return}n=n[0]+".lossconv."+p}else n=n[0]+"."+p;k.push([m,r,n])}h[m].push(l)}}k.length?ea.enqueue(k,function(a,e,g,A){if(a)for(ha.log("%cLOAD SOUND","color: #0aa",A),-1==A.indexOf(ub)&&ha.warn("B4W Warning: sound",A,"is not from app root."),e=h[e],g=0;g<e.length;g++)ba.Ty(e[g],a);a=++d.ay/k.length;f(b,c,a)},function(){ha.log("%cLOADED ALL SOUNDS",
"color: #0aa");e(b,c)}):e(b,c)}}function t(a){return ba.Yd(a)&&ba.Fq(a)!=ba.Hm?!0:!1}function x(a,b){for(var c=J.la(a,"SPEAKER",J.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];ba.Yd(e)&&(ba.is_cyclic(e)||b)&&ba.play_def(e)}}function K(a){a=a.d.Kg;for(var b=0;b<a.length;b++)a[b].d.wa&&a[b].use_auto_refresh&&a[b].d.wa.play()}function H(a,b,c,d,e){va.start();ha.log("%cSTART NLA","color: #0a0");e(b,c)}function y(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=
b.lod_levels[f],k=g.object;if(k){var h=Da.Zg(k);h.name=b.name+"_LOD_"+String(f+1);n(h);h.lod_levels=[];c.push([a,h]);d.push(k);g.object=h}}}function L(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function r(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=Ca?f.b4w_enable_physics:ya.b4w_enable_physics||f.b4w_enable_physics;Ca||(f=ya);for(var k=
0;k<db.length;k++)for(var h=J.la(f,db[k],J.DATA_ID_ALL),A=0;A<h.length;A++){var l=h[A];l.d.jd==b.id&&xa.enabled&&g&&(ga.append_object(l,f),b.vp&&ga.has_physics(l)&&ga.disable_simulation(l))}}e(b,c)}function D(a,c,d,e,f){var g={};e=[];for(var k=a.scenes,h=0;h<a.scenes.length;h++){var A=k[h];if(A.d.Ba&&(A=A.d.Ba.Cj)&&"FILE"===A.source){var l=A.uuid,n=ja(R(c.q)+A.filepath);e.push([l,A.ec?ea.AT_ARRAYBUFFER:ea.AT_IMAGE_ELEMENT,n,A.name]);g[l]=A}}e.length?ea.enqueue(e,function(c,d,e,f){if(c){b(c,f,!0);
d=g[d];f=B(d,a.textures);for(e=0;e<f.length;e++){var h=f[e];Ma.Pj(h.d,c,d.ec,h.image.filepath)}for(e=0;e<k.length;e++)if(f=k[e],f.d.Ba.Cj===d){var A=c,l=d,n=document.createElement("canvas"),h=l.size[0],l=l.size[1];n.width=h;n.height=l;n=n.getContext("2d");n.drawImage(A,0,0);A=n.getImageData(0,0,h,l).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var h=h*l,l=new Float32Array(h),m=0;m<h;m++)l[m]=n[1]*A[4*m+2]+n[2]*A[4*m+3];f.d.Zl=l}}},function(){f(c,d)}):f(c,d)}function G(a,
c,d,e,f){if(Ra.antialiasing&&Ra.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],k=0;k<g.length;k++){var h=J.ga(e,g[k]);h&&a.push(h)}if(a.length){e=[];k=ea.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",k,I.yb.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",k,I.yb.smaa_area_texture_path,"smaa_area_texture"]);for(k=0;k<a.length;k++)if(g=a[k],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.Z;
for(k=0;k<a.length;k++)if(g=a[k],"u_search_tex"==g.V)var A=g.na;else if("u_area_tex"==g.V)var l=g.na;break}e.length?ea.enqueue(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?A:l,c.source="IMAGE",c.kn=!0,Ma.Pj(c,a,-1!=e.indexOf(".dds")?1:0,e),Ma.Aj(c,Ma.s,Ma.s))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function V(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];Ca||(e=ya);for(var f=J.la(e,"ALL",J.DATA_ID_ALL),g=0;g<f.length;g++){var k=f[g];k.d.jd==b.id&&(b.vp&&J.hide_object(k),
d.Zm.push({vx:e,obj:k}))}}}function N(a,b,c,d,e,f){a=d.Zm;var g=d.Hp;a.length?(e=a[g].obj,g=a[g].vx,J.append_object(g,e),-1!=ob.indexOf(e.type)&&g.b4w_enable_audio&&ba.append_object(e,g),d=++d.Hp/a.length):d=1;f(b,c,d)}function Z(a,b,c,d,e){if(Ca){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];J.Zx(f);J.Sy(f);(f.bk||0==d)&&J.$w(f);f.b4w_use_nla&&va.Qy(f,f.b4w_nla_cyclic)}J.set_active(a.scenes[0])}else J.gr(ya);a=Y(a,b.id);da.Py(a);e(b,c)}function P(a,b,c,d,e){if(Ca)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||
K(a.scenes[d]),x(a.scenes[d]);else a.scenes[0].b4w_use_nla||K(ya),x(ya);e(b,c);if(Ra.Cq)for(a=a.scenes,d=0;d<a.length;d++)J.set_sky_params(a[d],{})}function M(a,b,c,d,e){Ra.Ze&&(b.jl||b.il||b.ll)?za||O(a,e,b,c):e(b,c)}function O(a,b,c,d){var e=Sa.canvas.parentElement;Ea=e.style.zIndex;e.style.zIndex="999";za=document.createElement("div");za.style.position="relative";za.style.height="88px";za.style.width="88px";var f=Math.round(Sa.canvas.offsetWidth/2-44);za.style.top=Math.round(Sa.canvas.offsetHeight/
2-44).toString()+"px";za.style.left=f.toString()+"px";za.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
ua=document.createElement("div");ua.style.position="relative";ua.style.height=Sa.canvas.offsetHeight.toString()+"px";ua.style.width=Sa.canvas.offsetWidth.toString()+"px";ua.style.background="rgba(0, 0, 0, 0.5)";ua.style.zIndex="999";e.appendChild(ua);ua.appendChild(za);za.addEventListener("click",function(){c.jl&&(Ma.play(),Ma.pause(),Ma.reset());if(c.il){if(Ca)for(var e=0;e<a.scenes.length;e++)x(a.scenes[e],!0);else x(ya,!0);ba.pause()}c.ll&&ba.Ww();Q();b(c,d)},!1)}function Q(){if(za){var a=Sa.canvas.parentElement;
a.style.zIndex=Ea;ua.removeChild(za);a.removeChild(ua);za=ua=null;Ea=0}}function R(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function T(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function ja(a){var b=a.split("://",2);
return 1<b.length?(b[1]=T(b[1]),b.join("://")):T(a)}function Y(a,b){cb[b]||W(a,b);return cb[b]}function W(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)E(c[e].objects,0,d);cb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],k=0;k<g.length;k++)cb[b].push(g[k])}function E(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=aa(f);d[g]=d[g]||[];(Ca||-1==Yb.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&E(f.objects,b+1,c)}}function aa(a){return(a=
a.parent||ma.get_first_armature_object(a))?1+aa(a):0}var ma=q("__animation"),v=q("__batch"),I=q("__config"),U=q("__controls"),ka=q("__dds"),fa=q("__extensions");q("__lights");var S=q("__loader"),ea=q("__assets"),A=q("__md5"),da=q("__objects"),ga=q("__physics"),ha=q("__print"),la=q("__reformer"),Qa=q("__renderer"),J=q("__scenes"),va=q("__nla"),ba=q("__sfx"),qa=q("__shaders"),Ma=q("__textures"),Xa=q("__nodemat"),Da=q("__util"),ab=q("vec4"),kb=q("mat4"),Ra=I.n,cc=I.ad,xa=I.gb,Va=I.Jd,bb=I.Ad,Wa=null,
cb=null,ub="",Ca=!1,ya=null,zb={},za=null,ua=null,Ea=0,Yb=["LAMP","CAMERA"],db=["MESH","CAMERA","EMPTY"],ob=["SPEAKER"],Sa=null;a.is_primary_loaded=function(a){return S.is_primary_loaded(a)};a.update=function(){S.Ry(Wa)};a.Xb=function(a){Sa=a};a.Oy=function(a,b){if(za){ua.style.height=b.toString()+"px";ua.style.width=a.toString()+"px";var c=Math.round(a/2-44);za.style.top=Math.round(b/2-44).toString()+"px";za.style.left=c.toString()+"px"}};a.load=function(a,b,f,A,n){var v={load_main:{Ga:S.ve,Sa:!1,
B:[],Ua:!1,ib:500,qb:!1,Ja:g},duplicate_objects:{Ga:S.zc,Sa:!1,B:["load_main"],Ua:!1,ib:50,qb:!1,Ja:l},load_binaries:{Ga:S.ve,Sa:!1,B:["load_main"],Ua:!1,ib:500,qb:!1,Ja:d},prepare_bindata:{Ga:S.zc,Sa:!1,B:["duplicate_objects","load_binaries"],Ua:!1,ib:0,qb:!1,Ja:m},prepare_root_datablocks:{Ga:S.zc,Sa:!1,B:["duplicate_objects","prepare_bindata"],Ua:!1,ib:150,qb:!1,Ja:h},prepare_root_scenes:{Ga:S.zc,Sa:!1,B:["prepare_root_datablocks"],Ua:!1,ib:350,qb:!1,Ja:k},load_smaa_textures:{Ga:S.ve,Sa:!0,B:["prepare_root_scenes"],
Ua:!1,ib:10,qb:!0,Ja:G},load_shoremap:{Ga:S.ve,Sa:!0,B:["prepare_root_scenes"],Ua:!1,ib:10,qb:!0,Ja:D},load_textures:{Ga:S.ve,Sa:!0,B:["prepare_root_scenes"],Ua:!0,ib:500,qb:!1,Ja:p,He:{dp:0}},add_physics_objects:{Ga:S.zc,Sa:!1,B:["load_shoremap"],Ua:!1,ib:20,qb:!1,Ja:r},add_objects:{Ga:S.zc,Sa:!1,B:["add_physics_objects"],Ua:!1,ib:800,qb:!1,Ja:V,Kf:N,Yg:Z,He:{Zm:[],Hp:0}},load_speakers:{Ga:S.ve,Sa:!0,B:["add_objects"],Ua:!0,ib:30,qb:!1,Ja:e,He:{ay:0}},mobile_media_start:{Ga:S.zc,Sa:!Ra.Ze,B:["load_textures",
"load_speakers"],Ua:!0,ib:5,qb:!1,Ja:M,Kf:M},synchronize_media:{Ga:S.zc,Sa:!0,B:["mobile_media_start"],Ua:!0,ib:70,qb:!1,Ja:P},start_nla:{Ga:S.zc,Sa:!0,B:["mobile_media_start"],Ua:!1,ib:5,qb:!1,Ja:H}},da=S.Oo();da||(da=S.mu(),Wa=[],cb=[],zb={});Wa[da.Sc.length]={};return S.vu(v,a,b,f,c,A||bb.hn,Ra.do_not_load_resources,n)};a.unload=function(a){var b=S.Oo();if(!b||!b.Sc.length||a&&!S.yy(b.Sc[a]))ha.error("Unable to unload data!");else{if(0==a)ha.log("%cUNLOAD ALL","color: #00a"),ma.cleanup(),ba.cleanup(),
va.cleanup(),J.cleanup(),S.cleanup(),ga.cleanup(),da.cleanup(),Da.cleanup(),Qa.cleanup(),Xa.cleanup(),qa.cleanup(),U.cleanup(),fa.cleanup(),ea.cleanup(),Ma.cleanup(),cb=null,zb={},Ca=!1,Wa=ya=null;else{ha.log("%cUNLOAD DATA "+a,"color: #00a");ma.jx(a);for(var b=J.Mi(),c=0;c<b.length;c++)for(var d=b[c],e=J.la(d,"ALL",J.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.jd==a){var k=d,h=g;ma.is_animated(h)&&ma.remove(h);J.clear_glow_anim(h);ga.has_physics(h)&&(ga.disable_simulation(h),ga.kx(h));
U.check_sensor_manifold(h)&&U.remove_sensor_manifold(h);J.lx(k,h);ba.Yd(h)&&ba.by(h);e.splice(f,1);k=J.la(d,g.type,J.DATA_ID_ALL);g=k.indexOf(g);-1!=g&&k.splice(g,1)}}}Q()}};a.set_debug_resources_root=function(a){ub=a}};b4w.module.__batch=function(a,q){function c(a){a={type:a,id:0,Sl:0,nf:"",D:[],ac:[],tc:[],Gl:[],fd:[],Af:null,Ra:{},Yb:null,Xa:null,gn:[],Jc:null,bb:null,gc:null,vb:null,ao:!1,num_vertices:0,num_triangles:0,Zi:0,$i:0,Zf:0,Ri:0,gl:0,Ib:new Float32Array(3),Nn:new Float32Array(3),Ec:new Float32Array(16),qa:!1,On:!1,N:!1,mc:!1,ka:!1,zf:!1,md:!1,Nb:!1,Ob:!1,rb:!1,Wb:!1,Mb:!1,uc:!1,ya:!1,fq:!1,ld:O.Og,Ed:O.Zc,Cg:0,om:new Float32Array(2),p:new Float32Array(2),To:!1,Xo:0,Uo:0,Yo:0,Zo:0,Wo:new Float32Array(3),
Vo:new Float32Array(3),Ve:!1,Bc:0,Qd:0,Le:1,Nh:0,Gq:0,rg:1,Fh:0,Ke:0,ye:1,Ep:0,Cl:0,of:0,jq:0,kd:Array(2),lc:new Float32Array(3),Qc:new Float32Array(3),Bd:new Float32Array(3),ob:new Float32Array(4),pd:new Float32Array(4),cg:null,ql:null,ol:null,nl:null,pl:null,re:!1,water_dynamic:!1,Em:!1,pr:!1,qr:0,rr:0,or:0,Uj:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,xo:new Float32Array(2),wo:new Float32Array(2),Uk:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
lf:null,Rl:!1,Rp:0,Np:0,Kl:0,Qp:0,Tp:0,Sp:0,Op:0,Pp:0,Ll:0,Kp:0,Jp:0,Vp:0,Mp:0,nj:new Float32Array(3),Up:new Float32Array(8),Lp:new Float32Array(16)};a.ob[3]=1;a.On=!0;a.N=!0;a.Cg=1;return a}function b(a,b,c){for(var e=[],f=0;f<a.length;f++){var g=a[f],k=g.d,h=m(g.data.b4w_bounding_box),l=g.data.b4w_bounding_cylinder_radius,n=g.data.b4w_bounding_sphere_radius,r=g.data.b4w_bounding_sphere_center,p=g.data.b4w_bounding_ellipsoid_axes,v=g.data.b4w_bounding_ellipsoid_center;if(k.cd){var n=Math.max(Math.abs(h.max_x),
Math.abs(h.min_x)),l=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),s=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),s=Math.sqrt(n*n+l*l+s*s),n=Math.sqrt(n*n+l*l);h.max_x=h.max_y=h.max_z=s;h.min_x=h.min_y=h.min_z=-s;l=n;n=s;r[0]=r[1]=r[2]=0;p[0]=p[1]=p[2]=s;v[0]=v[1]=v[2]=0}k.Db=h;s=N.pk(h,k.H);k.Ia=s;var s=k,u=l;s.nk=N.Un(u,h);s.lk=N.Sn(l,h);s.mk=N.Tn(u,h);r=N.Ek(n,r);k.rc=r;r=N.rk(r,k.H);k.kb=r;p=N.Dk([p[0],0,0],[0,p[1],0],[0,0,p[2]],v);k.Ee=p;p=N.qk(p,k.Tc);k.Fe=p;e=e.concat(d(g,k,b,c))}return e}
function g(a,b,c,e){for(var f=[],g=[],k={},h=0;h<a.length;h++){var l=a[h],n=l.d,r=m(l.data.b4w_bounding_box),p=N.pk(r,n.H),v=N.Ek(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),s=N.rk(v,n.H),u=l.data.b4w_bounding_ellipsoid_axes,u=N.Dk([u[0],0,0],[0,u[1],0],[0,0,u[2]],l.data.b4w_bounding_ellipsoid_center),t=N.qk(u,n.Tc);n.Db=r;n.Ia=p;n.rc=v;n.kb=s;n.Ee=u;n.Fe=t;r={};r.Nb=n.Nb;r.Ob=n.Ob;r.rb=n.rb;r.Kc=n.Kc;r.mj=n.mj;r.Pi=n.Pi;r.Wb=n.Wb;r.Mb=n.Mb;r.uc=n.uc;r.Ge=n.Ge;r.Vc=n.Vc;r.ud=
n.ud;r.xb=n.xb;r.cd=n.cd;r.Vg=n.Vg;r.ya=n.ya;r.Qf=n.Qf;r.Ii=n.Ii;r.md=n.md;p=n.kb.t;r.dw=0==c?[0,0]:[Math.floor(p[0]/c),Math.floor(p[2]/c)];r.Zd=n.Zd;r.yh=n.yh;r.gf=n.gf;n=JSON.stringify(r);k[n]=k[n]||[];k[n].push(l)}for(var w in k){r=JSON.parse(w);c=k[w];var l=T.Fi("STATIC"),S;for(S in r)l[S]=r[S];l.jd=a[0].d.jd;l.Wc=0;l.ue=0;l.Nd=0;l.Md=0;l.Kd=0;l.qh=!1;for(h=0;h<c.length;h++)n=c[h],0==h?(l.Ia=I.ra(n.d.Ia),l.kb=I.ra(n.d.kb),l.Ee=I.ra(n.d.Ee),l.Fe=I.ra(n.d.Fe)):(N.mo(l.Ia,n.d.Ia),N.Tu(l.kb,n.d.kb));
l.Db=I.ra(l.Ia);l.rc=I.ra(l.kb);g.push({Gb:l,vd:c})}for(a=0;a<g.length;a++)for(k=g[a].Gb,h=g[a].vd,w=0;w<h.length;w++){S=h[w];c=d(S,k,b,e);l=H(S.d)||H(k);n={};k.Vc&&(n.au_center_pos=[l[0],l[1],l[2]],n.au_wind_bending_amp=[S.d.Wc],n.au_wind_bending_freq=[S.b4w_wind_bending_freq],n.au_detail_bending_amp=[S.b4w_detail_bending_amp],n.au_detail_bending_freq=[S.b4w_detail_bending_freq],n.au_branch_bending_amp=[S.b4w_branch_bending_amp]);for(r=0;r<c.length;r++)s=c[r].Gb,p=c[r].$b,v=c[r].k,s.Yi?s.cd?O.oy(p,
l):O.Sq(p,l):("COLOR_ID"==v.type?(s=c[r].Gb=S.d,s.type="DYNAMIC",v.nf=S.uuid,B(v,s),y(v,I.Xg(s,0))):p=O.Sq(p,l),O.ny(p,n));f=f.concat(c)}return f}function d(a,b,d,e){var g=[];if(a.b4w_do_not_render)return g;for(var k=f(d,b),l=I.Xg(b,0),n=a.data,m=n.materials,r=0;r<k.length;r++)for(var p=k[r],v=0;v<m.length;v++){var s=m[v];if(("LENS_FLARES"!=s.name||0!=e)&&!O.$o(n,v)){var u=c(p);if(h(u,s,!0)){u.ld=n.ld||O.Og;"COLOR_ID"===p&&u.Nn.set(a.Sm);B(u,b);for(var w=u,S=a.particle_systems,q=0;q<S.length;q++){var fa=
S[q].settings.b4w_vcol_from_name,z=S[q].settings.b4w_vcol_to_name;""!==fa&&""!==z&&(w.Ra[fa]={Se:!1,src:[{name:fa,jc:7}]})}"DYNAMIC"==b.type&&(u.nf=a.uuid);y(u,l);w=O.so(n,v,u.fd,u.gc,u.Ra,u.Af);"LENS_FLARES"==s.name&&(w=ja.Zw(w));g.push({k:u,$b:w,Sb:[s.name],Gb:b,vc:[a]})}}}k=a.particle_systems;if(0<k.length&&g.length){e=!0;for(r=0;r<k.length;r++)if(k[r].settings.use_render_emitter){e=!1;break}r=g[0].k;k=g[0].$b;n=[];m=a.particle_systems;p=a.data;for(v=0;v<m.length;v++)if(s=m[v],u=s.settings,u.count)if("EMITTER"==
u.type){if("DYNAMIC"==b.type){w=c("PARTICLES");S=p.materials;q=s.settings.material-1;q>=S.length&&(P.warn('B4W Warning: Wrong material used for rendering particle system "'+s.name+'"'),q=0);S=S[q];"HALO"===s.settings.render_type&&(w.Ve=!0);h(w,S);B(w,b);q=w;switch(s.settings.b4w_billboard_align){case "VIEW":t(q,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":t(q,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":t(q,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":t(q,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}t(q,"BILLBOARD",0);w.md=!0;w.nf=a.name+"_"+u.uuid;y(w,l);w.Jc=s;u=ja.ov(w,p,s,a.d.Tc);ja.Ex(w,s,S);n.push({k:w,$b:u,Sb:[S.name],Gb:b,vc:[a]})}}else if("HAIR"==u.type){w=I.Vi(s.seed);u.b4w_dynamic_grass&&(b.Qf=!0);if(s.transforms.length)var x=s.transforms;else for(var S=O.al(k,u.count,!1,w),x=new Float32Array(4*S.length),ea=0;ea<S.length;ea++)q=.75+.5*I.kc(w),x[4*ea]=S[ea][0],x[4*ea+1]=S[ea][1],x[4*ea+2]=S[ea][2],x[4*ea+3]=q;S=
E.Ma(d,"GRASS_MAP")?!0:!1;if("OBJECT"==u.render_type)q=[f(d,u.dupli_object.d)],s=K(a,b,r,k,[u.dupli_object],q,[x],u,s,S,w,!1),n=n.concat(s);else if("GROUP"==u.render_type){fa=u.dupli_group.objects;z=!1;q=[];for(ea=0;ea<fa.length;ea++){var D=f(d,u.dupli_group.objects[ea].d);q.push(D)}if(u.use_whole_group){z=x;x=fa;ea={};for(D=0;D<z.length;D+=4)for(var F=0;F<x.length;F++){var G=U.create();U.scale(x[F].d.e,x[F].d.scale,G);var ka=U.clone([z[D],z[D+1],z[D+2]]);U.add(ka,G,ka);ea[F]||(ea[F]=new Float32Array(z.length));
ea[F][D]=ka[0];ea[F][D+1]=ka[1];ea[F][D+2]=ka[2];ea[F][D+3]=z[D+3]}x=ea;z=!0}else if(u.use_group_count){for(var ka=fa,H=u.dupli_weights,ea=w,D={},F=[],G=0;G<ka.length;G++)for(var N=ka[G],N=N.origin_name||N.name,V=0;V<H.length;V++){var L=H[V];N==L.name.split(": ")[0]&&F.push(L)}H.length!=F.length&&P.error("B4W Error: dupli weights match failed");for(G=0;G<x.length;G+=4){var M,H=F;M=[0];for(ka=0;ka<H.length;ka++)M[ka+1]=M[ka]+H[ka].count;H=M[M.length-1]*I.kc(ea);for(ka=N=0;ka<M.length;ka++)if(H>=M[ka]&&
H<M[ka+1]){N=ka;break}M=N;D[M]=D[M]||[];D[M].push(x[G],x[G+1],x[G+2],x[G+3])}for(M in D)D[M]=new Float32Array(D[M]);x=D}else{ea=w;D=fa.length;F={};for(G=0;G<x.length;G+=4){var Q=Math.floor(D*I.kc(ea));F[Q]=F[Q]||[];F[Q].push(x[G],x[G+1],x[G+2],x[G+3])}for(Q in F)F[Q]=new Float32Array(F[Q]);x=F}s=K(a,b,r,k,fa,q,x,u,s,S,w,z);n=n.concat(s)}"INSTANCE"==u.b4w_wind_bend_inheritance&&(a.d.Wc=0)}else throw"Unknown particle settings type";a=n;g=e?a:g.concat(a)}return g}function m(a){return{max_x:a.max_x,min_x:a.min_x,
max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function f(a,b){var c=["MAIN","NODES"];b.Kc&&(E.Ma(a,"COLOR_PICKING")||E.Ma(a,"GLOW_MASK"))&&c.push("COLOR_ID");E.Ma(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(E.Ma(a,"DEPTH")||E.Ma(a,"SHADOW_CAST"))&&c.push("DEPTH");E.Ma(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Ob||b.Mb){var d=null;b.Ob&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Mb)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?I.lt(d,e):e;for(e=0;e<
d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function h(a,b,c){var d,f;switch(a.type){case "MAIN":if(b.b4w_collision||b.use_nodes)a=!1;else{l(a,b);var g=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;a.of=b.offset_z;a.Qc.set([1,1,1]);var h=b.texture_slots;ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);switch(b.name){case "LENS_FLARES":r(a,"special_lens_flares.glslv","special_lens_flares.glslf");e(a,"a_position");
e(a,"a_texcoord");var m=c?[1,1,1,0]:null,m=s(h[0],m);D(a,m);break;default:r(a,"main.glslv","main.glslf");var p=n("use_map_color_diffuse",h),v=n("use_map_color_spec",h),q=n("use_map_normal",h),fa=n("use_map_mirror",h),I=n("use_stencil",h),g=p[0],v=v[0],q=q[0],fa=fa[0],p=p[1],h=I[0]&&n("use_rgb_to_intensity",h)[0];if(g){switch(g.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}m="IMAGE"==g.texture.d.source&&
c?[a.ob[0],a.ob[1],a.ob[2],1]:"ENVIRONMENT_MAP"==g.texture.d.source&&c?[.8,.8,.8,1]:null;m=s(g,m);D(a,m,"u_colormap0");a.Ke=g.diffuse_color_factor;a.ye=g.use_map_alpha?g.alpha_factor:0;a.Qc.set(g.scale)}I=g&&g==v;v&&(I||(m=c?[.5,.5,.5,1]:null,m=s(v,m),D(a,m,"u_specmap0")),a.Gq=v.specular_color_factor);if(q){e(a,"a_normal");e(a,"a_tangent");m=c?[.5,.5,1,1]:null;m=s(q,m);D(a,m,"u_normalmap0");a.Ep=q.normal_factor;var x=q.texture;if(x.b4w_use_map_parallax&&S.Eh){var m=aa.u(x.b4w_parallax_steps),ea=aa.u(x.b4w_parallax_lod_dist);
t(a,"PARALLAX",1);t(a,"PARALLAX_STEPS",m);t(a,"PARALLAX_LOD_DIST",ea);a.Fh=x.b4w_parallax_scale}}fa&&(m=c?[0,0,.5,1]:null,m=s(fa,m),D(a,m,"u_mirrormap"),a.Cl=fa.mirror_factor);if(x=g&&p&&h?1:0)m=c?[.8,.8,.8,1]:null,m=s(p,m),D(a,m,"u_colormap1"),m=c?[.5,.5,.5,1]:null,m=s(h,m),D(a,m,"u_stencil0");(c=g||v||q)&&a.Qc.set(c.scale);t(a,"TEXTURE_SPEC",void 0==v?0:1);t(a,"TEXTURE_MIRROR",void 0==fa?0:1);t(a,"ALPHA_AS_SPEC",I?1:0);t(a,"TEXTURE_STENCIL_ALPHA_MASK",x);e(a,"a_position");e(a,"a_normal");(g||v||
q)&&e(a,"a_texcoord");if(b.b4w_water){a.re=!0;a.Em=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;r(a,"special_water.glslv","special_water.glslf");e(a,"a_position");e(a,"a_texcoord");e(a,"a_normal");e(a,"a_tangent");S.Vj?(e(a,"a_polyindex"),a.N=!0,a.wireframe_edge_color=[0,0,0],t(a,"DEBUG_WIREFRAME",1)):t(a,"DEBUG_WIREFRAME",0);I=n("use_map_normal",c);fa=n("use_map_mirror",c)[0];I.length&&(x=s(I[0]),D(a,x,"u_normalmap0"),a.Uj=b.b4w_water_norm_uv_velocity);t(a,"NUM_NORMALMAPS",
I.length);a.lf=Array(I.length);for(x=0;x<I.length;x++)a.lf[x]=new Float32Array(2),a.lf[x].set([I[x].scale[0],I[x].scale[1]]);fa?(t(a,"TEXTURE_MIRROR",1),I=s(fa),D(a,I,"u_mirrormap"),a.Cl=fa.mirror_factor):t(a,"TEXTURE_MIRROR",0);fa=null;for(x=0;x<c.length;x++)if(d=c[x],!0===d.texture.b4w_water_foam){fa=d;break}fa&&S.Vf?(t(a,"FOAM",1),I=s(fa),D(a,I,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.xo.set(fa.texture.b4w_foam_uv_freq),a.wo.set(fa.texture.b4w_foam_uv_magnitude),a.Uk[0]=fa.scale[0],a.Uk[1]=
fa.scale[1]):t(a,"FOAM",0);for(x=0;x<c.length;x++)if(d=c[x],!0===d.texture.b4w_shore_dist_map){f=d;break}f&&S.ek?(f=s(f),D(a,f,"u_shore_dist_map"),t(a,"SHORE_PARAMS",1),f=d.texture.b4w_shore_boundings,t(a,"MAX_SHORE_DIST",aa.u(d.texture.b4w_max_shore_dist)),t(a,"SHORE_MAP_SIZE_X",aa.u(f[0]-f[1])),t(a,"SHORE_MAP_SIZE_Y",aa.u(f[2]-f[3])),t(a,"SHORE_MAP_CENTER_X",aa.u((f[0]+f[1])/2)),t(a,"SHORE_MAP_CENTER_Y",aa.u((f[2]+f[3])/2))):t(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&S.deferred_rendering?(t(a,
"GENERATED_MESH",1),a.pr=!0,a.qr=b.b4w_water_num_cascads,a.rr=b.b4w_water_subdivs,a.or=b.b4w_water_detailed_dist):t(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=aa.u(b.b4w_water_dst_noise_scale0);f=aa.u(b.b4w_water_dst_noise_scale1);c=aa.u(b.b4w_water_dst_noise_freq0);var fa=aa.u(b.b4w_water_dst_noise_freq1),I=aa.u(b.b4w_water_dir_min_shore_fac),x=aa.u(b.b4w_water_dir_freq),m=aa.u(b.b4w_water_dir_noise_scale),ea=aa.u(b.b4w_water_dir_noise_freq),U=aa.u(b.b4w_water_dir_min_noise_fac),y=aa.u(b.b4w_water_dst_min_fac),
B=aa.u(b.b4w_water_waves_hor_fac);t(a,"DST_NOISE_SCALE_0",d);t(a,"DST_NOISE_SCALE_1",f);t(a,"DST_NOISE_FREQ_0",c);t(a,"DST_NOISE_FREQ_1",fa);t(a,"DIR_MIN_SHR_FAC",I);t(a,"DIR_FREQ",x);t(a,"DIR_NOISE_SCALE",m);t(a,"DIR_NOISE_FREQ",ea);t(a,"DIR_MIN_NOISE_FAC",U);t(a,"DST_MIN_FAC",y);t(a,"WAVES_HOR_FAC",B)}u(a,b);z(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;
t(a,"ABSORB",aa.u(b.b4w_water_absorb_factor));t(a,"SSS_STRENGTH",aa.u(b.b4w_water_sss_strength));t(a,"SSS_WIDTH",aa.u(b.b4w_water_sss_width));d=a.Xa;f=a.fd;a.Xa=d;a.fd=f}"HALO"===b.type&&(d=b.halo,r(a,"halo.glslv","halo.glslf"),t(a,"NUM_RINGS",d.ring_count),t(a,"NUM_LINES",d.line_count),t(a,"NUM_STARS",d.star_tip_count),t(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.fd=["a_position"],a.Xo=d.size,a.Uo=d.hardness/20,a.Wo.set(d.b4w_halo_rings_color),a.Vo.set(d.b4w_halo_lines_color),a.Yo=1/b.b4w_halo_stars_blend_height,
a.Zo=b.b4w_halo_stars_min_height,a.To=!0);t(a,"TEXCOORD",0);t(a,"NORMAL_TEXCOORD",0);g&&k(a,g,"TEXTURE_COLOR0_CO");p&&k(a,p,"TEXTURE_COLOR1_CO");h&&k(a,h,"TEXTURE_STENCIL_ALPHA_MASK_CO");v&&k(a,v,"TEXTURE_SPEC_CO");q&&k(a,q,"TEXTURE_NORM_CO");t(a,"SHADELESS",b.use_shadeless?1:0);a.zf=b.use_shadeless}g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);t(a,"ALPHA_CLIP","CLIP"===g?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(t(a,"VERTEX_COLOR",1),
e(a,"a_color")):t(a,"VERTEX_COLOR",0);a.Bc=b.ambient;a.Le=b.diffuse_intensity;a.Qd=b.emit;a.Bd.set(b.specular_color);a.rg=b.specular_alpha;u(a,b);z(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);w(a,b);S.Ue?t(a,"UNROLL_LOOPS",1):t(a,"UNROLL_LOOPS",0);a.Rl=b.b4w_refractive;a.jq=b.b4w_refr_bump;a=!0}break;case "NODES":a=F(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(l(a,b),a.qa)a=!1;else{r(a,"depth.glslv","depth.glslf");e(a,"a_position");
e(a,"a_normal");g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);a.Qc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===g){a.Qc.set(b.scale);t(a,"TEXTURE_COLOR",1);e(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)g=s(b),D(a,g,"u_colormap0");"NONE"==b.texture.d.source&&(g=s(b),D(a,g,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.Yy=b.b4w_use_ghost,a.Qb=b.b4w_collision_id,a.Ln=b.b4w_collision_group,
a.Mn=b.b4w_collision_mask,a.mh=b.physics.friction,a.hh=b.physics.elasticity,a=!0):b.b4w_water?(a.re=!0,a.hz=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=
b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_collision||"HALO"===b.type)a=!1;else{l(a,b);a.Ed=O.Zc;a.N=!0;a.qa=!1;g=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;r(a,"color_id.glslv","color_id.glslf");e(a,"a_position");g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);a.Qc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&
"CLIP"===g){a.Qc.set(b.scale);t(a,"TEXTURE_COLOR",1);e(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)g=s(b),D(a,g,"u_colormap0");"NONE"==b.texture.d.source&&(g=s(b),D(a,g,"u_colormap0"))}else t(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(l(a,b),a.qa=!1,a.Ed=O.Zc,a.N=!0,r(a,"grass_map.glslv","grass_map.glslf"),e(a,"a_position"),g=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,
a.Ra.a_grass_size={Se:!0,src:[]},g?(a.Ra.a_grass_size.src.push({name:g,jc:4}),t(a,"DYNAMIC_GRASS_SIZE",1)):t(a,"DYNAMIC_GRASS_SIZE",0),a.Ra.a_grass_color={Se:!0,src:[]},b?(a.Ra.a_grass_color.src.push({name:b,jc:7}),t(a,"DYNAMIC_GRASS_COLOR",1)):t(a,"DYNAMIC_GRASS_COLOR",0),S.Ue?t(a,"UNROLL_LOOPS",1):t(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(r(a,"wireframe.glslv","wireframe.glslf"),e(a,"a_position"),e(a,"a_normal"),
e(a,"a_polyindex"),a.N=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],S.Ue?t(a,"UNROLL_LOOPS",1):t(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":g=b.texture_slots;if(a.Ve)r(a,"particles_color.glslv","particles_color.glslf");else if(r(a,"particles_texture.glslv","particles_texture.glslf"),g=n("use_map_color_diffuse",g)[0]){t(a,"TEXTURE_COLOR",1);switch(g.blend_type){case "MIX":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":t(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ke=
g.diffuse_color_factor;a.ye=g.use_map_alpha?g.alpha_factor:0;g=s(g);D(a,g)}ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Bc=b.ambient;a.Le=b.diffuse_intensity;a.Qd=b.emit;a.Bd.set(b.specular_color);a.rg=b.specular_alpha;e(a,"a_position");e(a,"a_normal");g=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===g?0:1);t(a,"ALPHA_CLIP","CLIP"===g?1:0);t(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);u(a,b);z(a,b);l(a,b);g=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&
"OPAQUE"!=g&&"CLIP"!=g;a.of=b.offset_z;S.Ue?t(a,"UNROLL_LOOPS",1):t(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+a.type;}return a}function k(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":t(a,c,"TEXTURE_COORDS_UV_ORCO");t(a,"TEXCOORD",1);break;case "NORMAL":t(a,c,"TEXTURE_COORDS_NORMAL");t(a,"NORMAL_TEXCOORD",1);break;default:t(a,c,0)}}function l(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.qa=!0;a.Ed=O.Rm;a.N=!0;break;case "ALPHA":a.qa=!0;a.Ed=
O.Zc;a.N=!0;break;case "CLIP":a.qa=!1;a.Ed=O.Zc;a.N=!0;break;case "ADD":a.qa=!0;a.Ed=O.Zc;a.N=!1;break;case "OPAQUE":a.qa=!1;a.Ed=O.Zc;a.N=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.ka=c.use_backface_culling}function s(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&ma.Pj(d,b,c.ec,c.filepath);return d}function n(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function w(a,b){var c=b.raytrace_transparency;a.pd[0]=c.fresnel;
a.pd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Nh=c.reflect_factor;a.pd[2]=c.fresnel;a.pd[3]=1-c.fresnel_factor/5}function u(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":t(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":t(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":t(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:P.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.lc[0]=b.specular_intensity;a.lc[1]=c;a.lc[2]=d}function z(a,b){switch(b.diffuse_shader){case "LAMBERT":t(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.kd[0]=0;a.kd[1]=0;break;case "OREN_NAYAR":t(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.kd[0]=b.roughness;a.kd[1]=0;break;case "FRESNEL":t(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.kd[0]=b.diffuse_fresnel;a.kd[1]=b.diffuse_fresnel_factor;break;default:P.error("B4W Error: unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.name+'")'),a.kd[0]=0,a.kd[1]=0}}function F(a,b){if(!b.use_nodes)return!1;var c=R.Ot(b.node_tree,b.uuid,!1);if(!c)return P.error('Failed to create node graph for material "'+b.name+'", disable nodes'),p(a,b),!0;r(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===d?0:1);t(a,"ALPHA_CLIP","CLIP"===d?1:0);t(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);e(a,"a_position");l(a,b);a.of=b.offset_z;d=b.game_settings.alpha_blend;
a.mc=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;ka.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Qd=b.emit;a.Bc=b.ambient;w(a,b);b.b4w_wettable?t(a,"WETTABLE",1):t(a,"WETTABLE",0);a.Gl=R.Pt(c);var f=!1;Q.L(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var g=d.data.name,k=d.data.value;a.Af||(a.Af={});a.Af[k]=g;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":g=d.data.name;a.Ra[g]={Se:!0,src:[{name:d.data.value}]};k=0;if("GEOMETRY_VC"==
d.type)k=7;else for(var h=0;h<d.Pa.length;h++){var l="RGB".indexOf(d.Pa[h].identifier);-1<l&&(k|=1<<2-l)}a.Ra[g].src[0].jc=k;break;case "GEOMETRY_NO":e(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":g=d.data.value;e(a,"a_normal");t(a,"DIFFUSE_SHADER","DIFFUSE_"+g.Ju);t(a,"SPECULAR_SHADER","SPECULAR_"+g.dy);t(a,"SHADELESS_MAT",g.zf?1:0);a.zf=g.zf;a.rg=g.rg;f=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":g=d.data.name;
k=d.data.value;!1!==k.d.ni&&(k.d.ni="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);D(a,k.d,g);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "PARALLAX":t(a,"CALC_TBN_SPACE",1);e(a,"a_normal");e(a,"a_tangent");g=d.data.name;(k=d.data.value)?(k.d.ni=!1,D(a,k.d,g)):P.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.cg=d.data);break;case "REFRACTION":a.Rl=!0}});f||(a.zf=!0);S.Ue?t(a,"UNROLL_LOOPS",1):t(a,"UNROLL_LOOPS",
0);return!0}function p(a,b){r(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;t(a,"ALPHA","OPAQUE"===c?0:1);t(a,"ALPHA_CLIP","CLIP"===c?1:0);t(a,"SHADELESS",1);e(a,"a_position");e(a,"a_normal");ka.set(1,0,1,1,a.ob);t(a,"VERTEX_COLOR",0);a.of=b.offset_z;l(a,b)}function B(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Yi?t(a,"AU_QUALIFIER","attribute"):t(a,"AU_QUALIFIER","uniform"),t(a,"STATIC_BATCH",0)):(t(a,"AU_QUALIFIER","attribute"),t(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(M.Sv()?
t(a,"WIREFRAME_QUALITY",1):t(a,"WIREFRAME_QUALITY",0),a.Lk?(t(a,"DEBUG_SPHERE",1),a.ao?t(a,"DEBUG_SPHERE_DYNAMIC",1):t(a,"DEBUG_SPHERE_DYNAMIC",0)):t(a,"DEBUG_SPHERE",0),t(a,"ALPHA",1));b.Vc?(""!==b.ud?(a.Ra.a_bending_col_main={Se:!0,src:[{name:b.ud,jc:4}]},e(a,"a_bending_col_main"),""!==b.xb.sp&&""!==b.xb.rp&&""!==b.xb.Ip?(a.Ra.a_bending_col_detail={Se:!0,src:[{name:b.xb.sp,jc:4},{name:b.xb.rp,jc:2},{name:b.xb.Ip,jc:1}]},e(a,"a_bending_col_detail"),e(a,"a_normal"),t(a,"DETAIL_BEND",1)):t(a,"DETAIL_BEND",
0),t(a,"MAIN_BEND_COL",1)):t(a,"MAIN_BEND_COL",0),t(a,"WIND_BEND",1)):t(a,"WIND_BEND",0);b.ti?t(a,"BEND_CENTER_ONLY",1):t(a,"BEND_CENTER_ONLY",0);b.cd?t(a,"BILLBOARD",1):t(a,"BILLBOARD",0);b.cd&&b.Yi?t(a,"HAIR_BILLBOARD",1):t(a,"HAIR_BILLBOARD",0);b.ok?t(a,"BILLBOARD_SPHERICAL",1):t(a,"BILLBOARD_SPHERICAL",0);switch(b.Vg){case "RANDOM":t(a,"BILLBOARD_RANDOM",1);t(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":t(a,"BILLBOARD_RANDOM",0);t(a,"BILLBOARD_JITTERED",1);break;default:t(a,"BILLBOARD_RANDOM",
0),t(a,"BILLBOARD_JITTERED",0)}b.ya&&S.ek?t(a,"DYNAMIC_GRASS",1):t(a,"DYNAMIC_GRASS",0);a.ya=b.ya;a.md=b.md;a.Nb=b.Nb;a.Ob=b.Ob;a.rb=b.rb&&!a.zf&&!(a.qa&&S.fo);a.Wb=b.Wb;a.Mb=b.Mb;a.uc=b.uc;b.uh?(e(a,"a_influence"),t(a,"SKINNED",1),b.lh?t(a,"FRAMES_BLENDING",1):t(a,"FRAMES_BLENDING",0),t(a,"MAX_BONES",b.max_bones)):(t(a,"SKINNED",0),t(a,"FRAMES_BLENDING",0));b.ci?(t(a,"VERTEX_ANIM",1),S.mr?t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):t(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):t(a,"VERTEX_ANIM",
0);if(b.uh&&b.ci)throw"Skinning and vertex animation are mutually exlusive";b.Ii?t(a,"DISABLE_FOG",1):t(a,"DISABLE_FOG",0);b.gc&&(a.gc=b.gc);if(b.jf&&"NODES"==a.type){for(var c=a.Gl,d=b.zh,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "ANIM_VALUE":for(var k=g.pj[1],h=0;h<d.length;h+=2)if(d[h]==k){g.pj[0]=d[h+1];break}}}t(a,"NUM_ANIM_VALUES",b.jf.length)}}}function e(a,b){var c=a.fd;-1==c.indexOf(b)&&c.push(b)}function t(a,b,c){aa.J(a.Xa,b,c)}function x(a,b){if("PHYSICS"==a.type)a.$b=b;else{var c=
a.Ed,d=a.ld;a.To&&(b=O.Xu(b));a.pr&&(b=Y.sv(a.qr,a.rr,a.or));c=O.qy(b,c,d,a.Ra);a.md||c.Ui||(c.Vd=null,c.Uc=null);a.bb=c;c=b.r.length;a.num_vertices=b.C*c;a:switch(a.ld){case O.Og:case O.ii:case O.Im:d=!0;break a;default:d=!1}d?O.tw(b)?a.num_triangles=b.Y.length/3*c:a.num_triangles=b.C/3*c:a.num_triangles=0}}function K(a,b,d,e,f,g,k,l,n,m,r,p){var s=[],u=l.b4w_dynamic_grass;if(!m&&u)return s;for(var t="INSTANCE"==l.b4w_wind_bend_inheritance,w="INSTANCE"==l.b4w_shadow_inheritance,S="INSTANCE"==l.b4w_reflection_inheritance,
q=[],z=[],x=0;x<f.length;x++){var ea=f[x],D=I.Zg(b);D.cd=l.b4w_hair_billboard;D.Vg=l.b4w_hair_billboard_type;D.ok="SPHERICAL"==l.b4w_hair_billboard_geometry;D.ya=u;D.Yi=!0;D.jf=ea.d.jf;D.zh=ea.d.zh;t?(D.Vc=ea.d.Vc,D.gi=ea.d.gi,D.ue=ea.d.ue,D.Nd=ea.d.Nd,D.ud=ea.d.ud,D.Md=ea.d.Md,D.Kd=ea.d.Kd,D.Wc=ea.d.Wc,D.xb=ea.d.xb,D.ti=!1):(D.Vc=a.d.Vc,D.gi=a.d.gi,D.ue=a.d.ue,D.Nd=a.d.Nd,D.ud=a.d.ud,D.Md=a.d.Md,D.Kd=a.d.Kd,D.Wc=a.d.Wc,D.xb=a.d.xb,D.ti=!0);w?(D.Nb=ea.d.Nb,D.Ob=ea.d.Ob,D.rb=ea.d.rb):(D.Nb=a.d.Nb,
D.Ob=a.d.Ob,D.rb=a.d.rb);S?(D.Wb=ea.d.Wb,D.Mb=ea.d.Mb,D.uc=ea.d.uc):(D.Wb=a.d.Wb,D.Mb=a.d.Mb,D.uc=a.d.uc);q.push(D);var F=k[x];F||(F=new Float32Array);p&&I.Vi(n.seed,r);for(var G=new Float32Array(3),E=new Float32Array([0,0,0,1]),K=[],H=0;H<F.length;H+=4){G[0]=F[H];G[1]=F[H+1];G[2]=F[H+2];var N=F[H+3];if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var V=new Float32Array([I.kc(r),I.kc(r),I.kc(r)]);U.normalize(V,V);break;case "Z":V=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+
l.b4w_rotation_type;}fa.setAxisAngle(V,l.b4w_rand_rotation_strength*(2*Math.PI*I.kc(r)-Math.PI),E)}var L=v.Of(G,N,E);K.push(L)}z.push(K)}for(var M={},x=0;x<f.length;x++){var Q=g[x],D=q[x],R=I.Xg(D,0),K=z[x];if(K.length)for(var T=f[x].data,W=T.materials,H=0;H<W.length;H++)if(!O.$o(T,H))for(var Z=0;Z<Q.length;Z++){var Y=Q[Z];if("COLOR_ID"!==Y){var aa=c(Y),ja=W[H];if(h(aa,ja,!0)){aa.ld=T.ld||O.Og;B(aa,D);aa.nf=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&(aa.Zi=l.b4w_hair_billboard_jitter_amp,aa.$i=
l.b4w_hair_billboard_jitter_freq);u&&(aa.Ri=l.b4w_dynamic_grass_scale_threshold);t||(delete aa.Ra.a_bending_col_main,delete aa.Ra.a_bending_col_detail);y(aa,R);var ma=O.so(T,H,aa.fd,aa.gc,aa.Ra,aa.Af),pb=[];if(D.Vc||D.ya||D.cd)pb.au_wind_bending_amp=[D.Wc],pb.au_wind_bending_freq=[D.ue],pb.au_detail_bending_freq=[D.Nd],pb.au_detail_bending_amp=[D.Md],pb.au_branch_bending_amp=[D.Kd];var $a=O.Cw(ma,pb,K),Ab=$a,dc=K;Ab.A.au_center_pos=new Float32Array(3*Ab.C);for(var Mb=dc.length,Vb=Ab.C/Mb,Wb=0;Wb<
Mb;Wb++)for(var lc=dc[Wb],wa=3*Vb*Wb,Nb=0;Nb<Vb;Nb++)Ab.A.au_center_pos[wa+3*Nb]=lc[0],Ab.A.au_center_pos[wa+3*Nb+1]=lc[1],Ab.A.au_center_pos[wa+3*Nb+2]=lc[2];$a=Ab;if(D.ti){var fb=$a,sa=a.d.H;fb.A.a_emitter_center=new Float32Array(3*fb.C);var Bb=ka.fromValues(0,0,0,1);ka.transformMat4(Bb,sa,Bb);for(var ca=0;ca<fb.C;ca++)fb.A.a_emitter_center[3*ca]=Bb[0],fb.A.a_emitter_center[3*ca+1]=Bb[1],fb.A.a_emitter_center[3*ca+2]=Bb[2];$a=fb}var Ta=l.b4w_vcol_from_name,gb=l.b4w_vcol_to_name,oa=aa,Ia=d,hb=!t,
ta=T,Ua=[];if(""!==Ta&&""!==gb){var pa,Ja=gb,Cb=oa.Ra,ec=[],Zb=void 0;for(Zb in Cb)for(var $b=Cb[Zb].src,vb=0,Db=0;Db<$b.length;Db++){var mc=$b[Db].jc;Ja==$b[Db].name&&ec.push(Zb,mc,vb);vb+=I.vf(mc)}pa=ec;if(0<pa.length)for(var Eb=0;Eb<pa.length;Eb+=3)Ua.push({ih:Ta,Li:7,qj:pa[Eb],rj:pa[Eb+1],Ji:pa[Eb+2]});else O.ew(oa.fd,"a_color")&&gb==ta.active_vcol_name&&Ua.push({ih:Ta,Li:7,qj:"a_color",rj:7,Ji:0})}hb&&("a_bending_col_main"in Ia.Ra&&Ua.push({ih:"a_bending_col_main",Li:4,qj:"a_bending_col_main",
rj:4,Ji:0}),"a_bending_col_detail"in Ia.Ra&&Ua.push({ih:"a_bending_col_detail",Li:7,qj:"a_bending_col_detail",rj:7,Ji:0}));for(var wb=$a,nc=K,Ob=e,Ka=Ua,ac=aa.Ra,oc=!1,Na=0;Na<Ka.length;Na++){var qb=Ka[Na].ih,Fb=Ob.A[qb];if(Fb&&0<Fb.length){oc=!0;break}}if(oc){var pc,Fa=a.d.Db,La=Ob.r[0].a_position,C=nc,na=M,Ba=new Float32Array(3),ra=new Float32Array(3),Xb=new Uint32Array(C.length);if(!("verts_indices"in na)){na.ed=new Float32Array(3);na.bd=new Float32Array(3);na.Am=new Uint32Array(La.length/3);na.Bh=
new Uint32Array(La.length/3);na.ed[0]=(Fa.max_x-Fa.min_x)/20;na.ed[1]=(Fa.max_y-Fa.min_y)/20;na.ed[2]=(Fa.max_z-Fa.min_z)/20;na.bd[0]=Fa.min_x;na.bd[1]=Fa.min_y;na.bd[2]=Fa.min_z;for(var X=0;X<La.length/3;X++){var lb=I.trunc((La[3*X]-na.bd[0])/na.ed[0]),mb=I.trunc((La[3*X+1]-na.bd[1])/na.ed[1]),Pb=I.trunc((La[3*X+2]-na.bd[2])/na.ed[2]),lb=I.clamp(lb,0,19),mb=I.clamp(mb,0,19),Pb=I.clamp(Pb,0,19);na.Am[X]=X;na.Bh[X]=Pb*Math.pow(20,2)+20*mb+lb}O.$x(na.Bh,na.Am,!0);na.Cf=new Uint32Array(Math.pow(20,3));
for(X=0;X<na.Bh.length;X++)na.Cf[na.Bh[X]]++;delete na.Bh;for(X=1;X<na.Cf.length;X++)na.Cf[X]+=na.Cf[X-1]}for(var rb=0;rb<C.length;rb++){Ba[0]=C[rb][0];Ba[1]=C[rb][1];Ba[2]=C[rb][2];for(var Qb=1E10,xb=-1,Gb=I.trunc((Ba[0]-na.bd[0])/na.ed[0]),Rb=I.trunc((Ba[1]-na.bd[1])/na.ed[1]),Aa=I.trunc((Ba[2]-na.bd[2])/na.ed[2]),Gb=I.clamp(Gb,0,19),Rb=I.clamp(Rb,0,19),Aa=I.clamp(Aa,0,19),Ga=Aa*Math.pow(20,2)+20*Rb+Gb,Ec=na.Cf[Ga],Hb=0==Ga?0:na.Cf[Ga-1];Hb<Ec;Hb++){var vc=na.Am[Hb];ra[0]=La[3*vc];ra[1]=La[3*vc+
1];ra[2]=La[3*vc+2];U.sub(ra,Ba,ra);var Fc=U.sqrLen(ra);Fc<=Qb&&(Qb=Fc,xb=vc)}if(-1==xb)for(Hb=0;Hb<La.length/3;Hb++)ra[0]=La[3*Hb],ra[1]=La[3*Hb+1],ra[2]=La[3*Hb+2],U.sub(ra,Ba,ra),Fc=U.sqrLen(ra),Fc<=Qb&&(Qb=Fc,xb=Hb);Xb[rb]=xb}pc=Xb;for(var jd=wb.C/nc.length,Na=0;Na<Ka.length;Na++){var Ib=Ka[Na].qj,fc=Ka[Na].rj,qb=Ka[Na].ih,Sb=Ka[Na].Li,Fb=Ob.A[qb];switch(Ib){case "a_bending_col_main":var Jb=1;break;case "a_bending_col_detail":Jb=3;break;case "a_color":Jb=3;break;default:for(var sb=Jb=0;sb<ac[Ib].src.length;sb++)Jb+=
I.vf(ac[Ib].src[sb].jc)}if(Fb&&0<Fb.length){var gc=I.vf(Sb),wc=I.vf(fc),xc=Sb&fc,yb=I.oq(xc);xc!=fc&&P.error("Wrong color extraction from "+qb+" to "+Ib+".");if("a_bending_col_main"==Ib||"a_bending_col_detail"==Ib)wb.A[Ib]=new Float32Array(wb.C*wc);for(sb=0;sb<nc.length;sb++){var Kb=pc[sb],Lb=Kb*gc,ib=sb*jd*Jb;if(-1!=Kb)for(var Tb=0;Tb<jd;Tb++)for(var yc=Tb*Jb,jb=0;jb<yb.length;jb++)yb[jb]&&(wb.A[Ib][ib+yc+(Ka[Na].Ji+I.Rh(fc,jb))]=Fb[Lb+I.Rh(Sb,jb)])}}else wb.A[Ib]=new Float32Array(0)}}$a=wb;s.push({k:aa,
$b:$a,Sb:[ja.name],Gb:D,vc:[a]})}}}}return s}function H(a){return v.Of(a.e,a.scale,a.quat)}function y(a,b){for(var c=null,d=null,e=null,f=0;f<a.D.length;f++){var g=a.D[f].kj;g&&(c||(c={}),c[f]=g,a.D[f].kj=null);if(g=a.D[f].dd)d||(d={}),d[f]=g,a.D[f].dd=null;if(g=a.D[f].wa)e||(e={}),e[f]=g,a.D[f].wa=null}a.id=0;a.Sl=b;a.id=I.Xg(a,b);if(c)for(f in c)a.D[f].kj=c[f];if(d)for(var k in d)a.D[k].dd=d[k];if(e)for(k in e)a.D[k].wa=e[k]}function L(a,b,d,e,f){var g=c("WIREFRAME");r(g,"wireframe.glslv","wireframe.glslf");
g.wireframe_mode=0;g.Lk=!0;g.N=!0;g.nf=d;f&&(g.ao=!0);B(g,b);y(g,I.Xg(b,0));e?(b=Y.Do(1,a.t),O.ux(b,[a.Be[0],a.Ce[1],a.De[2]],a.t)):b=Y.Do(a.ma,a.t);O.lm(b,1,!0);b.A.a_polyindex=O.ro(b);x(g,b);return g}function r(a,b,c){a.Xa={bi:b,kh:c,Od:[]};aa.Dx(a.Xa)}function D(a,b,c){1==a.D.length&&0==a.ac.length&&a.ac.push("default0");c=c||"default"+String(a.D.length);-1==a.ac.indexOf(c)&&(a.D.push(b),a.ac.push(c))}function G(a){if(!a.Xa)throw"No shaders info for batch "+a.name;a.Yb=aa.Ev(a.Xa,a.Gl);W.ot(a.Yb);
W.dn(a)}function V(a,b,c){var d=a.Xa;aa.J(d,"SHADOW_SRC",b);aa.J(d,"SHADOW_DST",c);return a}var N=q("__boundings"),Z=q("__config"),P=q("__print"),M=q("__extensions"),O=q("__geometry"),Q=q("__graph"),R=q("__nodemat"),T=q("__objects"),ja=q("__particles"),Y=q("__primitives");q("__reformer");var W=q("__renderer"),E=q("__scenegraph");q("__scenes");var aa=q("__shaders"),ma=q("__textures"),v=q("__tsr"),I=q("__util"),U=q("vec3"),ka=q("vec4"),fa=q("quat"),S=Z.n,ea=["MAIN","NODES"];a.OA=c;a.rv=function(a,d,
f,k,h){for(var l=[],n=[],m=0;m<f.length;m++){var p=f[m];switch(p.d.type){case "DYNAMIC":l.push(p);break;case "STATIC":n.push(p)}}f=[];f=f.concat(b(l,a,h));d=f=f.concat(g(n,a,d,h));m=[];p=[];h={};for(f=0;f<d.length;f++){var n=d[f].k,v=d[f].Gb,l=null;if(n.id in h){var u=h[n.id],t=p[u].k,w=p[u].Gb,q=null,fa=null;for(a=0;a<n.D.length;a++){var z=n.D[a].dd;z&&(q||(q={}),q[a]=z,n.D[a].dd=null);if(z=n.D[a].wa)fa||(fa={}),fa[a]=z,n.D[a].wa=null}I.Rq(n,t)&&I.Rq(v,w)&&(l=p[u]);if(q)for(a in q)n.D[a].dd=q[a];
if(fa)for(a in fa)n.D[a].wa=fa[a];if(!l){do n.id++;while(h[n.id])}}l||(l={k:n,Gb:d[f].Gb,vc:[],Tq:[],Sb:[]},h[n.id]=p.length,p.push(l));l.vc=l.vc.concat(d[f].vc);d[f].$b&&d[f].$b.C&&l.Tq.push(d[f].$b);if(l.Sb.length)for(a=0;a<d[f].Sb.length;a++)n=d[f].Sb[a],-1==l.Sb.indexOf(n)&&l.Sb.push(n);else l.Sb=d[f].Sb}for(f=0;f<p.length;f++){d=p[f].Tq;if(0==d.length)a=I.mb(I.Lj("%empty"));else if(1==d.length)a=d[0];else{h=[];for(a=0;a<d.length;a++)O.uw(d[a])||h.push(a);if(h.length<d.length)for(a=0;a<h.length;a++)O.lm(d[h[a]]);
a=O.py(d)}m.push({k:p[f].k,Gb:p[f].Gb,$b:a,Sb:p[f].Sb,vc:p[f].vc})}f=m;for(m=0;m<f.length;m++)x(f[m].k,f[m].$b),f[m].k.tc=f[m].Sb;a=[];for(m=0;m<f.length;m++)if(d=f[m].k,"STATIC"==f[m].Gb.type)p=I.fp(I.Lj("%meta")),p.d=f[m].Gb,p.P=[d],a.push(p);else for(h=[],l=0;l<f[m].vc.length;l++)if(p=f[m].vc[l],-1==h.indexOf(p.name)){for(n=0;n<p.P.length;n++)if(p.P[n]==d)throw"Batch already exist in object";p.P.push(d);h.push(p.name)}if(S.wireframe_debug){for(m=0;m<f.length;m++)d=f[m].Gb,"DYNAMIC"==d.type&&(p=
f[m].vc[0],-1<ea.indexOf(f[m].k.type)&&(d=L(d.Ee,d,p.name,!0,!0),p.P.push(d)));for(m=0;m<a.length;m++)p=a[m],d=p.d,-1<ea.indexOf(p.P[0].type)&&(d=L(d.rc,d,p.name,!1),p.P.push(d))}p=null;if(k.texture_slots)for(m=0;m<k.texture_slots.length;m++)if(k.texture_slots[m].texture.b4w_use_as_skydome){p=s(k.texture_slots[m],null);break}if(k.b4w_sky_settings.procedural_skydome||p)d=c("MAIN"),r(d,"special_skydome.glslv","special_skydome.glslf"),k.b4w_sky_settings.procedural_skydome?d.fq=!0:D(d,p,"u_sky"),k.b4w_sky_settings.reflexible&&
(d.Wb=!0,k.b4w_sky_settings.reflexible_only&&(d.Mb=!0)),e(d,"a_position"),d.of=99999,k=Y.qv(),x(d,k),p=I.fp(I.Lj("%meta")),p.d=T.Fi("DYNAMIC"),p.d.Qf=!0,p.d.Db=N.Xc(),p.d.rc=N.hi(),p.d.Ia=N.Xc(),p.d.kb=N.hi(),p.P=[d],a.push(p);return a};a.iz=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.qt=m;a.Bv=s;a.ik=function(a,b){t(a,"CSM_SECTION0",0);t(a,"CSM_SECTION1",0);t(a,"CSM_SECTION2",0);
t(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)t(a,"CSM_SECTION"+String(c),1);t(a,"SHADOW_TEX_RES",aa.u(b.csm_resolution));t(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);t(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.U=t;a.fb=function(a,b){return aa.Kv(a.Xa,b)};a.pi=D;a.ox=function(a,b,c){c=a.ac.indexOf(c);-1<c&&(a.D[c]=b)};a.nu=function(a,b){var d=c("MAIN");d.qa=!0;ka.set(b[0],b[1],b[2],.5,d.ob);d.ld=O.ii;x(d,a);r(d,"main.glslv","main.glslf");t(d,"SHADELESS",1);G(d);return d};
a.sb=G;a.Et=function(a){return a.Yb.Hh.length?a.Yb.Nl.u_cube_fog?!0:!1:!1};a.ou=function(a,b){var d=c("DEPTH");d.ka=a.ka;d.Qc.set(a.Qc);d.ya=a.ya;d.bb=a.bb;d.id=a.id;d.Sl=a.Sl;a.D.length&&(d.D[0]=a.D[0],d.ac[0]=a.ac[0]);d.fd=a.fd;d.Zi=a.Zi;d.$i=a.$i;d.Ri=a.Ri;d.num_triangles=a.num_triangles;d.num_vertices=a.num_vertices;d.nf=a.nf;for(var e=0;e<a.tc.length;e++)d.tc.push(a.tc[e]);d.Jc=a.Jc;a.vb||(a.vb=[]);a.vb.push(d);r(d,"depth.glslv","depth.glslf");aa.kw(d.Xa,a.Xa);return d=V(d,"SHADOW_SRC_NONE",
b)};a.tm=V;a.bu=function(){var a=c("DEPTH_PACK");a.ka=!0;a.N=!1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");G(a);return a};a.Vn=function(a){var b=c("POSTPROCESSING");r(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":t(b,"POST_EFFECT","POST_EFFECT_NONE");b.p[0]=1;b.p[1]=1;break;case "GRAYSCALE":t(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.p[0]=1;b.p[1]=1;break;case "X_BLUR":t(b,"POST_EFFECT","POST_EFFECT_X_BLUR");
b.p[0]=1;b.p[1]=0;break;case "Y_BLUR":t(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.p[0]=0;b.p[1]=1;break;case "X_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.p[0]=1;b.p[1]=0;break;case "Y_EXTEND":t(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.p[0]=0;b.p[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.ka=!0;b.N=!1;a=Y.Da();x(b,a);G(b);return b};a.aA=function(){var a=c("EDGE");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");
G(a);return a};a.su=function(a){var b=c("SSAO");b.N=!1;b.ka=!0;b.p[0]=1;b.p[1]=1;var d=Y.Da();x(b,d);r(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");t(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Mq);t(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ma.uv(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,
203,0,117,73,12,0])};a=s(a,d);D(b,a,"u_ssao_special_tex");G(b);return b};a.tu=function(a){var b=c("SSAO_BLUR");b.N=!1;b.ka=!0;b.p[0]=1;b.p[1]=1;var d=Y.Da();x(b,d);r(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");t(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);G(b);return b};a.cu=function(){var a=c("DOF");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");t(a,"DEPTH_RGBA",1);G(a);return a};a.du=function(){var a=
c("GLOW");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");G(a);return a};a.eu=function(a,b,d){var e=c("GOD_RAYS");e.N=!1;e.ka=!0;e.p[0]=1;e.p[1]=1;var f=Y.Da();x(e,f);r(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");t(e,"DEPTH_RGBA",a);t(e,"WATER_EFFECTS",b);t(e,"STEPS_PER_PASS",aa.u(d,1));G(e);return e};a.fu=function(){var a=c("GOD_RAYS_COM");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv",
"postprocessing/god_rays_combine.glslf");G(a);return a};a.pu=function(){var a=c("SKY");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.mv();x(a,b);r(a,"procedural_skydome.glslv","procedural_skydome.glslf");t(a,"NUM_LIGHTS",1);t(a,"WATER_EFFECTS",1);G(a);return a};a.Wt=function(){var a=c("ANTIALIASING");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;a.Cg=1/S.resolution_factor;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");t(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");G(a);
return a};a.qu=function(a){var b=c("SMAA"),d=Y.Da();x(b,d);r(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");t(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");t(b,"SMAA_PASS",a);t(b,"SMAA_PREDICATION",0);t(b,"SMAA_REPROJECTION",0);G(b);b.N=!1;b.ka=!0;b.p[0]=1;b.p[1]=1;b.Cg=1/S.resolution_factor;return b};a.gu=function(a){var b=c("LANCZOS");b.N=!1;b.ka=!0;b.Cg=1/S.resolution_factor;"LANCZOS_X"==a?(b.p[0]=1,b.p[1]=0):"LANCZOS_Y"==a&&(b.p[0]=0,b.p[1]=1);a=Y.Da();x(b,a);r(b,"postprocessing/postprocessing.glslv",
"postprocessing/lanczos.glslf");G(b);return b};a.$t=function(){var a=c("COMPOSITING");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");G(a);return a};a.ju=function(a){var b=c("MOTION_BLUR");b.ka=!0;b.N=!1;var d=Y.Da();x(b,d);r(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");t(b,"BLUR_DECAY_THRESHOLD",aa.u(a));G(b);return b};a.Vt=function(){var a=c("ANAGLYPH");a.ka=!0;a.N=!1;var b=Y.Da();x(a,
b);r(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");G(a);return a};a.hu=function(){var a=c("LUMINANCE");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");G(a);return a};a.Xt=function(){var a=c("LUMINANCE");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");G(a);return a};a.iu=function(){var a=c("LUMINANCE_X_BLUR");
a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");G(a);return a};a.Yt=function(a){var b=c("POSTPROCESSING");switch(a){case "X_BLUR":b.p[0]=1;b.p[1]=0;break;case "Y_BLUR":b.p[0]=0;b.p[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.ka=!0;b.N=!1;a=Y.Da();x(b,a);r(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");G(b);return b};a.Zt=function(){var a=c("BLOOM");
a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");G(a);return a};a.wu=function(){var a=c("VELOCITY");a.N=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var b=Y.Da();x(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");G(a);return a};a.Vh=function(a,b,c){var d=a.Cg;a.om[0]=b*a.p[0]*d;a.om[1]=c*a.p[1]*d};a.xf=function(a,b){a.Cg=b};a.S=function(a,b,c){a=a.P;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<
f.tc.indexOf(b)&&(c&&f.type==c||!c)){if(f.vb)return f;d=null===d?f:d}}return d};a.Nt=function(a){for(var b=a.D,c=0;c<b.length;c++)ma.Iu(b[c].Ha);O.In(a.bb)}};b4w.module.__nodemat=function(a,q){function c(a,c,e){if(c in v)return v[c];for(var g=R.create(),h=a.nodes,r=a.links,p=a.animation_data,s=0;s<h.length;s++)if(!z(g,h[s],0,p))return v[c]=null;if(e&&-1==w(a,g,"GROUP_OUTPUT","group"))return null;s=G(g);if(!V(g,r,s))return null;if(e)return g;for(s=0;s<r.length;s++){e=r[s];for(var h=m(e.from_node,g),p=m(e.to_node,g),u=0;u<h.length;u++)for(var t=0;t<p.length;t++){for(var q=h[u],I=p[t],x=R.Ea(g,q),U=R.Ea(g,I),D=g,y=U,U=[],B=e.from_socket.identifier,F=e.to_socket.identifier,
E=x.Pa,x=0;x<E.length;x++)if(E[x].identifier==B){U.push(x);break}y=y.B;for(x=0;x<y.length;x++)if(y[x].identifier==F){U.push(x);break}2==U.length&&R.Ae(D,q,I,U)}}d(g);a=w(a,g,"OUTPUT","material");if(-1==a)return v[c]=null;f(g);g=R.my(g,a,R.vr);b(g);k(g);l(g);n(g);return v[c]=g}function b(a){R.L(a,function(b,c){for(var d=c.B,e=c.Pa,f=0;f<d.length;f++)g(a,d[f],b,f,1);for(f=0;f<e.length;f++)g(a,e[f],b,f,0)})}function g(a,b,c,d,e){if(b.td){var f=!0;R.oe(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&
g[1]==d)f=!1});f&&(b.td=!1)}}function d(a){var b=[];R.L(a,function(c,d){switch(d.type){case "TRANSLUCENCY":R.oe(a,function(a,e,f){a==c&&"Translucency"==d.Pa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)R.Ae(a,b[c],b[c+1],b[c+2])}function m(a,b){var c=[];R.L(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function f(a){var b=[];R.L(a,function(a,c){"PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=
b[c],e=b[c+1];if("PARALLAX"==e.type){var f=h(a,d);if(-1!=f){var g=R.Ni(a,f,0);R.kg(a,f,d,-1);-1!=g&&R.kg(a,g,f,-1);d=R.Ea(a,f);e.data=d.data;e.va[0]=d.va[0];R.lg(a,f)}e.B.splice(1,1)}else if("REROUTE"==e.type){for(var e=R.Ni(a,d,0),k=R.ig(a,d),f=[],g=[],l=[],n=0;n<k;n++){var m=R.Yf(a,d,n),r=g.indexOf(m);-1!=r?l[r]+=1:(g.push(m),l.push(1),f.push(d,m))}if(-1!=e)for(k=R.Xf(a,e,d,0)[0],n=0;n<g.length;n++)for(m=0;m<l[n];m++)r=R.Xf(a,d,g[n],m)[1],R.Ae(a,e,g[n],[k,r]);for(n=0;n<f.length;n+=2)R.kg(a,f[n],
f[n+1],-1)}}}function h(a,b){for(var c=a.sa,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function k(a){var b=[];R.L(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,k=0;k<c.length;k++){var h=c[k];if(s(f,h.pa)){g=[];k=R.ig(a,e);for(m=0;m<k;m++){var l=R.Yf(a,e,m),n=R.Xf(a,e,l,0);g.push(e,l,n);R.Ae(a,
h.id,l,n)}for(var m=0;m<g.length;m+=3)R.kg(a,g[m],g[m+1],0);R.lg(a,e);g=!1;break}}g&&(h={id:e,pa:f},c.push(h))}}function l(a){var b=[];R.L(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,k=0;k<c.length;k++){var h=c[k];if(!(3<=h.gj.length)&&s(f,h.pa)){for(var k=[],l=R.ep(a,e),g={},n=0;n<l;n++){var m=R.Ni(a,e,n);m in g||(g[m]=0);var r=R.Xf(a,m,e,g[m]++);k.push(m,e,r)}for(var l=[],g=R.ig(a,e),p={},n=0;n<g;n++)m=
R.Yf(a,e,n),m in p||(p[m]=0),r=R.Xf(a,e,m,p[m]++),l.push(e,m,r);for(var g=k.concat(l),n=0;n<g.length;n+=3)R.kg(a,g[n],g[n+1],0);R.lg(a,e);n={pa:f,Pu:k,Qu:l};h.gj.push(n);g=!1;break}}g&&(h={id:e,pa:f,gj:[]},c.push(h))}for(d=0;d<c.length;d++){h=c[d];e=h.gj.length;l=h.pa.B.length;g=h.pa.Pa.length;for(k=0;k<e;k++){r=h.gj[k];n=r.pa;f=r.Pu;p=r.Qu;h.pa.B=h.pa.B.concat(n.B);h.pa.Pa=h.pa.Pa.concat(n.Pa);for(n=0;n<h.pa.B.length;n++)h.pa.B[n].identifier+=ja.trunc(n/l)+1;for(n=0;n<h.pa.Pa.length;n++)h.pa.Pa[n].identifier+=
ja.trunc(n/g)+1;for(n=0;n<f.length;n+=3)m=f[n],r=f[n+2],r[1]+=(k+1)*l,R.Ae(a,m,h.id,r);for(n=0;n<p.length;n+=3)m=p[n+1],r=p[n+2],r[0]+=(k+1)*g,R.Ae(a,h.id,m,r)}switch(e){case 1:h.pa.type+="2";break;case 2:h.pa.type+="3";break;case 3:h.pa.type+="4"}R.lg(a,h.id);R.hk(a,h.id,h.pa)}}function s(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function n(a){var b=[];R.L(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],k=[],h=[[],[],[]],l=R.ig(a,d),n=0;n<l;n++){var m=R.Yf(a,d,n);if("SEPRGB"!=R.Ea(a,m).type){f=!1;break}g.push(d,m);for(var r={},p=R.ig(a,m),f=0;f<p;f++){var v=R.Yf(a,m,f);v in r||(r[v]=0);var s=R.Xf(a,m,v,r[v]++);g.push(m,v);h[s[0]].push(d,v,s)}k.push(m);f=!0}if(f){for(n=d=l=0;n<h.length;n++)h[n].length&&(l++,d|=1<<2-n);if(l){e.type+=
l;e.Pa=[];for(n=0;n<h.length;n++)if(h[n].length)for(e.Pa.push({nb:0,identifier:"RGB"[n],td:!0,name:"RGB"[n]}),f=0;f<h[n].length;f+=3)h[n][f+2][0]=ja.Rh(d,n);for(n=0;n<g.length;n+=2)R.kg(a,g[n],g[n+1],0);for(n=0;n<k.length;n++)R.lg(a,k[n]);for(n=0;n<h.length;n++)for(f=0;f<h[n].length;f+=3)R.Ae(a,h[n][f],h[n][f+1],h[n][f+2])}}}}function w(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var g=a[f];g.type==c&&(e=g)}return e?m(e,b)[0]:(Q.error('No "'+c+'" node in node '+d),-1)}function u(a,b,c,d){return{name:a,
type:b,inputs:c,outputs:d}}function z(a,b,d,f){var g=b.name,k=b.type,h=[],l=[],n=[],m=[],r=null;switch(k){case "CAMERA":l=[];n=y(b);break;case "COMBRGB":case "COMBHSV":l=H(b);n=y(b);break;case "GEOMETRY":a:{for(var k=b.outputs,v=0;v<k.length;v++)if(k[v].is_linked){k=!0;break a}k=!1}if(!k)return!0;k=B(b,d);if(!k)return Q.error("Geometry output is not supported"),!1;switch(k){case "GEOMETRY_UV":if(!b.uv_layer)return Q.error('Missing uv layer in node "',b.name,'"'),!1;r=p("param_GEOMETRY_UV_a");v=p("param_GEOMETRY_UV_v");
h.push(L(r));h.push(L(v));n.push(t(b,"UV"));m.push(L(v));r={name:r,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return Q.error("Missing vertex color layer in node ",b.name),!1;r=p("param_GEOMETRY_VC_a");v=p("param_GEOMETRY_VC_v");h.push(L(r));h.push(L(v));n.push(t(b,"Vertex Color"));m.push(L(v));r={name:r,value:b.color_layer};break;case "GEOMETRY_NO":n.push(t(b,"Normal"));break;case "GEOMETRY_FB":n.push(t(b,"Front/Back"));break;case "GEOMETRY_VW":n.push(t(b,"View"));break;case "GEOMETRY_GL":n.push(t(b,
"Global"))}break;case "GROUP":v=b.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(v){case "LINEAR_TO_SRGB":k="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":case "VECTOR_VIEW":k="VECTOR_VIEW";break;case "SRGB_TO_LINEAR":k="SRGB_TO_LINEAR";break;case "REFLECT":k="REFLECT";break;case "REFRACTION":k="REFRACTION";break;case "PARALLAX":k="PARALLAX";if(!b.inputs[1].is_linked)return Q.error('Missing texture in node "',b.name,'"'),!1;var s=p("temp_texture");m.push(L(s));break;case "CLAMP":k="CLAMP";break;case "TRANSLUCENCY":k=
"TRANSLUCENCY";break;case "TIME":k="TIME";break;case "SMOOTHSTEP":k="SMOOTHSTEP";break;default:n=b.node_group.node_tree;l={};for(s in n)if("links"==s||"nodes"==s)for(l[s]=[],r=0;r<n[s].length;r++){l[s][r]={};for(var w in n[s][r])if("links"==s){l[s][r][w]={};for(var q in n[s][r][w])l[s][r][w][q]=F(n[s][r][w][q])}else l[s][r][w]=F(n[s][r][w])}else l[s]=F(n[s]);if("REPLACE"==v||"LEVELS_OF_QUALITY"==v)n=u("Group input","GROUP_INPUT",[],b.inputs),r=u("Group output","GROUP_OUTPUT",b.outputs,[]),s=null,
s="REPLACE"==v||"LEVELS_OF_QUALITY"==v&&(ka.quality==Y.P_LOW||ka.Vk)?{from_node:n,from_socket:n.outputs[1],to_node:r,to_socket:r.inputs[0]}:{from_node:n,from_socket:n.outputs[0],to_node:r,to_socket:r.inputs[0]},l.nodes=[n,r],l.links=[s];n=b.name;r=l.nodes;s=l.links;for(w=0;w<r.length;w++)r[w].name=D(r[w].type,n,r[w].name);for(w=0;w<s.length;w++)s[w].from_node.name=D(s[w].from_node.type,n,s[w].from_node.name),s[w].to_node.name=D(s[w].to_node.type,n,s[w].to_node.name);r={Nw:c(l,b.node_group.uuid,!0),
Ow:l.links}}l=H(b);n=y(b);"TRANSLUCENCY"==v&&(v=K("TranslucencyParams","TranslucencyParams",[0,0,0,0]),v.td=n[0].td,n.push(v));break;case "LAMP":r=b.lamp;if(!r)return Q.error("There is no lamp in node: "+b.name),!1;n.push(t(b,"Color"));n.push(t(b,"Light Vector"));n.push(t(b,"Distance"));n.push(t(b,"Visibility Factor"));r.uuid in I?m.push(L(p("param_LAMP_lamp_index"),I[r.uuid],1)):(I[r.uuid]=U,m.push(L(p("param_LAMP_lamp_index"),U++,1)));r=I;break;case "NORMAL":l=H(b);n=y(b);v=t(b,"Normal");m.push(L(p("param_NORMAL_Normal"),
v.nb,3));break;case "MAPPING":v=b.vector_type;l.push(e(b,"Vector"));n.push(t(b,"Vector"));if(0!=W.length(b.translation)||0!=W.length(b.rotation)||b.use_max||b.use_min){var k="MAPPING_HEAVY",x=b.rotation;q=b.scale;s=b.translation;w=E.create();x=ja.Su(x);q=new Float32Array([q[0],0,0,0,q[1],0,0,0,q[2]]);E.multiply(x,q,w);w=ja.Ew(w,aa.create());switch(v){case "POINT":w[12]=s[0];w[13]=s[1];w[14]=s[2];break;case "TEXTURE":w[12]=s[0];w[13]=s[1];w[14]=s[2];w=aa.invert(w,w);break;case "NORMAL":aa.invert(w,
w),aa.transpose(w,w)}m.push(L(p("param_MAPPING_HEAVY_trs_matrix"),w,16));m.push(L(p("param_MAPPING_HEAVY_use_min"),~~b.use_min,1));m.push(L(p("param_MAPPING_HEAVY_use_max"),~~b.use_max,1));m.push(L(p("param_MAPPING_HEAVY_min_clip"),b.min,3));m.push(L(p("param_MAPPING_HEAVY_max_clip"),b.max,3))}else k="MAPPING_LIGHT",m.push(L(p("param_MAPPING_LIGHT_scale"),b.scale,3));switch(v){case "TEXTURE":m.push(L(p("param_MAPPING_vector_type"),0,1));break;case "POINT":m.push(L(p("param_MAPPING_vector_type"),1,
1));break;case "VECTOR":m.push(L(p("param_MAPPING_vector_type"),2,1));break;case "NORMAL":m.push(L(p("param_MAPPING_vector_type"),3,1))}break;case "MATERIAL":case "MATERIAL_EXT":v=e(b,"Color");v.nb.splice(3);l.push(v);(v=e(b,"Alpha"))?l.push(v):l.push(K("Alpha","Alpha",1));v=e(b,"Spec");v.nb.splice(3);l.push(v);r=e(b,"Normal");r.nb.splice(3);l.push(r);n.push(t(b,"Color"));n.push(t(b,"Alpha"));n.push(t(b,"Normal"));"MATERIAL_EXT"==k&&((v=e(b,"Emit"))?l.push(v):l.push(K("Emit","Emit",0)),v=e(b,"Translucency"),
v.nb=0,v.name="Translucency",v.identifier="Translucency",v?l.push(v):l.push(K(v.name,v.identifier,v.nb)),v=e(b,"Translucency"),v.nb=[0,0,0,0],v.name="TranslucencyParams",v.identifier="TranslucencyParams",v?l.push(v):l.push(K(v.name,v.identifier,v.nb)),(v=e(b,"Ray Mirror"))?l.push(v):l.push(K("Ray Mirror","Ray Mirror",0)),(v=e(b,"SpecTra"))?l.push(v):l.push(K("SpecTra","SpecTra",0)),n.push(t(b,"Diffuse")),n.push(t(b,"Spec")));s=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":v=b.specular_hardness;
break;case "WARDISO":v=b.specular_slope;break;case "TOON":v=b.specular_toon_size;s=b.specular_toon_smooth;break;default:Q.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),v=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":q=w=0;break;case "OREN_NAYAR":w=b.roughness;q=0;break;case "FRESNEL":w=b.diffuse_fresnel;q=b.diffuse_fresnel_factor;break;default:Q.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+
'")'),q=w=0}m.push(L(p("param_MATERIAL_diffuse"),[b.use_diffuse?1:0,w,q],3));m.push(L(p("param_MATERIAL_spec"),[b.use_specular?1:0,b.specular_intensity,v,s],4));m.push(L(p("param_MATERIAL_norm"),r.td?1:0,1));r={name:b.name,value:{dy:b.specular_shader,Ju:b.diffuse_shader,zf:b.use_shadeless,rg:b.specular_alpha}};break;case "MATH":switch(b.operation){case "ADD":k="MATH_ADD";break;case "SUBTRACT":k="MATH_SUBTRACT";break;case "MULTIPLY":k="MATH_MULTIPLY";break;case "DIVIDE":k="MATH_DIVIDE";break;case "SINE":k=
"MATH_SINE";break;case "COSINE":k="MATH_COSINE";break;case "TANGENT":k="MATH_TANGENT";break;case "ARCSINE":k="MATH_ARCSINE";break;case "ARCCOSINE":k="MATH_ARCCOSINE";break;case "ARCTANGENT":k="MATH_ARCTANGENT";break;case "POWER":k="MATH_POWER";break;case "LOGARITHM":k="MATH_LOGARITHM";break;case "MINIMUM":k="MATH_MINIMUM";break;case "MAXIMUM":k="MATH_MAXIMUM";break;case "ROUND":k="MATH_ROUND";break;case "LESS_THAN":k="MATH_LESS_THAN";break;case "GREATER_THAN":k="MATH_GREATER_THAN";break;case "MODULO":k=
"MATH_MODULO";break;case "ABSOLUTE":k="MATH_ABSOLUTE";break;default:return Q.error("Unsupported MATH operation: "+b.operation),!1}l=H(b);n=y(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":k="MIX_RGB_MIX";break;case "ADD":k="MIX_RGB_ADD";break;case "MULTIPLY":k="MIX_RGB_MULTIPLY";break;case "SUBTRACT":k="MIX_RGB_SUBTRACT";break;case "SCREEN":k="MIX_RGB_SCREEN";break;case "DIVIDE":k="MIX_RGB_DIVIDE";break;case "DIFFERENCE":k="MIX_RGB_DIFFERENCE";break;case "DARKEN":k="MIX_RGB_DARKEN";break;
case "LIGHTEN":k="MIX_RGB_LIGHTEN";break;case "OVERLAY":k="MIX_RGB_OVERLAY";break;case "DODGE":k="MIX_RGB_DODGE";break;case "BURN":k="MIX_RGB_BURN";break;case "HUE":k="MIX_RGB_HUE";break;case "SATURATION":k="MIX_RGB_SATURATION";break;case "VALUE":k="MIX_RGB_VALUE";break;case "COLOR":k="MIX_RGB_COLOR";break;case "SOFT_LIGHT":k="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":k="MIX_RGB_LINEAR_LIGHT";break;default:return Q.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}l=H(b);n=y(b);break;
case "OUTPUT":l=H(b);n=[];break;case "RGB":v=t(b,"Color");n.push(v);m.push(L(p("param_RGB_Color"),v.nb,3));break;case "SEPRGB":case "SEPHSV":l=H(b);n=y(b);break;case "TEXTURE":if(!b.texture)return Q.error("No texture attached to node: "+b.name),!1;a:{k=b.outputs;r=!1;for(v=0;v<k.length;v++)if(s=k[v],s.is_linked)switch(s.identifier){case "Color":k="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":k="TEXTURE_NORMAL";break a;case "Value":r=!0;break;default:throw"Unknown texture output";
}k=r?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}l.push(e(b,"Vector"));if("TEXTURE_COLOR"==k||"TEXTURE_ENVIRONMENT"==k)n.push(t(b,"Color")),n.push(t(b,"Value"));"TEXTURE_NORMAL"==k&&(n.push(t(b,"Normal")),n.push(t(b,"Value")));s=p("param_TEXTURE_texture");m.push(L(s));r={name:s,value:b.texture};break;case "VALUE":a:if(f){if(k=f.action){var G=k.d.va;for(v in G)if(G=v.match(/"(.*?)"/)[1],G==b.name){s=k.name+"_"+v;break a}}s=f.nla_tracks;for(w=0;w<s.length;w++)for(q=
s[w].strips,x=0;x<s[w].strips.length;x++)for(v in k=q[x].action,G=k.d.va,G)if(G=v.match(/"(.*?)"/)[1],G==b.name){s=k.name+"_"+v;break a}s=void 0}else s=null;v=t(b,"Value");s?(k="ANIM_VALUE",w={name:p("param_ANIM_VALUE_Value"),value:"0"},m.push(w),w={name:"-1",value:s},m.push(w)):(k="VALUE",m.push(L(p("param_value_value"),v.nb,1)));n.push(v);break;case "VECT_MATH":switch(b.operation){case "ADD":k="VECT_MATH_ADD";break;case "SUBTRACT":k="VECT_MATH_SUBTRACT";break;case "AVERAGE":k="VECT_MATH_AVERAGE";
break;case "DOT_PRODUCT":k="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":k="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":k="VECT_MATH_NORMALIZE";break;default:return Q.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=H(b);n=y(b);break;default:l=H(b),n=y(b)}g={name:g,type:k,ei:h,B:l,Pa:n,va:m,data:r};R.hk(a,R.Co(a),g);if(g="GEOMETRY"==b.type)a:{g=b.outputs;for(m=h=0;m<g.length;m++)if(g[m].is_linked&&h++>d){g=!0;break a}g=!1}return g&&!z(a,b,++d,f)?!1:!0}function F(a){var b=typeof a;
return"string"!=b&&"number"!=b&&"boolean"!=b&&a?ja.Zg(a):a}function p(a){ma[a]||(ma[a]=0);var b=a+ma[a],b=b.replace(/ /g,"_").replace(/\//g,"_");ma[a]++;return b}function B(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}
function e(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return x(e)}return null}function t(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return x(e)}return null}function x(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=ja.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,td:d,nb:a}}function K(a,b,c){return{name:a,identifier:b,td:!1,nb:c}}function H(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=x(a.inputs[c]);d.nb.length&&
d.nb.splice(3);b.push(d)}return b}function y(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=x(a.outputs[c]);b.push(d)}return b}function L(a,b,c){b=null===b||void 0===b?null:T.u(b,c);if(ka.Yl&&b){c="param_MAPPING_HEAVY_trs_matrix param_MAPPING_HEAVY_min_clip param_MAPPING_HEAVY_max_clip param_MAPPING_HEAVY_use_min param_MAPPING_HEAVY_use_max param_MAPPING_LIGHT_min_clip param_MAPPING_LIGHT_max_clip param_MAPPING_LIGHT_scale param_MAPPING_vector_type".split(" ");for(var d=!1,e=0;e<c.length;e++)if(0<=
a.indexOf(c[e])){d=!0;break}d&&(b=r(b))}return{name:a,value:b}}function r(a){a=a.replace(/(,)/g,"$1 ");a=a.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3");a=a.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3");return a=a.replace(/\s+/g,"")}function D(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function G(a){var b=[];R.L(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function V(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Nw,
f=c[d].data.Ow;if(!e)return!1;R.L(e,function(b,c){R.hk(a,R.Co(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);O(c[d],b,a)}return!0}function N(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function Z(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,k=0;k<b.length;k++)if(f.from_socket.identifier==b[k].to_socket.identifier){g=b[k];break}g?(f.from_node=g.from_node,
f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function P(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function M(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,k=0;k<c.B.length;k++)if(f.from_socket.identifier==c.B[k].identifier){g=c.B[k].nb;break}for(var k=f,h=b,l=g,n=m(k.to_node,h),r=0;r<n.length;r++)for(var p=R.Ea(h,n[r]),v=0;v<p.B.length;v++)if(p.B[v].identifier==k.to_socket.identifier){p.B[v].nb=
l;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function O(a,b,c){for(var d=a.name,e=[],f=[],g=[],k=[],h=0;h<b.length;h++){var l=b[h];N(l.from_node,d,l,e,g,k);N(l.to_node,d,l,f,g,k)}f=Z(b,f,g);e=Z(b,k,e);P(b,f);M(b,c,a,f);if(e.length){var n;R.L(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(n=b)});M(b,c,n,e)}}var Q=q("__print"),R=q("__graph"),T=q("__shaders"),ja=q("__util"),Y=q("__config"),W=q("vec3");q("vec4");var E=q("mat3"),aa=q("mat4"),ma={},v={},I={},U=0;new Float32Array(4);
var ka=Y.n;a.Ot=c;a.Pt=function(a){var b=[],c={};ma={};var d=R.Zq(a);R.L(d,function(a,d){var e;e=[];for(var f=[],g=[],k=[],h=[],l=[],n=0;n<d.B.length;n++){var m=d.B[n];if(m.td)e.push(null),f.push(null);else{e.push(p("in_"+d.type+"_"+m.identifier));var v=T.u(m.nb,0);ka.Yl&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==m.identifier||"Color2"==m.identifier||"Fac"==m.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==m.identifier||"Value_001"==m.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==
m.identifier)&&(v=r(v));f.push(v)}}for(n=0;n<d.Pa.length;n++)m=d.Pa[n],m.td?g.push(null):g.push(p("out_"+d.type+"_"+m.identifier));for(n=0;n<d.va.length;n++)m=d.va[n],k.push(m.name),h.push(m.value);for(n=0;n<d.ei.length;n++)l.push(d.ei[n].name);e={id:d.type,B:e,hp:f,Pa:g,va:k,pj:h,ei:l};b.push(e);c[a]=e});R.oe(d,function(a,b,e){var f=R.Ea(d,a);R.Ea(d,b);var g=f.Pa[e[0]];a=c[a].Pa;b=c[b].B;f=a[e[0]]||p("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in v)delete v[a];
for(var b in I)delete I[b];U=0}};b4w.module.__animation=function(a,q){function c(a,b){var c=a.w[b];c&&c.Sk&&c.jh&&(c.jh=!1,c.Sk(a))}function b(a,b,c){c=a.w[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.Rb=d;c.$c=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.lr=d}function g(a,b,c){a=a.w[c];a.type=50;a.$c=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Jc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function m(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:T.da("Wrong animation behavior")}}function f(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&b.push(d.action))}return b}function h(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function k(a,
b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function l(a,b,d){p(a,b,d);c(a,d);a.d.Hd&&(t(a,b),e(a,b))}function s(a,b,c){var d=b.frame_range,e=b.d,f=a.w[c];f.$c=b.name;f.Vm=d;f.Ss=e.Vw;f.Qs=e.st;f.start=d[0];f.length=d[1]-d[0];f.Rb=d[0];d=T.Te(e.wi);if(T.Ye(a)&&d){f.type=10;var g=n(a,b);g||(g=x(a,b,z(a)),a.Sg.push(b,g));f.e=g.e;f.ja=g.ja;var f=a.d,g=f.Dj,k=a.w[c],e=k.$l,h;a:{h=f.Bq;for(var l=0;l<h.length;l+=2)if(b==h[l]){h=h[l+1];break a}h=null}if(h)k.$l=h;else{for(k=0;k<g.length;k++)h=
x(a,b,g[k].gc),e.push(h);f.Bq.push(b,e)}f.Hd&&(b=f.Kj,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),w(a))}else if(O.Yd(a)&&(e.va.volume||e.va.pitch))f.volume=e.va.volume||null,f.pitch=e.va.pitch||null,f.type=40;else if("MESH"==a.type&&F(b)){f.type=70;e=n(a,b);if(!e){e=[];k=[];h=b.d;l=a.d.zh;for(g in h.va)for(var m=b.name+"_"+g,r=0;r<l.length;r+=2)if(m==l[r]){e.push(l[r+1]);k.push(h.va[g]);break}e={$y:e,az:k};a.Sg.push(b,e)}f.Cp=e.$y;f.Dp=e.az}else if(g=e.va.tsr){f.type=20;e=n(a,b);if(!e){e=
b.d.Gp;k=[];h=[];for(l=0;l<e;l++)k.push(g.subarray(8*l,8*l+4)),h.push(g.subarray(8*l+4,8*l+8));e={e:k,ja:h};a.Sg.push(b,e)}f.e=e.e;f.ja=e.ja;N.ag(a)&&N.Uy(a,f.e,f.ja)}else P.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),f.type=60;T.Ye(a)&&!d&&u(a,c)}function n(a,b){for(var c=a.Sg,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function w(a){var b=a.d.Kj;if(-1!=b[0]&&-1!=b[1]){var c=a.w;a=c[b[1]].Rb;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Rb;
d=Math.floor(a);b.Rb=d+e}}function u(a,b){var c=a.d.Kj,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.w;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function z(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={sn:d,fh:d,Ol:T.el(a,"name",e),nr:-1}}return c}function F(a){a=a.d;for(var b in a.va)if(-1!=b.indexOf("nodes"))return!0;return!1}function p(a,b,c){if((c=a.w[c])&&(c.play||0==b)){var d=a.d,e=c.Rb,f=c.start,g=c.length,
e=e+c.speed*b*Y.ua,k=c.type,h=c.speed;if(0<=h&&e>=f+g||0>h&&e<f)switch(c.jh=!0,c.behavior){case 10:e=0<=h?(e-f)%g+f:f+g-1E-6;break;case 20:e=0<=h?f:f+g-1E-6;c.play=!1;break;case 30:e=0<=h?f+g-1E-6:f,c.play=!1}c.Rb=e;switch(k){case 10:if(!d.Hd){e=B(c,e,W);b=e[0];f=e[1];e=e[2];d.Vb=c.ja[b];d.Ub=c.ja[f];d.dc=c.e[b];d.cc=c.e[f];d.Qe=e;d=d.Dj;c=c.$l;for(g=0;g<d.length;g++)k=d[g],h=c[g],k.Vb=h.ja[b],k.Ub=h.ja[f],k.dc=h.e[b],k.cc=h.e[f],k.Qe=e;Q.v(a)}break;case 20:k=e=B(c,e,W);(d=E)||(d=new Float32Array(4));
var f=k[0],g=k[1],k=k[2],h=c.e,l=h[f][1],n=h[f][2],m=h[g][1],r=h[g][2];d[0]=(1-k)*h[f][0]+k*h[g][0];d[1]=(1-k)*l+k*m;d[2]=(1-k)*n+k*r;f=e;(g=ma)||(g=new Float32Array(4));k=c.ja;ja.slerp(k[f[0]].subarray(0,4),k[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];k=c.e;e=(1-g)*k[e[0]][3]+g*k[e[1]][3];c.qm&&(g=aa,Q.get_translation(a,g),T.smooth_v(d,g,b,c.qm,d));c.Ql&&(g=v,Q.get_rotation(a,g),T.Eq(f,g,b,c.Ql,f));Q.set_translation(a,d);Q.set_rotation(a,f);Q.set_scale(a,e);Q.v(a);Z.sync_transform(a);break;case 30:(a=
W)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=b-=1,f=1);c=c.lr;a[0]=b+c;a[1]=e+c;a[2]=f;e=W;d.vm=e[0];d.kr=e[2];break;case 40:e=B(c,e,W);b=e[0];d=e[1];e=e[2];c.volume&&O.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&O.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:N.Lx(c.Jc,e/Y.ua);break;case 70:e=B(c,e,W);b=e[0];d=e[1];e=e[2];f=c.Dp;c=c.Cp;for(g=0;g<c.length;g++)k=f[g],a.d.jf[c[g]]=(1-e)*k[b]+e*k[d];
break;case 60:break;default:throw"Unknown animation type:"+k;}}}function B(a,b,c){c||(c=Array(3));var d=a.Vm[0],e=a.Vm[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Ss;e=Math.floor(b);a=a.Qs[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function e(a,b){var c=a.d,d=c.Gd,e=c.Kj,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.w[f];if(g.play||0==b)var k=B(g,g.Rb,W),h=k[0],l=k[1],k=k[2],n=g.ja[h],m=g.ja[l],h=g.e[h],l=g.e[l];else d=1}else d=1;e=a.w[e];if(e.play||0==b)var k=B(e,e.Rb,W),r=k[0],p=k[1],k=k[2];else if(-1!=f&&
g.play)d=0;else return;f=e.ja[r];g=e.ja[p];r=e.e[r];e=e.e[p];if(1==d)c.Vb.set(f),c.Ub.set(g),c.dc.set(r),c.cc.set(e);else if(0==d)c.Vb.set(n),c.Ub.set(m),c.dc.set(h),c.cc.set(l);else{for(p=0;p<n.length;p+=4){for(var s=ma,u=v,w=0;4>w;w++)s[w]=n[p+w],u[w]=f[p+w];ja.slerp(s,u,d,s);for(w=0;4>w;w++)c.Vb[p+w]=s[w];for(w=0;4>w;w++)s[w]=m[p+w],u[w]=g[p+w];ja.slerp(s,u,d,s);for(w=0;4>w;w++)c.Ub[p+w]=s[w]}T.on(h,r,d,c.dc);T.on(l,e,d,c.cc)}d=c.Dj;n=c.yp;for(p=0;p<d.length;p++){m=d[p];h=n[p];for(l=0;l<h.length;l+=
2)for(r=h[l],f=h[l+1],g=0;4>g;g++)m.Vb[r+g]=c.Vb[f+g],m.Ub[r+g]=c.Ub[f+g],m.dc[r+g]=c.dc[f+g],m.cc[r+g]=c.cc[f+g];m.Qe=k}}}function t(a,b){var c=a.d,d=c.Gd,e=c.gk;if(0!=e){var d=c.fk-d,f=e*b;T.sign(d)==T.sign(e)&&Math.abs(f)<Math.abs(d)?c.Gd+=f:(c.Gd=c.fk,c.gk=0)}}function x(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.Gp,k=0;k<g;k++){for(var h=0;h<d.length;h++){var l=d[h],n=R.create(),m=b.d.wi[l.name];m&&R.copy(m.subarray(8*k,8*k+8),n);l.Tm=n;l.mi=!1}h=K(a,c);e.push(h.e);f.push(h.ja)}return{e:e,
ja:f}}function K(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),k;for(k in b){var h=b[k],l=h.fh,n=e[h.Ol],h=f,m=g,r=n.Is,p=r[r.length-1],v=p.ck;p.mi||R.identity(v);for(p=r.length-1;0<=p;p--){var n=r[p],s=n.ck;if(n.mi)v=s;else{var u=n.Um,w=n.Tm;R.invert(u,I);R.multiply(w,I,I);R.multiply(u,I,I);R.multiply(v,I,s);v=s;n.mi=!0}}n=n.ck;h[0]=n[0];h[1]=n[1];h[2]=n[2];h[3]=n[3];m[0]=n[4];m[1]=n[5];m[2]=n[6];m[3]=n[7];ja.normalize(m,m);for(h=0;4>h;h++)m=4*l+h,c[m]=f[h],d[m]=g[h]}c=
new Float32Array(c);d=new Float32Array(d);return{e:c,ja:d}}function H(a,b,c,d,e,f,g){var k=a+(b-a)/2,h=y(k,d,e,f,g)-c;return.02>Math.abs(h)?k:0<h?H(a,k,c,d,e,f,g):H(k,b,c,d,e,f,g)}function y(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function L(a,b){a.w||(a.w=[null,null,null,null,null,null,null,null]);a.w[b]={type:null,$c:null,ja:null,e:null,$l:[],play:!1,behavior:20,Rb:0,start:0,length:0,qm:0,Ql:0,jh:!1,lr:null,speed:1,volume:null,pitch:null,Dp:[],Cp:[]};a.Sg=a.Sg||[];-1==U.indexOf(a)&&
U.push(a)}function r(a,b){Q.v(a);Z.sync_transform(a);l(a,0,b)}function D(a,c,d){d=d||0;if(T.sc(a)){var e=T.keysearch("name",c,a.data.b4w_vertex_anim);if(e)return L(a,d),b(a,e,d),r(a,d),1;if((e=T.keysearch("name",c,a.particle_systems))&&"EMITTER"==e.settings.type)return L(a,d),g(a,e,d),r(a,d),1}if(e=T.keysearch("name",c,ka)||T.keysearch("name",c+"_B4W_BAKED",ka)){if(!T.Te(e.fcurves))return P.error('No fcurves in action "'+e.name+'"'),0;L(a,d);s(a,e,d);r(a,d);return 1}P.error('Unsupported object: "',
a.name,'" or animation name: "',c,'"');return 0}function G(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var V=q("__config"),N=q("__particles"),Z=q("__physics"),P=q("__print"),M=q("__scenes"),O=q("__sfx"),Q=q("__transform"),R=q("__tsr"),T=q("__util");q("mat4");var ja=q("quat");q("vec4");var Y=V.Jd;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=
30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var W=Array(3),E=new Float32Array(3),aa=new Float32Array(3),ma=new Float32Array(4),v=new Float32Array(4),I=new Float32Array(8);new Float32Array(16);var U=[],ka=[];a.frame_to_sec=function(a){return a/Y.ua};a.update=function(a){for(var b=
0;b<U.length;b++){for(var d=U[b],f=0;8>f;f++)p(d,a,f);d.d.Hd&&(t(d,a),e(d,a))}for(b=0;b<U.length;b++)for(d=U[b],f=0;8>f&&d.w;f++)c(d,f)};a.wv=function(){return ka};a.Iv=function(a,b){var c=a.w[b];return c&&c.$c?d(c.$c):null};a.get_anim_names=function(a){var b=[];if(T.sc(a)&&a.d.ci)for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var e,c=[];for(e=0;e<ka.length;e++){var g=ka[e],k=g.d;T.Te(g.d.wi)?"ARMATURE"==a.type&&c.push(g):k.va.volume||k.va.pitch?O.Yd(a)&&c.push(g):
F(g)||c.push(g)}"MESH"==a.type&&(c=c.concat(f(a)));e=c;for(c=0;c<e.length;c++)b.push(d(e[c].name));if(N.ag(a)&&N.Ti(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.ly=d;a.get_anim_type=function(a,b){var c=a.w[b];return c?c.type:null};a.apply_def=function(a){var c=0,d;d=[];var e=a.animation_data;if(e&&e.action){var k=T.Te(e.action.d.wi);"ARMATURE"!=a.type&&k||d.push(e.action)}O.Yd(a)&&a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);
"MESH"==a.type&&(d=d.concat(f(a)));for(e=0;e<d.length;e++)k=d[e],T.Te(k.fcurves)?(L(a,c),s(a,k,c),r(a,c),a.w[c].behavior=m(a.b4w_anim_behavior),c++):P.error('No fcurves in action "'+k.name+'"');k=a.particle_systems;for(e=0;e<k.length;e++){var h=k[e],l=h.settings;"EMITTER"==l.type&&(L(a,c),g(a,h,c),r(a,c),a.w[c].behavior=m(a.b4w_anim_behavior),l.b4w_cyclic&&(a.w[c].behavior=10),c++)}T.sc(a)&&a.d.ci?(L(a,c),b(a,a.data.b4w_vertex_anim[0],c),r(a,c),a.w[c].behavior=m(a.b4w_anim_behavior)):d.length||N.Ti(a)||
(L(a,0),d=a.w[0],d.type=60,d.$c=a.name+"_STATIC",e=M.Pv(M.get_active()),d.start=e[0],d.length=e[1]-e[0]+1,r(a,c))};a.get_first_armature_object=h;a.play=function(a,b,c){k(a.w,c,function(a){a.play=!0;a.Sk=b?b:null;a.jh=!1});a.d.Hd&&w(a)};a.stop=function(a,b){k(a.w,b,function(a){a.play=!1;a.Sk=null;a.jh=!1})};a.is_play=function(a,b){var c=a.w[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.w;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Rb=b,l(a,0,c))}else if(e=d[c])e.Rb=b,l(a,
0,c)};a.get_current_frame_float=function(a,b){var c=a.w[b];return c&&c.Rb?c.Rb:0};a.is_cyclic=function(a,b){var c=a.w[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){k(a.w,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.w[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){k(a.w,d,function(a){a.qm=b||0;a.Ql=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.w[c]=null;else a.w[b]=null;a.d.Hd&&u(a,b)};a.update_object_animation=l;a.Wi=
function(a){if("ARMATURE"==a.type||h(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||N.ag(a)&&N.Ti(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||G(a)?!0:!1};a.is_animated=function(a){return a.w?!0:!1};a.yt=z;a.vn=K;a.Us=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ja.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=
4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var k=g}else-1<c.indexOf("location")?(c="tsr",k=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",k=g):-1<c.indexOf("scale")?(c="tsr",k=g):k=0;if(!a[c]){b=a;var h=c;if("object"==typeof k&&k.length)for(var l=k.length,n=new Float32Array(e*l),m=0;m<e;m++)for(var r=0;r<l;r++)n[m*l+r]=k[r];else if("number"==typeof k)for(n=new Float32Array(e),m=0;m<e;m++)n[m]=k;else throw"Wrong storage default value";
b[h]=n}return a[c]}a.d={};var e=a.d;e.Vw=1/Y.Re;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=R.create(),k=a.fcurves,h={},l={},n=0,m;for(m in k){var r=k[m],p;for(p in r){var v=r[p].Pb;n||(n=v.length);for(var s=d(h,l,m,n),u=s.length/n,w=c(m,p|0),t=0;t<n;t++)s[t*u+w]=v[t]}}for(var q in h)"tsr"==q&&b(h[q],n);for(var I in l)b(l[I],n);e.va=h;e.wi=l;e.st=a.Hs;e.Gp=n;ka.push(a)};a.Av=function(a,b){return(b-a)*Y.Re+1};a.kt=function(a,b,c,d,e,f){var g,k,h=new Float32Array(2),l=new Float32Array(2),n=new Float32Array(2),
m=new Float32Array(2),r=b[1],p=b[2],v=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var s=0,u=0,w=null;e<=f;e++)if(e<r)for(var t=0;t<Y.Re;t++)c[s++]=p;else if(e>v)for(t=0;t<Y.Re;t++)c[s++]=a;else{var q=b[u],I=3;0===q&&(I+=2);0===w&&(I+=2);var z=2===q?0:1;if(b[u+1]==b[u+I+1])w=q,u+=I;else{t=0;e==b[u+1]&&(z&&(d[s]=1),c[s]=b[u+2],s++,t++);if(e==v)for(;t<Y.Re;t++)c[s++]=a;else for(h[0]=b[u+1],h[1]=b[u+2],0!==q?(l[0]=0,l[1]=0):0===w?(l[0]=b[u+5],l[1]=b[u+6]):(l[0]=b[u+3],l[1]=b[u+4]),0!==q?(n[0]=
0,n[1]=0):(n[0]=b[u+I+3],n[1]=b[u+I+4]),m[0]=b[u+I+1],m[1]=b[u+I+2];t<Y.Re;t++){var x=e+t/Y.Re;switch(q){case 0:g=h;k=l;var U=n,D=m,B=[],F=[],G=void 0,E=void 0,K=void 0,G=void 0;B[0]=g[0]-k[0];B[1]=g[1]-k[1];F[0]=D[0]-U[0];F[1]=D[1]-U[1];K=D[0]-g[0];G=Math.abs(B[0]);E=Math.abs(F[0]);0!=G+E&&G+E>K&&(G=K/(G+E),k[0]=g[0]-G*B[0],k[1]=g[1]-G*B[1],U[0]=D[0]-G*F[0],U[1]=D[1]-G*F[1]);z&&(d[s]=1);c[s]=y(H(0,1,x,h[0],l[0],n[0],m[0]),h[1],l[1],n[1],m[1]);s++;break;case 1:k=h[0];U=h[1];g=D=(m[1]-U)/(m[0]-k);
k=U-D*k;z&&(d[s]=1);c[s]=g*x+k;s++;break;case 2:z&&(d[s]=1);c[s]=b[u+2];s++;break;default:throw"Unknown keyframe intepolation mode: "+q;}}e+1==b[u+I+1]&&(w=q,u+=I)}}};a.oA=function(a){for(var b=0;b<a.length;b++)if(a[b].Fz)return a[b];return!1};a.apply=D;a.get_slot_num_by_anim=function(a,b){for(var c=a.w,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.$c)==d(b))return e}return-1};a.yv=function(a,b){var c=a.w[b];return c&&c.$c?d(c.$c):null};a.remove=function(a){a.w=null;a=U.indexOf(a);-1!=a&&U.splice(a,1)};
a.jx=function(a){for(var b=ka.length-1;0<=b;b--)ka[b].Js==a&&ka.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.w)return D(a,b,0)?0:-1;for(var c=0;c<a.w.length;c++)if(!a.w[c])return D(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.gk=(b-a.d.Gd)/c;a.d.fk=b};a.set_speed=function(a,b,c){k(a.w,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.w[b].speed};a.get_anim_start_frame=function(a,b){return a.w[b].start};a.get_anim_length=function(a,b){return a.w[b].length};a.hl=
G;a.cleanup=function(){U.length=0;ka.length=0};a.av=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Pb.length,e=ma,f=E,g=Boolean(c[0]);g||(c[0]={Pb:new Float32Array(d)});var k=Boolean(c[1]);k||(c[1]={Pb:new Float32Array(d)});var h=Boolean(c[2]);h||(c[2]={Pb:new Float32Array(d)});c[3]={Pb:new Float32Array(d)};for(var l=0;l<d;l++)f[0]=g?c[0].Pb[l]:0,f[1]=k?c[1].Pb[l]:0,f[2]=h?c[2].Pb[l]:0,T.euler_to_quat(f,e),c[0].Pb[l]=e[3],c[1].Pb[l]=e[0],c[2].Pb[l]=e[1],c[3].Pb[l]=e[2];d=b.replace("euler","quaternion");
a[d]=c;delete a[b]}};b4w.module.__transform=function(a,q){function c(a){var n=a.d;d.Ky(a,e);g.Iy(a);"CAMERA"==a.type&&g.Mt(a);var p=n.e,u=n.scale,w=n.quat;l.Uh(p,u,w,n.Tc);var q=n.H;z.identity(q);z.fromQuat(w,q);"CAMERA"!=a.type&&s.tx(q,u,q);q[12]=p[0];q[13]=p[1];q[14]=p[2];z.invert(q,n.ip);a.w&&f.Ti(a)&&f.Ly(a);n.Db&&n.Ia&&(b.pk(n.Db,q,n.Ia),b.rk(n.rc,q,n.kb),b.qk(n.Ee,n.Tc,n.Fe),n.Nb&&h.Wl(h.get_active()));switch(a.type){case "SPEAKER":k.cy(a,e);break;case "CAMERA":g.dr(a);h.W()&&k.zw(h.get_active(),p,w,e);break;case "LAMP":m.Ny(a);
h.W()&&h.Oj(a,h.get_active());break;case "EMPTY":a.field&&h.fr(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!h.W()||(n=h.get_active(),h.Wl(n),h.xx(n));a=a.Fd;for(n=0;n<a.length;n++)c(a[n])}var b=q("__boundings"),g=q("__camera"),d=q("__constraints"),m=q("__lights"),f=q("__particles"),h=q("__scenes"),k=q("__sfx"),l=q("__tsr"),s=q("__util"),n=q("vec3"),w=q("quat"),u=q("mat3"),z=q("mat4"),F=new Float32Array(3),p=new Float32Array(4),B=new Float32Array(9),e=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){e=
a};a.set_translation=function(a,b){d.rd(a)==d.Yc?l.Mx(b,d.qd(a)):a.d.e.set(b)};a.get_translation=function(a,b){d.rd(a)==d.Yc?n.copy(l.Qo(d.qd(a)),b):n.copy(a.d.e,b)};a.set_rotation=function(a,b){d.rd(a)==d.Yc?l.Xl(b,d.qd(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){d.rd(a)==d.Yc?w.copy(l.Lo(d.qd(a)),b):w.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(d.rd(a)==d.Yc){var c=s.euler_to_quat(b,p);l.Xl(c,d.qd(a))}else s.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){d.rd(a)==d.Yc?l.set_scale(b,
d.qd(a)):a.d.scale=b};a.get_scale=function(a){return d.rd(a)==d.Yc?l.get_scale(d.qd(a)):a.d.scale};a.Vv=function(a,b){if(d.rd(a)==d.Yc)l.copy(d.qd(a),b);else{var c=a.d;l.Uh(c.e,c.scale,c.quat,b)}};a.vq=function(a,b){if(d.rd(a)==d.Yc)l.copy(b,d.qd(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),
b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,n.copy(b.kb.t,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,n.transformMat4(c,b.H,c));return c};a.move_local=function(a,b,c,d){a=a.d;F[0]=b;F[1]=c;F[2]=d;b=u.fromMat4(a.H,B);n.transformMat3(F,b,F);n.add(a.e,F,a.e)};a.v=c;a.distance=function(a,b){return n.dist(a.d.e,b.d.e)};a.Sw=function(a,b){return n.dist(a.d.e,
b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Ia.max_x,min_x:a.d.Ia.min_x,max_y:a.d.Ia.max_y,min_y:a.d.Ia.min_y,max_z:a.d.Ia.max_z,min_z:a.d.Ia.min_z}}};b4w.module.__tsr=function(a,q){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],f=b[1],g=b[2],h=b[3],m=b[4],p=b[5],q=b[6];b=b[7];var e=a[0]*h,t=a[1]*h,x=a[2]*h;a=b*e+p*x-q*t;var h=b*t+q*e-m*x,K=b*x+m*t-p*e,e=-m*e-p*t-q*x;c[0]=a*b+e*-m+h*-q-K*-p;c[1]=h*b+e*-p+K*-m-a*-q;c[2]=K*b+e*-q+a*-p-h*-m;c[0]+=d;c[1]+=f;c[2]+=g;return c}var g=q("__util"),d=q("vec3"),m=q("quat");q("mat4");var f=new Float32Array(3),h=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.Of=function(a,b,d,f){f||(f=new Float32Array(8));c(a,b,d,f);return f};a.Uh=c;a.Mx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Nx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Xl=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Qo=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.Lo=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],f=a[1],g=a[2];h[0]=a[4];h[1]=a[5];h[2]=a[6];h[3]=a[7];m.invert(h,h);var q=h[0],F=h[1],p=h[2],B=h[3],d=d*c,f=f*c,e=g*c,g=B*d+F*e-p*f,t=B*f+p*d-q*e,x=B*e+q*f-F*d,d=-q*d-F*f-p*e;b[0]=-(g*B+d*-q+t*-p-x*-F);b[1]=-(t*B+d*-F+x*-q-g*-p);b[2]=-(x*B+d*-p+g*-F-t*-q);b[3]=c;b[4]=q;b[5]=F;b[6]=p;b[7]=B;return b};a.Ao=function(a,b){var d=g.hf(a,f),n=g.dj(a),m=g.matrix_to_quat(a,
h);c(d,n,m,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var f=a[4],g=a[5],h=a[6];a=a[7];var m=c[4],q=c[5],p=c[6];c=c[7];d[4]=f*c+a*m+g*p-h*q;d[5]=g*c+a*q+h*m-f*p;d[6]=h*c+a*p+f*q-g*m;d[7]=a*c-f*m-g*q-h*p;return d};a.Yh=b;a.Eg=function(a,b,c,d){d||(d=0);var f=a.length,g=b[0],h=b[1],m=b[2],p=b[3],q=b[4],e=b[5],t=b[6];b=b[7];for(var x=0;x<f;x+=3){var K=a[x]*p,H=a[x+1]*p,y=a[x+2]*p,L=b*K+e*y-t*H,r=b*H+t*K-q*y,D=b*y+q*H-e*K,K=-q*K-e*H-t*y;c[d+x]=L*b+K*-q+r*-t-D*-e;c[d+x+1]=r*b+K*-e+
D*-q-L*-t;c[d+x+2]=D*b+K*-t+L*-e-r*-q;c[d+x]+=g;c[d+x+1]+=h;c[d+x+2]+=m}};a.Jj=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],h=b[4],m=b[5],p=b[6];b=b[7];for(var q=0;q<f;q+=3){var e=a[q]*g,t=a[q+1]*g,x=a[q+2]*g,K=b*e+m*x-p*t,H=b*t+p*e-h*x,y=b*x+h*t-m*e,e=-h*e-m*t-p*x;c[d+q]=K*b+e*-h+H*-p-y*-m;c[d+q+1]=H*b+e*-m+y*-h-K*-p;c[d+q+2]=y*b+e*-p+K*-m-H*-h}};a.Ij=function(a,b,c){var d=b[3],f=b[4],g=b[5],h=b[6];b=b[7];var m=a[0]*d,p=a[1]*d,q=a[2]*d;a=b*m+g*q-h*p;var d=b*p+h*m-f*q,e=b*q+f*p-g*m,m=-f*m-g*p-
h*q;c[0]=a*b+m*-f+d*-h-e*-g;c[1]=d*b+m*-g+e*-f-a*-h;c[2]=e*b+m*-h+a*-g-d*-f};a.$q=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],h=b[4],m=b[5],p=b[6];b=b[7];for(var q=0;q<f;q+=4){var e=a[q]*g,t=a[q+1]*g,x=a[q+2]*g,K=b*e+m*x-p*t,H=b*t+p*e-h*x,y=b*x+h*t-m*e,e=-h*e-m*t-p*x;c[d+q]=K*b+e*-h+H*-p-y*-m;c[d+q+1]=H*b+e*-m+y*-h-K*-p;c[d+q+2]=y*b+e*-p+K*-m-H*-h;c[d+q+3]=a[q+3]}};a.translate=function(a,b,c){var d=a[3],f=a[4],g=a[5],h=a[6],m=a[7],p=b[0]*d,q=b[1]*d,e=b[2]*d;b=m*p+g*e-h*q;var d=m*q+h*p-f*e,t=
m*e+f*q-g*p,p=-f*p-g*q-h*e;c[0]=a[0]+b*m+p*-f+d*-h-t*-g;c[1]=a[1]+d*m+p*-g+t*-f-b*-h;c[2]=a[2]+t*m+p*-h+b*-g-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.RA=function(a,b,c,f){f||(f=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,f.subarray(0,3));var g=a[3];f[3]=g+c*(b[3]-g);m.slerp(a.subarray(4),b.subarray(4),c,f.subarray(4));return f};a.mA=function(a,b,c,d){d||(d=new Float32Array(8));var f=a.subarray(0,3),g=b.subarray(0,3),h=d.subarray(0,3);h[0]=g[0]*(c+1)-f[0]*
c;h[1]=g[1]*(c+1)-f[1]*c;h[2]=g[2]*(c+1)-f[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);f=d.subarray(4);f[0]=b[0]*(c+1)-a[0]*c;f[1]=b[1]*(c+1)-a[1]*c;f[2]=b[2]*(c+1)-a[2]*c;f[3]=b[3]*(c+1)-a[3]*c;m.normalize(f,f);return d};a.mw=function(a,b,c,d,f){var g=a.subarray(0,3),h=f.subarray(0,3);h[0]=g[0]+b*c[0];h[1]=g[1]+b*c[1];h[2]=g[2]+b*c[2];f[3]=a[3];a=a.subarray(4);f=f.subarray(4);c=d[0];g=d[1];d=d[2];var h=a[0],q=a[1],p=a[2],B=a[3];f[0]=.5*(c*B+g*p-d*q);f[1]=.5*(g*B+d*h-c*p);f[2]=.5*
(d*B+c*q-g*h);f[3]=.5*(-c*h-g*q-d*p);f[0]=a[0]+f[0]*b;f[1]=a[1]+f[1]*b;f[2]=a[2]+f[2]*b;f[3]=a[3]+f[3]*b;m.normalize(f,f)}};b4w.module.__util=function(a,q){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function g(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function m(a,b){var c=b;switch(typeof a){case "number":return f(a,
c);case "string":return h(a,c);case "boolean":return f(a|0,c);case "function":case "undefined":return f(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=f(a[d],c);else if(d)for(d=0;d<a.length;d++)c=m(a[d],c);else for(var e in a)c=m(a[e],c)}else c=f(0,c)}return c}function f(a,b){var c=b;Z[0]=a;c=(c<<5)-c+P[0];c&=c;c=(c<<5)-c+P[1];return c&c}function h(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function k(a){return(34*a+1)*a%289}function l(a){return a-Math.floor(a)}function s(a){return n((34*a+5)*a)}function n(a){return a-289*Math.floor(a/289)}function w(a){return a-7*Math.floor(a/7)}function u(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!z(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!z(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function z(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return u(a,b);default:return!0}}var F=q("__print"),p=q("vec3"),B=q("vec4"),e=q("quat"),t=q("mat3"),x=q("mat4"),K=0,H={},y=new Float32Array(3),L=new Float32Array(3),r=new Float32Array(4),D=new Float32Array(4),
G=new Float32Array(9),V=new Float32Array(16),N=new Float32Array(16),Z=new Float64Array(1),P=new Uint32Array(Z.buffer),M=new Float32Array([0,0,0]),O=new Float32Array([0,0,0,1]),Q=new Float32Array([0,0,0,1,0,0,0,1]),R=new Float32Array([1,0,0]),T=new Float32Array([0,1,0]),ja=new Float32Array([0,0,1]),Y=new Float32Array([-1,0,0]),W=new Float32Array([0,-1,0]),E=new Float32Array([0,0,-1]),aa=Math.floor(44488.07041494893);a.Gs=M;a.Bs=O;a.Cz=Q;a.AXIS_X=R;a.AXIS_Y=T;a.AXIS_Z=ja;a.AXIS_MX=Y;a.AXIS_MY=W;a.AXIS_MZ=
E;a.keyfind=c;a.dv=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Dy=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Ht=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.lt=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.aB=function(a,b,c){for(var d=
c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.$A=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.el=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.ht=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.Wz=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==
a[d])return!1;return!0};a.nB=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.lB=function(a,b){var d=c("name",b,a);1<d.length&&F.error("obj_by_name(): name resolution ambiguity");return d};a.mB=function(a,b){var d=c("name",b,a),e=d.length;1<e&&F.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return d=d.concat(f)};
a.Ay=function(a,b,c,d){d||(d=new Float32Array(16));x.identity(d);d[12]=a;d[13]=b;d[14]=c};var ma=1;a.ex=function(){ma=(69069*ma+5)%Math.pow(2,32);return Math.round(ma/65536)%32768/32767};a.jy=function(a){ma=a};a.kc=function(a){var b=a[0]%aa*48271-3399*Math.floor(a[0]/aa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Vi=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/
2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.Su=function(a){var b=t.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,n=f*e,l=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*n-k;b[4]=g*l+h;b[5]=d*f;b[6]=g*h+l;b[7]=g*k-n;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>
h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));p.transformQuat(b,a,c);return c};a.iA=function(a,b,c){c||(c=new Float32Array(4));a=p.normalize(a,y);var d=p.dot(b,a);a=p.cross(b,a,L);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.By=function(a,b,c,d){d||
(d=new Float32Array(4));p.transformQuat(c,b,d);d[3]=-p.dot(a,d)};a.Ku=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":y[0]=0;y[1]=-1;y[2]=0;p.transformQuat(y,b,y);L[0]=0;L[1]=0;L[2]=-1;break;case "MESH":y[0]=0;y[1]=0;y[2]=1;p.transformQuat(y,b,y);L[0]=0;L[1]=0;L[2]=1;break;case "EMPTY":y[0]=0,y[1]=1,y[2]=0,p.transformQuat(y,b,y),L[0]=0,L[1]=1,L[2]=0}y[1]=0;p.normalize(y,y);a=p.dot(y,L);return Math.acos(a)*(0<-y[0]*L[2]?-1:1)};a.on=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=
(1-c)*a[e]+c*b[e]}};a.EB=function(){K++;return K.toString(16)};a.Lj=function(a){H[a]||(H[a]=0);var b=a+H[a];H[a]++;return b};a.hd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.mb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,C:0,Y:null,r:[],A:b}};a.fp=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};a.Ie=function(a){return JSON.parse(JSON.stringify(a))};
a.Yz=function(a,c){var d=[],e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.ra=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ra(b[d]):b[d];return c};a.Zg=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?
new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.sc=function(a){return"MESH"===a.type?!0:!1};a.kp=function(a){return"MESH"===a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.qw=function(a){return"EMPTY"===a.type?!0:!1};a.Ye=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));t.fromMat4(a,G);var c=G[0],d=G[3],f=G[6],g=G[1],h=G[4],
k=G[7],n=G[2],l=G[5],m=G[8],c=Math.sqrt(c*c+d*d+f*f)||1,g=Math.sqrt(g*g+h*h+k*k)||1,n=Math.sqrt(n*n+l*l+m*m)||1;G[0]/=c;G[3]/=c;G[6]/=c;G[1]/=g;G[4]/=g;G[7]/=g;G[2]/=n;G[5]/=n;G[8]/=n;e.fromMat3(G,b);return b};a.hf=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.dj=function(a){r[0]=.577350269189626;r[1]=.577350269189626;r[2]=.577350269189626;r[3]=0;B.transformMat4(r,a,r);return B.length(r)};a.qo=function(a,b){var c=b.left,d=b.right,e=b.top,f=b.bottom,h=b.Fa,k=
b.La;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];g(c);g(d);g(e);g(f);g(h);g(k)};a.ey=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||
c<-d(a,b.Fa)||c<-d(a,b.La)?!0:!1};a.Ru=function(a,b,c,e,f){g=p.dot(c,b.La);h=p.dot(e,b.La);k=p.dot(f,b.La);g=Math.sqrt(g*g+h*h+k*k);if(g<-d(a,b.Fa)||g<-d(a,b.La))return!0;var g=p.dot(c,b.left),h=p.dot(e,b.left),k=p.dot(f,b.left);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.left))return!0;g=p.dot(c,b.right);h=p.dot(e,b.right);k=p.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.right))return!0;g=p.dot(c,b.top);h=p.dot(e,b.top);k=p.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.top))return!0;g=p.dot(c,b.bottom);
h=p.dot(e,b.bottom);k=p.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-d(a,b.bottom)?!0:!1};a.ce=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.dz=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.xy=function(a,b,c){for(var d=
0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.bz=function(a,b,c){c||(c=new Float32Array(3));r[0]=a[0];r[1]=a[1];r[2]=a[2];r[3]=0;B.transformMat4(r,b,r);c[0]=r[0];c[1]=r[1];c[2]=r[2]};a.pA=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=
0;f<d;f++)b[e*d+f]=a[e][f];return b};a.cz=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.ui=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.ui(b,c,d,f-1):b[f]<c?a.ui(b,c,f+1,e):f};a.Ld=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Ci=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.tx=function(a,b,c){c||(c=new Float32Array(16));for(var d=
0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.rm=function(a,b,c,d){d||(d=new Float32Array(16));b=x.fromRotationTranslation(b,c,V);x.multiply(b,a,d)};a.Yh=function(a,b,c,d,e){e||(e=new Float32Array(3));c=x.fromRotationTranslation(c,d,V);1!==b&&(d=x.identity(N),b=p.set(b,b,b,y),x.scale(d,b,d),x.multiply(c,d,c));p.transformMat4(a,c,e);return e};a.sm=function(a,b,c,d){d||(d=new Float32Array(4));b=x.fromRotationTranslation(b,c,V);B.transformMat4(a,b,d)};a.SA=function(a,b,c,
d,e){e||(e=new Float32Array(3));b=x.fromRotationTranslation(c,d,V);x.invert(b,b);p.transformMat4(a,b,e);return e};a.BB=function(a,b,c){c||(c=new Float32Array(16));x.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.jB=function(b,c,d){a.hf(b,c);c[3]=a.dj(b);a.matrix_to_quat(b,d)};a.cn=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.qq=function(a,b,c,d){d||(d=new Float32Array(3));p.subtract(b,a,y);p.transformQuat(y,c,y);p.subtract(b,y,d)};
a.nv=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);x.lookAt(a,[-1,0,0],[0,-1,0],b);x.scale(b,[-1,1,1],b);x.scale(b,[-1,1,-1],c);x.lookAt(a,[0,-1,0],[0,0,-1],d);x.scale(d,[1,1,-1],d);x.scale(d,[1,-1,-1],e);x.lookAt(a,[0,0,-1],[0,-1,0],f);x.scale(f,[-1,1,1],f);x.scale(f,[-1,1,-1],g);return[b,c,d,e,f,g]};a.Xg=function(a,b){return m(a,b)};a.hash_code=m;a.LA=h;a.iB=function(a,
b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,n,l,m,r,p,s,u,w;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];n=a[4];l=a[5];m=a[6];r=a[7];p=a[8];s=a[9];u=a[10];w=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=n;c[5]=l;c[6]=m;c[7]=r;c[8]=p;c[9]=s;c[10]=u;c[11]=w;c[12]=f*d+n*e+p*b+a[12];c[13]=g*d+l*e+s*b+a[13];c[14]=h*d+m*e+u*b+a[14];c[15]=k*d+r*e+w*b+a[15];return c};a.Ew=function(a,
b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.dx=function(a){return a*Math.PI/180};a.fA=function(a){return 180*a/Math.PI};
a.dm=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,h=a+.211324865405187-g,n=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,r=k(k(d)+c),g=k(k(d+g)+c+f),p=k(k(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),f=Math.max(.5-(n*n+m*m),0),s=2*l(.024390243902439*r)-1,u=2*l(.024390243902439*g)-1,w=2*l(.024390243902439*
p)-1,r=Math.abs(s)-.5,g=Math.abs(u)-.5,p=Math.abs(w)-.5,s=s-Math.floor(s+.5),u=u-Math.floor(u+.5),w=w-Math.floor(w+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(s*s+r*r)),d=d*d*d*d*(1.79284291400159-.85373472095314*(u*u+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(w*w+p*p));return 130*(c*(s*b+r*a)+d*(u*e+g*h)+f*(w*n+p*m))};a.An=function(a){var b=1/7,c=b/2,d=n(Math.floor(a[0])),e=n(Math.floor(a[1])),f=l(a[0]);a=l(a[1]);var g=f-.5,h=f-1.5,f=a-.5;a-=1.5;var k=s(d),m=s(d+1),r=k,d=m,k=s(k+e),
m=s(m+e),r=s(r+e+1),d=s(d+e+1),e=g+.7*(w(k)*b+c),p=h+.7*(w(m)*b+c),g=g+.7*(w(r)*b+c),h=h+.7*(w(d)*b+c),k=f+.7*(w(Math.floor(k*b))*b+c),f=f+.7*(w(Math.floor(m*b))*b+c),r=a+.7*(w(Math.floor(r*b))*b+c),b=a+.7*(w(Math.floor(d*b))*b+c);return Math.min(e*e+k*k,p*p+f*f,g*g+r*r,h*h+b*b)};a.quat_project=function(a,b,c,d,f){f||(f=new Float32Array(4));a=p.transformQuat(b,a,y);b=c[0];var g=c[1];c=c[2];G[0]=g*g+c*c;G[1]=-g*b;G[2]=-c*b;G[3]=-b*g;G[4]=b*b+c*c;G[5]=-c*g;G[6]=-b*c;G[7]=-g*c;G[8]=b*b+g*g;p.transformMat3(a,
G,a);p.normalize(a,a);e.rotationTo(d,a,f);return f};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=r,d=D,c=e.setAxisAngle([0,1,0],Math.PI,e.create()),d=e.setAxisAngle([1,0,0],Math.PI/2,e.create());e.multiply(c,d,c);e.multiply(a,c,b);return b};a.cleanup=function(){K=0;H={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);
for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Eq=function(a,b,c,d,f){f||(f=new Float32Array(a.length));e.slerp(a,b,Math.exp(-c/d),f)};a.TA=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=t.fromQuat(a,G);L[0]=0;L[1]=1;L[2]=0;y[0]=c[3];y[1]=c[4];y[2]=c[5];var d=p.cross(L,y,y);
p.normalize(d,d);var f=c[7];!b&&0<f&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);L[0]=c[0];L[1]=c[1];L[2]=c[2];p.normalize(L,L);e.rotationTo(L,d,D);e.multiply(D,a,a)};a.Eo=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],n=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(n*(1-d)+a*d)*f};a.vf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.oq=function(a){for(var b=
[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Rh=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.kv=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Te=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,
c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];p.normalize(c,c)};a.CB=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,n=h*d-f*a,l=f*e-g*d,m=g*l-h*n,h=h*k-f*l,f=f*n-g*k;c[0]=d+2*k*b+2*m;c[1]=e+2*n*b+2*h;c[2]=a+2*l*b+2*f;return c};a.da=function(a){a&&F.error.apply(F,arguments);throw"panic: see above for possible error messages";};a.ze=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.cl=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};
a.Rq=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=u(e,f)}if(!d)return!1}return!0};a.cx=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.jv=function(a){a+=1;132651<a&&F.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){r.set(a);r[3]=b;D.set(d);D[3]=0;a=B.dot(r,D);if(0==a)return null;
D.set(c);D[3]=1;a=-B.dot(r,D)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.$z=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.sq=function(a,b,c){var d=p.dot(a,b);-.9999999>d?(p.cross(R,a,y),1E-6>p.length(y)&&p.cross(T,a,y),p.normalize(y,y),e.setAxisAngle(y,Math.PI,c)):(p.cross(a,b,y),c.set(y),c[3]=1+d,e.normalize(c,c));return c}};b4w.module.__sfx=function(a,q){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;n.warn("B4W warning: deprecated WebAudio implementation");return null}n.warn("B4W warning: WebAudio is not supported");return null}function b(a,b,c){var e=a.g;if("NONE"!=e.behavior){c||(c=0);var g=e.loop,h=e.pitch;if(e.src&&(g||0<=c)){e.kk=Math.floor(5E4*Math.random());b=x.currentTime+b;e.Zb=b;e.state=20;var k=a.g;if(!k.Lb){var n=a.d.e,p=a.d.quat;if(z.hj){var s=x.createBiquadFilter();
s.type="peaking"}else s=null;var u=x.createGain();switch(k.behavior){case "POSITIONAL":var q=x.createPanner();q.panningModel=q.EQUALPOWER;q.distanceModel=q.INVERSE_DISTANCE;q.setPosition(n[0],n[1],n[2]);k.sl.set(n);var t=F;w.quat_to_dir(p,w.AXIS_MY,t);q.setOrientation(t[0],t[1],t[2]);k.direction.set(t);q.refDistance=k.dist_ref;q.maxDistance=k.dist_max;q.rolloffFactor=k.attenuation;q.coneInnerAngle=k.Rt;q.coneOuterAngle=k.St;q.coneOuterGain=k.Tt;t=x.createGain();t.gain.value=l(k);s?(q.connect(s),s.connect(t)):
q.connect(t);t.connect(u);k.Lb=q;if(k.Mg){var y=x.createGain();u.connect(y);y.connect(x?K.g.Lb:null)}else y=null,u.connect(x?K.g.Lb:null);break;case "BACKGROUND_SOUND":q=null;t=x.createGain();t.gain.value=l(k);s?(k.Lb=s,s.connect(t)):k.Lb=t;t.connect(u);k.Mg?(y=x.createGain(),u.connect(y),y.connect(x?K.g.Lb:null)):(y=null,u.connect(x?K.g.Lb:null));break;case "BACKGROUND_MUSIC":y=q=null,t=x.createGain(),t.gain.value=l(k),s?(k.Lb=s,s.connect(t)):k.Lb=t,t.connect(u),u.connect(x?K.g.Lb:null)}k.Dh=q;k.Hc=
s;k.Wf=t;k.Oe=u;k.hq=y}if("POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior)a=x.createBufferSource(),a.buffer=e.src,a.playbackRate.value=h,g?(e.Ya&&e.Ya.disconnect(),a.loop=!0,a.start(b),e.duration=0):(g=a.buffer?a.buffer.duration:0,c>g?(g=b+c+e.nd,a.loop=!0,a.start(b),a.stop(g),e.duration=c):(a.loop=!1,a.start(b),e.duration=g)),a.connect(e.Lb),e.Ya=a,d(e),m(e);else if("BACKGROUND_MUSIC"==e.behavior){window.clearTimeout(e.mn);c=a.g;if(g=c.src)g.volume=1,g.loop=c.cyclic,c.Ya=c.Ya||x.createMediaElementSource(g),
c.Ya.connect(c.Lb),20==c.state&&g.play();e.duration=1E6}f(e,b)}}}function g(a){var c=a.g,d=c.duration,c=c.delay+c.Hu*Math.random();b(a,c,d)}function d(a){a.Mg&&a.hq.gain.cancelScheduledValues(a.Zb);a.Ih&&a.Ya.playbackRate.cancelScheduledValues(a.Zb);a.di=a.Zb}function m(a){if(a.Mg||a.Ih){var b=a.hq,c=a.Ya,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Zb;y[0]=a.kk;for(var f=0;5>f;){var g=a.pitch+a.Ih*w.kc(y);if(e>=a.di){if(a.Mg){var h=1-w.clamp(a.Mg,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Ih&&
c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.di=e-.001}}}function f(a,b){if(a.Rk||a.nd){var c=a.Oe;c.gain.cancelScheduledValues(b);a.Rk?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Rk)):c.gain.setValueAtTime(1,b);a.nd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.nd))}}function h(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.g;if(20==a.state||40==a.state){var b=a.Oe,c=x.currentTime;a.nd&&(b.gain.setValueAtTime(b.gain.value,
c),b.gain.linearRampToValueAtTime(0,c+a.nd));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.mn=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.nd))}else b=a.Ya,a.duration<b.buffer.duration?a.nd&&20==a.state?b.stop(c+a.nd):20==a.state&&(b.stop(0),b.disconnect()):b.disconnect(),a.Zb=0,a.Ml=0,a.sk=0;a.state=30}}function k(a){return!a.g||20!=a.g.state&&40!=a.g.state&&30!=a.g.state?!1:!0}function l(a){return a.muted?0:a.volume}var s=q("__config"),n=q("__print"),w=q("__util"),
u=q("vec3"),z=s.Ad;a.Hm=10;a.Wj=20;a.Gm=30;var F=new Float32Array(3),p=new Float32Array(3),B=new Float32Array(3),e=[],t=[],x=null,K=null,H=[],y=[1],L=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(e.push("ogg"),e.push("ogv")),""!=a.canPlayType("audio/mpeg")&&e.push("mp3"),""!=a.canPlayType("audio/mp4")&&(e.push("mp4"),e.push("m4v")),""!=a.canPlayType("audio/webm")&&e.push("webm"));b.canPlayType&&(""!=
b.canPlayType("video/ogg")&&t.push("ogv"),""!=b.canPlayType("video/mp4")&&t.push("m4v"),""!=b.canPlayType("video/webm")&&t.push("webm"));(x=z.jz?c():null)&&n.log("%cINIT WEBAUDIO: "+x.sampleRate+"Hz","color: #00a")};a.fn=function(a){var b={ef:new Float32Array(3),up:new Float32Array(3),dg:new Float32Array(3)};a.g=b;if(x){var c=x.createGain(),d=x.createGain();b.Wf=c;b.Oe=d;c.connect(d);d.connect(x.destination);if(a.b4w_enable_dynamic_compressor){var d=x.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;
d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.$g=d;b.Lb=d}else b.$g=null,b.Lb=c;c=x.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Ne=0}};a.Cx=function(a){K=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<e.indexOf(a)?a:"ogg"==a&&-1<e.indexOf("mp4")?"mp4":"mp3"==a&&-1<e.indexOf("ogg")?"ogg":"mp4"==a&&-1<e.indexOf("ogg")?"ogg":"ogv"==
a&&-1<e.indexOf("m4v")?"m4v":"webm"==a&&-1<e.indexOf("m4v")?"m4v":"m4v"==a&&-1<e.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<t.indexOf(a)?a:"ogv"==a&&-1<t.indexOf("m4v")?"m4v":"webm"==a&&-1<t.indexOf("m4v")?"m4v":"m4v"==a&&-1<t.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.g={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.g.behavior=x?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.g,d;x?(window.MediaElementAudioSourceNode?d=!0:(n.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.g.behavior="NONE");a.g.Lu=b.b4w_disable_doppler;a.g.muted=b.muted;a.g.volume=b.volume;a.g.pitch=b.pitch;a.g.attenuation=b.attenuation;a.g.dist_ref=b.distance_reference;a.g.dist_max=b.distance_max||1E4;a.g.Rt=b.cone_angle_inner;a.g.St=
b.cone_angle_outer;a.g.Tt=b.cone_volume_outer;a.g.cyclic=b.b4w_cyclic_play;a.g.loop=b.b4w_loop;a.g.delay=b.b4w_delay;a.g.Hu=b.b4w_delay_random;a.g.Mg=b.b4w_volume_random;a.g.Ih=b.b4w_pitch_random;a.g.Rk=b.b4w_fade_in;a.g.nd=b.b4w_fade_out;a.g.Zb=0;a.g.Ml=0;a.g.sk=0;a.g.duration=0;a.g.di=0;a.g.kk=1;a.g.src=null;a.g.state=10;a.g.sl=new Float32Array(3);a.g.direction=new Float32Array(3);a.g.fm=new Float32Array(3);a.g.mn=null;a.g.Ne=0;H.push(a)};a.Fq=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";
switch(b.g.behavior){case "POSITIONAL":return a.Wj;case "BACKGROUND_SOUND":return a.Wj;case "BACKGROUND_MUSIC":return a.Gm;case "NONE":return a.Hm;default:throw"Wrong speaker behavior";}};a.Ty=function(a,b){var c=a.g;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Ww=function(){var a=x.createBufferSource();a.buffer=x.createBuffer(1,22050,22050);a.connect(x.destination);a.start(0)};a.Eu=
function(a,b,c){x?x.decodeAudioData(a,b,c):c()};a.by=function(a){h(a);delete a.g;H.splice(H.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<H.length;a++){var b=H[a].g;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Ya&&b.Ya.disconnect()}K&&K.g&&(a=K.g,a.ef[0]=0,a.ef[1]=0,a.ef[2]=0,a.dg[0]=0,a.dg[1]=0,a.dg[2]=0);K=null;H.splice(0);L=null};a.update=function(a){if(x&&0!=H.length){for(var b=0;b<H.length;b++){var c=H[b],d=c.g,e=x.currentTime;!d.loop&&d.cyclic&&20==d.state&&d.duration&&x&&d.Zb+
d.duration<e&&g(c);20==d.state&&3>d.di-e&&m(d)}L&&(-1==L.xa||a>L.Xm+L.io[L.xa])&&(b=L,-1<b.xa&&h(b.le[b.xa]),-1==b.xa&&b.random?c=Math.round(Math.random()*(b.le.length-1)):b.random?(c=1+Math.round(Math.random()*(b.le.length-2)),c=(b.xa+c)%b.le.length):c=(b.xa+1)%b.le.length,g(b.le[c]),b.xa=c,b.Xm=a)}};a.play=b;a.play_def=g;a.stop=h;a.is_play=function(a){return 20==a.g.state};a.playrate=function(a,b){var c=a.g;c.pitch=b;!k(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Ya.playbackRate.value=
b,d(c),m(c))};a.FA=function(a){return a.g.pitch};a.cyclic=function(a,b){a.g.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.g.cyclic};a.zw=function(a,b,c,d){if(x&&a.g){var e=F;e[0]=0;e[1]=-1;e[2]=0;u.transformQuat(e,c,e);p[0]=0;p[1]=0;p[2]=-1;u.transformQuat(p,c,p);c=x.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],p[0],p[1],p[2]);a.g.up.set(e);d&&(B[0]=(b[0]-a.g.ef[0])/d,B[1]=(b[1]-a.g.ef[1])/d,B[2]=(b[2]-a.g.ef[2])/d,w.smooth_v(B,a.g.dg,d,.3,B),c.setVelocity(B[0],B[1],
B[2]),a.g.dg.set(B));a.g.ef.set(b)}};a.listener_reset_speed=function(a,b){if(x&&K.g){var c=F;b?c.set(b):c.set(K.g.up);u.scale(c,a,c);x.listener.setVelocity(c[0],c[1],c[2]);K.g.dg.set(c)}};a.cy=function(a,b){var c=a.g;if(k(a)&&"POSITIONAL"==c.behavior){var d=a.d.e,e=c.Dh;e.setPosition(d[0],d[1],d[2]);var f=F;w.quat_to_dir(a.d.quat,w.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.sl;!c.Lu&&b&&(p[0]=(d[0]-f[0])/b,p[1]=(d[1]-f[1])/b,p[2]=(d[2]-f[2])/b,w.smooth_v(p,c.fm,b,.3,p),e.setVelocity(p[0],p[1],
p[2]),c.fm.set(p));f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.g;if(k(a)&&"POSITIONAL"==d.behavior){var e=F;c?e.set(c):e.set(d.direction);u.scale(e,b,e);d.Dh.setVelocity(e[0],e[1],e[2]);d.fm.set(e);d.sl.set(a.d.e)}};a.Yd=function(a){return a.g?!0:!1};a.fl=function(a){return a.g.behavior};a.check_active_speakers=function(){for(var a=0;a<H.length;a++)if(k(H[a]))return!0;return!1};a.Ix=function(a){var b=K.g;b&&(b.volume=a,x&&(b.Wf.gain.value=l(b)))};a.Nv=function(){var a=K.g;return a?a.volume:
0};a.set_volume=function(a,b){var c=a.g;c.volume=b;k(a)&&(c.Wf.gain.value=l(c))};a.get_volume=function(a){return a.g.volume};a.mute=function(a,b){a.g.muted=Boolean(b);k(a)&&(a.g.Wf.gain.value=l(a.g))};a.is_muted=function(a){return a.g.muted};a.Lw=function(a){var b=K.g;b&&(b.muted=Boolean(a),x&&(b.Wf.gain.value=l(b)))};a.vw=function(){var a=K.g;return a?a.muted:!1};a.get_speaker_objects=function(){return H};a.pause=function(){for(var a=0;a<H.length;a++){var b=H[a].g;if(20==b.state){if("BACKGROUND_MUSIC"==
b.behavior){var c=b.src;c&&c.pause()}else{var e=x.currentTime;b.Ml=e;if(e>b.Zb){c=b;y[0]=c.kk;for(var f=c.Ya.buffer.duration,g=c.Zb,h=void 0;g<e;)h=c.pitch+c.Ih*w.kc(y),g+=f/h;c=(f/h-(g-e))*h}else c=0;b.sk=c;b.Ya.stop(0);b.Ya.disconnect();d(b)}b.state=40}}};a.resume=function(){for(var a=0;a<H.length;a++){var b=H[a],c=b.g;if(40==c.state){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b.g,d=x.createBufferSource();d.loop=b.Ya.loop;d.buffer=b.Ya.buffer;d.playbackRate.value=b.Ya.playbackRate.value;
b.Dh?d.connect(b.Dh):d.connect(b.Wf);b.Ya=d;b=x.currentTime;c.Zb+=b-c.Ml;c.di=b;c.Ya.start(c.Zb,c.sk);m(c);f(c,c.Zb)}c.state=20}}};a.set_compressor_params=function(a,b){if(a.g&&a.g.$g){var c=a.g.$g;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.g||!a.g.$g)return null;a=a.g.$g;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.duck=function(a,b,c){if(k(a)){a=a.g;var d=a.Oe,e=x.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Ne=c}};a.unduck=function(a){if(k(a)){a=a.g;var b=a.Oe,c=x.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.Nu=function(a,b){if(x){var c=K.g,d=c.Oe,e=x.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Ne=b}};a.Ey=function(){if(x){var a=K.g,b=a.Oe,c=x.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.apply_playlist=function(a,b,c){L={xa:-1,Xm:0,random:c,le:[],io:[]};for(c=0;c<a.length;c++){var d=a[c];h(d);L.le.push(d);d=d.g;d=(d=d.src)?d.duration:0;L.io.push(d+b)}};a.clear_playlist=function(){if(L)for(var a=L.le,b=0;b<a.length;b++)h(a[b]);L=null};a.get_positional_params=function(a){return(a=a.g)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.g;
if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Dh;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.g;c&&c.Hc&&(c.Hc.frequency.value=b.freq,c.Hc.Q.value=b.Q,c.Hc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.g)&&a.Hc?{freq:a.Hc.frequency.value,Q:a.Hc.Q.value,gain:a.Hc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.g;if(!a||
!a.Hc)return null;a.Hc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new q(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new q(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var m=new q(3);m[0]=a;m[1]=c;m[2]=d;return m};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,m){m[0]=a;m[1]=c;m[2]=d;return m};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,m){m[0]=a[0]+c[0]*d;m[1]=a[1]+c[1]*d;m[2]=a[2]+c[2]*d;return m};a.distance=function(a,c){var d=c[0]-a[0],m=c[1]-a[1],f=c[2]-a[2];return Math.sqrt(d*d+m*m+f*f)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],m=c[1]-a[1],f=c[2]-a[2];return d*d+m*m+f*f};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],m=a[1],f=a[2],d=d*d+m*m+f*f;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var m=a[0],f=a[1];a=a[2];var h=c[0],k=c[1];c=c[2];d[0]=f*c-a*k;d[1]=
a*h-m*c;d[2]=m*k-f*h;return d};a.lerp=function(a,c,d,m){var f=a[0],h=a[1];a=a[2];m[0]=f+d*(c[0]-f);m[1]=h+d*(c[1]-h);m[2]=a+d*(c[2]-a);return m};a.random=function(a,g){a=a||1;var d=2*c()*Math.PI,m=2*c()-1,f=Math.sqrt(1-m*m)*a;g[0]=Math.cos(d)*f;g[1]=Math.sin(d)*f;g[2]=m*a;return g};a.transformMat4=function(a,c,d){var m=a[0],f=a[1];a=a[2];var h=c[3]*m+c[7]*f+c[11]*a+c[15],h=h||1;d[0]=(c[0]*m+c[4]*f+c[8]*a+c[12])/h;d[1]=(c[1]*m+c[5]*f+c[9]*a+c[13])/h;d[2]=(c[2]*m+c[6]*f+c[10]*a+c[14])/h;return d};a.transformMat3=
function(a,c,d){var m=a[0],f=a[1];a=a[2];d[0]=m*c[0]+f*c[3]+a*c[6];d[1]=m*c[1]+f*c[4]+a*c[7];d[2]=m*c[2]+f*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var m=a[0],f=a[1],h=a[2];a=c[0];var k=c[1],l=c[2];c=c[3];var s=c*m+k*h-l*f,n=c*f+l*m-a*h,w=c*h+a*f-k*m,m=-a*m-k*f-l*h;d[0]=s*c+m*-a+n*-l-w*-k;d[1]=n*c+m*-k+w*-a-s*-l;d[2]=w*c+m*-l+s*-k-n*-a;return d};a.rotateX=function(a,c,d,m){var f=[],h=[];f[0]=a[0]-c[0];f[1]=a[1]-c[1];f[2]=a[2]-c[2];h[0]=f[0];h[1]=f[1]*Math.cos(d)-f[2]*Math.sin(d);h[2]=
f[1]*Math.sin(d)+f[2]*Math.cos(d);m[0]=h[0]+c[0];m[1]=h[1]+c[1];m[2]=h[2]+c[2];return m};a.rotateY=function(a,c,d,m){var f=[],h=[];f[0]=a[0]-c[0];f[1]=a[1]-c[1];f[2]=a[2]-c[2];h[0]=f[2]*Math.sin(d)+f[0]*Math.cos(d);h[1]=f[1];h[2]=f[2]*Math.cos(d)-f[0]*Math.sin(d);m[0]=h[0]+c[0];m[1]=h[1]+c[1];m[2]=h[2]+c[2];return m};a.rotateZ=function(a,c,d,m){var f=[],h=[];f[0]=a[0]-c[0];f[1]=a[1]-c[1];f[2]=a[2]-c[2];h[0]=f[0]*Math.cos(d)-f[1]*Math.sin(d);h[1]=f[0]*Math.sin(d)+f[1]*Math.cos(d);h[2]=f[2];m[0]=h[0]+
c[0];m[1]=h[1]+c[1];m[2]=h[2]+c[2];return m};a.forEach=function(){var b=a.create();return function(a,c,m,f,h,k){c||(c=3);m||(m=0);for(f=f?Math.min(f*c+m,a.length):a.length;m<f;m+=c)b[0]=a[m],b[1]=a[m+1],b[2]=a[m+2],h(b,k,b),a[m]=b[0],a[m+1]=b[1],a[m+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new q(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new q(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,m){var f=new q(4);f[0]=a;f[1]=c;f[2]=d;f[3]=m;return f};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,m,f){f[0]=a;f[1]=c;f[2]=d;f[3]=m;return f};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,m){m[0]=a[0]+c[0]*d;m[1]=a[1]+c[1]*d;m[2]=a[2]+c[2]*d;m[3]=a[3]+c[3]*d;return m};a.distance=function(a,c){var d=c[0]-a[0],m=c[1]-a[1],f=c[2]-a[2],h=c[3]-a[3];return Math.sqrt(d*d+m*m+f*f+h*h)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],m=c[1]-a[1],f=c[2]-a[2],h=c[3]-a[3];return d*d+m*m+f*f+h*h};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],m=a[2];a=a[3];return Math.sqrt(c*c+d*d+m*m+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],m=a[2];a=a[3];return c*c+d*d+m*m+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],m=a[1],f=a[2],h=a[3],d=d*d+m*m+f*f+h*h;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,m){var f=a[0],h=a[1],k=a[2];a=a[3];m[0]=f+d*(c[0]-f);m[1]=h+d*(c[1]-h);m[2]=k+d*(c[2]-k);m[3]=a+d*(c[3]-a);return m};a.random=function(b,g){b=b||1;g[0]=c();g[1]=c();g[2]=c();g[3]=c();a.normalize(g,g);a.scale(g,b,g);return g};a.transformMat4=function(a,c,d){var m=a[0],
f=a[1],h=a[2];a=a[3];d[0]=c[0]*m+c[4]*f+c[8]*h+c[12]*a;d[1]=c[1]*m+c[5]*f+c[9]*h+c[13]*a;d[2]=c[2]*m+c[6]*f+c[10]*h+c[14]*a;d[3]=c[3]*m+c[7]*f+c[11]*h+c[15]*a;return d};a.transformQuat=function(a,c,d){var m=a[0],f=a[1],h=a[2];a=c[0];var k=c[1],l=c[2];c=c[3];var s=c*m+k*h-l*f,n=c*f+l*m-a*h,w=c*h+a*f-k*m,m=-a*m-k*f-l*h;d[0]=s*c+m*-a+n*-l-w*-k;d[1]=n*c+m*-k+w*-a-s*-l;d[2]=w*c+m*-l+s*-k-n*-a;return d};a.forEach=function(){var b=a.create();return function(a,c,m,f,h,k){c||(c=4);m||(m=0);for(f=f?Math.min(f*
c+m,a.length):a.length;m<f;m+=c)b[0]=a[m],b[1]=a[m+1],b[2]=a[m+2],b[3]=a[m+3],h(b,k,b),a[m]=b[0],a[m+1]=b[1],a[m+2]=b[2],a[m+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,q){var c=q("vec3"),b=q("vec4"),g=q("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),g=c.fromValues(0,1,0);return function(k,l,s){var n=c.dot(k,l);if(-.9999999>n)return c.cross(d,k,b),1E-6>c.length(b)&&c.cross(g,k,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,s),s;if(.9999999<n)return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s;c.cross(k,
l,b);s[0]=b[0];s[1]=b[1];s[2]=b[2];s[3]=1+n;return a.normalize(s,s)}}();a.setAxes=function(){var b=g.create();return function(c,d,g,l){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=g[0];b[4]=g[1];b[7]=g[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,l),l)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],g=a[1],s=a[2];a=a[3];var n=b[0],w=b[1],u=b[2];b=b[3];c[0]=d*b+a*n+g*u-s*w;c[1]=g*b+a*w+s*n-d*u;c[2]=s*b+a*u+d*w-g*n;c[3]=a*b-d*n-g*w-s*u;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],g=a[1],s=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*n;c[1]=g*b+s*n;c[2]=s*b-g*n;c[3]=a*b-d*n;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],g=a[1],s=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*
b-s*n;c[1]=g*b+a*n;c[2]=s*b+d*n;c[3]=a*b-g*n;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],g=a[1],s=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+g*n;c[1]=g*b-d*n;c[2]=s*b+a*n;c[3]=a*b-s*n;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],g=a[2];b[0]=c;b[1]=d;b[2]=g;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-g*g));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var g=a[0],s=a[1],n=a[2];a=a[3];var w=b[0],u=b[1],q=b[2];b=b[3];var F,p,B;p=g*w+s*u+n*q+a*b;0>p&&(p=-p,w=-w,u=-u,
q=-q,b=-b);1E-6<1-p?(F=Math.acos(p),B=Math.sin(F),p=Math.sin((1-c)*F)/B,c=Math.sin(c*F)/B):p=1-c;d[0]=p*g+c*w;d[1]=p*s+c*u;d[2]=p*n+c*q;d[3]=p*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],g=a[2],s=a[3],n=c*c+d*d+g*g+s*s,n=n?1/n:0;b[0]=-c*n;b[1]=-d*n;b[2]=-g*n;b[3]=s*n;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var g=(d+1)%3,s=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*g+g]-a[3*s+s]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*g+s]-a[3*s+g])*c;b[g]=(a[3*g+d]+a[3*d+g])*c;b[s]=(a[3*s+d]+a[3*d+s])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new q(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var g=a[1],d=a[2],m=a[5];b[1]=a[3];b[2]=a[6];b[3]=g;b[5]=a[7];b[6]=d;b[7]=m}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=a[4],k=a[5],l=a[6],s=a[7],n=a[8],w=n*h-k*s,u=-n*f+k*l,q=
s*f-h*l,F=g*w+d*u+m*q;if(!F)return null;F=1/F;b[0]=w*F;b[1]=(-n*d+m*s)*F;b[2]=(k*d-m*h)*F;b[3]=u*F;b[4]=(n*g-m*l)*F;b[5]=(-k*g+m*f)*F;b[6]=q*F;b[7]=(-s*g+d*l)*F;b[8]=(h*g-d*f)*F;return b};a.adjoint=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=a[4],k=a[5],l=a[6],s=a[7],n=a[8];b[0]=h*n-k*s;b[1]=m*s-d*n;b[2]=d*k-m*h;b[3]=k*l-f*n;b[4]=g*n-m*l;b[5]=m*f-g*k;b[6]=f*s-h*l;b[7]=d*l-g*s;b[8]=g*h-d*f;return b};a.determinant=function(a){var b=a[3],g=a[4],d=a[5],m=a[6],f=a[7],h=a[8];return a[0]*(h*g-d*f)+a[1]*
(-h*b+d*m)+a[2]*(f*b-g*m)};a.multiply=function(a,b,g){var d=a[0],m=a[1],f=a[2],h=a[3],k=a[4],l=a[5],s=a[6],n=a[7];a=a[8];var w=b[0],u=b[1],q=b[2],F=b[3],p=b[4],B=b[5],e=b[6],t=b[7];b=b[8];g[0]=w*d+u*h+q*s;g[1]=w*m+u*k+q*n;g[2]=w*f+u*l+q*a;g[3]=F*d+p*h+B*s;g[4]=F*m+p*k+B*n;g[5]=F*f+p*l+B*a;g[6]=e*d+t*h+b*s;g[7]=e*m+t*k+b*n;g[8]=e*f+t*l+b*a;return g};a.mul=a.multiply;a.translate=function(a,b,g){var d=a[0],m=a[1],f=a[2],h=a[3],k=a[4],l=a[5],s=a[6],n=a[7];a=a[8];var w=b[0];b=b[1];g[0]=d;g[1]=m;g[2]=f;
g[3]=h;g[4]=k;g[5]=l;g[6]=w*d+b*h+s;g[7]=w*m+b*k+n;g[8]=w*f+b*l+a;return g};a.rotate=function(a,b,g){var d=a[0],m=a[1],f=a[2],h=a[3],k=a[4],l=a[5],s=a[6],n=a[7];a=a[8];var w=Math.sin(b);b=Math.cos(b);g[0]=b*d+w*h;g[1]=b*m+w*k;g[2]=b*f+w*l;g[3]=b*h-w*d;g[4]=b*k-w*m;g[5]=b*l-w*f;g[6]=s;g[7]=n;g[8]=a;return g};a.scale=function(a,b,g){var d=b[0];b=b[1];g[0]=d*a[0];g[1]=d*a[1];g[2]=d*a[2];g[3]=b*a[3];g[4]=b*a[4];g[5]=b*a[5];g[6]=a[6];g[7]=a[7];g[8]=a[8];return g};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=g+g,k=d+d,l=m+m,g=g*h,s=d*h,d=d*k,n=m*h,w=m*k,m=m*l,h=f*h,k=f*k,f=f*l;b[0]=1-d-m;b[3]=s-f;b[6]=n+k;b[1]=s+f;b[4]=1-g-m;b[7]=w-h;b[2]=n-k;b[5]=w+h;b[8]=1-g-d;return b};a.normalFromMat4=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=a[4],k=a[5],l=a[6],s=a[7],n=a[8],w=a[9],u=a[10],q=a[11],F=a[12],p=a[13],B=a[14],e=a[15],t=g*k-d*h,x=g*l-m*h,K=g*s-f*h,H=d*l-m*k,y=d*s-
f*k,L=m*s-f*l,r=n*p-w*F,D=n*B-u*F,n=n*e-q*F,G=w*B-u*p,w=w*e-q*p,u=u*e-q*B,q=t*u-x*w+K*G+H*n-y*D+L*r;if(!q)return null;q=1/q;b[0]=(k*u-l*w+s*G)*q;b[1]=(l*n-h*u-s*D)*q;b[2]=(h*w-k*n+s*r)*q;b[3]=(m*w-d*u-f*G)*q;b[4]=(g*u-m*n+f*D)*q;b[5]=(d*n-g*w-f*r)*q;b[6]=(p*L-B*y+e*H)*q;b[7]=(B*K-F*L-e*x)*q;b[8]=(F*y-p*K+e*t)*q;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.hv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new q(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var g=a[1],d=a[2],m=a[3],f=a[6],h=a[7],k=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=g;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=f;b[11]=a[14];b[12]=m;b[13]=h;
b[14]=k}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=a[4],k=a[5],l=a[6],s=a[7],n=a[8],q=a[9],u=a[10],z=a[11],F=a[12],p=a[13],B=a[14],e=a[15],t=g*k-d*h,x=g*l-m*h,K=g*s-f*h,H=d*l-m*k,y=d*s-f*k,L=m*s-f*l,r=n*p-q*F,D=n*B-u*F,G=n*e-z*F,V=q*B-u*p,N=q*e-z*p,Z=u*e-z*B,P=t*Z-x*N+K*V+H*G-y*D+L*r;if(!P)return null;
P=1/P;b[0]=(k*Z-l*N+s*V)*P;b[1]=(m*N-d*Z-f*V)*P;b[2]=(p*L-B*y+e*H)*P;b[3]=(u*y-q*L-z*H)*P;b[4]=(l*G-h*Z-s*D)*P;b[5]=(g*Z-m*G+f*D)*P;b[6]=(B*K-F*L-e*x)*P;b[7]=(n*L-u*K+z*x)*P;b[8]=(h*N-k*G+s*r)*P;b[9]=(d*G-g*N-f*r)*P;b[10]=(F*y-p*K+e*t)*P;b[11]=(q*K-n*y-z*t)*P;b[12]=(k*D-h*V-l*r)*P;b[13]=(g*V-d*D+m*r)*P;b[14]=(p*x-F*H-B*t)*P;b[15]=(n*H-q*x+u*t)*P;return b};a.adjoint=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=a[4],k=a[5],l=a[6],s=a[7],n=a[8],q=a[9],u=a[10],z=a[11],F=a[12],p=a[13],B=a[14],e=a[15];
b[0]=k*(u*e-z*B)-q*(l*e-s*B)+p*(l*z-s*u);b[1]=-(d*(u*e-z*B)-q*(m*e-f*B)+p*(m*z-f*u));b[2]=d*(l*e-s*B)-k*(m*e-f*B)+p*(m*s-f*l);b[3]=-(d*(l*z-s*u)-k*(m*z-f*u)+q*(m*s-f*l));b[4]=-(h*(u*e-z*B)-n*(l*e-s*B)+F*(l*z-s*u));b[5]=g*(u*e-z*B)-n*(m*e-f*B)+F*(m*z-f*u);b[6]=-(g*(l*e-s*B)-h*(m*e-f*B)+F*(m*s-f*l));b[7]=g*(l*z-s*u)-h*(m*z-f*u)+n*(m*s-f*l);b[8]=h*(q*e-z*p)-n*(k*e-s*p)+F*(k*z-s*q);b[9]=-(g*(q*e-z*p)-n*(d*e-f*p)+F*(d*z-f*q));b[10]=g*(k*e-s*p)-h*(d*e-f*p)+F*(d*s-f*k);b[11]=-(g*(k*z-s*q)-h*(d*z-f*q)+n*
(d*s-f*k));b[12]=-(h*(q*B-u*p)-n*(k*B-l*p)+F*(k*u-l*q));b[13]=g*(q*B-u*p)-n*(d*B-m*p)+F*(d*u-m*q);b[14]=-(g*(k*B-l*p)-h*(d*B-m*p)+F*(d*l-m*k));b[15]=g*(k*u-l*q)-h*(d*u-m*q)+n*(d*l-m*k);return b};a.determinant=function(a){var b=a[0],g=a[1],d=a[2],m=a[3],f=a[4],h=a[5],k=a[6],l=a[7],s=a[8],n=a[9],q=a[10],u=a[11],z=a[12],F=a[13],p=a[14];a=a[15];return(b*h-g*f)*(q*a-u*p)-(b*k-d*f)*(n*a-u*F)+(b*l-m*f)*(n*p-q*F)+(g*k-d*h)*(s*a-u*z)-(g*l-m*h)*(s*p-q*z)+(d*l-m*k)*(s*F-n*z)};a.multiply=function(a,b,g){var d=
a[0],m=a[1],f=a[2],h=a[3],k=a[4],l=a[5],s=a[6],n=a[7],q=a[8],u=a[9],z=a[10],F=a[11],p=a[12],B=a[13],e=a[14];a=a[15];var t=b[0],x=b[1],K=b[2],H=b[3];g[0]=t*d+x*k+K*q+H*p;g[1]=t*m+x*l+K*u+H*B;g[2]=t*f+x*s+K*z+H*e;g[3]=t*h+x*n+K*F+H*a;t=b[4];x=b[5];K=b[6];H=b[7];g[4]=t*d+x*k+K*q+H*p;g[5]=t*m+x*l+K*u+H*B;g[6]=t*f+x*s+K*z+H*e;g[7]=t*h+x*n+K*F+H*a;t=b[8];x=b[9];K=b[10];H=b[11];g[8]=t*d+x*k+K*q+H*p;g[9]=t*m+x*l+K*u+H*B;g[10]=t*f+x*s+K*z+H*e;g[11]=t*h+x*n+K*F+H*a;t=b[12];x=b[13];K=b[14];H=b[15];g[12]=t*d+
x*k+K*q+H*p;g[13]=t*m+x*l+K*u+H*B;g[14]=t*f+x*s+K*z+H*e;g[15]=t*h+x*n+K*F+H*a;return g};a.mul=a.multiply;a.translate=function(a,b,g){var d=b[0],m=b[1];b=b[2];var f,h,k,l,s,n,q,u,z,F,p,B;a===g?(g[12]=a[0]*d+a[4]*m+a[8]*b+a[12],g[13]=a[1]*d+a[5]*m+a[9]*b+a[13],g[14]=a[2]*d+a[6]*m+a[10]*b+a[14],g[15]=a[3]*d+a[7]*m+a[11]*b+a[15]):(f=a[0],h=a[1],k=a[2],l=a[3],s=a[4],n=a[5],q=a[6],u=a[7],z=a[8],F=a[9],p=a[10],B=a[11],g[0]=f,g[1]=h,g[2]=k,g[3]=l,g[4]=s,g[5]=n,g[6]=q,g[7]=u,g[8]=z,g[9]=F,g[10]=p,g[11]=B,
g[12]=f*d+s*m+z*b+a[12],g[13]=h*d+n*m+F*b+a[13],g[14]=k*d+q*m+p*b+a[14],g[15]=l*d+u*m+B*b+a[15]);return g};a.scale=function(a,b,g){var d=b[0],m=b[1];b=b[2];g[0]=a[0]*d;g[1]=a[1]*d;g[2]=a[2]*d;g[3]=a[3]*d;g[4]=a[4]*m;g[5]=a[5]*m;g[6]=a[6]*m;g[7]=a[7]*m;g[8]=a[8]*b;g[9]=a[9]*b;g[10]=a[10]*b;g[11]=a[11]*b;g[12]=a[12];g[13]=a[13];g[14]=a[14];g[15]=a[15];return g};a.rotate=function(a,b,g,d){var m=g[0],f=g[1];g=g[2];var h=Math.sqrt(m*m+f*f+g*g),k,l,s,n,q,u,z,F,p,B,e,t,x,K,H,y,L,r,D,G;if(1E-7>Math.abs(h))return null;
h=1/h;m*=h;f*=h;g*=h;k=Math.sin(b);l=Math.cos(b);s=1-l;b=a[0];h=a[1];n=a[2];q=a[3];u=a[4];z=a[5];F=a[6];p=a[7];B=a[8];e=a[9];t=a[10];x=a[11];K=m*m*s+l;H=f*m*s+g*k;y=g*m*s-f*k;L=m*f*s-g*k;r=f*f*s+l;D=g*f*s+m*k;G=m*g*s+f*k;m=f*g*s-m*k;f=g*g*s+l;d[0]=b*K+u*H+B*y;d[1]=h*K+z*H+e*y;d[2]=n*K+F*H+t*y;d[3]=q*K+p*H+x*y;d[4]=b*L+u*r+B*D;d[5]=h*L+z*r+e*D;d[6]=n*L+F*r+t*D;d[7]=q*L+p*r+x*D;d[8]=b*G+u*m+B*f;d[9]=h*G+z*m+e*f;d[10]=n*G+F*m+t*f;d[11]=q*G+p*m+x*f;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,g){var d=Math.sin(b);b=Math.cos(b);var m=a[4],f=a[5],h=a[6],k=a[7],l=a[8],s=a[9],n=a[10],q=a[11];a!==g&&(g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[4]=m*b+l*d;g[5]=f*b+s*d;g[6]=h*b+n*d;g[7]=k*b+q*d;g[8]=l*b-m*d;g[9]=s*b-f*d;g[10]=n*b-h*d;g[11]=q*b-k*d;return g};a.rotateY=function(a,b,g){var d=Math.sin(b);b=Math.cos(b);var m=a[0],f=a[1],h=a[2],k=a[3],l=a[8],s=a[9],n=a[10],q=a[11];a!==g&&(g[4]=a[4],g[5]=a[5],g[6]=a[6],
g[7]=a[7],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=m*b-l*d;g[1]=f*b-s*d;g[2]=h*b-n*d;g[3]=k*b-q*d;g[8]=m*d+l*b;g[9]=f*d+s*b;g[10]=h*d+n*b;g[11]=k*d+q*b;return g};a.rotateZ=function(a,b,g){var d=Math.sin(b);b=Math.cos(b);var m=a[0],f=a[1],h=a[2],k=a[3],l=a[4],s=a[5],n=a[6],q=a[7];a!==g&&(g[8]=a[8],g[9]=a[9],g[10]=a[10],g[11]=a[11],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=m*b+l*d;g[1]=f*b+s*d;g[2]=h*b+n*d;g[3]=k*b+q*d;g[4]=l*b-m*d;g[5]=s*b-f*d;g[6]=n*b-h*d;g[7]=q*b-k*d;return g};
a.fromRotationTranslation=function(a,b,g){var d=a[0],m=a[1],f=a[2],h=a[3],k=d+d,l=m+m,s=f+f;a=d*k;var n=d*l,d=d*s,q=m*l,m=m*s,f=f*s,k=h*k,l=h*l,h=h*s;g[0]=1-(q+f);g[1]=n+h;g[2]=d-l;g[3]=0;g[4]=n-h;g[5]=1-(a+f);g[6]=m+k;g[7]=0;g[8]=d+l;g[9]=m-k;g[10]=1-(a+q);g[11]=0;g[12]=b[0];g[13]=b[1];g[14]=b[2];g[15]=1;return g};a.fromQuat=function(a,b){var g=a[0],d=a[1],m=a[2],f=a[3],h=g+g,k=d+d,l=m+m,g=g*h,s=d*h,d=d*k,n=m*h,q=m*k,m=m*l,h=f*h,k=f*k,f=f*l;b[0]=1-d-m;b[1]=s+f;b[2]=n-k;b[3]=0;b[4]=s-f;b[5]=1-g-m;
b[6]=q+h;b[7]=0;b[8]=n+k;b[9]=q-h;b[10]=1-g-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,g,d,m,f,h){var k=1/(b-a),l=1/(d-g),s=1/(m-f);h[0]=2*m*k;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*m*l;h[6]=0;h[7]=0;h[8]=(b+a)*k;h[9]=(d+g)*l;h[10]=(f+m)*s;h[11]=-1;h[12]=0;h[13]=0;h[14]=f*m*2*s;h[15]=0;return h};a.perspective=function(a,b,g,d,m){a=1/Math.tan(a/2);var f=1/(g-d);m[0]=a/b;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=a;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=(d+g)*f;m[11]=-1;m[12]=0;m[13]=0;
m[14]=2*d*g*f;m[15]=0;return m};a.ortho=function(a,b,g,d,m,f,h){var k=1/(a-b),l=1/(g-d),s=1/(m-f);h[0]=-2*k;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=-2*l;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=2*s;h[11]=0;h[12]=(a+b)*k;h[13]=(d+g)*l;h[14]=(f+m)*s;h[15]=1;return h};a.lookAt=function(c,b,g,d){var m,f,h,k,l,s,n,q,u=c[0],z=c[1];c=c[2];h=g[0];k=g[1];f=g[2];n=b[0];g=b[1];m=b[2];if(1E-7>Math.abs(u-n)&&1E-7>Math.abs(z-g)&&1E-7>Math.abs(c-m))return a.identity(d);b=u-n;g=z-g;n=c-m;q=1/Math.sqrt(b*b+g*g+n*n);b*=q;g*=q;n*=
q;m=k*n-f*g;f=f*b-h*n;h=h*g-k*b;(q=Math.sqrt(m*m+f*f+h*h))?(q=1/q,m*=q,f*=q,h*=q):h=f=m=0;k=g*h-n*f;l=n*m-b*h;s=b*f-g*m;(q=Math.sqrt(k*k+l*l+s*s))?(q=1/q,k*=q,l*=q,s*=q):s=l=k=0;d[0]=m;d[1]=k;d[2]=b;d[3]=0;d[4]=f;d[5]=l;d[6]=g;d[7]=0;d[8]=h;d[9]=s;d[10]=n;d[11]=0;d[12]=-(m*u+f*z+h*c);d[13]=-(k*u+l*z+s*c);d[14]=-(b*u+g*z+n*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.hv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.$p=function(){function a(c,b,g,d,m,f){this.message=c;this.offset=d;this.xh=m;this.Mf=f;this.name="SyntaxError"}(function(a,b){function g(){this.constructor=a}g.prototype=b.prototype;a.prototype=new g})(a,Error);return{SyntaxError:a,parse:function(c){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function g(a){if(na!==a){na>a&&(na=0,Ba={xh:1,Mf:1,Th:!1});var b=Ba,d,e;for(d=
na;d<a;d++)e=c.charAt(d),"\n"===e?(b.Th||b.xh++,b.Mf=1,b.Th=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.xh++,b.Mf=1,b.Th=!0):(b.Mf++,b.Th=!1);na=a}return Ba}function d(a){C<ra||(C>ra&&(ra=C,Xb=[]),Xb.push(a))}function m(){var a,b,e;a=C;b=T();b!==E?(b=f(),b!==E?(e=T(),e!==E?(X++,10===c.charCodeAt(C)?(e=oc,C++):(e=E,0===X&&d(Na)),e===E&&(c.substr(C,2)===qb?(e=qb,C+=2):(e=E,0===X&&d(Fb)),e===E&&(13===c.charCodeAt(C)?(e=pc,C++):(e=E,0===X&&d(Fa)))),X--,e===E&&0===X&&d(ac),e===E&&(e=I),e!==E?a=b:(C=a,
a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v);return a}function f(){var a,b,e,f,g,k,n,l;a=C;b=h();if(b!==E){e=[];f=C;g=T();g!==E?(44===c.charCodeAt(C)?(k=U,C++):(k=E,0===X&&d(ka)),k!==E?(n=T(),n!==E?(l=h(),l!==E?f=g=[g,k,n,l]:(C=f,f=v)):(C=f,f=v)):(C=f,f=v)):(C=f,f=v);for(;f!==E;)e.push(f),f=C,g=T(),g!==E?(44===c.charCodeAt(C)?(k=U,C++):(k=E,0===X&&d(ka)),k!==E?(n=T(),n!==E?(l=h(),l!==E?f=g=[g,k,n,l]:(C=f,f=v)):(C=f,f=v)):(C=f,f=v)):(C=f,f=v);e!==E?a=b=0==e.length?b:e[e.length-1]:(C=a,a=v)}else C=a,a=v;return a}
function h(){var a,b,e,g;a=C;b=k();b!==E?(e=T(),e!==E?(63===c.charCodeAt(C)?(e=fa,C++):(e=E,0===X&&d(S)),e!==E?(e=T(),e!==E?(e=f(),e!==E?(g=T(),g!==E?(58===c.charCodeAt(C)?(g=ea,C++):(g=E,0===X&&d(A)),g!==E?(g=T(),g!==E?(g=f(),g!==E?a=b?e:g:(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v);a===E&&(a=k());return a}function k(){var a,b,c,d,e,f,g,h;a=C;b=l();if(b!==E){c=[];d=C;e=T();e!==E?(f=R(),f!==E?(g=T(),g!==E?(h=l(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):
(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=R(),f!==E?(g=T(),g!==E?(h=l(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else C=a,a=v}else C=a,a=v;return a}function l(){var a,b,c,d,e,f,g,h;a=C;b=s();if(b!==E){c=[];d=C;e=T();e!==E?(f=Q(),f!==E?(g=T(),g!==E?(h=s(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=Q(),f!==E?(g=T(),g!==E?(h=s(),h!==E?d=e=
[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else C=a,a=v}else C=a,a=v;return a}function s(){var a,b,c,d,e,f,g,h;a=C;b=n();if(b!==E){c=[];d=C;e=T();e!==E?(f=O(),f!==E?(g=T(),g!==E?(h=n(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=O(),f!==E?(g=T(),g!==E?(h=n(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else C=a,a=v}else C=
a,a=v;return a}function n(){var a,b,c,d,e,f,g,h;a=C;b=w();if(b!==E){c=[];d=C;e=T();e!==E?(f=M(),f!==E?(g=T(),g!==E?(h=w(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=M(),f!==E?(g=T(),g!==E?(h=w(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else C=a,a=v}else C=a,a=v;return a}function w(){var a,b,c,d,e,f,g,h;a=C;b=u();if(b!==E){c=[];d=C;e=T();e!==E?(f=P(),f!==E?(g=T(),g!==E?
(h=u(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=P(),f!==E?(g=T(),g!==E?(h=u(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else C=a,a=v}else C=a,a=v;return a}function u(){var a,b,c,d,e,f,g,h;a=C;b=z();if(b!==E){c=[];d=C;e=T();e!==E?(f=Z(),f!==E?(g=T(),g!==E?(h=z(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=Z(),
f!==E?(g=T(),g!==E?(h=z(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else C=a,a=v}else C=a,a=v;return a}function z(){var a,b,c,d,e,f,g,h;a=C;b=F();if(b!==E){c=[];d=C;e=T();e!==E?(f=N(),f!==E?(g=T(),g!==E?(h=F(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=N(),f!==E?(g=T(),g!==E?(h=F(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=
d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else C=a,a=v}else C=a,a=v;return a}function F(){var a,b,c,d,e,f,g,h;a=C;b=p();if(b!==E){c=[];d=C;e=T();e!==E?(f=V(),f!==E?(g=T(),g!==E?(h=p(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=V(),f!==E?(g=T(),g!==E?(h=p(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=
v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else C=a,a=v}else C=a,a=v;return a}function p(){var a,b,c,d,e,f,g,h;a=C;b=B();if(b!==E){c=[];d=C;e=T();e!==E?(f=G(),f!==E?(g=T(),g!==E?(h=B(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,e=T(),e!==E?(f=G(),f!==E?(g=T(),g!==E?(h=B(),h!==E?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=
c[b][3];break;case "-":a-=c[b][3]}else C=a,a=v}else C=a,a=v;return a}function B(){var a,b,c,d,f,g,h,k;a=C;b=e();if(b!==E){c=[];d=C;f=T();f!==E?(g=D(),g!==E?(h=T(),h!==E?(k=e(),k!==E?d=f=[f,g,h,k]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==E;)c.push(d),d=C,f=T(),f!==E?(g=D(),g!==E?(h=T(),h!==E?(k=e(),k!==E?d=f=[f,g,h,k]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==E)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=
c[b][3]}else C=a,a=v}else C=a,a=v;return a}function e(){var a,f,g;a=C;c.substr(C,7)===da?(f=da,C+=7):(f=E,0===X&&d(ga));f!==E?(g=T(),g!==E?(g=x(),g!==E?a=g:(C=a,a=v)):(C=a,a=v)):(C=a,a=v);if(a===E){a=C;f=t();if(f!==E)if(g=T(),g!==E)if(c.substr(C,2)===za?(g=za,C+=2):(g=E,0===X&&d(ua)),g===E&&(c.substr(C,2)===Ea?(g=Ea,C+=2):(g=E,0===X&&d(Yb))),g!==E){a:{a=f;switch(g){case "++":f=++a;break a;case "--":f=--a;break a}f=void 0}a=f}else C=a,a=v;else C=a,a=v;else C=a,a=v;a===E&&(a=t());a===E&&(a=C,c.substr(C,
2)===za?(f=za,C+=2):(f=E,0===X&&d(ua)),f===E&&(c.substr(C,2)===Ea?(f=Ea,C+=2):(f=E,0===X&&d(Yb)),f===E&&(43===c.charCodeAt(C)?(f=db,C++):(f=E,0===X&&d(ob)),f===E&&(45===c.charCodeAt(C)?(f=Sa,C++):(f=E,0===X&&d(Ya)),f===E&&(126===c.charCodeAt(C)?(f=eb,C++):(f=E,0===X&&d(bd)),f===E&&(33===c.charCodeAt(C)?(f=Sc,C++):(f=E,0===X&&d(cd))))))),f!==E?(g=T(),g!==E?(g=e(),g!==E?a=f=b(f,g):(C=a,a=v)):(C=a,a=v)):(C=a,a=v))}return a}function t(){var a,b,e;X++;var g;a=C;48===c.charCodeAt(C)?(b=qa,C++):(b=E,0===
X&&d(Ma));if(b!==E)if(Ra.test(c.charAt(C))?(b=c.charAt(C),C++):(b=E,0===X&&d(cc)),b!==E){b=C;e=[];g=H();if(g!==E)for(;g!==E;)e.push(g),g=H();else e=v;e!==E&&(e=c.substring(b,C));b=e;b!==E?a=b=parseInt("0x"+b):(C=a,a=v)}else C=a,a=v;else C=a,a=v;if(a===E){a=C;48===c.charCodeAt(C)?(b=qa,C++):(b=E,0===X&&d(Ma));if(b===E)if(b=C,ab.test(c.charAt(C))?(e=c.charAt(C),C++):(e=E,0===X&&d(kb)),e!==E){var h;g=[];h=K();if(h!==E)for(;h!==E;)g.push(h),h=K();else g=v;g===E&&(g=I);g!==E?b=e=[e,g]:(C=b,b=v)}else C=
b,b=v;b!==E&&(b=c.substring(a,C));a=b;a!==E&&(a=parseInt(a))}X--;a===E&&0===X&&d(ba);a===E&&(b=y(),b!==E&&(b=0),a=b,a===E&&(a=C,40===c.charCodeAt(C)?(b=ha,C++):(b=E,0===X&&d(la)),b!==E?(b=T(),b!==E?(b=f(),b!==E?(e=T(),e!==E?(41===c.charCodeAt(C)?(e=Qa,C++):(e=E,0===X&&d(J)),e!==E?a=b:(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)));return a}function x(){var a,b,e,f,g;b=y();b!==E&&(b=0);a=b;if(a===E){b=[];f=e=C;X++;40===c.charCodeAt(C)?(g=ha,C++):(g=E,0===X&&d(la));g===E&&(41===c.charCodeAt(C)?
(g=Qa,C++):(g=E,0===X&&d(J)));X--;g===E?f=va:(C=f,f=v);f!==E?(g=Y(),g!==E?e=f=[f,g]:(C=e,e=v)):(C=e,e=v);if(e!==E)for(;e!==E;)b.push(e),f=e=C,X++,40===c.charCodeAt(C)?(g=ha,C++):(g=E,0===X&&d(la)),g===E&&(41===c.charCodeAt(C)?(g=Qa,C++):(g=E,0===X&&d(J))),X--,g===E?f=va:(C=f,f=v),f!==E?(g=Y(),g!==E?e=f=[f,g]:(C=e,e=v)):(C=e,e=v);else b=v;b!==E&&(b=1);a=b;a===E&&(a=C,40===c.charCodeAt(C)?(b=ha,C++):(b=E,0===X&&d(la)),b!==E?(e=T(),e!==E?(f=x(),f!==E?(g=T(),g!==E?(41===c.charCodeAt(C)?(b=Qa,C++):(b=
E,0===X&&d(J)),b!==E?a=f:(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v))}return a}function K(){var a;Xa.test(c.charAt(C))?(a=c.charAt(C),C++):(a=E,0===X&&d(Da));return a}function H(){var a;xa.test(c.charAt(C))?(a=c.charAt(C),C++):(a=E,0===X&&d(Va));return a}function y(){var a,b;X++;b=a=C;X++;var e,f,g,h;e=C;c.substr(C,7)===da?(f=da,C+=7):(f=E,0===X&&d(ga));f!==E?(g=C,X++,h=r(),X--,h===E?g=va:(C=g,g=v),g!==E?e=f=[f,g]:(C=e,e=v)):(C=e,e=v);X--;e===E?b=va:(C=b,b=v);if(b!==E){X++;b=C;e=L();if(e!==
E){f=[];for(g=r();g!==E;)f.push(g),g=r();f!==E?b=e+=f.join(""):(C=b,b=v)}else C=b,b=v;X--;b===E&&0===X&&d(bb);b!==E?a=b:(C=a,a=v)}else C=a,a=v;X--;a===E&&0===X&&d(bb);return a}function L(){var a;ya.test(c.charAt(C))?(a=c.charAt(C),C++):(a=E,0===X&&d(zb));a===E&&(36===c.charCodeAt(C)?(a=Wa,C++):(a=E,0===X&&d(cb)),a===E&&(95===c.charCodeAt(C)?(a=ub,C++):(a=E,0===X&&d(Ca))));return a}function r(){var a;a=L();a===E&&(a=K());return a}function D(){var a,b,e,f;a=C;42===c.charCodeAt(C)?(b=Tc,C++):(b=E,0===
X&&d(uc));b===E&&(47===c.charCodeAt(C)?(b=pb,C++):(b=E,0===X&&d($a)),b===E&&(37===c.charCodeAt(C)?(b=Ab,C++):(b=E,0===X&&d(dc))));b!==E?(e=C,X++,61===c.charCodeAt(C)?(f=Mb,C++):(f=E,0===X&&d(Vb)),X--,f===E?e=va:(C=e,e=v),e!==E?a=b:(C=a,a=v)):(C=a,a=v);return a}function G(){var a,b,e;a=C;43===c.charCodeAt(C)?(b=db,C++):(b=E,0===X&&d(ob));b!==E?(b=C,X++,43===c.charCodeAt(C)?(e=db,C++):(e=E,0===X&&d(ob)),e===E&&(61===c.charCodeAt(C)?(e=Mb,C++):(e=E,0===X&&d(Vb))),X--,e===E?b=va:(C=b,b=v),b!==E?a="+":
(C=a,a=v)):(C=a,a=v);a===E&&(a=C,45===c.charCodeAt(C)?(b=Sa,C++):(b=E,0===X&&d(Ya)),b!==E?(b=C,X++,45===c.charCodeAt(C)?(e=Sa,C++):(e=E,0===X&&d(Ya)),e===E&&(61===c.charCodeAt(C)?(e=Mb,C++):(e=E,0===X&&d(Vb))),X--,e===E?b=va:(C=b,b=v),b!==E?a="-":(C=a,a=v)):(C=a,a=v));return a}function V(){var a;c.substr(C,2)===Wb?(a=Wb,C+=2):(a=E,0===X&&d(lc));a===E&&(c.substr(C,2)===wa?(a=wa,C+=2):(a=E,0===X&&d(Nb)));return a}function N(){var a;c.substr(C,2)===fb?(a=fb,C+=2):(a=E,0===X&&d(sa));a===E&&(c.substr(C,
2)===Bb?(a=Bb,C+=2):(a=E,0===X&&d(ca)),a===E&&(60===c.charCodeAt(C)?(a=Ta,C++):(a=E,0===X&&d(gb)),a===E&&(62===c.charCodeAt(C)?(a=oa,C++):(a=E,0===X&&d(Ia)))));return a}function Z(){var a;c.substr(C,2)===hb?(a=hb,C+=2):(a=E,0===X&&d(ta));a===E&&(c.substr(C,2)===Ua?(a=Ua,C+=2):(a=E,0===X&&d(pa)));return a}function P(){var a,b,e;a=C;38===c.charCodeAt(C)?(b=Ja,C++):(b=E,0===X&&d(Cb));b!==E?(b=C,X++,38===c.charCodeAt(C)?(e=Ja,C++):(e=E,0===X&&d(Cb)),X--,e===E?b=va:(C=b,b=v),b!==E?a="&":(C=a,a=v)):(C=
a,a=v);return a}function M(){var a,b,e;a=C;94===c.charCodeAt(C)?(b=ec,C++):(b=E,0===X&&d(Zb));b!==E?(b=C,X++,94===c.charCodeAt(C)?(e=ec,C++):(e=E,0===X&&d(Zb)),X--,e===E?b=va:(C=b,b=v),b!==E?a="^":(C=a,a=v)):(C=a,a=v);return a}function O(){var a,b,e;a=C;124===c.charCodeAt(C)?(b=$b,C++):(b=E,0===X&&d(vb));b!==E?(b=C,X++,124===c.charCodeAt(C)?(e=$b,C++):(e=E,0===X&&d(vb)),X--,e===E?b=va:(C=b,b=v),b!==E?a="|":(C=a,a=v)):(C=a,a=v);return a}function Q(){var a;c.substr(C,2)===Db?(a=Db,C+=2):(a=E,0===X&&
d(mc));a!==E&&(a="&&");return a}function R(){var a;c.substr(C,2)===Eb?(a=Eb,C+=2):(a=E,0===X&&d(wb));a!==E&&(a="||");return a}function T(){var a,b;a=[];for(b=ja();b!==E;)a.push(b),b=ja();return a}function ja(){var a;X++;Ob.test(c.charAt(C))?(a=c.charAt(C),C++):(a=E,0===X&&d(Ka));X--;a===E&&0===X&&d(nc);return a}function Y(){var a;c.length>C?(a=c.charAt(C),C++):(a=E,0===X&&d(La));return a}var W=1<arguments.length?arguments[1]:{},E={},aa={start:m},ma=m,v=E,I=null,U=",",ka={type:"literal",value:",",
description:'","'},fa="?",S={type:"literal",value:"?",description:'"?"'},ea=":",A={type:"literal",value:":",description:'":"'},da="defined",ga={type:"literal",value:"defined",description:'"defined"'},ha="(",la={type:"literal",value:"(",description:'"("'},Qa=")",J={type:"literal",value:")",description:'")"'},va=void 0,ba={type:"other",description:"number"},qa="0",Ma={type:"literal",value:"0",description:'"0"'},Xa=/^[0-9]/,Da={type:"class",value:"[0-9]",description:"[0-9]"},ab=/^[1-9]/,kb={type:"class",
value:"[1-9]",description:"[1-9]"},Ra=/^[xX]/,cc={type:"class",value:"[xX]",description:"[xX]"},xa=/^[0-9a-fA-F]/,Va={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},bb={type:"other",description:"identifier"},Wa="$",cb={type:"literal",value:"$",description:'"$"'},ub="_",Ca={type:"literal",value:"_",description:'"_"'},ya=/^[a-zA-Z]/,zb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},za="++",ua={type:"literal",value:"++",description:'"++"'},Ea="--",Yb={type:"literal",value:"--",description:'"--"'},
db="+",ob={type:"literal",value:"+",description:'"+"'},Sa="-",Ya={type:"literal",value:"-",description:'"-"'},eb="~",bd={type:"literal",value:"~",description:'"~"'},Sc="!",cd={type:"literal",value:"!",description:'"!"'},Tc="*",uc={type:"literal",value:"*",description:'"*"'},pb="/",$a={type:"literal",value:"/",description:'"/"'},Ab="%",dc={type:"literal",value:"%",description:'"%"'},Mb="=",Vb={type:"literal",value:"=",description:'"="'},Wb="<<",lc={type:"literal",value:"<<",description:'"<<"'},wa=
">>",Nb={type:"literal",value:">>",description:'">>"'},fb="<=",sa={type:"literal",value:"<=",description:'"<="'},Bb=">=",ca={type:"literal",value:">=",description:'">="'},Ta="<",gb={type:"literal",value:"<",description:'"<"'},oa=">",Ia={type:"literal",value:">",description:'">"'},hb="==",ta={type:"literal",value:"==",description:'"=="'},Ua="!=",pa={type:"literal",value:"!=",description:'"!="'},Ja="&",Cb={type:"literal",value:"&",description:'"&"'},ec="^",Zb={type:"literal",value:"^",description:'"^"'},
$b="|",vb={type:"literal",value:"|",description:'"|"'},Db="&&",mc={type:"literal",value:"&&",description:'"&&"'},Eb="||",wb={type:"literal",value:"||",description:'"||"'},nc={type:"other",description:"whitespace"},Ob=/^[\t\x0B\f ]/,Ka={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},ac={type:"other",description:"end of line"},oc="\n",Na={type:"literal",value:"\n",description:'"\\n"'},qb="\r\n",Fb={type:"literal",value:"\r\n",description:'"\\r\\n"'},pc="\r",Fa={type:"literal",value:"\r",
description:'"\\r"'},La={type:"any",description:"any character"},C=0,na=0,Ba={xh:1,Mf:1,Th:!1},ra=0,Xb=[],X=0,lb;if("startRule"in W){if(!(W.Nq in aa))throw Error("Can't start parsing from rule \""+W.Nq+'".');ma=aa[W.Nq]}lb=ma();if(lb!==E&&C===c.length)return lb;lb!==E&&C<c.length&&d({type:"end",description:"end of input"});throw function(b,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,
1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}
var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=g(e),n=e<c.length?c.charAt(e):null;null!==d&&f(d);return new a(null!==b?b:h(d,n),0,0,e,k.xh,k.Mf)}(null,Xb,ra);}}}()};b4w.module.__md5=function(a){function q(a,h){var k=a[0],l=a[1],m=a[2],n=a[3],k=b(k,l,m,n,h[0],7,-680876936),n=b(n,k,l,m,h[1],12,-389564586),m=b(m,n,k,l,h[2],17,606105819),l=b(l,m,n,k,h[3],22,-1044525330),k=b(k,l,m,n,h[4],7,-176418897),n=b(n,k,l,m,h[5],12,1200080426),m=b(m,n,k,l,h[6],17,-1473231341),l=b(l,m,n,k,h[7],22,-45705983),k=b(k,l,m,n,h[8],7,1770035416),n=b(n,k,l,m,h[9],12,-1958414417),m=b(m,n,k,l,h[10],17,-42063),l=b(l,m,n,k,h[11],22,-1990404162),k=b(k,l,m,n,h[12],7,1804603682),n=b(n,k,l,m,
h[13],12,-40341101),m=b(m,n,k,l,h[14],17,-1502002290),l=b(l,m,n,k,h[15],22,1236535329),k=g(k,l,m,n,h[1],5,-165796510),n=g(n,k,l,m,h[6],9,-1069501632),m=g(m,n,k,l,h[11],14,643717713),l=g(l,m,n,k,h[0],20,-373897302),k=g(k,l,m,n,h[5],5,-701558691),n=g(n,k,l,m,h[10],9,38016083),m=g(m,n,k,l,h[15],14,-660478335),l=g(l,m,n,k,h[4],20,-405537848),k=g(k,l,m,n,h[9],5,568446438),n=g(n,k,l,m,h[14],9,-1019803690),m=g(m,n,k,l,h[3],14,-187363961),l=g(l,m,n,k,h[8],20,1163531501),k=g(k,l,m,n,h[13],5,-1444681467),n=
g(n,k,l,m,h[2],9,-51403784),m=g(m,n,k,l,h[7],14,1735328473),l=g(l,m,n,k,h[12],20,-1926607734),k=c(l^m^n,k,l,h[5],4,-378558),n=c(k^l^m,n,k,h[8],11,-2022574463),m=c(n^k^l,m,n,h[11],16,1839030562),l=c(m^n^k,l,m,h[14],23,-35309556),k=c(l^m^n,k,l,h[1],4,-1530992060),n=c(k^l^m,n,k,h[4],11,1272893353),m=c(n^k^l,m,n,h[7],16,-155497632),l=c(m^n^k,l,m,h[10],23,-1094730640),k=c(l^m^n,k,l,h[13],4,681279174),n=c(k^l^m,n,k,h[0],11,-358537222),m=c(n^k^l,m,n,h[3],16,-722521979),l=c(m^n^k,l,m,h[6],23,76029189),k=
c(l^m^n,k,l,h[9],4,-640364487),n=c(k^l^m,n,k,h[12],11,-421815835),m=c(n^k^l,m,n,h[15],16,530742520),l=c(m^n^k,l,m,h[2],23,-995338651),k=d(k,l,m,n,h[0],6,-198630844),n=d(n,k,l,m,h[7],10,1126891415),m=d(m,n,k,l,h[14],15,-1416354905),l=d(l,m,n,k,h[5],21,-57434055),k=d(k,l,m,n,h[12],6,1700485571),n=d(n,k,l,m,h[3],10,-1894986606),m=d(m,n,k,l,h[10],15,-1051523),l=d(l,m,n,k,h[1],21,-2054922799),k=d(k,l,m,n,h[8],6,1873313359),n=d(n,k,l,m,h[15],10,-30611744),m=d(m,n,k,l,h[6],15,-1560198380),l=d(l,m,n,k,h[13],
21,1309151649),k=d(k,l,m,n,h[4],6,-145523070),n=d(n,k,l,m,h[11],10,-1120210379),m=d(m,n,k,l,h[2],15,718787259),l=d(l,m,n,k,h[9],21,-343485551);a[0]=k+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=m+a[2]&4294967295;a[3]=n+a[3]&4294967295}function c(a,b,c,d,g,n){b=(b+a&4294967295)+(d+n&4294967295)&4294967295;return(b<<g|b>>>32-g)+c&4294967295}function b(a,b,d,g,m,n,q){return c(b&d|~b&g,a,b,m,n,q)}function g(a,b,d,g,m,n,q){return c(b&g|d&~g,a,b,m,n,q)}function d(a,b,d,g,m,n,q){return c(d^(b|~g),a,b,m,
n,q)}var m="0123456789abcdef".split("");a.bp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var g=b.substring(d-64,d),n=[],w=void 0,w=0;64>w;w+=4)n[w>>2]=g.charCodeAt(w)+(g.charCodeAt(w+1)<<8)+(g.charCodeAt(w+2)<<16)+(g.charCodeAt(w+3)<<24);q(a,n)}b=b.substring(d-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)g[d>>2]|=b.charCodeAt(d)<<(d%4<<3);g[d>>2]|=128<<(d%4<<3);if(55<d)for(q(a,g),d=0;16>d;d++)g[d]=0;g[14]=8*
c;q(a,g);for(b=0;b<a.length;b++){c=a[b];d="";for(g=0;4>g;g++)d+=m[c>>8*g+4&15]+m[c>>8*g&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cf = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cf = mix ( cf , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cg = vec3 ( 0.0 ) ; vec3 ch = vec3 ( 0.0 ) ; vec3 ci = vec3 ( 0.0 ) ; bn ( cf , cg , ch , ci ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","cj","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cj = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ck = ( u_model_matrix * vec4 ( cj , 1.0 ) ) . xyz ; mat4 cl = aa ( u_camera_eye , ck , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = ( u_model_matrix * vec4 ( cj , 1.0 ) ) . xyz ; cl = cl * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cm ) ;".split(" ")}]}}]},{type:"textline",b:"d cn = ah ( cf - cj , cj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cl ) ; cn . b = ck ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d cn = ah ( cf , cj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( cn . a , cn . b , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ak ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cn . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float fm = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float fm = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( fm < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cm ( cz ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fg ( cF . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",
b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",
";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cz",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 gp = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gp = mix ( gp , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gq = vec3 ( 0.0 ) ; vec3 gr = vec3 ( 0.0 ) ; vec3 gs = vec3 ( 0.0 ) ; bn ( gp , gq , gr , gs ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||",
"BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gt","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gt = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gu = ga ( gp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gt , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gv = ( u_model_matrix * vec4 ( gt , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gw","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gw","=","u_view_matrix",
";"]}]}}]},{type:"textline",b:"mat4 gx = aa ( u_camera_eye , gv , gw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gy = ( u_model_matrix * vec4 ( gt , 1.0 ) ) . xyz ; gx = gx * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gy ) ;".split(" ")}]}}]},{type:"textline",b:"d gu = ah ( gp - gt , gt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gx ) ; gu . b = gv ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"d gu = ah ( gp , gt , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gz","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( gu . a , gu . b , gz ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 gA = u_view_matrix * vec4 ( gu . a , 1.0 ) ; vec4 gB = u_proj_matrix * gA ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gB . xy += u_subpixel_jitter * gB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ak ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"textline",b:"gk ( gu . a ) ; cF = gA ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cz = - gA . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 gC = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gD = SHADOW_TEX_RES / 2.0 ; gC = floor ( gC * gD + 0.5 ) / gD - gC ; gB . xy += gC ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","gB",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gp",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gp",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gp , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4",
"u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gp",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gp",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gp",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")",
"{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gq = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gr = aa ( u_camera_eye , gq , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gr = gr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gs = ah ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gr ) ; gs . b = gq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d gs = ah ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gt = u_proj_matrix * u_view_matrix * vec4 ( gs . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gp = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["gp","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gp","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","gt",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gx ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gz = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gz = NUM_LINES ;".split(" ")}]}}]},{type:"textline",
b:"float gB ( float gA ) { return gA - floor ( gA * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gK ( inout float gC , in float gD [ gz ] , in float gE ) { for ( int gF = 0 ; gF < NUM_RINGS ; gF ++ ) { float gG = 40.0 * gD [ gF ] ; float gH = 300.0 * ( gB ( gG ) - 0.005 ) ; float gI = gG ; float gJ = abs ( gI * ( u_halo_size * gH - gE ) ) ; gC += 1.0 - min ( gJ , 1.0 ) ; } }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gT ( inout float gL , in float gM [ gz ] , in float gN ) { for ( int gO = 0 ; gO < NUM_LINES ; gO ++ ) { float gP = gM [ gO ] ; float gQ = gP ; float gR = 1000.0 * ( gB ( gP ) - 0.005 ) ; float gS = 20.0 * abs ( gQ * a . x + gR * a . y ) ; gL += 1.0 - min ( gS , 1.0 ) ; } gL *= gN ; }".split(" ")}]}}]},{type:"textline",b:"void g_ ( inout float gU , in vec2 gV ) { float gW , gX ; gX = atan ( gV . y , gV . x ) ; gX *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float gY = cos ( gX ) ; float gZ = sin ( gX ) ; gX = ( gY * gV . x + gZ * gV . y ) * ( gY * gV . y - gZ * gV . x ) ; gW = abs ( gX ) ; if ( gW < 1.0 ) { gW = ( 0.01 * u_halo_size ) / ( gW ) ; gU *= sqrt ( min ( gW , 1.0 ) ) ; } } void main ( ) { float ha = ( a . x * a . x + a . y * a . y ) ; float hb = sqrt ( ha ) ; ha = max ( 1.0 - ha , 0.0 ) ; ha = pow ( ha , u_halo_hardness ) ; float hc = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hd [ gz ] ; for ( int he = 0 ; he < gz ; he ++ ) { hd [ he ] = fract ( gy / ( float ( he ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hf = 0.0 ; gK ( hf , hd , hb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hg = 0.0 ; gT ( hg , hd , ha ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"g_ ( ha , a ) ;".split(" ")}]}}]},{type:"textline",b:"ha *= hc ; vec3 hh = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hf *= ha ; hh += u_halo_rings_color * hf ; ha += hf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hg *= hc ; hh += u_halo_lines_color * hg ; ha += hg ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"ha *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hi = u_halo_stars_blend * ( gx . y - u_halo_stars_height ) ; ha *= clamp ( hi , 0.0 , 1.0 ) ; ha *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gt ( hh ) ; gw ( hh , ha ) ; gl_FragColor = vec4 ( hh , ha ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gy ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gx",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gz = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gy = fract ( gz . x + gz . y + gz . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gA = z ( gz , u_view_matrix ) ; mat4 gB = u_view_matrix ; gB [ 3 ] [ 0 ] = 0.0 ; gB [ 3 ] [ 1 ] = 0.0 ; gB [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gA = z ( gz , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gC = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gD = gA * gC ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gE = u_proj_matrix * gB * gD ; gE . z = 0.99999 * gE . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gx","=","gD",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gE = u_proj_matrix * u_view_matrix * gD ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gE",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gz = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gz , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kx ; varying vec3 ky ; varying vec3 kz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kB",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float ln = ky . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lo","=","a",";"]}]}}]},{type:"textline",b:["vec3","lp","=","kz",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lp = lp ; else lp = - lp ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lq = cross ( lp , kA . xyz ) * kA . w ; mat3 lr = mat3 ( kA . xyz , lq , lp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float ls = length ( cF ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lt = normalize ( u_view_matrix_frag * vec4 ( kz , 0.0 ) ) . st ; lt = lt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( ls < PARALLAX_LOD_DIST ) { float lu = clamp ( 0.5 * ( PARALLAX_LOD_DIST - ls ) , 0.0 , 1.0 ) ; float lv = u_parallax_scale * lu ; vec3 lw = normalize ( kx * lr ) ; float lx = 1.0 / PARALLAX_STEPS ; vec2 ly = lw . xy * lv / ( PARALLAX_STEPS * lw . z ) ; float lz = 1.0 ; float lA ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lB","=","lt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lB","=","lo",";"]}]}}]},{type:"textline",b:"lA = texture2D ( u_normalmap0 , lB ) . a ; for ( float lC = 1.0 ; lC <= PARALLAX_STEPS ; lC ++ ) { if ( lA < lz ) { lz -= lx ; lB -= ly ; lA = texture2D ( u_normalmap0 , lB ) . a ; } } vec2 lD = lB + ly ; float lE = texture2D ( u_normalmap0 , lD ) . a - ( lz + lx ) ; float lF = lA - lz ; float lG = lF / ( lF - lE ) ; lB = lG * lD + ( 1.0 - lG ) * lB ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lo += lB - lt ;".split(" ")}]}}]},{type:"textline",b:["lt","=","lB",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lt += lB - lo ;".split(" ")}]}}]},{type:"textline",b:["lo","=","lB",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lH",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_normalmap0 , lt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_normalmap0 , lo ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lI = lH . rgb - 0.5 ; lI = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lI , u_normal_factor ) ; vec3 lJ = lr * lI ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lJ","=","lp",";"]}]}}]},{type:"textline",b:"lJ = normalize ( lJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lt = normalize ( u_view_matrix_frag * vec4 ( lJ , 0.0 ) ) . st ; lt = lt * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lK = normalize ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lL = kB ; gr ( lL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lM = vec4 ( lL , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lM","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lN","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lO = texture2D ( u_colormap0 , lt ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lO = texture2D ( u_colormap0 , lo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gr ( lO . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","lP",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lP = texture2D ( u_colormap1 , lt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lP = texture2D ( u_colormap1 , lo ) ;".split(" ")}]}}]},{type:"textline",b:"gr ( lP . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 lQ = texture2D ( u_stencil0 , lt ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lQ = texture2D ( u_stencil0 , lo ) ;".split(" ")}]}}]},{type:"textline",b:"lO = mix ( lO , lP , lQ . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lM . rgb = mix ( lM . rgb , lO . rgb , u_diffuse_color_factor ) ; float lR = u_alpha_factor * lO . a ; lR += ( 1.0 - step ( 0.0 , lR ) ) ; lM . a = mix ( lR , 1.0 , u_diffuse_color . a ) ; lN = lO . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lM . rgb *= mix ( vec3 ( 1.0 ) , lO . rgb , u_diffuse_color_factor ) ; lM . a = lO . a ; lN = lO . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lS = u_diffuse_intensity * lM . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","lT","=","lS",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lU = 0.5 * lJ . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lV = u_environment_energy * textureCube ( u_sky_texture , lJ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lV = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lU ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lW = u_ambient * lV ; float lX = fl ( lS ) ; vec3 lY = u_emit * lM . rgb ; vec3 lZ = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 l_ = vec3 ( lN ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 l_ = texture2D ( u_specmap0 , lt ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 l_ = texture2D ( u_specmap0 , lo ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gr ( l_ . rgb ) ; lZ = mix ( lZ , l_ , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float ma = u_specular_params [ 0 ] ; vec2 mb = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mc = ma * lZ ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hp md = jW ( lY , lW , lS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp md = jR ( lY , lW , lS , mc , ky , lJ , lK , mb , u_diffuse_params , lX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , u_shadow_lamp_id ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 lT = md . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","me","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","me","=","0.0",";"]}]}}]},{type:"textline",b:"kZ ( lT , lK , lJ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , me ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lT += md . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lT = max ( lT - sqrt ( 0.01 * - min ( ln , 0.0 ) ) , 0.5 * lT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kw ( lT , ln , u_time , lX , lJ , u_sun_direction , u_sun_intensity , u_sun_quaternion , ky , ls ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mf = lM . a ; if ( mf <= 0.5 ) discard ; mf = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mf = lM . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mf += md . a . a * mc . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mf","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lT = mix ( lm ( cE , lJ . xz * u_refr_bump ) , lT , mf ) ; mf = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mg = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mh = gL ( u_cube_fog , lK ) ; vec4 mi = vec4 ( mh , u_fog_color_density . a ) ; gr ( mi . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mi = u_fog_color_density ; mi . rgb *= mg ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hd ( lT , ls , lK , u_cam_water_depth , u_underwater_fog_color_density , mi , ln , mg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gE ( lT , ls , mi ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"lT = vec3 ( dN . a ) ;".split(" ")}]}}]},{type:"textline",b:["gt","(","lT",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gw ( lT , mf ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lT , mf ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kx ; varying vec3 ky ; varying vec3 kz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kB",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 ln = a_position ; vec3 lo = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lp = vec3 ( a_tangent ) ; vec3 lq = a_tangent [ 3 ] * cross ( lo , lp ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lr = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 ls = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lt = lr - u_camera_eye ; vec3 lq = cross ( lt , ls ) ; vec3 lp = cross ( ls , lq ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lp = vec3 ( 0.0 ) ; vec3 lq = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ln = mix ( ln , a_position_next , u_va_frame_factor ) ; lo = mix ( lo , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lu = vec3 ( a_tangent ) ; vec3 lv = a_tangent_next [ 3 ] * cross ( a_normal_next , lu ) ; lp = mix ( lp , lu , u_va_frame_factor ) ; lq = mix ( lq , lv , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bn ( ln , lp , lq , lo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lw","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lx = ga ( ln , lp , lq , lo , lw , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ly = ( u_model_matrix * vec4 ( lw , 1.0 ) ) . xyz ; mat4 lz = aa ( u_camera_eye , ly , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lA = ( u_model_matrix * vec4 ( lw , 1.0 ) ) . xyz ; lz = lz * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lA ) ;".split(" ")}]}}]},
{type:"textline",b:"d lx = ah ( ln - lw , lw , lp , lq , lo , lz ) ; lx . b = ly ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lx = ah ( ln , lw , lp , lq , lo , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lB = ( dot ( cross ( lx . e , lx . c ) , lx . d ) < 0.0 ) ? - 1.0 : 1.0 ; kA = vec4 ( lx . c , lB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"textline",b:"ce ( lx . a , lx . b , lo ) ;".split(" ")}]}}]},{type:"textline",b:"ky = lx . a ; kz = lx . e ; kx = u_camera_eye - lx . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = ak ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kB = lx . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",
a:[{type:"textline",b:["kB","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lC = u_view_matrix * vec4 ( lx . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cF","=","lC",";"]}]}}]},{type:"textline",b:"vec4 lD = u_proj_matrix * lC ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lD . xy += u_subpixel_jitter * lD . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gk","(","lD",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gk ( lx . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lE = lD . x ; float lF = lD . y ; float lG = lD . w ; cE . x = ( lE + lG ) / 2.0 ; cE . y = ( lF + lG ) / 2.0 ; cE . z = lG ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kC = - lC . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","lD",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 ky ; varying vec4 cF ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 ln = vec3 ( UNITY_VALUE_NODES ) ; vec3 lo = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"},{type:"textline",b:"vec3 ls ( in vec3 lp , in float lq ) { vec3 lr = lo ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lr = lm ( cE , lp . xz * lq ) ;".split(" ")}]}}]},{type:"textline",b:["return","lr",";","}"]}]}}]},{type:"textline",b:"vec3 lv ( float lt , vec3 lu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lu ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lt ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lC ( vec3 lw ) { vec4 lx = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 ly = mix ( vec4 ( lw . bg , lx . wz ) , vec4 ( lw . gb , lx . xy ) , step ( lw . b , lw . g ) ) ; vec4 lz = mix ( vec4 ( ly . xyw , lw . r ) , vec4 ( lw . r , ly . yzx ) , step ( ly . x , lw . r ) ) ; float lA = lz . x - min ( lz . w , lz . y ) ; float lB = 1.0e-10 ; return vec3 ( abs ( lz . z + ( lz . w - lz . y ) / ( 6.0 * lA + lB ) ) , lA / ( lz . x + lB ) , lz . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lG ( vec3 lD ) { vec4 lE = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lF = abs ( fract ( vec3 ( lD . r , lD . r , lD . r ) + lE . xyz ) * 6.0 - lE . www ) ; return lD . b * mix ( lE . xxx , clamp ( lF - lE . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lD . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lI ( vec2 lH ) { return vec3 ( lH * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lK ( vec3 lJ ) { return vec2 ( lJ . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"textline",b:"void lP ( inout vec3 lL , vec3 lM , vec3 lN , float lO ) {".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kZ ( lL , lM , lN , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lO ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kZ ( lL , lM , lN , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lO ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} hp mc ( vec3 lQ , vec3 lR , vec3 lS , vec3 lT , vec3 lU , vec3 lV , vec3 lW , vec2 lX , vec2 lY , float lZ , float l_ , vec4 ma ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS_MAT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"return jR ( lQ , lR , lS , lT , lU , lV , lW , lX , lY , lZ , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , l_ , ma , u_shadow_lamp_id ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return jW ( lQ , lR , lS ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp mb ; mb . a = vec4 ( lS , ZERO_VALUE_NODES ) ; mb . b = lo ; return mb ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"mV",qualifier:["vec3"]},{type:"node_out",name:"mW",qualifier:["float"]},{type:"node_out",name:"mX",qualifier:["float"]},{type:"textline",b:"mV = normalize ( mL . xyz ) ; mW = abs ( mL . z ) ; mX = length ( mL . xyz ) ;".split(" ")}]}},
{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"mY",qualifier:["float"]},{type:"node_in",name:"mZ",qualifier:["float"]},{type:"node_in",name:"m_",qualifier:["float"]},{type:"node_out",name:"na",qualifier:["vec3"]},{type:"textline",b:"na = vec3 ( mY , mZ , m_ ) ;".split(" ")}]}},{type:"node",name:"COMBHSV",group:{type:"group",a:[{type:"node_in",name:"nb",qualifier:["float"]},{type:"node_in",name:"nc",qualifier:["float"]},{type:"node_in",name:"nd",qualifier:["float"]},{type:"node_out",
name:"ne",qualifier:["vec3"]},{type:"textline",b:"ne = lG ( vec3 ( nb , nc , nd ) ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"md",qualifier:["varying","vec2"]},{type:"node_out",name:"nf",qualifier:["vec3"]},{type:"textline",b:"nf = lI ( md ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"me",qualifier:["varying","vec3"]},{type:"node_out",name:"ng",qualifier:["vec3"]},{type:"textline",b:["ng",
"=","me",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"mf",qualifier:["varying","float"]},{type:"node_out",name:"nh",qualifier:["float"]},{type:"textline",b:["nh","=","mf",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"mg",qualifier:["varying","vec2"]},{type:"node_out",name:"ni",qualifier:["float"]},{type:"node_out",name:"nj",qualifier:["float"]},{type:"textline",b:"ni = mg [ 0 ] ; nj = mg [ 1 ] ;".split(" ")}]}},
{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"mh",qualifier:["varying","vec3"]},{type:"node_out",name:"nk",qualifier:["float"]},{type:"node_out",name:"nl",qualifier:["float"]},{type:"node_out",name:"nm",qualifier:["float"]},{type:"textline",b:"nk = mh [ 0 ] ; nl = mh [ 1 ] ; nm = mh [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"nn",qualifier:["vec3"]},{type:"textline",b:["nn","=","mE",";"]}]}},{type:"node",
name:"GEOMETRY_FB",group:{type:"group",a:[{type:"node_out",name:"no",qualifier:["float"]},{type:"textline",b:"no = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"np",qualifier:["vec3"]},{type:"textline",b:["np","=","mJ",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"nq",qualifier:["vec3"]},{type:"textline",b:"nq = vec3 ( mK . r , - mK . b , mK . g ) ;".split(" ")}]}},
{type:"node",name:"HUE_SAT",group:{type:"group",a:[{type:"node_in",name:"nr",qualifier:["float"]},{type:"node_in",name:"ns",qualifier:["float"]},{type:"node_in",name:"nt",qualifier:["float"]},{type:"node_in",name:"nu",qualifier:["float"]},{type:"node_in",name:"nv",qualifier:["vec3"]},{type:"node_out",name:"nw",qualifier:["vec3"]},{type:"textline",b:"{ vec3 nx = lC ( nv ) ; nx [ 0 ] += ( nr - 0.5 ) ; if ( nx [ 0 ] > UNITY_VALUE_NODES ) nx [ 0 ] -= UNITY_VALUE_NODES ; else if ( nx [ 0 ] < ZERO_VALUE_NODES ) nx [ 0 ] += UNITY_VALUE_NODES ; nx *= vec3 ( UNITY_VALUE_NODES , ns , nt ) ; nx = mix ( ln , mix ( lo , nx , step ( lo , nx ) ) , step ( nx , ln ) ) ; nw = mix ( nv , lG ( nx ) , nu ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"ny",qualifier:["float"]},{type:"node_in",name:"nz",qualifier:["vec3"]},{type:"node_out",name:"nA",qualifier:["vec3"]},{type:"textline",b:"nA = mix ( nz , ln - nz , ny ) ;".split(" ")}]}},{type:"node",name:"LAMP",group:{type:"group",a:[{type:"node_param",name:"mi",qualifier:["const","float"]},{type:"node_out",name:"nB",qualifier:["vec3"]},{type:"node_out",name:"nC",qualifier:["vec3"]},{type:"node_out",name:"nD",qualifier:["float"]},
{type:"node_out",name:"nE",qualifier:["float"]},{type:"textline",b:"{ const int nF = int ( mi ) ; vec4 nG = u_lamp_light_factors [ nF ] ; vec3 nH = u_lamp_light_directions [ nF ] ; vec3 nI = u_lamp_light_positions [ nF ] ; float nJ = nG . z ; nB = u_lamp_light_color_intensities [ nF ] ; if ( nJ != - UNITY_VALUE_NODES ) { nC = nI - ky ; nD = length ( nC ) ; nC = normalize ( nC ) ; nE = nJ / ( nJ + nD * nD ) ; float nK = nG . x ; float nL = nG . y ; if ( nK > - UNITY_VALUE_NODES ) { float nM = dot ( nC , nH ) ; nM *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nM - nK ) / nL ) ; nE *= nM ; } } else { nC = nH ; nD = length ( nI - ky ) ; nE = UNITY_VALUE_NODES ; } }".split(" ")}]}},
{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"mj",qualifier:["vec3"]},{type:"node_in",name:"nN",qualifier:["vec3"]},{type:"node_out",name:"nO",qualifier:["vec3"]},{type:"node_out",name:"nP",qualifier:["float"]},{type:"textline",b:"nO = mj ; nP = - dot ( nN , mj ) ;".split(" ")}]}},{type:"node",name:"VECTOR_VIEW",group:{type:"group",a:[{type:"node_in",name:"nQ",qualifier:["vec3"]},{type:"node_out",name:"nR",qualifier:["vec3"]},{type:"textline",b:"nR = - ( u_view_matrix_frag * vec4 ( nQ , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]}},
{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"mk",qualifier:["vec3"]},{type:"node_param",name:"ml",qualifier:["float"]},{type:"node_in",name:"nS",qualifier:["vec3"]},{type:"node_out",name:"nT",qualifier:["vec3"]},{type:"textline",b:"nT = nS * mk ; if ( ml == MAPPING_TYPE_NORMAL ) nT = normalize ( nT ) ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"mm",qualifier:["mat4"]},{type:"node_param",name:"mn",qualifier:["float"]},
{type:"node_param",name:"mo",qualifier:["float"]},{type:"node_param",name:"mp",qualifier:["vec3"]},{type:"node_param",name:"mq",qualifier:["vec3"]},{type:"node_param",name:"mr",qualifier:["float"]},{type:"node_in",name:"nU",qualifier:["vec3"]},{type:"node_out",name:"nV",qualifier:["vec3"]},{type:"textline",b:"nV = ( mm * vec4 ( nU , UNITY_VALUE_NODES ) ) . xyz ; if ( mn == UNITY_VALUE_NODES ) nV = max ( nV , mp ) ; if ( mo == UNITY_VALUE_NODES ) nV = min ( nV , mq ) ; if ( mr == MAPPING_TYPE_NORMAL ) nV = normalize ( nV ) ;".split(" ")}]}},
{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"nW",qualifier:["float"]},{type:"node_in",name:"nX",qualifier:["float"]},{type:"node_out",name:"nY",qualifier:["float"]},{type:"textline",b:"nY = nW + nX ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"nZ",qualifier:["float"]},{type:"node_in",name:"n_",qualifier:["float"]},{type:"node_out",name:"oa",qualifier:["float"]},{type:"textline",b:"oa = nZ - n_ ;".split(" ")}]}},{type:"node",
name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"ob",qualifier:["float"]},{type:"node_in",name:"oc",qualifier:["float"]},{type:"node_out",name:"od",qualifier:["float"]},{type:"textline",b:"od = ob * oc ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"oe",qualifier:["float"]},{type:"node_in",name:"of",qualifier:["float"]},{type:"node_out",name:"og",qualifier:["float"]},{type:"textline",b:"og = ( of != ZERO_VALUE_NODES ) ? oe / of : ZERO_VALUE_NODES ;".split(" ")}]}},
{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"oh",qualifier:["float"]},{type:"node_in",name:"oi",qualifier:["float"]},{type:"node_out",name:"oj",qualifier:["float"]},{type:"textline",b:"oj = sin ( oh ) ; oi ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"ok",qualifier:["float"]},{type:"node_in",name:"ol",qualifier:["float"]},{type:"node_out",name:"om",qualifier:["float"]},{type:"textline",b:"om = cos ( ok ) ; ol ;".split(" ")}]}},
{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"on",qualifier:["float"]},{type:"node_in",name:"oo",qualifier:["float"]},{type:"node_out",name:"op",qualifier:["float"]},{type:"textline",b:"op = tan ( on ) ; oo ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"oq",qualifier:["float"]},{type:"node_in",name:"or",qualifier:["float"]},{type:"node_out",name:"os",qualifier:["float"]},{type:"textline",b:"os = ( oq <= UNITY_VALUE_NODES && oq >= - UNITY_VALUE_NODES ) ? asin ( oq ) : ZERO_VALUE_NODES ; or ;".split(" ")}]}},
{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",name:"ot",qualifier:["float"]},{type:"node_in",name:"ou",qualifier:["float"]},{type:"node_out",name:"ov",qualifier:["float"]},{type:"textline",b:"ov = ( ot <= UNITY_VALUE_NODES && ot >= - UNITY_VALUE_NODES ) ? acos ( ot ) : ZERO_VALUE_NODES ; ou ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"ow",qualifier:["float"]},{type:"node_in",name:"ox",qualifier:["float"]},{type:"node_out",
name:"oy",qualifier:["float"]},{type:"textline",b:"oy = atan ( ow ) ; ox ;".split(" ")}]}},{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"oz",qualifier:["float"]},{type:"node_in",name:"oA",qualifier:["float"]},{type:"node_out",name:"oB",qualifier:["float"]},{type:"textline",b:"if ( oz < ZERO_VALUE_NODES || oz == ZERO_VALUE_NODES && oA == ZERO_VALUE_NODES ) oB = ZERO_VALUE_NODES ; else oB = pow ( oz , oA ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",
a:[{type:"node_in",name:"oC",qualifier:["float"]},{type:"node_in",name:"oD",qualifier:["float"]},{type:"node_out",name:"oE",qualifier:["float"]},{type:"textline",b:"oE = ( oC > ZERO_VALUE_NODES && oD > ZERO_VALUE_NODES ) ? log2 ( oC ) / log2 ( oD ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"oF",qualifier:["float"]},{type:"node_in",name:"oG",qualifier:["float"]},{type:"node_out",name:"oH",qualifier:["float"]},{type:"textline",
b:"oH = min ( oF , oG ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",name:"oI",qualifier:["float"]},{type:"node_in",name:"oJ",qualifier:["float"]},{type:"node_out",name:"oK",qualifier:["float"]},{type:"textline",b:"oK = max ( oI , oJ ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"oL",qualifier:["float"]},{type:"node_in",name:"oM",qualifier:["float"]},{type:"node_out",name:"oN",qualifier:["float"]},{type:"textline",
b:"oN = floor ( oL + 0.5 ) ; oM ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",a:[{type:"node_in",name:"oO",qualifier:["float"]},{type:"node_in",name:"oP",qualifier:["float"]},{type:"node_out",name:"oQ",qualifier:["float"]},{type:"textline",b:"oQ = ( oO < oP ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"oR",qualifier:["float"]},{type:"node_in",name:"oS",qualifier:["float"]},{type:"node_out",
name:"oT",qualifier:["float"]},{type:"textline",b:"oT = ( oR > oS ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"oU",qualifier:["float"]},{type:"node_in",name:"oV",qualifier:["float"]},{type:"node_out",name:"oW",qualifier:["float"]},{type:"textline",b:"oW = abs ( oV ) > 0.000001 ? mod ( oU , oV ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_ABSOLUTE",group:{type:"group",a:[{type:"node_in",name:"oX",
qualifier:["float"]},{type:"node_in",name:"oY",qualifier:["float"]},{type:"node_out",name:"oZ",qualifier:["float"]},{type:"textline",b:"oZ = abs ( oX ) ; oY ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"o_",qualifier:["float"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",qualifier:["vec3"]},{type:"textline",b:"{ float pd = clamp ( o_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pc = mix ( pa , pb , pd ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"pe",qualifier:["float"]},{type:"node_in",name:"pf",qualifier:["vec3"]},{type:"node_in",name:"pg",qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["vec3"]},{type:"textline",b:"{ float pi = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ph = mix ( pf , pf + pg , pi ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"pj",qualifier:["float"]},{type:"node_in",
name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_out",name:"pm",qualifier:["vec3"]},{type:"textline",b:"{ float pn = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pm = mix ( pk , pk * pl , pn ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"po",qualifier:["float"]},{type:"node_in",name:"pp",qualifier:["vec3"]},{type:"node_in",name:"pq",qualifier:["vec3"]},{type:"node_out",name:"pr",qualifier:["vec3"]},
{type:"textline",b:"{ float ps = clamp ( po , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pr = mix ( pp , pp - pq , ps ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"pt",qualifier:["float"]},{type:"node_in",name:"pu",qualifier:["vec3"]},{type:"node_in",name:"pv",qualifier:["vec3"]},{type:"node_out",name:"pw",qualifier:["vec3"]},{type:"textline",b:"{ float px = clamp ( pt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float py = UNITY_VALUE_NODES - px ; pw = ln - ( vec3 ( py ) + px * ( ln - pv ) ) * ( ln - pu ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"pz",qualifier:["float"]},{type:"node_in",name:"pA",qualifier:["vec3"]},{type:"node_in",name:"pB",qualifier:["vec3"]},{type:"node_out",name:"pC",qualifier:["vec3"]},{type:"textline",b:"{ float pD = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pE = UNITY_VALUE_NODES - pD ; pB += step ( pB , lo ) ; pC = pE * pA + pD * pA / pB ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",group:{type:"group",a:[{type:"node_in",
name:"pF",qualifier:["float"]},{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"textline",b:"{ float pJ = clamp ( pF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pI = mix ( pG , abs ( pG - pH ) , pJ ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"pK",qualifier:["float"]},{type:"node_in",name:"pL",qualifier:["vec3"]},{type:"node_in",name:"pM",qualifier:["vec3"]},
{type:"node_out",name:"pN",qualifier:["vec3"]},{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pN = min ( pL . rgb , pM . rgb * pO ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"pP",qualifier:["float"]},{type:"node_in",name:"pQ",qualifier:["vec3"]},{type:"node_in",name:"pR",qualifier:["vec3"]},{type:"node_out",name:"pS",qualifier:["vec3"]},{type:"textline",b:"{ float pT = clamp ( pP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pS = max ( pQ . rgb , pR . rgb * pT ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"pU",qualifier:["float"]},{type:"node_in",name:"pV",qualifier:["vec3"]},{type:"node_in",name:"pW",qualifier:["vec3"]},{type:"node_out",name:"pX",qualifier:["vec3"]},{type:"textline",b:"{ float pY = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pZ = UNITY_VALUE_NODES - pY ; vec3 p_ = vec3 ( pZ ) ; pX = mix ( pV * ( p_ + 2.0 * pY * pW ) , ln - ( p_ + 2.0 * pY * ( ln - pW ) ) * ( ln - pV ) , step ( 0.5 , pV ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"qa",qualifier:["float"]},{type:"node_in",name:"qb",qualifier:["vec3"]},{type:"node_in",name:"qc",qualifier:["vec3"]},{type:"node_out",name:"qd",qualifier:["vec3"]},{type:"textline",b:"{ float qe = clamp ( qa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qf = ln - qe * qc ; vec3 qg = qb / ( qf + step ( qf , lo ) ) ; qd = ( ln - step ( qb , lo ) ) * mix ( mix ( ln , qg , step ( qg , ln ) ) , ln , step ( qf , lo ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"qh",qualifier:["float"]},{type:"node_in",name:"qi",qualifier:["vec3"]},{type:"node_in",name:"qj",qualifier:["vec3"]},{type:"node_out",name:"qk",qualifier:["vec3"]},{type:"textline",b:"{ float ql = clamp ( qh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qm = ln - ql * ( ln - qj ) ; vec3 qn = ln - ( ln - qi ) / ( qm + step ( qm , lo ) ) ; qk = mix ( mix ( lo , mix ( ln , qn , step ( qn , ln ) ) , step ( ZERO_VALUE_NODES , qn ) ) , lo , step ( qm , lo ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"qo",qualifier:["float"]},{type:"node_in",name:"qp",qualifier:["vec3"]},{type:"node_in",name:"qq",qualifier:["vec3"]},{type:"node_out",name:"qr",qualifier:["vec3"]},{type:"textline",b:"{ float qs = clamp ( qo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qt , qu , qv ; qr = qp ; qu = lC ( qq ) ; if ( qu . y != ZERO_VALUE_NODES ) { qt = lC ( qr ) ; qt . x = qu . x ; qv = lG ( qt ) ; qr = mix ( qr , qv , qs ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SATURATION",group:{type:"group",a:[{type:"node_in",name:"qw",qualifier:["float"]},{type:"node_in",name:"qx",qualifier:["vec3"]},{type:"node_in",name:"qy",qualifier:["vec3"]},{type:"node_out",name:"qz",qualifier:["vec3"]},{type:"textline",b:"{ float qA = clamp ( qw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qB = UNITY_VALUE_NODES - qA ; qz = qx ; vec3 qC , qD ; qC = lC ( qz ) ; if ( qC . y != ZERO_VALUE_NODES ) { qD = lC ( qy ) ; qC . y = qB * qC . y + qA * qD . y ; qz = lG ( qC ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",name:"qE",qualifier:["float"]},{type:"node_in",name:"qF",qualifier:["vec3"]},{type:"node_in",name:"qG",qualifier:["vec3"]},{type:"node_out",name:"qH",qualifier:["vec3"]},{type:"textline",b:"{ float qI = clamp ( qE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qJ = UNITY_VALUE_NODES - qI ; vec3 qK , qL ; qK = lC ( qF ) ; qL = lC ( qG ) ; qK . z = qJ * qK . z + qI * qL . z ; qH = lG ( qK ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",
group:{type:"group",a:[{type:"node_in",name:"qM",qualifier:["float"]},{type:"node_in",name:"qN",qualifier:["vec3"]},{type:"node_in",name:"qO",qualifier:["vec3"]},{type:"node_out",name:"qP",qualifier:["vec3"]},{type:"textline",b:"{ float qQ = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qR , qS , qT ; qP = qN ; qS = lC ( qO ) ; if ( qS . y != ZERO_VALUE_NODES ) { qR = lC ( qP ) ; qR . x = qS . x ; qR . y = qS . y ; qT = lG ( qR ) ; qP = mix ( qP , qT , qQ ) ; } }".split(" ")}]}},{type:"node",
name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"qU",qualifier:["float"]},{type:"node_in",name:"qV",qualifier:["vec3"]},{type:"node_in",name:"qW",qualifier:["vec3"]},{type:"node_out",name:"qX",qualifier:["vec3"]},{type:"textline",b:"{ float qY = clamp ( qU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qZ = UNITY_VALUE_NODES - qY ; vec3 q_ = qW + qV - qW * qV ; qX = qV * ( vec3 ( qZ ) + vec3 ( qY ) * ( ( ln - qV ) * qW + q_ ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",
group:{type:"group",a:[{type:"node_in",name:"ra",qualifier:["float"]},{type:"node_in",name:"rb",qualifier:["vec3"]},{type:"node_in",name:"rc",qualifier:["vec3"]},{type:"node_out",name:"rd",qualifier:["vec3"]},{type:"textline",b:"{ float re = clamp ( ra , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rd = clamp ( rb + re * ( 2.0 * rc - ln ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; }".split(" ")}]}},{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"rf",qualifier:["vec3"]},{type:"node_in",
name:"rg",qualifier:["float"]},{type:"textline",b:"mP = rf ; mU = rg ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"ms",qualifier:["const","vec3"]},{type:"node_param",name:"mt",qualifier:["const","vec4"]},{type:"node_param",name:"mu",qualifier:["const","float"]},{type:"node_in",name:"rh",qualifier:["vec3"]},{type:"node_in",name:"ri",qualifier:["float"]},{type:"node_in",name:"rj",qualifier:["vec3"]},{type:"node_in",name:"rk",qualifier:["vec3"]},{type:"node_out",
name:"rl",qualifier:["vec3"]},{type:"node_out",name:"rm",qualifier:["float"]},{type:"node_out",name:"rn",qualifier:["vec3"]},{type:"textline",b:"{ rh = clamp ( rh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ri = clamp ( ri , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rj = clamp ( rj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 ro = rh ; float rp = ms [ 0 ] ; vec2 rq = vec2 ( ms [ 1 ] , ms [ 2 ] ) ; vec3 rr = mM * rh ; vec3 rs = mt [ 1 ] * rj ; float rt = mt [ 0 ] ; vec2 ru = vec2 ( mt [ 2 ] , mt [ 3 ] ) ; float rv = fl ( ro ) ; vec3 rw ; if ( mu == UNITY_VALUE_NODES ) rw = normalize ( rk ) ; else rw = mE ; float rx = 0.5 * rw . y + 0.5 ; vec3 ry = mO * u_environment_energy * lv ( rx , rw ) ; hp rz = mc ( rr , ry , ro , rs , mK , rw , mJ , ru , rq , rv , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ; rl = ( rp == UNITY_VALUE_NODES ) ? rz . a . rgb : lo ; rm = ri ; rn = rw ; if ( rt == UNITY_VALUE_NODES ) { rm += rz . a . a * rs . r * mN ; rm = clamp ( rm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rl += rz . b ; mQ = rz . b ; } else { mQ = lo ; } mR = rw ; mT = rv ; }".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"mv",qualifier:["const","vec3"]},{type:"node_param",name:"mw",qualifier:["const","vec4"]},{type:"node_param",name:"mx",qualifier:["const","float"]},{type:"node_in",name:"rA",qualifier:["vec3"]},{type:"node_in",name:"rB",qualifier:["float"]},{type:"node_in",name:"rC",qualifier:["vec3"]},{type:"node_in",name:"rD",qualifier:["vec3"]},{type:"node_in",name:"rE",qualifier:["float"]},{type:"node_in",name:"rF",qualifier:["float"]},
{type:"node_in",name:"rG",qualifier:["vec4"]},{type:"node_in",name:"rH",qualifier:["float"]},{type:"node_in",name:"rI",qualifier:["float"]},{type:"node_out",name:"rJ",qualifier:["vec3"]},{type:"node_out",name:"rK",qualifier:["float"]},{type:"node_out",name:"rL",qualifier:["vec3"]},{type:"node_out",name:"rM",qualifier:["vec3"]},{type:"node_out",name:"rN",qualifier:["vec3"]},{type:"textline",b:"{ rA = clamp ( rA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rB = clamp ( rB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rC = clamp ( rC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rO = rA ; float rP = mv [ 0 ] ; vec2 rQ = vec2 ( mv [ 1 ] , mv [ 2 ] ) ; vec3 rR = rE * rA ; vec3 rS = mw [ 1 ] * rC ; float rT = mw [ 0 ] ; vec2 rU = vec2 ( mw [ 2 ] , mw [ 3 ] ) ; float rV = fl ( rO ) ; vec3 rW ; if ( mx == UNITY_VALUE_NODES ) rW = normalize ( rD ) ; else rW = mE ; float rX = 0.5 * rW . y + 0.5 ; vec3 rY = mO * u_environment_energy * lv ( rX , rW ) ; hp rZ = mc ( rR , rY , rO , rS , mK , rW , mJ , rU , rQ , rV , rF , rG ) ; rJ = ( rP == UNITY_VALUE_NODES ) ? rZ . a . rgb : lo ; rK = rB ; rL = rW ; rM = rZ . a . rgb ; rN = rZ . b ; lP ( rJ , mJ , rL , rH ) ; if ( rT == UNITY_VALUE_NODES ) { rJ += rZ . b ; rK += rZ . a . a * rS . r * rI ; rK = clamp ( rK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mQ = rZ . b ; } else { mQ = lo ; } mR = rW ; mT = rV ; }".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"my",qualifier:["vec3"]},{type:"node_out",name:"r_",qualifier:["vec3"]},{type:"textline",b:["r_","=","my",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"sa",qualifier:["vec3"]},{type:"node_out",name:"sb",qualifier:["float"]},{type:"textline",b:"sb = sa . r * 0.35 + sa . g * 0.45 + sa . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"sc",qualifier:["vec3"]},
{type:"node_out",name:"sd",qualifier:["float"]},{type:"node_out",name:"se",qualifier:["float"]},{type:"node_out",name:"sf",qualifier:["float"]},{type:"textline",b:"sd = sc . r ; se = sc . g ; sf = sc . b ;".split(" ")}]}},{type:"node",name:"SEPHSV",group:{type:"group",a:[{type:"node_in",name:"sg",qualifier:["vec3"]},{type:"node_out",name:"sh",qualifier:["float"]},{type:"node_out",name:"si",qualifier:["float"]},{type:"node_out",name:"sj",qualifier:["float"]},{type:"textline",b:"{ vec3 sk = lC ( sg ) ; sh = sk . r ; si = sk . g ; sj = sk . b ; }".split(" ")}]}},
{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"sl",qualifier:["float"]},{type:"node_in",name:"sm",qualifier:["float"]},{type:"node_in",name:"sn",qualifier:["float"]},{type:"node_out",name:"so",qualifier:["float"]},{type:"textline",b:"so = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( sl - sn ) * sm ) ) ) ;".split(" ")}]}},{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"sp",qualifier:["vec3"]},{type:"node_out",name:"sq",
qualifier:["vec3"]},{type:"textline",b:"sq = max ( lo , sp ) ; sq = pow ( sq , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"sr",qualifier:["vec3"]},{type:"node_out",name:"ss",qualifier:["vec3"]},{type:"textline",b:"ss = max ( lo , sr ) ; ss = pow ( ss , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"st",qualifier:["vec3"]},{type:"node_out",name:"su",qualifier:["vec3"]},{type:"node_out",name:"sv",qualifier:["float"]},{type:"textline",b:"{ vec4 sw = texture2D ( node_TEXTURE_COLOR_var_texture , lK ( st ) ) ; su = sw . xyz ; gr ( su ) ; sv = sw . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sx",qualifier:["vec3"]},
{type:"node_out",name:"sy",qualifier:["vec3"]},{type:"node_out",name:"sz",qualifier:["float"]},{type:"textline",b:"{ vec4 sA = texture2D ( node_TEXTURE_NORMAL_var_texture , lK ( sx ) ) ; mS = sA . xyz - 0.5 ; sy = normalize ( mH * mS ) ; sz = sA . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",name:"sB",qualifier:["vec3"]},{type:"node_out",name:"sC",
qualifier:["vec3"]},{type:"node_out",name:"sD",qualifier:["float"]},{type:"textline",b:"{ vec4 sE = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , sB ) ; sC = sE . xyz ; gr ( sC ) ; sD = sE . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sF",qualifier:["vec3"]},{type:"node_in",name:"sG",qualifier:["vec3"]},{type:"node_out",name:"sH",qualifier:["vec3"]},
{type:"node_out",name:"sI",qualifier:["float"]},{type:"node_out",name:"sJ",qualifier:["vec3"]},{type:"node_out",name:"sK",qualifier:["float"]},{type:"textline",b:"{ vec4 sL = texture2D ( node_TEXTURE_COLOR2_var_texture , lK ( sF ) ) ; sH = sL . xyz ; gr ( sH ) ; sI = sL . w ; sL = texture2D ( node_TEXTURE_COLOR2_var_texture , lK ( sG ) ) ; sJ = sL . xyz ; gr ( sJ ) ; sK = sL . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",
qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sM",qualifier:["vec3"]},{type:"node_in",name:"sN",qualifier:["vec3"]},{type:"node_out",name:"sO",qualifier:["vec3"]},{type:"node_out",name:"sP",qualifier:["float"]},{type:"node_out",name:"sQ",qualifier:["vec3"]},{type:"node_out",name:"sR",qualifier:["float"]},{type:"textline",b:"{ vec4 sS = texture2D ( node_TEXTURE_NORMAL2_var_texture , lK ( sM ) ) ; mS = sS . xyz - 0.5 ; sO = normalize ( mH * mS ) ; sP = sS . w ; sS = texture2D ( node_TEXTURE_NORMAL2_var_texture , lK ( sN ) ) ; mS = sS . xyz - 0.5 ; sQ = normalize ( mH * mS ) ; sR = sS . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sT",qualifier:["vec3"]},{type:"node_in",name:"sU",qualifier:["vec3"]},{type:"node_in",name:"sV",qualifier:["vec3"]},{type:"node_out",name:"sW",qualifier:["vec3"]},{type:"node_out",name:"sX",qualifier:["float"]},{type:"node_out",name:"sY",qualifier:["vec3"]},{type:"node_out",name:"sZ",qualifier:["float"]},{type:"node_out",name:"s_",
qualifier:["vec3"]},{type:"node_out",name:"ta",qualifier:["float"]},{type:"textline",b:"{ vec4 tb = texture2D ( node_TEXTURE_COLOR3_var_texture , lK ( sT ) ) ; sW = tb . xyz ; gr ( sW ) ; sX = tb . w ; tb = texture2D ( node_TEXTURE_COLOR3_var_texture , lK ( sU ) ) ; sY = tb . xyz ; gr ( sY ) ; sZ = tb . w ; tb = texture2D ( node_TEXTURE_COLOR3_var_texture , lK ( sV ) ) ; s_ = tb . xyz ; gr ( s_ ) ; ta = tb . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR4",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tc",qualifier:["vec3"]},{type:"node_in",name:"td",qualifier:["vec3"]},{type:"node_in",name:"te",qualifier:["vec3"]},{type:"node_in",name:"tf",qualifier:["vec3"]},{type:"node_out",name:"tg",qualifier:["vec3"]},{type:"node_out",name:"th",qualifier:["float"]},{type:"node_out",name:"ti",qualifier:["vec3"]},{type:"node_out",name:"tj",qualifier:["float"]},{type:"node_out",name:"tk",qualifier:["vec3"]},{type:"node_out",
name:"tl",qualifier:["float"]},{type:"node_out",name:"tm",qualifier:["vec3"]},{type:"node_out",name:"tn",qualifier:["float"]},{type:"textline",b:"{ vec4 to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( tc ) ) ; tg = to . xyz ; gr ( tg ) ; th = to . w ; to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( td ) ) ; ti = to . xyz ; gr ( ti ) ; tj = to . w ; to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( te ) ) ; tk = to . xyz ; gr ( tk ) ; tl = to . w ; to = texture2D ( node_TEXTURE_COLOR4_var_texture , lK ( tf ) ) ; tm = to . xyz ; gr ( tm ) ; tn = to . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tp",qualifier:["vec3"]},{type:"node_in",name:"tq",qualifier:["vec3"]},{type:"node_in",name:"tr",qualifier:["vec3"]},{type:"node_out",name:"ts",qualifier:["vec3"]},{type:"node_out",name:"tt",qualifier:["float"]},{type:"node_out",name:"tu",qualifier:["vec3"]},{type:"node_out",name:"tv",qualifier:["float"]},{type:"node_out",name:"tw",
qualifier:["vec3"]},{type:"node_out",name:"tx",qualifier:["float"]},{type:"textline",b:"{ vec4 ty = texture2D ( node_TEXTURE_NORMAL3_var_texture , lK ( tp ) ) ; mS = ty . xyz - 0.5 ; ts = normalize ( mH * mS ) ; tt = ty . w ; ty = texture2D ( node_TEXTURE_NORMAL3_var_texture , lK ( tq ) ) ; mS = ty . xyz - 0.5 ; tu = normalize ( mH * mS ) ; tv = ty . w ; ty = texture2D ( node_TEXTURE_NORMAL3_var_texture , lK ( tr ) ) ; mS = ty . xyz - 0.5 ; tw = normalize ( mH * mS ) ; tx = ty . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL4",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tz",qualifier:["vec3"]},{type:"node_in",name:"tA",qualifier:["vec3"]},{type:"node_in",name:"tB",qualifier:["vec3"]},{type:"node_in",name:"tC",qualifier:["vec3"]},{type:"node_out",name:"tD",qualifier:["vec3"]},{type:"node_out",name:"tE",qualifier:["float"]},{type:"node_out",name:"tF",qualifier:["vec3"]},{type:"node_out",name:"tG",
qualifier:["float"]},{type:"node_out",name:"tH",qualifier:["vec3"]},{type:"node_out",name:"tI",qualifier:["float"]},{type:"node_out",name:"tJ",qualifier:["vec3"]},{type:"node_out",name:"tK",qualifier:["float"]},{type:"textline",b:"{ vec4 tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tz ) ) ; mS = tL . xyz - 0.5 ; tD = normalize ( mH * mS ) ; tE = tL . w ; tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tA ) ) ; mS = tL . xyz - 0.5 ; tF = normalize ( mH * mS ) ; tG = tL . w ; tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tB ) ) ; mS = tL . xyz - 0.5 ; tH = normalize ( mH * mS ) ; tI = tL . w ; tL = texture2D ( node_TEXTURE_NORMAL4_var_texture , lK ( tC ) ) ; mS = tL . xyz - 0.5 ; tJ = normalize ( mH * mS ) ; tK = tL . w ; }".split(" ")}]}},
{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"mz",qualifier:["const","float"]},{type:"node_out",name:"tM",qualifier:["float"]},{type:"textline",b:["tM","=","mz",";"]}]}},{type:"node",name:"ANIM_VALUE",group:{type:"group",a:[{type:"node_param",name:"mA",qualifier:["const","int"]},{type:"node_out",name:"tN",qualifier:["float"]},{type:"textline",b:"tN = u_anim_values [ mA ] ;".split(" ")}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"tO",
qualifier:["vec3"]},{type:"node_in",name:"tP",qualifier:["vec3"]},{type:"node_out",name:"tQ",qualifier:["vec3"]},{type:"node_out",name:"tR",qualifier:["float"]},{type:"textline",b:"tQ = tO + tP ; tR = ( abs ( tQ [ 0 ] ) + abs ( tQ [ 1 ] ) + abs ( tQ [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"tS",qualifier:["vec3"]},{type:"node_in",name:"tT",qualifier:["vec3"]},{type:"node_out",name:"tU",qualifier:["vec3"]},{type:"node_out",
name:"tV",qualifier:["float"]},{type:"textline",b:"tU = tS - tT ; tV = ( abs ( tU [ 0 ] ) + abs ( tU [ 1 ] ) + abs ( tU [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"tW",qualifier:["vec3"]},{type:"node_in",name:"tX",qualifier:["vec3"]},{type:"node_out",name:"tY",qualifier:["vec3"]},{type:"node_out",name:"tZ",qualifier:["float"]},{type:"textline",b:"tY = tW + tX ; tZ = length ( tY ) ; tY = normalize ( tY ) ;".split(" ")}]}},{type:"node",
name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"t_",qualifier:["vec3"]},{type:"node_in",name:"ua",qualifier:["vec3"]},{type:"node_out",name:"ub",qualifier:["vec3"]},{type:"node_out",name:"uc",qualifier:["float"]},{type:"textline",b:"ub = lo ; uc = dot ( t_ , ua ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"ud",qualifier:["vec3"]},{type:"node_in",name:"ue",qualifier:["vec3"]},{type:"node_out",name:"uf",qualifier:["vec3"]},
{type:"node_out",name:"ug",qualifier:["float"]},{type:"textline",b:"uf = cross ( ud , ue ) ; ug = length ( uf ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"uh",qualifier:["vec3"]},{type:"node_in",name:"ui",qualifier:["vec3"]},{type:"node_out",name:"uj",qualifier:["vec3"]},{type:"node_out",name:"uk",qualifier:["float"]},{type:"textline",b:"uj = normalize ( uh ) ; uk = length ( uh ) ; ui ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",
a:[{type:"node_in",name:"ul",qualifier:["vec3"]},{type:"node_in",name:"um",qualifier:["vec3"]},{type:"node_out",name:"un",qualifier:["vec3"]},{type:"textline",b:"un = reflect ( - ul , um ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"uo",qualifier:["vec3"]},{type:"node_in",name:"up",qualifier:["float"]},{type:"node_in",name:"uq",qualifier:["const","float"]},{type:"node_in",
name:"ur",qualifier:["const","float"]},{type:"node_out",name:"us",qualifier:["vec3"]},{type:"textline",b:"{ float ut = length ( mL ) ; if ( ut < ur ) { vec2 uu = lK ( uo ) ; float uv = clamp ( 0.5 * ( ur - ut ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float uw = up * uv ; vec3 ux = normalize ( mJ * mH ) ; float uy = UNITY_VALUE_NODES / uq ; vec2 uz = ux . xy * uw / ( uq * ux . z ) ; float uA = UNITY_VALUE_NODES ; float uB = texture2D ( node_PARALLAX_var_texture , uu ) . a ; for ( float uC = 1.0 ; uC <= uq ; uC ++ ) { if ( uB < uA ) { uA -= uy ; uu -= uz ; uB = texture2D ( node_PARALLAX_var_texture , uu ) . a ; } } vec2 uD = uu + uz ; float uE = texture2D ( node_PARALLAX_var_texture , uD ) . a - ( uA + uy ) ; float uF = uB - uA ; float uG = uF / ( uF - uE ) ; uu = uG * uD + ( UNITY_VALUE_NODES - uG ) * uu ; us = lI ( uu ) ; } else us = uo ; }".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"uH",qualifier:["vec3"]},{type:"node_out",name:"uI",qualifier:["vec3"]},{type:"textline",b:"uI = clamp ( uH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}},{type:"node",name:"REFRACTION",group:{type:"group",a:[{type:"node_in",name:"uJ",qualifier:["vec3"]},{type:"node_in",name:"uK",qualifier:["float"]},{type:"node_out",name:"uL",qualifier:["vec3"]},{type:"textline",b:"uL = ls ( uJ , uK ) ;".split(" ")}]}},{type:"node",
name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"uM",qualifier:["float"]},{type:"node_in",name:"uN",qualifier:["float"]},{type:"node_in",name:"uO",qualifier:["float"]},{type:"node_in",name:"uP",qualifier:["float"]},{type:"node_in",name:"uQ",qualifier:["float"]},{type:"node_out",name:"uR",qualifier:["float"]},{type:"node_out",name:"uS",qualifier:["vec4"]},{type:"textline",b:"uR = uM ; uS = vec4 ( uN , uO , uP , uQ ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",
name:"uT",qualifier:["float"]},{type:"textline",b:["uT","=","u_time",";"]}]}},{type:"node",name:"SMOOTHSTEP",group:{type:"group",a:[{type:"node_in",name:"uU",qualifier:["float"]},{type:"node_in",name:"uV",qualifier:["float"]},{type:"node_in",name:"uW",qualifier:["float"]},{type:"node_out",name:"uX",qualifier:["float"]},{type:"textline",b:"uX = smoothstep ( uV , uW , uU ) ;".split(" ")}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["vec3","mB","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mC = ky . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mD","=","kz",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],
group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mD = mD ; else mD = - mD ;".split(" ")}]}}]},{type:"textline",b:"vec3 mE = normalize ( mD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mF = cross ( mD , kA . xyz ) * kA . w ; mat3 mG = mat3 ( kA . xyz , mF , mD ) ; mat3 mH = mG ;".split(" ")}]}}]},{type:"textline",b:"vec3 mI = u_camera_eye_frag - ky ; vec3 mJ = normalize ( mI ) ; vec3 mK = ky ; vec4 mL = cF ; float mM = u_emit ; float mN = u_specular_alpha ; float mO = u_ambient ; vec3 mP ; vec3 mQ ; vec3 mR ; vec3 mS ; float mT ; float mU ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 uY = mP ; float uZ = mU ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uY = max ( uY - sqrt ( 0.01 * - min ( mC , ZERO_VALUE_NODES ) ) , 0.5 * uY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kw ( uY , mC , u_time , mT , mR , u_sun_direction , mB , u_sun_quaternion , ky , length ( cF ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float u_ = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 va = gL ( u_cube_fog , mJ ) ; vec4 vb = vec4 ( va , u_fog_color_density . a ) ; gr ( vb . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 vb = u_fog_color_density ; vb . rgb *= u_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hd ( uY , length ( cF ) , mJ , u_cam_water_depth , u_underwater_fog_color_density , vb , mC , u_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gE ( uY , length ( cF ) , vb ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( uZ < 0.5 ) discard ; uZ = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 vc = texture2DProj ( u_shadow_mask , cE ) . rg ; float vd = vc . g ; uY = vec3 ( vd ) ;".split(" ")}]}}]},{type:"textline",b:["gt","(","uY",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",
b:"gw ( uY , uZ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uY , uZ ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",
";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 ky ; varying vec4 cF ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kA",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION",
"&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"md",qualifier:["varying","vec2"]},{type:"textline",b:["md","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",
group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"mi",qualifier:["varying","vec3"]},{type:"textline",b:["mi","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"mj",qualifier:["varying","float"]},{type:"textline",b:["mj","=","node_GEOMETRY_VC1_var_a_vertex_color",
";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"mk",qualifier:["varying","vec2"]},{type:"textline",b:["mk","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ml",qualifier:["varying","vec3"]},
{type:"textline",b:["ml","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 mm = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mn = a_normal ; vec3 mo = vec3 ( a_tangent ) ; vec3 mp = a_tangent [ 3 ] * cross ( mn , mo ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",
a:[{type:"textline",b:"vec3 mn = a_normal ; vec3 mo = vec3 ( 0.0 ) ; vec3 mp = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mn = vec3 ( 0.0 ) ; vec3 mo = vec3 ( 0.0 ) ; vec3 mp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"mm = mix ( mm , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mn = mix ( mn , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mq = vec3 ( a_tangent ) ; vec3 mr = a_tangent_next [ 3 ] * cross ( a_normal_next , mq ) ; mo = mix ( mo , mq , u_va_frame_factor ) ; mp = mix ( mp , mr , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bn ( mm , mo , mp , mn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ms","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ms = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mt = ( u_model_matrix * vec4 ( ms , 1.0 ) ) . xyz ; mat4 mu = aa ( u_camera_eye , mt , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mv = ( u_model_matrix * vec4 ( ms , 1.0 ) ) . xyz ; mu = mu * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mv ) ;".split(" ")}]}}]},{type:"textline",b:"d mw = ah ( mm - ms , ms , mo , mp , mn , mu ) ; mw . b = mt ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mw = ah ( mm , ms , mo , mp , mn , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( mw . a , mw . b , mn ) ;".split(" ")}]}}]},{type:"textline",b:"ky = mw . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:"kz = mw . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mx = ( dot ( cross ( mw . e , mw . c ) , mw . d ) < 0.0 ) ? - 1.0 : 1.0 ; kA = vec4 ( mw . c , mx ) ;".split(" ")}]}}]},
{type:"textline",b:"cF = u_view_matrix * vec4 ( mw . a , 1.0 ) ; vec4 my = u_proj_matrix * cF ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"my . xy += u_subpixel_jitter * my . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gk","(","my",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gk ( mw . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mz = my . x ; float mA = my . y ; float mB = my . w ; cE . x = ( mz + mB ) / 2.0 ; cE . y = ( mA + mB ) / 2.0 ; cE . z = mB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kC = - cF . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},
{type:"textline",b:["gl_Position","=","my",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float mm ; varying vec3 kB ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cF",";"]}]}}]},{type:"textline",b:"void main ( ) { float mn = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mo = smoothstep ( u_p_alpha_start , u_p_alpha_end , mn ) ; float mp = u_diffuse_color . a * mm * ( 1.0 - clamp ( mo , 0.0 , 1.0 ) ) ; vec3 mq = kB * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:"gE ( mq , length ( cF ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gt","(","mq",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gw ( mq , mp ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mq , mp ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float mm ; varying vec3 kB ; varying vec3 cF ;".split(" ")},{type:"include",file:"particles.glslv"},
{type:"textline",b:"void main ( ) { mn ne ; ne = nd ( ) ; vec4 nf = u_view_matrix * vec4 ( ne . b , 1.0 ) ; gl_Position = u_proj_matrix * nf ; mm = ne . c ; kB = ne . d ; cF = nf . xyz ; float ng = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = ne . a * ng ; }".split(" ")}]};a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float mm ; varying vec3 kB ; varying vec2 a ; varying vec3 kx ; varying vec3 ky ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 ln = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lo = texture2D ( u_sampler , a ) ; gr ( lo . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"ln . rgb = mix ( ln . rgb , lo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"ln . rgb *= mix ( vec3 ( 1.0 ) , lo . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"ln . a = lo . a ;".split(" ")}]}}]},{type:"textline",b:"ln . rgb *= kB ; vec3 lp = u_diffuse_intensity * ln . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lq = u_emit * ln . rgb ; vec3 lr = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 ls = u_environment_energy * textureCube ( u_sky_texture , lr ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lt = 0.5 ; vec3 ls = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lt ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lu = u_ambient * ls ; float lv = u_specular_params [ 0 ] ; vec2 lw = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lx = lv * u_specular_color ; vec3 ly = normalize ( kx ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hp lz = jR ( lq , lu , lp , lx , ky , lr , ly , lw , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp lz = jW ( lq , lu , lp ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lA = lz . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","lA","=","lp",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gE ( lA , length ( cF ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lB = ln . a * mm ; gt ( lA ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gw ( lA , lB ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lA , lB ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ; varying float mm ; varying vec3 kB ; varying vec2 a ; varying vec3 kx ; varying vec3 ky ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cF",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lp ( vec2 ln , vec2 lo ) { return ( atan ( lo . y , lo . x ) - atan ( ln . y , ln . x ) ) ; } void main ( ) { mn lq ; lq = nd ( ) ; float lr ; mat4 ls ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { lr = lq . e ; ls = z ( lq . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { lr = lq . e ; ls = k ( ) ; ls [ 3 ] = vec4 ( lq . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { lr = lq . e ; ls = o ( radians ( 90.0 ) ) ; ls [ 3 ] = vec4 ( lq . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { lr = lp ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lq . e ; ls = m ( radians ( - 90.0 ) ) ; ls [ 3 ] = vec4 ( lq . b , 1.0 ) ; } vec4 lt = vec4 ( a_p_bb_vertex * 2.0 * lq . a * u_p_size , 0.0 , 1.0 ) ; vec4 lu = ls * q ( lr ) * lt ; vec4 lv = u_view_matrix * lu ; vec4 lw = u_proj_matrix * lv ; gl_Position = lw ; mm = lq . c ; kB = lq . d ; a = a_p_bb_vertex + 0.5 ; ky = lu . xyz ; kx = u_camera_eye - lu . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cF","=","lv",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 ne ; const float nf = 0.99 ; const float ng = 1.8 ; const int nh = 8 ; float nr ( vec3 ni , vec3 nj ) { float nk = dot ( nj , nj ) ; float nl = 2.0 * dot ( nj , ni ) ; float nm = dot ( ni , ni ) - 1.0 ; float nn = nl * nl - 4.0 * nk * nm ; float no = sqrt ( nn ) ; float np = ( - nl - no ) / 2.0 ; float nq = nm / np ; return nq ; } float ny ( float ns , float nt ) { float nu = 3.0 * ( 1.0 - nt * nt ) ; float nv = 2.0 * ( 2.0 + nt * nt ) ; float nw = 1.0 + ns * ns ; float nx = pow ( 1.0 + nt * nt - 2.0 * nt * ns , 1.5 ) ; nx = max ( nx , 0.00001 ) ; return ( nu / nv ) * ( nw / nx ) ; } float nG ( vec3 nz , vec3 nA , float nB ) { float nC = dot ( nA , - nz ) ; if ( nC < 0.0 ) { return 1.0 ; } vec3 nD = nz + nC * nA ; if ( length ( nD ) < nB ) { return 0.0 ; } else if ( length ( nD ) >= nB ) { vec3 nE = normalize ( nD ) * nB - nz ; float nF = acos ( dot ( normalize ( nE ) , nA ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nF * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nK ( float nH , vec3 nI , float nJ ) { return nI - nI * pow ( u_sky_color , vec3 ( nJ / nH ) ) ; } void main ( ) { vec3 nL = normalize ( ne ) ; vec3 nM = u_sun_direction ; float nN = dot ( nL , nM ) ; float nO = ny ( nN , - 0.01 ) * u_rayleigh_brightness * nM . y ; float nP = ny ( nN - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nM . y ) ; float nQ = smoothstep ( 0.0 , 100.0 , ny ( nN , 0.9995 ) ) * u_spot_brightness ; vec3 nR = vec3 ( 0.0 , nf , 0.0 ) ; float nS = nr ( nR , nL ) ; float nT = nS / float ( nh ) ; float nU = nG ( nR , nL , nf - 0.3 ) ; vec3 nV = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nW = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nX = 0 ; nX < nh ; nX ++ ) { float nY = nT * float ( nX ) ; vec3 nZ = nR + nL * nY ; float n_ = nG ( nZ , nM , nf - 0.2 ) ; float oa = nr ( nZ , nM ) ; vec3 ob = nK ( oa , vec3 ( ng ) , u_scatter_strength ) * n_ ; nV += nK ( sqrt ( nY ) , u_sky_color * ob , u_rayleigh_strength ) ; nW += nK ( nY , ob , u_mie_strength ) ; } nV = nV * nU * pow ( nS , u_rayleigh_collection_power ) / float ( nh ) ; nW = ( nW * nU * pow ( nS , u_mie_collection_power ) ) / float ( nh ) ; vec3 oc = vec3 ( nQ * nW + nP * nW + nO * nV ) ; gt ( oc ) ; gl_FragColor = vec4 ( oc , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 ne ; void main ( ) { vec4 ln = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lo = u_cube_view_matrix * ln ; ne = lo . xyz ; gl_Position = ln ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_sampler , a ) ; gt ( ln . rgb ) ; gw ( ln . rgb , ln . a ) ; gl_FragColor = ln ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 ln = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lo = u_proj_matrix * u_view_matrix * vec4 ( ln , 0.0 ) ; lo . x /= lo . w ; lo . y /= lo . w ; lo += 99999.0 * step ( lo . z , 0.0 ) ; lo += 100.0 * ( step ( 1.0 , abs ( lo . x ) ) + step ( 1.0 , abs ( lo . y ) ) ) ; lo . x = - a_lf_dist * lo . x ; lo . y = - a_lf_dist * lo . y ; float lp = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lq = vec2 ( a_lf_bb_vertex . x / lp , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float lr = 1.9 ; lq *= ( 1.0 + lr * length ( lo . xy ) ) ; } gl_Position = vec4 ( lo . xy + lq , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 ne ; void main ( ) { vec3 ln = textureCube ( u_sky , ne ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gr ( ln . rgb ) ; float lo = u_camera_eye_frag . y - WATER_LEVEL ; lo = min ( - lo * 0.03 , 0.8 ) ; float lp = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lq = normalize ( ne ) ; vec3 lr = vec3 ( 0.0 ) ; vec4 ls = u_underwater_fog_color_density ; ls . rgb = mix ( ls . rgb , lr , min ( - lq . y + lo , 1.0 ) ) * lp ; float lt = clamp ( sign ( lq . y - 0.05 * lo ) , 0.0 , 1.0 ) ; ln = mix ( ls . rgb , ln , lt ) ; gt ( ln . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( ln , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 ne ; void main ( ) { vec4 ln = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lo = u_sky_vp_inverse * ln ; ne = lo . xyz ; gl_Position = ln ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float ln = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 kx ; varying vec3 ky ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kz",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kA ; varying vec3 nf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ng",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ni",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nx ( in vec2 nj , in vec3 nk , in vec3 nl , in vec3 nm , out float nn ) { vec3 no = reflect ( - nl , nk ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 np = nj . xy + nk . xz * REFL_BUMP / kC ; nn = u_reflect_factor ; vec3 nq ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nq = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nq = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float nr = dot ( nl , nk ) ; nn *= max ( 1.0 - 1.0 / nr , 1.0 ) ; } else { nq = texture2D ( u_reflectmap , np ) . rgb ; gr ( nq ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nn = u_mirror_factor ; vec3 nq = nm * textureCube ( u_mirrormap , no ) . rgb ; gr ( nq ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nn = u_reflect_factor ; vec3 nq = nm * vec3 ( 0.3 , 0.5 , 1.0 ) ; gr ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ns = normalize ( no + nl ) ; float nt = 1.0 - dot ( nl , ns ) ; float nu = u_fresnel_params [ 3 ] ; float nv = u_fresnel_params [ 2 ] ; float nw = nu + ( 1.0 - nu ) * pow ( nt , nv ) ; nn = min ( nn * nw , 1.0 ) ; return nq ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 ny = mat3 ( kA , nf , kz ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nz = normalize ( kz ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 ny = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nz = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float nA = ky . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 nB = vec2 ( ng . x , - ng . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nB = vec2 ( ky . x , - ky . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","nB","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nC = vec3 ( 0.0 ) ; vec3 nD = texture2D ( u_normalmap0 , nB * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:"vec3 nE = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nE","+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nD = texture2D ( u_normalmap0 , nB * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["nE","+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nD = texture2D ( u_normalmap0 , nB * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],
group:{type:"group",a:[{type:"textline",b:["nE","+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nD = texture2D ( u_normalmap0 , nB * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nC += nD ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nE",
"+=","nD",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nF = ny * nE ; if ( ! g ( nF , vec3 ( 0.0 ) ) ) nF = normalize ( nF ) ; vec3 nG = mix ( nz , nF , 0.2 ) ; nG = normalize ( nG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nz = mix ( nz , normalize ( ny * nC ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nz = mix ( nz , normalize ( ny * nC ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nz = normalize ( nz ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nH = normalize ( kx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nI = cE . xy / cE . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"float nJ = kC * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nK = u_diffuse_color . a ; vec4 nL = texture2DProj ( u_scene_depth , cE ) ; float nM = cq ( nL ) ; float nN = max ( nM - kC , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nO = nI + nz . xz * u_refr_bump / kC ; float nP = le ( nM , nO , nI ) ; float nQ = max ( nP - kC , 0.0 ) ; float nR = u_view_max_depth / ABSORB * nQ ; float nS ; if ( u_cam_water_depth < 0.0 ) nS = 0.0 ; else nS = min ( nK * nR , 1.0 ) ; float nT = u_view_max_depth / ABSORB * nN ; nK = min ( 15.0 * nK * u_view_max_depth * nN , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nT = u_view_max_depth / ABSORB * nN ; if ( u_cam_water_depth > 0.0 ) nK = min ( nK * nT , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nK *= min ( 5.0 * nJ , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nK = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nS = 1.0 - nK ; vec2 nO = nI + nz . xz * REFR_BUMP / kC ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nU = texture2D ( u_refractmap , nO ) . rgb ; gr ( nU ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nV = pow ( min ( nh . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nW = mix ( u_shallow_water_col , u_diffuse_color . rgb , nV ) ; nV = pow ( min ( nh . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nW = mix ( u_shore_water_col , nW , nV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nW = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nX = max ( 1.0 - u_view_max_depth * nN , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nX = 1.0 - nK ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nY = max ( nA / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nZ = normalize ( vec3 ( nh . r , 0.0 , nh . g ) ) ; vec3 n_ = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nZ , 0.8 ) ) ; float oa = 1.25 * max ( dot ( nG , n_ ) - 0.2 , 0.0 ) ; oa += max ( dot ( nG , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nX += oa * ( 1.0 - nh . b ) ; nY *= ( 1.0 - 0.95 * pow ( nh . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nX += nY ; nX = min ( u_foam_factor * nX , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ob = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nB * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float oc = u_specular_params [ 0 ] ; vec2 od = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 oe = oc * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 of = u_environment_energy * textureCube ( u_sky_texture , nz ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 of = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 og = u_ambient * of ; vec3 oh = og + u_sun_intensity ; float oi ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 oj = nx ( nI , nz , nH , oh , oi ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 oj = nx ( vec2 ( 0.0 ) , nz , nH , oh , oi ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 ok = u_diffuse_intensity * nW ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hp ol = jR ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ok , oe , ky , nz , nH , od , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp ol = jW ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ok ) ;".split(" ")}]}}]},
{type:"textline",b:"ok = ol . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float om = max ( dot ( u_sun_direction , - kz ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nH , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; om = clamp ( SSS_STRENGTH * om , 0.0 , 1.0 ) ; ok = mix ( ok , u_shallow_water_col , om ) ; ok = mix ( ok , u_shore_water_col , om ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"ok = mix ( nU , ok , nS ) ;".split(" ")}]}}]},{type:"textline",b:"ok = mix ( ok , oj , oi ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float on = mix ( ob . g , ob . r , max ( 4.0 * ( nX - 0.75 ) , 0.0 ) ) ; on = mix ( ob . b , on , max ( 2.0 * nX - 1.0 , 0.0 ) ) ; on = mix ( 0.0 , on , nX ) ; ok = mix ( ok , oh , on ) ;".split(" ")}]}}]},{type:"textline",b:"ok += ol . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 oo = gL ( u_cube_fog , nH ) ; vec4 op = vec4 ( oo , u_fog_color_density . a ) ; gr ( op . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","op","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { hm ( ok , nJ , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gE ( ok , nJ , op ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gE ( ok , nJ , op ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gt","(","ok",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nK = max ( nK , ol . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nK","+=","on",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gw ( ok , nK ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oq = fwidth ( ni ) ; vec3 or = smoothstep ( vec3 ( 0.0 ) , oq * ln , ni ) ; float os = min ( min ( or . x , or . y ) , or . z ) ; os = clamp ( os , 0.0 , 1.0 ) ; ok = mix ( u_wireframe_edge_color , ok , os ) ; nK = mix ( 1.0 , nK , os ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ok , nK ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kx ; varying vec3 ky ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kz",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kA ; varying vec3 nf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ng",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","nh",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ni",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lt ( in vec2 ln ) { vec2 lo = 0.5 + vec2 ( ( ln . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( ln . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lp = texture2D ( u_shore_dist_map , lo ) ; const vec2 lq = vec2 ( 1.0 / 255.0 , 1.0 ) ; float lr = dot ( lp . ba , lq ) ; vec2 ls = normalize ( lp . rg * 2.0 - 1.0 ) ; return vec3 ( ls , lr ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lK ( inout vec3 lu , in float lv , in vec3 lw ) { float lx = dG ( DST_NOISE_SCALE_0 * ( lu . xz + DST_NOISE_FREQ_0 * lv ) ) * dG ( DST_NOISE_SCALE_1 * ( lu . zx - DST_NOISE_FREQ_1 * lv ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float ly = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lz = lw . b ; float lA = sqrt ( lz ) ; float lB = max ( lz , DIR_MIN_SHR_FAC ) * sin ( lA / ly + DIR_FREQ * lv ) ; float lC = max ( dG ( DIR_NOISE_SCALE * ( lu . xz + DIR_NOISE_FREQ * lv ) ) , DIR_MIN_NOISE_FAC ) ; lB *= lC ; float lD = WAVES_HEIGHT * mix ( lB , lx , max ( lA , DST_MIN_FAC ) ) ; vec2 lE = lw . rg ; float lF = WAVES_HOR_FAC * lB * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lz ) , 0.0 ) ; vec2 lG = lF * lE ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lD = WAVES_HEIGHT * lx ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lH = 2.0 * ( lu . xz - 0.1 * lv ) ; vec2 lI = 1.3 * ( lu . zx + 0.03 * lv ) ; float lJ = da ( 0.5 * lH ) . x + da ( 0.5 * lI ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lu . xz += lG ; lJ *= lz ;".split(" ")}]}}]},{type:"textline",
b:"lD += SMALL_WAVES_FAC * lJ ;".split(" ")}]}}]},{type:"textline",b:"lu . y += lD ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) ni = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) ni = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) ni = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","lL","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float lM = abs ( lL . y ) ; vec2 lN = u_camera_eye . xz - mod ( u_camera_eye . xz , lM ) ; lL . y = WATER_LEVEL ; lL . xz += lN ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d lO = ah ( lL , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"ng = lO . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"nh = lt ( lO . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float lP = length ( u_wind ) ; float lQ = u_time ; lQ *= lP ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"lR","=","lM",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lR","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 lS = lO . a + vec3 ( lR , 0.0 , 0.0 ) ; vec3 lT = lO . a + vec3 ( 0.0 , 0.0 , lR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 lU = lt ( lS . xz ) ; vec3 lV = lt ( lT . xz ) ; lK ( lS , lQ , lU ) ; lK ( lT , lQ , lV ) ; lK ( lO . a , lQ , nh ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lK ( lS , lQ , vec3 ( 0.0 ) ) ; lK ( lT , lQ , vec3 ( 0.0 ) ) ; lK ( lO . a , lQ , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { lO . a . y = WATER_LEVEL - 1.0 ; lS . y = lO . a . y ; lT . y = lO . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 lW = normalize ( lS - lO . a ) ; vec3 lX = normalize ( lT - lO . a ) ; kz = normalize ( cross ( lX , lW ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kA = lX ; nf = cross ( kz , kA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lY = dot ( kz , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lZ = clamp ( 0.8 - lY , 0.0 , 1.0 ) ; kz = mix ( kz , vec3 ( 0.0 , 1.0 , 0.0 ) , lZ ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"ky = lO . a ; kx = u_camera_eye - lO . a ; vec4 l_ = u_view_matrix * vec4 ( lO . a , 1.0 ) ; vec4 ma = u_proj_matrix * l_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float mb = ma . x ; float mc = ma . y ; float nj = ma . w ; cE . x = ( mb + nj ) / 2.0 ; cE . y = ( mc + nj ) / 2.0 ; cE . z = nj ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kC = - l_ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","ma",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 ni ; const float ln = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lo = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lo = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lp = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lq = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lr = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 ls = vec3 ( 0.0 ) ; float lt = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lu = sign ( ni - vec3 ( 0.02 * ln ) ) ; if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) { ls = lo ; lt = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lu = sign ( ni - vec3 ( 0.02 * ln ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) ls = u_wireframe_edge_color ; else ls = lr ; lt = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) lt = 1.0 ; else lt = 0.0 ; ls = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lu . x < 0.0 || lu . y < 0.0 || lu . z < 0.0 ) ls = u_wireframe_edge_color ; else if ( gl_FrontFacing ) ls = lp ; else ls = lq ; lt = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lv = fwidth ( ni ) ; vec3 lw = smoothstep ( vec3 ( 0.0 ) , lv * ln , ni ) ; float lx = min ( min ( lw . x , lw . y ) , lw . z ) ; lx = clamp ( lx , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { ls = vec3 ( mix ( u_wireframe_edge_color , lr , lx ) ) ; lt = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { ls = u_wireframe_edge_color ; lt = mix ( 1.0 , 0.0 , lx ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) ls = mix ( u_wireframe_edge_color , lp , lx ) ; else ls = mix ( u_wireframe_edge_color , lq , lx ) ; lt = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gt","(","ls",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gw ( ls , lt ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ls , lt ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","ni",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) ni = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) ni = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) ni = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 ln = a_position ; vec3 lo = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lp = ah ( ln , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ln = mix ( ln , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lq = vec3 ( 0.0 ) ; vec3 lr = vec3 ( 0.0 ) ; bn ( ln , lq , lr , lo ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","ls","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ls = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lp = ga ( ln , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ls , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lt = ( u_model_matrix * vec4 ( ls , 1.0 ) ) . xyz ; mat4 lu = aa ( u_camera_eye , lt , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lv = ( u_model_matrix * vec4 ( ls , 1.0 ) ) . xyz ; lu = lu * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lv ) ;".split(" ")}]}}]},{type:"textline",b:"d lp = ah ( ln - ls , ls , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lu ) ; lp . b = lt ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d lp = ah ( ln , ls , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( lp . a , lp . b , lo ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lw = u_view_matrix * vec4 ( lp . a , 1.0 ) ; gl_Position = u_proj_matrix * lw ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_sampler_left , a ) ; vec4 lo = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( ln [ 0 ] , lo [ 1 ] , lo [ 2 ] , ln [ 3 ] + lo [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",
b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lq ( float ln , float lo ) { vec2 lp = a + vec2 ( ln , lo ) * u_texel_size ; return texture2D ( u_color , lp ) ; } float lu ( vec4 lr ) { vec3 ls = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lt = dot ( lr . rgb , ls ) ; return lt ; } vec4 lN ( ) { vec4 lv = lq ( - 1.0 , - 1.0 ) ; vec4 lw = lq ( 1.0 , - 1.0 ) ; vec4 lx = lq ( - 1.0 , 1.0 ) ; vec4 ly = lq ( 1.0 , 1.0 ) ; vec4 lz = lq ( 0.0 , 0.0 ) ; float lA = lu ( lv ) ; float lB = lu ( lw ) ; float lC = lu ( lx ) ; float lD = lu ( ly ) ; float lE = lu ( lz ) ; float lF = min ( lE , min ( min ( lA , lB ) , min ( lC , lD ) ) ) ; float lG = max ( lE , max ( max ( lA , lB ) , max ( lC , lD ) ) ) ; vec2 lH ; lH . x = - ( ( lA + lB ) - ( lC + lD ) ) ; lH . y = ( ( lA + lC ) - ( lB + lD ) ) ; float lI = max ( ( lA + lB + lC + lD ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lJ = 1.0 / ( min ( abs ( lH . x ) , abs ( lH . y ) ) + lI ) ; lH = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lH * lJ ) ) * u_texel_size ; vec4 lK = 0.5 * ( texture2D ( u_color , a + lH * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lH * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 lL = lK * 0.5 + 0.25 * ( texture2D ( u_color , a + lH * - 0.5 ) + texture2D ( u_color , a + lH * 0.5 ) ) ; float lM = lu ( lL ) ; if ( ( lM < lF ) || ( lM > lG ) ) return lK ; else return lL ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oE ( ) { vec2 lO ; lO . x = a . x ; lO . y = a . y ; vec4 lP = texture2D ( u_color , lO ) ; vec4 lQ = lq ( 0.0 , 1.0 ) ; vec4 lR = lq ( 1.0 , 0.0 ) ; vec4 lS = lq ( 0.0 , - 1.0 ) ; vec4 lT = lq ( - 1.0 , 0.0 ) ; float lU = lu ( lQ ) ; float lV = lu ( lR ) ; float lW = lu ( lS ) ; float lX = lu ( lT ) ; float lY = lu ( lP ) ; float lZ = max ( lU , lY ) ; float l_ = min ( lU , lY ) ; float ma = max ( lV , lZ ) ; float mb = min ( lV , l_ ) ; float mc = max ( lW , lX ) ; float nj = min ( lW , lX ) ; float nk = max ( mc , ma ) ; float nl = min ( nj , mb ) ; float nm = nk * FXAA_QUALITY_EDGE_THRESHOLD ; float nn = nk - nl ; float no = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nm ) ; bool np = nn < no ; if ( np ) return lP ; vec4 nq = lq ( - 1.0 , - 1.0 ) ; vec4 nr = lq ( 1.0 , 1.0 ) ; vec4 ns = lq ( 1.0 , - 1.0 ) ; vec4 nt = lq ( - 1.0 , 1.0 ) ; float nu = lu ( nq ) ; float nv = lu ( nr ) ; float nw = lu ( ns ) ; float nx = lu ( nt ) ; float ny = lW + lU ; float nz = lX + lV ; float nA = 1.0 / nn ; float nB = ny + nz ; float nC = ( - 2.0 * lY ) + ny ; float nD = ( - 2.0 * lY ) + nz ; float nE = nw + nv ; float nF = nu + nw ; float nG = ( - 2.0 * lV ) + nE ; float nH = ( - 2.0 * lW ) + nF ; float nI = nu + nx ; float nJ = nx + nv ; float nK = ( abs ( nC ) * 2.0 ) + abs ( nG ) ; float nL = ( abs ( nD ) * 2.0 ) + abs ( nH ) ; float nM = ( - 2.0 * lX ) + nI ; float nN = ( - 2.0 * lU ) + nJ ; float nO = abs ( nM ) + nK ; float nP = abs ( nN ) + nL ; float nQ = nI + nE ; float nR = u_texel_size . x ; bool nS = nO >= nP ; float nT = nB * 2.0 + nQ ; if ( ! nS ) lW = lX ; if ( ! nS ) lU = lV ; if ( nS ) nR = u_texel_size . y ; float nU = ( nT * ( 1.0 / 12.0 ) ) - lY ; float nV = lW - lY ; float nW = lU - lY ; float nX = lW + lY ; float nY = lU + lY ; bool nZ = abs ( nV ) >= abs ( nW ) ; float n_ = max ( abs ( nV ) , abs ( nW ) ) ; if ( nZ ) nR = - nR ; float oa = clamp ( abs ( nU ) * nA , 0.0 , 1.0 ) ; vec2 ob ; ob . x = lO . x ; ob . y = lO . y ; vec2 oc ; oc . x = ( ! nS ) ? 0.0 : u_texel_size . x ; oc . y = ( nS ) ? 0.0 : u_texel_size . y ; if ( ! nS ) ob . x += nR * 0.5 ; if ( nS ) ob . y += nR * 0.5 ; vec2 od ; od . x = ob . x - oc . x ; od . y = ob . y - oc . y ; vec2 oe ; oe . x = ob . x + oc . x ; oe . y = ob . y + oc . y ; float of = ( ( - 2.0 ) * oa ) + 3.0 ; float og = lu ( texture2D ( u_color , od ) ) ; float oh = oa * oa ; float oi = lu ( texture2D ( u_color , oe ) ) ; if ( ! nZ ) nX = nY ; float oj = n_ * 1.0 / 4.0 ; float ok = lY - nX * 0.5 ; float ol = of * oh ; bool om = ok < 0.0 ; og -= nX * 0.5 ; oi -= nX * 0.5 ; bool on = abs ( og ) >= oj ; bool oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 1.5 ; if ( ! on ) od . y -= oc . y * 1.5 ; bool op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 1.5 ; if ( ! oo ) oe . y += oc . y * 1.5 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 2.0 ; if ( ! on ) od . y -= oc . y * 2.0 ; op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 2.0 ; if ( ! oo ) oe . y += oc . y * 2.0 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 2.0 ; if ( ! on ) od . y -= oc . y * 2.0 ; op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 2.0 ; if ( ! oo ) oe . y += oc . y * 2.0 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 4.0 ; if ( ! on ) od . y -= oc . y * 4.0 ; op = ( ! on ) || ( ! oo ) ; if ( ! oo ) oe . x += oc . x * 4.0 ; if ( ! oo ) oe . y += oc . y * 4.0 ; if ( op ) { if ( ! on ) og = lu ( texture2D ( u_color , od . xy ) ) ; if ( ! oo ) oi = lu ( texture2D ( u_color , oe . xy ) ) ; if ( ! on ) og = og - nX * 0.5 ; if ( ! oo ) oi = oi - nX * 0.5 ; on = abs ( og ) >= oj ; oo = abs ( oi ) >= oj ; if ( ! on ) od . x -= oc . x * 2.0 ; if ( ! on ) od . y -= oc . y * 2.0 ; if ( ! oo ) oe . x += oc . x * 2.0 ; if ( ! oo ) oe . y += oc . y * 2.0 ; } } } } float oq = lO . x - od . x ; float or = oe . x - lO . x ; if ( ! nS ) oq = lO . y - od . y ; if ( ! nS ) or = oe . y - lO . y ; bool os = ( og < 0.0 ) != om ; float ot = ( or + oq ) ; bool ou = ( oi < 0.0 ) != om ; float ov = 1.0 / ot ; bool ow = oq < or ; float ox = min ( oq , or ) ; bool oy = ow ? os : ou ; float oz = ol * ol ; float oA = ( ox * ( - ov ) ) + 0.5 ; float oB = oz * FXAA_QUALITY_SUBPIX ; float oC = oy ? oA : 0.0 ; float oD = max ( oC , oB ) ; if ( ! nS ) lO . x += oD * nR ; if ( nS ) lO . y += oD * nR ; return texture2D ( u_color , lO ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lN ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oE ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 ln = vec2 ( 0.0 , 0.0 ) ; vec2 lo = u_texel_size ; vec4 lp = texture2D ( u_color , a ) ; gl_FragColor = lp * 0.0875447373698 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0858112354248 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0808139781061 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0731235112908 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0635705267419 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0530985673112 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0426125984122 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0328565115809 ; ln += lo ; gl_FragColor += texture2D ( u_color , a + ln ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - ln ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lp , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_main , a ) ; vec4 lo = texture2D ( u_bloom , a ) ; vec4 lp = ln ; lp += lo ; gl_FragColor = vec4 ( lp . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_color , a ) ; vec3 lo = ln . rgb ; if ( u_brightness < 0.0 ) lo = lo * ( 1.0 + u_brightness ) ; else lo = lo + ( ( 1.0 - lo ) * u_brightness ) ; lo = ( lo - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lo *= u_exposure ; vec3 lp = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lq = dot ( lo , lp ) ; lo = mix ( vec3 ( lq ) , lo , u_saturation ) ; gl_FragColor = vec4 ( lo , ln . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cm ( clamp ( nq ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nr = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float ns = nq ( u_depth , a , u_camera_range ) ; ns *= u_view_max_depth ; float nt ; if ( ns < u_dof_dist ) nt = ( u_dof_dist - ns ) / u_dof_front ; else nt = ( ns - u_dof_dist ) / u_dof_rear ; nt = clamp ( nt , 0.0 , 1.0 ) ; vec4 nu = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nr , nu , nt ) ; } else gl_FragColor = nr ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float ls ( float ln , float lo , float lp ) { vec2 lq = a + vec2 ( ln , lo ) * u_texel_size ; vec4 lr = texture2D ( u_sampler , lq ) * lp ; return cq ( lr ) ; } void main ( ) { float lt = ( ls ( - 1.0 , - 1.0 , - 1.0 ) + ls ( 0.0 , - 1.0 , - 1.0 ) + ls ( 1.0 , - 1.0 , - 1.0 ) + ls ( - 1.0 , 0.0 , - 1.0 ) + ls ( 0.0 , 0.0 , 8.0 ) + ls ( 1.0 , 0.0 , - 1.0 ) + ls ( - 1.0 , 1.0 , - 1.0 ) + ls ( 0.0 , 1.0 , - 1.0 ) + ls ( 1.0 , 1.0 , - 1.0 ) ) ; lt *= 1000.0 ; gl_FragColor = vec4 ( lt , lt , lt , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_glow_src , a ) ; gl_FragColor = ln ; if ( u_draw_glow != 0.0 ) { vec4 lo = texture2D ( u_glow_mask , a ) ; vec4 lp = texture2D ( u_glow_mask_blurred , a ) ; float lq = lp . a - lo . a ; if ( lq != 0.0 ) { float lr = smoothstep ( 0.0 , 1.0 , lp . a ) ; if ( lo . a == 0.0 ) { vec3 ls = u_glow_color ; gt ( ls ) ; vec4 lt = vec4 ( clamp ( ls , 0.0 , 1.0 ) , lr ) ; gl_FragColor = mix ( ln , lt , lr ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nr ; varying vec2 ns ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nt ; void main ( ) { vec2 nu = ( nt . xy - a ) ; float nv = length ( nu ) ; vec2 nw = u_radial_blur_step * nu / nv ; float nx = nv / u_radial_blur_step ; nw *= min ( nx , STEPS_PER_PASS ) / STEPS_PER_PASS ; nx = max ( nx , STEPS_PER_PASS ) ; vec2 ny = a ; float nz = 0.0 ; for ( float nA = 0.0 ; nA < STEPS_PER_PASS ; nA += 1.0 ) { if ( nA <= nx ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float nB = nq ( u_input , ny , u_camera_range ) ; nz += max ( ( 1.0 - pow ( nv , 0.3 ) ) * step ( 0.9 , nB ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nC = texture2D ( u_input , ny ) ; nz += cq ( nC ) ;".split(" ")}]}}]},{type:"textline",b:"} ny += nw ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nD = a + ns ; float nE = da ( vec2 ( 2.5 * ( nD . x ) , 2.5 * ( nD . y ) + 1.0 * u_time ) ) . x + 0.75 * da ( vec2 ( 5.0 * ( nD . x ) - 0.66 * u_time , 5.0 * ( nD . y ) + 0.66 * u_time ) ) . x + 0.5 * dG ( vec2 ( 7.5 * ( nD . x ) + 0.33 * u_time , 7.5 * ( nD . y ) - 0.33 * u_time ) ) ; nE *= clamp ( 1.2 - sqrt ( 0.2 * nv ) , 0.0 , 1.0 ) * nr ; nz = max ( nE , nz ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cm ( nz / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nr ; varying vec2 ns ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nt ; void lu ( in vec4 ln , in vec3 lo , out vec3 lp ) { float lq = ln . w * lo . x + ln . y * lo . z - ln . z * lo . y ; float lr = ln . w * lo . y + ln . z * lo . x - ln . x * lo . z ; float ls = ln . w * lo . z + ln . x * lo . y - ln . y * lo . x ; float lt = - ln . x * lo . x - ln . y * lo . y - ln . z * lo . z ; lp . x = lq * ln . w - lt * ln . x - lr * ln . z + ls * ln . y ; lp . y = lr * ln . w - lt * ln . y - ls * ln . x + lq * ln . z ; lp . z = ls * ln . w - lt * ln . z - lq * ln . y + lr * ln . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lv = normalize ( u_sun_direction ) ; nt = u_proj_matrix * u_view_matrix * vec4 ( lv , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nr = 1.0 ; vec3 lw = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lx ; lu ( u_camera_quat , lw , lx ) ; lx = normalize ( lx ) ; float ly = dot ( lx , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lz = atan ( lx . x , lx . z ) ; ns = vec2 ( - lz , acos ( ly ) ) ; } else { nr = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nt . x /= nt . w ; nt . y /= nt . w ; nt . x = 0.5 * ( nt . x + 1.0 ) ; nt . y = 0.5 * ( nt . y + 1.0 ) ; nt += 99999.0 * step ( nt . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_main , a ) ; vec3 lo = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gr ( ln . rgb ) ; float lp = cq ( texture2D ( u_god_rays , a ) ) ; vec3 lq = ln . rgb + u_god_rays_intensity * vec3 ( lp ) * lo ; gt ( lq ) ; gl_FragColor . rgb = lq ; gl_FragColor . a = ln . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_color , a ) * 0.38026 ; ln += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; ln += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; ln += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; ln += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; ln += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; ln += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; ln += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; ln += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = ln ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_input , a ) ; float lo = dot ( ln . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lo ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float ln ; float lo = 0.0 ; for ( float lp = 0.025 ; lp < 1.0 ; lp += 0.05 ) for ( float lq = 0.025 ; lq < 1.0 ; lq += 0.05 ) { ln = max ( texture2D ( u_input , vec2 ( lp , lq ) ) . r , 0.01 ) ; lo += log ( ln ) ; } float lr = exp ( lo / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( lr ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nu ; void main ( ) { float nv = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nw = texture2D ( u_luminance , a ) . r ; vec4 nx = texture2D ( u_main , a ) ; float ny = nw / nv ; float nz = u_bloom_edge_lum ; gl_FragColor = nx * max ( ny - nz , 0.0 ) * nu ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nu ; const vec3 ln = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lv ( in vec4 lo , in vec3 lp , out vec3 lq ) { float lr = lo . w * lp . x + lo . y * lp . z - lo . z * lp . y ; float ls = lo . w * lp . y + lo . z * lp . x - lo . x * lp . z ; float lt = lo . w * lp . z + lo . x * lp . y - lo . y * lp . x ; float lu = - lo . x * lp . x - lo . y * lp . y - lo . z * lp . z ; lq . x = lr * lo . w - lu * lo . x - ls * lo . z + lt * lo . y ; lq . y = ls * lo . w - lu * lo . y - lt * lo . x + lr * lo . z ; lq . z = lt * lo . w - lu * lo . z - lr * lo . y + ls * lo . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lw ; lv ( u_camera_quat , ln , lw ) ; nu = dot ( - lw , u_sun_direction ) * u_bloom_key ; nu *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 ln = texture2D ( u_mb_tex_curr , a ) ; vec4 lo = texture2D ( u_mb_tex_accum , a ) ; if ( length ( ln - lo ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * ln + u_motion_blur_exp * lo ; } else { gl_FragColor = ln ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 ln = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( ln . r + ln . g + ln . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lo = vec2 ( 0.0 , 0.0 ) ; vec2 lp = u_texel_size ; vec4 lq ; lq = texture2D ( u_color , a ) ; gl_FragColor = lq * 0.2270270270 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.1945945946 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.1945945946 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.1216216216 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.1216216216 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.0540540541 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.0540540541 ; lo += lp ; lq = texture2D ( u_color , a + lo ) ; gl_FragColor += lq * 0.0162162162 ; lq = texture2D ( u_color , a - lo ) ; gl_FragColor += lq * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lp = u_texel_size ; vec4 lq = texture2D ( u_color , a ) ; gl_FragColor = lq ; if ( lq . a == 0.0 ) { lq = texture2D ( u_color , a + lp ) ; if ( lq . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lq . a ) ; else { lq = texture2D ( u_color , a - lp ) ; if ( lq . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lq . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nw ; varying vec4 nx ; varying vec4 ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nF ( vec2 nA , sampler2D nB ) { float nC = texture2D ( nB , nA ) . r ; float nD = texture2D ( nB , nw . xy ) . r ; float nE = texture2D ( nB , nw . zw ) . r ; return vec3 ( nC , nD , nE ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nL ( vec2 nG , sampler2D nH ) { vec3 nI = nF ( nG , nH ) ; vec2 nJ = abs ( nI . xx - nI . yz ) ; vec2 nK = step ( SMAA_PREDICATION_THRESHOLD , nJ ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nK ) ; }".split(" ")}]}}]},{type:"textline",b:"void nP ( bvec2 nM , inout vec2 nN , vec2 nO ) { if ( nM . x ) nN . x = nO . x ; if ( nM . y ) nN . y = nO . y ; } void nP ( bvec4 nQ , inout vec4 nR , vec4 nS ) { nP ( nQ . xy , nR . xy , nS . xy ) ; nP ( nQ . zw , nR . zw , nS . zw ) ; } vec2 nU ( vec2 nT ) { return sign ( nT ) * floor ( abs ( nT ) + .5 ) ; } vec4 nU ( vec4 nV ) { return sign ( nV ) * floor ( abs ( nV ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ol ( vec2 nW , sampler2D nX".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nY"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nZ = nL ( nW , nY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nZ = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 n_ = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float oa = dot ( texture2D ( nX , nW ) . rgb , n_ ) ; float ob = dot ( texture2D ( nX , nw . xy ) . rgb , n_ ) ; float oc = dot ( texture2D ( nX , nw . zw ) . rgb , n_ ) ; vec4 od ; od . xy = abs ( oa - vec2 ( ob , oc ) ) ; vec2 oe = step ( nZ , od . xy ) ; if ( dot ( oe , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float of = dot ( texture2D ( nX , nx . xy ) . rgb , n_ ) ; float og = dot ( texture2D ( nX , nx . zw ) . rgb , n_ ) ; od . zw = abs ( oa - vec2 ( of , og ) ) ; vec2 oh = max ( od . xy , od . zw ) ; float oi = dot ( texture2D ( nX , ny . xy ) . rgb , n_ ) ; float oj = dot ( texture2D ( nX , ny . zw ) . rgb , n_ ) ; od . zw = abs ( vec2 ( ob , oc ) - vec2 ( oi , oj ) ) ; oh = max ( oh . xy , od . zw ) ; float ok = max ( oh . x , oh . y ) ; oe . xy *= step ( ok , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * od . xy ) ; return oe ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 on ( vec2 om ) { om . r = om . r * abs ( 5.0 * om . r - 5.0 * 0.75 ) ; return nU ( om ) ; } vec4 on ( vec4 oo ) { oo . rb = oo . rb * abs ( 5.0 * oo . rb - 5.0 * 0.75 ) ; return nU ( oo ) ; } vec2 ow ( sampler2D op , vec2 oq , vec2 or , out vec2 os ) { vec4 ot = vec4 ( oq , - 1.0 , 1.0 ) ; vec3 ou = vec3 ( u_texel_size , 1.0 ) ; for ( int ov = 0 ; ov < SMAA_MAX_SEARCH_STEPS_DIAG ; ov ++ ) { if ( ot . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ot . w > 0.9 ) { ot . xyz += ou * vec3 ( or , 1.0 ) ; os = texture2D ( op , ot . xy , 0.0 ) . rg ; ot . w = dot ( os , vec2 ( 0.5 , 0.5 ) ) ; } } return ot . zw ; } vec2 oE ( sampler2D ox , vec2 oy , vec2 oz , out vec2 oA ) { vec4 oB = vec4 ( oy , - 1.0 , 1.0 ) ; oB . x += 0.25 * u_texel_size . x ; vec3 oC = vec3 ( u_texel_size , 1.0 ) ; for ( int oD = 0 ; oD < SMAA_MAX_SEARCH_STEPS_DIAG ; oD ++ ) { if ( oB . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oB . w > 0.9 ) { oB . xyz = oC * vec3 ( oz , 1.0 ) + oB . xyz ; oA = texture2D ( ox , oB . xy , 0.0 ) . rg ; oA = on ( oA ) ; oB . w = dot ( oA , vec2 ( 0.5 , 0.5 ) ) ; } } return oB . zw ; } vec2 oK ( sampler2D oF , vec2 oG , vec2 oH , float oI ) { vec2 oJ = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * oH + oG ; oJ = SMAA_AREATEX_PIXEL_SIZE * oJ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oJ . x += 0.5 ; oJ . y += SMAA_AREATEX_SUBTEX_SIZE * oI ; return texture2D ( oF , oJ , 0.0 ) . rg ; } vec2 oZ ( sampler2D oL , sampler2D oM , vec2 oN , vec2 oO , vec4 oP ) { vec2 oQ = vec2 ( 0.0 , 0.0 ) ; vec4 oR ; vec2 oS ; if ( oO . r > 0.0 ) { oR . xz = ow ( oL , oN , vec2 ( - 1.0 , 1.0 ) , oS ) ; oR . x += float ( oS . y > 0.9 ) ; } else oR . xz = vec2 ( 0.0 , 0.0 ) ; oR . yw = ow ( oL , oN , vec2 ( 1.0 , - 1.0 ) , oS ) ; if ( oR . x + oR . y > 2.0 ) { vec4 oT = vec4 ( - oR . x + 0.25 , oR . x , oR . y , - oR . y - 0.25 ) * u_texel_size . xyxy + oN . xyxy ; vec4 oU ; oU . xy = texture2D ( oL , oT . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oU . zw = texture2D ( oL , oT . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oU . yxwz = on ( oU . xyzw ) ; vec2 oV = vec2 ( 2.0 , 2.0 ) * oU . xz + oU . yw ; nP ( bvec2 ( step ( 0.9 , oR . zw ) ) , oV , vec2 ( 0.0 , 0.0 ) ) ; oQ += oK ( oM , oR . xy , oV , oP . z ) ; } oR . xz = oE ( oL , oN , vec2 ( - 1 , - 1 ) , oS ) ; if ( texture2D ( oL , oN + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oR . yw = oE ( oL , oN , vec2 ( 1 , 1 ) , oS ) ; oR . y += float ( oS . y > 0.9 ) ; } else oR . yw = vec2 ( 0.0 , 0.0 ) ; if ( oR . x + oR . y > 2.0 ) { vec4 oW = vec4 ( - oR . x , - oR . x , oR . y , oR . y ) * u_texel_size . xyxy + oN . xyxy ; vec4 oX ; oX . x = texture2D ( oL , oW . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oX . y = texture2D ( oL , oW . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oX . zw = texture2D ( oL , oW . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oY = vec2 ( 2.0 , 2.0 ) * oX . xz + oX . yw ; nP ( bvec2 ( step ( 0.9 , oR . zw ) ) , oY , vec2 ( 0 , 0 ) ) ; oQ += oK ( oM , oR . xy , oY , oP . w ) . gr ; } return oQ ; }".split(" ")}]}}]},
{type:"textline",b:"float pe ( sampler2D o_ , vec2 pa , float pb ) { vec2 pc = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 pd = SMAA_SEARCHTEX_SIZE * vec2 ( pb , 1.0 ) ; pc += vec2 ( - 1.0 , 1.0 ) ; pd += vec2 ( 0.5 , - 0.5 ) ; pc *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; pd *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( o_ , pc * pa + pd , 0.0 ) . r ; } float pm ( sampler2D pf , sampler2D pg , vec2 ph , float pi ) { vec2 pj = vec2 ( 0.0 , 1.0 ) ; for ( int pk = 0 ; pk < SMAA_MAX_SEARCH_STEPS ; pk ++ ) { if ( ph . x > pi && pj . g > 0.8281 && pj . r == 0.0 ) { pj = texture2D ( pf , ph , 0.0 ) . rg ; ph = - vec2 ( 2.0 , 0.0 ) * u_texel_size + ph ; } } float pl = - ( 255.0 / 127.0 ) * pe ( pg , pj , 0.0 ) + 3.25 ; return u_texel_size . x * pl + ph . x ; } float pu ( sampler2D pn , sampler2D po , vec2 pp , float pq ) { vec2 pr = vec2 ( 0.0 , 1.0 ) ; for ( int ps = 0 ; ps < SMAA_MAX_SEARCH_STEPS ; ps ++ ) { if ( pp . x < pq && pr . g > 0.8281 && pr . r == 0.0 ) { pr = texture2D ( pn , pp , 0.0 ) . rg ; pp = vec2 ( 2.0 , 0.0 ) * u_texel_size + pp ; } } float pt = - ( 255.0 / 127.0 ) * pe ( po , pr , 0.5 ) + 3.25 ; return - u_texel_size . x * pt + pp . x ; } float pC ( sampler2D pv , sampler2D pw , vec2 px , float py ) { vec2 pz = vec2 ( 1.0 , 0.0 ) ; for ( int pA = 0 ; pA < SMAA_MAX_SEARCH_STEPS ; pA ++ ) { if ( px . y > py && pz . r > 0.8281 && pz . g == 0.0 ) { pz = texture2D ( pv , px , 0.0 ) . rg ; px = - vec2 ( 0.0 , 2.0 ) * u_texel_size + px ; } } float pB = - ( 255.0 / 127.0 ) * pe ( pw , pz . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pB + px . y ; } float pK ( sampler2D pD , sampler2D pE , vec2 pF , float pG ) { vec2 pH = vec2 ( 1.0 , 0.0 ) ; for ( int pI = 0 ; pI < SMAA_MAX_SEARCH_STEPS ; pI ++ ) { if ( pF . y < pG && pH . r > 0.8281 && pH . g == 0.0 ) { pH = texture2D ( pD , pF , 0.0 ) . rg ; pF = vec2 ( 0.0 , 2.0 ) * u_texel_size + pF ; } } float pJ = - ( 255.0 / 127.0 ) * pe ( pE , pH . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pJ + pF . y ; } vec2 pR ( sampler2D pL , vec2 pM , float pN , float pO , float pP ) { vec2 pQ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nU ( 4.0 * vec2 ( pN , pO ) ) + pM ; pQ = SMAA_AREATEX_PIXEL_SIZE * pQ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pQ . y = SMAA_AREATEX_SUBTEX_SIZE * pP + pQ . y ; return texture2D ( pL , pQ , 0.0 ) . rg ; } void pZ ( sampler2D pS , inout vec2 pT , vec4 pU , vec2 pV ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pW = step ( pV . xy , pV . yx ) ; vec2 pX = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pW ; pX /= pW . x + pW . y ; vec2 pY = vec2 ( 1.0 , 1.0 ) ; pY . x -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pY . x -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pY . y -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pY . y -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pT *= clamp ( pY , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void qg ( sampler2D p_ , inout vec2 qa , vec4 qb , vec2 qc ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 qd = step ( qc . xy , qc . yx ) ; vec2 qe = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * qd ; qe /= qd . x + qd . y ; vec2 qf = vec2 ( 1.0 , 1.0 ) ; qf . x -= qe . x * texture2D ( p_ , qb . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; qf . x -= qe . y * texture2D ( p_ , qb . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; qf . y -= qe . x * texture2D ( p_ , qb . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; qf . y -= qe . y * texture2D ( p_ , qb . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; qa *= clamp ( qf , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qz ( vec2 qh , vec2 qi , sampler2D qj , sampler2D qk , sampler2D ql , vec4 qm ) { vec4 qn = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qo = texture2D ( qj , qh ) . rg ; if ( qo . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qn . rg = oZ ( qj , qk , qh , qo , qm ) ; if ( qn . r == - qn . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qp ; vec3 qq ; qq . x = pm ( qj , ql , nw . xy , ny . x ) ; qq . y = nx . y ; qp . x = qq . x ; float qr = texture2D ( qj , qq . xy , 0.0 ) . r ; qq . z = pu ( qj , ql , nw . zw , ny . y ) ; qp . y = qq . z ; qp = abs ( nU ( qp / u_texel_size . xx - qi . xx ) ) ; vec2 qs = sqrt ( qp ) ; float qt = texture2D ( qj , qq . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qn . rg = pR ( qk , qs , qr , qt , qm . y ) ; qq . y = qh . y ; pZ ( qj , qn . rg , qq . xyzy , qp ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qo . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qo . r > 0.0 ) { vec2 qu ; vec3 qv ; qv . y = pC ( qj , ql , nx . xy , ny . z ) ; qv . x = nw . x ; qu . x = qv . y ; float qw = texture2D ( qj , qv . xy , 0.0 ) . g ; qv . z = pK ( qj , ql , nx . zw , ny . w ) ; qu . y = qv . z ; qu = abs ( nU ( qu / u_texel_size . yy - qi . yy ) ) ; vec2 qx = sqrt ( qu ) ; float qy = texture2D ( qj , qv . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qn . ba = pR ( qk , qx , qw , qy , qm . x ) ; qv . x = qh . x ; qg ( qj , qn . ba , qv . xyxz , qu ) ; } return qn ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ ( vec2 qA , sampler2D qB , sampler2D qC".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qD"]}]}}]},{type:"textline",b:") { vec4 qE ; qE . x = texture2D ( qC , nv . xy ) . a ; qE . y = texture2D ( qC , nv . zw ) . g ; qE . wz = texture2D ( qC , qA ) . xz ; if ( dot ( qE , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qF = texture2D ( qB , qA , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qG = texture2D ( qD , a ) ; vec2 qH = 2.0 * cy ( qG ) - 1.0 ; qF . a = sqrt ( 2.0 * length ( qH ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qF ; } else { bool qI = max ( qE . x , qE . z ) > max ( qE . y , qE . w ) ; vec4 qJ = vec4 ( 0.0 , qE . y , 0.0 , qE . w ) ; vec2 qK = qE . yw ; nP ( bvec4 ( qI , qI , qI , qI ) , qJ , vec4 ( qE . x , 0.0 , qE . z , 0.0 ) ) ; nP ( bvec2 ( qI , qI ) , qK , qE . xz ) ; qK /= dot ( qK , vec2 ( 1.0 , 1.0 ) ) ; vec4 qL = qJ * vec4 ( u_texel_size , - u_texel_size ) + qA . xyxy ; vec4 qM = qK . x * texture2D ( qB , qL . xy , 0.0 ) ; qM += qK . y * texture2D ( qB , qL . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qN = texture2D ( qD , qL . xy ) ; vec2 qO = 2.0 * cy ( qN ) - 1.0 ; vec2 qP = qK . x * qO ; qN = texture2D ( qD , qL . zw ) ; qO = 2.0 * cy ( qN ) - 1.0 ; qP += qK . y * qO ; qM . a = sqrt ( 2.0 * length ( qP ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qM",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 rb ( vec2 qR , sampler2D qS , sampler2D qT".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qU"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = texture2D ( qU , a ) ; vec2 qW ; qW = 2.0 * cy ( qV ) - 1.0 ; vec4 qX = texture2D ( qS , qR ) ; vec4 qY = texture2D ( qT , qR - qW ) ; float qZ = abs ( qX . a * qX . a - qY . a * qY . a ) / 2.0 ; float q_ = 0.5 * clamp ( 1.0 - sqrt ( qZ ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 ra = mix ( qX , qY , q_ ) ; ra . a = 1.0 ; return ra ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qX = texture2D ( qS , qR ) ; vec4 qY = texture2D ( qT , qR ) ; return mix ( qX , qY , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = vec4 ( ol ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = qz ( a , nz , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = qQ ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 rc = vec4 ( rb ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 rc = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","rc",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nv",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nw ; varying vec4 nx ; varying vec4 ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lo ( vec2 ln ) { nw = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + ln . xyxy ; nx = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + ln . xyxy ; ny = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + ln . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void lr ( vec2 lp , out vec2 lq ) { lq = lp / u_texel_size ; nw = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lp . xyxy ; nx = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lp . xyxy ; ny = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nw . xz , nx . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lt ( vec2 ls ) { nv = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + ls . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lo","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"lr ( a , nz ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lt","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float nB ( in vec2 nA ) { return nq ( u_depth , nA , u_camera_range ) ; } void main ( ) { float nC = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nC , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nD = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float nE = nB ( a ) ; float nF = nE * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nG = 8.0 ; const int nH = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nG = 16.0 ; const int nH = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nG = 24.0 ; const int nH = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nG = 32.0 ; const int nH = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nI = u_ssao_radius_increase * 0.001 ; const float nJ = 1.0 + 2.4 / nG ; float nK = 0.0 ; for ( int nL = 0 ; nL < nH ; nL ++ ) for ( int nM = - 1 ; nM <= 1 ; nM += 2 ) for ( int nN = - 1 ; nN <= 1 ; nN += 2 ) for ( int nO = - 1 ; nO <= 1 ; nO += 2 ) { vec3 nP = reflect ( normalize ( vec3 ( nM , nN , nO ) ) , nD ) * ( nI *= nJ ) ; vec3 nQ = vec3 ( a , nF ) ; nQ += vec3 ( nP . xy , nP . z * nF * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nQ . z -= 1.4 * ( nQ . z - nF ) * step ( nF , nQ . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nR = nB ( nQ . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nS = clamp ( ( nF - nR ) / nR , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nK += mix ( 1.0 , nS , step ( nR , nQ . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"nK += mix ( step ( nQ . z , nR ) , 0.5 , nS ) ;".split(" ")}]}}]},{type:"textline",b:"} nK = nK / nG ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nK = clamp ( nK * nK + 0.6 * nK , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nK = clamp ( nK * nK + nK , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nT = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nE ) ; nK = mix ( 1.0 , nK , nT ) ; gl_FragColor = vec4 ( nC , nK , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float nB ( in vec2 nA ) { return nq ( u_depth , nA , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nC = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nD = nB ( a ) ; float nE = 0.0 ; float nF = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nG = vec2 ( - 2.0 ) ; for ( int nH = 0 ; nH < 4 ; ++ nH ) { for ( int nI = 0 ; nI < 4 ; ++ nI ) { vec2 nJ = ( nG + vec2 ( float ( nH ) , float ( nI ) ) ) * u_texel_size ; float nK = texture2D ( u_ssao_mask , a + nJ ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nL = nB ( a + nJ ) ; float nM = 1.0 - clamp ( abs ( nL - nD ) * nF , 0.0 , 1.0 ) ; nC += nK * nM ; nE += nM ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nC","+=","nK",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nC / nE , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nC / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float ln = texture2D ( u_depth , a ) . x ; vec4 lo = vec4 ( a * 2.0 - 1.0 , 2.0 * ln - 1.0 , 1.0 ) ; vec4 lp = u_view_proj_inverse * lo ; vec4 lq = lp / lp . w ; vec4 lr = u_view_proj_prev * lq ; lr /= lr . w ; vec2 ls = ( lo . xy - lr . xy ) / 4.0 + 0.5 ; ls = clamp ( ls , 0.0 , 1.0 ) ; gl_FragColor = cm ( ls ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:"return U ; } d ah ( in vec3 ab , in vec3 ac , in vec3 ad , in vec3 ae , in vec3 af , in mat4 ag ) { ab = ( ag * vec4 ( ab , 1.0 ) ) . xyz ; ac = ( ag * vec4 ( ac , 1.0 ) ) . xyz ; ad = ( ag * vec4 ( ad , 0.0 ) ) . xyz ; ae = ( ag * vec4 ( ae , 0.0 ) ) . xyz ; af = ( ag * vec4 ( af , 0.0 ) ) . xyz ; return s ( d ( ab , ac , ad , ae , af , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 ak ( vec2 ai , vec3 aj ) { return ( ai + 0.5 ) * aj . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 at ( in vec4 al , in vec4 am , in float an ) { float ao = al [ 0 ] * am [ 0 ] + al [ 1 ] * am [ 1 ] + al [ 2 ] * am [ 2 ] + al [ 3 ] * am [ 3 ] ; if ( ao < 0.0 ) { am *= - 1.0 ; ao = - ao ; } if ( abs ( ao ) >= 1.0 ) return al ; float ap = acos ( ao ) ; float aq = sqrt ( 1.0 - ao * ao ) ; if ( abs ( aq ) < 0.001 ) return vec4 ( al * 0.5 + am * 0.5 ) ; float ar = sin ( ( 1.0 - an ) * ap ) / aq ; float as = sin ( an * ap ) / aq ; return al * ar + am * as ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aI ( in vec3 au , in vec4 av , in vec4 aw , in vec4 ax , in vec4 ay , in float az ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aA = at ( av , aw , az ) ; vec4 aB = mix ( ax , ay , az ) ; vec3 aC = j ( aA , au ) ; vec3 aD = aC * aB . w + aB . xyz ; return aD ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aE = j ( av , au ) ; vec3 aF = j ( aw , au ) ; vec3 aG = aE * ax . w + ax . xyz ; vec3 aH = aF * ay . w + ay . xyz ; return mix ( aG , aH , az ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aR ( in vec3 aJ , in vec4 aK , in vec4 aL , in float aM ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aN = at ( aK , aL , aM ) ; vec3 aO = j ( aN , aJ ) ; return aO ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aP = j ( aK , aJ ) ; vec3 aQ = j ( aL , aJ ) ; return mix ( aP , aQ , aM ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aI ( in vec3 aS , in vec4 aT , in vec4 aU ) { vec3 aV = j ( aT , aS ) ; vec3 aW = aV * aU . w + aU . xyz ; return aW ; } vec3 aR ( in vec3 aX , in vec4 aY ) { vec3 aZ = j ( aY , aX ) ; return aZ ; }".split(" ")}]}}]},{type:"textline",b:"void bn ( inout vec3 a_ , inout vec3 ba , inout vec3 bb , inout vec3 bc ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bd","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 be = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bh = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bi = a_influence ; for ( int bj = 0 ; bj < 4 ; bj ++ ) { int bk = int ( bi [ bj ] ) ; float bl = fract ( bi [ bj ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"be += bl * aI ( a_ , u_quatsb [ bk ] , u_quatsa [ bk ] , u_transb [ bk ] , u_transa [ bk ] , bd ) ; bf += bl * aR ( ba , u_quatsb [ bk ] , u_quatsa [ bk ] , bd ) ; bg += bl * aR ( bb , u_quatsb [ bk ] , u_quatsa [ bk ] , bd ) ; bh += bl * aR ( bc , u_quatsb [ bk ] , u_quatsa [ bk ] , bd ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"be += bl * aI ( a_ , u_quatsb [ bk ] , u_transb [ bk ] ) ; bf += bl * aR ( ba , u_quatsb [ bk ] ) ; bg += bl * aR ( bb , u_quatsb [ bk ] ) ; bh += bl * aR ( bc , u_quatsb [ bk ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} a_ = be ; ba = bf ; bb = bg ; bc = bh ; } if ( ! ( a_influence . y > 0.0 ) ) { int bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"a_ = aI ( a_ , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , bd ) ; ba = aR ( ba , u_quatsb [ bm ] , u_quatsa [ bm ] , bd ) ; bb = aR ( bb , u_quatsb [ bm ] , u_quatsa [ bm ] , bd ) ; bc = aR ( bc , u_quatsb [ bm ] , u_quatsa [ bm ] , bd ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"a_ = aI ( a_ , u_quatsb [ bm ] , u_transb [ bm ] ) ; ba = aR ( ba , u_quatsb [ bm ] ) ; bb = aR ( bb , u_quatsb [ bm ] ) ; bc = aR ( bc , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bB ( inout vec3 bo , in vec3 bp , in float bq , in float br , in float bs , in vec3 bt , in float bu ) { float bv = length ( bp ) ; float bw = br * ( 1.0 + 0.1 * fract ( bv ) ) ; float bx = bq * bu * ( 1.0 + sin ( 2.0 * 3.14 * bs * bw + bv ) ) ; float by = ( bo . y - bp . y ) * abs ( bx ) ; by += 1.0 ; by *= by ; by = by * by - by ; vec3 bz = bo ; bz . xz += bt . xz * by * sign ( bx ) ; float bA = length ( bo - bp ) ; bo = bp + normalize ( bz - bp ) * bA ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bD ( vec4 bC ) { return bC * bC * ( 3.0 - 2.0 * bC ) ; } vec4 bF ( vec4 bE ) { return abs ( fract ( bE + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bH ( vec4 bG ) { return bD ( bF ( bG ) ) ; } void bY ( inout vec3 bI , in float bJ , in vec3 bK , in vec3 bL , in vec3 bM , in float bN , in float bO , in float bP , in vec3 bQ ) { float bR ; float bS ; float bT ; vec2 bU ; vec4 bV ; vec2 bW ; vec3 bX ; bR = dot ( bM , vec3 ( 1.0 ) ) ; bS = bR + bQ . g ; bT = dot ( bI , vec3 ( bQ . g ) ) ; bU = ( bJ + vec2 ( bT , bS ) ) ; bV = ( ( fract ( ( bU . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bL ) * bN ; bV = bH ( bV ) ; bW = bV . xz + bV . yw ; bW . y = 0.5 - bW . y ; bX = bW . xyx * bQ . rbr * vec3 ( bO * bK . x , bP , bO * bK . z ) ; bI += bX ; }".split(" ")}]}}]},
{type:"textline",b:"void ce ( inout vec3 bZ , inout vec3 b_ , in vec3 ca ) { vec3 cb = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 cc = b_ ; vec3 cd = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cc = bZ ; vec3 cd = b_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bY ( cc , u_time , ca , cb , cd , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bB ( cc , cd , au_wind_bending_amp , au_wind_bending_freq , u_time , cb , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bB ( cc , cd , au_wind_bending_amp , au_wind_bending_freq , u_time , cb , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bZ += cc - b_ ; b_ = cc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bZ = cc ; b_ = cd ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cf = 255.0 ; float cg = 0.0 ; float ch = 1.0 ; vec4 cm ( const in float ci ) { vec4 cj = vec4 ( cf * cf * cf , cf * cf , cf , ch ) ; vec4 ck = vec4 ( cg , ch / cf , ch / cf , ch / cf ) ; vec4 cl = fract ( ci * cj ) ; cl -= cl . xxyz * ck ; return cl ; } float cq ( const in vec4 cn ) { float co ; vec4 cp = vec4 ( ch / ( cf * cf * cf ) , ch / ( cf * cf ) , ch / cf , ch ) ; co = dot ( cn , cp ) ; return co ; } vec4 cm ( const in vec2 cr ) { vec2 cs = vec2 ( cf , ch ) ; vec2 ct = vec2 ( cg , ch / cf ) ; vec4 cu = fract ( cr . xxyy * cs . xyxy ) ; cu -= cu . xxzz * ct . xyxy ; if ( cr . r == ch ) cu . rg = vec2 ( cg , ch ) ; if ( cr . g == ch ) cu . ba = vec2 ( cg , ch ) ; return cu ; } vec2 cy ( const in vec4 cv ) { vec2 cw ; vec2 cx = vec2 ( ch / cf , ch ) ; cw . r = dot ( cv . rg , cx ) ; cw . g = dot ( cv . ba , cx ) ; return cw ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cG = 0.0 ; float cH = 1.0 ; vec4 cJ ( vec4 cI ) { return cI - floor ( cI * ( cH / 289.0 ) ) * 289.0 ; } vec3 cJ ( vec3 cK ) { return cK - floor ( cK * ( cH / 289.0 ) ) * 289.0 ; } vec2 cJ ( vec2 cL ) { return cL - floor ( cL * ( cH / 289.0 ) ) * 289.0 ; } vec4 cN ( vec4 cM ) { return cM - floor ( cM * ( cH / 7.0 ) ) * 7.0 ; } vec4 cP ( vec4 cO ) { return cJ ( ( 34.0 * cO + 5.0 ) * cO ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 da ( vec2 cQ ) { vec2 cR = cJ ( floor ( cQ ) ) ; vec2 cS = fract ( cQ ) ; vec4 cT = cS . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 cU = cS . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 cV = cP ( cR . x + vec4 ( cG , cH , cG , cH ) ) ; cV = cP ( cV + cR . y + vec4 ( cG , cG , cH , cH ) ) ; vec4 cW = cN ( cV ) * K + K2 ; vec4 cX = cN ( floor ( cV * K ) ) * K + K2 ; vec4 cY = cT + JITTER * cW ; vec4 cZ = cU + JITTER * cX ; vec4 c_ = cY * cY + cZ * cZ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"c_ . xy = min ( c_ . xy , c_ . zw ) ; c_ . x = min ( c_ . x , c_ . y ) ; return c_ . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c_ . xy = ( c_ . x < c_ . y ) ? c_ . xy : c_ . yx ; c_ . xz = ( c_ . x < c_ . z ) ? c_ . xz : c_ . zx ; c_ . xw = ( c_ . x < c_ . w ) ? c_ . xw : c_ . wx ; c_ . y = min ( c_ . y , c_ . z ) ; c_ . y = min ( c_ . y , c_ . w ) ; return sqrt ( c_ . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dq ( vec2 db , float dc ) { vec2 dd = cJ ( floor ( db ) ) ; vec2 de = fract ( db ) ; vec4 df = de . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dg = de . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dh = cP ( dd . x + vec4 ( cG , cH , cG , cH ) ) ; dh = cP ( dh + dd . y + vec4 ( cG , cG , cH , cH ) ) ; vec4 di = cN ( dh ) * K + K2 ; vec4 dj = cN ( floor ( dh * K ) ) * K + K2 ; vec4 dk = df + JITTER * di ; vec4 dl = dg + JITTER * dj ; vec4 dm = dk * dk + dl * dl ; dk += dc ; dl += dc ; vec4 dn = dk * dk + dl * dl ; dk += dc ; dl += dc ; vec4 dp = dk * dk + dl * dl ; dm . xy = min ( dm . xy , dm . zw ) ; dm . x = min ( dm . x , dm . y ) ; dn . xy = min ( dn . xy , dn . zw ) ; dn . x = min ( dn . x , dn . y ) ; dp . xy = min ( dp . xy , dp . zw ) ; dp . x = min ( dp . x , dp . y ) ; return mat3 ( dm . xx , cG , dn . xx , cG , dp . xx , cG ) ; } vec3 ds ( vec3 dr ) { return cJ ( ( ( dr * 34.0 ) + cH ) * dr ) ; } float dG ( vec2 dt ) { const vec4 du = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dv = floor ( dt + dot ( dt , du . yy ) ) ; vec2 dw = dt - dv + dot ( dv , du . xx ) ; vec2 dx ; dx = ( dw . x > dw . y ) ? vec2 ( cH , cG ) : vec2 ( cG , cH ) ; vec4 dy = dw . xyxy + du . xxzz ; dy . xy -= dx ; dv = cJ ( dv ) ; vec3 dz = ds ( ds ( dv . y + vec3 ( cG , dx . y , cH ) ) + dv . x + vec3 ( cG , dx . x , cH ) ) ; vec3 dA = max ( 0.5 - vec3 ( dot ( dw , dw ) , dot ( dy . xy , dy . xy ) , dot ( dy . zw , dy . zw ) ) , cG ) ; dA = dA * dA ; dA = dA * dA ; vec3 dB = 2.0 * fract ( dz * du . www ) - cH ; vec3 dC = abs ( dB ) - 0.5 ; vec3 dD = floor ( dB + 0.5 ) ; vec3 dE = dB - dD ; dA *= 1.79284291400159 - 0.85373472095314 * ( dE * dE + dC * dC ) ; vec3 dF ; dF . x = dE . x * dw . x + dC . x * dw . y ; dF . yz = dE . yz * dy . xz + dC . yz * dy . yw ; return 130.0 * dot ( dA , dF ) ; } vec2 dM ( vec2 dH ) { float dI = dot ( dH , vec2 ( 12.9898 , 78.233 ) ) ; float dJ = dot ( dH , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dK = fract ( sin ( dI ) * 43758.5453 ) * 2.0 - cH ; float dL = fract ( sin ( dJ ) * 43758.5453 ) * 2.0 - cH ; return vec2 ( dK , dL ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dN",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dO = 0.1 ; const float dP = 0.1 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dQ = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dR = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dS = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"textline",b:"float ee ( vec3 dT , sampler2D dU , float dV ) { float dW ; dT . z = clamp ( dT . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dW = 0.0 ; float dX = dM ( dT . xy ) . x * M_PI ; float dY = cos ( dX ) ; float dZ = sin ( dX ) ; mat2 d_ = mat2 ( dY , dZ , - dZ , dY ) ; vec2 ea , eb ; for ( int ec = 0 ; ec < 4 ; ec ++ ) for ( int ed = 0 ; ed < 4 ; ed ++ ) { eb . x = dR [ ec ] [ ed ] ; eb . y = dS [ ec ] [ ed ] ; eb = d_ * eb ; ea = dT . xy + eb * dV / SHADOW_TEX_RES ; dW += step ( dT . z , texture2D ( dU , ea ) . r ) ; } dW /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dW","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dW , 0.0 , 1.0 ) ; } float ew ( vec3 ef , sampler2D eg , vec3 eh , sampler2D ei , float ej , float ek , float el ) { float em , en ; ef . z = clamp ( ef . z , 0.0 , 1.0 ) ; eh . z = clamp ( eh . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"em = 0.0 ; en = 0.0 ; float eo = dM ( ef . xy ) . x * M_PI ; float ep = cos ( eo ) ; float eq = sin ( eo ) ; mat2 er = mat2 ( ep , eq , - eq , ep ) ; vec2 es , et ; for ( int eu = 0 ; eu < 4 ; eu ++ ) for ( int ev = 0 ; ev < 4 ; ev ++ ) { et . x = dR [ eu ] [ ev ] ; et . y = dS [ eu ] [ ev ] ; et = er * et ; es = ef . xy + et * ej / SHADOW_TEX_RES ; em += step ( ef . z , texture2D ( eg , es ) . r ) ; es = eh . xy + et * ek / SHADOW_TEX_RES ; en += step ( eh . z , texture2D ( ei , es ) . r ) ; } em = mix ( em , en , el ) ; em /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["em","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( em , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool ez ( vec2 ex , float ey ) { return all ( lessThanEqual ( ex , vec2 ( 1.0 + ey ) ) ) && all ( greaterThanEqual ( ex , vec2 ( 0.0 - ey ) ) ) ; } float eD ( vec2 eA ) { float eB = min ( eA . x , eA . y ) ; float eC = min ( 1.0 - eA . x , 1.0 - eA . y ) ; return min ( eB , eC ) ; } float eG ( float eE , float eF ) { if ( eF >= 0.0 && eF <= dP ) eE = ( eE - 1.0 ) / dP * eF + 1.0 ; return eE ; } float eS ( vec3 eH , vec3 eI , sampler2D eJ , sampler2D eK , float eL , float eM , float eN , float eO ) { float eP ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eQ = eD ( eH . xy ) ; if ( - eO > eN && eQ >= 0.0 && eQ <= dO && ez ( eI . xy , 0.0 ) ) { float eR = 1.0 - eQ / dO ; eP = ew ( eH , eJ , eI , eK , eL , eM , eR ) ; } else".split(" ")}]}}]},{type:"textline",b:"eP = ee ( eH , eJ , eL ) ; return eP ; } float e_ ( vec3 eT , sampler2D eU , float eV , float eW , float eX ) { float eY = ee ( eT , eU , eV ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eX > eW ) { float eZ = eD ( eT . xy ) ; eY = eG ( eY , eZ ) ; }".split(" ")}]}}]},{type:"textline",b:"return eY ; } float fg ( float fa ) { float fb = 1.0 ; vec3 fc = cA . xyz / cA . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fd = cB . xyz / cB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fe = cC . xyz / cC . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 ff = cD . xyz / cD . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ez ( fc . xy , 0.0 ) ) { fb = eS ( fc , fd , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fa ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( ez ( fc . xy , dQ ) ) { fb = e_ ( fc , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fa ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ez ( fd . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fb = eS ( fd , fe , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fa ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fb = e_ ( fd , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fa ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ez ( fe . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fb = eS ( fe , ff , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fa ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fb = e_ ( fe , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fa ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ez ( ff . xy , 0.0 ) ) fb = e_ ( ff , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fa ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fb",";","}"]}]}}]}]}}]},{type:"textline",b:"float fl ( inout vec3 fh ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fi = texture2DProj ( u_shadow_mask , cE ) . rg ; vec3 fj = vec3 ( fi . r ) ; float fk = fi . g ; dN = vec4 ( fj , fk ) ; fh *= dN . a ; return dN . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fg ( cF . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fq ( vec3 fm , float fn , vec2 fo ) { vec2 fp = vec2 ( ( fm . x - fo . x ) / fn , - ( fm . z - fo . y ) / fn ) ; return fract ( fp ) ; } vec2 fu ( vec2 fr , float fs , vec2 ft ) { return vec2 ( fr . x * fs , - fr . y * fs ) + ft ; } d fv ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d ga ( vec3 fw , vec3 fx , vec3 fy , vec3 fz , vec3 fA , sampler2D fB , sampler2D fC , vec3 fD , float fE , vec3 fF , vec4 fG , mat4 fH ) { vec3 fI = j ( fG , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fJ = - fI . x ; float fK = - fI . z ; vec2 fL = vec2 ( fF . x + fE * ( - 1.0 - fJ ) / 2.0 , fF . z + fE * ( 1.0 - fK ) / 2.0 ) ; vec2 fM = fq ( fA , fE , fL ) ; float fN = fE / 2.0 ; vec2 fO = abs ( fu ( fM - vec2 ( 0.5 ) , fE , vec2 ( 0.0 ) ) ) ; float fP = fN * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fO ) > fP ) return fv ( ) ; float fQ = fE / fD . z ; vec2 fR = ( fM - vec2 ( 0.5 ) ) * fQ + vec2 ( 0.5 ) ; vec3 fS = fI * ( fE / fD . z - 1.0 ) / 2.0 ; fR . x += fS . x ; fR . y -= fS . z ; vec4 fT = texture2D ( fC , fR ) ; float fU = fT . r ; if ( fU < u_scale_threshold ) return fv ( ) ; float fV = fD . y - fD . x ; float fW = fD . y - texture2D ( fB , fR ) . r * fV ; vec2 fX = fw . xz - fA . xz ; fA . xz = fu ( fM , fE , fL ) ; fA . y = fW ; fw . xz = fA . xz + fX ; fw . y *= fU ; fw . y += fW ; vec3 fY = fT . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fw -= fA ; mat4 fZ = aa ( fF , fA , fH ) ; d f_ = ah ( fw , fA , fx , fy , fz , fZ ) ; f_ . b = fA ; f_ . f = fY ; return s ( f_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fw , fA , fx , fy , fz , fY ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gg ( mat4 gb , vec4 gc ) { vec2 gd = ( gb * u_v_light_matrix [ 3 ] ) . xy ; float ge = SHADOW_TEX_RES / 2.0 ; gd = floor ( gd * ge + 0.5 ) / ge - gd ; vec4 gf = gb * gc ; gf . xy += gd ; gf = u_b_light_matrix * gf ; return gf ; } void gk ( vec3 gh ) { vec3 gi = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gj = u_v_light_matrix * vec4 ( gh + u_normal_offset * gi , 1.0 ) ; cA = gg ( u_p_light_matrix0 , gj ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cB = gg ( u_p_light_matrix1 , gj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cC = gg ( u_p_light_matrix2 , gj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cD = gg ( u_p_light_matrix3 , gj ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gk ( vec4 gl ) { float gm = gl . x ; float gn = gl . y ; float go = gl . w ; cE . x = ( gm + go ) / 2.0 ; cE . y = ( gn + go ) / 2.0 ; cE . z = go ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gr ( inout vec3 gq ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gq = max ( vec3 ( 0.0 ) , gq ) ; gq = pow ( gq , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gt ( inout vec3 gs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gs = max ( vec3 ( 0.0 ) , gs ) ; gs = pow ( gs , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gw ( inout vec3 gu , in float gv ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gu = gu * gv ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gE ( inout vec3 gz , in float gA , in vec4 gB ) { float gC = gB . w * gA ; float gD = exp ( - gC * gC ) ; gD = clamp ( gD , 0.0 , 1.0 ) ; gz = mix ( gB . rgb , gz , gD ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gL ( in mat4 gF , in vec3 gG ) { vec3 gH = mix ( gF [ 0 ] . rgb , gF [ 1 ] . rgb , max ( sign ( gG . x ) , 0.0 ) ) ; vec3 gI = mix ( gF [ 2 ] . rgb , gF [ 3 ] . rgb , max ( sign ( gG . z ) , 0.0 ) ) ; vec3 gJ = vec3 ( gF [ 0 ] . a , gF [ 1 ] . a , gF [ 2 ] . a ) ; vec3 gK = mix ( gH , gI , abs ( gG . z ) ) ; gK = mix ( gK , gJ , abs ( gG . y ) ) ; return gK ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gN ( inout float gM ) { gM -= 0.5 ; gM = 4.0 * ( gM * gM * gM ) + 0.5 ; } void hd ( inout vec3 gO , in float gP , in vec3 gQ , in float gR , in vec4 gS , in vec4 gT , in float gU , in float gV ) { float gW = gT . w * gP ; float gX = exp ( - gW * gW ) ; gX = clamp ( gX , 0.0 , 1.0 ) ; float gY = max ( gQ . y , 0.0 ) ; gP = max ( gP - max ( gR / gY , 0.0 ) , 0.0 ) ; float gZ = gS . w * gP ; float g_ = 1.0 - gZ ; g_ = max ( g_ , 0.0 ) ; gN ( g_ ) ; g_ += max ( gU - 0.5 , 0.0 ) ; if ( g_ < gX ) { vec3 ha = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hb = gS . rgb ; gR = clamp ( - gR * 0.03 , 0.0 , 0.8 ) ; vec3 hc = mix ( hb , ha , min ( gY , 1.0 ) ) ; hc = mix ( hc , vec3 ( 0.0 ) , gR ) * gV ; gO = mix ( hc , gO , g_ ) ; } if ( g_ >= gX ) { gO = mix ( gT . rgb , gO , gX ) ; } } void hm ( inout vec3 he , in float hf , in float hg , in vec4 hh , in float hi ) { float hj = hh . w * hf ; float hk = 1.0 - hj ; hk = clamp ( hk , 0.0 , 1.0 ) ; gN ( hk ) ; hg = clamp ( - hg * 0.03 , 0.0 , 0.8 ) ; vec3 hl = mix ( hh . rgb , vec3 ( 0.0 ) , hg ) * hi ; he = mix ( hl , he , hk ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hn = 0.0 ; float ho = 1.0 ; struct hp { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hx ( vec3 hq , vec3 hr , vec3 hs , vec4 ht , float hu ) { vec3 hv = normalize ( hq + hr ) ; float hw = ht [ 0 ] * max ( dot ( hs , hv ) , hn ) + ht [ 1 ] ; return pow ( hw , hu ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hI ( vec3 hy , vec3 hz , vec3 hA , float hB ) { vec3 hC = normalize ( hy + hz ) ; float hD = max ( dot ( hA , hC ) , 0.001 ) ; float hE = max ( dot ( hA , hz ) , 0.01 ) ; float hF = max ( dot ( hA , hy ) , 0.01 ) ; float hG = tan ( acos ( hD ) ) ; float hH = max ( hB , 0.001 ) ; return hF * ( ho / ( 4.0 * M_PI * hH * hH ) ) * ( exp ( - ( hG * hG ) / ( hH * hH ) ) / ( sqrt ( hE * hF ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hQ ( vec3 hJ , vec3 hK , vec3 hL , float hM , float hN ) { vec3 hO = normalize ( hJ + hK ) ; float hP = acos ( dot ( hO , hL ) ) ; if ( hP < hM ) return ho ; else if ( hP >= hM + hN || hN == hn ) return hn ; else return ho - ( hP - hM ) / hN ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void ik ( float hR , vec3 hS , vec3 hT , vec3 hU , float hV , inout float hW ) { if ( hV > hn ) { float hX = max ( dot ( hS , hU ) , hn ) ; float hY = hV * hV ; float hZ = ho - 0.5 * ( hY / ( hY + 0.33 ) ) ; vec3 h_ = hT - hR * hS ; vec3 ia = hU - hX * hS ; if ( length ( h_ ) == hn || length ( ia ) == hn || abs ( hR ) > ho || abs ( hX ) > ho ) hW = hW * hZ ; else { float ib = acos ( hR ) ; float ic = acos ( hX ) ; vec3 id = normalize ( h_ ) ; vec3 ie = normalize ( ia ) ; float ig , ih ; ig = max ( ib , ic ) ; ih = min ( ib , ic ) ; ih *= 0.95 ; float ii = max ( dot ( id , ie ) , hn ) ; float ij = 0.45 * ( hY / ( hY + 0.09 ) ) ; hW = hW * ( hZ + ( ij * ii * sin ( ig ) * tan ( ih ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void is ( vec3 il , vec3 im , float io , float ip , out float iq ) { float ir ; if ( io == hn ) { iq = ho ; } else { ir = ho + abs ( dot ( im , il ) ) ; ir = ip + ( ho - ip ) * pow ( ir , io ) ; iq = clamp ( ir , hn , ho ) ; } }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"void i_ ( inout hp it , vec3 iu , vec3 iv , vec3 iw , vec3 ix , vec3 iy , vec2 iz , vec2 iA , float iB , vec3 iC , vec3 iD , vec3 iE , vec4 iF , vec4 iG , float iH , vec4 iI ) { if ( iF . w + iG . w == hn ) return ; vec3 iJ = vec3 ( hn ) ; vec3 iK = iE * iB ; float iL = iG . z ; if ( iL != - ho ) { iJ = iC - iw ; float iM = length ( iJ ) ; iK *= iL / ( iL + iM * iM ) ; iJ = normalize ( iJ ) ; float iN = iG . x ; float iO = iG . y ; if ( iN > - ho ) { float iP = dot ( iJ , iD ) ; iP *= smoothstep ( hn , ho , ( iP - iN ) / iO ) ; iK *= iP ; } } else iJ = iD ; float iQ = hn ; if ( iF . w != hn ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"is ( ix , iJ , iA [ 0 ] , iA [ 1 ] , iQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iR = max ( dot ( ix , iJ ) , hn ) ; iQ = iF [ 0 ] * iR + iF [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ik ( iR , ix , iJ , iy , iA [ 0 ] , iQ ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iS = hn ; if ( iG . w != hn ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iS = hx ( iJ , iy , ix , iF , iz [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iS = hI ( iJ , iy , ix , iz [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iS = hQ ( iJ , iy , ix , iz [ 0 ] , iz [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iS","=","hn",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iJ , ix ) * dot ( iy , ix ) < hn ) { float iT = iI . x ; float iU = iI . y ; float iV = iI . z ; float iW = iI . w ; float iX = clamp ( abs ( dot ( iJ , ix ) ) , hn , ho ) ; float iY = clamp ( dot ( iy , - iJ ) , hn , ho ) ; float iZ = pow ( iY , iU ) ; it . a += iH * vec4 ( iK * iX * pow ( iu , vec3 ( iT ) ) , ho ) ; it . a += iV * mix ( vec4 ( iu , ho ) , vec4 ( ho ) , iW ) * iH * vec4 ( iK * iX * vec3 ( iZ ) , ho ) ; } else { it . b += iK * iv * iS ; it . a += vec4 ( iK * iu * iQ , iS ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"it . b += iK * iv * iS ; it . a += vec4 ( iK * iu * iQ , iS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hp jR ( vec3 ja , vec3 jb , vec3 jc , vec3 jd , vec3 je , vec3 jf , vec3 jg , vec2 jh , vec2 ji , float jj , vec3 jk [ NUM_LIGHTS ] , vec3 jl [ NUM_LIGHTS ] , vec3 jm [ NUM_LIGHTS ] , vec4 jn [ NUM_LIGHTS ] , vec4 jo [ NUM_LIGHTS ] , float jp , vec4 jq , int jr ) { hp js ; js . a = vec4 ( ja + jc * jb , hn ) ; js . b = vec3 ( hn ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float jt = ho ; if ( jr == 0 ) jt = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , jt , jk [ 0 ] , jl [ 0 ] , jm [ 0 ] , jn [ 0 ] , jo [ 0 ] , jp , jq ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float ju = ho ; if ( jr == 1 ) ju = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , ju , jk [ 1 ] , jl [ 1 ] , jm [ 1 ] , jn [ 1 ] , jo [ 1 ] , jp , jq ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"float jv = ho ; if ( jr == 2 ) jv = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , jv , jk [ 2 ] , jl [ 2 ] , jm [ 2 ] , jn [ 2 ] , jo [ 2 ] , jp , jq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"float jw = ho ; if ( jr == 3 ) jw = jj ; i_ ( js , jc , jd , je , jf , jg , jh , ji , jw , jk [ 3 ] , jl [ 3 ] , jm [ 3 ] , jn [ 3 ] , jo [ 3 ] , jp , jq ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jx = 0 ; jx < NUM_LIGHTS ; jx ++ ) { vec4 jy = jn [ jx ] ; vec4 jz = jo [ jx ] ; if ( jy . w + jz . w != hn ) { vec3 jA = vec3 ( hn ) ; vec3 jB = jm [ jx ] ; if ( jx == jr ) jB *= jj ; float jC = jz . z ; if ( jC != - ho ) { jA = jk [ jx ] - je ; float jD = length ( jA ) ; jB *= jC / ( jC + jD * jD ) ; jA = normalize ( jA ) ; float jE = jz . x ; float jF = jz . y ; if ( jE > - ho ) { float jG = dot ( jA , jl [ jx ] ) ; jG *= smoothstep ( hn , ho , ( jG - jE ) / jF ) ; jB *= jG ; } } else jA = jl [ jx ] ; float jH = hn ; if ( jy . w != hn ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"is ( jf , jA , ji [ 0 ] , ji [ 1 ] , jH ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jI = max ( dot ( jf , jA ) , hn ) ; jH = jy [ 0 ] * jI + jy [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ik ( jI , jf , jA , jg , ji [ 0 ] , jH ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jJ = hn ; if ( jz . w != hn ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jJ = hx ( jA , jg , jf , jy , jh [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jJ = hI ( jA , jg , jf , jh [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jJ = hQ ( jA , jg , jf , jh [ 0 ] , jh [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( jA , jf ) * dot ( jg , jf ) < hn ) { float jK = jq . x ; float jL = jq . y ; float jM = jq . z ; float jN = jq . w ; float jO = clamp ( abs ( dot ( jA , jf ) ) , hn , ho ) ; float jP = clamp ( dot ( jg , - jA ) , hn , ho ) ; float jQ = pow ( jP , jL ) ; js . a += jp * vec4 ( jB * jO * pow ( jc , vec3 ( jK ) ) , ho ) ; js . a += jM * mix ( vec4 ( jc , ho ) , vec4 ( ho ) , jN ) * jp * vec4 ( jB * jO * vec3 ( jQ ) , ho ) ; } else { js . b += jB * jd * jJ ; js . a += vec4 ( jB * jc * jH , jJ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"js . b += jB * jd * jJ ; js . a += vec4 ( jB * jc * jH , jJ ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","js",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hp jW ( vec3 jS , vec3 jT , vec3 jU ) { hp jV ; jV . a = vec4 ( jS + jU * jT , hn ) ; jV . b = vec3 ( hn ) ; return jV ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void kw ( inout vec3 jX , float jY , float jZ , float j_ , vec3 ka , vec3 kb , vec3 kc , vec4 kd , vec3 ke , float kf ) { if ( kf > CAUSTICS_VIEW_DISTANCE ) return ; vec4 kg = kd ; vec3 kh = ke + ka ; kh . xz = 10.0 * sin ( 0.1 * kh . xz ) ; vec3 ki = kh + 2.0 * cross ( - kg . xyz , cross ( - kg . xyz , kh ) + kg . w * kh ) ; vec2 kj = ki . xz ; vec3 kk = kb ; float kl = max ( dot ( ka , kk ) , 0.0 ) ; float km = 0.025 ; kj . s += 0.5 * sin ( dot ( ke + jZ , vec3 ( 1.0 ) ) ) ; kj . t += 0.7 * ( - sin ( dot ( ke - jZ , vec3 ( - 0.7 ) ) ) ) ; kj . st += 0.23 * cos ( 4.0 * jY - CAUST_SPEED . x * jZ ) ; kj . st += 3.0 * sin ( jY - 0.3 * CAUST_SPEED . y * jZ ) ; float kn = CAUST_SCALE * ( 1.0 + max ( 0.1 * jY , 0.0 ) ) ; mat3 ko = dq ( ( kj / kn ) , km ) ; float kp = ( ko * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kq = ( ko * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float kr = ( ko * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 ks = CAUST_BRIGHT * vec3 ( kp , kq , kr ) ; float kt = j_ * kl ; float ku = max ( sign ( jY ) , 0.0 ) ; kt = min ( kt + 0.5 * sign ( - ka . y ) * ku , 1.0 ) ; kt *= 1.0 - ku * ( 0.1 * jY ) ; ks *= kt ; ks *= ks ; float kv = min ( - jY + 10.0 , 1.0 ) ; jX += max ( ( 2.0 * kc * ks ) * kv , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kK ( in vec3 kD , in vec3 kE , in float kF , in float kG ) { vec3 kH = normalize ( kE + kD ) ; float kI = 1.0 - dot ( kD , kH ) ; float kJ = kG + ( 1.0 - kG ) * pow ( kI , kF ) ; return kJ ; } void kZ ( inout vec3 kL , in vec3 kM , in vec3 kN , in float kO , in float kP , in float kQ ) { vec3 kR = reflect ( - kM , kN ) ; float kS = 1.0 ; if ( kO != 0.0 ) kS = kK ( kM , kR , kO , kP ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kT = u_refl_plane . xyz * dot ( kN , u_refl_plane . xyz ) ; vec3 kU = kN - kT ; vec2 kV = ( u_view_matrix_frag * vec4 ( kU , 0.0 ) ) . xy ; vec2 kW = cE . xy / cE . z ; kW += kV * REFL_BUMP ; vec3 kX = texture2D ( u_reflectmap , kW ) . rgb ; gr ( kX . rgb ) ; kL = mix ( kL , kX , kQ * kS ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 kY = textureCube ( u_mirrormap , kR ) . xyz ; gr ( kY . rgb ) ; kL = mix ( kL , kY , u_mirror_factor * kS ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float le ( in float k_ , inout vec2 la , in vec2 lb ) { vec4 lc = texture2D ( u_scene_depth , la ) ; float ld = cq ( lc ) ; if ( ld < kC ) { la = lb ; return k_ ; } else { return ld ; } return k_ ; } vec3 lm ( in vec3 lf , in vec2 lg ) { vec2 lh = lf . xy / lf . z ; vec2 li = lh + lg ; vec4 lj = texture2DProj ( u_scene_depth , lf ) ; float lk = cq ( lj ) ; le ( lk , li , lh ) ; vec3 ll = texture2D ( u_refractmap , li ) . rgb ; gr ( ll ) ; return ll ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mn { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mu ( inout float mo , float mp , vec2 mq , vec2 mr ) { float ms = mr . x - mq . x ; float mt = ( mp - mq . x ) / ms ; mo = mix ( mo , mr . y , clamp ( mt , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mB ( inout vec3 mv , float mw , vec4 mx , vec4 my ) { float mz = my . x - mx . x ; float mA = ( mw - mx . x ) / mz ; mv = mix ( mv , my . yzw , clamp ( mA , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mI ( float mC , float mD , vec2 mE [ SIZE_RAMP_LENGTH ] ) { float mF = mC / mD ; float mG = mE [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mu ( mG , mF , mE [ 0 ] , mE [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mu ( mG , mF , mE [ 1 ] , mE [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mu ( mG , mF , mE [ 2 ] , mE [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mH = 1 ; mH < SIZE_RAMP_LENGTH ; mH ++ ) mu ( mG , mF , mE [ mH - 1 ] , mE [ mH ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mG",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mP ( float mJ , float mK , vec4 mL [ COLOR_RAMP_LENGTH ] ) { float mM = mJ / mK ; vec3 mN = mL [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mB ( mN , mM , mL [ 0 ] , mL [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mB ( mN , mM , mL [ 1 ] , mL [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mB ( mN , mM , mL [ 2 ] , mL [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mO = 1 ; mO < COLOR_RAMP_LENGTH ; mO ++ ) mB ( mN , mM , mL [ mO - 1 ] , mL [ mO ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mN",";","}"]}]}}]},{type:"textline",b:"float mY ( float mQ , float mR , float mS , float mT ) { float mU = max ( 0.01 , min ( mR , mS ) ) ; float mV = max ( 0.01 , min ( mR , mT ) ) ; float mW = mR - mV ; float mX = clamp ( mQ / mU , 0.0 , 1.0 ) - step ( mW , mQ ) * ( mQ - mW ) / mV ; return mX ; } mn nd ( ) { mn mZ ; float m_ ; if ( u_p_cyclic == 1 ) { m_ = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( m_ < 0.0 ) m_ += u_p_length ; } if ( u_p_cyclic != 1 ) { m_ = u_p_time - a_p_delay ; } if ( m_ < 0.0 || m_ >= a_p_lifetime ) { mZ . a = 0.0001 ; mZ . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( m_ < 0.0 || m_ >= a_p_lifetime ) ) { vec3 na = a_position ; vec3 nb = a_normal ; na += u_p_nfactor * m_ * nb ; na += a_p_vels . xyz * m_ ; na . y -= u_p_gravity * m_ * m_ / 2.0 ; float nc = max ( u_p_mass , EPSILON ) ; na += ( u_p_wind / nc ) * m_ * m_ / 2.0 ; mZ . b = na ; mZ . e = a_p_vels . w * m_ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mZ . a = mI ( m_ , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mZ . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mZ . d = mP ( m_ , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mZ . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mZ . c = mY ( m_ , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mZ ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nq ( in sampler2D nj , in vec2 nk , in vec2 nl ) { float nm = texture2D ( nj , nk ) . r ; float nn = nl . x ; float no = nl . y ; float np = 2.0 * nn / ( nn + no - ( 2.0 * nm - 1.0 ) * ( no - nn ) ) ; return np ; }".split(" ")}]}};b4w.module.animation=function(a,q){var c=q("__animation"),b=q("__constraints");q("__physics");var g=q("__print"),d=q("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=c.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var m=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){for(var a=[],b=c.wv(),d=0;d<b.length;d++)a.push(c.ly(b[d].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return c.Wi(a)?
c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.Iv(a,b)};a.apply=function(a,b,d){if(d>c.SLOT_7)g.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||c.SLOT_0;if(c.is_animated(a)){var l=c.get_slot_num_by_anim(a,b);if(-1!=l&&l!=d){g.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+l+'").');return}}c.apply(a,b,d)}};a.remove=function(a){c.remove(a)};
a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,b,d){c.is_animated(a)?(d=d||c.SLOT_0,c.play(a,b,d),c.update_object_animation(a,0,d)):g.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,
c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_current_frame_float(a,b,d),c.update_object_animation(a,0,d))};a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_speed(a,b)};a.get_frame_range=
function(a,b){if(c.is_animated(a)){b=b||c.SLOT_0;var d=a.w[b];if(d)return[d.start,d.start+d.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)?(b=b||c.SLOT_0,c.get_anim_start_frame(a,b)):-1};a.get_anim_length=function(a,b){return c.is_animated(a)?(b=b||c.SLOT_0,c.get_anim_length(a,b)):-1};a.cyclic=function(b,d,g){a.set_behavior(b,d?c.AB_CYCLIC:c.AB_FINISH_RESET,g)};a.is_cyclic=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_cyclic(a,b)};a.set_behavior=
function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,g){g=g||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,g)};a.update_object_animation=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};a.get_bone_translation=function(a,c,g){if(!d.Ye(a))return null;
g||(g=new Float32Array(3));b.Cv(a,c,!1,m,null);g[0]=m[0];g[1]=m[1];g[2]=m[2];return g};a.get_first_armature_object=function(a){return d.sc(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};a.get_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.yv(a,b)};a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.Gd};a.set_skel_mix_factor=function(a,b,k){d.Ye(a)?(b=Math.min(Math.max(b,0),1),a.d.Gd!=b&&c.set_skel_mix_factor(a,b,k||0)):g.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,q){var c=q("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,g,d){c.enqueue(a,g,d)}};b4w.module.camera=function(a,q){function c(a,c){b.Jb(a)?(k.copy(c,a.d.Wa),f.v(a),g.sync_transform(a)):d.error("set_pivot(): Wrong object or camera move style")}var b=q("__camera");q("__config");var g=q("__physics"),d=q("__print"),m=q("__constraints"),f=q("__transform"),h=q("__util"),k=q("vec3"),l=q("vec4"),s=q("quat"),n=q("mat3"),w=q("mat4"),u=new Float32Array(3),z=new Float32Array(3),F=new Float32Array(4),p=new Float32Array(4),B=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_ANIMATION;
a.MS_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=function(a){return b.is_camera(a)};a.set_move_style=function(a,b){a.d.T=b};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(d.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(!b.Jb(a)&&!b.rh(a)&&!b.Fb(a))return d.error("set_velocity_params(): Wrong object or camera move style"),
null;var f=a.d;f.xm=c[0];f.wm=c[1];f.ym=c[2]};a.get_velocity_params=function(a,c){if(!b.Jb(a)&&!b.rh(a)&&!b.Fb(a))return d.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var f=a.d;c[0]=f.xm;c[1]=f.wm;c[2]=f.ym;return c};a.change_eye_target_dist=function(){d.error("change_eye_target_dist() deprecated")};a.set_look_at=function(a,c,d,h){var k=a.d;b.Zu(c,d,h,k.e,k.quat);f.v(a);g.sync_transform(a)};a.get_eye=function(a,c){if(b.is_camera(a))return c||(c=
new Float32Array(3)),k.copy(a.d.e,c),c;d.error("get_eye(): Wrong object")};a.set_pivot=c;a.get_pivot=function(a,c){if(b.Jb(a))return c||(c=new Float32Array(3)),k.copy(a.d.Wa,c),c;d.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,c,n){if(b.Jb(a)){var l=a.d;u[0]=0;u[1]=1;u[2]=0;var m=h.quat_to_dir(l.quat,h.AXIS_MY,z);.999999>Math.abs(k.dot(m,u))&&(s.setAxisAngle(u,c,F),h.qq(l.e,l.Wa,F,l.e));u[0]=1;u[1]=0;u[2]=0;k.transformQuat(u,l.quat,u);s.setAxisAngle(u,n,F);h.qq(l.e,
l.Wa,F,l.e);f.v(a);g.sync_transform(a)}else d.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,c,h){if(b.Jb(a)){var l=a.d;if(l.ir){var m=n.fromMat4(l.H,B),p=k.subtract(l.e,l.Wa,z);u[0]=c;u[1]=0;u[2]=h;k.scale(u,k.len(p),u);k.transformMat3(u,m,u);k.add(l.Wa,u,l.Wa);k.add(l.e,u,l.e);f.v(a);g.sync_transform(a)}}else d.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,c){if(b.Fb(a)){var k=a.d;if(k.zb&&k.lo&&c){var n=s.setAxisAngle(h.AXIS_Y,c,F);s.normalize(n,n);s.multiply(n,
k.quat,k.quat);f.v(a);g.sync_transform(a)}}else d.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return b.Fb(a)?b.Io(a):(d.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){if(b.Fb(a)){var k=a.d;if(k.zb){var n=h.quat_to_dir(k.quat,h.AXIS_X,u),l=b.Io(a)-c,n=s.setAxisAngle(n,l,F),k=s.multiply(n,k.quat,F);f.set_rotation(a,k);f.v(a);g.sync_transform(a)}else d.warn("set_hover_cam_angle(): undefined without distance limits")}else d.error("set_hover_cam_angle(): wrong object or camera move style")};
a.get_hover_angle_limits=function(a,c){if(b.Fb(a))return a.d.Oa?(c||(c=new Float32Array(2)),c[0]=a.d.Oa.Qa,c[1]=a.d.Oa.Ka):d.warn("get_hover_angle_limits(): camera hasn't angle limits"),c;d.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.Fb(a)||b.Jb(a))return a.d.zb?(c||(c=new Float32Array(2)),c[0]=a.d.Pf,c[1]=a.d.Fc):d.warn("get_cam_dist_limits(): camera hasn't distance limits"),c;d.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,
c){if(b.Fb(a)){var h=a.d;h.zb?k.copy(c,h.Ud):f.set_translation(a,c);f.v(a);g.sync_transform(a)}else d.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,c){if(!b.Fb(a))return d.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));k.copy(a.d.Ud,c);return c};a.is_use_distance_limits=function(a){return b.Jb(a)||b.Fb(a)?a.d.zb:(d.error("is_use_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,h,k){if(b.Jb(a)||b.rh(a)){var n=
a.d;n.Aa={Ka:c,Qa:h};k==f.SPACE_LOCAL&&b.ez(a);b.zm(a)}else if(b.Fb(a)){if(c>h){d.error("apply_vertical_limits(): wrong horizontal limits");return}n=a.d;n.Aa={Ka:-h,Qa:-c}}else{d.error("apply_vertical_limits(): wrong object");return}f.v(a);g.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.Aa=null;(b.Jb(a)||b.rh(a))&&b.zm(a)};a.apply_horizontal_limits=function(a,c,h,k){if(b.Jb(a)||b.rh(a)){var n=a.d;n.pb={left:c,right:h};k==f.SPACE_LOCAL&&b.jw(a);b.zm(a)}else if(b.Fb(a)){if(c>h){d.error("apply_horizontal_limits(): wrong horizontal limits");
return}n=a.d;n.pb={left:c,right:h}}else{d.error("apply_horizontal_limits(): wrong object");return}f.v(a);g.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.pb=null};a.apply_hover_angle_limits=function(a,c,h){b.Fb(a)?c>h?d.error("apply_horizontal_limits(): wrong horizontal limits"):(a.d.Oa={Ka:c,Qa:h},f.v(a),g.sync_transform(a)):d.error("apply_horizontal_limits(): wrong object")};a.clear_hover_angle_limits=function(a){a.d.Oa=null};a.apply_distance_limits=function(a,c,h){if(b.Jb(a)||b.Fb(a))if(c>
h)d.error("apply_distance_limits(): wrong distance limits");else{var k=a.d;k.zb=!0;k.Fc=c;k.Pf=h;f.v(a);g.sync_transform(a)}else d.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.Jb(a)||b.Fb(a)?a.d.zb=!1:d.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(a,c,d){s.identity(a.d.quat);b.Vl(a,Math.PI/2);b.pq(a,c);b.Vl(a,-d);f.v(a);g.sync_transform(a)};a.is_look_up=function(a){h.quat_to_dir(a.d.quat,h.AXIS_MY,u);return 0<=u[1]?!0:!1};a.rotate=
function(a,c,d){b.pq(a,c);b.Vl(a,-d);f.v(a);g.sync_transform(a)};a.get_angles=function(a,c){c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.M,f=0;f<d.length;f++){var g=d[f];g.type!=b.tb&&g.type!=b.Bb||b.Kx(g,c,g.Pc)}};a.get_stereo_distance=function(a){a=a.d.M;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.tb||d.type==b.Bb)return d.Xh}return 0};a.is_underwater=function(a){return a.d.cr};a.translate_view=function(a,c,d,f){a=a.d.M;for(var g=
0;g<a.length;g++){var h=a[g];h.hb||b.mg(h,h.jb);var k=u;k[0]=-c;k[1]=-d;k[2]=0;w.translate(h.ia,k,h.ia);w.rotateZ(h.ia,f,h.ia);w.multiply(h.ia,h.ea,h.Df);b.At(h);b.zt(h)}};a.correct_up=function(a,b){b||(b=h.AXIS_Y);m.correct_up(a,b)};a.zoom_object=function(a,h){if(b.Jb(a)){f.get_object_center(h,!1,u);c(a,u);f.v(a);var k=f.get_object_size(h),n=b.xv(a)/2,k=k/Math.sin(n),n=f.Sw(a,u);f.move_local(a,0,k-n,0);f.v(a);g.sync_transform(a)}else d.error("zoom_object(): wrong object")};a.calc_ray=function(a,
c,f,g){g||(g=new Float32Array(3));var h=a.d.M[0];switch(h.type){case b.pc:case b.we:case b.tb:case b.Bb:var n=Math.tan(h.od*Math.PI/360);p[0]=(2*c/h.width-1)*n*h.jb;p[1]=-1;p[2]=(2*f/h.height-1)*n;p[3]=0;l.transformMat4(p,a.d.H,p);g[0]=p[0];g[1]=p[1];g[2]=p[2];k.normalize(g,g);return g;default:return d.error("Non-compatible camera"),g}};a.project_point=function(a,c,g){g||(g=new Float32Array(2));var h=a.d.M[0];switch(h.type){case b.pc:case b.we:case b.tb:case b.Bb:return f.get_translation(a,u),k.subtract(c,
u,u),p.set(u),p[3]=0,l.transformMat4(p,h.Df,p),a=-p[1]/p[3],g[0]=(p[0]/p[3]+1)/2*h.width|0,g[1]=(a+1)/2*h.height|0,g;default:return d.error("Non-compatible camera"),g}}};b4w.module.config=function(a,q){var c=q("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,q){var c=q("__controls");q("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;
a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=c.create_collision_sensor;a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;a.create_ray_sensor=c.create_ray_sensor;a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;
a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_timer_sensor=c.create_timer_sensor;a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,g){return c.create_selection_sensor(a,
g||!1)};a.set_custom_sensor=function(a,g){c.Ax(a,g)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,g,d){a.wl=g.slice(0);a.vl=Array(g.length);a.cj=d||c.Mk};a.remove_sensor_lock=function(a){a.wl=null;a.vl=null;a.cj=null};a.create_sensor_manifold=function(a,
g,d,m,f,h,k){f=f||c.Mk;c.create_sensor_manifold(a,g,d,m,f,h,void 0===k?null:k)};a.create_kb_sensor_manifold=function(a,g,d,m,f,h){m=c.create_keyboard_sensor(m);c.create_sensor_manifold(a,g,d,[m],c.Mk,f,void 0===h?null:h)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,null)};a.check_sensor_manifold=c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=
c.register_keyboard_events;a.register_mouse_events=c.register_mouse_events;a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_touch_events=c.unregister_touch_events};b4w.module.constraints=function(a,q){var c=q("__constraints"),b=q("__physics"),g=q("__transform");a.append_stiff=function(a,m,f,h,k){k=k||1;m instanceof Array&&2==m.length?c.an(a,m[0],m[1],f,h,k):c.bn(a,m,f,h,k);g.v(a);b.sync_transform(a)};a.append_semi_stiff=function(a,m,f,h){c.bt(a,m,f,h);g.v(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,m,f,h,k,l,q,n){c.at(a,m,f,h,k,l,q,n);g.v(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,m,f,h){if(!h||0>h)h=.25;c.$s(a,m,f,h);g.v(a);b.sync_transform(a)};
a.append_stiff_trans=function(a,m,f){c.ct(a,m,f);g.v(a);b.sync_transform(a)};a.append_copy_trans=function(a,m,f){c.Ws(a,m,f);g.v(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,m,f,h){c.dt(a,m,f,h);g.v(a);b.sync_transform(a)};a.append_track=function(a,m){3==m.length?c.gt(a,m):c.ft(a,m);g.v(a);b.sync_transform(a)};a.append_follow=function(a,m,f,h){3==m.length?c.Ys(a,m,f,h):c.Xs(a,m,f,h);g.v(a);b.sync_transform(a)};a.remove=function(a){a.$a&&c.remove(a)}};b4w.module.data=function(a,q){var c=q("__data");q("__print");var b=q("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.get_bpy_world=function(){b.da("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,q){q("__batch");var c=q("__print"),b=q("__controls"),g=q("__debug"),d=q("__physics"),m=q("__scenegraph"),f=q("__scenes"),h=q("__sfx"),k=q("__textures"),l=q("__util"),s=q("vec3");a.physics_worker=function(){d.Du()};a.physics_id=function(a){c.log("O",d.bv(a));for(var b=d.vv().j.l,f=0;f<b.length;f++){var g=b[f];g.gb.F==a&&c.log("B",g)}};a.visible_objects=function(){for(var a=f.get_active(),b=f.la(a,"MESH",f.DATA_ID_ALL),a=f.ga(a,"MAIN_OPAQUE").l,d=0;d<b.length;d++){var g=
b[d],h=g.d;if("DYNAMIC"==h.type)for(var k=0;k<a.length;k++){var l=a[k];if(l.R&&l.Va==h){c.log(g.name,g);break}}}};a.object_info=function(a){for(var b=f.get_active(),d=f.la(b,"MESH",f.DATA_ID_ALL),g=0;g<d.length;g++){var h=d[g];if(h.name==a){c.log("Object",h);for(var k=f.bl(b),l=0;l<k.length;l++){for(var e=k[l],m=e.l,q=[],s=0;s<m.length;s++)m[s].Va==h.d&&q.push(m[s]);c.log("Subscene "+e.type,q)}}}};a.objects_stat=function(){var a=f.get_active();console.log("Armatures: "+f.la(a,"ARMATURE",f.DATA_ID_ALL).length);
console.log("Cameras: "+f.la(a,"CAMERA",f.DATA_ID_ALL).length);console.log("Curves: "+f.la(a,"CURVE",f.DATA_ID_ALL).length);console.log("Empties: "+f.la(a,"EMPTY",f.DATA_ID_ALL).length);console.log("Lamps: "+f.la(a,"LAMP",f.DATA_ID_ALL).length);console.log("Meshes: "+f.la(a,"MESH",f.DATA_ID_ALL).length);console.log("Speakers: "+f.la(a,"SPEAKER",f.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=f.get_active(),b=[f.ga(b,"MAIN_OPAQUE"),f.ga(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.l,g=0;g<d.length;g++){var h=d[g].k;h&&(a+=h.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=f.get_active(),b=[f.ga(b,"MAIN_OPAQUE"),f.ga(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.l,g=0;g<d.length;g++){var h=d[g].k;h&&(a+=h.num_triangles)}}return a};a.num_draw_calls=function(){var a=f.get_active(),a=[f.ga(a,"MAIN_OPAQUE"),f.ga(a,"MAIN_BLEND")];return a[0].l.length+a[1].l.length};a.geometry_stats=function(){for(var a=f.get_active(),b=f.bl(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var g=d.l,h=0;h<g.length;h++){var k=g[h].k,e=g[h].Va;k&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||e.mj)&&(a[k.id]=k)}}var g=d=c=b=0,l;for(l in a)k=a[l],k=k.bb,k.Hi&&(d++,g+=k.Hi/1048576),b++,c+=k.bo/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:g}};a.num_textures=function(){for(var a=[],b=0,c=f.get_active(),c=[f.ga(c,"MAIN_OPAQUE"),f.ga(c,"MAIN_BLEND")],d=0;d<c.length;d++){var g=c[d];if(g)for(var g=
g.l,h=0;h<g.length;h++){var k=g[h].k;if(k)for(var k=k.D,e=0;e<k.length;e++){var l=k[e];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var m=l.Ha;-1===a.indexOf(m)&&(a.push(m),l=l.width*l.height*4/1048576/l.Bk,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=f.get_active(),c=f.bl(c),d=0;d<c.length;d++){var g=c[d];if("SINK"!=g.type){var h=g.h,l=[h.cb,h.hc];l.push.apply(l,g.Rc);for(g=0;g<l.length;g++){var e=l[g];k.vh(e)&&-1==a.indexOf(e)&&
(a.push(e),b+=h.width*h.height*k.Uv(e))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=f.get_active();(a=f.ga(a,"MAIN_OPAQUE"))&&f.wp(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=f.get_active(),b=f.ga(a,"MAIN_OPAQUE"),a=f.ry(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],g;switch(c){case 0:g=[1,0,0];break;case 1:g=[0,1,0];break;case 2:g=[0,0,1];break;default:g=[1,0,1]}f.wp(d.h,b,g)}};a.scenegraph_to_dot=function(){var a=f.get_active();
c.log(m.Au(f.dl(a)))};a.controls_info=b.debug;a.object_distance=function(a,b){return s.dist(a.d.e,b.d.e)};a.msg=g.msg;a.fbmsg=g.fbmsg;a.print_telemetry=g.print_telemetry;a.plot_telemetry=g.plot_telemetry;a.fbres=function(a,b){function c(){g.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),f=new Float32Array([0,0,1]),g=new Float32Array([-1,0,0]),h=new Float32Array([0,
-1,0]),e=new Float32Array([0,0,-1]);if(!l.Ld(a,l.Gs))throw"Wrong VEC3_IDENT";if(!l.Ld(b,l.Bs))throw"Wrong QUAT4_IDENT";if(!l.Ld(c,l.AXIS_X))throw"Wrong AXIS_X";if(!l.Ld(d,l.AXIS_Y))throw"Wrong AXIS_Y";if(!l.Ld(f,l.AXIS_Z))throw"Wrong AXIS_Z";if(!l.Ld(g,l.AXIS_MX))throw"Wrong AXIS_MX";if(!l.Ld(h,l.AXIS_MY))throw"Wrong AXIS_MY";if(!l.Ld(e,l.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=h.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==h.fl(c)&&h.mute(c,!0)}};
a.check_finite=function(a){g.check_finite(a)};a.set_debug_params=function(a){var b=f.get_active();if(b=f.ga(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&f.Qx(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&f.Px(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return c.Lv()};a.get_warning_quantity=function(){return c.Xv()};a.clear_errors_warnings=function(){return c.clear_errors_warnings()}};b4w.module.geometry=function(a,q){function c(a){return a&&a.d&&a.d.md?!0:!1}var b=q("__batch"),g=q("__geometry"),d=q("__print"),m=q("__renderer");a.extract_vertex_array=function(a,h,k){if(!c(a))return d.error("Wrong object:",a.name),null;if(a=b.S(a,h,"MAIN")||b.S(a,h,"NODES")){if((h=a.bb)&&h.Kb&&h.Kb[k])return g.Uu(h,k);d.error("Attribute not found:"+k);return null}d.error("Wrong material:",h);return null};a.extract_index_array=function(a,g){if(!c(a))return d.error("Wrong object:",a.name),null;var k=
b.S(a,g,"MAIN")||b.S(a,g,"NODES");if(k){if((k=k.bb)&&k.Kb)return k.Vd;d.error("Buffer data not found");return null}d.error("Wrong material:",g);return null};a.update_vertex_array=function(a,h,k,l){var m=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))for(var n=0;n<m.length;n++){var q=b.S(a,h,m[n]);q&&(q=q.bb)&&q.Kb&&q.Kb[k]&&g.Mj(q,k,0,l)}else d.error("Wrong object:",a.name)};a.override_geometry=function(a,h,k,l,q){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))if(k instanceof Uint16Array||k instanceof
Uint32Array)if(l instanceof Float32Array)for(var w=0;w<n.length;w++){var u=b.S(a,h,n[w]);if(u){var z=u.bb;if(z){g.Hy(z,u.ld,k);var F=0,p;for(p in z.Kb)var B=z.Kb[p],F=F+l.length/3*B.Ic;z.Uc=new Float32Array(F);var F=z.Uc,e=0;for(p in z.Kb)switch(B=z.Kb[p],p){case "a_position":F.set(l,e);B.offset=e;B.length=l.length;e+=B.length;break;case "a_normal":var t;q&&(t=g.wn(k,l,l));var x=g.un(k,l,t);F.set(x,e);B.offset=e;B.length=l.length;e+=B.length;break;case "a_tangent":B.offset=e;B.length=l.length/3*B.Ic;
for(var K=new Float32Array(B.length),x=0;x<K.length;x+=4)K[x]=1,K[x+3]=1;F.set(K,e);e+=B.length;break;default:B.offset=e,B.length=l.length/3*B.Ic,x=new Float32Array(B.length),F.set(x,e),e+=B.length}g.My(z);m.dn(u);if(u.vb)for(x=0;x<u.vb.length;x++)(B=u.vb[x])&&B.bb&&(B.bb=z)}}}else d.error("Wrong positions_array type");else d.error("Wrong ibo_array type");else d.error("Wrong object:",a.name)}};b4w.module.hud=function(a,q){var c=q("__hud");q("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,q){function c(a){for(var c=d.get_active(),l=d.la(c,"LAMP",d.DATA_ID_ALL),q=0;q<l.length;q++){var s=l[q];if("SUN"==s.Ca.type){var p=s;break}}if(!p)return b.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(l=(90-a.vert_position)/180*Math.PI,q=p.d,m.set_rotation_euler(p,[l,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),f.quat_to_dir(q.quat,f.AXIS_Y,a),q=h.length(q.e),h.copy(a,k),h.scale(k,q,k),m.set_translation(p,
k),m.v(p),a=p.Ca,a.jo&&(s=p.data.energy,q=c.world.light_settings.environment_energy,l=Math.cos(Math.abs(l)),s*=Math.max(Math.min(3*l,1),0),l=Math.max(l,.1)*q,g.uq(a,s),d.set_environment_colors(c,l,null,null)),d.Oj(p,c))}var b=q("__print"),g=q("__lights"),d=q("__scenes"),m=q("__transform"),f=q("__util"),h=q("vec3"),k=new Float32Array(3),l,s=60;a.get_lamps=function(a){var b=d.get_active(),b=d.la(b,"LAMP",d.DATA_ID_ALL);if(!a)return b;for(var c=[],f=0;f<b.length;f++){var g=b[f];g.Ca.type===a&&c.push(g)}return c};
a.get_sun_params=function(){for(var a=d.get_active(),a=d.la(a,"LAMP",d.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var f=a[c];if("SUN"==f.Ca.type){b=f;break}}return b?(b=b.Ca.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=function(a){for(var f=d.get_active(),f=d.la(f,"LAMP",d.DATA_ID_ALL),g=0;g<f.length;g++){var h=f[g];if("SUN"==h.Ca.type){var k=
h;break}}if(!k)return b.error("There is no sun on the scene"),null;k=-Math.cos(a/12*Math.PI)*s;f={};f.hor_position=12>a?15*a:15*(a-24);f.vert_position=k;c(f)};a.set_date=function(a){(l=a.getDate())?1582==l&&10==a.gB&&4<a.zu&&15>a.zu&&b.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):b.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){s=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var c=d.get_active();if(!c)return b.error("No active scene"),
!1;for(var c=d.la(c,"LAMP",d.DATA_ID_ALL),f=0;f<c.length;f++){var g=c[f];if(g.name===a){var h=g.Ca;break}}return h?{light_color:h.color,light_energy:h.Tf}:!1};a.set_light_params=function(a,c){var f=d.get_active();if(!f)return b.error("No active scene"),!1;for(var h=d.la(f,"LAMP",d.DATA_ID_ALL),k=0;k<h.length;k++){var l=h[k];if(l.name===a){var m=l.Ca;break}}if(!m)return b.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof c.light_energy&&(g.uq(m,c.light_energy),d.Oj(l,f));"object"==
typeof c.light_color&&(g.Hx(m,c.light_color),d.Oj(l,f))};a.get_lights_names=function(){var a=d.get_active();if(!a)return b.error("No active scene"),!1;for(var c=[],a=d.la(a,"LAMP",d.DATA_ID_ALL),f=0;f<a.length;f++)c.push(a[f].Ca.name);return c}};b4w.module.material=function(a,q){function c(a,b){for(var c=a.P,d=0;d<c.length;d++){var f=c[d];if(-1<f.tc.indexOf(b))return"MAIN"==f.type}return!1}function b(a,b){var c=d.S(a,b,"MAIN");return Boolean(c&&c.lc[0])}function g(a,b){var c=d.S(a,b,"MAIN");return Boolean(c&&c.lc[1])}var d=q("__batch"),m=q("__config"),f=q("__print"),h=q("__shaders"),k=q("__util");q("vec4");var l=m.n,s="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){f.error("max_bones() deprecated, return default value");
return l.max_bones};a.set_max_bones=function(){f.error("set_max_bones() deprecated")};a.set_batch_param=function(){f.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,g){if(k.kp(c)&&k.kp(a)){for(var h=["MAIN","DEPTH","COLOR_ID"],l=!1,m=0;m<h.length;m++){var e=h[m],q=d.S(a,b,e),x=d.S(c,g,e);if(q&&x)for(l=!0,"MAIN"==e&&(x.ob.set(q.ob),x.Le=q.Le,x.Bd.set(q.Bd),x.lc.set(q.lc),x.Qd=q.Qd,x.Bc=q.Bc,x.Bc=q.Bc,x.Ke=q.Ke,x.ye=q.ye),e=0;e<x.ac.length;e++){var K=x.ac[e];if(-1!==s.indexOf(K)){var H=
q.ac.indexOf(K);if(-1!==H&&(x.D[e]=q.D[H],x.vb))for(e=0;e<x.vb.length;e++){var y=x.vb[e],L=y.ac.indexOf(K);-1!==L&&(y.D[L]=q.D[H])}}}}l||f.error("Wrong objects for inheriting material!")}else f.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.ob.set(c):f.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=
d.S(a,b,"MAIN");if(c){var g=Array(4);g[0]=c.ob[0];g[1]=c.ob[1];g[2]=c.ob[2];g[3]=c.ob[3];return g}f.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Le=c:f.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Le;f.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Bd.set(c):f.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var c=d.S(a,b,"MAIN");if(c){var g=Array(3);g[0]=c.Bd[0];g[1]=c.Bd[1];g[2]=c.Bd[2];return g}f.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,c,g){b(a,c)||f.error('Property "specular_intensity" is missing!');d.S(a,c,"MAIN").lc[0]=g};a.get_specular_intensity=function(a,c){b(a,c)||f.error('Property "specular_intensity" is missing!');return d.S(a,c,"MAIN").lc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,
c){g(a,b)||f.error('Property "specular_hardness" is missing!');d.S(a,b,"MAIN").lc[1]=c};a.get_specular_hardness=function(a,b){g(a,b)||f.error('Property "specular_hardness" is missing!');return d.S(a,b,"MAIN").lc[1]};a.check_specular_hardness=g;a.set_emit_factor=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Qd=c:f.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Qd;f.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,c){(a=d.S(a,b,"MAIN"))?a.Bc=c:f.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Bc;f.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Ke=c:f.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Ke;f.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var c=d.S(a,b,"MAIN");c?c.ye=alpha_factor:f.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.ye;f.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return f.error("B4W Error: missing arguments in get_material_params"),null;if(!c(a,b))return null;var g=d.S(a,b,"MAIN");if(!g)return null;var h={};"MAIN"==g.type&&(h.Nh=g.Nh,h.sA=g.pd[2],h.tA=5*(1-g.pd[3]),h.Fh=g.Fh,h.oB=d.fb(g,
"PARALLAX_STEPS")[1]);return h};a.get_water_material_params=function(a,b){if(!a||!b)return f.error("B4W Error: missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var g=d.S(a,b,"MAIN");if(!g||!g.re)return null;if(!g)return f.warn("B4W Warning: material not found"),null;var h={};if("MAIN"==g.type){if(l.ng){var k=h.shallow_water_col=Array(3);k[0]=g.shallow_water_col[0];k[1]=g.shallow_water_col[1];k[2]=g.shallow_water_col[2];k=h.shore_water_col=Array(3);k[0]=g.shore_water_col[0];
k[1]=g.shore_water_col[1];k[2]=g.shore_water_col[2];h.shallow_water_col_fac=g.shallow_water_col_fac;h.shore_water_col_fac=g.shore_water_col_fac}h.foam_factor=g.foam_factor;h.norm_uv_velocity=g.Uj;h.absorb_factor=d.fb(g,"ABSORB")[1];h.sss_strength=d.fb(g,"SSS_STRENGTH")[1];h.sss_width=d.fb(g,"SSS_WIDTH")[1];h.dst_noise_scale0=d.fb(g,"DST_NOISE_SCALE_0")[1];h.dst_noise_scale1=d.fb(g,"DST_NOISE_SCALE_1")[1];h.dst_noise_freq0=d.fb(g,"DST_NOISE_FREQ_0")[1];h.dst_noise_freq1=d.fb(g,"DST_NOISE_FREQ_1")[1];
h.dir_min_shore_fac=d.fb(g,"DIR_MIN_SHR_FAC")[1];h.dir_freq=d.fb(g,"DIR_FREQ")[1];h.dir_noise_scale=d.fb(g,"DIR_NOISE_SCALE")[1];h.dir_noise_freq=d.fb(g,"DIR_NOISE_FREQ")[1];h.dir_min_noise_fac=d.fb(g,"DIR_MIN_NOISE_FAC")[1];h.dst_min_fac=d.fb(g,"DST_MIN_FAC")[1];h.waves_hor_fac=d.fb(g,"WAVES_HOR_FAC")[1]}return h};a.set_material_extended_params=function(a,b,g){if(a&&b&&g){if(!c(a,b))return f.warn("B4W Warning: setting material params is not possible"),null;a=d.S(a,b,"MAIN");a?"MAIN"==a.type&&("number"==
typeof g.material_reflectivity&&(a.Nh=g.material_reflectivity),"number"==typeof g.material_fresnel&&(a.pd[2]=g.material_fresnel),"number"==typeof g.material_fresnel_factor&&(a.pd[3]=1-g.material_fresnel_factor/5),"number"==typeof g.material_parallax_scale&&(a.Fh=g.material_parallax_scale),"number"==typeof g.material_parallax_steps&&(g=h.u(parseFloat(g.material_parallax_steps)),d.U(a,"PARALLAX_STEPS",g),d.sb(a,!0))):f.warn("B4W Warning: material not found")}else f.error("B4W Error: missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,g){if(!a||!b||!g)return f.error("B4W Error: missing arguments in set_water_material_params"),null;if(!c(a,b))return f.warn("B4W Warning: setting water material params is not possible"),null;a=d.S(a,b,"MAIN");if(!a)return f.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(l.ng&&("object"==typeof g.shallow_water_col&&a.shallow_water_col.set(g.shallow_water_col),"number"==typeof g.shallow_water_col_fac&&(a.shallow_water_col_fac=g.shallow_water_col_fac),
"object"==typeof g.shore_water_col&&a.shore_water_col.set(g.shore_water_col),"number"==typeof g.shore_water_col_fac&&(a.shore_water_col_fac=g.shore_water_col_fac)),l.shore_smoothing&&a.Em&&("boolean"==typeof g.shore_smoothing&&(g.shore_smoothing?d.U(a,"SHORE_SMOOTHING",1):d.U(a,"SHORE_SMOOTHING",0)),"number"==typeof g.absorb_factor&&(b=h.u(parseFloat(g.absorb_factor)),d.U(a,"ABSORB",b))),"number"==typeof g.foam_factor&&l.Vf&&(a.foam_factor=g.foam_factor),"number"==typeof g.norm_uv_velocity&&(a.Uj=
g.norm_uv_velocity),l.water_dynamic&&a.water_dynamic&&("boolean"==typeof g.water_dynamic&&(g.water_dynamic?d.U(a,"DYNAMIC",1):d.U(a,"DYNAMIC",0)),"number"==typeof g.waves_height&&(b=h.u(parseFloat(g.waves_height)),d.U(a,"WAVES_HEIGHT",b)),"number"==typeof g.waves_length&&(b=h.u(parseFloat(g.waves_length)),d.U(a,"WAVES_LENGTH",b)),"number"==typeof g.sss_strength&&(b=h.u(parseFloat(g.sss_strength)),d.U(a,"SSS_STRENGTH",b)),"number"==typeof g.sss_width&&(b=h.u(parseFloat(g.sss_width)),d.U(a,"SSS_WIDTH",
b)),"number"==typeof g.dst_noise_scale0&&(b=h.u(parseFloat(g.dst_noise_scale0)),d.U(a,"DST_NOISE_SCALE_0",b)),"number"==typeof g.dst_noise_scale1&&(b=h.u(parseFloat(g.dst_noise_scale1)),d.U(a,"DST_NOISE_SCALE_1",b)),"number"==typeof g.dst_noise_freq0&&(b=h.u(parseFloat(g.dst_noise_freq0)),d.U(a,"DST_NOISE_FREQ_0",b)),"number"==typeof g.dst_noise_freq1&&(b=h.u(parseFloat(g.dst_noise_freq1)),d.U(a,"DST_NOISE_FREQ_1",b)),"number"==typeof g.dir_min_shore_fac&&(b=h.u(parseFloat(g.dir_min_shore_fac)),d.U(a,
"DIR_MIN_SHR_FAC",b)),"number"==typeof g.dir_freq&&(b=h.u(parseFloat(g.dir_freq)),d.U(a,"DIR_FREQ",b)),"number"==typeof g.dir_noise_scale&&(b=h.u(parseFloat(g.dir_noise_scale)),d.U(a,"DIR_NOISE_SCALE",b)),"number"==typeof g.dir_noise_freq&&(b=h.u(parseFloat(g.dir_noise_freq)),d.U(a,"DIR_NOISE_FREQ",b)),"number"==typeof g.dir_min_noise_fac&&(b=h.u(parseFloat(g.dir_min_noise_fac)),d.U(a,"DIR_MIN_NOISE_FAC",b)),"number"==typeof g.dst_min_fac&&(b=h.u(parseFloat(g.dst_min_fac)),d.U(a,"DST_MIN_FAC",b)),
"number"==typeof g.waves_hor_fac&&(g=h.u(parseFloat(g.waves_hor_fac)),d.U(a,"WAVES_HOR_FAC",g))),d.sb(a,!0));return!0}};b4w.module.particles=function(a,q){var c=q("__particles"),b=q("__print");a.set_size=function(a,d,m){c.ag(a)?c.set_size(a,d,m):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,m){c.ag(a)?c.set_normal_factor(a,d,m):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,m){c.ag(a)?(m=Math.min(m,1),m=Math.max(m,0),c.set_factor(a,d,m)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,q){var c=q("__print"),b=q("__physics"),g=q("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.has_physics(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.has_physics(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,g){b.has_physics(a)?b.set_gravity(a,g):c.error("No physics for object "+a.name)};a.set_damping=function(a,g,f){b.has_physics(a)?b.m("set_damping",a.j.F,g,f):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.has_physics(a)){var g=a.game;b.m("set_damping",a.j.F,g.damping,g.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,g,f){b.has_physics(a)?b.set_transform.apply(this,
arguments):c.error("No physics for object "+a.name)};a.sync_transform=function(a){b.has_physics(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.has_physics(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.has_physics(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,g,f,h){b.has_physics(a)?b.apply_force.apply(this,
arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,g,f,h){b.has_physics(a)?b.apply_torque.apply(this,arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,m){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,g.clamp(m,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,m,f){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");
m=g.clamp(m,0,1);var h=a.f.Uf;-1==f||1==f?h=Math.max(-1,Math.min(h+f*m,1)):0==f&&0<=h?(h-=m,h=Math.max(0,h)):0==f&&0>h?(h+=m,h=Math.min(0,h)):c.error("Wrong steering direction");b.vehicle_throttle(a,g.clamp(h,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,m){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,g.clamp(m,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,m,f){if(b.has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||c.error("Wrong object");m=g.clamp(m,0,1);var h=a.f.vg;-1==f||1==f?h=Math.max(-1,Math.min(h+f*m,1)):0==f&&0<=h?(h-=m,h=Math.max(0,h)):0==f&&0>h?(h+=m,h=Math.min(0,h)):c.error("Wrong steering direction");b.vehicle_steer(a,g.clamp(h,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,m){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,g.clamp(m,0,1))):c.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,m){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");m=g.clamp(m,-1,1);var f=a.f.Wg;b.vehicle_brake(a,g.clamp(f+f*m,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.f.Uf;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.f.vg;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.has_physics(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.f.Wg;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,g,f){b.has_physics(a)?b.set_character_move_dir(a,g,f):c.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,g){b.has_physics(a)?b.set_character_move_type(a,g):c.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){c.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,g){b.has_physics(a)?b.set_character_walk_velocity(a,g):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,g){b.has_physics(a)?b.set_character_run_velocity(a,g):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,g){b.has_physics(a)?b.set_character_fly_velocity(a,g):c.error("No physics for object "+a.name)};a.character_jump=function(a){b.has_physics(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,g,f){b.has_physics(a)?b.character_rotation_inc(a,g,f):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,g){b.has_physics(a)?b.set_character_rotation_quat(a,g):c.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,g,f){b.has_physics(a)?b.set_character_rotation(a,g,f):c.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,g){b.has_physics(a)?b.set_character_rotation_v(a,g):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,g){b.has_physics(a)?b.set_character_rotation_h(a,g):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,g,f,h){b.has_physics(a)?b.append_collision_test(a,g,f,h):c.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,g){b.has_physics(a)?b.remove_collision_test(a,g):c.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,g){b.has_physics(a)?b.apply_collision_impulse_test(a,g):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.has_physics(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,g,f,h,k,l){b.has_physics(a)?b.append_ray_test(a,g,f,h,k,l):c.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,g,f,h,k){b.has_physics(a)?b.remove_ray_test(a,g,f,h,k):c.error("No physics for object "+a.name)};a.apply_constraint=function(a,g,f,h,k,l,q,n,w,u){b.has_physics(g)&&b.has_physics(k)?b.apply_constraint(a,g,f,h,k,l,q,n,w,u):c.error("Wrong objects")};a.clear_constraint=function(a){b.has_physics(a)&&b.fw(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,g,f,h,k,l){b.has_physics(a)&&b.has_physics(h)?b.pull_to_constraint_pivot(a,
g,f,h,k,l):c.error("Wrong objects")}};b4w.module.scenes=function(a,q){var c=q("__batch"),b=q("__camera"),g=q("__graph"),d=q("__print"),m=q("__physics"),f=q("__scenes"),h=q("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=f.Mi();f.set_active(h.keysearch("name",a,b))};a.get_active=function(){return f.W()?f.get_active().name:""};a.get_scenes=function(){for(var a=f.Mi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(f.W())return f.get_active().camera;d.error("No active scene");return!1};
a.get_object_by_name=function(a,b){return f.Oi(f.Yj,a,b)};a.get_object_by_dupli_name=function(a,b,c){return f.Oi(f.Km,a,b,c)};a.get_object_by_dupli_name_list=function(a,b){return f.Oi(f.Lm,a,b)};a.get_object_by_empty_name=function(b,c,f){d.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,f)};a.get_object_data_id=function(a){return f.get_object_data_id(a)};a.pick_object=f.pick_object;a.set_glow_intensity=function(a,b){for(var c=
0;c<a.P.length;c++){var d=a.P[c];"COLOR_ID"==d.type&&(d.Zf=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.Kc&&f.apply_glow_anim(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Kc){var b=a.d.Pi;f.apply_glow_anim(a,b.Zv,b.aw,b.bw)}};a.clear_glow_anim=function(a){a.d&&a.d.Kc&&f.clear_glow_anim(a)};a.set_glow_color=function(a){var b=f.get_active();if(b=f.ga(b,"GLOW"))b.ph.set(a),b.ta=!0};a.get_shadow_params=function(){if(!f.W())return d.error("No active scene"),!1;var a=f.get_active(),b=f.ga(a,
"SHADOW_CAST");if(!b)return null;var c=a.d.wc,g=f.ga(a,"MAIN_OPAQUE"),h=f.ga(a,"DEPTH"),m={};m.csm_resolution=c.csm_resolution;m.self_shadow_polygon_offset=b.self_shadow_polygon_offset;h&&(m.self_shadow_normal_offset=h.self_shadow_normal_offset);m.b4w_enable_csm=c.b4w_enable_csm;m.csm_num=c.csm_num;m.csm_first_cascade_border=c.csm_first_cascade_border;m.first_cascade_blur_radius=c.first_cascade_blur_radius;m.csm_last_cascade_border=c.csm_last_cascade_border;m.last_cascade_blur_radius=c.last_cascade_blur_radius;
m.fade_last_cascade=c.fade_last_cascade;m.blend_between_cascades=c.blend_between_cascades;c.b4w_enable_csm?(m.csm_borders=f.Hv(a,g.h),m.blur_radii=new Float32Array(c.csm_num),m.blur_radii.set(g.h.sj.subarray(0,c.csm_num))):(m.csm_borders=null,m.blur_radii=null);return m};a.set_shadow_params=function(a){if(!f.W())return d.error("No active scene"),!1;var h=f.get_active();"number"==typeof a.self_shadow_polygon_offset&&g.L(h.d.Na,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var m=f.ga(h,"DEPTH");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius));var n=f.ga(h,"MAIN_BLEND");n&&("number"==typeof a.self_shadow_normal_offset&&(n.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(n.pcf_blur_radius=a.pcf_blur_radius),n.ta=!0);n=h.d.wc;"number"==typeof a.csm_first_cascade_border&&(n.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(n.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(n.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(n.last_cascade_blur_radius=a.last_cascade_blur_radius);if(m){for(var q=m.l,u=0;u<q.length;u++){var z=q[u];z.Va.rb&&(z=z.k,c.ik(z,n),c.sb(z))}m.ta=!0}m=h.camera.d.M;for(u=0;u<m.length;u++)b.Nj(m[u],n);f.Wl(h)};a.get_environment_colors=
function(){if(!f.W())return d.error("No active scene"),!1;var a=f.get_active();return f.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!f.W())return d.error("No active scene"),!1;var g=f.get_active();f.set_environment_colors(g,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();return f.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!f.W())return d.error("No active scene"),!1;var b=
f.get_active();f.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!f.W())return d.error("No active scene"),!1;var a=f.get_active();return f.get_ssao_params(a)};a.set_ssao_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!f.W())return d.error("No active scene"),null;var a=f.get_active(),a=f.ga(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;
b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!f.W())return d.error("No active scene"),null;var b=f.get_active(),b=f.ga(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.ta=!0};a.get_sky_params=function(){if(!f.W())return d.error("No active scene"),
!1;var a=f.get_active();return f.get_sky_params(a)};a.set_sky_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_sky_params(b,a)};a.get_dof_params=function(){if(!f.W())return d.error("No active scene"),!1;var a=f.get_active();return f.ga(a,"DOF")?f.get_dof_params(a):null};a.set_dof_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!f.W())return d.error("No active scene"),
!1;var a=f.get_active();return f.ga(a,"GOD_RAYS")?f.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!f.W())return d.error("No active scene"),!1;var a=f.get_active();return f.ga(a,"BLOOM")?f.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_bloom_params(b,a)};a.get_wind_params=
function(){return f.get_wind_params()};a.set_wind_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=f.get_water_surface_level;a.set_water_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!f.W())return d.error("No active scene"),!1;var b=f.get_active();f.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!f.W())return d.error("No active scene"),!1;var a=f.get_active();f.gr(a)};a.hide_object=function(a){f.hide_object(a)};a.show_object=function(a){f.show_object(a)};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return f.W()?f.check_object(a,f.get_active()):(d.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=f.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.la(c,a,b)};a.get_appended_objs=function(b,c){d.warn("get_appended_objs() deprecated, use get_all_objects() instead");
return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(d.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(d.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Cb};a.get_object_children=function(a){return a.Fd.slice(0)};a.get_first_character=function(){for(var a=f.la(f.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(m.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||
0===b||(b=1);return f.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return f.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.append_object=function(){h.da('Method "append_object" is deprecated')};a.add_object=function(){h.da('Method "add_object" is deprecated')};a.remove_object=function(){h.da('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){h.da("get_screen_scenes() deprecated")};a.set_light_pos=function(){h.da("set_light_pos() deprecated, use lights module instead")};
a.set_light_direction=function(){h.da("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){h.da("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){h.da("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){h.da("remove_all() deprecated, use lights module instead")};a.check_collision=function(){h.da("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){h.da("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,q){var c=q("__scenes"),b=q("__sfx");a.play=function(a,c,m){b.play(a,c,m)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,c,m,f){b.cyclic(a,c);f&&b.playrate(a,f);b.play(a,0,m)};a.speaker_stop=function(a){b.stop(a)};a.stop=function(a){b.stop(a)};a.speaker_playback_rate=function(a,c){b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};
a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,m){b.speaker_reset_speed(a,c,m)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.Nv()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.Ix(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.Lw(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.vw()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};
a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,m){a&&"object"===typeof a?b.duck(a,c,m):b.Nu(c,m)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.Ey()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;
a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response};b4w.module.shaders=function(a,q){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var f=d.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function g(a){for(var b=h.Mi(),c=0;c<b.length;c++)for(var d=h.la(b[c],"MESH",h.DATA_ID_ALL),f=0;f<d.length;f++){var g=d[f];if(g.P)for(var k=0;k<g.P.length;k++){var m=g.P[k];if(m.Yb==a&&m.tc.length)return m.tc}}return null}function d(a){a.sort(function(a,b){return b.Zk.ALU_OPS-a.Zk.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Zk,f=c.gz,h=g(c.xu),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";m.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,h);m.groupCollapsed("directives");for(var h=c.Xa.Od,k=0;k<h.length;k++){var p=h[k];m.log(p[0],p[1])}m.groupEnd();m.groupCollapsed("vert src");m.log(c.fz);m.groupEnd();m.groupCollapsed("vert stats");for(var q in f)"ALU_OPS"!=q&&"TEX_OPS"!=q&&m.log(q,f[q]);m.groupEnd();m.groupCollapsed("frag src");m.log(c.iv);m.groupEnd();m.groupCollapsed("frag stats");for(q in d)"ALU_OPS"!=q&&"TEX_OPS"!=q&&m.log(q,d[q]);m.groupEnd();
m.groupEnd()}}q("__config");var m=q("__print"),f=q("__extensions"),h=q("__scenes"),k=q("__shaders");q("__util");a.report_repeatful_compilation=function(){var a=k.Bu(),b=0,c;for(c in a){var d=a[c],f=d.count;1<f&&m.log(f-1,d.vB,d.MA);b+=f-1}m.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var g=k.Fv(),h=0,q;for(q in g)a&&-1===q.indexOf(a)||h++;var h="of "+h+" analyzing...",u={};for(q in g)if(!a||-1!==q.indexOf(a)){var z=g[q],F;var p=z.Bm;F=z.Bo;var B=f.Fo();if(B){p=B.getTranslatedShaderSource(p);
F=B.getTranslatedShaderSource(F);var B=b("/nvidia_vert",p),e=c(B),t=b("/nvidia_frag",F),x=c(t);F={fz:p,GB:B,gz:e,iv:F,rA:t,Zk:x}}else m.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),F=void 0;B=z.Xa;p=B.bi+" + "+B.kh;F.xu=z;F.Xa=B;z=u[p]=u[p]||[];z.push(F);m.log(h)}for(p in u)m.group("%c"+p,"color: #800"),z=u[p],d(z),m.groupEnd()}};b4w.module.textures=function(a,q){var c=q("__textures"),b=q("__print");a.get_canvas_texture_context=function(a){var d=c.Dv(a);if(d)return d;b.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){c.Jy(a)||b.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){c.play_video(a)||b.error('Texture with name "'+a+'" not found!')};a.stop_video=function(a){c.stop_video(a)||b.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a){c.reset_video(a)||
b.error('Texture with name "'+a+'" not found!')}};b4w.module.transform=function(a,q){var c=q("__print"),b=q("__physics"),g=q("__transform"),d=q("__util"),m=new Float32Array(3),f=new Float32Array(4);a.SPACE_LOCAL=g.SPACE_LOCAL;a.SPACE_WORLD=g.SPACE_WORLD;a.set_translation=function(a,c,d,f){m[0]=c;m[1]=d;m[2]=f;g.set_translation(a,m);g.v(a);b.sync_transform(a)};a.set_translation_v=function(a,c){g.set_translation(a,c);g.v(a);b.sync_transform(a)};a.set_translation_rel=function(a,c,f,q,n){m[0]=c;m[1]=f;m[2]=q;d.Yh(m,1,n.d.quat,n.d.e,m);g.set_translation(a,
m);g.v(a);b.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));g.get_translation(a,b);return b};a.set_rotation=function(a,c,d,m,n){f[0]=c;f[1]=d;f[2]=m;f[3]=n;g.set_rotation(a,f);g.v(a);b.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,c){g.set_rotation(a,c);g.v(a);b.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));g.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,c,d,f){m[0]=c;m[1]=d;m[2]=f;g.set_rotation_euler(a,m);g.v(a);b.sync_transform(a)};a.set_rotation_euler_v=function(a,c){g.set_rotation_euler(a,c);g.v(a);b.sync_transform(a)};a.set_scale=function(a,b){g.set_scale(a,b);g.v(a)};a.get_scale=function(a){return g.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;g.set_translation(a,[0,0,0]);g.set_rotation(a,[0,0,0,1]);g.set_scale(a,1);g.v(a);b.sync_transform(a)};
a.get_object_size=function(a){return d.sc(a)?g.get_object_size(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,f){return d.sc(a)?g.get_object_center(a,b,f):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,c,d,f){g.move_local(a,c,d,f);g.v(a);b.sync_transform(a)};a.get_object_bounding_box=function(a){return g.get_object_bounding_box(a)}};b4w.module.util=function(a,q){var c=q("__print"),b=q("__util"),g=q("vec3");q("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=
function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,m,f,h,k){return 0!=g.dot(f,h)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,m,f,h,k)};a.hash_code=b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;
a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect};"object"==typeof module&&module.Qk&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,q){var c=q("__version");a.version=c.version;a.type=c.type;a.date=c.date};"object"==typeof module&&module.Qk&&b4w.module.version(exports);b4w.module.main=function(a,q){function c(){}function b(){}function g(){}function d(){ja=0;window.performance||(F.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();F.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function m(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();F.error("B4W Error: WebGL context lost");h()},!1);t.Xb(c);var d=t.Mo();
d&&F.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));r.Xb(c);x.Xb(c);N.Xb(c);V.Xb(c);e.Xb(c);B.Xb(c);D.xq(a.width,a.height);G.init();b=n();l()}function f(){c=function(){}}function h(){k()||(W=performance.now()/1E3,G.pause(),L.pause(),N.pause())}function k(){return E<W}function l(){v(l);var a=performance.now()/1E3;Y||(Y=a);var c=a-Y;c<1/Q.$d||(k()||(E>Y&&(c-=E-Math.max(W,Y)),ja+=c,e.update(),y.update(),B.update(),s(ja,c),
b(c)),Y=a)}function s(a,b){B.is_primary_loaded()&&(K.reset(),Z.update(b),H.update(a,b),G.update(a,b),w.update(b),B.is_primary_loaded()&&(L.update(a,b),B.is_primary_loaded()&&(c(b,a),B.is_primary_loaded()&&(p.update(a,b),B.is_primary_loaded()&&(D.update(a,b),aa&&(aa(R.toDataURL()),aa=null))))))}function n(){var a=60,b=0,c=0,d=Q.fv,e=Q.ev;return function(f){a=P.smooth(1/f,a,f,d);b=P.smooth(0,b,f,d);c=(c+1)%e;0==c&&g(Math.round(a),Math.round(b))}}var w=q("__animation"),u=q("__compat"),z=q("__config"),
F=q("__print"),p=q("__controls"),B=q("__data"),e=q("__debug"),t=q("__extensions"),x=q("__geometry"),K=q("__hud"),H=q("__nla"),y=q("__assets"),L=q("__physics"),r=q("__renderer"),D=q("__scenes"),G=q("__sfx"),V=q("__shaders"),N=q("__textures"),Z=q("__transform"),P=q("__util"),M=q("__version"),O=z.context,Q=z.n,R=null,T=null,ja=0,Y=0,W=0,E=0,aa=null,ma=["webgl","experimental-webgl"],v=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/Q.$d)}}();a.init=function(a,b){z.Jx();F.Ox(Q.console_verbose);var c=M.version()+" "+M.type()+" ("+M.date()+")";F.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=d();R=a;var e;e=null;for(var f=0;f<ma.length;f++){var g=ma[f];try{e=a.getContext(g,O)}catch(h){}if(e)break}if(!e)return null;m(R,e);z.jt();u.Gx(e);F.log("%cSET PRECISION:","color: #00a",Q.precision);
b?(K.init(b),T=b):(z.n.show_hud_debug_info=!1,z.Ad.hj=!1);L.lw(c);return e};a.set_check_gl_errors=function(a){e.set_check_gl_errors(a)};a.resize=function(a,b){R.style.width=a+"px";R.style.height=b+"px";T&&(T.style.width=a+"px",T.style.height=b+"px");R.width=a*Q.Ai;R.height=b*Q.Ai;T&&(T.width=a,T.height=b);K.Fg();D.xq(a*Q.Ai,b*Q.Ai);r.clear();s(ja,0);B.Oy(R.width,R.height)};a.set_fps_callback=function(a){g=a};a.clear_fps_callback=function(){g=function(){}};a.set_on_before_render_callback=function(a){c=
a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){f()};a.clear_render_callback=function(){f()};a.global_timeline=function(){return ja};a.redraw=function(){s(ja,0)};a.pause=h;a.resume=function(){k()&&(E=performance.now()/1E3,G.resume(),L.resume(),N.play(!0))};a.is_paused=k;a.reset=function(){B.unload();T=R=null;E=W=Y=ja=0;g=function(){};b=function(){};c=function(){}};a.canvas_data_url=function(a){aa=a};a.get_canvas_elem=function(){return R};a.set_texture_quality=
function(){P.da("set_texture_quality() deprecated")};a.set_shaders_dir=function(){P.da("set_shaders_dir() deprecated")};a.detect_mobile=function(){return u.detect_mobile()}};
