b4w={module:{},register:function(a,n){var b=b4w.module;if(b[a])throw Error('Module "'+a+'" already registered');b[a]=n},require:function(a){var n=b4w.require,b=b4w.module[a];if(!b)throw Error('Module "'+a+'" not found');b.jk||(b.jk={},b(b.jk,n));return b.jk},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Zk&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function n(){return"28.11.2014 03:24:58"}a.version=function(){return"14.11"};a.type=function(){return"RELEASE"};a.date=n;a.timestamp=function(){var a=n(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Zk&&b4w.module.__version(exports);b4w.module.__config=function(a,n){function b(){return b4w.module_check(a.zb.Ei)}var c=n("__print"),g=n("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.bu=g.ta(a.context);a.n={alpha_sort:!0,alpha_sort_threshold:.1,Fp:5,de:1E4,console_verbose:!1,do_not_load_resources:!1,bk:!1,lv:1.5,kv:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,nf:.01,resolution_factor:1,Hi:1,Rj:3,ah:!1,dl:!1,vi:!0,show_hud_debug_info:!1,
nA:!0,me:"DEPTH",anaglyph_use:!1,Fj:!0,Vh:.5,qg:!0,glow:!0,Ff:!0,Yf:!0,hg:!0,Pf:!0,ng:!0,Uf:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,ek:!1,cg:!0,Lh:!0,ya:!0,Rh:!0,water_dynamic:!0,shore_smoothing:!0,ug:!0,qf:1024,Il:512,max_bones:53,nr:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,nk:!0,$e:!1,Uw:!1,hm:!1,oo:!1,sr:!1,ef:!1,lp:!1,Rn:!1};a.Ou=g.ta(a.n);a.Ld={wa:-1,Fo:!1,Xe:1};a.controls={It:[5,5,5,5],Jt:.1,Sw:1/120};a.Md={Mw:15,kq:!0,Kl:!1,Tk:!1};a.st=g.ta(a.Md);a.zb={shaders_dir:"../../shaders/",
$x:"include/",Gq:"shader_texts",Ei:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",xx:"./",uq:["b4w.min.js","b4w.full.min.js","webplayer.min.js","src/data.js"]};a.gb={enabled:!0,de:60,Mg:""};a.bx=g.ta(a.gb);a.Zh={Sl:1024,$i:1024,jh:384};a.Ex=g.ta(a.Zh);a.Bd={pz:!0,qj:!1,qn:!1,Nn:!1,po:!1};a.Zx=g.ta(a.Bd);a.lh={enabled:!1,Ay:"MAIN_OPAQUE",zy:0,cy:"COLOR"};a.Ku=g.ta(a.lh);a.pt=function(){var b=a.n,c=a.gb,h=a.Zh;switch(b.quality){case a.P_ULTRA:b.me="DEPTH";b.shore_smoothing=!0;
b.glow=!0;b.Ff=!0;b.Yf=!0;b.hg=!0;b.Pf=!0;b.Fj=!0;b.Vh=1;b.qg=!0;b.cg=!0;b.Lh=!0;b.ya=!0;b.Rh=!0;b.resolution_factor=1.75;h.Sl=2048;h.$i=2048;b.Rj=3;b.vi=!0;b.bk=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.ug=!0;b.antialiasing=!0;b.smaa=!0;b.Uf=!0;b.ng=!0;c.de=120;break;case a.P_HIGH:b.me="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ff=!0;b.Yf=!0;b.hg=!0;b.Pf=!0;b.Fj=!0;b.Vh=.5;b.qg=!0;b.cg=!0;b.Lh=!0;b.ya=!0;b.Rh=!0;b.resolution_factor=1;h.Sl=1024;h.$i=1024;b.Rj=3;b.vi=!0;b.bk=!1;b.max_bones=
53;b.precision="highp";b.water_dynamic=!0;b.ug=!0;b.antialiasing=!0;b.smaa=!1;b.Uf=!0;b.ng=!0;c.de=60;break;case a.P_LOW:b.me="NONE",b.shore_smoothing=!1,b.glow=!1,b.Ff=!1,b.Yf=!1,b.hg=!1,b.Pf=!1,b.Fj=!1,b.Vh=.5,b.qg=!1,b.cg=!1,b.Lh=!1,b.ya=!1,b.Rh=!1,b.resolution_factor=1,h.Sl=512,h.$i=512,b.Rj=2,b.vi=!1,b.bk=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.ug=!1,b.antialiasing=!1,b.smaa=!1,b.Uf=!1,b.ng=!1,c.de=60}};a.set=function(b,l){switch(b){case "all_objs_selectable":a.n.all_objs_selectable=
l;break;case "alpha":a.context.alpha=l;break;case "alpha_sort":a.n.alpha_sort=l;break;case "alpha_sort_threshold":a.n.alpha_sort_threshold=l;break;case "allow_cors":a.n.ah=l;break;case "anaglyph_use":a.n.anaglyph_use=l;break;case "animation_framerate":a.Ld.wa=l;break;case "antialiasing":a.n.antialiasing=l;break;case "assets_dds_available":a.Md.Tk=l;break;case "assets_min50_available":a.Md.Kl=l;break;case "background_color":a.n.background_color=l;break;case "built_in_module_name":a.zb.Ei=l;break;case "console_verbose":a.n.console_verbose=
l;break;case "context_antialias":a.context.antialias=l;break;case "debug_subs_enabled":a.lh.enabled=l;break;case "deferred_rendering":a.n.deferred_rendering=l;break;case "do_not_load_resources":a.n.do_not_load_resources=l;break;case "force_selectable":a.n.force_selectable=l;break;case "glow":a.n.glow=l;break;case "physics_enabled":a.gb.enabled=l;break;case "physics_uranium_path":a.gb.Mg=l;break;case "precision":a.n.precision=l;break;case "quality":a.n.quality=l;break;case "resolution_factor":a.n.resolution_factor=
l;break;case "sfx_mix_mode":a.Bd.qj=l;break;case "shaders_dir":a.zb.shaders_dir=l;break;case "show_hud_debug_info":a.n.show_hud_debug_info=l;break;case "smaa":a.n.smaa=l;break;case "smaa_search_texture_path":a.zb.smaa_search_texture_path=l;break;case "smaa_area_texture_path":a.zb.smaa_area_texture_path=l;break;case "wireframe_debug":a.n.wireframe_debug=l;break;case "water_wireframe_debug":a.n.ek=l;break;default:c.error("B4W config set - property unknown: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.n.all_objs_selectable;
case "allow_cors":return a.n.ah;case "alpha":return a.context.alpha;case "alpha_sort":return a.n.alpha_sort;case "alpha_sort_threshold":return a.n.alpha_sort_threshold;case "anaglyph_use":return a.n.anaglyph_use;case "animation_framerate":return a.Ld.wa;case "antialiasing":return a.n.antialiasing;case "assets_dds_available":return a.Md.Tk;case "assets_min50_available":return a.Md.Kl;case "background_color":return a.n.background_color;case "built_in_module_name":return a.zb.Ei;case "console_verbose":return a.n.console_verbose;
case "context_antialias":return a.context.antialias;case "debug_subs_enabled":return a.lh.enabled;case "deferred_rendering":return a.n.deferred_rendering;case "do_not_load_resources":return a.n.do_not_load_resources;case "force_selectable":return a.n.force_selectable;case "glow":return a.n.glow;case "physics_enabled":return a.gb.enabled;case "physics_uranium_path":return a.gb.Mg;case "precision":return a.n.precision;case "quality":return a.n.quality;case "resolution_factor":return a.n.resolution_factor;
case "sfx_mix_mode":return a.Bd.qj;case "shaders_dir":return a.zb.shaders_dir;case "show_hud_debug_info":return a.n.show_hud_debug_info;case "smaa":return a.n.smaa;case "smaa_search_texture_path":return a.zb.smaa_search_texture_path;case "smaa_area_texture_path":return a.zb.smaa_area_texture_path;case "wireframe_debug":return a.n.wireframe_debug;case "water_wireframe_debug":return a.n.ek;default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=g.ta(a.bu);a.n=g.ta(a.Ou);
a.Md=g.ta(a.st);a.gb=g.ta(a.bx);a.Zh=g.ta(a.Ex);a.Bd=g.ta(a.Zx);a.lh=g.ta(a.Ku)};a.pp=b;a.Rx=function(){var f=a.zb,l=a.gb;if(b())f.smaa_search_texture_path="smaa_search_texture.png",f.smaa_area_texture_path="smaa_area_texture.png";else if(""==f.smaa_search_texture_path||""==f.smaa_area_texture_path||""==l.Mg){for(var h=null,k=document.getElementsByTagName("script"),e=0;e<k.length;e++){for(var r=k[e].src,g=0;g<f.uq.length;g++)if(0<=r.indexOf(f.uq[g])){h=r;break}if(null!==h)break}h||(c.error("Couldn't determine path to external resources, fallback to current page URL"),
h=document.location.href);k=h.indexOf("?");0<=k&&(h=h.substring(0,k));h=h.substring(0,h.lastIndexOf("/")+1)+f.xx;l.Mg=l.Mg||h+"uranium.js";f.smaa_search_texture_path=f.smaa_search_texture_path||h+"smaa_search_texture.png";f.smaa_area_texture_path=f.smaa_area_texture_path||h+"smaa_area_texture.png"}}};b4w.module.__boundings=function(a,n){function b(a,b){for(var c=a[0],d=a[1],e=a[2],f=a[0],m=a[1],h=a[2],p=3;p<a.length;p+=3)var k=a[p],l=a[p+1],x=a[p+2],c=Math.max(c,k),d=Math.max(d,l),e=Math.max(e,x),f=Math.min(f,k),m=Math.min(m,l),h=Math.min(h,x);b.max_x=c;b.max_y=d;b.max_z=e;b.min_x=f;b.min_y=m;b.min_z=h;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,e=a.max_z,f=a.min_x,m=a.min_y,h=a.min_z;b[0]=f;b[1]=m;b[2]=h;b[3]=c;b[4]=m;b[5]=h;b[6]=c;b[7]=d;b[8]=h;b[9]=f;b[10]=
d;b[11]=h;b[12]=f;b[13]=m;b[14]=e;b[15]=c;b[16]=m;b[17]=e;b[18]=c;b[19]=d;b[20]=e;b[21]=f;b[22]=d;b[23]=e;return b}function g(a,b,c){k.add(b,c,a.t);k.scale(a.t,.5,a.t);a.oa=k.distance(a.t,b);return a}var f=n("__geometry"),l=n("__util"),h=n("__tsr"),k=n("vec3"),e=new Float32Array(24),r=new Float32Array(3),v=new Float32Array(3),m=new Float32Array(3);a.Zn=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.Tz=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Zc=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.uo=function(a,b){var c=a.max_y,d=a.max_z,e=a.min_x,f=a.min_y,m=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,e);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,m)};a.xt=b;a.yk=function(f,m,h){h||(h=a.Zc());f=c(f,e);l.he(f,m,f);return b(f,h)};a.av=c;a.CB=function(b,c,e){e||
(e=a.Zc());var d=c.min_x,f=c.max_x,m=c.min_y,h=c.max_y,k=c.min_z;c=c.max_z;if(d>=b.max_x||f<=b.min_x||m>=b.max_y||h<=b.min_y||k>=b.max_z||c<=b.min_z)return e.min_x=-.1,e.max_x=.1,e.min_y=-.1,e.max_y=.1,e.min_z=-.2,e.max_z=-.1,e;e.min_x=Math.max(b.min_x,d);e.max_x=Math.min(b.max_x,f);e.min_y=Math.max(b.min_y,m);e.max_y=Math.min(b.max_y,h);e.min_z=Math.max(b.min_z,k);e.max_z=Math.min(b.max_z,c);return e};a.FB=function(b,c,e){e||(e=a.Zc());var d=b.max_x-b.min_x,f=b.max_y-b.min_y,m=b.max_z-b.min_z;e.min_x=
b.min_x-.5*(c-1)*d;e.max_x=b.max_x+.5*(c-1)*d;e.min_y=b.min_y-.5*(c-1)*f;e.max_y=b.max_y+.5*(c-1)*f;e.min_z=b.min_z-.5*(c-1)*m;e.max_z=b.max_z+.5*(c-1)*m;return e};a.Ak=function(b,e,c){c||(c=a.oi());k.transformMat4(b.t,e,c.t);c.oa=b.oa*l.mj(e);return c};a.zk=function(a,b,c){c||(c={Ie:new Float32Array(3),Je:new Float32Array(3),Ke:new Float32Array(3),t:new Float32Array([0,0,0])});h.ei(a.t,b,c.t);k.copy(a.Ie,c.Ie);k.copy(a.Je,c.Je);k.copy(a.Ke,c.Ke);h.Tj(c.Ie,b,c.Ie);h.Tj(c.Je,b,c.Je);h.Tj(c.Ke,b,c.Ke);
return c};a.Nk=function(a,b){return{oa:a,t:new Float32Array(b)}};a.oi=function(){return{t:new Float32Array([0,0,0]),oa:0}};a.Mk=function(a,b,c,d){return{Ie:new Float32Array(a),Je:new Float32Array(b),Ke:new Float32Array(c),t:new Float32Array([d[0],d[1],d[2]])}};a.zt=function(){return{t:new Float32Array([0,0,0]),oa:1E12}};a.Zu=function(a,b){var c=k.subtract(b.t,a.t,k.create());0==k.length(c)&&k.set(1,0,0,c);var d=k.normalize(c,k.create()),c=k.scale(d,a.oa,k.create());k.add(c,a.t,c);var e=k.scale(d,
-a.oa,k.create());k.add(e,a.t,e);var f=k.scale(d,b.oa,k.create());k.add(f,b.t,f);var m=k.scale(d,-b.oa,k.create());k.add(m,b.t,m);c=[c,e,f,m];d=k.normalize(d,k.create());e=c[0];f=c[0];for(m=1;m<c.length;m++){var h=k.dot(c[m],d);h<k.dot(e,d)&&(e=c[m]);h>k.dot(f,d)&&(f=c[m])}d=[e,f];c=d[0];d=d[1];a.t=k.scale(k.add(c,d,k.create()),.5,k.create());a.oa=k.length(k.subtract(d,c,k.create()))/2};a.$n=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d-2*a);return{oa:a,height:e,t:new Float32Array([0,(c+
d)/2,0])}};a.bo=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{oa:a,height:e,t:new Float32Array([0,(c+d)/2,0])}};a.ao=function(a,b){var c=b.max_y,d=b.min_y,e=Math.max(0,c-d);return{oa:a,height:e,t:new Float32Array([0,(c+d)/2,0])}};a.Xz=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.ox=function(a){for(var b=0,c=0,d=0,e=0,f=0,m=0,h=0,p=0,k=0;k<a.submeshes.length;k++){var l=a.submeshes[k];if(l.position.length){b=
e=l.position[0];c=f=l.position[1];d=m=l.position[2];break}}for(k=0;k<a.submeshes.length;k++)for(var l=a.submeshes[k],l=l.position,x=0;x<l.length/3;x++)var r=l[3*x],q=l[3*x+1],G=l[3*x+2],b=Math.max(r,b),c=Math.max(q,c),d=Math.max(G,d),e=Math.min(r,e),f=Math.min(q,f),m=Math.min(G,m),h=Math.max(Math.sqrt(r*r+q*q+G*G),h),p=Math.max(Math.sqrt(r*r+G*G),p);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
m;a.b4w_bounding_sphere_radius=h;a.b4w_bounding_cylinder_radius=p};a.Sv=function(b){var c=b.subarray(0,3),e=b.subarray(6,9),d=b.subarray(12,15),h=b.subarray(18,21);b=k.subtract(e,c,r);k.normalize(b,b);var l=f.Uv(c,e,d,v),l=k.cross(l,b,l);k.normalize(l,l);var u=k.create(),w=k.create();k.subtract(e,c,m);w[0]=k.dot(m,b);w[1]=k.dot(m,l);e=k.create();k.subtract(d,c,m);e[0]=k.dot(m,b);e[1]=k.dot(m,l);d=k.create();k.subtract(h,c,m);d[0]=k.dot(m,b);d[1]=k.dot(m,l);h=a.oi();d=[u,w,e,d];u=g(h,d[0],d[1]);for(h=
2;h<d.length;h++)if(k.distance(u.t,d[h])>u.oa){for(var p=u,u=d,w=d[h],e=h-1,p=g(p,w,u[0]),I=1;I<=e;I++)if(k.distance(p.t,u[I])>p.oa){for(var H=p,p=u,x=w,M=u[I],q=I-1,H=g(H,x,M),G=0;G<=q;G++)if(k.distance(H.t,p[G])>H.oa){var D=x,V=M,O=p[G],U=k.subtract(V,O,m),U=k.squaredLength(U),T=k.subtract(D,O,m),L=k.squaredLength(T),T=k.subtract(D,V,m),n=k.squaredLength(T),T=U*(L+n-U),R=L*(n+U-L),U=n*(U+L-n),L=T+R+U;k.copy(D,H.t);k.scale(H.t,T/L,H.t);k.scaleAndAdd(H.t,V,R/L,H.t);k.scaleAndAdd(H.t,O,U/L,H.t);H.oa=
k.distance(H.t,D)}p=H}u=p}h=u;b=k.scale(b,h.t[0],m);k.scaleAndAdd(b,l,h.t[1],b);k.add(b,c,h.t);return h}};b4w.module.__compat=function(a,n){function b(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}var c=n("__config"),g=n("__extensions"),f=n("__print"),l=n("__util");a.Ox=function(a){var k=c.Ld,e=c.n,r=c.context,v=c.Zh,m=c.Bd;e.qf=a.getParameter(a.MAX_TEXTURE_SIZE);e.Il=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var t=Boolean(g.Pv());b("Firefox/28.0")&&(b("Linux")||b("Macintosh"))&&(f.warn("Firefox 28 detected, applying depth hack"),t=!1);b("iPad")||b("iPhone")?(f.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
r.alpha||(e.background_color[3]=1),e.sr=!0,e.smaa=!1,e.Ff=!1,e.precision="highp",e.lp=!0):b("Mac OS X")&&b("Safari")&&!b("Chrome")&&(f.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),m.qn=!0,m.Nn=!0);b("Windows")&&(b("Firefox/33")||b("Chrome/40")||b("Chrome/41"))&&(f.warn("Condititions for clear procedural skydome hack detected"),e.Rn=!0);if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))f.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),e.$e=!0,e.ef=!0,b("iPad")||b("iPhone")||(f.warn("Mobile (not iOS) detected, disable playback rate for video textures."),m.po=!0);10>a.getParameter(a.MAX_VARYING_VECTORS)&&(f.warn("Not enough varyings, disable shadows on blend objects"),e.oo=
!0);if(r=g.So())b("Macintosh")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(f.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),t=!1,e.$e=!0),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(f.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),t=!1,k.Fo=!0),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&
(f.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),e.precision="highp",e.me="NONE"),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(f.warn("Qualcomm Adreno detected, applying shader constants hack."),e.hm=!0,-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(f.warn('Qualcomm Adreno305 detected, set "highp" precision.'),e.precision="highp"),-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("330")&&
(f.warn('Qualcomm Adreno330 detected, set "highp" precision.'),e.precision="highp")),-1<a.getParameter(r.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(r.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(f.warn("NVIDIA Tegra 3 detected, force low quality for LEVELS_OF_QUALITY nodes."),e.dl=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(f.warn("Vertex textures are not allowed. Disabling vertex textures"),e.nk=!1);t||(e.deferred_rendering=!1,e.cg=!1,e.Lh=!1,e.ya=!1,e.Rh=!1,e.water_dynamic=
!1,e.shore_smoothing=!1,e.ug=!1,e.smaa=!1);e.nr=Boolean(g.To());k=l.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);e.max_bones=l.trunc((k-50)/4);e.qB=l.trunc((k-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(e.precision="mediump");!window.ActiveXObject&&"ActiveXObject"in window&&(f.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),v.jh=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(f.warn("Not enough fragment uniforms, force low quality for LEVELS_OF_QUALITY nodes."),
e.dl=!0)}};b4w.module.__constraints=function(a,n){function b(a){var q={};q.type=a;return q}function c(a,q){a.$a&&a.$a.L&&g(a.$a.L,a);if(q.L){var b=q.L;if(-1==b.Hd.indexOf(a))b.Hd.push(a);else throw"Descendant object override is forbidden";}a.$a=q}function g(a,q){var b=a.Hd.indexOf(q);if(-1!=b)a.Hd.splice(b,1);else throw"No descendant object";}function f(a,b,c){switch(b.type){case 1:var e=a.d.quat,f=b.L.d.H;c=b.L.d.quat;b.ke?(s.copy(b.ke,e),s.multiply(c,e,e)):s.copy(c,e);t.transformMat4(b.offset,f,a.d.e);a.d.scale=
b.Aq*b.L.d.scale;break;case 9:var p=a.d.e,e=a.d.quat,f=b.L.d.H;c=b.L.d.quat;s.multiply(s.invert(b.zf,b.zf),e,e);s.multiply(c,e,e);t.transformMat4(b.offset,f,p);s.copy(c,b.zf);break;case 10:p=a.d.e;e=a.d.quat;f=b.L.d.H;c=b.L.d.quat;s.multiply(s.invert(b.zf,b.zf),e,e);s.multiply(c,e,e);t.transformMat4(b.offset,f,p);s.copy(c,b.zf);var e=a.d.quat,p=b.L.d.quat,g=t.transformQuat(m.AXIS_Y,e,d),H=s.invert(p,w),n=t.transformQuat(g,H,C),X=A;X[0]=n[0];X[1]=0;X[2]=n[2];f=t.length(X);H=-X[2]/f;H=Math.acos(H)*
m.sign(X[0]);f/=t.length(n);f=Math.acos(f)*m.sign(n[1]);n=!1;H<-b.Mn&&(H=-b.Mn,n=!0);H>b.On&&(H=b.On,n=!0);f<-b.Pn&&(f=-b.Pn,n=!0);f>b.Ln&&(f=b.Ln,n=!0);n&&(b=Math.sin(f),f=Math.cos(f),n=Math.sin(H),H=Math.cos(H),X=C,X[0]=f*n,X[1]=b,X[2]=-f*H,t.transformQuat(X,p,X),b=s.rotationTo(g,X,w),s.multiply(b,e,e),s.normalize(e,e));"CAMERA"==a.d.type&&(b=t.transformQuat(m.AXIS_Y,c,C),k(a,b));break;case 12:p=a.d.e;e=a.d.quat;f=b.L.d.H;H=b.L.d.e;a=b.ey;n=d;g=w;t.transformMat4(b.offset,f,n);m.smooth_v(n,p,c,a,
p);b=d;t.sub(H,p,b);t.normalize(b,b);X=e;p=x;H=p.subarray(0,3);f=p.subarray(3,6);n=p.subarray(6,9);t.copy(b,f);t.negate(f,f);t.normalize(f,f);Boolean(.999999<Math.abs(t.dot(b,m.AXIS_Y)))?(b=y.fromQuat(s.normalize(X,g),M),t.copy(b.subarray(0,3),H)):t.cross(m.AXIS_Y,f,H);t.normalize(H,H);t.cross(H,f,n);t.normalize(n,n);s.fromMat3(p,g);s.normalize(g,g);m.Kq(g,e,c,.16*a,e);break;case 2:e=a.d.quat;H=u;c=w;r(b.L,b.Dt,!0,H,c);b.ke?(s.copy(b.ke,e),s.multiply(c,e,e)):s.copy(c,e);m.ei(b.offset,1,c,H,a.d.e);
break;case 3:p=a.d.e;e=a.d.quat;c=b.L.d.e;l(p,e,c);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 4:p=a.d.e;e=a.d.quat;c=b.target;l(p,e,c);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 5:p=a.d.e;e=a.d.quat;c=b.L.d.e;e=h(p,e,c,b.xd,q);g=t.dist(p,c);if(b=e?g+b.xd:g>b.Jh?g-b.Jh:g<b.xd?g-b.xd:0)t.sub(c,p,d),t.normalize(d,d),t.scale(d,b,d),t.add(p,d,p);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 6:p=a.d.e;e=a.d.quat;c=b.target;e=h(p,e,c,b.xd,q);g=t.dist(p,c);if(b=e?g+b.xd:g>b.Jh?g-b.Jh:g<b.xd?g-b.xd:0)t.sub(c,
p,d),t.normalize(d,d),t.scale(d,b,d),t.add(p,d,p);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 7:f=b.L.d.H;t.transformMat4(b.offset,f,a.d.e);break;case 8:H=b.L.d.e;p=a.d.e;t.add(H,b.offset,p);break;case 13:e=a.d.quat;f=b.L.d.H;c=b.L.d.quat;b.ke?(s.copy(b.ke,e),s.multiply(c,e,e)):s.copy(c,e);t.transformMat4(b.offset,f,a.d.e);break;case 11:c=b.L.d,c=v.Vf(c.e,c.scale,c.quat,I),v.multiply(c,b.hr,c),p=a.d.e,p[0]=c[0],p[1]=c[1],p[2]=c[2],a.d.scale=c[3],e=a.d.quat,e[0]=c[4],e[1]=c[5],e[2]=c[6],e[3]=c[7]}}
function l(a,b,q){var c=d;m.quat_to_dir(b,m.AXIS_MY,c);t.normalize(c,c);var e=C;t.subtract(q,a,e);t.normalize(e,e);a=u;m.zq(c,e,a);s.multiply(a,b,b)}function h(a,b,q,c,e){var f=!1,p=d;m.quat_to_dir(b,m.AXIS_MY,p);t.normalize(p,p);var h=C;t.subtract(q,a,h);a=t.length(h);t.normalize(h,h);t.dot(p,h)<Math.cos(e)&&(t.scale(h,-1,h),f=!0);a>c-.001&&(c=m.zq(p,h,u),s.multiply(c,b,b),s.normalize(b,b));return f}function k(a,b){var q=a.d.quat,c=e(q,b,w);s.multiply(c,q,q)}function e(a,b,q){a=y.fromQuat(a,x);var c=
d;c[0]=a[3];c[1]=a[4];c[2]=a[5];if(.999<Math.abs(t.dot(b,c)))return s.identity(q),q;b=t.cross(b,c,c);t.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);c=C;c[0]=a[0];c[1]=a[1];c[2]=a[2];t.normalize(c,c);s.rotationTo(c,b,q);return q}function r(a,b,q,c,d){var e=a.d,f=e.We,m=e.gc[b];b=m.mh;a=a.pose.bones[m.Xl];var m=a.bn,h=u,x=e.dc,k=e.cc,l=e.Vb,g=e.Ub,r=x[4*b+1],C=x[4*b+2],A=x[4*b+3],M=k[4*b+1],z=k[4*b+2],J=k[4*b+3];h[0]=(1-f)*x[4*b]+f*k[4*b];h[1]=(1-f)*r+f*M;h[2]=(1-f)*C+f*z;h[3]=(1-f)*A+f*J;x=
w;k=p;x[0]=l[4*b];x[1]=l[4*b+1];x[2]=l[4*b+2];x[3]=l[4*b+3];k[0]=g[4*b];k[1]=g[4*b+1];k[2]=g[4*b+2];k[3]=g[4*b+3];s.slerp(x,k,f,x);f=I;v.Vx(h,f);v.gm(x,f);q?(q=H,v.translate(m,a.Vs,q),v.multiply(f,q,f)):v.multiply(f,m,f);v.multiply(e.Vc,f,f);c[0]=f[0];c[1]=f[1];c[2]=f[2];c[3]=f[3];d&&(d[0]=f[4],d[1]=f[5],d[2]=f[6],d[3]=f[7])}var v=n("__tsr"),m=n("__util"),t=n("vec3"),s=n("quat"),y=n("mat3");n("mat4");a.Az=1;a.zz=2;a.Dz=3;a.Ez=4;a.uz=5;a.vz=6;a.Bz=7;a.tz=8;a.yz=9;a.xz=10;a.$c=11;a.wz=12;a.Cz=13;var d=
new Float32Array(3),C=new Float32Array(3),A=new Float32Array(3),u=new Float32Array(4),w=new Float32Array(4),p=new Float32Array(4),I=new Float32Array(16),H=new Float32Array(16),x=new Float32Array(9),M=new Float32Array(9),I=new Float32Array(8),q=9*Math.PI/10;a.Cr=q;a.kn=function(a,q,d,e,p){var m=b(1);m.L=q;m.offset=new Float32Array(d);m.Aq=p||1;m.ke=e?new Float32Array(e):null;c(a,m);f(a,m,0)};a.jn=function(a,q,d,e,p){var m=b(2);m.L=q;m.Dt=d;m.offset=new Float32Array(e);m.ke=p?new Float32Array(p):null;
c(a,m);f(a,m,0)};a.ht=function(a,q,d,e){var p=b(9),m=a.d.quat,h=q.d.quat;p.L=q;p.offset=new Float32Array(d);p.zf=new Float32Array(h);e&&(s.copy(e,m),s.multiply(h,m,m));c(a,p);f(a,p,0)};a.gt=function(a,q,d,e,p,m,h,x){var k=b(10),l=a.d.quat,g=q.d.quat;k.L=q;k.offset=new Float32Array(d);k.zf=new Float32Array(g);k.Mn=p;k.On=m;k.Pn=h;k.Ln=x;e&&(s.copy(e,l),s.multiply(g,l,l));c(a,k);f(a,k,0)};a.ft=function(a,q,d,e){var p=b(12);p.L=q;p.offset=new Float32Array(d);p.ey=e;c(a,p);f(a,p,0)};a.jt=function(a,q,
d,e){var p=b(13);p.L=q;p.offset=new Float32Array(d);p.Aq=1;p.ke=e?new Float32Array(e):null;c(a,p);f(a,p,0)};a.lt=function(a,q){var d=b(3);d.L=q;c(a,d);f(a,d,0)};a.mt=function(a,q){var d=b(4);d.target=new Float32Array(q);c(a,d);f(a,d,0)};a.ct=function(a,q,d,e){var p=b(5);p.L=q;p.xd=d;p.Jh=e;c(a,p);f(a,p,0)};a.dt=function(a,q,d,e){var p=b(6);p.target=new Float32Array(q);p.xd=d;p.Jh=e;c(a,p);f(a,p,0)};a.it=function(a,q,d){var e=b(7);e.L=q;e.offset=new Float32Array(d);c(a,e);f(a,e,0)};a.bt=function(a,
q,d){var e=b(8);e.L=q;e.offset=new Float32Array(d);c(a,e);f(a,e,0)};a.at=function(a,q,d){var e=b(11);e.L=q;e.hr=new Float32Array(d);c(a,e);f(a,e,0)};a.Ry=function(a,b){a.$a&&f(a,a.$a,b)};a.yx=l;a.zx=h;a.correct_up=k;a.Vz=e;a.remove=function(a){a.$a.L&&g(a.$a.L,a);a.$a=null};a.rd=function(a){return a.$a?a.$a.type:null};a.KA=function(a){return a.$a&&a.$a.L?a.$a.L:null};a.qd=function(a){return a.$a&&11==a.$a.type?a.$a.hr:null};a.Iv=r};b4w.module.__controls=function(a,n){function b(a){return{type:a,value:0,Tb:null,Fl:null,El:null,lj:null,Td:!1,key:0,Pb:"",Hk:null,Ml:!1,Gk:function(){},Fk:null,Sn:function(){},Pc:null,sm:new Float32Array(3),Yk:new Float32Array(3),Dl:!1,pq:function(){},axis:"",bc:0,Jg:new Float32Array(3),Dj:new Float32Array(4),threshold:0,nq:new Float32Array(4),yi:0,xi:0,yq:0,zi:0,Nh:0,rn:!1}}function c(a,b){var q;if(a.lj){q=a.Fl;for(var d=a.El,c=0;c<q.length;c++)d[c]=q[c].value;q=a.lj(d)}else q=!1;q||(a.value=Number(b))}
function g(a){a=x.indexOf(a);-1<a?x.splice(a,1):C.error("Wrong object")}function f(a,b){for(var q=0,d=0;d<b.length;d++)for(var c=b[d].De,e=0;e<c.length;e++)for(var B=c[e].Nc,D=0;D<B.length;D++)B[D]===a&&q++;return q}function l(a,b){switch(a.type){case 80:A.remove_collision_test(a.Hk,a.Pb,a.Gk);a.Td=!0;break;case 90:A.clear_collision_impulse_test(a.Fk);a.Td=!0;break;case 100:A.remove_ray_test(a.Pc,a.Pb,a.sm,a.Yk,a.Dl),a.Td=!0}var q=b.indexOf(a);-1<q&&b.splice(q,1)}function h(a){for(var b=0;b<M.length;b++){var q=
M[b];20==q.type&&a.keyCode==q.key&&c(q,1)}F&&a.preventDefault()}function k(a){for(var b=0;b<M.length;b++){var q=M[b];20==q.type&&0==a.keyCode&&16==q.key&&c(q,0);20==q.type&&a.keyCode==q.key&&c(q,0)}F&&a.preventDefault()}function e(a){for(var b=!1,q=null,d=0;d<M.length;d++){var e=M[d];50==e.type&&(c(e,1),e.Tb=a.which);160==e.type&&(b||(q=u.pick_object(a.clientX,a.clientY),b=!0),e.value=q==e.Pc?1:0)}ga&&a.preventDefault()}function r(a){for(var b=0;b<M.length;b++){var q=M[b];50==q.type&&c(q,0);160==
q.type&&q.rn&&(q.value=0)}ga&&a.preventDefault()}function v(a){var b=a.clientX,q=a.clientY;D=b;V=q;for(var b=b-O,q=q-U,d=Math.sqrt(b*b+q*q),e=0;e<M.length;e++){var f=M[e];if(40===f.type)switch(f.axis){case "X":c(f,b);break;case "Y":c(f,q);break;case "XY":c(f,d)}}ga&&a.preventDefault()}function m(a){var b=a.wheelDelta||-40*a.detail,b=b*H.Sw;G+=b;for(b=0;b<M.length;b++){var q=M[b];30===q.type&&c(q,G)}S&&a.preventDefault()}function t(a){a=a.targetTouches;if(1==a.length){var b=a[0];a=b.pageX;for(var b=
b.pageY,q=!1,d=null,e=0;e<M.length;e++){var c=M[e];160==c.type&&(q||(d=u.pick_object(a,b),q=!0),c.value=d==c.Pc)}P[0]=a;P[1]=-1;R[0]=b;R[1]=-1}else 1<a.length&&(X=N=y(a),P[0]=a[0].pageX,P[1]=a[1].pageX,R[0]=a[0].pageY,R[1]=a[1].pageY);T.set(P);L.set(R)}function s(a){var b=a.targetTouches;if(0!==b.length){if(1===b.length){T[0]=b[0].pageX;T[1]=-1;L[0]=b[0].pageY;L[1]=-1;var b=T[0]-P[0],q=L[0]-R[0],d=Math.sqrt(b*b+q*q);if(-1!=P[1]&&-1!=R[1]){var e=T[0]-P[1],D=L[0]-R[1],B=Math.sqrt(e*e+D*D);B<d&&(b=e,
q=D,d=B)}for(e=0;e<M.length;e++)if(D=M[e],60===D.type)switch(D.axis){case "X":c(D,b);break;case "Y":c(D,q);break;case "XY":c(D,d)}}else if(1<b.length)for(T[0]=b[0].pageX,T[1]=b[1].pageX,L[0]=b[0].pageY,L[1]=b[1].pageY,X=y(b),b=X-N,e=0;e<M.length;e++)D=M[e],70===D.type&&c(D,b);z&&a.preventDefault()}}function y(a){var b=a[0],q=a[1];a=b.pageX;var b=b.pageY,e=q.pageX,q=q.pageY;return Math.sqrt((a-e)*(a-e)+(b-q)*(b-q))}var d=n("__config"),C=n("__print"),A=n("__physics"),u=n("__scenes"),w=n("__util"),p=
n("vec3"),I=n("quat"),H=d.controls,x=[],M=[],q={},G=0,D=0,V=0,O=0,U=0,T=new Float32Array(2),L=new Float32Array(2),P=new Float32Array(2),R=new Float32Array(2),X=0,N=0,ca=0,Q=!1,ia=0,F=!1,ga=!1,S=!1,z=!1;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(b,e){ca=b;for(var d=0;d<M.length;d++){var f=M[d],z=b,m=e;if(m)switch(f.type){case 110:var B=f.Pc,h=B.d.e,B=B.d.quat,k=p.dist(f.Jg,h),l=f.nq;I.invert(f.Dj,l);I.multiply(B,l,l);I.normalize(l,l);l=Math.abs(2*Math.acos(l[3]));
k/=m;f.yi=w.smooth(k,f.yi,m,.3);f.Tb[0]=k;k=l/m;f.xi=w.smooth(k,f.xi,m,.3);f.Tb[1]=k;f.yi>=f.threshold||f.xi>=f.yq?c(f,1):c(f,0);p.copy(h,f.Jg);I.copy(B,f.Dj);f.bc=z;break;case 120:B=f.Pc;h=B.d.e;B=Math.abs(h[1]-f.Jg[1])/m;f.zi=w.smooth(B,f.zi,m,.3);f.Tb=B;f.zi>=f.threshold?c(f,1):c(f,0);p.copy(h,f.Jg);f.bc=z;break;case 130:z-f.bc>=f.Nh&&(c(f,1),f.bc=z);break;case 140:f.bc||(f.bc=z);c(f,z-f.bc);f.bc=z;break;case 150:c(f,z)}}for(d=0;d<x.length;d++)for(m=x[d],f=m.De,z=0;z<f.length;z++)if(h=f[z],h.kr!=
ia){h.kr=ia;for(var B=h,k=B.Nc,l=B.Jx,g=0;g<k.length;g++)l[g]=k[g].value;var B=B.Gw(l),k=h,l=k.wp,r=g=void 0;switch(k.type){case a.CT_CONTINUOUS:B?r=g=1:1==l?r=g=-1:g=0;break;case a.CT_TRIGGER:B&&-1==l?r=g=1:B||1!=l?g=0:r=g=-1;break;case a.CT_SHOT:B&&-1==l?r=g=1:B||1!=l?g=0:(g=0,r=-1);break;case a.CT_LEVEL:g=k.vp!=B?1:0;break;default:w.ea("Wrong sensor manifold type: "+k.type)}r&&(k.wp=r);if(k=g)if(l=m==q?null:m,Q=!1,h.callback(l,h.id,k,h.Ht),h.vp=B,Q){d=-1;break}}for(d=0;d<x.length;d++)for(m=x[d],
f=m.De,z=0;z<f.length;z++)for(h=f[z],m=h.Nc,h=0;h<m.length;h++)switch(B=m[h],B.type){case 30:c(B,0);break;case 40:c(B,0);break;case 60:c(B,0);break;case 70:c(B,0);break;case 130:c(B,0)}G=0;O=D;U=V;P.set(T);R.set(L);N=X;ia++};a.create_custom_sensor=function(a){var q=b(10);c(q,a);return q};a.create_keyboard_sensor=function(a){var q=b(20);q.key=a;return q};a.create_collision_sensor=function(a,q,d){if(!a||!a.j)return C.error("Wrong collision object"),null;var e=b(80);e.Hk=a;e.Pb=q||"ANY";e.Ml=d;e.Gk=
function(a,b){c(e,a);a&&b&&d&&(e.Tb=e.Tb||new Float32Array(3),e.Tb[0]=b[0],e.Tb[1]=b[1],e.Tb[2]=b[2])};e.Td=!0;return e};a.create_collision_impulse_sensor=function(a){if(!a||!a.j)return C.error("Wrong collision impulse object"),null;var q=b(90);q.Fk=a;q.Sn=function(a){c(q,a)};q.Td=!0;return q};a.create_ray_sensor=function(a,q,e,d,f){if(!a)return C.error("Wrong collision object"),null;var D=b(100);D.Pc=a;D.sm=q;D.Yk=e;D.Dl=d;D.Pb=f||"ANY";D.pq=function(a,b){c(D,a);a&&(D.Tb=b)};D.Td=!0;return D};a.create_mouse_click_sensor=
function(){return b(50)};a.create_mouse_wheel_sensor=function(){return b(30)};a.create_mouse_move_sensor=function(a){var q=b(40);q.axis=a||"XY";return q};a.create_touch_move_sensor=function(a){var q=b(60);q.axis=a||"XY";return q};a.create_touch_zoom_sensor=function(){return b(70)};a.create_motion_sensor=function(a,q,e){if(!a)return C.error("Wrong collision object"),null;var d=b(110);d.Pc=a;var c=a.d.e;a=a.d.quat;d.nq=new Float32Array(4);d.Jg=new Float32Array(c);d.Dj=new Float32Array(a);d.yi=0;d.xi=
0;d.threshold=q;d.yq=e;d.bc=0;d.Tb=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=function(a,q){if(!a)return C.error("Wrong collision object"),null;var d=b(120);d.Pc=a;var e=a.d.quat;d.Jg=new Float32Array(a.d.e);d.Dj=new Float32Array(e);d.zi=0;d.threshold=q;d.bc=0;d.Tb=0;return d};a.create_timer_sensor=function(a){var q=b(130);q.Nh=a;q.bc=ca;return q};a.reset_timer_sensor=function(a,b,d,e){a=a||q;e=e||0;a=a.Cc;if(!a||!a[b])return C.error("reset_timer_sensor(): wrong object"),
null;b=a[b].Nc[d];if(!b)return C.error("reset_timer_sensor(): sensor not found"),null;b.bc=ca+e};a.create_elapsed_sensor=function(){var a=b(140);a.bc=0;return a};a.create_timeline_sensor=function(){return b(150)};a.create_selection_sensor=function(a,q){var d=b(160);d.Pc=a;d.rn=q;return d};a.Ix=c;a.get_sensor_value=function(a,b,d){a=a||q;a=a.Cc;if(!a||!a[b])return C.error("get_sensor_value(): wrong object"),null;b=a[b].Nc[d];return b?b.value:(C.error("get_sensor_value(): sensor not found"),null)};
a.get_sensor_payload=function(a,b,d){a=a||q;a=a.Cc;if(!a||!a[b])return C.error("get_sensor_payload(): wrong object"),null;b=a[b].Nc[d];return b?b.Tb:(C.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){x=[];M=[];q={};ca=0};a.check_sensor_manifold=function(a,b){a=a||q;if(!a.Cc)return!1;if(b&&a.Cc[b])return!0;if(!b)for(var d in a.Cc)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||q;var d=a.Cc,e=a.De;if(b){var c=d[b];if(c){for(var D=c.Nc,B=0;B<D.length;B++)1===
f(D[B],x)&&l(D[B],M);delete d[b];c=e.indexOf(c);-1<c?e.splice(c,1):w.ea("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||g(a)}}else{for(b in d){c=d[b];D=c.Nc;for(B=0;B<D.length;B++)1===f(D[B],x)&&l(D[B],M);delete d[b];c=e.indexOf(c);-1<c?e.splice(c,1):w.ea("Incorrect manifolds array")}g(a);Q=!0}};a.create_sensor_manifold=function(a,b,d,e,c,D,B){a=a||q;a.Cc=a.Cc||{};a.De=a.De||[];var p=a.Cc,z=a.De,m=p[b];if(m){e=m.Nc;for(var h=0;h<e.length;h++)1===f(e[h],x)&&l(e[h],M);m=z.indexOf(m);
-1<m?z.splice(m,1):w.ea("Incorrect manifolds array")}d={id:b,type:d,Nc:e.slice(0),Gw:c,Jx:Array(e.length),callback:D,Ht:B,wp:-1,vp:0,kr:-1};p[b]=d;z.push(d);-1==x.indexOf(a)&&x.push(a);a=d.Nc;for(b=0;b<a.length;b++){p=a[b];if(p.Td){switch(p.type){case 80:A.append_collision_test(p.Hk,p.Pb,p.Gk,p.Ml);break;case 90:A.apply_collision_impulse_test(p.Fk,p.Sn);break;case 100:A.append_ray_test(p.Pc,p.Pb,p.sm,p.Yk,p.Dl,p.pq)}p.Td=!1}-1==M.indexOf(p)&&M.push(p)}Q=!0};a.Vk=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];
return a[a.length-1]};a.Nu=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<x.length;a++){var b=x[a],q=b.Cc,b=b.De,d;for(d in q)delete q[d];b.splice(0,b.length)}for(a=0;a<M.length;a++)l(M[a],M),a--;x.splice(0,x.length)};a.debug=function(){C.log(String(x.length)+" objects with manifolds",x);C.log(String(M.length)+" sensors",M);for(var a=[],b=[],q=0;q<M.length;q++){var d=M[q];80==d.type&&a.push(d);100==d.type&&b.push(d)}C.log(String(a.length)+
" collision sensors",a);C.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",h,!1);a.addEventListener("keyup",k,!1);F=b};a.register_mouse_events=function(a,b){a.addEventListener("mousedown",e,!1);a.addEventListener("mouseup",r,!1);a.addEventListener("mousemove",v,!1);ga=b};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",m,!1);a.addEventListener("DOMMouseScroll",m,!1);S=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",
t,!1);a.addEventListener("touchmove",s,!1);document.addEventListener("touchstart",function(){});z=b};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",h,!1);a.removeEventListener("keyup",k,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",e,!1);a.removeEventListener("mouseup",r,!1);a.removeEventListener("mousemove",v,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",m,!1);a.removeEventListener("DOMMouseScroll",m,!1)};a.unregister_touch_events=
function(a){a.removeEventListener("touchstart",t,!1);a.removeEventListener("touchmove",s,!1);document.removeEventListener("touchstart",function(){})}};b4w.module.__curve=function(a,n){function b(a,b,c,e,f){var g=e.length;f||(f=new Float32Array(g));for(var m=g+a,t=new Float32Array(m),s=1;s<=m-1;s++)t[s-1]=b>=c[s-1]&&b<c[s+1-1]?1:0;for(var y=2;y<=a;y++)for(s=1;s<=m-y;s++)t[s-1]=(0!=t[s-1]?(b-c[s-1])*t[s-1]/(c[s+y-1-1]-c[s-1]):0)+(0!=t[s+1-1]?(c[s+y-1]-b)*t[s+1-1]/(c[s+y-1]-c[s+1-1]):0);b==c[m-1]&&(t[g-1]=1);a=0;for(s=1;s<=g;s++)a+=t[s-1]*e[s-1];for(s=1;s<=g;s++)f[s-1]=0!=a?t[s-1]*e[s-1]/a:0;return f}function c(a){a=a.jj;return a[a.length-1]}function g(a){a=
a.io;return a[a.length-1]}var f=n("__util");a.zu=function(a){var c={},f=a.data;a=f.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;c.ge=e;a=a.points;var g=a.length/5,v=[],m=g+e,g=g+2;v[0]=0;for(var t=2;t<=m;t++)v[t-1]=t>e&&t<g?v[t-2]+1:v[t-2];c.jj=v;if("2D"==f.dimensions)c.ae=!1;else if("3D"==f.dimensions)c.ae=!0;else throw"Wrong curve dimensions";e=[];v=[];for(f=0;f<a.length;f+=5)e.push(a[f]),e.push(a[f+1]),e.push(a[f+2]),c.ae&&e.push(a[f+3]),v.push(a[f+4]);c.Lk=
e;c.Mm=v;a=[];for(var f=c.Lk,e=c.ae?4:3,v=c.Mm,m=c.jj,g=c.ge,t=f.length/e,s=t+g,y=0,d=m[s-1]/999,C=0;1E3>C;C++){5E-6>m[s-1]-y&&(y=m[s-1]);for(var A=b(g,y,m,v),u=0;u<e;u++)for(var w=a[e*C+u]=0;w<t;w++)a[e*C+u]+=A[w]*f[e*w+u];y+=d}e=c.ae?4:3;v=new Float32Array(1E3);v[0]=0;for(f=1;1E3>f;f+=1)m=a[(f-1)*e],g=a[(f-1)*e+1],t=a[(f-1)*e+2],s=a[f*e],y=a[f*e+1],d=a[f*e+2],v[f]=v[f-1]+Math.sqrt((s-m)*(s-m)+(y-g)*(y-g)+(d-t)*(d-t));c.io=v;return c};a.py=function(a,f,k){k||(k=[]);var e=f,g=Math.max(e,0);f=g=Math.min(e,
c(a));var e=a.Lk,g=a.ae?4:3,v=a.Mm,m=a.jj,t=a.ge;a=e.length/g;var s=a+t;5E-6>m[s-1]-f&&(f=m[s-1]);s=new Float32Array(a);b(t,f,m,v,s);for(f=0;f<g;f++)for(v=k[f]=0;v<a;v++)k[f]+=s[v]*e[g*v+f]};a.my=function(a,b,c){c||(c=[]);var e=a.Lk,f=a.ae?4:3,g=a.Mm,m=a.jj,t=a.ge;a=e.length/f;var s=a+t;5E-6>m[s-1]-b&&(b=m[s-1]);var s=new Float32Array(a),y=b;b=s;var d=g.length;b||(b=new Float32Array(d));var C=new Float32Array(d),A=new Float32Array(d),u=C,w=A;u||(u=new Float32Array(d));w||(w=new Float32Array(d));for(var p=
d+t,I=new Float32Array(p),H=new Float32Array(p),x=1;x<=p-1;x++)I[x-1]=y>=m[x-1]&&y<m[x+1-1]?1:0;y==m[p-1]&&(I[d-1]=1);for(var M=2;M<=t;M++)for(x=1;x<=p-M;x++){var q=0!=I[x-1]?I[x-1]/(m[x+M-1-1]-m[x-1]):0,G=0!=I[x+1-1]?-I[x+1-1]/(m[x+M-1]-m[x+1-1]):0,D=0!=H[x-1]?(y-m[x-1])*H[x-1]/(m[x+M-1-1]-m[x-1]):0,V=0!=H[x+1-1]?(m[x+M-1]-y)*H[x+1-1]/(m[x+M-1]-m[x+1-1]):0;I[x-1]=(0!=I[x-1]?(y-m[x-1])*I[x-1]/(m[x+M-1-1]-m[x-1]):0)+(0!=I[x+1-1]?(m[x+M-1]-y)*I[x+1-1]/(m[x+M-1]-m[x+1-1]):0);H[x-1]=q+G+D+V}for(x=1;x<=
d;x++)u[x-1]=I[x-1],w[x-1]=H[x-1];m=0;for(t=1;t<=d;t++)m+=C[t-1]*g[t-1];y=0;for(t=1;t<=d;t++)y+=A[t-1]*g[t-1];for(t=1;t<=d;t++)b[t-1]=0!=m?A[t-1]*g[t-1]/m+C[t-1]*g[t-1]*y/(m*m):0;for(g=0;g<f;g++)for(m=c[g]=0;m<a;m++)c[g]+=s[m]*e[f*m+g]};a.DB=c;a.oy=g;a.ny=function(a,b){if(0>=b)return 0;var k=c(a);if(b>=g(a))return k;var e=a.io,r=f.Bi(e,b,0,e.length-1);return k*(r+(b-e[r])/(e[r+1]-e[r]))/1E3}};b4w.module.__dds=function(a,n){function b(a,b,e,c){var f=new Uint16Array(4),d=new Uint16Array(e*c),h=0,g=0,k=0,l=g=h=0,p=0,r=0,H=0,x=e/4;c/=4;for(var M=0;M<c;M++)for(var q=0;q<x;q++)k=b+4*(M*x+q),f[0]=a[k],f[1]=a[k+1],h=f[0]&31,g=f[0]&2016,l=f[0]&63488,p=f[1]&31,r=f[1]&2016,H=f[1]&63488,f[2]=5*h+3*p>>3|5*g+3*r>>3&2016|5*l+3*H>>3&63488,f[3]=5*p+3*h>>3|5*r+3*g>>3&2016|5*H+3*l>>3&63488,h=a[k+2],g=4*M*e+4*q,d[g]=f[h&3],d[g+1]=f[h>>2&3],d[g+2]=f[h>>4&3],d[g+3]=f[h>>6&3],g+=e,d[g]=f[h>>8&3],d[g+1]=f[h>>
10&3],d[g+2]=f[h>>12&3],d[g+3]=f[h>>14],h=a[k+3],g+=e,d[g]=f[h&3],d[g+1]=f[h>>2&3],d[g+2]=f[h>>4&3],d[g+3]=f[h>>6&3],g+=e,d[g]=f[h>>8&3],d[g+1]=f[h>>10&3],d[g+2]=f[h>>12&3],d[g+3]=f[h>>14];return d}function c(a,c,f,g){var y=new Int32Array(f,0,31),d,C,A,u,w,p;if(542327876!=y[0])return h.error("Invalid magic number in DDS header"),0;if(!y[20]&4)return h.error("Unsupported format, must contain a FourCC code"),0;d=y[21];switch(d){case k:C=8;A=c?c.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case e:C=16;A=
c?c.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case r:C=16;A=c?c.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return h.error("Unsupported FourCC code:",l(d)),null}p=1;y[2]&131072&&!1!==g&&(p=Math.max(1,y[7]));u=y[4];w=y[3];y=y[1]+4;if(c)for(d=0;d<p;++d)g=Math.max(4,u)/4*Math.max(4,w)/4*C,c=new Uint8Array(f,y,g),a.compressedTexImage2D(a.TEXTURE_2D,d,A,u,w,0,c),y+=g,u=Math.max(.5*u,1),w=Math.max(.5*w,1);else if(d==k)Math.max(4,u),Math.max(4,w),c=new Uint16Array(f),f=b(c,y/2,u,w),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,u,w,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,f),g&&a.generateMipmap(a.TEXTURE_2D);else return h.error("No manual decoder for",l(d),"and no native support"),0;return p}function g(a,b,e,f,g,d){var h=new XMLHttpRequest;h.open("GET",e,!0);h.responseType="arraybuffer";h.onload=function(){if(200==h.status){a.bindTexture(a.TEXTURE_2D,f);var e=c(a,b,h.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}d&&
d(f)};h.send(null);return f}function f(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var h=n("__print"),k=f("DXT1"),e=f("DXT3"),r=f("DXT5");a.pA=b;a.bz=c;a.Xo=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Mv=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case e:case r:b=4;break;default:h.error("Unsupported FourCC code:",l(a))}return b};
a.kB=g;a.jB=function(a,b,e,c){var f=a.createTexture();g(a,b,e,f,!0,c);return f}};b4w.module.__debug=function(a,n){function b(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&h.ea("Structure assertion failed: incompatible types");for(var d in a)d in b||h.ea("Structure assertion failed: missing key in the first object: "+d);for(d in b)d in a||h.ea("Structure assertion failed: missing key in the second object: "+d),typeof a[d]!=typeof b[d]&&h.ea("Structure assertion failed: incompatible types for key "+d)}var g=
n("__extensions"),f=n("__print"),l=n("__textures"),h=n("__util"),k=null,e={},r=!1,v={},m=[],t=-1,s=null,y=!1;a.Xm={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Xb=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),d;for(d in b){var c=b[d];c in a&&(e[a[c]]=c)}k=a};a.Qt=function(a){if(r){var b=k.getError();if(b!=k.NO_ERROR){if(b in e)throw"B4W Error: "+b+", gl."+e[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Nt=function(){if(r)switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:break;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:f.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:f.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:f.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case k.FRAMEBUFFER_UNSUPPORTED:f.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:f.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.Jn=function(){if(-1!=t)return t;k.bindFramebuffer(k.FRAMEBUFFER,k.createFramebuffer());var a=l.Ni("DEBUG",l.Wg);l.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.Bb,a.Ga,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(t=!0,f.warn("B4W warning: depth-only issue was found")):t=!1;k.bindFramebuffer(k.FRAMEBUFFER,
null);return t};a.Rt=function(a,d,c){if(r&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw c=b(c),f.error("B4W Error: shader compilation failed:\n"+c+"\n"+k.getShaderInfoLog(a)+" ("+d+")"),"Engine failed: see above for error messages";};a.St=function(a,d,c,e,p,m){if(r&&!k.getProgramParameter(a,k.LINK_STATUS)){var h=g.Lo();h&&(p=h.getTranslatedShaderSource(c),m=h.getTranslatedShaderSource(e));p=b(p);m=b(m);f.error("B4W Error: shader linking failed:\n"+p+"\n\n\n"+m+"\n"+k.getProgramInfoLog(a)+" ("+
d+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){r=a};a.qA=function(a){v[a]=a in v?v[a]+1:1};a.update=function(){for(var a in v)f.log(a,v[a]),v[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var d=arguments[b];if(h.is_vector(d))for(var c=0;c<d.length;c++)a.push(d[c]);else a.push(arguments[b])}m.push(a)};a.msg=function(){for(var a=1,b=0;b<m.length;b++){var d=m[b];d[1]==arguments[0]&&a++}d=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],h.is_vector(a))for(var c=0;c<a.length;c++)d.push(a[c]);else d.push(arguments[b]);m.push(d)};var d=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},e=Math.max(0,performance.now()-1E3*a),p=0;p<m.length;p++){var h=m[p];a=h[0];if(!(a<e)){var g=String(h[1]);c[g]||(c[g]=d[b++%d.length]);a=["%c"+(a/1E3).toFixed(6),c[g],g];for(g=2;g<h.length;g++)a.push(h[g]);f.log.apply(this,a)}}m.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},d=Math.max(0,performance.now()-1E3*a),c=0;c<m.length;c++){var e=m[c];a=e[0];if(!(a<d))for(var g=2;g<e.length;g++){var h=String(e[1]);3<e.length&&(h+="_"+String(g-2));b[h]||(b[h]=h+"\n");b[h]+=String(a)+" "+e[g]+"\n"}}a="";for(h in b)a+=b[h]+"\n\n";f.log(a);m.splice(0)};a.Yz=function(a){function b(a){return-1<d.indexOf(a)?!0:!1}var d=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(h.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.Rz=function(a,b){typeof a!=b&&h.ea("Type assertion failed: value type is not a {"+b+"}:",a)};a.Pz=c;a.Qz=function(a){y?c(a,
s):y=!0;s=a}};b4w.module.__extensions=function(a,n){function b(a){if(a in f)return f[a];var b=g.getExtension(a)||null;f[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var c=n("__print"),g=null,f={};a.Xb=function(a){g=a};a.To=function(){return b("WEBGL_compressed_texture_s3tc")||b("WEBKIT_WEBGL_compressed_texture_s3tc")||b("MOZ_WEBGL_compressed_texture_s3tc")};a.Pv=function(){return b("WEBGL_depth_texture")||b("WEBKIT_WEBGL_depth_texture")||b("MOZ_WEBGL_depth_texture")};a.Fv=function(){return b("EXT_texture_filter_anisotropic")||
b("WEBKIT_EXT_texture_filter_anisotropic")||b("MOZ_EXT_texture_filter_anisotropic")};a.Lo=function(){return b("WEBGL_debug_shaders")};a.So=function(){return b("WEBGL_debug_renderer_info")};a.Mo=function(){return b("OES_element_index_uint")};a.Yv=function(){return b("OES_standard_derivatives")};a.cleanup=function(){f={}}};b4w.module.__graph=function(a){function n(a,d,c){c||(c=null);if(b(a,d))throw"Graph already has node with given ID";a.za.push(d,c)}function b(a,b){for(var d=a.za,c=0;c<d.length;c+=2)if(d[c]==b)return!0;return!1}function c(a,d,c,e){e||(e=null);if(b(a,d)&&b(a,c))a.ua.push(d,c,e);else throw"Wrong node IDs";}function g(a,d){if(!b(a,d))throw"Node not found";for(var c=a.za,e=0;e<c.length;e+=2)c[e]==d&&(c.splice(e,2),e-=2)}function f(a){a=a.za;for(var b=-1,d=0;d<a.length;d+=2)b=Math.max(b,a[d]);return++b}
function l(a,b){for(var d=a.za,c=0;c<d.length;c+=2)if(d[c+1]==b)return d[c];return-1}function h(a){var b=[],d={};k(a,d);for(var c=a.za,f=0;f<c.length;f+=2)0==A(a,c[f])&&e(a,c[f],d,b);return{za:b,ua:a.ua.slice(0)}}function k(a,b){for(var d=a.za,c=0;c<d.length;c+=2)b[d[c]]=!1}function e(a,b,c,f){if(!c[b]){c[b]=!0;for(var p=0;p<C(a,b);p++)e(a,u(a,b,p),c,f);f.unshift(b,d(a,b))}}function r(a,b,d,c){if(!d[b]){d[b]=!0;if(10==c||30==c)for(var e=0;e<C(a,b);e++){var f=u(a,b,e);r(a,f,d,c)}if(20==c||30==c)for(e=
0;e<A(a,b);e++)f=w(a,b,e),r(a,f,d,c)}}function v(a){var b=a.za;a=a.ua;for(var d=[],c=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,d.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)c.push(e[a[f]],e[a[f+1]],a[f+2]);return{za:d,ua:c}}function m(a,b,d){if(d.Fc==d.fe){for(var c=0,e=0;c<d.fe;c++)-1!=d.gd[c]&&(a[e]=c,b[e]=d.gd[c],e++);return!0}if(d.fe>d.og||d.se>d.te||d.Fg>d.Hg||d.Eg>d.Gg)return!1;for(var e=c=-1,f=!1;!f&&t(d,M,c,e);)if(c=M[0],e=M[1],s(d,c,e)){var p;p=d;f={};f.uh=p.uh;f.vh=p.vh;f.Ol=p.Ol;f.Ri=p.Ri;f.fe=
p.fe;f.og=p.og;f.ge=p.ge;f.Fc=f.uj=p.Fc;f.Eg=p.Eg;f.Fg=p.Fg;f.se=p.se;f.Gg=p.Gg;f.Hg=p.Hg;f.te=p.te;f.$g=-1;f.gd=p.gd;f.Qe=p.Qe;f.bf=p.bf;f.cf=p.cf;f.wf=p.wf;f.xf=p.xf;f.Kj=p.Kj;p.Kj[0]+=1;var f=p=f,g=c,h=e,x=f.uh,k=f.vh,l=f.fe,r=f.og,H=f.gd,v=f.Qe,I=f.bf,n=f.cf,S=f.wf,z=f.xf;y(g<l);y(h<r);y(f.Fc<l);y(f.Fc<r);l=++f.Fc;f.$g=g;I[g]||(I[g]=l,f.Eg++,S[g]&&f.se++);S[g]||(S[g]=l,f.Fg++,I[g]&&f.se++);n[h]||(n[h]=l,f.Gg++,z[h]&&f.te++);z[h]||(z[h]=l,f.Hg++,n[h]&&f.te++);H[g]=h;v[h]=g;for(H=0;H<A(x,g);H++)v=
w(x,g,H),I[v]||(I[v]=l,f.Eg++,S[v]&&f.se++);for(H=0;H<C(x,g);H++)v=u(x,g,H),S[v]||(S[v]=l,f.Fg++,I[v]&&f.se++);for(H=0;H<A(k,h);H++)v=w(k,h,H),n[v]||(n[v]=l,f.Gg++,z[v]&&f.te++);for(H=0;H<C(k,h);H++)v=u(k,h,H),z[v]||(z[v]=l,f.Hg++,n[v]&&f.te++);f=m(a,b,p);y(1>=p.Fc-p.uj);y(-1!=p.$g);v=p.uh;g=p.vh;h=p.Fc;x=p.$g;k=p.gd;I=p.Qe;l=p.bf;n=p.cf;r=p.wf;S=p.xf;if(p.uj<h){l[x]==h&&(l[x]=0);for(z=0;z<A(v,x);z++)H=w(v,x,z),l[H]==h&&(l[H]=0);r[x]==h&&(r[x]=0);for(z=0;z<C(v,x);z++)H=u(v,x,z),r[H]==h&&(r[H]=0);
v=k[x];n[v]==h&&(n[v]=0);for(z=0;z<A(g,v);z++)H=w(g,v,z),n[H]==h&&(n[H]=0);S[v]==h&&(S[v]=0);for(z=0;z<C(g,v);z++)H=u(g,v,z),S[H]==h&&(S[H]=0);k[x]=-1;I[v]=-1;p.Fc=p.uj;p.$g=-1}}return f}function t(a,b,d,c){-1==d&&(d=0);-1==c?c=0:c++;var e=a.se,f=a.te,p=a.Fg,h=a.Hg,g=a.Eg,m=a.Gg,x=a.Fc,k=a.fe,l=a.og,r=a.gd,H=a.Qe,s=a.bf,C=a.cf,M=a.wf,z=a.xf;if(e>x&&f>x)for(;d<k&&(-1!=r[d]||0==M[d]||0==s[d]);)d++,c=0;else if(p>x&&h>x)for(;d<k&&(-1!=r[d]||0==M[d]);)d++,c=0;else if(g>x&&m>x)for(;d<k&&(-1!=r[d]||0==s[d]);)d++,
c=0;else if(0==d&&0!=a.ge){for(s=0;s<k&&-1!=r[d=a.ge[s]];)s++;s==k&&(d=k)}else for(;d<k&&-1!=r[d];)d++,c=0;if(e>x&&f>x)for(;c<l&&(-1!=H[c]||0==z[c]||0==C[c]);)c++;else if(p>x&&h>x)for(;c<l&&(-1!=H[c]||0==z[c]);)c++;else if(g>x&&m>x)for(;c<l&&(-1!=H[c]||0==C[c]);)c++;else for(;c<l&&-1!=H[c];)c++;return d<k&&c<l?(b[0]=d,b[1]=c,!0):!1}function s(a,b,c){var e=a.uh,f=a.vh,h=a.og,g=a.gd,m=a.Qe,x=a.bf,k=a.cf,l=a.wf,r=a.xf;y(b<a.fe);y(c<h);y(-1==g[b]);y(-1==m[c]);if(!(0,a.Ol)(d(e,b),d(f,c)))return!1;for(var H=
h=0,s=0,M=0,v=0,t=0,S=0;S<C(e,b);S++){var z=u(e,b,S);if(-1!=g[z]){var J=g[z];if(!p(f,c,J)||!I(a.Ri,e,b,z,f,c,J))return!1}else x[z]&&s++,l[z]&&h++,x[z]||l[z]||v++}for(S=0;S<A(e,b);S++)if(z=w(e,b,S),-1!=g[z]){if(J=g[z],!p(f,J,c)||!I(a.Ri,e,z,b,f,J,c))return!1}else x[z]&&s++,l[z]&&h++,x[z]||l[z]||v++;for(S=0;S<C(f,c);S++)if(J=u(f,c,S),-1!=m[J]){if(z=m[J],!p(e,b,z))return!1}else k[J]&&M++,r[J]&&H++,k[J]||r[J]||t++;for(S=0;S<A(f,c);S++)if(J=w(f,c,S),-1!=m[J]){if(z=m[J],!p(e,z,b))return!1}else k[J]&&M++,
r[J]&&H++,k[J]||r[J]||t++;return s<=M&&h<=H&&v<=t}function y(a){if(!a)throw"Assertion failed";}function d(a,b){for(var d=a.za,c=0;c<d.length;c+=2)if(d[c]==b)return d[c+1];return null}function C(a,b){for(var c=a.ua,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function A(a,b){for(var c=a.ua,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function u(a,b,c){a=a.ua;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function w(a,b,c){a=a.ua;for(var d=0,e=0;e<a.length;e+=3)if(a[e+
1]==b){if(d==c)return a[e];d++}return-1}function p(a,b,d){a=a.ua;for(var c=0;c<a.length;c+=3)if(a[c]==b&&a[c+1]==d)return!0;return!1}function I(a,b,c,d,e,f,p){for(var h=H(b,c,d),g=H(e,f,p),m=0;m<h;m++){for(var k=!1,l=0;l<g;l++)if(a(x(b,c,d,m),x(e,f,p,l))){k=!0;break}if(!k)return!1}return!0}function H(a,b,c){var d=0;a=a.ua;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function x(a,b,c,d){a=a.ua;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}
var M=[-1,-1];a.Tm=-1;a.Gz=10;a.Br=20;a.Jz=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{za:b,ua:c}};a.iA=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{za:c,ua:d}};a.qk=n;a.QA=b;a.He=c;a.sg=g;a.rg=function(a,b,c,d){if(!p(a,b,c))throw"Edge not found";
a=a.ua;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.o=function(a,b){if(-1==l(a,b))n(a,f(a),b);else throw"Non-unique attribute";};a.vx=function(a,b,c,d,e){a=a.ua;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.Io=f;a.Hh=l;a.i=function(a,b,d,e){b=l(a,b);d=l(a,d);if(-1!=b&&-1!=d)c(a,b,d,e);else throw"Attributes not found";};a.K=function(a,b){for(var d=a.za,c=0;c<d.length&&!b(d[c],d[c+1]);c+=2);};
a.ue=function(a,b){for(var d=a.ua,c=0;c<d.length&&!b(d[c],d[c+1],d[c+2]);c+=3);};a.ve=function(a,b,c){for(var e=a.ua,f=0;f<e.length;f+=3)if(e[f+1]==b){var p=e[f];if(c(p,d(a,p),e[f+2]))break}};a.we=function(a,b,c){for(var e=a.ua,f=0;f<e.length;f+=3)if(e[f]==b){var p=e[f+1];if(c(p,d(a,p),e[f+2]))break}};a.er=h;a.Gy=function(a){a=h(a).za;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.$A=function(){};a.ty=function(a,c,e){if(!b(a,c))throw"No such node";var f={};k(a,f);r(a,c,f,e);c=[];for(var p in f)f[p]&&
(p=Number(p),c.push(p,d(a,p)));a={za:c,ua:a.ua.slice(0)};f=a.ua;for(p=0;p<f.length;p+=3)c=f[p+1],b(a,f[p])&&b(a,c)||(f.splice(p,3),p-=3);return a};a.Xv=function(a){for(var b=[],c=a.za,d=0;d<c.length;d+=2){var e=c[d];A(a,e)||b.push(e)}return b};a.Vo=function(a){for(var b=[],c=a.za,d=0;d<c.length;d+=2){var e=c[d];C(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.uh=v(a);e.vh=v(b);e.Ol=c||function(a,b){return a==b};e.Ri=d||function(a,b){return a==b};d=a.za.length/2;var f=b.za.length/2;
e.fe=d;e.og=f;e.ge=0;e.Fc=e.uj=0;e.se=e.Eg=e.Fg=0;e.te=e.Gg=e.Hg=0;e.$g=-1;e.gd=Array(d);e.Qe=Array(f);e.bf=Array(d);e.cf=Array(f);e.wf=Array(d);e.xf=Array(f);e.Kj=[1];for(c=0;c<d;c++)e.gd[c]=-1,e.bf[c]=0,e.wf[c]=0;for(c=0;c<f;c++)e.Qe[c]=-1,e.cf[c]=0,e.xf[c]=0;f=Array(d);d=Array(d);if(m(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.za[2*f[c]],d[c]=b.za[2*d[c]];return[f,d]}return null};a.Da=d;a.pg=C;a.jp=A;a.fg=u;a.Vi=w;a.GA=H;a.eg=x;a.replace=function(a,b,c){for(var d=a.ua,e=f(a),p=0;p<b.length;p++){var h=
b[p];g(a,h);for(var m=0;m<d.length;m+=3)d[m]==h&&(d[m]=e),d[m+1]==h&&(d[m+1]=e),d[m]==d[m+1]&&(d.splice(m,3),m-=3)}n(a,e,c)};a.jA=function(a,b){var c=a.za,d=a.ua,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var p=c[f],m=c[f+1],m=b?b(p,m):String(p);e+="    ";e+=String(p)+' [label="'+m.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<d.length;f+=3)c=d[f],p=d[f+1],e+="    ",e+=String(c)+" -> "+String(p)+";\n";return e+="}"}};b4w.module.__ipc=function(a){var n=a.Gr=0;a.Hr=1;a.Ir=2;a.Jr=3;a.Kr=4;a.Lr=5;var b=a.Nr=6,c=a.Or=7,g=a.Pr=8;a.Qr=9;a.Mr=10;a.ps=11;a.Ac=12;a.Rr=13;a.Sr=14;a.Tr=15;a.Vr=16;a.Ur=17;a.Wr=18;a.Xr=19;a.Yr=20;a.Zr=21;a.$r=22;a.as=23;a.bs=24;a.cs=25;a.ds=26;a.es=27;a.fs=28;a.gs=29;a.hs=30;a.js=31;a.ks=32;a.ls=33;a.ns=34;a.os=35;a.qs=36;a.Vm=37;a.rs=38;a.ss=39;a.ts=40;a.us=41;a.vs=42;a.ws=43;a.xs=44;a.ys=45;a.zs=46;a.As=47;a.Bs=48;a.Cs=49;a.Ds=50;a.Wm=51;var f=a.Lf=52;a.Es=53;a.Um=54;a.Fs=55;a.Gs=56;a.Hz=
57;a.ms=58;for(var l=null,h=[],k=[],e=[],r=[],v=0;59>v;v++)h.push(null),k.push(null),e.push(null),r.push(null);k[g]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};k[b]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};k[c]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};k[n]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};k[f]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};r[g]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];r[b]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];r[c]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];r[n]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];r[f]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(r[a]){for(var d=k[a],e=r[a],f=0,m=0;m<e.length;m+=2){var h=e[m],p=e[m+1];if(1==p)d[h]="msg_id"==h||"body_id"==h||"body_id_a"==h||"body_id_b"==h?c[f]|0:c[f];else for(var g=0;g<p;g++)d[h][g]=c[f+g];f+=p}c=d}b(a,c)},!1);l=a};a.cleanup=function(){l=null};a.m=function(){var a=arguments[0]|0;if(r[a]){var b=k[a],c=r[a],f=0;if(!e[a]){for(var d=0,g=1;g<c.length;g+=2)d+=c[g];e[a]=new Float32Array(d)}d=e[a];for(g=0;g<c.length;g+=2){var v=b[c[g]],u=c[g+1];1==u?d[f]=v:d.set(v,
f);f+=u}h[a]||(h[a]=d);a=h[a]}else for(b=arguments.length,h[a]||(h[a]=Array(b),h[a][0]=a),a=h[a],c=1;c<b;c++)a[c]=arguments[c];l.postMessage(a)};a.Qo=function(a){return k[a]}};b4w.module.__hud=function(a,n){function b(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){g(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;k.K(a.d.Na,function(a,e){if("SINK"==e.type)g(" (F)",e.type);else{var d=e.type,f=Math.round(e.h.width)+"x"+Math.round(e.h.height),h=e.l.length,k=e.kh,l=e.enqueue&&e.R;l?g(" (A)",d,e.tf,f,k,"of",h):g(" (P)",d,e.tf,f,k,"of",h);e.kh=0;l&&(b+=h,c+=k)}});return[b,c]}g("No INFO")}function g(){for(var a=80+20*r[0],b=[5,
18,3,10,4,3,5],c=arguments[0],f=1;f<arguments.length;f++){for(var h="",d=0;d<b[f]-String(arguments[f]).length;d++)h+=" ";c+=h+arguments[f]}r[0]++;e.fillText(c,30,a)}function f(a,b,c){b*=a.qa;c.x=a.x+b;c.y=a.y;c.qa=a.qa-2*b;c.ja=a.ja}function l(a){return a.x+a.qa/2}function h(a){var b=e,c={x:0,y:0,qa:0,ja:0},h=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.qa=h;c.ja=b;f(c,.01,c);h=.02*c.ja;c.x=c.x;c.y+=h;c.qa=c.qa;c.ja-=2*h;h=c.qa/8;c.x+=h*a;c.y=c.y;c.qa=h;c.ja=c.ja;f(c,.02,c);return c}var k=n("__graph"),
e=null,r=[0,0];a.init=function(a){a=a.getContext("2d");b(a);return e=a};a.Lg=function(){e&&b(e)};a.reset=function(){var a=e;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),r[0]=0,r[1]=0)};a.by=function(a,b){var f=e;if(f){f.textAlign="left";f.fillStyle="rgba(0,255,0,255)";g(" FPS",(1/b).toFixed(2));r[0]++;for(var h=f=0,k=0;k<a.length;k++){var d=c(a[k]),f=f+d[0],h=h+d[1];r[0]++}g(" ---------------------------------------------");
g("    ","TOTAL ACTIVE","","",h,"of",f)}};a.print=function(){var a=e;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",g.apply(Math,arguments))};a.plot_array=function(a,b,c,f,g,d,k){var r=e;if(r){b=h(b);var u=b.ja/5;b.x=b.x;b.y+=4*u;b.qa=b.qa;b.ja=u;r.textAlign="center";r.fillStyle="#00FF00";e.fillText(a,l(b),b.y-10);r.strokeStyle="#00FF00";r.lineWidth=.5;r.beginPath();r.moveTo(b.x,b.y);r.lineTo(b.x+b.qa,b.y);r.lineTo(b.x+b.qa,b.y+b.ja);r.lineTo(b.x,b.y+b.ja);r.closePath();r.stroke();if(!d&&
!k)for(d=1E6,k=-1E6,a=0;a<c.length;a++)d=Math.min(d,c[a]),k=Math.max(k,c[a]);r.textAlign="right";e.fillText(String(d),b.x-10,b.y+b.ja);e.fillText(String(k),b.x-10,b.y);r.textAlign="center";e.fillText(String(f),b.x,b.y+b.ja+15);e.fillText(String(g),b.x+b.qa,b.y+b.ja+15);r.strokeStyle="#FF0000";r.lineWidth=1.5;r.beginPath();f=b.qa/(c.length-1);k=b.ja/(k-d);for(a=0;a<c.length;a++)g=b.x+f*a,u=b.y+b.ja-(c[a]-d)*k,0==a?r.moveTo(g,u):r.lineTo(g,u);r.stroke()}};a.draw_mixer_strip=function(a,b,c,f,g,d,k){var r=
e;if(r)for(r.textAlign="center",r.fillStyle="#00FF00",r.font="bold 12px Courier",c=h(c),e.fillText(b?"["+a+"]":a,l(c),c.y),0<=d&&e.fillText(d?"[M]":"[ ]",l(c)-15,c.y+30),0<=k&&e.fillText(k?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,qa:0,ja:0},b=0;b<f.length;b++){d=f[b];var u="VOLUME"==d[0];if(u){k=c.y+350;var w=c.qa,p=a;p.x=c.x;p.y=k;p.qa=w;p.ja=250}else{k=c.y+10+50*b;var w=c.qa,p=c.ja,I=a;I.x=c.x;I.y=k;I.qa=w;I.ja=p}k=r;var w=a,I=b==g,H=d[0],p=d[1],x=d[2],M=d[3],q=(M-x)/d[4],q=1>q?Math.floor(1/q-1E-5).toFixed(0).length:
0;d=d[5]?Math.log(p/x)/Math.log(M/x):(p-x)/(M-x);k.textAlign="center";I?k.fillText("["+H+"]",l(w),w.y):k.fillText(H,l(w),w.y);k.strokeStyle="#00FF00";k.lineWidth=u?3:1;u?(k.textAlign="right",k.fillText(M.toFixed(q),l(w)-10,w.y+15),k.textAlign="right",k.fillText(x.toFixed(q),l(w)-10,w.y+w.ja-15)):(k.textAlign="right",k.fillText(x.toFixed(q),w.x+28,w.y+15),k.textAlign="left",k.fillText(M.toFixed(q),w.x+w.qa-28,w.y+15));k.beginPath();if(u){var G=w.y+15+(w.ja-30)*(1-d);k.moveTo(l(w),w.y+15);k.lineTo(l(w),
w.y+w.ja-15);k.moveTo(l(w)-5,w.y+15);k.lineTo(l(w)+5,w.y+15);k.moveTo(l(w)-5,w.y+w.ja-15);k.lineTo(l(w)+5,w.y+w.ja-15);k.moveTo(l(w)-5,G);k.lineTo(l(w)+5,G)}else{var D=w.x+30+(w.qa-60)*d;k.moveTo(w.x+30,w.y+15);k.lineTo(w.x+w.qa-30,w.y+15);k.moveTo(w.x+30,w.y+15-5);k.lineTo(w.x+30,w.y+15+5);k.moveTo(w.x+w.qa-30,w.y+15-5);k.lineTo(w.x+w.qa-30,w.y+15+5);k.moveTo(D,w.y+15-5);k.lineTo(D,w.y+15+5)}k.stroke();"EQ_Q"==H?(d=Math.log(1+1/(2*p*p)+Math.sqrt((2+1/(p*p))*(2+1/(p*p))/4-1))/Math.log(2),u?(k.textAlign=
"left",k.fillText(p.toFixed(q),l(w)+10,G),k.textAlign="left",k.fillText("("+d.toFixed(q+1)+")",l(w)+10,G+10)):(k.textAlign="right",k.fillText(p.toFixed(q),D,w.y+30),k.textAlign="left",k.fillText("("+d.toFixed(q+1)+")",D,w.y+30))):u?(k.textAlign="left",k.fillText(p.toFixed(q),l(w)+10,G)):(k.textAlign="center",k.fillText(p.toFixed(q),D,w.y+30))}}};b4w.module.__renderer=function(a,n){function b(a){if(a){var b=(a.aa?y.COLOR_BUFFER_BIT:0)|(a.ga?y.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=v;break;case "DEPTH":a=m;break;case "SHORE_SMOOTHING":a=v;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=t;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=s;break;default:a=r.background_color}}else b=y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT,a=r.background_color;y.colorMask(!0,!0,!0,!0);
y.depthMask(!0);y.clearColor(a[0],a[1],a[2],a[3]);y.clear(b)}function c(a,b,c){y.bindBuffer(y.ARRAY_BUFFER,a.Hf);for(var d=0;d<b.length;d++){var e=b[d];y.enableVertexAttribArray(e.mf);y.vertexAttribPointer(e.mf,e.Kc,y.FLOAT,!1,0,e.vt+e.mv*c)}a.sd?(y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,a.sd),y.drawElements(a.mode,a.count,a.tl,0)):y.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],y.disableVertexAttribArray(e.mf)}function g(a){switch(a){case 0:return y.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 1:return y.TEXTURE_CUBE_MAP_POSITIVE_Y;
case 2:return y.TEXTURE_CUBE_MAP_POSITIVE_X;case 3:return y.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return y.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return y.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function f(a){var b=a.fi,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ka)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.fa)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":g=function(a,
b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Hq)};h=!0;break;case "u_view_proj_prev":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ix)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Rg)};h=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Oc)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.Wd)};h=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.Bo)};h=
!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};h=!0;break;case "u_view_max_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,f.La)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,f){a.uniform2f(b,f.Ea,f.La)};break;case "u_csm_center_dists":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.fo)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.Ck)};h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.ze)};break;case "u_waves_length":g=function(a,
b,c){a.uniform1f(b,c.Kf)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Fb)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.zc)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.mi)};break;case "u_horizon_color":g=function(a,
b,c){a.uniform3fv(b,c.ic)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.pc)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.Vd)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.wg)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.kf)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.gf)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.ff)};break;case "u_light_factors1":g=function(a,b,c){a.uniform4fv(b,c.hf)};break;case "u_light_factors2":g=function(a,b,c){a.uniform4fv(b,c.jf)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.ar)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.$q)};break;
case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.Qj)};break;case "u_height":g=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.H)};h=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.dc)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.cc)};h=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.Vb)};h=!0;break;
case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.Ub)};h=!0;break;case "u_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.We)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Yc)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Ae)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.Rd)};h=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Qd)};
h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Nd)};h=!0;break;case "u_anim_values":g=function(a,b,c,d){a.uniform1fv(b,d.pf)};h=!0;break;case "u_diffuse_color":g=function(a,b,c,d,e){a.uniform4fv(b,e.ob)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.Se)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e){a.uniform2fv(b,e.kd)};h=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.Ud)};h=!0;break;case "u_ambient":g=function(a,
b,c,d,e){a.uniform1f(b,e.Dc)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Cd)};h=!0;break;case "u_specular_alpha":g=function(a,b,c,d,e){a.uniform1f(b,e.Nj)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.nc)};h=!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Uh)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Ll)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ib)};h=
!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.pl)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.Zi)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Gc)};break;case "u_jitter_amp":g=function(a,b,c,d,e){a.uniform1f(b,e.hj)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e){a.uniform1f(b,e.ij)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=
function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.Cw)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.Dw)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,e.qq)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.zl)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.xl)};break;case "u_lamp_light_color_intensities":g=function(a,
b,c,d,e){a.uniform3fv(b,e.wl)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.yl)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.cp)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.$o)};h=!0;break;case "u_halo_rings_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.bp)};h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.ap)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.dp)};h=!0;
break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.ep)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.pd)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.Sc)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,e.Mh)};h=!0;break;case "u_color_id":g=function(a,b,c,d,e){a.uniform3fv(b,e.Vn)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.iB)};h=!0;break;case "u_diffuse_color_factor":g=
function(a,b,c,d,e){a.uniform1f(b,e.Re)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Fe)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Mq)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Kp)};h=!0;break;case "u_colormap0_uv_velocity":g=function(a,b,c,e,d){a.uniform2fv(b,d.Pd)};h=!0;break;case "u_normalmap0_uv_velocity":g=function(a,b,c,d,e){a.uniform2fv(b,e.sf[0])};h=!0;break;case "u_normalmap1_uv_velocity":g=function(a,
b,c,e,d){a.uniform2fv(b,d.sf[1])};h=!0;break;case "u_normalmap2_uv_velocity":g=function(a,b,c,d,e){a.uniform2fv(b,e.sf[2])};h=!0;break;case "u_normalmap3_uv_velocity":g=function(a,b,c,e,d){a.uniform2fv(b,d.sf[3])};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.rf[0])};h=!0;break;case "u_normalmap1_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.rf[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.rf[2])};h=!0;break;case "u_normalmap3_scale":g=
function(a,b,c,e,d){a.uniform2fv(b,d.rf[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,e,d){a.uniform2fv(b,d.Do)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.Co)};h=!0;break;case "u_foam_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.cl)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,
c,e,d){a.uniform3fv(b,d.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,e,d){a.uniform1f(b,d.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,e){a.uniform1f(b,e.Xp)};h=!0;break;case "u_p_cyclic":g=function(a,b,c,e,d){a.uniform1i(b,d.Tp)};h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.Zp)};h=!0;break;case "u_p_fade_in":g=function(a,
b,c,e,d){a.uniform1f(b,d.Up)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.Vp)};h=!0;break;case "u_p_size":g=function(a,b,c,e,d){a.uniform1f(b,d.Ul)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,e.Qp)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,e,d){a.uniform1f(b,d.Pp)};h=!0;break;case "u_p_nfactor":g=function(a,b,c,d,e){a.uniform1f(b,e.Tl)};h=!0;break;case "u_p_gravity":g=function(a,b,c,e,d){a.uniform1f(b,d.Wp)};h=!0;break;case "u_p_mass":g=
function(a,b,c,d,e){a.uniform1f(b,e.Yp)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,e,d){a.uniform2fv(b,d.$p)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e){a.uniform4fv(b,e.Rp)};h=!0;break;case "u_p_wind":g=function(a,b,c,e,d){a.uniform3fv(b,d.wj)};h=!0;break;case "u_texel_size":g=function(a,b,c,d,e){a.uniform2fv(b,e.ym)};h=!0;break;case "u_p_time":g=function(a,b,c,e,d){a.uniform1f(b,d.Lc.I.time)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.qr)};h=!0;break;
case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.Bj)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.pr)};h=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.tn)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yf[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yf[1])};h=!0;break;
case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yf[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.yf[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.Gp)};h=!0;break;case "u_refl_plane":g=function(a,b,c){a.uniform4fv(b,c.hb)};break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.Ej)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=
function(a,b,c){a.uniform1f(b,c.Ag)};break;case "u_ssao_blur_discard_value":g=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.zg)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.yg)};break;case "u_dof_dist":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,f){a.uniform1f(b,
f.dof_rear)};h=!0;break;case "u_glow_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.gg)};h=!0;break;case "u_glow_color":g=function(a,b,c){a.uniform3fv(b,c.wh)};break;case "u_draw_glow":g=function(a,b,c){a.uniform1f(b,c.Xk)};h=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};
break;default:g=null}g&&(g={name:f,il:g,mf:b[f]},h?c.push(g):(d.push(g),e[f]=g))}a.gr=c;a.Oh=d;a.Wl=e}var l=n("__config"),h=n("__debug"),k=n("__textures"),e=n("__util"),r=l.n,v=[1,1,1,1],m=[1,1,1,1],t=[0,0,0,1],s=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var y=null,d=new Uint8Array(4);a.Xb=function(a){var b=r.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);
a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);y=a};a.Zf=function(a){if(a.R){var e=a.h;y.bindFramebuffer(y.FRAMEBUFFER,e.Xd);if(a.sk){var k=e.cb;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,k.Bb,k.Ga,0)}y.viewport(0,0,e.width,e.height);b(a);a.sa?y.enable(y.BLEND):y.disable(y.BLEND);a.xb?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST);if(a.va){for(var e=a.h,k=a.l,m=0;m<k.length;m++){var p=k[m],l=p.k,s=l.Yb;y.useProgram(s.Cj);
p=p.Va;s.Oh.length||f(s);for(var s=s.Oh,x=s.length;x--;){var v=s[x];v.il(y,v.mf,a,p,l,e)}}a.va=!1}switch(a.type){case "SHADOW_CAST":y.enable(y.POLYGON_OFFSET_FILL);y.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);y.cullFace(y.BACK);break;case "MAIN_REFLECT":y.disable(y.POLYGON_OFFSET_FILL);y.cullFace(y.FRONT);break;default:y.disable(y.POLYGON_OFFSET_FILL),y.cullFace(y.BACK)}e=a.h;k=a.l;for(m=0;m<k.length;m++)if(p=k[m],p.R){var l=a,v=e,s=p.Va,q=p.k,p=q.Yb;y.useProgram(p.Cj);
for(var t=q.bb,x=q.pn,D=p.gr,V=D.length;V--;){var O=D[V];O.il(y,O.mf,l,s,q,v)}v=q.Wn;y.colorMask(v,v,v,v);y.depthMask(q.N);q.ma?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE);v=q.S;q=q.ac;D=p.fi;V=v.length|0;if(0!==V)if(1===V)y.activeTexture(y.TEXTURE0),y.bindTexture(v[0].Bb,v[0].Ga);else for(O=0;O<V;O++){var n=v[O],T=q[O];y.activeTexture(y.TEXTURE0+O);y.bindTexture(n.Bb,n.Ga);y.uniform1i(D[T],O)}if("SKY"==l.type){v=l;p=p.fi;q=v.h.cb.Ga;D=v.ho;for(V=0;6>V;V++)if(O=g(V),r.Rn)n=new Uint8Array([91.8,142.8,
.96*255,255]),y.bindTexture(y.TEXTURE_CUBE_MAP,q),y.texImage2D(O,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,n);else if(y.uniformMatrix4fv(p.u_cube_view_matrix,!1,D[V]),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,O,q,0),c(t,x,s.Fm),v.rj&&0!=V){var O=v,n=V,L=d;y.readPixels(191,191,1,1,y.RGBA,y.UNSIGNED_BYTE,L);255!=L[0]&&255!=L[1]&&255!=L[2]||y.readPixels(191,220,1,1,y.RGBA,y.UNSIGNED_BYTE,L);var T=L[0],P=L[1],L=L[2],T=T/255,P=P/255,L=L/255;1===n?(O.Gc[3]=T,O.Gc[7]=P,O.Gc[11]=L):(O.Gc[4*(n-
2)]=T,O.Gc[4*(n-2)+1]=P,O.Gc[4*(n-2)+2]=L)}l.kh+=6}else c(t,x,s.Fm),l.kh++}h.Qt("draw subscene: "+a.type);y.bindFramebuffer(y.FRAMEBUFFER,null)}};a.clear=b;a.mn=function(a){var b=a.pn;b.length=0;var c=a.bb;a=a.Yb;c&&a||e.ea("Incomplete batch");c=c.Jb;a=a.attributes;for(var d in a){var f=c[d];b.push({mf:a[d],vt:4*f.offset,mv:1<f.frames?4*f.length:0,Kc:f.Kc})}};a.ut=f;a.nx=function(a,b,c){var d,f,g;d||(d=1);f||(f=1);g||(g=new Uint8Array(4*d*f));g.length!=4*d*f&&e.ea("read_pixels(): Wrong storage");
y.bindFramebuffer(y.FRAMEBUFFER,a);y.readPixels(b,c,d,f,y.RGBA,y.UNSIGNED_BYTE,g);y.bindFramebuffer(y.FRAMEBUFFER,null);return g};a.My=function(a){var b=a.Yb;y.useProgram(b.Cj);b.Oh.length||f(b);b=b.Wl.u_cube_fog;b.il(y,b.mf,null,null,a,null)};a.sq=function(a,b){var c=y.createFramebuffer();y.bindFramebuffer(y.FRAMEBUFFER,c);if(a){var d=a,e=d.Ga,d=d.Bb==y.TEXTURE_CUBE_MAP?y.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Bb;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,d,e,0)}k.rp(b)?y.framebufferRenderbuffer(y.FRAMEBUFFER,
y.DEPTH_ATTACHMENT,y.RENDERBUFFER,b.Tg):k.Ch(b)&&(d=b,e=d.Ga,d=d.Bb,y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,d,e,0));h.Nt();y.bindFramebuffer(y.FRAMEBUFFER,null);return c};a.ux=function(a,b,c,d,e){null==a?(y.bindFramebuffer(y.FRAMEBUFFER,a),y.viewport(0,0,d,e),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT)):(k.Ch(b)&&y.deleteTexture(b.Ga),k.rp(c)?y.deleteRenderbuffer(c.Tg):k.Ch(c)&&y.deleteTexture(c.Ga),y.deleteFramebuffer(a))};a.TA=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,n){function b(a,b,d){var e=a.Sd;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.Sd,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function g(a,b){var c=a+b;if(w[c])return w[c];if(C){var d=C[b];if(!d)return null}else{d=y.Zv(a+b);if(!d)return null;d=A.fq.parse(d)}return w[c]=d}function f(a,b,c,e){function f(b){b=b.a;for(var c=0;c<b.length;c++){var k=b[c];switch(k.type){case "condition":a:for(var k=
k.a,x=0;x<k.length;x++){var t=k[x];switch(t.type){case "if":case "elif":var u=t.c;try{var y,w=l(u,h,r,!0);y=s.fq.parse(w)}catch(A){throw"Failed to process #"+t.type+" expression: "+u.join(" ");}if(y){f(t.group);break a}break;case "else":f(t.group);break;case "ifdef":t.name in h&&f(t.group);break;case "ifndef":t.name in h||f(t.group)}}break;case "include":k=g(d.shaders_dir,d.$x+k.file);f(k);break;case "var":case "export":case "import":break;case "define":x=k.name;h[x]=k.b;k.B&&(r[x]=k.B);break;case "error":throw"Shader error: #error "+
k.b.join(" ");case "line":break;case "pragma":p.push("#pragma "+k.name+" "+k.b.join(" "));break;case "undef":k=k.name;delete h[k];delete r[k];break;case "warning":m.warn("Shader warning: #warning "+k.b.join(" "));break;case "extension":p.push("#extension "+l(k.b,h,r,!1));break;case "#":break;case "node":v[k.name]=k.group.a;break;case "nodes_global":k=e;for(x=0;x<k.length;x++)if(t=k[x],u=v[t.id])for(var C=0,S=0;S<u.length;S++){var z=u[S];"node_param"==z.type&&(z=z.qualifier.join(" ")+" ","vert"==a?
z+=t.li[C]:"frag"==a&&(z+=t.B[C],null!==t.yj[C]&&(z+=" = "+t.yj[C])),z+=";",p.push(z),C++)}break;case "nodes_main":k=e;x={};for(t=0;t<k.length;t++)if(z=k[t],u=v[z.id]){var J=0,ja=0,O=0;x[t]={};for(C=0;C<u.length;C++)switch(S=u[C],S.type){case "node_in":var fa=z.C[J];if(null!==z.mp[J]){var aa=S.qualifier.join(" ")+" ",aa=aa+fa,aa=aa+(" = "+z.mp[J]),aa=aa+";";p.push(aa)}x[t][S.name]=fa;J++;break;case "node_out":fa=z.Pa[ja];aa=S.qualifier.join(" ")+" ";aa+=fa;aa+=";";p.push(aa);x[t][S.name]=fa;ja++;
break;case "node_param":"vert"==a?fa=z.li[O]:"frag"==a&&(fa=z.B[O]),x[t][S.name]=fa,O++}}for(t=0;t<k.length;t++)if(z=k[t],u=v[z.id])for(C=0;C<u.length;C++)if(S=u[C],"textline"==S.type){z=[];for(J=0;J<S.b.length;J++)ja=S.b[J],ja in x[t]?z.push(x[t][ja]):z.push(ja);p.push(l(z,h,r,!1))}break;case "textline":p.push(l(k.b,h,r,!1));break;default:throw"Unknown element type: "+k.type;}}}for(var p=[],h={},k=0;k<c.length;k++)h[c[k][0]]=[c[k][1]];for(k=0;k<e.length;k++)h["USE_NODE_"+e[k].id]=[1];var r={},v=
{};f(b);return p.join("\n")}function l(a,b,c,d){var e=[];h(a,b,c,d,e);return e.join(" ")}function h(a,b,c,d,e){for(var f=0;f<a.length;f++){var g=a[f];g in b?(g=b[g],0==g.length&&d?e.push(0):h(g,b,c,d,e)):e.push(g)}}function k(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);t.Rt(d,b,c);return d}function e(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return r(a);case 2:return"vec2("+r(a[0])+","+r(a[1])+")";case 3:return"vec3("+r(a[0])+","+r(a[1])+","+r(a[2])+")";case 4:return"vec4("+
r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+")";case 9:return"mat3("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+","+r(a[4])+","+r(a[5])+","+r(a[6])+","+r(a[7])+","+r(a[8])+")";case 16:return"mat4("+r(a[0])+","+r(a[1])+","+r(a[2])+","+r(a[3])+","+r(a[4])+","+r(a[5])+","+r(a[6])+","+r(a[7])+","+r(a[8])+","+r(a[9])+","+r(a[10])+","+r(a[11])+","+r(a[12])+","+r(a[13])+","+r(a[14])+","+r(a[15])+")";default:throw"Wrong glsl value dimension";}}function r(a){return a%1?String(a):String(a)+".0"}var v=n("__config"),
m=n("__print"),t=n("__debug"),s=n("__gpp_eval"),y=n("__assets");n("__util");var d=v.zb;if(b4w.module_check(v.zb.Gq))var C=n(v.zb.Gq),A=null;else C=null,A=n("__gpp_parser");var u={},w={},p=[],I=null;a.Xb=function(a){I=a};a.J=b;a.Qv=c;a.aB=function(a,b){for(var c=a.Sd,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Lx=function(a){a.Sd=[];for(var c="ALPHA ALPHA_CLIP BEND_CENTER_ONLY CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<c.length;d++){var f=c[d],g;switch(f){case "ALPHA":case "ALPHA_CLIP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=e(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_SRC":g="SHADOW_SRC_NONE";break;case "SHADOW_DST":g=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":g="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=v.n.precision;break;case "EPSILON":g="highp"==v.n.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:m.error("Unknown directive ("+a.ii+", "+a.rh+"): "+f)}b(a,f,g)}};a.MA=function(a){return a.ii};a.No=function(a){return a.rh};a.qw=function(a,d){for(var e=
d.Sd,f=0;f<e.length;f++){var g=e[f][0],p=e[f][1];c(a,g)&&b(a,g,p)}};a.Kv=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),e=u[c];if(e)return e;var p=a.rh,e=g(d.shaders_dir,a.ii),p=g(d.shaders_dir,p);if(!e||!p)return null;var h=a.Sd||[],r=f("vert",e,h,b),h=f("frag",p,h,b),e=I,l=k(e,c,r,e.VERTEX_SHADER),s=k(e,c,h,e.FRAGMENT_SHADER),p=e.createProgram();e.attachShader(p,l);e.attachShader(p,s);e.linkProgram(p);e.validateProgram(p);e.getProgramParameter(p,e.VALIDATE_STATUS)==e.Fz&&m.error("B4W Error - shader program is not valid",
c);t.St(p,c,l,s,r,h);r={Im:l,Ho:s,Cj:p,attributes:{},fi:{},Oh:[],Wl:{},gr:[],Xa:a};l=e.getProgramParameter(p,e.ACTIVE_ATTRIBUTES);for(h=0;h<l;h++)s=e.getActiveAttrib(p,h).name,r.attributes[s]=e.getAttribLocation(p,s);l=e.getProgramParameter(p,e.ACTIVE_UNIFORMS);for(h=0;h<l;h++)s=e.getActiveUniform(p,h).name.split("[0]").join(""),r.fi[s]=e.getUniformLocation(p,s);return u[c]=e=r};a.Ju=function(){return p};a.Lv=function(){return u};a.cleanup=function(){for(var a in u){var b=u[a];I.deleteProgram(b.Cj);
I.deleteShader(b.Im);I.deleteShader(b.Ho);delete u[a]}for(var c in w)delete w[c];for(var d in p)delete p[d]};a.kA=function(a){var b=a.Sd;m.log("Shader: "+a.ii+" "+a.rh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)m.log("  "+b[a][0],b[a][1])};a.u=e;a.Kn=function(a,b){return b in a.fi?!0:!1};a.bw=function(a){return(I.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,n){function b(a){return 65536<a.D?I.Mo()?!1:!0:!1}function c(a){return 0<a.Y.length?!0:!1}function g(a,b,d){if(!c(a))return a;d||u.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.D*(b||1)+", will use drawArrays","color: #aa0");b=a.Y;d=a.D;var e=a.A,g=a.r,p;for(p in e){var h=e[p],q=t(h,d);e[p]=f(b,h,q)}for(e=0;e<g.length;e++){var k=g[e];for(p in k)h=k[p],q=t(h,d),k[p]=f(b,h,q)}a.D=b.length;a.Y=new Uint16Array(0);return a}function f(a,b,c){if(0==
b.length)return new Float32Array(0);for(var e=new Float32Array(a.length*c),d=0;d<a.length;d++)for(var f=a[d],g=0;g<c;g++)e[c*d+g]=b[c*f+g];return e}function l(a,b){var c=a.Wc,d=a.Jb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function h(b,c){var d,e;switch(c){case a.Vg:case a.pi:d=G.TRIANGLES;e=G.STATIC_DRAW;break;case a.Qm:d=G.POINTS;e=G.STATIC_DRAW;break;case a.Pm:d=G.TRIANGLES;e=G.DYNAMIC_DRAW;break;case a.Dr:d=G.POINTS;e=G.DYNAMIC_DRAW;
break;case a.Er:d=G.LINES;e=G.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.gi=e}function k(a){a.Zd?(a.sd||(a.sd=G.createBuffer()),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,a.sd),G.bufferData(G.ELEMENT_ARRAY_BUFFER,a.Zd,a.gi),a.Oi=a.Zd.byteLength):a.Oi=0;a.Hf||(a.Hf=G.createBuffer());G.bindBuffer(G.ARRAY_BUFFER,a.Hf);G.bufferData(G.ARRAY_BUFFER,a.Wc,a.gi);a.lo=a.Wc.byteLength}function e(a){for(var b=p.mb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].Y.length;b.Y=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].D;b.D=c;var e=a[0],f;for(f in e.A){for(d=c=0;d<a.length;d++)c+=a[d].A[f].length;b.A[f]=new Float32Array(c)}for(f in e.r[0]){for(d=c=0;d<a.length;d++)c+=a[d].r[0][f].length;for(d=0;d<e.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][f]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){f=a[e];for(var g=f.Y,h=f.D,q=f.A,k=0;k<g.length;k++)b.Y[c+k]=g[k]+d;var c=c+g.length,m;for(m in q){var g=q[m],r=d*t(g,h);b.A[m].set(g,r)}for(k=0;k<f.r.length;k++){var q=f.r[k],l=b.r[k];for(m in q)g=
q[m],r=d*t(g,h),l[m].set(g,r)}d+=h}return b}function r(a,b,c,d,e,f){var h=p.mb("SUBMESH_"+a.name+"_"+b),k=a.submeshes[b],q=k.base_length,r=a.materials[b];h.D=q;if(v(c,"a_texcoord")){var l=null,s=a.materials[b];b=a.submeshes[b];if(s.texture_slots.length)switch(s=s.texture_slots[0],s.texture_coords){case "UV":s=a.uv_textures.indexOf(s.uv_layer);-1==s||0==s?l=new Float32Array(b.texcoord):1==s&&(l=new Float32Array(b.texcoord2));break;case "ORCO":for(var t=a.b4w_bounding_box,l=new Float32Array(2*b.base_length),
s=(t.max_x+t.min_x)/2,y=(t.max_z+t.min_z)/2,w=t.max_x-t.min_x,t=t.max_z-t.min_z,A=0,z=0;z<b.position.length;z+=3)l[A++]=(b.position[z]-s)/w+.5,l[A++]=(y-b.position[z+2])/t+.5}null===l&&(l=new Float32Array(b.texcoord));b=l}else b=new Float32Array(0);var J,l=k.group;if(v(c,"a_influence")&&d){s=new Float32Array(4*q);y=l.length/q;w=new Float32Array(y);for(t=0;t<y;t++)for(J in w[t]=-1,d)if(A=d[J],A.tr===t){w[t]=A.mh;break}z=3<y?y:4;d=new Float32Array(z);J=new Uint32Array(z);for(var t=new Float32Array(4),
A=new Float32Array(z),z=new Uint32Array(z),ja=new Float32Array(4),G=0;G<q;G++)d.set(A),J.set(z),t.set(ja),s.set(m(l,y,G,q,w,d,J,t),4*G)}else s=new Float32Array(0);J=s;d=e?p.ta(e):{};d.a_color={Ye:!0};d.a_color.src=v(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,kc:7}]:[];e={a_texcoord:b,a_influence:J};J=k.vertex_colors;b=k.color;l=a.name;s=[];for(y=0;y<J.length;y++)s.push(J[y].name);for(var fa in d)if(y=d[fa].src,y.length){for(t=w=0;t<y.length;t++)w+=p.Cf(y[t].kc);e[fa]=new Float32Array(w*
q);for(t=A=0;t<y.length;t++){var aa=y[t].name,z=y[t].kc,ja=p.vq(z),ba=s.indexOf(aa);if(-1==ba)throw'B4W Error: vertex color "'+aa+'" for mesh "'+l+'" not found.';var G=J[ba].mask,B=p.Cf(G);(z&G)!==z&&u.error("B4W Error: Wrong color extraction from "+aa+" to "+fa+".");for(var ea=aa=0;ea<ba;ea++)aa+=p.Cf(J[ea].mask);ba=aa*q;for(aa=0;aa<q;aa++)for(ea=0;3>ea;ea++)ja[ea]&&(e[fa][aa*w+(A+p.Yh(z,ea))]=b[ba+aa*B+p.Yh(G,ea)]);A+=B}}else e[fa]=new Float32Array(0);fa=a.uv_textures;d=k.texcoord;J=k.texcoord2;
b=a.name;if(f)for(var I in f){l=fa.indexOf(I);if(-1==l)throw'B4W Error: uv map "'+I+'" for mesh "'+b+'" not found';if(0==l)var W=new Float32Array(d);else 1==l&&(W=new Float32Array(J));e[f[I]]=W}h.A=e;h.Y=new Uint32Array(k.indices);f=k.position.length/q/3;W=(I=v(c,"a_normal")&&k.normal.length?!0:!1)&&v(c,"a_tangent")&&k.tangent.length?!0:!1;fa=I&&r.texture_slots.length&&v(c,"a_tangent")&&"ORCO"==r.texture_slots[0].texture_coords?!0:!1;for(e=0;e<f;e++){r={};d=new Float32Array(3*q);J=new Float32Array(I?
3*q:0);b=new Float32Array(W||fa?4*q:0);l=e*q*3;s=l+3*q;d.set(k.position.subarray(l,s),0);I&&(l=e*q*3,s=l+3*q,J.set(k.normal.subarray(l,s),0));if(W)l=e*q*4,s=l+4*q,b.set(k.tangent.subarray(l,s),0);else if(fa)for(l=J,s=b,y=q,u.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),w=0;w<y;w++)t=x,A=M,t[0]=l[3*w],t[1]=l[3*w+1],t[2]=l[3*w+2],H.cross(t,p.AXIS_Z,A),0==H.length(A)&&H.cross(t,p.AXIS_X,A),H.normalize(A,
A),s[4*w]=A[0],s[4*w+1]=A[1],s[4*w+2]=A[2],s[4*w+3]=1;else if(I&&v(c,"a_tangent"))for(b=new Float32Array(4*q),e=0;e<b.length;e++)b[e]=1;r.a_position=d;r.a_normal=J;r.a_tangent=b;h.r.push(r)}if(1<f){a=h.r[0];var r={},n;for(n in a)r[n]=new Float32Array(a[n]);h.r.push(r)}v(c,"a_polyindex")&&(g(h,1,!0),h.A.a_polyindex=C(h));return h}function v(a,b){return-1<a.indexOf(b)?!0:!1}function m(a,b,c,d,e,f,g,p){for(var h=!0,q=0;q<b;q++){var k=a[q*d+c];if(-1!==k){var m=e[q];-1!==m&&(f[q]=k,g[q]=m,h=!1)}}if(h)return p;
s(f,g,!1);for(q=a=0;4>q;q++)a+=f[q];if(.01>a)return p;for(q=0;4>q;q++)f[q]/=a;if(.01>Math.abs(f[0]-1))p[0]=g[0]+1;else for(q=0;4>q;q++)p[q]=g[q]+f[q];return p}function t(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function s(a,b,c){var d=a.length,e=d,f=!1;for(c=c?-1:1;1<e||f;){1<e&&(e=Math.floor(e/1.247330950103979));for(var f=!1,g=0;e+g<d;g++)0>c*(a[g]-a[g+e])&&(f=a[g],a[g]=a[g+
e],a[g+e]=f,f=b[g],b[g]=b[g+e],b[g+e]=f,f=!0)}}function y(a,b,c){var d=[],e=[];H.subtract(b,a,d);H.subtract(c,a,e);H.normalize(d,d);H.normalize(e,e);return Math.acos(H.dot(d,e))}function d(a,b,d){b||(b=[]);d=d?a.r[0].a_normal:a.r[0].a_position;if(c(a)){a=a.Y;for(var e=a.length/3,f=0;f<e;f++){var g=new Float32Array(9),p=a[3*f];g[0]=d[3*p];g[1]=d[3*p+1];g[2]=d[3*p+2];p=a[3*f+1];g[3]=d[3*p];g[4]=d[3*p+1];g[5]=d[3*p+2];p=a[3*f+2];g[6]=d[3*p];g[7]=d[3*p+1];g[8]=d[3*p+2];b[f]=g}}else for(f=0;f<d.length;f++)g=
new Float32Array(9),g[0]=d[9*f],g[1]=d[9*f+1],g[2]=d[9*f+2],g[3]=d[9*f+3],g[4]=d[9*f+4],g[5]=d[9*f+5],g[6]=d[9*f+6],g[7]=d[9*f+7],g[8]=d[9*f+8],b[f]=g;return b}function C(a){for(var b=new Float32Array(a.D),c=0;c<a.D;c++)b[c]=c%3;return b}function A(a,b,c){var d=H.dist(a,b);a=H.dist(a,c);b=H.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var u=n("__print"),w=n("__tsr"),p=n("__util"),I=n("__extensions"),H=n("vec3"),x=new Float32Array(3),M=new Float32Array(3),q=new Float32Array(3);a.ad=10;a.Ym=20;
a.Kz=30;a.pi=10;a.Qm=20;a.Pm=30;a.Dr=40;a.Er=50;a.Vg=a.pi;var G=null;a.Xb=function(a){G=a};a.mA=function(a){var b=_buffers[a];G.deleteBuffer(b.sd);G.deleteBuffer(b.Hf);delete _buffers[a]};a.xy=function(d,e,f,p){b(d)&&g(d);var q=d.Y,m=d.D,l=d.r,r={},s;for(s in d.A)s in p&&!p[s].Ye||(r[s]=d.A[s]);p={Zd:null,Wc:null,tl:0,count:0,Jb:{},mode:0,gi:0,Oi:0,lo:0,Hf:null,sd:null,bj:null};if(q.length)if(s=q.length,65536>=m)var x=new Uint16Array(q),v=G.UNSIGNED_SHORT;else x=new Uint32Array(q),v=G.UNSIGNED_INT;
else s=m,x=null;var y=0,w=l.length,u;for(u in l[0])var A=l[0][u],y=y+A.length*w;for(u in r)A=r[u],y+=A.length;u=new Float32Array(y);var y=0,w={},H;for(H in r){var z=r[H];if(A=z.length)u.set(z,y),w[H]={Sz:H,Kc:t(z,m),offset:y,frames:1,length:A},y+=A}r=l.length;for(H in l[0])if(z=l[0][H],A=z.length,z=t(z,m),A){w[H]={Kc:z,offset:y,frames:r,length:A};1<r&&(w[H+"_next"]={Kc:z,offset:y+A,frames:r,length:A});for(var J=0;J<r;J++)z=l[J][H],u.set(z,y),y+=A}p.count=s;p.Zd=x;p.Wc=u;p.tl=v;p.Jb=w;h(p,f);k(p);
e!=a.ad&&c(d)&&(p.bj={Pw:new Float32Array(q.length),Qw:new Float32Array(q.length),Tu:new Float32Array(q.length/3),type:e});return p};a.Aw=b;a.zw=c;a.vm=g;a.Oy=function(a,b,c){h(a,b);a.count=c.length;a.Zd=c;a.tl=c instanceof Uint16Array?G.UNSIGNED_SHORT:G.UNSIGNED_INT};a.Xj=function(a,b,c,d){var e=a.Wc,f=a.Jb,g=f[b];if(g){if(c&&g.Kc!=c)throw'Error: invalid num_comp for "'+b+'"';e.set(d,g.offset)}else e=e.length,g=new Float32Array(e+d.length),g.set(a.Wc),g.set(d,e),a.Wc=g,f[b]={Kc:c,offset:e};k(a)};
a.$u=l;a.nB=function(a){a.gi=G.STATIC_DRAW};a.Jw=function(a){a.gi=G.DYNAMIC_DRAW};a.Ty=k;a.Qn=function(a){a.sd&&G.deleteBuffer(a.sd);a.Hf&&G.deleteBuffer(a.Hf)};a.fp=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Yq=function(a,b){for(var c=0;c<a.r.length;c++){var d=a.r[c].a_position;w.Kg(d,b,d,0);d=a.r[c].a_normal;0<d.length&&w.Uj(d,b,d,0);d=a.r[c].a_tangent;0<d.length&&w.fr(d,b,d,0)}(c=a.A.au_center_pos)&&c.length&&w.Kg(c,b,c,0);return a};a.vy=function(a,b){var c=a.A.au_center_pos;if(c&&
c.length){var d=new Float32Array(c);w.Kg(d,b,d,0);for(var e=0;e<a.r.length;e++)for(var f=0;f<d.length;f++)a.r[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.uy=function(a,b){var c=a.D,d;for(d in b){var e=b[d].length;a.A[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var g=0;g<e;g++)a.A[d][f*e+g]=b[d][g]}};a.wy=e;a.Iw=function(a,b,c){if(!a.D)return p.mb("EMPTY");var d=c.length;65536<a.D*d&&!I.Mo()&&g(a,d);var e=a.Y,f=a.D,h=a.A;a=a.r;
for(var q in b){var k=b[q].length,m=k*f;h[q]=new Float32Array(m);for(var l=0;l<f;l++)for(m=0;m<k;m++)h[q][l*k+m]=b[q][m]}b=p.mb("CLONE_"+d+"_SUBMESHES");b.D=f*d;b.Y=new Uint32Array(e.length*d);for(l=0;l<d;l++)for(k=e.length*l,q=f*l,m=0;m<e.length;m++)b.Y[k+m]=e[m]+q;for(var r in h)for(e=h[r],m=e.length*d,k=t(e,f),b.A[r]=new Float32Array(m),l=0;l<d;l++)q=f*k*l,b.A[r].set(e,q);for(r in a[0])for(l=0;l<a.length;l++)for(e=a[l][r],m=e.length*d,k=t(e,f),b.r[l]=b.r[l]||{},b.r[l][r]=new Float32Array(m),m=
0;m<d;m++)switch(h=c[m],q=f*k*m,r){case "a_position":w.Kg(e,h,b.r[l][r],q);break;case "a_normal":w.Uj(e,h,b.r[l][r],q);break;case "a_tangent":w.fr(e,h,b.r[l][r],q);break;default:throw"Wrong attribute name: "+r;}return b};a.Ao=r;a.cv=function(a){var b=a.D,c=a.r[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.Y.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],
d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=p.mb("HALO");c.r=[];c.r[0]={};c.D=4*b;c.r[0].a_position=d;c.A.a_halo_bb_vertex=e;c.Y=a;return c};a.kw=v;a.dv=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var f=r(a,d,b,null,null,null);
f.D&&c.push(f)}return 0==c.length?p.mb("EMPTY"):1==c.length?c[0]:e(c)};a.Ny=function(a,b,c){for(var d=a.Zd,e=l(a,"a_position"),f=a.bj,g=f.Pw,h=f.Qw,f=f.Tu,q=d,k=q.length/3,m=0;m<k;m++){var r=q[3*m],s=q[3*m+1],x=q[3*m+2],t=e[3*r+1],v=e[3*r+2],z=e[3*s+1],J=e[3*s+2],y=e[3*x+1],w=e[3*x+2];g[3*m]=(e[3*r]+e[3*s]+e[3*x])/3;g[3*m+1]=(t+z+y)/3;g[3*m+2]=(v+J+w)/3}p.he(g,b,h);b=g.length/3;for(e=0;e<b;e++)h=g[3*e]-c[0],q=g[3*e+1]-c[1],k=g[3*e+2]-c[2],f[e]=h*h+q*q+k*k;c=d;d=f.length;if(!(2>d))for(g=d,e=!1;1<g||
e;)for(1<g&&(g=Math.floor(g/1.247330950103979)),e=!1,b=0;g+b<d;b++)0>f[b]-f[b+g]&&(e=f[b],f[b]=f[b+g],f[b+g]=e,e=c,h=b,q=b+g,k=e[3*h],m=e[3*h+1],r=e[3*h+2],e[3*h]=e[3*q],e[3*h+1]=e[3*q+1],e[3*h+2]=e[3*q+2],e[3*q]=k,e[3*q+1]=m,e[3*q+2]=r,e=!0);d=c;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,a.sd);G.bufferData(G.ELEMENT_ARRAY_BUFFER,d,G.DYNAMIC_DRAW)};a.hy=s;a.Cn=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],g=Array(3),p=Array(3),h=Array(3),q=0;q<e;q++){for(var k=a[3*q],m=a[3*q+1],l=a[3*q+2],r=0;3>
r;r++)g[r]=b[3*k+r],p[r]=b[3*m+r],h[r]=b[3*l+r];if(c)var r=y(g,p,h),s=y(p,h,g),x=Math.PI-r-s;else x=s=r=1;var z=f,J;J=g;var t=h,v=[],fa=[],w=[];H.subtract(p,J,v);H.subtract(t,J,fa);H.cross(v,fa,w);H.normalize(w,w);J=w;for(t=0;3>t;t++)v=3*m+t,fa=3*l+t,z[3*k+t]=r*J[t],z[v]=s*J[t],z[fa]=x*J[t]}if(c)for(var u in c)for(q=c[u],a=0;3>a;a++){b=3*q[0]+a;for(e=1;e<q.length;e++)g=3*q[e]+a,f[b]+=f[g];for(e=1;e<q.length;e++)g=3*q[e]+a,f[g]=f[b]}for(q=0;q<d;q++){c=q;u=f;a=new Float32Array(3);for(b=0;3>b;b++)e=
3*c+b,a[b]=u[e];H.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,u[e]=a[b]}return f};a.En=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var g=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[g]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],g=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),g in d&&d[g].push(b);return d};a.jl=function(a,b,c,e){var f=d(a,null,!1);if(c)var g=d(a,null,!0);var h=f.length,k=new Float32Array(h),m=x,l=M;for(a=0;a<h;a++){var r=f[a];m.set(r.subarray(0,3));l.set(r.subarray(3,6));
q.set(r.subarray(6));k[a]=Math.sqrt(A(m,l,q))}m=new Float32Array(h);m[0]=k[0];for(a=1;a<h;a++)m[a]=m[a-1]+k[a];h=m[k.length-1];k=[];for(a=0;a<b;a++){var l=h*p.lc(e),l=p.Bi(m,l,0,m.length-1),r=c?g[l]:f[l],l=a,s=r,t=e,r=void 0,r=new Float32Array(3),v=s[0],y=s[1],w=s[2],z=s[3],J=s[4],u=s[5],H=s[6],fa=s[7],aa=s[8],s=p.lc(t),t=p.lc(t);1<s+t&&(s=1-s,t=1-t);var ba=1-s-t,y=ba*y+s*J+t*fa,w=ba*w+s*u+t*aa;r[0]=ba*v+s*z+t*H;r[1]=y;r[2]=w;k[l]=r}return k};a.rA=d;a.zo=C;a.JB=A;a.Uv=function(a,b,c,d){var e=b[0]-
a[0],f=c[0]-a[0],g=b[1]-a[1],p=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=g*a-b*p;d[1]=f*b-e*a;d[2]=e*p-g*f;return d};a.Cx=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,n){function b(a){a={type:a,jd:0,jw:[0,0],e:new Float32Array(3),quat:new Float32Array(4),Vc:new Float32Array(8),H:new Float32Array(16),np:new Float32Array(16),Wa:new Float32Array(3),Yd:new Float32Array(3),or:!1,da:0,Sj:0,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Te:null,ir:!1,Hc:0,Wf:0,Ab:!1,qb:null,Aa:null,Oa:null,so:!0,M:null,Xi:null,th:0,nh:0,el:0,Fh:0,nf:0,gq:"",ak:!1,Mb:!1,sb:!1,Nb:!1,Wb:!1,Lb:!1,wc:!1,Ne:!1,Xc:!1,Pi:!1,md:!1,ya:!1,Xf:!1,xh:!1,kj:!1,Mc:!1,
vj:!1,fj:!1,is_visible:!1,ni:0,Yc:0,Ae:0,Rd:0,Qd:0,Nd:0,ud:"",yb:null,Ai:!1,dd:!1,bh:"",xk:!1,We:0,time:0,Fm:0,qr:0,max_bones:0,sh:!1,ji:!1,Bh:!1,Jd:!1,Id:1,pk:0,ok:1,Vj:new Int8Array([-1,-1]),Mj:[],Ep:[],Iq:[],Vb:null,Ub:null,dc:null,cc:null,gc:null,hq:null,pf:null,Gh:null,Eb:null,wk:null,uk:null,vk:null,Ia:null,tc:null,kb:null,Le:null,Me:null,scale:1,ce:1E4};A.identity(a.quat);d.identity(a.Vc);w.identity(a.H);w.identity(a.np);return a}function c(a,b,c,d){var e=a.d.B,f;for(f in e){var g=a.name+"_"+
f;f in d||(d[f]=b.length,b.push(e[f][0]));c.push(g,d[f])}}var g=n("__animation"),f=n("__batch"),l=n("__boundings"),h=n("__camera"),k=n("__config"),e=n("__constraints"),r=n("__curve"),v=n("__lights"),m=n("__nla"),t=n("__particles");n("__print");var s=n("__scenes"),y=n("__transform"),d=n("__tsr"),C=n("__util"),A=n("quat"),u=n("vec3"),w=n("mat4"),p=k.n,I=0,H=new Float32Array(4);a.Mi=b;a.Em=function(a,k){var q;q=a.parent;if(!(q=q&&q.Rs)){if(!(q="ARMATURE"===a.type||"CAMERA"===a.type)&&(q="MESH"===a.type)){var A=
g.dj(a),D=a.b4w_do_not_batch,n=a.b4w_dynamic_geometry,O=a.b4w_collision,U=a.b4w_vehicle,T=a.b4w_floating;q=a.b4w_character;var L=a.b4w_billboard,P=t.mw(a),R=m.gp(a);if(!(A=A||D||n||O||U||T))a:{A=a.data;for(D=0;D<A.materials.length;D++)if("LENS_FLARES"===A.materials[D].name){A=!0;break a}A=!1}q=A||P||q||L||R}!q&&(q="EMPTY"===a.type)&&(q=g.dj(a),L=m.gp(a),q=q||L)}q=q?!0:!1;a.Rs=q;a.d=b("MESH"===a.type?q?"DYNAMIC":"STATIC":a.type);a.$a=null;a.Hd=[];a.Db||(a.Db=null);q=a.d;P=a.location;L=a.scale[0];C.kx(a.rotation_quaternion,
H);y.set_translation(a,P);y.set_rotation(a,H);y.set_scale(a,L);switch(a.type){case "ARMATURE":P=a.pose.bones;for(L=0;L<P.length;L++)R=P[L],A=R.bone,D=new Float32Array(A.matrix_local),n=new Float32Array(16),w.invert(D,n),O=new Float32Array(R.matrix_basis),U=new Float32Array(3),u.subtract(A.tail_local,A.head_local,U),C.hz(U,n,U),R.Vs=U,R.Os=[R].concat(R.parent_recursive),R.bn=d.Go(D,d.create()),R.an=d.Go(O,d.create()),R.lk=d.create(),R.ti=!1;P=g.Et(a);q.gc=P;P=g.Dn(a,P);a.b4w_animation_mixing?(q.Vb=
new Float32Array(P.la),q.Ub=new Float32Array(P.la),q.dc=new Float32Array(P.e),q.cc=new Float32Array(P.e)):(q.Vb=P.la,q.Ub=P.la,q.dc=P.e,q.cc=P.e);q.hq=P;q.We=0;q.Jd=a.b4w_animation_mixing;break;case "MESH":q.Mc=p.all_objs_selectable||a.b4w_selectable;q.vj=a.b4w_selectable;q.dd=a.b4w_billboard;q.bh="BASIC";q.xk="SPHERICAL"==a.b4w_billboard_geometry;q.Xi={ew:a.b4w_glow_settings.glow_duration,gw:a.b4w_glow_settings.glow_period,hw:a.b4w_glow_settings.glow_relapses};q.Mc&&(a.Zm=C.pv(I),I++);if("MESH"!=
a.type)throw"Wrong object type: "+a.name;a.d.ji=a.data.b4w_vertex_anim.length?!0:!1;if(L=g.get_first_armature_object(a)){P=a.d;R=a.data.vertex_groups;if(R.length){A=L.data.bones;D=L.pose.bones;n=0;O={};for(U=0;U<A.length;U++){var T=A[U].name,X=C.keysearch("name",T,R);if(X){var N=C.nl(D,"name",T);O[T]={An:U,mh:n++,Xl:N,tr:X.index}}}P.gc=O;P.max_bones=n;P.Bh=!0}P=a.d.gc;P=g.Dn(L,P);L.b4w_animation_mixing?(q.Vb=new Float32Array(P.la),q.Ub=new Float32Array(P.la),q.dc=new Float32Array(P.e),q.cc=new Float32Array(P.e)):
(q.Vb=P.la,q.Ub=P.la,q.dc=P.e,q.cc=P.e);q.hq=P;q.We=0}if(g.ql(a)){L=a.d;P=a.data.materials;R=[];A=[];for(D=0;D<P.length;D++)if((n=P[D].node_tree)&&n.animation_data)for(U=n.animation_data,n={},(O=U.action)&&c(O,R,A,n),U=U.nla_tracks,T=0;T<U.length;T++)for(X=U[T].strips,N=0;N<U[T].strips.length;N++)O=X[N].action,c(O,R,A,n);L.pf=R;L.Gh=A}a.P=[];q.Mb=a.b4w_shadow_cast;q.sb=a.b4w_shadow_receive;q.Nb=a.b4w_shadow_cast_only&&q.Mb;q.Wb=a.b4w_reflexible;q.Lb=a.b4w_reflexible_only&&q.Wb;q.wc=a.b4w_reflective;
q.Ne=a.b4w_caustics;q.Xc=a.b4w_wind_bending;q.ni=a.b4w_wind_bending_angle;L=f.oz(a.b4w_wind_bending_angle,f.wt(a.data.b4w_bounding_box),a.scale[0]);q.Yc=L;q.Ae=a.b4w_wind_bending_freq;q.Rd=a.b4w_detail_bending_freq;q.Qd=a.b4w_detail_bending_amp;q.Nd=a.b4w_branch_bending_amp;q.xh=!1;q.ud=a.b4w_main_bend_stiffness_col;L=a.b4w_detail_bend_colors;q.yb={};q.yb.yp=L.leaves_stiffness_col;q.yb.xp=L.leaves_phase_col;q.yb.Op=L.overall_stiffness_col;q.Xf=a.b4w_do_not_cull;q.Pi=a.b4w_disable_fogging;q.md=a.b4w_dynamic_geometry;
if("MESH"!==a.type)throw"Wrong object";L=a.data.materials[0];q.th=L.physics.friction;q.nh=L.physics.elasticity;q.Fh=0;q.ce=1E4;q.nf=a.b4w_lod_transition;q.kj=!0;break;case "CAMERA":h.Kt(a);h.tt(a);break;case "LAMP":v.Ew(a);break;case "CURVE":if(L=r.zu(a))a.Us=L;break;case "EMPTY":q.Eb=l.Zc(),L=l.oi(),q.tc=L}if(!k&&(a.parent&&"OBJECT"==a.parent_type?(P=q.e,R=q.quat,L=q.scale,e.kn(a,a.parent,P,R,L)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(P=q.e,R=q.quat,e.jn(a,a.parent,a.parent_bone,
P,R)):a.Db&&a.Db.b4w_group_relative?(L=d.Vf(q.e,q.scale,q.quat),e.at(a,a.Db,L)):a.Db&&!a.Db.b4w_group_relative&&(y.v(a),R=q.H,w.multiply(a.Db.d.H,R,R),P=C.of(R),L=C.mj(R),R=C.matrix_to_quat(R),y.set_translation(a,P),y.set_rotation(a,R),y.set_scale(a,L)),L=a.dupli_group))for(P=L.objects,L=0;L<P.length;L++)P[L].Db=a;a.field&&(q.el=a.field.strength,s.lr(a));q.ak=a.game.use_collision_compound;q.gq=a.game.physics_type;y.v(a)};a.Wy=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&
"CAMERA"!=c.d.type||y.v(c);c.b4w_use_default_animation&&g.dj(c)&&(g.apply_def(c),g.play(c,null,g.SLOT_ALL))}};a.cleanup=function(){I=0}};b4w.module.__particles=function(a,n){function b(){throw"_rand() undefined";}function c(a,b,c,f,g,h,k){var p=a.I.Wk,l=a.I.Ic,r=a.I.time;a=a.I.jq;for(var v=b?4:1,n=0;n<p.length;n+=v){var q=p[n];if(q>a&&q<=r)for(q=0;8>q;q++)l[8*n+q]=g[q];for(q=0;8>q;q++)m[q]=l[8*n+q];q=t;q[0]=c[3*n];q[1]=c[3*n+1];q[2]=c[3*n+2];e.ei(q,m,q);h[3*n]=q[0];h[3*n+1]=q[1];h[3*n+2]=q[2];var G=t;G[0]=f[3*n];G[1]=f[3*n+1];G[2]=f[3*n+2];e.Tj(G,m,G);k[3*n]=G[0];k[3*n+1]=G[1];k[3*n+2]=G[2];if(b)for(q=1;4>q;q++)h[3*(n+q)]=h[3*n],h[3*
(n+q)+1]=h[3*n+1],h[3*(n+q)+2]=h[3*n+2],k[3*(n+q)]=G[0],k[3*(n+q)+1]=G[1],k[3*(n+q)+2]=G[2]}}function g(a){a?(k.qy(a),b=function(){return k.mx()}):b=function(){return Math.random()}}var f=n("__config"),l=n("__geometry"),h=n("__scenes"),k=n("__util"),e=n("__tsr"),r=n("vec3"),v=f.Ld,m=new Float32Array(8),t=new Float32Array(3);a.ig=function(a){return 0<a.particle_systems.length?!0:!1};a.aj=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.OA=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.mw=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.uv=function(a,f,d,h){d.I=d.I||{};var m=l.dv(f),t=d.settings.count,w=d.settings.frame_start/v.wa,p=d.settings.frame_end/v.wa,I=d.settings.lifetime/v.wa,H=d.settings.lifetime_random,x=d.settings.emit_from,n=
d.settings.factor_random,q=d.settings.angular_velocity_mode,G=d.settings.angular_velocity_factor,D=d.settings.b4w_randomize_emission,V=d.settings.b4w_cyclic;g(d.seed);var O=d.I.ez="WORLD"==d.settings.b4w_coordinate_system?!0:!1;d.I.frame=0;if(f=!a.af){var U;U=[];for(var T=0;T<t;T++)U.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);U=new Float32Array(U);for(var T=[],L=0;L<t;L++)T.push(4*L,4*L+2,4*L+1,4*L,4*L+3,4*L+2);T=new Uint16Array(T)}switch(x){case "VERT":for(var L=m.r[0].a_position,m=m.r[0].a_normal,P=L.length/
3,x=[],R=0;R<t;R++){var X=Math.round((P-1)*b());x.push(X);f&&(x.push(X),x.push(X),x.push(X))}P=[];for(R=0;R<x.length;R++)P.push(L[3*x[R]]),P.push(L[3*x[R]+1]),P.push(L[3*x[R]+2]);L=new Float32Array(P);P=[];for(R=0;R<x.length;R++)P.push(m[3*x[R]]),P.push(m[3*x[R]+1]),P.push(m[3*x[R]+2]);x=new Float32Array(P);break;case "FACE":L=[];x=[];R=[];k.cj(0,R);P=l.jl(m,t,!1,R);k.cj(0,R);m=l.jl(m,t,!0,R);for(R=0;R<P.length;R++)L.push(P[R][0],P[R][1],P[R][2]),f&&(L.push(P[R][0],P[R][1],P[R][2]),L.push(P[R][0],
P[R][1],P[R][2]),L.push(P[R][0],P[R][1],P[R][2])),x.push(m[R][0],m[R][1],m[R][2]),f&&(x.push(m[R][0],m[R][1],m[R][2]),x.push(m[R][0],m[R][1],m[R][2]),x.push(m[R][0],m[R][1],m[R][2]));L=new Float32Array(L);x=new Float32Array(x);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}x=[L,x];m=x[0];x=x[1];d.I.ex=new Float32Array(m);d.I.Xw=new Float32Array(x);d.I.fx=new Float32Array(m.length);d.I.Yw=new Float32Array(x.length);d.I.time=0;d.I.jq=
-1;L=[];p=(p-w)/t;for(P=0;P<t;P++)R=D?p*P+10*p*(.5-b()):p*P,V||(R+=w),L.push(R),f&&(L.push(R),L.push(R),L.push(R));w=new Float32Array(L);d.I.Wk=new Float32Array(w);d.I.mo=new Float32Array(w);d.I.Ic=new Float32Array(8*w.length);for(D=0;D<8*w.length;D++)for(V=0;8>V;V++)d.I.Ic[8*D+V]=h[V];O?c(d,f,m,x,h,m,x):(e.Kg(m,h,m,0),e.Uj(x,h,x,0));d=[];h=I*H;for(H=0;H<t;H++)O=h*b(),d.push(I-O),f&&(d.push(I-O),d.push(I-O),d.push(I-O));I=new Float32Array(d);d=[];for(h=0;h<t;h++){H=[b()-.5,b()-.5,b()-.5];r.normalize(H,
H);d.push(n*H[0]);d.push(n*H[1]);d.push(n*H[2]);switch(q){case "NONE":d.push(0);break;case "SPIN":case "VELOCITY":d.push(G);break;case "RAND":d.push(2*G*(b()-.5));break;default:throw"Undefined velocity factor";}if(f)for(H=d.slice(-4),O=0;12>O;O++)d.push(H[O%4])}t=new Float32Array(d);n=k.mb("EMITTER_PARTICLES");q=k.hd();q.a_position=m;q.a_normal=x;n.r[0]=q;f?n.Y=T:(a.ld=l.Qm,n.Y=new Uint16Array(0));n.D=m.length/3;n.A.a_p_delay=w;n.A.a_p_lifetime=I;n.A.a_p_vels=t;f&&(n.A.a_p_bb_vertex=U);return n};
a.Sy=function(a){for(var b=a.P,d=0;d<b.length;d++){var f=b[d],g=b[d].Lc;if(g){var h=f.bb,k=g.I.fx,p=g.I.Yw,m=g.I.ex,r=g.I.Xw;g.I.ez?c(g,!f.af,m,r,a.d.Vc,k,p):(f=r,g=a.d.Vc,r=p,e.Kg(m,g,k,0),e.Uj(f,g,r,0));l.Jw(h);l.Xj(h,"a_position",3,k);l.Xj(h,"a_normal",3,p)}}};a.Mx=function(a,b,c){var e=b.settings.lifetime/v.wa,f=b.settings.normal_factor,g=9.81*b.settings.effector_weights.gravity,k=b.settings.effector_weights.wind,p=b.settings.mass,m=b.settings.b4w_fade_in/v.wa,l=b.settings.b4w_fade_out/v.wa,r=
b.settings.b4w_cyclic;a.Xp=b.settings.frame_end/v.wa-b.settings.frame_start/v.wa;a.Tp=r?1:0;a.Tl=f;a.Wp=g;f=h.dw();a.wj[0]=f[0]*k;a.wj[1]=f[1]*k;a.wj[2]=f[2]*k;a.Zp=e;a.Yp=p;a.Up=m;a.Vp=l;a.af?(e=c.halo.size,k=c.halo.hardness,30>k?(k=.5,p=.9):40>k?(k=.1,p=1):50>k?(k=0,p=.8):(k=0,p=.5)):(e=b.settings.particle_size,p=k=1);a.Ul=e;a.Qp=k;a.Pp=p;e=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(e[0]&&e[0].use_map_size&&e[0].texture&&"BLEND"==e[0].texture.type&&e[0].texture.use_color_ramp){e=e[0].texture.color_ramp.elements;
k=Math.min(2*e.length,b.length);for(p=0;p<k;p+=2)m=e[p/2],b[p]=m.position,b[p+1]=(m.color[0]+m.color[1]+m.color[2])/3;a.aq=e.length}a.$p.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){e=b[0].texture.color_ramp.elements;k=Math.min(4*e.length,c.length);for(p=0;p<k;p+=4)m=e[p/4],c[p]=m.position,c[p+1]=m.color[0],c[p+2]=m.color[1],c[p+3]=m.color[2];a.Sp=e.length}a.Rp.set(c)};
a.Tx=function(a,b){a.I.jq=a.I.time;a.I.time=b};a.gx=function(a){for(var b=a.D,c=a.r[0].a_position,e=a.A.a_texcoord,f=[],g=[],h=0;h<b;h++)g.push(c[3*h]),g.push(c[3*h+1]),f.push(c[3*h+2]);f=new Float32Array(f);g=new Float32Array(g);a.A.a_lf_dist=f;a.A.a_lf_bb_vertex=g;a.A.a_texcoord=e;return a};a.set_size=function(a,b,c){a=a.P;for(var e=0;e<a.length;e++){var f=a[e],g=f.Lc;g&&g.name==b&&(f.Ul=c)}};a.set_normal_factor=function(a,b,c){a=a.P;for(var e=0;e<a.length;e++){var f=a[e],g=f.Lc;g&&g.name==b&&(f.Tl=
c)}};a.set_factor=function(a,b,c){a=a.P;for(var e=0;e<a.length;e++){var f=a[e],g=f.Lc;if(g&&g.name==b){var h=g.I.Wk;if(1==c)g=h;else if(0==c)for(var p=!f.af,k=p?4:1,g=g.I.mo,m=0;m<g.length;m+=k)g[m]=1E4,p&&(g[m+1]=g[m],g[m+2]=g[m],g[m+3]=g[m]);else for(var r=1/c,g=g.I.mo,k=(p=!f.af)?4:1,t=0,m=0;m<g.length;m+=k)m>=t?(g[m]=h[m],t+=r):g[m]=1E4,p&&(g[m+1]=g[m],g[m+2]=g[m],g[m+3]=g[m]);l.Xj(f.bb,"a_p_delay",1,g)}}};a.$y=function(a,b,c){a=a.particle_systems;for(var e=0;e<a.length;e++){var f=a[e];if("EMITTER"==
f.settings.type)for(var g=f.I.Wk,e=0;e<8*g.length;e++)f.I.Ic[8*e]=b[0],f.I.Ic[8*e+1]=b[1],f.I.Ic[8*e+2]=b[2],f.I.Ic[8*e+3]=b[3],f.I.Ic[8*e+4]=c[0],f.I.Ic[8*e+5]=c[1],f.I.Ic[8*e+6]=c[2],f.I.Ic[8*e+7]=c[3]}}};b4w.module.__primitives=function(a,n){function b(a,b,c,f){for(var g=[],k=[],l=[],d=[],C=2*c/(a-1),A=2*f/(b-1),u=0;u<a;u++)for(var w=-c+u*C,p=0;p<b;p++)if(k.push(w,0,-f+p*A),l.push(0,1,0),d.push(u/(a-1),p/(b-1)),u&&p){var n=u*b+p,H=n-1,x=(u-1)*b+p,M=x-1;g.push(n,H,x);g.push(H,M,x)}a=h.hd();a.a_position=new Float32Array(k);a.a_normal=new Float32Array(l);l=h.mb("GRID_PLANE");l.r[0]=a;l.A.a_texcoord=new Float32Array(d);l.Y=new Uint32Array(g);l.D=k.length/3;return l}function c(a){var b=a.length;if(b%4)throw"Wrong array";
for(var c=[],g=[],k=0;k<b;k+=4){var l=a[k+1],y=a[k+2],d=a[k+3];f(a[k],g);f(l,g);f(y,g);f(d,g);c.push(k,k+1,k+2);c.push(k,k+2,k+3)}a=h.hd();a.a_position=new Float32Array(g);b=h.mb("FROM_QUADS");b.r[0]=a;b.Y=new Uint32Array(c);b.D=g.length/3;return b}function g(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function f(a,b){b.push(a[0],a[1],a[2])}var l=n("__geometry"),h=n("__util"),k=n("__config").n;a.DA=function(a){for(var b=h.mb("LINE"),c=[],f=0;f<2*a;f++)c.push(f);f=h.hd();f.a_point=new Float32Array(c);
b.r[0]=f;b.Y=new Uint32Array(c);b.D=2*a;return b};a.EA=function(a,c){var f=b(2,2,a,c);f.name="PLANE";return f};a.CA=b;a.yv=function(a,b,c){function f(a,b){return 1==a%2&&(0==b||b==d-1)||1==b%2&&(0==a||a==y-1)?!0:!1}var g=c/=Math.pow(2,a-1),s=c,y=b+1,d=b+1;b=[];c=[];for(var C=0,A=0,u=-1,w=[],p=0;p<a;p++){for(var n=2*g/(y-1),H=2*s/(d-1),x=[],M=[],q=0,G=0;G<y;G++){for(var D=-g+G*n,V=[],O=0;O<d;O++){var U=-s+O*H;if(D>-C&&D<C&&U>-A&&U<A)V.push(-1),q++;else{for(var T=null,L=0;L<w.length;L+=3)if(D==w[L]&&
U==w[L+1]){T=w[L+2];break}L=null!==T?T:u+1;f(G,O)?(V.push(-2),q++):(null==T&&(0==O||O==d-1||0==G||G==y-1?(T=p==a-1?n:2*n,x.push(D,U,L)):T=n,c.push(D,T,U),u++),V.push(L));if(G&&O)if(1==G)if(f(G-1,O)){if(1<O){var U=L-1,T=M[G-1][O+1],P=T-1;b.push(L,U,P)}else T=M[G-1][O+1],P=T-1;b.push(L,P,T)}else f(G,O)||(U=L-1,T=M[G-1][O],b.push(L,U,T));else if(G==y-1){if(!f(G,O))if(O==d-1)U=L-1,T=M[G-1][O-1],P=M[G-2][O],b.push(L,U,T),b.push(L,T,P);else{var U=L-1,T=M[G-1][O],P=T-1,R=T+1;b.push(L,U,P);b.push(L,P,T);
b.push(L,T,R);2==O&&(R=M[G-2][O-2],b.push(U,R,P))}}else 1==O?f(G,O-1)?(U=M[G-1][O],T=M[G-1][O-1],b.push(L,T,U)):(U=V[O-1],T=M[G-1][O],P=M[G-2][O-1],b.push(L,U,T),b.push(U,P,T)):O==d-1?f(G,O)||(U=V[O-1],T=M[G-1][O-1],P=M[G-2][O],b.push(L,U,T),b.push(L,T,P)):-1!=M[G-1][O]&&-1!=M[G-1][O-1]&&-1!=V[O-1]?(U=V[O-1],T=M[G-1][O],P=M[G-1][O-1],b.push(L,U,T),b.push(U,P,T),O==d-2&&f(G,O+1)&&(R=M[G-1][O+1],b.push(L,T,R))):O==d-2&&f(G,O+1)&&(T=M[G-1][O],R=M[G-1][O+1],b.push(L,T,R))}}M.push(V)}w=x;C=g;A=s;g*=2;
s*=2}2E4>C&&(a=-(2*C)/(y-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-C,a,-A),c.push(-C,a,A),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(C,a,-A),c.push(C,a,A),L=u+1,b.push(L+3,L+2,L+1,L+2,L+0,L+1,L+6,L+4,L+2,L+4,L+0,L+2,L+5,L+7,L+1,L+7,L+3,L+1,L+5,L+4,L+7,L+7,L+4,L+6));a=h.hd();a.a_position=new Float32Array(c);g=h.mb("multigrid_plane");g.r[0]=a;g.Y=new Uint32Array(b);g.D=c.length/3;k.ek&&(l.vm(g,1,!0),a.a_polyindex=l.zo(g));return g};a.BA=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],g=[],k=0;k<b;k+=3){var l=a[k+1],y=a[k+2];f(a[k],g);f(l,g);f(y,g);c.push(k,k+1,k+2)}a=h.hd();a.a_position=new Float32Array(g);b=h.mb("FROM_TRIANGLES");b.r[0]=a;b.Y=new Uint32Array(c);b.D=g.length/3;return b};a.AA=c;a.vv=function(a){a=h.iz(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.wv=function(){var a=h.mb("BILLBOARD"),
b=h.hd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,1,2,3]);a.D=4;return a};a.Ca=function(){var a=h.mb("BILLBOARD"),b=h.hd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,0,3,2]);a.D=4;return a};a.sv=function(){var a=h.mb("CUBEMAP_BOARD"),b=h.hd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.Y=new Uint32Array([0,2,1,0,3,2]);a.D=4;return a};a.Jo=function(a,b){var c=h.mb("UV_SPHERE"),
k,t,s=[],y=[],d=[];for(t=0;8>=t;t++)for(k=0;16>=k;k++){var C=k/16,A=t/8;y.push(-a*Math.cos(2*C*Math.PI)*Math.sin(A*Math.PI)+b[0],a*Math.cos(A*Math.PI)+b[1],a*Math.sin(2*C*Math.PI)*Math.sin(A*Math.PI)+b[2])}for(t=C=0;8>t;t++)for(k=0;16>k;k++){var A=g(y,17*t+k+1),u=g(y,17*t+k),w=g(y,17*(t+1)+k),p=g(y,17*(t+1)+k+1);Math.abs(A[1])==a+b[1]?(f(A,s),f(w,s),f(p,s),d.push(C,C+1,C+2),C+=3):Math.abs(w[1])==a+b[1]?(f(A,s),f(u,s),f(w,s),d.push(C,C+1,C+2),C+=3):(f(A,s),f(u,s),f(w,s),f(p,s),d.push(C,C+1,C+2),d.push(C,
C+2,C+3),C+=4)}k={};k.a_position=s;y=l.En(d,y,s);k.a_normal=l.Cn(d,s,y);k.a_tangent=[];c.A.a_influence=[];c.A.a_color=[];c.A.a_texcoord=[];c.r[0]=k;c.Y=d;c.D=s.length/3;return c}};b4w.module.__prerender=function(a,n){var b=n("__config"),c=n("__debug"),g=n("__geometry"),f=n("__util"),l=n("vec3"),h=b.n,k="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Yl=function(a){if(-1<k.indexOf(a.type)){for(var b=!1,v=a.l,m=0;m<v.length;m++){var t=v[m],s=t,y=a,d=s.Va,C=y.h;s.R=!0;d.is_visible=!1;if(d)if(d.xh)s.R=!1;else{var A=C.Wd,u=d.kb.t,w=d.ce,A=Math.sqrt((u[0]-A[0])*(u[0]-A[0])+(u[1]-A[1])*(u[1]-A[1])+
(u[2]-A[2])*(u[2]-A[2])),u=d.nf*d.kb.oa;A>=d.Fh&&A<w+u?(d.is_visible=!0,"GLOW_MASK"!=y.type||Boolean(s.k.gg)?(C=C.gl,d.Xf?d=!1:"STATIC"===d.type?(w=d.kb,d=w.t,d=f.ly(d,C,w.oa)):(w=d.Me,d=w.t,d=f.Yu(d,C,w.Ie,w.Je,w.Ke)),d?s.R=!1:"WIREFRAME"==y.type&&(s.R=s.k.wireframe_mode==c.Xm.WM_DEBUG_SPHERES?s.k.Uk:!s.k.Uk)):s.R=!1):s.R=!1}else s.R=!1;t.R&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:a.R="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?!0:!1}}if("MAIN_BLEND"==a.type&&(b=a.h.Wd,l.dist(b,a.Ar)>
h.alpha_sort_threshold&&h.alpha_sort&&a.l)){for(v=0;v<a.l.length;v++)t=a.l[v],s=t.k,m=t.Va.H,s&&s.sa&&s.Gd!=g.ad&&(s=s.bb)&&t.R&&(t=s.bj)&&t.type==g.Ym&&g.Ny(s,m,b);a.Ar.set(b)}}};b4w.module.__print=function(a){var n=!1,b=0,c=0;a.Wx=function(a){n=a};a.log=function(){n&&console.log.apply(console,arguments)};a.error=function(){b++;console.error.apply(console,arguments)};a.warn=function(){c++;console.warn.apply(console,arguments)};a.time=function(){n&&console.time.apply(console,arguments)};a.timeEnd=function(){n&&console.timeEnd.apply(console,arguments)};a.group=function(){n&&console.group.apply(console,arguments)};a.groupCollapsed=function(){n&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){n&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.cw=function(){return c};a.Rv=function(){return b};a.clear_errors_warnings=function(){b=c=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,n){function b(a,b,c){c=c+">>"+a;c in t||(t[c]={um:[],tq:"undefined",type:a});t[c].um.push(b.name)}function c(a,b){param_id in t||(t[param_id]={um:[],tq:"deprecated",type:a});t[param_id].um.push(b.name)}function g(a,b){b||(b=a.name+"_COPY");var c=a.materials,e=a.submeshes;a.materials=null;a.submeshes=null;var f=k.Pe(a);a.materials=c;a.submeshes=e;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<e.length;c++){var g=k.gh(e[c]);f.submeshes.push(g)}return f}
var f=n("__boundings"),l=n("__curve"),h=n("__print"),k=n("__util"),e=n("vec3"),r=n("vec4"),v=n("quat"),m=n("mat4"),t={};a.Ot=function(a){t={};var e=a.worlds;if(0==e.length){h.warn("WARNING Datablock world is missing, reexport scene");var d={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};e.push(d)}for(var e=a.worlds,f=0;f<e.length;f++){var d=e[f],g=d.b4w_shadow_settings;
"csm_resolution"in g||(b("world",d,"b4w_shadow_settings.csm_resolution"),g.csm_resolution=2048);"self_shadow_polygon_offset"in g||(b("world",d,"b4w_shadow_settings.self_shadow_polygon_offset"),g.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in g||(b("world",d,"b4w_shadow_settings.self_shadow_normal_offset"),g.self_shadow_normal_offset=.01);"b4w_enable_csm"in g||(b("world",d,"b4w_shadow_settings.b4w_enable_csm"),g.b4w_enable_csm=!1);"csm_num"in g||(b("world",d,"b4w_shadow_settings.csm_num"),
g.csm_num=1);"csm_first_cascade_border"in g||(b("world",d,"b4w_shadow_settings.csm_first_cascade_border"),g.csm_first_cascade_border=10);"first_cascade_blur_radius"in g||(b("world",d,"b4w_shadow_settings.first_cascade_blur_radius"),g.first_cascade_blur_radius=3);"csm_last_cascade_border"in g||(b("world",d,"b4w_shadow_settings.csm_last_cascade_border"),g.csm_last_cascade_border=100);"last_cascade_blur_radius"in g||(b("world",d,"b4w_shadow_settings.last_cascade_blur_radius"),g.last_cascade_blur_radius=
1.5);"fade_last_cascade"in g||(b("world",d,"b4w_shadow_settings.fade_last_cascade"),g.fade_last_cascade=!0);"blend_between_cascades"in g||(b("world",d,"b4w_shadow_settings.blend_between_cascades"),g.blend_between_cascades=!0);g=d.b4w_ssao_settings;"dist_factor"in g||(b("world",d,"b4w_ssao_settings.dist_factor"),g.dist_factor=0,g.samples=16);"hemisphere"in g||(b("world",d,"b4w_ssao_settings.hemisphere"),g.hemisphere=!1);"blur_depth"in g||(b("world",d,"b4w_ssao_settings.blur_depth"),g.blur_depth=!1);
"blur_discard_value"in g||(b("world",d,"b4w_ssao_settings.blur_discard_value"),g.blur_discard_value=1);"b4w_glow_color"in d||(d.b4w_glow_color=[1,1,1],b("object",d,"b4w_glow_color"));"b4w_glow_factor"in d||(d.b4w_glow_factor=1,b("object",d,"b4w_glow_factor"));"b4w_fog_density"in d||(b("world",d,"b4w_fog_density"),d.b4w_fog_density=0);"b4w_sky_settings"in d&&"rayleigh_brightness"in d.b4w_sky_settings||(b("world",d,"rayleigh_brightness"),d.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in d?("blur"in d.b4w_bloom_settings||(b("world",d,"b4w_bloom_settings.blur"),d.b4w_bloom_settings.blur=4),"edge_lum"in d.b4w_bloom_settings||(b("world",d,"b4w_bloom_settings.edge_lum"),d.b4w_bloom_settings.edge_lum=1)):(b("world",d,"b4w_bloom_settings"),d.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in d?("motion_blur_factor"in d.b4w_motion_blur_settings||(b("world",d,"b4w_motion_blur_settings.motion_blur_factor"),d.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in d.b4w_motion_blur_settings||(b("world",d,"b4w_motion_blur_settings.motion_blur_decay_threshold"),d.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",d,"b4w_motion_blur_settings"),d.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in d||(b("world",d,"b4w_color_correction_settings"),d.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in d.b4w_god_rays_settings||(b("world",d,"b4w_god_rays_settings.steps_per_pass"),d.b4w_god_rays_settings.steps_per_pass=10)}e=a.scenes;for(f=0;f<e.length;f++)d=e[f],"b4w_use_nla"in d||(d.b4w_use_nla=!1,b("scene",d,"b4w_use_nla")),"fps"in d||(d.fps=24,b("scene",d,"fps")),"b4w_nla_cyclic"in d||(d.b4w_nla_cyclic=!1,b("scene",
d,"b4w_nla_cyclic")),"b4w_nla_script"in d||(d.b4w_nla_script=[],b("scene",d,"b4w_nla_script")),"b4w_detect_collisions"in d&&(c("scene",d),delete d.b4w_detect_collisions),"audio_doppler_speed"in d||(d.audio_doppler_speed=343.3),"audio_doppler_factor"in d||(d.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in d||(d.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",d,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in d||(d.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in d||(d.b4w_enable_bloom=!1,b("scene",d,"b4w_enable_bloom")),"b4w_enable_motion_blur"in d||(d.b4w_enable_motion_blur=!1,b("scene",d,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in d||(d.b4w_enable_color_correction=!1,b("scene",d,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in d||(d.b4w_enable_antialiasing=!0,b("scene",d,"b4w_enable_antialiasing"));e=a.meshes;for(f=0;f<e.length;f++)for(d=e[f],d.b4w_bounding_box||(b("mesh",d,"b4w_bounding_box"),d.b4w_bounding_box=
{max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),d.uv_textures||(b("mesh",d,"uv_textures"),d.uv_textures=[]),d.b4w_bounding_sphere_center||(d.b4w_bounding_sphere_center=[0,0,0]),d.b4w_bounding_cylinder_center||(d.b4w_bounding_cylinder_center=[0,0,0]),d.b4w_bounding_ellipsoid_center||(d.b4w_bounding_ellipsoid_center=[0,0,0]),d.b4w_bounding_ellipsoid_axes||(g=d.b4w_bounding_box,d.b4w_bounding_ellipsoid_axes=[(g.max_x-g.min_x)/2,(g.max_y-g.min_y)/2,(g.max_z-g.min_z)/2]),g=0;g<d.b4w_vertex_anim.length;g++){var m=
d.b4w_vertex_anim[g];"allow_nla"in m||(b('mesh["b4w_vertex_anim"]',d,"allow_nla"),m.allow_nla=!0)}e=a.cameras;for(f=0;f<e.length;f++)d=e[f],d.type||(d.type="PERSP",b("camera",d,"type")),"b4w_eye_target_dist"in d&&(delete d.b4w_eye_target_dist,c("camera",d)),"b4w_use_distance_limits"in d||(d.b4w_use_distance_limits=!1,b("camera",d,"b4w_use_distance_limits")),"b4w_distance_min"in d||(d.b4w_distance_min=1,b("camera",d,"b4w_distance_min")),"b4w_distance_max"in d||(d.b4w_distance_max=100,b("camera",d,
"b4w_distance_max")),"b4w_horizontal_translation_min"in d||(d.b4w_horizontal_translation_min=-100,b("camera",d,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in d||(d.b4w_horizontal_translation_max=100,b("camera",d,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in d||(d.b4w_vertical_translation_min=-100,b("camera",d,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in d||(d.b4w_vertical_translation_max=100,b("camera",d,"b4w_vertical_translation_max")),
"b4w_use_horizontal_clamping"in d||(d.b4w_use_horizontal_clamping=!1,b("camera",d,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in d||(d.b4w_rotation_left_limit=-Math.PI,b("camera",d,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in d||(d.b4w_rotation_right_limit=Math.PI,b("camera",d,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in d||(d.b4w_horizontal_clamping_type="LOCAL",b("camera",d,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in d||(d.b4w_use_vertical_clamping=
!1,b("camera",d,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in d||(d.b4w_rotation_down_limit=-Math.PI/2,b("camera",d,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in d||(d.b4w_rotation_up_limit=Math.PI/2,b("camera",d,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in d||(d.b4w_vertical_clamping_type="LOCAL",b("camera",d,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in d||(d.b4w_hover_angle_min=Math.PI/6,b("camera",d,"b4w_hover_angle_min")),"b4w_hover_angle_max"in d||(d.b4w_hover_angle_max=
Math.PI/6,b("camera",d,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in d||(d.b4w_enable_hover_hor_rotation=!0,b("camera",d,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in d||(d.b4w_use_panning=!0,b("camera",d,"b4w_use_panning"));e=a.lamps;for(f=0;f<e.length;f++)d=e[f],"b4w_generate_shadows"in d||(d.b4w_generate_shadows=!1,b("lamp",d,"b4w_generate_shadows")),"b4w_dynamic_intensity"in d||(d.b4w_dynamic_intensity=!1,b("lamp",d,"b4w_dynamic_intensity")),"use_diffuse"in d||(d.use_diffuse=
!0,b("lamp",d,"use_diffuse")),"use_specular"in d||(d.use_specular=!0,b("lamp",d,"use_specular"));e=a.speakers;for(f=0;f<e.length;f++)d=e[f],"b4w_behavior"in d||(d.b4w_behavior=d.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in d||(d.b4w_disable_doppler=!1),"b4w_delay"in d||(d.b4w_delay=0),"b4w_delay_random"in d||(d.b4w_delay_random=0),"b4w_volume_random"in d||(d.b4w_volume_random=0),"b4w_pitch_random"in d||(d.b4w_pitch_random=0),"b4w_fade_in"in d||(d.b4w_fade_in=0),"b4w_fade_out"in
d||(d.b4w_fade_out=0),"b4w_loop"in d||(d.b4w_loop=!1),"b4w_loop_count"in d||(d.b4w_loop_count=0),"b4w_loop_count_random"in d||(d.b4w_loop_count_random=0),"b4w_playlist_id"in d||(d.b4w_playlist_id="");e=a.textures;for(f=0;f<e.length;f++)d=e[f],"b4w_anisotropic_filtering"in d||(d.b4w_anisotropic_filtering="OFF",b("texture",d,"b4w_anisotropic_filtering")),"b4w_water_foam"in d||(d.b4w_water_foam=!1,b("texture",d,"b4w_water_foam")),"b4w_foam_uv_freq"in d||(d.b4w_foam_uv_freq=[1,1],b("texture",d,"b4w_foam_uv_freq")),
"b4w_foam_uv_magnitude"in d||(d.b4w_foam_uv_magnitude=[1,1],b("texture",d,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in d||(d.b4w_parallax_steps=5,b("material",d,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in d||(d.b4w_parallax_lod_dist=10,b("material",d,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in d||(d.b4w_shore_dist_map=!1,b("texture",d,"b4w_shore_dist_map")),"b4w_shore_boundings"in d||(d.b4w_shore_boundings=new Float32Array(4),d.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",d,"b4w_shore_boundings")),
"b4w_max_shore_dist"in d||(d.b4w_max_shore_dist=100,b("texture",d,"b4w_max_shore_dist")),"b4w_disable_compression"in d||(d.b4w_disable_compression=!1,b("texture",d,"b4w_disable_compression")),"b4w_source_type"in d||(d.b4w_source_type="",b("texture",d,"b4w_source_type")),"b4w_source_id"in d||(d.b4w_source_id="",b("texture",d,"b4w_source_id")),"b4w_source_size"in d||(d.b4w_source_size=1024,b("texture",d,"b4w_source_size"));e=a.materials;for(f=0;f<e.length;f++)for(d=e[f],("b4w_node_mat_type"in d)&&c("material",
d),("b4w_skydome"in d)&&c("material",d),("b4w_procedural_skydome"in d)&&c("material",d),d.b4w_water&&("b4w_water_shore_smoothing"in d||(d.b4w_water_shore_smoothing=!1,b("material",d,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in d||(d.b4w_water_dynamic=!1,b("material",d,"b4w_water_dynamic")),"b4w_waves_height"in d||(d.b4w_waves_height=1,b("material",d,"b4w_waves_height")),"b4w_waves_length"in d||(d.b4w_waves_length=1,b("material",d,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in d||(d.b4w_water_dst_noise_scale0=
.05,b("material",d,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in d||(d.b4w_water_dst_noise_scale1=.03,b("material",d,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in d||(d.b4w_water_dst_noise_freq0=1.3,b("material",d,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in d||(d.b4w_water_dst_noise_freq1=1,b("material",d,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in d||(d.b4w_water_dir_min_shore_fac=.4,b("material",d,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
d||(d.b4w_water_dir_freq=.5,b("material",d,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in d||(d.b4w_water_dir_noise_scale=.05,b("material",d,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in d||(d.b4w_water_dir_noise_freq=.07,b("material",d,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in d||(d.b4w_water_dir_min_noise_fac=.5,b("material",d,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in d||(d.b4w_water_dst_min_fac=.2,b("material",d,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
d||(d.b4w_water_waves_hor_fac=5,b("material",d,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in d||(d.b4w_water_absorb_factor=6,b("material",d,"b4w_water_absorb_factor")),"b4w_water_fog_color"in d||(d.b4w_water_fog_color=new Float32Array(3),d.b4w_water_fog_color=[.5,.7,.7],b("material",d,"b4w_water_fog_color")),"b4w_foam_factor"in d||(d.b4w_foam_factor=5,b("material",d,"b4w_foam_factor")),"b4w_generated_mesh"in d||(d.b4w_generated_mesh=!1,b("material",d,"b4w_generated_mesh")),"b4w_water_num_cascads"in
d||(d.b4w_water_num_cascads=5,b("material",d,"b4w_water_num_cascads")),"b4w_water_subdivs"in d||(d.b4w_water_subdivs=64,b("material",d,"b4w_water_subdivs")),"b4w_water_detailed_dist"in d||(d.b4w_water_detailed_dist=1E3,b("material",d,"b4w_water_detailed_dist"))),("b4w_dynamic_grass_size"in d)||(d.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in d)||(d.b4w_dynamic_grass_color=""),("diffuse_intensity"in d)||(d.diffuse_intensity=1,b("material",d,"diffuse_intensity")),("b4w_use_ghost"in d)||(d.b4w_use_ghost=
!1),("b4w_collision_group"in d)||(d.b4w_collision_group=128,b("material",d,"b4w_collision_group")),("b4w_collision_mask"in d)||(d.b4w_collision_mask=127,b("material",d,"b4w_collision_mask")),"HALO"!=d.type||("b4w_halo_sky_stars"in d)||(d.b4w_halo_sky_stars=!1,b("material",d,"b4w_halo_sky_stars")),"HALO"!=d.type||("b4w_halo_stars_blend_height"in d)||(d.b4w_halo_stars_blend_height=10,b("material",d,"b4w_halo_stars_blend_height")),"HALO"!=d.type||("b4w_halo_stars_min_height"in d)||(d.b4w_halo_stars_min_height=
0,b("material",d,"b4w_halo_stars_min_height")),("specular_shader"in d)||(d.specular_shader="COOKTORR",b("material",d,"specular_shader")),("diffuse_shader"in d)||(d.diffuse_shader="LAMBERT",b("material",d,"diffuse_shader")),("roughness"in d)||(d.roughness=.5,b("material",d,"roughness")),("diffuse_fresnel"in d)||(d.diffuse_fresnel=.1,b("material",d,"diffuse_fresnel")),("diffuse_fresnel_factor"in d)||(d.diffuse_fresnel_factor=.5,b("material",d,"diffuse_fresnel_factor")),("specular_slope"in d)||(d.specular_slope=
.2,b("material",d,"specular_slope")),("specular_toon_size"in d)||(d.specular_toon_size=.5,b("material",d,"specular_toon_size")),("specular_toon_smooth"in d)||(d.specular_toon_smooth=.1,b("material",d,"specular_toon_smooth")),("specular_alpha"in d)||(d.specular_alpha=1,b("material",d,"specular_alpha")),("b4w_wettable"in d)||(d.b4w_wettable=!1,b("material",d,"b4w_wettable")),("b4w_refractive"in d)||(d.b4w_refractive=!1,b("material",d,"b4w_refractive")),("b4w_refr_bump"in d)||(d.b4w_refr_bump=0,b("material",
d,"b4w_refr_bump")),("b4w_shallow_water_col"in d)||(d.b4w_shallow_water_col=[0,.8,.3],b("material",d,"b4w_shallow_water_col")),("b4w_shore_water_col"in d)||(d.b4w_shore_water_col=[0,.9,.2],b("material",d,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in d)||(d.b4w_shallow_water_col_fac=1,b("material",d,"b4w_shallow_water_col_fac")),("b4w_shore_water_col_fac"in d)||(d.b4w_shore_water_col_fac=.5,b("material",d,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in d)||(d.b4w_water_sss_strength=
5.9,b("material",d,"b4w_water_sss_strength")),("b4w_water_sss_width"in d)||(d.b4w_water_sss_width=.45,b("material",d,"b4w_water_sss_width")),("b4w_render_above_all"in d)||(d.b4w_render_above_all=!1,b("material",d,"b4w_render_above_all")),d=d.texture_slots,g=0;g<d.length;g++)m=d[g],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));e=a.objects;for(f=0;f<e.length;f++){d=e[f];switch(d.type){case "MESH":"b4w_dynamic_geometry"in d||(d.b4w_dynamic_geometry=!1);"b4w_reflexible"in d||
(d.b4w_reflexible=!1);"b4w_reflexible_only"in d||(d.b4w_reflexible_only=!1);"b4w_reflective"in d||(d.b4w_reflective=!1);"b4w_wind_bending"in d||(d.b4w_wind_bending=!1,b("object",d,"b4w_wind_bending"));"b4w_wind_bending_angle"in d||(d.b4w_wind_bending_angle=10,d.b4w_wind_bending_freq=.25,b("object",d,"wind bending params"));"b4w_detail_bending_amp"in d||(d.b4w_detail_bending_amp=.1,d.b4w_branch_bending_amp=.3,b("object",d,"detail bending params"));"b4w_detail_bending_freq"in d||(d.b4w_detail_bending_freq=
1,b("object",d,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in d||(d.b4w_main_bend_stiffness_col="",b("object",d,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in d||(d.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",d,"b4w_detail_bend_colors"));"b4w_caustics"in d||(d.b4w_caustics=!1);"vertex_groups"in d&&d.vertex_groups.length&&d.data&&0==d.data.vertex_groups.length&&(d.data.vertex_groups=d.vertex_groups,delete d.vertex_groups,
b("object",d,"vertex_groups"));"b4w_vertex_anim"in d&&d.b4w_vertex_anim.length&&d.data&&0==d.data.b4w_vertex_anim.length&&(d.data.b4w_vertex_anim=d.b4w_vertex_anim,delete d.b4w_vertex_anim,b("object",d,"b4w_vertex_anim"));"b4w_do_not_render"in d||(d.b4w_do_not_render=!1);"use_ghost"in d.game||(d.game.use_ghost=!1);"use_sleep"in d.game||(d.game.use_sleep=!1);"velocity_min"in d.game||(d.game.velocity_min=0);"velocity_max"in d.game||(d.game.velocity_max=0);"collision_group"in d.game||(d.game.collision_group=
1);"collision_mask"in d.game||(d.game.collision_mask=255);"b4w_vehicle_settings"in d?d.b4w_vehicle_settings&&("steering_ratio"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.steering_ratio=10),"steering_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.steering_max=1),"inverse_control"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.inverse_control=!1),"force_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.force_max=1500),"brake_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.brake_max=
100),"speed_ratio"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in d.b4w_vehicle_settings||
(d.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.floating_factor=3),"floating_factor"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.floating_factor=3),
"water_lin_damp"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.water_rot_damp=.9)):(d.b4w_vehicle_settings=null,b("object",d,"b4w_vehicle_settings"));"b4w_floating_settings"in d?d.b4w_floating_settings&&("floating_factor"in d.b4w_floating_settings||(d.b4w_floating_settings.floating_factor=3),"water_lin_damp"in d.b4w_floating_settings||(d.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in d.b4w_floating_settings||
(d.b4w_floating_settings.water_rot_damp=.8)):(d.b4w_floating_settings=null,b("object",d,"b4w_floating_settings"));"b4w_character_settings"in d?d.b4w_character_settings&&("walk_speed"in d.b4w_character_settings||(d.b4w_character_settings.walk_speed=4),"run_speed"in d.b4w_character_settings||(d.b4w_character_settings.run_speed=8),"step_height"in d.b4w_character_settings||(d.b4w_character_settings.step_height=.25),"jump_strength"in d.b4w_character_settings||(d.b4w_character_settings.jump_strength=5),
"waterline"in d.b4w_character_settings||(d.b4w_character_settings.waterline=0)):(d.b4w_character_settings=null,b("object",d,"b4w_character_settings"));"b4w_selectable"in d||(d.b4w_selectable=!1,b("object",d,"b4w_selectable"));"b4w_billboard"in d||(d.b4w_billboard=!1,b("object",d,"b4w_billboard"));"b4w_billboard_geometry"in d||(d.b4w_billboard_geometry="SPHERICAL",b("object",d,"b4w_billboard_geometry"));"b4w_glow_settings"in d||(d.b4w_glow_settings={},d.b4w_glow_settings.glow_duration=1,d.b4w_glow_settings.glow_period=
1,d.b4w_glow_settings.glow_relapses=0,b("object",d,"b4w_glow_settings"));"b4w_lod_transition"in d||(d.b4w_lod_transition=.01,b("object",d,"b4w_lod_transition"));"lod_levels"in d||(d.lod_levels=[],b("object",d,"lod_levels"));"b4w_animation_mixing"in d||(d.b4w_animation_mixing=!1,b("object",d,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in d||(d.b4w_group_relative=!1,b("object",d,"b4w_group_relative"))}"b4w_anim_behavior"in d||(d.b4w_anim_behavior=d.b4w_cyclic_animation?"CYCLIC":
"FINISH_STOP",b("object",d,"b4w_anim_behavior"));if(!("rotation_quaternion"in d)){g=[0,0,0,1];k.euler_to_quat(d.rotation_euler,g);var m=g,l=g[0],p=g[1],r=g[2];m[0]=g[3];m[1]=l;m[2]=p;m[3]=r;d.rotation_quaternion=g;b("object",d,"rotation_quaternion")}"webgl_do_not_batch"in d&&(d.b4w_do_not_batch=d.webgl_do_not_batch)&&c("object",d);"b4w_shadow_cast_only"in d||(d.b4w_shadow_cast_only=!1,b("object",d,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in d||(d.b4w_correct_bounding_offset="AUTO",b("object",
d,"b4w_correct_bounding_offset"));m=d.particle_systems;for(g=0;g<m.length;g++)l=m[g],p=l.settings,"use_whole_group"in p||(p.use_whole_group=!1,b("object",p,"use_whole_group")),l.transforms||(l.transforms=new Float32Array,b("particle_system",l,"transforms")),"b4w_billboard_align"in p||(p.b4w_billboard_align="VIEW",b("particle_settings",p,"b4w_billboard_align")),"b4w_dynamic_grass"in p||(p.b4w_dynamic_grass=!1,b("object",p,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in p||(p.b4w_dynamic_grass_scale_threshold=
.01,b("object",p,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in p||(p.b4w_initial_rand_rotation=!1,b("particle_settings",p,"b4w_initial_rand_rotation")),"b4w_rotation_type"in p||(p.b4w_rotation_type="Z",b("particle_settings",p,"b4w_rotation_type")),"b4w_rand_rotation_strength"in p||(p.b4w_rand_rotation_strength=1,b("particle_settings",p,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in p||(p.b4w_hair_billboard=!1,b("particle_settings",p,"b4w_hair_billboard")),"b4w_hair_billboard_type"in
p||(p.b4w_hair_billboard_type="BASIC",b("particle_settings",p,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in p||(p.b4w_hair_billboard_jitter_amp=0,b("particle_settings",p,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in p||(p.b4w_hair_billboard_jitter_freq=0,b("particle_settings",p,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in p||(p.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",p,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in
p||(p.b4w_wind_bend_inheritance="PARENT",b("particle_settings",p,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in p||(p.b4w_shadow_inheritance="PARENT",b("particle_settings",p,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in p||(p.b4w_reflection_inheritance="PARENT",b("particle_settings",p,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in p||(p.b4w_vcol_from_name="",b("particle_settings",p,"b4w_vcol_from_name")),"b4w_vcol_to_name"in p||(p.b4w_vcol_to_name="",b("particle_settings",
p,"b4w_vcol_to_name")),"b4w_coordinate_system"in p||(p.b4w_coordinate_system="LOCAL",b("particle_settings",p,"b4w_coordinate_system")),"b4w_allow_nla"in p||(p.b4w_allow_nla=!0,b("particle_settings",p,"b4w_allow_nla"));"constraints"in d||(d.constraints=[],b("object",d,"constraints"));m=d.modifiers;for(g=0;g<m.length;g++){a:{l=m[g];switch(l.type){case "ARRAY":if(!("fit_type"in l)){h.error("WARNING Incomplete modifier "+String(l.type)+' for "'+d.name+'", reexport '+(d.library?"library"+d.library.split("/").slice(-1)[0]:
"main scene"));l=!1;break a}}l=!0}l||(m.splice(g,1),g--)}"animation_data"in d||(d.animation_data={action:null,nla_tracks:[]},b("object",d,"animation_data"));if(d.animation_data)for(("action"in d.animation_data)||(d.animation_data.action=null,h.warn("B4W Warning: no action in animation data "+d.name)),("nla_tracks"in d.animation_data)||(d.animation_data.nla_tracks=[],h.warn("B4W Warning: no NLA in animation data "+d.name)),m=d.animation_data.nla_tracks,g=0;g<m.length;g++)for(l=m[g],p=0;p<l.strips.length;p++)r=
l.strips[p],"action"in r||(r.action=null,h.warn("B4W Warning: no action in NLA strip "+d.name)),"action_frame_start"in r||(r.action_frame_start=0,h.warn("B4W Warning: no action_frame_start in NLA strip "+d.name)),"action_frame_end"in r||(r.action_frame_end=r.frame_end-r.frame_start,h.warn("B4W Warning: no action_frame_start in NLA strip "+d.name));"b4w_collision_id"in d||(d.b4w_collision_id="",b("material",d,"b4w_collision_id"));g=d.scale;m=Math.abs((g[1]-g[2])/g[1]);.001>Math.abs((g[0]-g[1])/g[0])&&
.001>m||h.warn("B4W Warning: non-uniform scale for object "+d.name)}for(var v in t)f=t[v],e=v.match(/.*?(?=>>|$)/i)[0],h.warn("WARNING "+String(e)+" is "+f.tq+" for "+f.type+", reexport "+a.b4w_filepath_blend)};a.ot=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var h=b[c].type;if("ARRAY"==h||"CURVE"==h){b=!0;break a}}b=!1}if(!b)return null;b=g(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var t=a[c];switch(t.type){case "ARRAY":for(var h=b,u=t,w=0,p=0,n=0,H=new Float32Array(16),
t=[],x=1;x<u.count;x++){u.use_constant_offset&&(w+=u.constant_offset_displace[0],p+=u.constant_offset_displace[1],n+=u.constant_offset_displace[2]);if(u.use_relative_offset)var M=h.b4w_bounding_box,w=w+(M.max_x-M.min_x)*u.relative_offset_displace[0],p=p+(M.max_y-M.min_y)*u.relative_offset_displace[1],n=n+(M.max_z-M.min_z)*u.relative_offset_displace[2];k.Hy(w,p,n,H);for(var q=M=g(h),G=H,D=0;D<q.submeshes.length;D++){var V=q.submeshes[D];k.he(V.position,G,V.position,0);k.jz(V.normal,G,V.normal);k.Ey(V.tangent,
G,V.tangent)}t.push(M)}for(x=0;x<t.length;x++)for(u=h,w=t[x],p=0;p<u.submeshes.length;p++){n=u.submeshes[p];H=w.submeshes[p];M=n.base_length;q=n.indices.length;n.base_length+=H.base_length;for(var O in n)if("base_length"!=O)if("indices"==O)for(n[O]=k.Ky(n[O],H[O]),G=q;G<n.indices.length;G++)n.indices[G]+=M;else n[O]=k.jv(n[O],H[O])}break;case "CURVE":for(var h=b,x=t.object.Us,u=new Float32Array(16),p=x.ae?4:3,w=new Float32Array(p),p=new Float32Array(p),n=new Float32Array(3),H=new Float32Array(4),
M=new Float32Array(4),q=new Float32Array(3),G=new Float32Array(3),D=new Float32Array(3),V=new Float32Array(4),U=new Float32Array(4),T=0;T<h.submeshes.length;T++){var L=h.submeshes[T],P=L.position,R=L.normal,L=L.tangent,X;a:switch(X=t.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}q[0]=0;q[1]=0;q[2]=0;q[X]=1;for(var N=l.oy(x),ca=0;ca<P.length/3;ca++){D[0]=P[3*ca];D[1]=P[3*ca+
1];D[2]=P[3*ca+2];var Q=D[X],ia=l.ny(x,Q);l.py(x,ia,w);n[0]=w[0];n[1]=w[1];n[2]=w[2];l.my(x,ia,p);G[0]=p[0];G[1]=0;G[2]=p[2];e.normalize(G,G);v.rotationTo(q,G,H);0>Q?(w[0]=G[0],w[1]=G[1],w[2]=G[2],e.scale(w,Q,w),e.add(n,w,n)):Q>N&&(w[0]=G[0],w[1]=G[1],w[2]=G[2],e.scale(w,Q-N,w),e.add(n,w,n));m.fromRotationTranslation(H,n,u);x.ae&&(v.setAxisAngle(q,w[3],M),e.transformQuat(D,M,D));D[X]=0;e.transformMat4(D,u,D);P[3*ca]=D[0];P[3*ca+1]=D[1];P[3*ca+2]=D[2];R.length&&(V[0]=R[3*ca],V[1]=R[3*ca+1],V[2]=R[3*
ca+2],V[3]=0,r.transformMat4(V,u,V),R[3*ca]=V[0],R[3*ca+1]=V[1],R[3*ca+2]=V[2]);L.length&&(U[0]=L[3*ca],U[1]=L[3*ca+1],U[2]=L[3*ca+2],U[3]=0,r.transformMat4(U,u,U),L[3*ca]=U[0],L[3*ca+1]=U[1],L[3*ca+2]=U[2])}}}f.ox(b)}return b};a.hA=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,
specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,
offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,n){function b(a){a=Ra.ta(a);a.Xd=null;a.cb=null;a.hc=null;return a}function c(a,b){var c=[];K.ue(a,function(b,d,e){-1<c.indexOf(e)?K.vx(a,b,d,e,l(e)):c.push(e)});K.K(a,function(b,d){for(var e=0;e<d.Z.length;e++){var f=d.Z[e];-1<c.indexOf(f)?d.Z[e]=l(f):c.push(f)}"ANTIALIASING"==d.type&&K.ve(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.Z.length;c++){var d=b.Z[c];d.ca=Y.s;d.ba=Y.s}})});K.K(a,function(c){var d={};g(a,c,d);for(var e in d){c=d[e];if(b)for(var h=
0;h<c.length;h++){var p=c[h];if("DEPTH"==p.G){if(f(p))throw"Failed to use renderbuffer as input texture: "+p.G+"->"+p.V;p.Og=!0}}p=c[0];for(h=0;h<c.length;h++)if(c[h].ca==Y.s){p=c[h];break}for(var B=c[0],h=0;h<c.length;h++)if(c[h].ba==Y.s){B=c[h];break}for(var k=c[0],h=0;h<c.length;h++)if(!c[h].Og){k=c[h];break}for(h=0;h<c.length;h++)c[h].ca=p.ca,c[h].ba=B.ba,c[h].Og=k.Og}})}function g(a,b,c){K.ve(a,b,function(b,d,e){e.xa&&e.G==e.V&&(c[e.G]=c[e.G]||[],-1==c[e.G].indexOf(e)&&c[e.G].push(e),g(a,b,c))});
K.we(a,b,function(a,b,d){d.xa&&(c[d.G]=c[d.G]||[],-1==c[d.G].indexOf(d)&&c[d.G].push(d))});b=K.Da(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.Z.length;d++){var e=b.Z[d];c[e.G].push(e)}}function f(a){switch(a.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function l(a){if(a.pa)throw"Failed to clone slink with attached texture";return Ra.Pe(a)}function h(a){var b=K.er(a),c=[];K.K(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var f=
[];break;default:f=c}for(var g=0;g<d.Z.length;g++){var h=d.Z[g],p=m(f,h,e(h));h.pa=p;d.Tc[g]=p}for(g=0;g<d.Tc.length;g++)p=d.Tc[g],v(f,p);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":f=[]}K.we(b,a,function(c,d,g){if((c=r(b,a,g.G))&&g.xa&&!g.pa){d=f;for(var h=c,p=0;p<d.length;p++){var B=d[p];B.xm===h&&B.Th++}}else c=m(f,g,e(g));g.pa=c});K.ve(b,a,function(a,b,c){v(f,c.pa)});K.we(b,a,function(a,b,c){c.pa&&"NONE"==c.V&&v(f,c.pa)})})}function k(a){s(a,
function(b,c,d){b.Lg&&(na(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||na(a,d,"ANTIALIASING"))&&(b.qe*=Ia.resolution_factor)})}function e(a){a=Ra.Pe(a);delete a.V;delete a.xa;return JSON.stringify(a)}function r(a,b,c){var d=null;K.ve(a,b,function(a,b,e){if(e.xa&&e.G==e.V&&e.G==c&&e.pa)return d=e.pa,!0});K.we(a,b,function(a,b,e){if(e.xa&&e.G==c&&e.pa)return d=e.pa,!0});return d}function v(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.xm===b&&d.Th&&d.Th--}}function m(a,b,
c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Th){d=f;break}}if(d)return d.Th++,d.xm;b=t(b);a.push({id:c,Th:1,xm:b});return b}function t(a){var b=a.qe*a.size;switch(a.G){case "COLOR":var c=Y.Ni("COLOR",Y.Nf);Y.resize(c,b,b);Y.Jj(c,a.ca,a.ba);return c;case "DEPTH":return a.Og?(c=Y.Ni("DEPTH_RBUF",Y.Mf),Y.resize(c,b,b)):(c=Y.Ni("DEPTH_TEX",Y.Wg),Y.resize(c,b,b),Y.Jj(c,a.ca,a.ba)),c;case "CUBEMAP":return c=Y.iu(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.G;
}}function s(a,b){var c=!1;K.ue(a,function(d,e,f){if(f&&(d=K.Da(a,d),e=K.Da(a,e),b(f,!1,d,e)))return c=!0});c||K.K(a,function(a,c){for(var d=0;d<c.Z.length;d++)if(b(c.Z[d],!0,c,null))return!0})}function y(a){K.K(a,function(b,c){if("SINK"!=c.type){var d=c.h;K.we(a,b,function(a,b,c){c.xa&&c.pa&&(W.Ij(d,c.G,c.pa),c.G==c.V&&b.h&&W.Ij(b.h,c.G,c.pa))});for(var e=0;e<c.Z.length;e++){var f=c.Z[e];f.xa&&f.G==f.V&&W.Ij(d,f.G,c.Tc[e])}!d.cb&&!d.hc||d.Xd||(d.Xd=ta.sq(d.cb,d.hc))}})}function d(a,b){var c=C("SHADOW_CAST");
c.Ok=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;c.h=W.lb(W.Yg);return c}function C(a){return{type:a,sa:!1,bq:!1,sk:!1,rj:!1,kh:0,time:0,h:null,ho:null,hb:null,l:[],Z:[],Tc:[],mi:new Float32Array(3),Ar:new Float32Array(3),Ib:new Float32Array(3),Fb:new Float32Array(4),Gc:new Float32Array(16),Vd:0,tf:0,gf:null,kf:null,ff:null,hf:null,jf:null,ic:new Float32Array(3),pc:new Float32Array(3),$q:new Float32Array([0,0,0]),Qj:new Float32Array(3),ar:new Float32Array(4),xg:null,Yi:0,Xk:0,Ah:!1,
wh:new Float32Array(3),xe:0,Ba:null,dk:!1,ne:new Float32Array(2),oe:new Float32Array(2),vg:0,mg:0,Ck:0,zc:null,ze:0,Kf:0,ye:0,Ne:!1,Gn:0,Hn:new Float32Array(2),Fn:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,wg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Ag:0,zg:0,yg:0,Sq:0,
ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,lg:0,Ej:0,Dg:0,Ok:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,pr:null,tn:null,yf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,yn:0,xo:0,nj:0,oj:0,Gp:0,Qh:"",Cw:new Float32Array(2),R:!0,enqueue:!0,aa:!0,ga:!0,xb:!0,va:!0}}function A(a,b,c,d,e){return{G:a,V:b,size:c,qe:d,Lg:e,xa:!0,pa:null,Og:!1,ca:Y.qc,ba:Y.qc}}function u(){var a=C("GRASS_MAP");a.h=W.lb(W.Xg);return a}function w(a){var b=
C("POSTPROCESSING");b.aa=!1;b.ga=!1;b.xb=!1;b.h=W.lb(W.Za);b.Qh=a;return b}function p(a){var b=C("BLOOM_BLUR");b.aa=!1;b.ga=!1;b.xb=!1;b.h=W.lb(W.Za);b.Qh=a;return b}function I(a,b,c,d,e,f,g,h,p){var B=C("MAIN_"+a);if("OPAQUE"===a)B.aa=!0,B.ga=c,B.sa=!1;else if("BLEND"===a)B.aa=!1,B.ga=!1,B.sa=!0;else if("XRAY"===a)B.aa=!1,B.ga=!0,B.sa=!0;else if("REFLECT"===a)B.aa=!0,B.ga=!0,B.sa=!1;else throw"wrong main subscene type";B.sa&&h&&(B.self_shadow_normal_offset=h.self_shadow_normal_offset);B.h=b;B.ic.set(g.ic);
B.pc.set(g.pc);B.Vd=g.Vd;B.xg=g.xg;B.Fb=f;d&&(B.Ba=d,d.Fb&&(B.zc=new Float32Array(d.Fb)),B.ze=d.waves_height,B.Kf=d.waves_length,B.ye=d.ye,d.Ii&&p&&(B.Ne=!0,B.Gn=d.Ii,B.Hn.set(d.Ek),B.Fn=d.Dk),d.Lj&&(B.dk=!0,a=d.ay,B.ne[0]=(a[0]+a[1])/2,B.ne[1]=(a[2]+a[3])/2,B.oe[0]=a[0]-a[1],B.oe[1]=a[2]-a[3],B.vg=d.vg,B.mg=d.mg));B.gf=new Float32Array(3*e);B.kf=new Float32Array(3*e);B.ff=new Float32Array(3*e);B.hf=new Float32Array(4*e);B.jf=new Float32Array(4*e);return B}function H(a,b){var c=C("COLOR_PICKING");
b&&(c.type+="_XRAY",c.aa=!1,c.ga=!0);c.enqueue=!1;c.h=a;return c}function x(a){var b=C("WIREFRAME");b.R=!1;b.aa=!1;b.ga=!1;b.h=a;return b}function M(a,b){var c=C("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function q(a){var b=C("DEPTH_PACK");b.aa=!1;b.ga=!1;b.h=a;return b}function G(a,b,c){var d=C("SSAO");d.aa=!1;d.ga=!1;d.xb=!1;d.h=a;d.Fb=b;d.zc=new Float32Array(b);d.Ag=c.radius_increase;d.ssao_hemisphere=c.ow;d.zg=c.influence;d.yg=c.dist_factor;d.Sq=c.Ax;return d}
function D(a,b){var c=C("SSAO_BLUR");c.aa=!1;c.ga=!1;c.xb=!1;c.ssao_blur_depth=b.Bt;c.ssao_blur_discard_value=b.xn;c.h=a;return c}function V(){var a=C("ANTIALIASING");a.aa=!1;a.ga=!1;a.xb=!1;a.h=W.lb(W.Za);return a}function O(a){var b=C(a);b.aa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ga=!1;b.xb=!1;b.h=W.lb(W.Za);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.Dw=new Float32Array(4));return b}function U(a,b,c,d){var e=C("COMPOSITING");e.aa=!1;e.ga=!1;e.xb=!1;e.h=W.lb(W.Za);
e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function T(a,b){var c=C("MOTION_BLUR");c.aa=!1;c.ga=!1;c.xb=!1;c.h=W.lb(W.Za);c.sk=!0;c.nj=a;c.oj=b;return c}function L(a){var b=C("DOF");b.aa=!1;b.ga=!1;b.xb=!1;b.h=a;return b}function P(a){var b=C("GLOW_MASK");b.h=a;b.xb=!1;return b}function R(a){var b=C("GLOW");b.wh.set(a.wh);b.Yi=a.Yi;b.xo=5;b.yn=3;b.xb=!1;b.h=W.lb(W.Za);return b}function X(){var a=C("REFRACT");a.aa=!1;a.ga=!1;a.xb=!1;a.h=W.lb(W.Za);return a}function N(a,b,c,d,e,
f,g){var h=C("GOD_RAYS");h.aa=!1;h.ga=!1;h.xb=!1;h.ic[0]=1;h.ic[1]=1;h.ic[2]=1;h.pc[0]=1;h.pc[1]=1;h.pc[2]=1;h.Vd=1;h.bq=d;h.xe=b;h.Ej=e;h.lg=c;h.Dg=g;h.h=a;h.tf=f;h.gf=new Float32Array(3*f);h.kf=new Float32Array(3*f);h.ff=new Float32Array(3*f);h.hf=new Float32Array(4*f);h.jf=new Float32Array(4*f);return h}function ca(a,b){var c=C("GOD_RAYS_COMBINE");c.aa=!1;c.ga=!1;c.xb=!1;c.h=W.lb(W.Za);c.god_rays_intensity=a;c.tf=b;c.gf=new Float32Array(3*b);c.kf=new Float32Array(3*b);c.ff=new Float32Array(3*b);
c.hf=new Float32Array(4*b);c.jf=new Float32Array(4*b);return c}function Q(a,b){var c=C("SKY");c.enqueue=!1;c.aa=!1;c.ga=!1;c.xb=!1;var d=W.lb(W.Za);d.width=za.jh;d.height=za.jh;c.h=d;c.ho=Ra.tv();c.tf=a;c.gf=new Float32Array(3*a);c.kf=new Float32Array(3*a);c.ff=new Float32Array(3*a);c.hf=new Float32Array(4*a);c.jf=new Float32Array(4*a);c.ic[0]=1;c.ic[1]=1;c.ic[2]=1;c.pc[0]=1;c.pc[1]=1;c.pc[2]=1;c.Vd=1;c.wg.set(b.wg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;
c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ia(){var a=C("SCREEN");a.aa=!1;a.ga=!1;a.h=W.lb(W.Za);return a}function F(){var a=C("ANAGLYPH");a.aa=!1;a.ga=!1;a.h=W.lb(W.Za);
return a}function ga(){var a=C("LUMINANCE");a.aa=!1;a.ga=!1;a.h=W.lb(W.Za);return a}function S(){var a=C("AVERAGE_LUMINANCE");a.aa=!1;a.ga=!1;a.h=W.lb(W.Za);return a}function z(a,b,c,d){var e=C("LUMINANCE_TRUNCED");e.aa=!1;e.ga=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.h=d;e.gf=new Float32Array(3*c);e.kf=new Float32Array(3*c);e.ff=new Float32Array(3*c);e.hf=new Float32Array(4*c);e.jf=new Float32Array(4*c);return e}function J(a){var b=C("BLOOM");b.aa=!1;b.ga=!1;b.h=W.lb(W.Za);b.bloom_blur=a;return b}function ja(){var a=
C("SINK");a.enqueue=!1;return a}function na(a,b,c){if(b.type===c)return!0;b=B(a,b);for(var d=0;d<b.length;d++)if(na(a,b[d],c))return!0;return!1}function fa(a,b,c){if(b.type===c)return!0;b=ba(a,b);for(var d=0;d<b.length;d++)if(fa(a,b[d],c))return!0;return!1}function aa(a,b,c){if(b.type===c)return b;b=ba(a,b);for(var d=0;d<b.length;d++){var e=aa(a,b[d],c);if(e)return e}return null}function ba(a,b){var c=K.Hh(a,b);if(c==K.Tm)throw"Subscene not in graph";for(var d=[],e=K.jp(a,c),f=0;f<e;f++){var g=K.Vi(a,
c,f);g!=c&&d.push(K.Da(a,g))}return d}function B(a,b){var c=K.Hh(a,b);if(c==K.Tm)throw"Subscene not in graph";for(var d=[],e=K.pg(a,c),f=0;f<e;f++){var g=K.fg(a,c,f);g!=c&&d.push(K.Da(a,g))}return d}function ea(a){var b=[],c=[];s(a,function(a){a.pa&&-1==b.indexOf(a.pa)&&(b.push(a.pa),c.push(a.pa,b.length-1))});return c}function pa(a,b){var c;c=""+(a.G+"\\n");c+="NONE"!=a.V?a.V+"\\n":"";c+="(";if(a.Lg){var d=a.qe;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;
if("SCREEN"!=a.G){c+=" ";if(a.Og)c+="RR";else{var d=a.ca,e=a.ba,f="";d==Y.s?f+="L":d==Y.qc&&(f+="N");e==Y.s?f+="L":e==Y.qc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.pa&&(c+=" "+b[d+1])}return c+")\\n"}var W=n("__camera"),Da=n("__config"),ma=n("__debug"),K=n("__graph"),ta=n("__renderer"),Y=n("__textures"),Ra=n("__util");n("vec4");var Na=Da.lh,Ia=Da.n,za=Da.Zh;a.tu=function(a,d){var e=K.create(),f=a.M[0],g=d.Al,B=d.zr,p=d.Fb,q=d.Ba,J=I("OPAQUE",f,!0,q,g,p,B,null,d.Ed);K.o(e,J);var m=I("BLEND",
f,!0,q,g,p,B,null,null);K.o(e,m);K.i(e,J,m,A("SCREEN","NONE",1,1,!0));if(d.oc){var z=I("XRAY",f,!1,q,g,p,B,null,d.Ed);K.o(e,z);K.i(e,m,z,A("SCREEN","NONE",1,1,!0))}B=ja();K.o(e,B);Ia.wireframe_debug?(f=x(f),K.o(e,f),d.oc?K.i(e,z,f,A("SCREEN","NONE",1,1,!0)):K.i(e,m,f,A("SCREEN","NONE",1,1,!0)),K.i(e,f,B,A("SCREEN","NONE",1,1,!0))):K.i(e,m,B,A("SCREEN","NONE",1,1,!0));d.Ik&&(f=b(J.h),a.M.push(f),m=H(f,!1),K.o(e,m),d.oc?(f=b(J.h),a.M.push(f),J=H(f,!0),K.o(e,J),K.i(e,m,J,A("COLOR","COLOR",1,1,!0)),K.i(e,
J,B,A("COLOR","NONE",1,1,!0)),K.i(e,J,B,A("DEPTH","NONE",1,1,!0))):(K.i(e,m,B,A("COLOR","NONE",1,1,!0)),K.i(e,m,B,A("DEPTH","NONE",1,1,!0))));d.ci.procedural_skydome&&(g=Q(g,d.ci),K.o(e,g),K.i(e,g,B,A("CUBEMAP","u_sky",za.jh,1,!1)));c(e,!0);1<Ia.resolution_factor&&k(e);h(e);y(e);return e};a.Tt=f;a.Jy=s;a.su=function(a,e,f){var g=K.create(),B=[],m=[],l=[],r=[],ea=[],s=[],t=[],v=[],fa=[],ba=[],aa=[],n=e.Al,C=e.Ba,pa=e.bm,na=e.Ff,ta=e.hg,Da=e.qg,Lb=e.px,bd=e.Pf,Sc=e.ng,cd=e.Uf,Tc=e.antialiasing,uc=e.zr,
mb=e.Fb,Ya=e.yc,yb=e.Ow,dc=e.At,Mb=e.Lt,Ub=e.iw,Vb=e.fw,lc=e.Yf,va=[];if(Ia.anaglyph_use&&!a){var Nb=f.M[0],db=b(Nb);W.Dp(Nb,W.ub);W.Dp(db,W.Cb);va.push(Nb,db);f.M.push(db)}else{var ra=f.M[0];va.push(ra)}if(pa){W.Yj(va[0],Ya);for(var zb=Ya.csm_num,da=0;da<zb;da++){var Ua=d(da,Ya);K.o(g,Ua);ba.push(Ua);var eb=Ya.csm_resolution,ra=Ua.h;ra.width=eb;ra.height=eb;Ua.aa=!1;aa.push(A("DEPTH","u_shadow_map"+da,eb,1,!1));ma.Jn()&&Ua.Z.push(A("COLOR","COLOR",eb,1,!1))}}if(0<Lb.length&&!a)for(da=0;da<va.length;da++){ra=
b(va[da]);f.M.push(ra);var la=I("REFLECT",ra,!1,C,n,mb,uc,null,e.Ed);la.hb=Lb[0];la.h.hb=Lb[0];K.o(g,la);s.push(la);t.push(A("COLOR","u_reflectmap",1,Ia.Vh,!0));la.Z.push(A("DEPTH","DEPTH",1,Ia.Vh,!0))}B=[];m=[];if(e.ya){var Ka=u();K.o(g,Ka);eb=za.$i;Ka.h.width=eb;Ka.h.height=eb;var fb=A("DEPTH","u_grass_map_depth",eb,1,!1);fb.ca=Y.s;fb.ba=Y.s;var ua=A("COLOR","u_grass_map_color",eb,1,!1);ua.ca=Y.s;ua.ba=Y.s}else ua=fb=Ka=null;for(da=0;da<va.length;da++){var ra=va[da],Va=b(ra);f.M.push(Va);if(pa){var oa=
M(Va,Ya);K.o(g,oa);for(var La=0;La<ba.length;La++){var Ua=ba[La],Ab=aa[La];K.i(g,Ua,oa,Ab)}var ec=A("COLOR","u_color",1,1,!0),$b=A("DEPTH","u_depth",1,1,!0);if(na){var ac=b(ra);f.M.push(ac);var ub=e.ry,Bb=G(ac,mb,ub);K.o(g,Bb);var mc=A("COLOR","u_ssao_mask",1,1,!0);K.i(g,oa,Bb,ec);K.i(g,oa,Bb,$b);var Cb=b(ra);f.M.push(Cb);var vb=D(Cb,ub);K.o(g,vb);var nc=A("COLOR","u_shadow_mask",1,1,!0);K.i(g,Bb,vb,mc);K.i(g,oa,vb,$b)}var Ob=b(Va);f.M.push(Ob);var Ma=q(Ob);K.o(g,Ma);K.i(g,oa,Ma,A("DEPTH","u_depth",
1,1,!0));l.push(Ma);var bc=A("DEPTH","DEPTH",1,1,!0);ea.push(bc)}else oa=M(Va,Ya),K.o(g,oa),bc=A("DEPTH","DEPTH",1,1,!0),ea.push(bc),ma.Jn()&&oa.Z.push(A("COLOR","COLOR",1,1,!0)),Ob=b(Va),f.M.push(Ob),Ma=q(Ob),K.o(g,Ma),K.i(g,oa,Ma,A("DEPTH","u_depth",1,1,!0)),l.push(Ma);Ka&&(K.i(g,Ka,oa,fb),K.i(g,Ka,oa,ua));la=I("OPAQUE",ra,!1,C,n,mb,uc,null,e.Ed);K.o(g,la);m.push(la);K.i(g,oa,la,ea[da]);mc?K.i(g,vb,la,nc):K.i(g,oa,la,A("COLOR","u_shadow_mask",1,1,!0));var oc=A("COLOR","u_color",1,1,!0);r.push(A("COLOR",
"COLOR",1,1,!0));Ka&&(K.i(g,Ka,la,fb),K.i(g,Ka,la,ua));s.length&&(K.i(g,s[da],la,t[da]),la.hb=Lb[0])}B=m;m=[];if(!a&&e.Ik){ra=b(B[0].h);f.M.push(ra);var Qa=H(ra,!1);K.o(g,Qa);if(e.oc){ra=b(B[0].h);f.M.push(ra);var nb=H(ra,!0);K.o(g,nb);K.i(g,Qa,nb,A("COLOR","COLOR",1,1,!0));K.i(g,Qa,nb,A("DEPTH","DEPTH",1,1,!0))}}else Qa=null;if(Da&&!a)for(da=0;da<va.length;da++){var Db=X();K.o(g,Db);K.i(g,B[da],Db,oc);v.push(Db);fa.push(A("COLOR","u_refractmap",1,1,!0))}for(var pc=[],da=0;da<va.length;da++){oa=l[da];
ra=b(va[da]);f.M.push(ra);la=I("BLEND",ra,!1,C,n,mb,uc,Ya,e.Ed);m.push(la);K.o(g,la);K.i(g,B[da],la,r[da]);K.i(g,B[da],la,ea[da]);Ka&&(K.i(g,Ka,la,fb),K.i(g,Ka,la,ua));for(La=0;La<ba.length;La++)Ua=ba[La],Ab=aa[La],K.i(g,Ua,la,Ab);if("DEPTH_PACK"==oa.type){var Fa=A("COLOR","u_scene_depth",1,1,!0);Fa.ca=Y.qc;Fa.ba=Y.qc}else Fa=A("DEPTH","u_scene_depth",1,1,!0),Fa.ca=Y.s,Fa.ba=Y.s;K.i(g,oa,la,Fa);s.length&&(K.i(g,s[da],la,t[da]),la.hb=Lb[0]);v.length&&K.i(g,v[da],la,fa[da]);pc.push(la)}B=m;m=[];if(e.oc){for(da=
0;da<va.length;da++){oa=l[da];ra=b(va[da]);f.M.push(ra);la=I("XRAY",ra,!1,C,n,mb,uc,Ya,e.Ed);m.push(la);K.o(g,la);K.i(g,B[da],la,r[da]);K.i(g,B[da],la,ea[da]);Ka&&(K.i(g,Ka,la,fb),K.i(g,Ka,la,ua));for(La=0;La<ba.length;La++)Ua=ba[La],Ab=aa[La],K.i(g,Ua,la,Ab);"DEPTH_PACK"==oa.type?(Fa=A("COLOR","u_scene_depth",1,1,!0),Fa.ca=Y.qc,Fa.ba=Y.qc):(Fa=A("DEPTH","u_scene_depth",1,1,!0),Fa.ca=Y.s,Fa.ba=Y.s);K.i(g,oa,la,Fa);s.length&&(K.i(g,s[da],la,t[da]),la.hb=Lb[0]);v.length&&K.i(g,v[da],la,fa[da])}B=m;
m=[]}if(Ia.wireframe_debug){for(da=0;da<va.length;da++){ra=Ra.ta(va[da]);f.M.push(ra);var Oa=x(ra);m.push(Oa);K.o(g,Oa);K.i(g,B[da],Oa,r[da]);K.i(g,B[da],Oa,ea[da]);Ka&&(K.i(g,Ka,Oa,fb),K.i(g,Ka,Oa,ua))}B=m;m=[]}if(ta&&!a){for(da=0;da<va.length;da++){var E=Ub.lg,ka=Ub.tw,Ba=Ub.Dg,qa=B[da],Wb=C?1:0,Z=A("DEPTH","u_input",1,1,!0);Z.ca=Y.s;Z.ba=Y.s;var jb=A("COLOR","u_input",1,.25,!0);jb.ca=Y.s;jb.ba=Y.s;var kb=E/Ba,Pb=b(va[da]);f.M.push(Pb);var ob=N(Pb,Wb,E,!0,kb,n,Ba);K.o(g,ob);K.i(g,qa,ob,Z);var kb=
E/Ba*.5,Qb=b(va[da]);f.M.push(Qb);var wb=N(Qb,Wb,E,!1,kb,n,Ba);K.o(g,wb);K.i(g,ob,wb,jb);var kb=E/Ba*.25,Eb=b(va[da]);f.M.push(Eb);var Rb=N(Eb,Wb,E,!1,kb,n,Ba);K.o(g,Rb);K.i(g,wb,Rb,jb);s.length&&(ob.hb=Lb[0],wb.hb=Lb[0],Rb.hb=Lb[0]);var Aa=ca(ka,n);m.push(Aa);K.o(g,Aa);K.i(g,qa,Aa,A("COLOR","u_main",1,1,!0));K.i(g,Rb,Aa,A("COLOR","u_god_rays",1,1,!0))}B=m;m=[]}if(bd&&!a){for(da=0;da<va.length;da++){var qa=B[da],Ga=ga();K.o(g,Ga);K.i(g,qa,Ga,A("COLOR","u_input",1,1,!0));var Ec=S();K.o(g,Ec);Ec.h.width=
1;Ec.h.height=1;var Fb=A("COLOR","u_input",1,.25,!0);Fb.ca=Y.s;Fb.ba=Y.s;var vc=A("COLOR","u_luminance",1,.25,!0);vc.ca=Y.s;vc.ba=Y.s;K.i(g,Ga,Ec,Fb);var Fc=dc.key,jd=dc.Vu,Xb=b(va[da]);f.M.push(Xb);var fc=z(Fc,jd,n,Xb);K.o(g,fc);K.i(g,qa,fc,A("COLOR","u_main",1,1,!0));K.i(g,Ga,fc,vc);K.i(g,Ec,fc,A("COLOR","u_average_lum",1,1,!1));var pb=A("COLOR","u_color",1,.25,!0);pb.ca=Y.s;pb.ba=Y.s;var Gb=p("X_BLUR");K.o(g,Gb);K.i(g,fc,Gb,pb);var qb=p("Y_BLUR");K.o(g,qb);K.i(g,Gb,qb,pb);var gc=J(dc.blur);K.o(g,
gc);var wc=A("COLOR","u_bloom",1,.25,!0);wc.ca=Y.s;wc.ba=Y.s;K.i(g,qb,gc,wc);K.i(g,qa,gc,A("COLOR","u_main",1,1,!0));m.push(gc)}B=m;m=[]}if(Sc&&!a){for(da=0;da<B.length;da++){var xc=B[da],xb=T(yb.nj,yb.oj);m.push(xb);K.o(g,xb);K.i(g,xc,xb,A("COLOR","u_mb_tex_curr",1,1,!0));xb.Z.push(A("COLOR","u_mb_tex_accum",1,1,!0))}B=m;m=[]}if(lc&&!a){for(da=0;da<B.length;da++){var qa=B[da],Hb=b(va[da]);f.M.push(Hb);pb=A("COLOR","u_color",1,1,!0);pb.ca=Y.s;pb.ba=Y.s;var Ib=w("X_BLUR");K.o(g,Ib);K.i(g,qa,Ib,pb);
var gb=w("Y_BLUR");K.o(g,gb);K.i(g,Ib,gb,pb);var oa=pc[da],Sb=L(Hb);Hb.dof_distance=f.dof_distance;Hb.Te=f.Te;Hb.dof_front=f.dof_front;Hb.dof_rear=f.dof_rear;Hb.dof_power=f.dof_power;Hb.dof_on=1;m.push(Sb);K.o(g,Sb);K.i(g,qa,Sb,A("COLOR","u_sharp",1,1,!0));K.i(g,gb,Sb,A("COLOR","u_blurred",1,1,!0));K.i(g,oa,Sb,A("DEPTH","u_depth",1,1,!0))}B=m;m=[]}if(!a&&e.glow){for(da=0;da<va.length;da++){var qa=B[da],yc=b(va[da]);f.M.push(yc);var hb=P(yc);K.o(g,hb);var zc=w("X_EXTEND"),Uc=A("COLOR","u_color",1,
1,!0),ld=A("COLOR","u_glow_mask",1,1,!0);zc.Ah=!0;K.o(g,zc);K.i(g,hb,zc,Uc);var hc=A("COLOR","u_color",1,.5,!0);hc.ca=Y.s;hc.ba=Y.s;var qc=w("Y_EXTEND");qc.Ah=!0;K.o(g,qc);K.i(g,zc,qc,hc);Ib=w("X_BLUR");Ib.Ah=!0;K.o(g,Ib);K.i(g,qc,Ib,hc);var Gc=A("COLOR","u_color",1,.25,!0);Gc.ca=Y.s;Gc.ba=Y.s;var rb=A("COLOR","u_glow_mask_blurred",1,.25,!0);rb.ca=Y.s;rb.ba=Y.s;gb=w("Y_BLUR");gb.Ah=!0;K.o(g,gb);K.i(g,Ib,gb,Gc);var Ac=R(Vb);K.o(g,Ac);K.i(g,qa,Ac,A("COLOR","u_glow_src",1,1,!0));K.i(g,hb,Ac,ld);K.i(g,
gb,Ac,rb);m.push(Ac)}B=m;m=[]}if(cd&&!a){for(da=0;da<B.length;da++){var qa=B[da],Vc=U(Mb.brightness,Mb.contrast,Mb.exposure,Mb.saturation);K.o(g,Vc);K.i(g,qa,Vc,A("COLOR","u_color",1,1,!0));m.push(Vc)}B=m;m=[]}if(Tc&&!a){for(da=0;da<B.length;da++)if(qa=B[da],Ia.smaa){var rc=A("COLOR","u_color",1,1,!0);rc.ca=Y.s;rc.ba=Y.s;var Hc=O("SMAA_EDGE_DETECTION");K.o(g,Hc);K.i(g,qa,Hc,rc);var Sa=O("SMAA_BLENDING_WEIGHT_CALCULATION");K.o(g,Sa);K.i(g,Hc,Sa,rc);var sc=A("COLOR","u_search_tex",1,1,!1),Ic=A("COLOR",
"u_area_tex",1,1,!1);sc.ca=Y.s;sc.ba=Y.s;Ic.ca=Y.s;Ic.ba=Y.s;Sa.Z.push(sc);Sa.Z.push(Ic);var tc=O("SMAA_NEIGHBORHOOD_BLENDING");K.o(g,tc);K.i(g,qa,tc,rc);var Wc=A("COLOR","u_blend",1,1,!0);Wc.ca=Y.s;Wc.ba=Y.s;K.i(g,Sa,tc,Wc);m.push(tc)}else{var Bc=V();K.o(g,Bc);var Jc=A("COLOR","u_color",1,1,!0);Jc.ca=Y.s;Jc.ba=Y.s;K.i(g,qa,Bc,Jc);if(1<Ia.resolution_factor){var Xc=w("NONE");K.o(g,Xc);K.i(g,Bc,Xc,Jc);m.push(Xc)}else m.push(Bc)}B=m;m=[]}if(Ia.anaglyph_use&&!a){var Kc=F();K.o(g,Kc);K.i(g,B[0],Kc,A("COLOR",
"u_sampler_left",1,1,!0));K.i(g,B[1],Kc,A("COLOR","u_sampler_right",1,1,!0));m.push(Kc)}else m.push(B[0]);var kd=K.Hh(g,B[0]),Yc=!1;K.ve(g,kd,function(a,b,c){if(c.G==c.V)return Yc=!0});if(Yc||a){var cc=ia();K.o(g,cc);K.i(g,B[0],cc,A("COLOR","u_color",1,1,!0));B=m;m=[];m.push(cc)}Qa&&(nb?m.push(nb):m.push(Qa));if(!a&&e.ci.procedural_skydome){var jc=Q(n,e.ci);K.o(g,jc);m.push(jc)}var Tb=ja();K.o(g,Tb);if(Na.enabled){var Lc=w("NONE");K.o(g,Lc)}for(da=0;da<m.length;da++)switch(m[da].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":K.i(g,
m[da],Tb,A("COLOR","NONE",1,1,!0));K.i(g,m[da],Tb,A("DEPTH","NONE",1,1,!0));break;case "SKY":K.i(g,jc,Tb,A("CUBEMAP","u_sky",za.jh,1,!1));break;default:K.i(g,m[da],Na.enabled?Lc:Tb,A("SCREEN","NONE",1,1,!0))}if(Na.enabled){var Cc=null,Zc=0;K.K(g,function(a,b){if(b.type==Na.Ay){if(Zc==Na.zy)return Cc=b,!0;Zc++}});if(Cc){var ed=K.Hh(g,Cc);K.ue(g,function(a,b,c){if(a==ed)return K.i(g,Cc,Lc,A(Na.cy,"u_color",c.size,c.qe,c.Lg)),K.i(g,Lc,Tb,A("SCREEN","NONE",.5,.5,!0)),!0})}}for(var Mc=K.Vo(g),da=0;da<
Mc.length;da++)for(var $c=Mc[da],La=0;La<l.length;La++)oa=l[La],K.Da(g,$c)==oa&&K.sg(g,$c);c(g,!1);1<Ia.resolution_factor&&k(g);h(g);y(g);return g};a.WA=C;a.tA=function(a){var b=null;K.K(a,function(a,c){return c.h&&null===c.h.Xd?(b=c,!0):!1});return b};a.eb=function(a,b,c){a=ba(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.PA=na;a.nw=fa;a.iv=aa;a.Po=ba;a.JA=B;a.Ma=function(a,b){var c=null;K.K(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Iu=function(a){var b=
"digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ea(a);K.K(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.Qh.replace(/_/g," ")+")");if(d.h){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.cb&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.hc&&(f+="D"+c[g+1])}d.Z.length&&(f+="\\n-----\\n");for(g=0;g<d.Z.length;g++)f+=pa(d.Z[g],c);g="SINK"==
d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});K.ue(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+pa(e,c)+'" style="'+(e.xa?"solid":"dotted")+'"];\n'});return b+="}"};a.eo=function(a){a=K.Gy(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,n){function b(){return{name:"",type:0,source:"",width:0,height:0,Kk:1,ui:!0,om:1024,Qf:null,Sa:null,gj:!1,O:0,pb:0,fl:0,cz:!1,hi:!1,Hp:0,qh:0,Bb:0,Ga:null,Tg:null}}function c(c,d,e){var f=c.type,h=new Uint8Array([204,204,204,255]),k=b();switch(f){case "DATA_TEX2D":case "IMAGE":var l=u.createTexture(),v=u.TEXTURE_2D;u.bindTexture(v,l);u.texImage2D(v,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,h);c.image&&"MOVIE"==c.image.source&&(k.gj=!0,k.O=c.frame_start,k.pb=c.frame_offset,
k.fl=c.frame_duration,k.cz=c.use_auto_refresh,k.hi=c.use_cyclic,k.Hp=c.movie_length,0!=k.pb&&r.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=u.createTexture();v=u.TEXTURE_2D;u.bindTexture(v,l);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(e=t.keysearch("name",c.b4w_source_id,e)))k.tj=e,k.om=c.b4w_source_size,e.$m=!0,u.texImage2D(v,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,
h);else return null;break;case "ENVIRONMENT_MAP":l=u.createTexture();v=u.TEXTURE_CUBE_MAP;u.bindTexture(v,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)u.texImage2D(u["TEXTURE_CUBE_MAP_"+e[n]],0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,h);break;case "VORONOI":case "BLEND":return null;default:return r.error('B4W warning: texture "'+c.name+'" has unsupported type "'+f+'"'),null}"NONE"==f||"DATA_TEX2D"==f?u.texParameteri(v,u.TEXTURE_MIN_FILTER,u.LINEAR):
u.texParameteri(v,u.TEXTURE_MIN_FILTER,w[s.Rj]);u.texParameteri(v,u.TEXTURE_MAG_FILTER,u.LINEAR);h=v;e=c.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&s.vi&&(d=m.Fv())&&(e=parseFloat(e.split("x")[0]),u.texParameterf(h,d.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(u.texParameteri(v,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(v,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE)):(u.texParameteri(v,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(v,u.TEXTURE_WRAP_T,u.REPEAT));
k.type=a.Nf;k.width=1;k.height=1;k.Ga=l;k.Bb=v;"CANVAS"==c.b4w_source_type&&"NONE"==f?(f=c.b4w_source_id,l=c.b4w_source_size,k.name=f,k.source="CANVAS",v=document.createElement("canvas"),v.setAttribute("id",f),v.width=l,v.height=l,k.Qf=v.getContext("2d"),C[f]=k,g(k)):(k.name=c.name,k.source=f,u.generateMipmap(v),u.bindTexture(v,null));return c.d=k}function g(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Bb;u.bindTexture(b,a.Ga);var c=h(a),d=k(a),e=a.Qf.canvas;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,
!0);u.texImage2D(b,0,c,c,d,e);u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!1);u.bindTexture(b,null);a.width=e.width;a.height=e.height}function f(a){u.texParameteri(a,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(a,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.texParameteri(a,u.TEXTURE_MAG_FILTER,u.LINEAR);u.texParameteri(a,u.TEXTURE_MIN_FILTER,u.LINEAR)}function l(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function h(b){switch(b.type){case a.Nf:b=
u.RGBA;break;case a.ik:b=u.RGB;break;case a.qi:b=u.RGBA;break;case a.ri:b=u.RGB;break;case a.Wg:b=u.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function k(b){switch(b.type){case a.Nf:b=u.UNSIGNED_BYTE;break;case a.ik:b=u.UNSIGNED_BYTE;break;case a.qi:b=u.FLOAT;break;case a.ri:b=u.FLOAT;break;case a.Wg:b=u.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}var e=n("__config"),r=n("__print"),v=n("__dds"),m=n("__extensions"),t=n("__util"),s=e.n,y=e.Ld,d=e.Bd;a.qc=0;
a.s=0;a.Ls=0;a.Js=0;a.Ks=0;a.Is=0;a.Nf=10;a.ik=20;a.qi=30;a.ri=40;a.Wg=50;a.Mf=60;var C={},A={},u=null,w;a.Xb=function(b){w=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.qc=b.NEAREST;a.s=b.LINEAR;a.Ls=b.NEAREST_MIPMAP_NEAREST;a.Js=b.LINEAR_MIPMAP_NEAREST;a.Ks=b.NEAREST_MIPMAP_LINEAR;a.Is=b.LINEAR_MIPMAP_LINEAR;u=b};a.Jv=function(a){return a in C?C[a].Qf:null};a.Qy=function(a){return a in C?(g(C[a]),!0):!1};a.Ni=function(c,d){var e=b();e.name=c;
e.type=d;e.source="NONE";if(d==a.Mf)e.Tg=u.createRenderbuffer();else{var f=u.TEXTURE_2D,g=u.createTexture();u.bindTexture(f,g);u.texParameteri(f,u.TEXTURE_MAG_FILTER,u.LINEAR);u.texParameteri(f,u.TEXTURE_MIN_FILTER,u.LINEAR);u.texParameteri(f,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(f,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.bindTexture(f,null);e.Bb=f;e.Ga=g}return e};a.iu=function(c){var d=u.createTexture(),e=u.TEXTURE_CUBE_MAP;u.bindTexture(e,d);u.texParameteri(e,u.TEXTURE_MAG_FILTER,u.LINEAR);
u.texParameteri(e,u.TEXTURE_MIN_FILTER,u.LINEAR);u.texParameteri(e,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(e,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)u.texImage2D(u[f[g]],0,u.RGBA,c,c,0,u.RGBA,u.UNSIGNED_BYTE,null);u.bindTexture(e,null);e=b();e.name="CUBEMAP";e.type=a.Nf;e.source="NONE";e.width=
3*c;e.height=2*c;e.Kk=1;e.Ga=d;e.Bb=u.TEXTURE_CUBE_MAP;return e};a.Jj=function(b,c,d){if(b.type!=a.Mf){var e=b.Bb;u.bindTexture(e,b.Ga);c&&u.texParameteri(e,u.TEXTURE_MIN_FILTER,c);d&&u.texParameteri(e,u.TEXTURE_MAG_FILTER,d);u.bindTexture(e,null)}};a.HA=function(b){if(b.type==a.Mf)return{min:a.qc,Hw:a.qc};var c=b.Bb;u.bindTexture(c,b.Ga);b=u.getTexParameter(c,u.TEXTURE_MIN_FILTER);var d=u.getTexParameter(c,u.TEXTURE_MAG_FILTER);u.bindTexture(c,null);return{min:b,Hw:d}};a.resize=function(b,c,d){c=
Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Mf)u.bindRenderbuffer(u.RENDERBUFFER,b.Tg),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,c,d),u.bindRenderbuffer(u.RENDERBUFFER,null);else{var e=b.Bb;u.bindTexture(e,b.Ga);var f=h(b),g=k(b);u.texImage2D(e,0,f,c,d,0,f,g,null);u.bindTexture(e,null)}c>s.qf||d>s.qf?r.error("B4W warning: texture has unsupported size",filepath):(b.width=c,b.height=d)}};a.Cu=c;a.az=function(a){var b=a.Bb;u.bindTexture(b,a.Ga);u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,
!0);4!=a.Sa.length?u.texImage2D(b,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,a.Sa):u.texImage2D(b,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,a.Sa);u.bindTexture(b,null)};a.$j=function(a,b,c,e){var g=a.source,h=a.Bb;u.bindTexture(h,a.Ga);if(4==b.length){var k=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(k)u.texImage2D(h,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=v.Xo(b);if(c.width>s.qf||c.height>s.qf){r.error("B4W warning: texture has unsupported size",
e);return}v.bz(u,m.To(),b,!0);l(c.width,c.height)&&(a.sn||r.warn("B4W warning: using NPOT-texture",e),f(h));a.width=c.width;a.height=c.height;a.Kk=v.Mv(b)}else{u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>s.qf||b.height>s.qf){r.error("B4W warning: texture has unsupported size",e);return}a.gj?(a.Sa=b,a.Sa.loop=a.hi,A[a.name]=a,a.qh=y.wa,b.duration&&(a.qh=a.Hp/b.duration),d.po||(b.playbackRate=y.wa/a.qh,d.Nn&&2<b.playbackRate&&(b.playbackRate=2))):u.texImage2D(h,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,
b);a.width=b.width;a.height=b.height;l(b.width,b.height)?(a.sn||r.warn("B4W warning: using NPOT-texture",e),f(h)):u.generateMipmap(h)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],k){for(k=0;6>k;k++)g=c[k],u.texImage2D(u["TEXTURE_CUBE_MAP_"+g[0]],0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!1);var t=b.width/3;if(t>s.Il||t>s.Il){r.error("B4W warning: cubemap has unsupported size",
e);return}for(k=0;6>k;k++){var g=c[k],w=document.createElement("canvas");w.width=t;w.height=t;var n=w.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(n.translate(0,t),n.scale(1,-1)):(n.translate(t,0),n.scale(-1,1));n.drawImage(b,g[1]*t,g[2]*t,t,t,0,0,t,t);u.texImage2D(u["TEXTURE_CUBE_MAP_"+g[0]],0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,w)}a.width=3*t;a.height=2*t;l(b.width/3,b.height/2)?(r.warn("B4W warning: using NPOT cube map texture",e),f(h)):u.generateMipmap(h)}else"DATA_TEX2D"==g&&(u.texImage2D(h,
0,u.RGBA,b.width,b.height,0,u.RGBA,u.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);u.bindTexture(h,null)};a.Qu=function(a){u.deleteTexture(a)};a.Ch=function(a){return a&&a.name&&(a.Ga||a.Tg)?!0:!1};a.rp=function(a){return a&&a.name&&a.Tg?!0:!1};a.bB=function(b){return b.type==a.qi||b.type==a.ri?!0:!1};a.$v=function(b){var c=0;switch(b.type){case a.Nf:case a.ik:c=4;break;case a.qi:case a.ri:c=16;break;case a.Wg:c=3;break;case a.Mf:c=2}return c};a.Av=function(a){var b=null,b={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(b,null,a);b.image={filepath:null};return b};a.cleanup=function(){C={};A={}};a.play_video=function(a){return a in A?(A[a].Sa.play(),!0):null};a.stop_video=function(a){return a in A?(A[a].Sa.pause(),!0):null};a.pause=function(){for(var a in A)A[a].Sa&&A[a].Sa.pause()};a.play=function(){for(var a in A)A[a].Sa&&A[a].Sa.play()}};b4w.module.__assets=function(a,n){function b(){return t.pp()?n(t.zb.Ei).data:null}function c(){var a={si:null,Ts:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.si=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var c=b();c&&a.si in c&&(a.status=200,c[a.si]&&(a.response=a.Ts(c[a.si])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function g(b){for(var c=0,d=0;d<b.length;d++){var g=b[d];20===g.state&&c++;if(c>=A.Mw)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:f(g,"arraybuffer");break;case a.AT_JSON:f(g,"json");break;case a.AT_TEXT:f(g,"text");break;case a.AT_AUDIOBUFFER:l(g);break;case a.AT_IMAGE_ELEMENT:h(g);
break;case a.AT_AUDIO_ELEMENT:k(g);break;case a.gk:e(g);break;default:throw"Wrong asset type: "+g.type;}}}function f(a,d){var e=b(),f=e&&a.q in e?new c:new XMLHttpRequest;f.open("GET",a.q,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&"string"==typeof b)try{b=
JSON.parse(b)}catch(c){a.vb(null,a.uri,a.type,a.q);s.error(c+" (parsing JSON "+a.q+")");return}a.vb(b,a.uri,a.type,a.q)}else a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: empty responce when trying to get "+a.q)}else a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: "+f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.jx(b.loaded/b.total)},!1);f.send(null)}function l(a){var d=b(),e=d&&a.q in d?new c:new XMLHttpRequest;e.open("GET",a.q,
!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?y.Mu(b,function(b){a.vb(b,a.uri,a.type,a.q);a.state=30},function(){a.vb(null,a.uri,a.type,a.q);s.error("B4W Error: failed to decode "+a.q);a.state=30}):(a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: empty responce when trying to get "+a.q),a.state=30)}else a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: "+e.status+" when trying to get "+a.q),a.state=
30};e.send(null)}function h(a){var c=document.createElement("img");u.ah&&(c.crossOrigin="Anonymous");c.onload=function(){40!=a.state&&(a.vb(c,a.uri,a.type,a.q),a.state=30)};c.addEventListener("error",function(){40!=a.state&&(a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: could not load image: "+a.q),a.state=30)},!1);var d=b();if(d&&a.q in d)if(d[a.q]){var e=r(a.q);c.src="data:"+e+";base64,"+d[a.q]}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.q}function k(a){var c=document.createElement("audio");
u.ah&&(c.crossOrigin="Anonymous");c.addEventListener("loadeddata",function(){40!=a.state&&(a.vb(c,a.uri,a.type,a.q),a.state=30)},!1);c.addEventListener("error",function(){40!=a.state&&(a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: could not load sound: "+a.q),a.state=30)},!1);var d=b();if(d&&a.q in d)if(d[a.q]){var e=v(a.q);c.src="data:"+e+";base64,"+d[a.q];40!=a.state&&(a.vb(c,a.uri,a.type,a.q),a.state=30)}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.q,u.ef&&c.load();setTimeout(function(){c.fy=
1},5E3)}function e(a){var c=document.createElement("video");c.muted=!0;if(u.ah||u.ef)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){40!=a.state&&(a.vb(c,a.uri,a.type,a.q),a.state=30)},!1);c.addEventListener("error",function(){40!=a.state&&(a.vb(null,a.uri,a.type,a.q),s.error("B4W Error: could not load video: "+a.q),a.state=30)},!1);var d=b();if(d&&a.q in d)if(d[a.q]){var e=m(a.q);c.src="data:"+e+";base64,"+d[a.q];40!=a.state&&(a.vb(c,a.uri,a.type,a.q),a.state=30)}else d=new CustomEvent("error"),
c.dispatchEvent(d);else c.src=a.q,u.ef&&c.load();setTimeout(function(){c.fy=1},1E4)}function r(a){var b="image";switch(d.ll(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function v(a){var b="audio";switch(d.ll(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function m(a){var b="video";switch(d.ll(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+=
"/webm";break;case "m4v":b+="/mp4"}return b}var t=n("__config"),s=n("__print"),y=n("__sfx"),d=n("__util"),C=n("__version"),A=t.Md,u=t.n;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.gk=70;var w=[],p=0,I={};a.Oj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Zv=function(a){if(I[a])return I[a];var b=A.kq?a+C.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");
c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return I[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<w.length;a++)w[a].state=40;w=[];p=0;I={}};a.enqueue=function(a,c,d,e){for(var f=0;f<a.length;f++){var h=a[f],h={uri:h[0],type:h[1],q:h[2],name:h[3],state:10,vb:c||function(){},cq:d||function(){},jx:e||function(){},dq:p};if(A.kq){var k=b();k&&h.q in k||(h.q+=C.timestamp())}w.push(h)}g(w);
p++};a.update=function(){g(w);for(var a=w,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.dq===a[b].dq?30!==e.state&&(c=!1):(c&&(a[d-1].cq(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].cq(),a.splice(b))}}};b4w.module.__loader=function(a,n){function b(b,e,f,g,h){var k=d,l=t.create(),r;for(r in e){var v=c(e[r]);(g&&v.Ua||!b&&v.rb)&&m(v);t.o(l,v)}for(r in e)for(v=e[r],v.name=r,b=0;b<v.C.length;b++)t.i(l,e[v.C[b]],v,null);e=c({name:"out",Fa:a.Fr,Ja:function(a,b,c,d,e){0===b.id&&(k.lq=!0);3!=b.status&&(b.status=2);h(b.id);e(b,c);s.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")}});var q=[];if(f)for(f=t.Vo(l),b=0;b<f.length;b++)q.push(t.Da(l,f[b]));else t.K(l,function(a,b){b.Ta||q.push(b)});t.o(l,
e);for(b=0;b<q.length;b++)e.C.push(q[b].name),t.i(l,q[b],e,null);return l}function c(a){a.Ta=a.Ta||!1;a.Fa||0===a.Fa||(a.Fa=a.Bc);a.C=a.C||[];a.zh=a.zh||!1;a.km=a.km||!1;a.ib=a.ib||0;a.Ua=a.Ua||!1;a.rb=a.rb||!1;a.status=0;a.lB=0;a.Cl=0;a.Oe=a.Oe||null;return a}function g(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];t.Da(a.Qc,f).zh&&(t.we(a.Qc,f,function(d){var e=!0;t.ve(a.Qc,d,function(a,b){if(!b.zh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function f(a){function b(c,d){var e=t.Da(a.Qc,c),f=t.Da(a.Qc,d),g=f.Fa-e.Fa;0==g&&(g=e.Ta-f.Ta);return g}var c=[],d=a.Dd,e=!1;do{var f=g(a,d);c.push.apply(c,d);0<f.length&&(e=!0);d=f}while(0<f.length);e&&c.sort(b);a.Dd=c;return a.Dd.length}function l(a,b,c){if(b.km)return b.zh=!0,k(a,b),!1;if(!b.Ja&&!b.Rf&&!b.fh)return k(a,b),!1;if(0==b.status&&(b.status++,b.Ja))return b.Ja(c,a,b,b.Oe,k,e),!0;if(1==b.status){if(b.Rf)return b.Rf(c,a,b,b.Oe,k,e),!0;b.status++}return 2==
b.status&&(b.status++,b.fh)?(b.fh(c,a,b,b.Oe,k,e),!0):!1}function h(a){if(0==a.Pj)return 100;var b=0;t.K(a.Qc,function(c,d){a.do_not_load_resources&&d.Ua||(b+=d.Cl*d.ib)});return y.trunc(100*b/a.Pj)}function k(a,b){b.zh=!0;b.status=3;r(a,b,1)}function e(a,b,c){1>c?r(a,b,c):b.status++}function r(a,b,c){var e=d;if(b.Ja||b.Rf||b.fh)if(b.Cl=c,b=h(a),a.jo!=b||1==c)a.rm(b,performance.now()-a.dr),a.jo=b,e.Gl=!0}function v(a,b){var c=null;t.K(a.Qc,function(a,d){if(d.name==b)return c=d,1});return c}function m(a){a.km=
!0;a.Cl=1}var t=n("__graph"),s=n("__print"),y=n("__util");a.Bc=0;a.Be=1;a.Fr=2;var d=null;a.Uo=function(){return d};a.uu=function(){var a={Uc:[],Sk:0,mk:0,lq:!1,Gl:!1};return d=a};a.Du=function(a,c,e,f,g,h,k,m){var l=d,q={id:l.Uc.length,status:0,q:c,vn:"",Bp:m||!1,NB:h,dr:0,jo:0,Pj:0,cm:!1,rm:f||function(){},Xn:g||function(){},Qc:null,Dd:null,sl:!1,rl:!1,ul:!1};a=b(0===q.id,a,h,k,e||function(){});q.Qc=a;c=[];e=t.Xv(a);for(f=0;f<e.length;f++)c.push(e[f]);q.Dd=c;t.K(a,function(a,b){!(b.Ja||b.Rf||b.fh)||
q.do_not_load_resources&&b.Ua||(q.Pj+=b.ib)});l.Uc.push(q);l.mk++;return q.id};a.Yy=function(b){var c=d;if(c&&0!=d.mk)if(c.Gl)c.Gl=!1;else{var e=performance.now();do{var g=c.Uc[c.Sk],h=b[g.id];if(3!=g.status)if(0==g.status&&(g.status=1,g.dr=performance.now(),g.rm(0,0)),f(g)){var k=g,m=k.Dd.length;do{var r=t.Da(k.Qc,k.Dd[0]),s=l(k,r,h);r.Fa==a.Be&&(k.cm=!0);r=k.Dd.shift();k.Dd.push(r);m--}while(!s&&0!=m)}else g.Xn(h,g),g.status=3,c.mk--,k=g,k.rm=null,k.Xn=null,k.Qc=null,k.Dd=null;c.lq&&(c.Sk=(c.Sk+
1)%c.Uc.length);if(g.cm){g.cm=!1;break}}while(16>performance.now()-e)}};a.EB=e;a.lm=function(a,b){var c=v(a,b);null!==c&&m(c)};a.Fy=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=d;if(!b)return!1;a|=0;return b.Uc[a]&&(3==b.Uc[a].status||2==b.Uc[a].status)};a.cleanup=function(){d=null}};b4w.module.__nla=function(a,n){function b(){return{type:"CLIP",O:0,X:0,Ad:!1,paused:!1,Kd:"",fc:0,dn:0,Xs:0,wo:0,vo:0,stop_video:!1}}function c(a,b){for(var c=a.b4w_nla_script,d=b.Df,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",O:f.frame_range[0],X:f.frame_range[1],$d:!1});break;case "SELECT":case "SELECT_PLAY":var g=y.Wi(y.hk,f.object,0),h=y.Wv(a),k=h.indexOf(g);if(-1==k){s.error("NLA script error: non-selectable object");return}for(var f={type:f.type,Jq:"SELECT"==
f.type?f.target_slot:e+1,dy:e+1,le:-1,Hx:h.length,Gx:k,O:f.frame_range[0],X:f.frame_range[1],$d:!1},k=[],l=0;l<h.length;l++)k.push(m.create_selection_sensor(h[l],!0));m.create_sensor_manifold(g,"NLA_SELECT_"+e,m.CT_SHOT,k,m.Nu,function(a,c,d,e){if(!(b.Hb>=b.Df.length)&&(d=b.Df[b.Hb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.$d)){for(d=0;d<e.Hx;d++)if(m.get_sensor_value(a,c,d)&&d==e.Gx){e.le=1;return}e.le=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",mm:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
mm:f.target_slot,Yt:f.condition,Wh:f.register1,Xh:f.register2,Ql:f.number1,Rl:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",qx:f.registerd,Zw:f.number1});break;case "MATH":d.push({type:"MATH",ax:f.operation,Wh:f.register1,Xh:f.register2,Ql:f.number1,Rl:f.number2,Gj:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function g(a,b,c,d){if(a.Df.length){if(a.Hb>=a.Df.length)if(a.cyclic)a.Hb=0;else{a.pb-=A.wa*c;return}var e=l(a,b,d,!1),h=a.Df[a.Hb];switch(h.type){case "PLAY":h.$d?e>=
h.X&&(h.$d=!1,a.Hb++,g(a,b,c,d)):(a.pb+=h.O-e,h.$d=!0,f(a,h));break;case "SELECT":case "SELECT_PLAY":-1<h.le?"SELECT"==h.type||"SELECT_PLAY"==h.type&&0==h.le?(a.Hb=h.le?h.Jq:h.dy,h.le=-1,g(a,b,c,d)):h.$d?e>=h.X&&(h.$d=!1,a.Hb=h.Jq,h.le=-1,g(a,b,c,d)):(a.pb+=h.O-e,h.$d=!0,f(a,h)):a.pb-=A.wa*c;break;case "JUMP":a.Hb=h.mm;g(a,b,c,d);break;case "CONDJUMP":var e=-1==h.Wh?h.Ql:a.yd[h.Wh],k=-1==h.Xh?h.Rl:a.yd[h.Xh],m=!1;switch(h.Yt){case "EQUAL":e==k&&(m=!0);break;case "NOTEQUAL":e!=k&&(m=!0);break;case "LESS":e<
k&&(m=!0);break;case "GREATER":e>k&&(m=!0);break;case "LEQUAL":e<=k&&(m=!0);break;case "GEQUAL":e>=k&&(m=!0)}m?a.Hb=h.mm:a.Hb++;g(a,b,c,d);break;case "REGSTORE":a.yd[h.qx]=h.Zw;a.Hb++;g(a,b,c,d);break;case "MATH":e=-1==h.Wh?h.Ql:a.yd[h.Wh];k=-1==h.Xh?h.Rl:a.yd[h.Xh];switch(h.ax){case "ADD":a.yd[h.Gj]=e+k;break;case "MUL":a.yd[h.Gj]=e*k;break;case "SUB":a.yd[h.Gj]=e-k;break;case "DIV":0==k&&C.ea("Division by zero in NLA script"),a.yd[h.Gj]=e/k}a.Hb++;g(a,b,c,d);break;case "NOOP":a.Hb++,g(a,b,c,d)}}}
function f(a,b){for(var c=a.Df,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.le=-1)}}function l(a,b,c,d){b=(b-c)*A.wa+a.pb-a.O;a.cyclic&&d&&(b%=a.X-a.O+1);return b+=a.O}function h(a,b){b?a.Sa.pause():(a.Sa.currentTime=a.pb/A.wa,a.Sa.play())}function k(a,c){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],k=b();k.type=h.type;k.O=h.frame_start;k.X=h.frame_end;k.Kd=h.action?h.action.name:"";k.fc=c;k.dn=h.action_frame_start;k.Xs=h.action_frame_end;d.push(k)}}return d}
function e(a){return d.be(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var r=n("__animation"),v=n("__camera"),m=n("__controls"),t=n("__config");n("__loader");n("__particles");var s=n("__print"),y=n("__scenes"),d=n("__sfx"),C=n("__util"),A=t.Ld,u=[],w=-1;a.Xy=function(a,f){var g={O:a.frame_start,X:a.frame_end,pb:0,Dh:-1,cyclic:f,wd:[],S:[],Df:[],Hb:0,yd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};c(a,g);for(var h=y.na(a,"ALL",y.DATA_ID_ALL),m=0;m<h.length;m++){var l=h[m],
t=0,w=[],n=l.animation_data;if(n&&n.nla_tracks.length&&(n=n.nla_tracks,C.df(l)||v.is_camera(l)||C.uc(l)||C.ww(l)||d.be(l))){var A=k(n,t);A.length&&(w=w.concat(A),t++)}e(l)&&(n=l.data.animation_data.nla_tracks,A=k(n,t),A.length&&(w=w.concat(A),t++));if(r.ql(l))for(var U=l.data.materials,T=0;T<U.length;T++)if(A=U[T].node_tree,n=A.animation_data,A&&n){for(var n=n.nla_tracks,A=k(n,-1),L=[],P=0;P<A.length;P++)n=A[P],-1==L.indexOf(n.Kd)&&L.push(n.Kd),n.fc=t+L.indexOf(n.Kd),w.push(n);t+=L.length}for(T=0;T<
l.particle_systems.length;T++)U=l.particle_systems[T],n=U.settings,"EMITTER"==n.type&&n.b4w_allow_nla&&(n=b(),n.type="CLIP",n.O=g.O,n.X=g.X+1,n.Kd=U.name,n.fc=t,w.push(n),t++);U=t+1;if(C.uc(l)&&l.data)for(T=0;T<l.data.b4w_vertex_anim.length;T++)A=l.data.b4w_vertex_anim[T],A.allow_nla&&(t=U,n=b(),n.type="CLIP",n.O=g.O,n.X=g.X+1,n.Kd=A.name,n.fc=t,w.push(n));w.length&&(l.kk=w,g.wd.push(l))}h=a.d.Qg;for(T=0;T<h.length;T++)n=b(),m=h[T].d,n.type="VIDEO",n.O=Math.min(m.O,g.X),n.X=m.hi?g.X:Math.min(m.fl+
m.O+m.pb,g.X),n.Kd=h[T].name,m.Ss=n,g.S.push(m);T=g.O;h=g.X;for(m=0;m<g.wd.length;m++)for(l=g.wd[m],t=l.kk,w=0;w<t.length;w++)n=t[w],U=l.name+" ["+n.O+":"+n.X+"]",n.O=Math.max(T,n.O),n.X=Math.min(h+1,n.X),n.O>n.X&&(s.warn("NLA: out of scene range: "+U),t.splice(w,1),w--);for(T=0;T<g.wd.length;T++)for(h=g.wd[T].kk,m=0;m<h.length;m++){l=h[m];t=g.O;w=g.X+1;for(n=0;n<h.length;n++)U=h[n],l.fc==U.fc&&(U.X<=l.O&&(t=l.O),U.O>=l.X&&(w=Math.min(w,U.O)));l.wo=t;l.vo=w}u.push(g)};a.start=function(){w=0};a.update=
function(a,b){if(!(0>w)){0==w&&(w=a);for(var c=0;c<u.length;c++){var e=u[c];g(e,a,b,w);for(var f=l(e,a,w,!0),k=0;k<e.wd.length;k++){for(var m=e.wd[k],t=m.kk,s=0;s<t.length;s++){var v=t[s];"SOUND"==v.type&&f<e.Dh&&(v.Ad=!1)}for(s=0;s<t.length;s++)switch(v=t[s],v.type){case "CLIP":if(v.wo<=f&&f<v.vo&&!v.Ad){var n=m,y=v;r.apply(n,y.Kd,y.fc);r.set_behavior(n,r.AB_FINISH_STOP,y.fc);for(n=0;n<t.length;n++)t[n]!=v&&t[n].fc==v.fc&&(t[n].Ad=!1);v.Ad=!0}v.Ad&&(n=m,r.set_current_frame_float(n,f-v.O+v.dn,v.fc),
r.update_object_animation(n,0,v.fc));break;case "SOUND":(f<e.Dh||e.Dh<v.O)&&v.O<=f&&f<v.X&&!v.Ad&&(d.play(m,(v.O-f)/A.wa,(v.X-v.O)/A.wa),v.Ad=!0),e.Dh<v.X&&v.X<=f&&v.Ad&&(v.Ad=!1)}}for(k=0;k<e.S.length;k++)v=e.S[k].Ss,v.O<=Math.round(f)&&Math.round(f)<v.X&&!v.stop_video&&(h(e.S[k],v.stop_video),v.stop_video=!0),v.X<=Math.round(f)&&v.stop_video&&(h(e.S[k],v.stop_video),v.stop_video=!1);e.Dh=f}}};a.cleanup=function(){u.length=0;w=-1};a.gp=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||
e(a)||r.ql(a)?!0:!1}};b4w.module.__camera=function(a,n){function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function c(b){var c={type:b,name:"",qe:1,width:0,height:0,Xd:null,cb:null,hc:null,jb:0,od:0,Ea:0,La:0,left:0,right:0,top:0,bottom:0,Wd:new Float32Array(3),Bo:new Float32Array(3),quat:new Float32Array(4),fa:new Float32Array(16),Uz:new Float32Array(16),ka:new Float32Array(16),
Rg:new Float32Array(16),ix:new Float32Array(16),Oc:new Float32Array(16),Hq:new Float32Array(16),Jf:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Te:null,dof_on:0,gl:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ea:new Float32Array([0,0,0,0]),La:new Float32Array([0,0,0,0])},di:0,Rc:0,hb:null,ih:null,Pk:null,fo:new Float32Array(4),Bj:new Float32Array(4)};if(b==a.Za)return c;switch(b){case a.rc:l(c,
40,.1,1E3);break;case a.Of:l(c,2.5,.1,1E3);break;case a.Ce:break;case a.Xg:break;case a.Yg:break;case a.ub:case a.Cb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function g(b,c,d){if(b.type!=a.ub&&b.type!=a.Cb)throw"set_stereo_params(): wrong camera type";b.di=c;b.Rc=d;y(b,b.jb);if(G.W())for(c=G.get_active(),b=c.d.yc,c=c.camera.d.M,d=0;d<c.length;d++)w(c[d],b)}function f(a,b){var c=a.d,d=D.quat_to_dir(c.quat,D.AXIS_MY,X),e=Math.asin(d[1]/
V.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?D.quat_to_dir(c.quat,D.AXIS_MZ,N):D.quat_to_dir(c.quat,D.AXIS_Z,N)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function l(b,c,d,e,f){switch(b.type){case a.rc:case a.ub:case a.Cb:b.od=c;b.jb=1;break;case a.Of:b.top=c;b.jb=1;break;case a.Ce:delete b.od;b.od=c;b.jb=f/c;break;case a.Xg:b.top=c;b.jb=f/c;break;default:q.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ea=
d;b.La=e}function h(b,c){var e=c.d.e,f=c.d.quat,g=ga;L.rotateX(c.d.H,-Math.PI/2,g);L.invert(g,b.fa);if(b.hb){var g=b.hb[0],h=b.hb[1],k=b.hb[2],B=b.hb[3],m=ga;m[0]=1-2*g*g;m[1]=-2*g*h;m[2]=-2*g*k;m[3]=0;m[4]=-2*g*h;m[5]=1-2*h*h;m[6]=-2*h*k;m[7]=0;m[8]=-2*g*k;m[9]=-2*h*k;m[10]=1-2*k*k;m[11]=0;m[12]=-2*g*B;m[13]=-2*h*B;m[14]=-2*k*B;m[15]=1;L.multiply(b.fa,m,b.fa);y(b,b.jb,!0);g=Q;h=ga;L.invert(b.fa,h);L.transpose(h,h);O.transformMat4(b.hb,h,g);h=ia;h[0]=(D.sign(g[0])+b.ka[8])/b.ka[0];h[1]=(D.sign(g[1])+
b.ka[9])/b.ka[5];h[2]=-1;h[3]=(1+b.ka[10])/b.ka[14];O.scale(g,2/(g[0]*h[0]+g[1]*h[1]+g[2]*h[2]+g[3]*h[3]),g);b.ka[2]=g[0];b.ka[6]=g[1];b.ka[10]=g[2]+1;b.ka[14]=g[3]}b.type==a.ub?b.fa[12]+=b.Rc/2:b.type==a.Cb&&(b.fa[12]-=b.Rc/2);L.multiply(b.ka,b.fa,b.Jf);C(b);d(b);V.copy(b.Wd,b.Bo);V.copy(e,b.Wd);U.copy(f,b.quat)}function k(b,c,e,f){L.lookAt(c,e,f,b.fa);b.type==a.ub?b.fa[12]+=b.Rc/2:b.type==a.Cb&&(b.fa[12]-=b.Rc/2);L.multiply(b.ka,b.fa,b.Jf);C(b);d(b);V.copy(c,b.Wd)}function e(b){b=b.d;if(b.qb){var c=
X;b.da==a.MS_TARGET_CONTROLS?V.subtract(b.e,b.Wa,c):D.quat_to_dir(b.quat,D.AXIS_MY,c);c[1]=0;V.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.da==a.MS_EYE_CONTROLS&&(d*=-1);b.qb.left+=d;b.qb.right+=d}}function r(b){b=b.d;if(b.Aa){var c=X;b.da==a.MS_TARGET_CONTROLS?V.subtract(b.e,b.Wa,c):D.quat_to_dir(b.quat,D.AXIS_MY,c);V.normalize(c,c);c=Math.asin(c[1]);b.Aa.Qa+=c;b.Aa.Ka+=c}}function v(a){a=a.d;if(a.qb)if(a.Aa){var b=D.Ge(a.Aa.Qa+Math.PI/2),c=D.Ge(a.Aa.Ka+Math.PI/2);if(c>Math.PI)a.Aa=
{Ka:-Math.PI/2,Qa:Math.PI/2};else if(b>Math.PI||b<c)a.Aa.Qa=Math.PI/2}else a.Aa={Ka:-Math.PI/2,Qa:Math.PI/2}}function m(a){a=D.quat_to_dir(a.d.quat,D.AXIS_MY,X);V.normalize(a,a);return-Math.asin(a[1])}function t(a,b,c){if(b==c)return c-a;a=D.Ge(a);b=D.Ge(b);c=D.Ge(c);if(.001>Math.abs(b-c))return 0;b=2*Math.PI-b;c=D.Ge(c+b);a=D.Ge(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function s(a,b,c){a=a.d;var d=V.subtract(a.Wa,a.e,X);b=U.setAxisAngle(b,c,ca);V.transformQuat(d,b,d);V.subtract(a.Wa,d,a.e);
U.multiply(b,a.quat,a.quat)}function y(b,c,e){switch(b.type){case a.rc:if(!c)throw"No aspect ratio";b.jb=c;case a.Ce:L.perspective(D.lx(b.od),b.jb,b.Ea,b.La,b.ka);break;case a.Of:if(!c)throw"No aspect ratio";b.jb=c;case a.Xg:c=b.top*b.jb;L.ortho(-c,c,-b.top,b.top,b.Ea,b.La,b.ka);break;case a.Yg:L.ortho(b.left,b.right,b.bottom,b.top,b.Ea,b.La,b.ka);break;case a.ub:case a.Cb:if(!c)throw"No aspect ratio";b.jb=c;var f=Math.tan(b.od*Math.PI/360);c=b.Ea*f;var g=b.jb*b.di*f;b.type==a.ub?(f=g-b.Rc/2,g+=b.Rc/
2):(f=g+b.Rc/2,g-=b.Rc/2);f=-(b.Ea/b.di*f);g*=b.Ea/b.di;L.frustum(f,g,-c,c,b.Ea,b.La,b.ka);b.left=f;b.right=g;break;case a.Za:return;default:throw"Wrong camera type: "+b.type;}e||(L.multiply(b.ka,b.fa,b.Jf),C(b),d(b))}function d(a){L.copy(a.fa,a.Oc);a.Oc[12]=0;a.Oc[13]=0;a.Oc[14]=0;a.Oc[15]=1;L.multiply(a.ka,a.Oc,a.Oc);L.invert(a.Oc,a.Oc)}function C(a){L.copy(a.fa,a.Rg);L.multiply(a.ka,a.Rg,a.Rg);L.invert(a.Rg,a.Rg)}function A(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ea);d||(d=b.La);var g,h,
B,k,m,l,p,q;switch(b.type){case a.Za:throw"Extraction from NONE camera is not possible";case a.rc:case a.Ce:g=c*Math.tan(b.od*Math.PI/360);k=-g;h=g*b.jb;B=-h;m=d/c*g;q=-m;l=m*b.jb;p=-l;break;case a.Of:case a.Xg:B=b.top*b.jb;g=m=b.top;h=l=B;k=q=-b.top;B=p=-B;break;case a.Yg:g=m=b.top;h=l=b.right;k=q=b.bottom;B=p=b.left;break;case a.ub:case a.Cb:m=c/b.Ea;g=c*Math.tan(b.od*Math.PI/360);k=-g;h=b.right*m;B=b.left*m;p=d/c;m=g*p;q=-m;l=h*p;p*=B;break;default:throw"Wrong camera type: "+b.type;}e[0]=B;e[1]=
k;e[2]=-c;e[3]=h;e[4]=k;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=B;e[10]=g;e[11]=-c;e[12]=p;e[13]=q;e[14]=-d;e[15]=p;e[16]=m;e[17]=-d;e[18]=l;e[19]=m;e[20]=-d;e[21]=l;e[22]=q;e[23]=-d;f&&(c=ga,L.invert(b.fa,c),D.he(e,c,e,0));return e}function u(a){return"CAMERA"===a.type?!0:!1}function w(a,b){if(b.b4w_enable_csm){var c=b.csm_num;if(!a.ih){var e=b.csm_num;a.ih=Array(e);for(var d=0;d<e;d++)a.ih[d]=new Float32Array(3);a.Pk=new Float32Array(e)}for(e=0;e<c;e++){var d=0==e?a.Ea:p(b,a,e-1),f=p(b,a,e),d=A(a,d,
f,S),d=H.Sv(d);a.ih[e].set(d.t);a.Pk[e]=d.oa;a.fo[e]=V.length(d.t);a.Bj[e]=I(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,e)}}else a.Bj[0]=b.first_cascade_blur_radius}function p(a,b,c){var e=a.csm_num,d=D.clamp(a.csm_first_cascade_border,b.Ea,b.La);a=D.clamp(a.csm_last_cascade_border,b.Ea,b.La);return D.clamp(I(d,a,e,c),b.Ea,b.La)}function I(a,b,c,e){switch(e){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,e/(c-1))}return a}var H=n("__boundings"),x=n("__config"),M=n("__constraints"),
q=n("__print"),G=n("__scenes"),D=n("__util"),V=n("vec3"),O=n("vec4"),U=n("quat"),T=n("mat3"),L=n("mat4"),P=x.controls;a.Za=10;a.rc=20;a.Of=30;a.Ce=40;a.Xg=50;a.Yg=60;a.ub=70;a.Cb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var R=new Float32Array(2),X=new Float32Array(3),N=new Float32Array(3),ca=new Float32Array(4);new Float32Array(4);var Q=new Float32Array(4),ia=new Float32Array(4),F=new Float32Array(16),ga=new Float32Array(16),S=new Float32Array(24);
a.Kt=function(d){var f=d.d,g=d.data;switch(g.type){case "PERSP":var h=c(a.rc);if(g.angle_y)var k=g.angle_y/Math.PI*180;l(h,k,g.clip_start,g.clip_end);break;case "ORTHO":h=c(a.Of),l(h,g.ortho_scale/2,g.clip_start,g.clip_end)}h.name=d.name;f.Sj=P.It.slice();f.ir=!1;f.da=b(g.b4w_move_style);f.dof_distance=d.data.dof_distance;f.Te=d.data.dof_object;f.dof_front=d.data.b4w_dof_front;f.dof_rear=d.data.b4w_dof_rear;f.dof_power=d.data.b4w_dof_power;f.so=d.data.b4w_enable_hover_hor_rotation;f.M=[h];f.da==a.MS_TARGET_CONTROLS&&
f.Wa.set(g.b4w_target);f=d.d;if(f.da===a.MS_TARGET_CONTROLS||f.da===a.MS_EYE_CONTROLS||f.da===a.MS_HOVER_CONTROLS)g=d.data,f.da===a.MS_TARGET_CONTROLS||f.da===a.MS_EYE_CONTROLS?(g.b4w_use_horizontal_clamping&&(f.qb={left:g.b4w_rotation_left_limit,right:g.b4w_rotation_right_limit}),g.b4w_use_vertical_clamping&&(f.Aa={Ka:g.b4w_rotation_down_limit,Qa:g.b4w_rotation_up_limit}),"LOCAL"==g.b4w_horizontal_clamping_type&&e(d),"LOCAL"==g.b4w_vertical_clamping_type&&r(d),v(d),g.b4w_use_panning&&(f.or=g.b4w_use_panning)):
f.da===a.MS_HOVER_CONTROLS&&(g.b4w_use_horizontal_clamping&&g.b4w_horizontal_translation_min<=g.b4w_horizontal_translation_max&&(f.qb={left:g.b4w_horizontal_translation_min,right:g.b4w_horizontal_translation_max}),g.b4w_use_vertical_clamping&&g.b4w_vertical_translation_min<=g.b4w_vertical_translation_max&&(f.Aa={Ka:-g.b4w_vertical_translation_max,Qa:-g.b4w_vertical_translation_min}),g.b4w_use_distance_limits&&g.b4w_hover_angle_min<=g.b4w_hover_angle_max&&(f.Oa={Ka:g.b4w_hover_angle_min,Qa:g.b4w_hover_angle_max})),
f.Ab=g.b4w_use_distance_limits&&g.b4w_distance_min<=g.b4w_distance_max,f.Ab&&(f.Hc=g.b4w_distance_min,f.Wf=g.b4w_distance_max);f=d.d;if(f.da===a.MS_HOVER_CONTROLS&&f.Ab)if(f.Oa){if(g=m(d),h=D.quat_to_dir(f.quat,D.AXIS_Z,X),d=0,0<h[1]&&(d-=Math.asin(h[1]/V.len(h))),g>f.Oa.Qa?d+=g-f.Oa.Qa:g<f.Oa.Ka&&(d+=f.Oa.Ka-g),(d||0>g)&&q.warn("B4W Warning: Active hover camera has wrong orientation"),d&&(g=D.quat_to_dir(f.quat,D.AXIS_X,N),d=U.setAxisAngle(g,-d,ca),U.normalize(d,d),U.multiply(d,f.quat,f.quat)),d=
D.quat_to_dir(f.quat,D.AXIS_MY,X),g=Q,g.set(D.AXIS_Y),g[3]=0,d=D.line_plane_intersect(g,0,f.e,d,f.Yd),!d||100<V.len(d))f.Yd[0]=f.e[0],f.Yd[1]=0,f.Yd[2]=f.e[2]}else f.Ab=!1};a.lb=c;a.Wz=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.cb);case "DEPTH":return Boolean(a.hc);case "SCREEN":return!Boolean(a.cb)&&!Boolean(a.hc);default:throw"Wrong attachment type: "+b;}};a.Ij=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.cb=c;break;case "DEPTH":a.hc=c;break;case "SCREEN":a.cb=
null;a.hc=null;break;default:throw"Wrong attachment type: "+b;}};a.FA=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.cb;case "DEPTH":return a.hc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Dp=function(b,c){if(b.type!=a.rc||c!=a.ub&&c!=a.Cb)throw"make_stereo(): wrong camera type";b.type=c;g(b,6,.065)};a.Sx=g;a.wq=function(a,b){var c=a.d.quat,d=ca,e=X;e[0]=0;e[1]=1;e[2]=0;U.setAxisAngle(e,b,d);U.multiply(d,c,c)};a.xB=function(a,b){var c=a.d.quat,d=ca,e=X;e[0]=
1;e[1]=0;e[2]=0;U.setAxisAngle(e,b,d);U.multiply(d,c,c)};a.wB=function(a,b){var c=a.d.quat;U.invert(c,c);var d=ca,e=X;e[0]=0;e[1]=0;e[2]=1;U.setAxisAngle(e,-b,d);U.multiply(d,c,c);U.invert(c,c)};a.dm=function(a,b){var c=a.d.quat;U.invert(c,c);var d=ca,e=X;e[0]=1;e[1]=0;e[2]=0;U.setAxisAngle(e,-b,d);U.multiply(d,c,c);U.invert(c,c)};a.get_angles=f;a.Bq=l;a.Nx=function(b,c,d,e,f,g,h){switch(b.type){case a.Yg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ea=g;b.La=h;break;default:q.error("set_frustum_asymmetric(): Unsupported camera type: "+
b.type)}};a.get_move_style=function(a){return a.d.da};a.zB=h;a.AB=k;a.Eq=function(a,b,c){var d=X;d[0]=0;d[1]=-1;d[2]=0;V.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=N;e[0]=0;e[1]=0;e[2]=-1;V.transformQuat(e,c,e);k(a,b,d,e)};a.yB=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e.set(b);a.quat.set(c)};a.ev=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];L.lookAt(a,b,c,ga);L.invert(ga,ga);L.rotateX(ga,Math.PI/2,ga);T.fromMat4(ga,F);U.fromMat3(F,e)};a.jr=function(a){var b=
a.d.M;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];h(e,a);D.yo(e.Jf,e.gl);if(e.Te)if(e.dof_on){var f=V.dist(c.e,e.Te.location);e.dof_distance=f}else e.dof_distance=0}};a.Py=function(b){var c=b.d;if(c.da==a.MS_TARGET_CONTROLS)if(c.Ab){if(M.zx(c.e,c.quat,c.Wa,c.Hc,M.Cr)){var d=V.subtract(c.e,c.Wa,X);V.scale(d,-c.Hc/V.length(d),d);V.add(c.Wa,d,c.e)}}else M.yx(c.e,c.quat,c.Wa);c.da!=a.MS_TARGET_CONTROLS&&c.da!=a.MS_EYE_CONTROLS||M.correct_up(b,D.AXIS_Y)};a.pw=e;a.kz=r;a.Gm=v;
a.Ut=function(b){var c=b.d;if(c.da===a.MS_TARGET_CONTROLS||c.da===a.MS_EYE_CONTROLS){if(c.qb){var d=c.qb.left,e=c.qb.right,g=f(b,R),g=g[0],g=c.da==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=t(g,d,e))c.da==a.MS_TARGET_CONTROLS?s(b,D.AXIS_Y,g):(g=U.setAxisAngle(D.AXIS_MY,g,ca),U.multiply(g,b.d.quat,b.d.quat))}c.Aa&&(d=c.Aa.Ka,e=c.Aa.Qa,g=f(b,R),g=g[1],c.da==a.MS_TARGET_CONTROLS&&(g*=-1),g=0<D.quat_to_dir(c.quat,D.AXIS_Z,X)[1]?D.sign(g)*Math.PI-g:g,g=t(g,d,e))&&(c.da==a.MS_TARGET_CONTROLS?(d=D.quat_to_dir(b.d.quat,
D.AXIS_MX,N),s(b,d,g)):(d=g,g=b.d,e=D.quat_to_dir(g.quat,D.AXIS_X,X),d=U.setAxisAngle(e,d,ca),U.multiply(d,g.quat,g.quat)));c.da===a.MS_TARGET_CONTROLS&&c.Ab&&(g=b.d,d=V.subtract(g.e,g.Wa,X),e=V.length(d),e>g.Wf?(V.scale(d,g.Wf/e,d),V.add(g.Wa,d,g.e)):e<g.Hc&&(e=D.quat_to_dir(g.quat,D.AXIS_MY,N),V.scale(e,100*g.Hc,e),V.add(d,e,d),V.scale(d,-g.Hc/V.length(d),d),V.add(g.Wa,d,g.e)))}c.da===a.MS_HOVER_CONTROLS&&(c=b.d,g=c.Ab?c.Yd:c.e,c.qb&&(g[0]=D.clamp(g[0],c.qb.left,c.qb.right)),c.Aa&&(g[2]=D.clamp(g[2],
c.Aa.Ka,c.Aa.Qa)),c=b.d,c.Ab&&(d=D.quat_to_dir(c.quat,D.AXIS_Z,X),g=0,0<d[1]&&(g=Math.asin(d[1]/V.len(d))),d=V.negate(f(b,R),R),d[1]<c.Oa.Ka?g+=d[1]-c.Oa.Ka:d[1]>c.Oa.Qa&&(g+=d[1]-c.Oa.Qa),g&&(d=D.quat_to_dir(c.quat,D.AXIS_X,N),V.normalize(d,d),g=U.setAxisAngle(d,g,ca),U.normalize(g,g),U.multiply(g,c.quat,c.quat)),g=X,b=b.d,b.Ab?(d=D.quat_to_dir(b.quat,D.AXIS_MY,X),V.normalize(d,d),b.Oa.Qa-b.Oa.Ka?(e=(-Math.asin(d[1])-b.Oa.Ka)/(b.Oa.Qa-b.Oa.Ka),e=Math.max(e,0)):e=0,b=V.scale(d,-(e*(b.Wf-b.Hc)+b.Hc),
g)):b=null,V.add(c.Yd,b,c.e)))};a.Oo=m;a.cB=function(b){switch(b.type){case a.rc:case a.Of:case a.ub:case a.Cb:return!0;default:return!1}};a.Dv=function(b){b=b.d.M[0];switch(b.type){case a.rc:case a.Ce:case a.ub:case a.Cb:return Math.PI*b.od/180;default:return q.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.tg=y;a.Ft=d;a.Gt=C;a.bv=A;a.tt=function(a){a=a.d;var b=H.Zc();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Eb=b;var c=H.Nk(1,[0,0,0]);a.tc=c;a.uk=H.$n(1,b);
a.wk=H.bo(1,b);a.vk=H.ao(1,b)};a.is_camera=u;a.jc=function(b){return u(b)&&b.d&&b.d.da==a.MS_TARGET_CONTROLS?!0:!1};a.Rb=function(b){return u(b)&&b.d&&b.d.da==a.MS_HOVER_CONTROLS?!0:!1};a.vl=function(b){return u(b)&&b.d&&b.d.da==a.MS_EYE_CONTROLS?!0:!1};a.Yj=w;a.Gu=p};b4w.module.__lights=function(a,n){function b(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Sf:new Float32Array(3),Rq:0,Qq:0,zv:!1,ro:!1,Ng:!0,Pg:!0,ag:1,distance:25,fv:"INVERSE_SQUARE"}}function c(a){a.Sf[0]=a.color[0]*a.ag;a.Sf[1]=a.color[1]*a.ag;a.Sf[2]=a.color[2]*a.ag}var g=n("__util"),f=n("vec3");a.VA=b;a.Ew=function(a){var h=a.data,k=b(h.type);k.name=a.name;k.Ng=h.use_diffuse;k.Pg=h.use_specular;var e=g.quat_to_dir(a.d.quat,g.AXIS_Y,[]);f.normalize(e,
e);k.direction[0]=e[0];k.direction[1]=e[1];k.direction[2]=e[2];k.color[0]=h.color[0];k.color[1]=h.color[1];k.color[2]=h.color[2];k.ag=h.energy;c(k);k.distance=h.distance;if("POINT"===k.type||"SPOT"===k.type)k.fv=h.falloff_type;"SPOT"===k.type&&(k.Rq=h.spot_size,k.Qq=h.spot_blend);k.zv=h.b4w_generate_shadows;k.ro=h.b4w_dynamic_intensity;a.Ha=k};a.Px=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];c(a)};a.Cq=function(a,b){a.ag=b;c(a)};a.Uy=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var b=a.Ha;b&&g.quat_to_dir(a.d.quat,g.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,n){function b(){if(!Ea)throw"no active scene";return Ea}function c(){return Ea?!0:!1}function g(a,b,c,d){d|=0;for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.jd==d){e=g;break}}return e}function f(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function h(b){if("NONE"==Y.me||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==H(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=H(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function k(a,b,c){c=J.Hh(a,b);J.ve(a,c,function(a,c,d){if(d.xa){switch(d.G){case "COLOR":case "CUBEMAP":a=c.h.cb;break;case "DEPTH":a=c.h.hc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";
c=b.l;for(var e=0;e<c.length;e++){var f=c[e].k;W.Kn(f.Yb,d.V)&&Q.wi(f,a,d.V)}}}});for(a=0;a<b.Z.length;a++){var d=b.Z[a],e=b.Tc[a];switch(d.V){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.l,g=0;g<f.length;g++)c=f[g].k,W.Kn(c.Yb,d.V)&&Q.wi(c,e,d.V)}}}function e(a,b,c,d,e){for(var f=b.d,g=b.P,h=0;h<g.length;h++){var l=g[h];if(!(l.Nb||l.Lb||"MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||y(a,l))){if("OPAQUE"===d){if(l.sa)continue;var p=ea.Ma(c,"SHADOW_CAST")&&
l.sb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!l.sa)continue;if("XRAY"==d!=l.oc)continue;if(ea.Ma(c,"SHADOW_CAST")&&l.sb)switch(Y.me){case "DEPTH":p="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else p="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==l.type&&l.Zs&&(b.d.Nz.push(l.Zs),b.d.Mz.push(l.Oz));var q=l.Xa,z=e.d.yc;W.J(q,"SHADOW_SRC",p);Q.rk(l,z);W.J(q,"NUM_LIGHTS",a.tf);"special_skydome.glslf"==W.No(q)&&W.J(q,"REFLECTION_PASS",0);
W.J(q,"SSAO_ONLY",0);a.Ba&&a.zc?W.J(q,"WATER_EFFECTS",1):W.J(q,"WATER_EFFECTS",0);a.Ba&&a.Ne&&f.Ne?(W.J(q,"CAUSTICS",1),W.J(q,"CAUST_SCALE",a.Gn),W.J(q,"CAUST_SPEED",W.u(a.Hn,2)),W.J(q,"CAUST_BRIGHT",a.Fn)):W.J(q,"CAUSTICS",0);a.Ba&&(W.J(q,"WAVES_HEIGHT",W.u(a.ze)),W.J(q,"WAVES_LENGTH",W.u(a.Kf)),W.J(q,"WATER_LEVEL",W.u(a.ye)));l.wc&&ea.Ma(c,"MAIN_REFLECT")&&-1===l.ac.indexOf("u_mirrormap")?W.J(q,"REFLECTIVE",1):W.J(q,"REFLECTIVE",0);if(z=ea.Ma(c,"SKY"))if(l.mq){var n=z.h.cb;Q.wi(l,n,"u_sky")}else Y.Rh?
(l.Gc=z.Gc,W.J(q,"PROCEDURAL_FOG",1)):W.J(q,"PROCEDURAL_FOG",0);else W.J(q,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){n=null;if(e.d.ci.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)n=z.h.cb;else for(h=0;h<a.xg.length;h++)if(a.xg[h].texture.b4w_use_as_environment_lighting){n=Q.Hv(a.xg[h],!1);break}n?(W.J(q,"SKY_TEXTURE",1),Q.wi(l,n,"u_sky_texture")):ba.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}l.ya&&
(z=ea.Ma(c,"GRASS_MAP"))&&s(l,z,f);ea.Ma(c,"REFRACT")&&l.$l?W.J(q,"REFRACTIVE",1):W.J(q,"REFRACTIVE",0);l.xe&&(l.Lm&&ea.Ma(c,"DEPTH")?W.J(q,"SHORE_SMOOTHING",1):W.J(q,"SHORE_SMOOTHING",0),l.water_dynamic&&a.Ba&&a.ze?W.J(q,"DYNAMIC",1):W.J(q,"DYNAMIC",0));"PARTICLES"==l.type&&(W.J(q,"SIZE_RAMP_LENGTH",l.aq),W.J(q,"COLOR_RAMP_LENGTH",l.Sp));for(var z=l.S,w=0;w<z.length;w++){var n=z[w],aa=n.tj;if(aa){var u=aa.d.Na,S=null,fa=null;J.ue(u,function(a,b,c){if("SCREEN"==c.G)return S=J.Da(u,a),fa=c,!0});if(!S||
!fa)throw"Failed to assign RTT";Da.Jj(n,Da.s,Da.s);fa.pa=n;var D=S.h;D.cb=n;D.Xd=B.sq(n,null);M(aa,n.om,n.om,!0);n=ea.eo(u);for(D=n.length-1;0<=D;D--){var x=n[D],ja=x.h;F.tg(ja,1);"MAIN_OPAQUE"==a.type&&ja.type==F.rc&&F.Yj(ja,aa.d.yc);e.d.Bf.unshift(x)}}}if(l.jg){var z=0,G;for(G in l.jg)z++;W.J(q,"NUM_LAMP_LIGHTS",z);l.zl=new Float32Array(3*z);l.xl=new Float32Array(3*z);l.wl=new Float32Array(3*z);l.yl=new Float32Array(4*z);for(w=0;w<e.ab.LAMP.length;w++)r(l,e.ab.LAMP[w])}t(c,a,p);Q.tb(l);p={R:!0,
Va:f,k:l};v(l);a.l.push(p);k(c,a,l);m(l)}}a.l.sort(function(a,b){var c;if(a.k&&b.k){c=a.k.sa;var d=b.k.sa;(c=c==d?0:c>d?1:-1)||(c=a.k.vf,d=b.k.vf,c=c==d?0:c>d?1:-1)}else c=0;return c})}function r(a,b){var c=b.uuid;if(c in a.jg){c=a.jg[c];a.zl.set(b.d.e,3*c);a.xl.set(b.Ha.direction,3*c);a.wl.set(b.Ha.Sf,3*c);var d=Xa;w(b.Ha,Ca,d);a.yl.set(d,4*c)}}function v(a){var b=a.Yb.attributes,c=a.bb.Jb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==a.type)b=
W.bw(a.Yb.Im),10<b&&("MAIN"==a.type&&ba.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials: "'+a.vc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.Gf&&(c=ma.Ze(a.Gf)),a.Ra&&(d=ma.Ze(a.Ra)),ba.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.vc.join(", ")+'"')))}function m(a){8<a.S.length&&ba.warn("B4W Warning: too many textures used - "+a.S.length+' (max 8), materials "'+a.vc.join(", ")+'"')}function t(a,b,c){for(var d=0,
e=ea.Po(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=ea.iv(a,g,"SHADOW_CAST").h,b.pr=g.fa,b.tn=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.yf=b.yf||[],b.yf[d]=g.ka,d++)}}function s(a,b,c){a.Ib=b.Ib;var d=b.Ib[0],e=b.Ib[1],f=b.Ib[2];c=c.Eb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Ib[2]=f;b=b.h;F.Bq(b,f/2,-e,-d,f/2);F.tg(b);d=a.pl||0;d=0==d?c:Math.max(d,c);a.pl=d}function y(a,b){for(var c=a.l,
d=0;d<c.length;d++){var e=c[d].k;if(e&&e.id==b.id)return!0}return!1}function d(a){var b=D(a,"MAIN_OPAQUE"),c=!0;J.K(a.d.Na,function(d,e){"SHADOW_CAST"===e.type&&(C(e,b,e.l,a,c),c=!1)})}function C(b,c,d,e,f){if(0!=d.length){var g=b.h;c=c.h;var h=H(e,"LAMP",a.DATA_ID_ALL),B;a:{for(B=0;B<h.length;B++){var k=h[B];if(k.data.b4w_generate_shadows){B=k;break a}}B=!1}h=(B||h[0]).d;F.Eq(g,h.e,h.quat);K.copy(c.Wd,g.Wd);ta.copy(c.fa,g.Hq);h=$a;ia.Zc(h);for(B=0;B<d.length;B++)k=d[B].Va,0==B?ia.Zn(k.Ia,h):ia.uo(h,
k.Ia);d=ia.av(h,Ja);ma.he(d,g.fa,d);if(e.d.yc.b4w_enable_csm){e=K.copy(c.ih[b.Ok],wa);h=ta.invert(c.fa,sa);ma.he(e,h,e);ma.he(e,g.fa,e);b=c.Pk[b.Ok];if(f)for(Kb=0,f=2;f<d.length;f+=3)Kb=Math.min(Kb,d[f]);f=$a;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=Kb}else{b=f=$a;c=Zb;c.set(d);e=Za/9;d=ta.identity(sa);ta.rotate(d,e,ma.AXIS_MZ,d);B=h=-1;for(k=0;10>k;k++){var m=ia.xt(c,tb),l=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==h||l<h)h=l,B=k,ia.Zn(m,b);ma.he(c,d,c)}b=B*e;
0<b&&(c=ta.identity(sa),ta.rotate(c,b,ma.AXIS_MZ,c),ta.multiply(c,g.fa,g.fa));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}F.Nx(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);F.tg(g);ma.yo(g.Jf,g.gl)}}function A(a,b){for(var c=b.d,d=b.P,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=d[f];if(g.oc==e&&"COLOR_ID"==g.type&&!y(a,
g)){Q.U(g,"USE_GLOW",0);Q.tb(g);var h={R:!0,Va:c,k:g};v(g);a.l.push(h)}}}function u(a){var b=ma.gh(a);a.Xa=JSON.parse(JSON.stringify(a.Xa));return b}function w(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.Ng?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.Pg?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.Rq/2),c[1]=a.Qq*(1-b)}}function p(a,b){for(var c=G(b,za),d=a.Ha,e=a.d,f=d.index,g=0;g<c.length;g++){var h=c[g];h.kf.set(e.e,3*f);h.gf.set(d.direction,
3*f);h.ff.set(d.Sf,3*f);var B=Ca,k=Xa;w(d,B,k);switch(d.type){case "SUN":if(h.ar.set(e.quat),h.$q=d.Sf,"SKY"===h.type){var m=wa;m[0]=m[1]=m[2]=1;var l=Math.acos(K.dot(h.Qj,m)),m=Math.acos(K.dot(d.direction,m));h.rj=Math.floor(l/.025)!=Math.floor(m/.025)?!0:!1;K.copy(d.direction,h.Qj);I(b,h)}else K.copy(d.direction,h.Qj);case "HEMI":case "POINT":case "SPOT":break;default:ba.error("B4W Warning: unknown light type: "+d.type)}h.hf.set(B,4*f);h.jf.set(k,4*f);h.va=!0;for(B=0;B<h.l.length;B++)k=h.l[B].k,
k.jg&&r(k,a)}}function I(a,b){B.Zf(b);if(b.rj)for(var c=G(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].l,f=0;f<e.length;f++){var g=e[f];g.R&&(g=g.k,Q.Mt(g)&&B.My(g))}}function H(b,c,d){if(!b.ab)throw"Access to uninitialized scene";b=b.ab[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.jd==d&&c.push(f)}return c}function x(b){var c=[];b=H(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=
e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function M(a,b,c,d){for(var e=a.d,f=a.camera.d.M,g=0;g<f.length;g++){var h=f[g];F.tg(h,b/c);e.bm&&F.Yj(h,e.yc)}e.bm&&(e.sj=!0,D(a,"DEPTH").va=!0,D(a,"MAIN_BLEND").va=!0);F.jr(a.camera);ea.Jy(e.Na,function(e,f,g){if(d||e.Lg){var h=e.qe*b,B=e.qe*c;if(f)for(f=0;f<g.Z.length;f++)g.Z[f]==e&&Da.resize(e.pa,h,B);else Da.Ch(e.pa)&&Da.resize(e.pa,h,B),e=g.h,e.width=h,e.height=B,"DOF"==g.type&&V(a,{dof_power:g.h.dof_power,dof_on:g.h.dof_on}),q(g,1/b,1/c)}})}
function q(a,b,c){a=a.l;for(var d=0;d<a.length;d++){var e=a[d].k;e&&Q.bi(e,b,c)}}function G(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];J.K(a.d.Na,function(a,b){b.type==e&&c.push(b)})}return c}function D(a,b){return ea.Ma(a.d.Na,b)}function V(a,b){var c=D(a,"DOF");if(!c)return ba.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Na;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.h.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&
(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;for(var e=ea.eb(d,c,"POSTPROCESSING"),d=ea.eb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].l[0].k;f&&(Q.Ef(f,c.h.dof_power),q(e[d],1/c.h.width,1/c.h.height))}}c.va=!0}function O(a,b){var c=D(Ea,"MAIN_OPAQUE");if(!c||!c.Ba)return ba.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.ze,e=c.Kf,f=c.ye,g=c.Ba;if(!d||
!g.$f)return g.ye;var h=K.length(c.mi),B=c.time;h&&(B*=h);var k=sb;k[0]=20/e*(a-.25*B);k[1]=20/e*(b-.25*B);h=ma.In(k);k[0]=17/e*(b+.1*B);k[1]=17/e*(a+.1*B);var k=ma.In(k),h=h+k-1,m=g.dst_noise_scale0,k=g.dst_noise_scale1,l=g.dst_noise_freq0,p=g.dst_noise_freq1,q=sb;q[0]=m*(a+l*B);q[1]=m*(b+l*B);m=ma.nm(q);q[0]=k*(b-p*B);q[1]=k*(a-p*B);k=ma.nm(q);k*=d*m;if(c.dk)if(p=(a-c.ne[0])/c.oe[0],q=(c.ne[1]+b)/c.oe[1],p+=.5,q+=.5,1<p||0>p||1<q||0>q)d=k;else var p=ma.Ko(Ea.d.im,c.vg,p,q),m=g.dir_freq,r=g.dir_noise_scale,
ea=g.dir_noise_freq,l=g.dir_min_noise_fac,q=g.dst_min_fac,c=e/c.mg/Math.PI,r=[r/e*(a+ea*B),r/e*(b+ea*B)],e=Math.sqrt(p),d=d*Math.max(p,g.dir_min_shore_fac)*Math.sin(e/c+m*B)*Math.max(ma.nm(r),l),g=Math.max(e,q),d=d*(1-g)+k*g,h=h*p;else d=k;return f+(d+.05*h)}function U(a,b){a.Ah&&"POSTPROCESSING"==a.type&&b.R!=a.R&&(a.R=b.R);b.R||"GLOW"!=a.type||(a.Xk=0)}function T(a,b,c,d){var e=J.Da(a,b);F.Ij(e.h,c,d);e.sk=!0;J.we(a,b,function(b,e,f){f.xa&&f.G==c&&ea.Tt(f)&&L(a,b,f.V,d)});J.ve(a,b,function(b,e,
f){f.xa&&f.G==c&&f.G==f.V&&T(a,b,c,d)})}function L(a,b,c,d){a=J.Da(a,b).l;for(b=0;b<a.length;b++)Q.wx(a[b].k,d,c)}function P(a){var b=D(a,"GRASS_MAP");if(b){var c=b.h,d=a.camera.d,e=d.e;a=wa;a[0]=0;a[1]=-b.Ib[2]/2;a[2]=0;K.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=xa;b[0]=0;b[1]=0;b[2]=0;b[3]=1;F.Eq(c,a,b)}}function R(a,b){J.K(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.Z[0]||!d.Tc[0])throw"Wrong MOTION_BLUR subscene";var e=d.Z[0],f=d.Tc[0];d.Tc[0]=d.h.cb;J.we(a,c,function(b,c,
d){d.xa&&L(a,b,d.V,f)});T(a,c,e.G,f);L(a,c,e.V,d.Tc[0]);d.Gp=Math.exp(-b/d.oj)}})}function X(b,c){var d=0,e=b.Qs;0==e.zm&&(e.zm=c);var f=c-e.zm;if(e.rq&&f/e.Nh>=e.rq)a.clear_glow_anim(b);else{f%=e.Nh;if(f<e.Yo)switch(e=f/(e.Yo/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b.P.length;e++)f=b.P[e],"COLOR_ID"==f.type&&(f.gg=d)}}function N(a){J.K(a.d.Na,function(a,b){b.va=!0})}function ca(a){if("WIND"==a.field.type){a=
a.d;ma.quat_to_dir(a.quat,ma.AXIS_Y,ya);K.normalize(ya,ya);K.scale(ya,a.el,ya);a=Pa;for(var b=0;b<a.length;b++)for(var c=G(a[b],ab),d=0;d<c.length;d++)c[d].mi.set(ya)}}var Q=n("__batch"),ia=n("__boundings"),F=n("__camera"),ga=n("__config"),S=n("__debug"),z=n("__geometry"),J=n("__graph"),ja=n("__hud"),na=n("__objects");n("__particles");var fa=n("__prerender"),aa=n("__primitives"),ba=n("__print"),B=n("__renderer"),ea=n("__scenegraph"),pa=n("__sfx"),W=n("__shaders"),Da=n("__textures"),ma=n("__util"),
K=n("vec3"),ta=n("mat4"),Y=ga.n,Ra="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Na=["ARMATURE","EMPTY","MESH","SPEAKER"],Ia="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),za="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Yb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],ab="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),
bb=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Ea=null,Pa=[],ib=[],Jb,cb,Za=Math.PI/2;a.hk=0;a.Rm=1;a.Sm=2;a.DATA_ID_ALL=-1;var sb=new Float32Array(2),wa=new Float32Array(3),Ca=new Float32Array(4),Xa=new Float32Array(4),xa=new Float32Array(4),sa=new Float32Array(16),Ja=new Float32Array(24),Zb=new Float32Array(24),$a=ia.Zc(),tb=ia.Zc(),ya=new Float32Array(3),Kb=null;a.set_active=function(a){Ea=a;pa.Kx(a)};a.hx=function(a){var b=a.d;if(!a.$m){for(var c=ea.eo(b.Na),d=0;d<c.length;d++)b.Bf.push(c[d]);
M(a,Jb,cb,!1)}a=G(a,ab);for(c=0;c<a.length;c++)a[c].mi.set(ya);for(d=0;d<b.Bf.length;d++)"SHADOW_CAST"==b.Bf[d].type&&B.Zf(b.Bf[d])};a.get_active=b;a.W=c;a.Ui=function(){return Pa};a.Wi=function(b,c,d,e){for(var f=Pa,h=null,B="",k=0;k<f.length;k++){var m=H(f[k],"ALL",a.DATA_ID_ALL);switch(b){case a.hk:B=c;h=g(c,m,!1,d);break;case a.Rm:B=d;h=null;(m=g(c,m,!1,e))&&m.dupli_group&&(h=g(d,m.dupli_group.objects,!0,e));break;case a.Sm:for(var B=c[c.length-1],h=null,l=0;l<c.length;l++)if((h=g(c[l],m,0!=l,
d))&&h.dupli_group)m=h.dupli_group.objects;else break}if(h)break}h||ba.warn("get object "+B+": not found");return h};a.kt=function(a,b,c){for(var d in Na){var e=Na[d],g=f(a,e),h=b.d.Qg,B=!1;for(d=0;d<c.length;d++)if(B=!0,c[d].d&&c[d].d.gj){for(var k=0;k<h.length;k++)h[k]==c[d]&&(B=!1);B&&h.push(c[d])}e in b.ab||(b.ab[e]=[]);for(k=0;k<g.length;k++)ma.df(g[k])&&g[k].proxy||(b.ab.ALL.push(g[k]),b.ab[e].push(g[k]))}};a.et=function(b,c){b.ab={ALL:[]};for(var d in Ra){var e=Ra[d],g=f(b,e);b.ab[e]=[];for(var B=
0;B<g.length;B++)ma.df(g[B])&&g[B].proxy||(b.ab.ALL.push(g[B]),b.ab[e].push(g[B]))}b.d=b.d||{};e=b.d;g=b.camera.d;d=b.world.b4w_shadow_settings;B=e.yc={};B.csm_resolution=d.csm_resolution;B.self_shadow_polygon_offset=d.self_shadow_polygon_offset;B.self_shadow_normal_offset=d.self_shadow_normal_offset;B.b4w_enable_csm=d.b4w_enable_csm;B.b4w_enable_csm?(B.csm_num=d.csm_num,B.csm_first_cascade_border=d.csm_first_cascade_border,B.first_cascade_blur_radius=d.first_cascade_blur_radius,B.csm_last_cascade_border=
d.csm_last_cascade_border,B.last_cascade_blur_radius=d.last_cascade_blur_radius,B.fade_last_cascade=d.fade_last_cascade,B.blend_between_cascades=d.blend_between_cascades):(B.csm_num=1,B.csm_first_cascade_border=d.csm_first_cascade_border,B.first_cascade_blur_radius=d.first_cascade_blur_radius,B.csm_last_cascade_border=d.csm_last_cascade_border,B.last_cascade_blur_radius=d.last_cascade_blur_radius,B.fade_last_cascade=!1,B.blend_between_cascades=!1);e.Qg=[];for(d=0;d<c.length;d++)c[d].d&&c[d].d.gj&&
e.Qg.push(c[d]);d=b.world.b4w_fog_color;e.Fb=new Float32Array([d[0],d[1],d[2],b.world.b4w_fog_density]);a:{if(b.ab)for(d=b.ab.LAMP,B=0;B<d.length;B++)if("SUN"==d[B].Ha.type){d=!0;break a}d=!1}e.Ed=d;d=e.Ed;var B={},k=b.world.b4w_sky_settings;B.procedural_skydome=k.procedural_skydome&&d;B.use_as_environment_lighting=k.use_as_environment_lighting;B.wg=k.color;B.rayleigh_brightness=k.rayleigh_brightness;B.mie_brightness=k.mie_brightness;B.spot_brightness=k.spot_brightness;B.scatter_strength=k.scatter_strength;
B.rayleigh_strength=k.rayleigh_strength;B.mie_strength=k.mie_strength;B.rayleigh_collection_power=k.rayleigh_collection_power;B.mie_collection_power=k.mie_collection_power;B.mie_distribution=k.mie_distribution;!d&&k.procedural_skydome&&ba.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");e.ci=B;var m=b.world;d=[0,0,0];var B=[0,0,0],k=m.light_settings,l=m.texture_slots;if(k.use_environment_light)if("SKY_COLOR"==k.environment_color||"SKY_TEXTURE"==k.environment_color)d=
m.horizon_color.slice(0),B=m.zenith_color.slice(0);else if("PLAIN"==k.environment_color)d=[1,1,1],B=[1,1,1];else throw"Unsupported world environment color"+k.environment_color;m={};m.Vd=k.environment_energy;m.ic=d;m.pc=B;m.xg=l;e.zr=m;e.Al=H(b,"LAMP",a.DATA_ID_ALL).length;d=x(b);B=[];k=H(b,"MESH",a.DATA_ID_ALL);for(l=0;l<d.length;l++){var p=d[l];if(p.b4w_water){for(var m={},q=0;q<k.length;q++)for(var r=k[q],J=r.data.materials,t=0;t<J.length;t++)J[t]==p&&(m.ye=r.location[1]);if(Y.deferred_rendering)for(m.Fb=
p.b4w_water_fog_color.slice(0),m.Fb.push(p.b4w_water_fog_density),p.b4w_water_dynamic?(m.$f=!0,m.waves_height=p.b4w_waves_height,m.waves_length=p.b4w_waves_length,m.dst_noise_scale0=p.b4w_water_dst_noise_scale0,m.dst_noise_scale1=p.b4w_water_dst_noise_scale1,m.dst_noise_freq0=p.b4w_water_dst_noise_freq0,m.dst_noise_freq1=p.b4w_water_dst_noise_freq1,m.dir_min_shore_fac=p.b4w_water_dir_min_shore_fac,m.dir_freq=p.b4w_water_dir_freq,m.dir_noise_scale=p.b4w_water_dir_noise_scale,m.dir_noise_freq=p.b4w_water_dir_noise_freq,
m.dir_min_noise_fac=p.b4w_water_dir_min_noise_fac,m.dst_min_fac=p.b4w_water_dst_min_fac,m.waves_hor_fac=p.b4w_water_waves_hor_fac):(m.$f=!1,m.waves_height=0,m.waves_length=0),m.Ii=null,m.Dk=null,m.Ek=new Float32Array(2),m.Lj=null,p=p.texture_slots,q=0;q<p.length;q++)r=p[q].texture,"VORONOI"==r.type&&(m.Ii=r.noise_scale,m.Ek.set(r.b4w_uv_velocity_trans),m.Dk=r.noise_intensity),!0===r.b4w_shore_dist_map&&(m.Lj=r.image,m.vg=r.image.size[0],m.ay=r.b4w_shore_boundings,m.mg=r.b4w_max_shore_dist);else m.waves_height=
0,m.waves_length=0,m.Ii=null,m.Dk=null,m.Ek=null,m.Fb=null,m.$f=!1;B.push(m)}}if(0<B.length){m=B[0];if(!m.$f)for(l=0;l<B.length;l++)B[l].$f&&(m=B[l]);d=m}else d=null;e.Ba=d;a:{d=H(b,"MESH",a.DATA_ID_ALL);for(B=0;B<d.length;B++)if(d[B].d.Mc){d=!0;break a}d=!1}e.Ik=d||Y.force_selectable;a:{d=H(b,"MESH",a.DATA_ID_ALL);for(B=0;B<d.length;B++)for(k=d[B].data.materials,l=0;l<k.length;l++)if(m=k[l],q=m.game_settings.alpha_blend,m.b4w_render_above_all&&"OPAQUE"!=q&&"CLIP"!=q){d=!0;break a}d=!1}e.oc=d;e.Lp=
0;if(Y.deferred_rendering){d=b.$m;e.bm=h(b);e.wA=b.world.b4w_fog_color;a:{if(Y.shore_smoothing)for(B=x(b),k=0;k<B.length;k++)if(l=B[k],l.b4w_water&&l.b4w_water_shore_smoothing){B=!0;break a}B=!1}e.shore_smoothing=B;if(Y.Fj&&b.b4w_render_reflections)for(B=[],k=H(b,"MESH",a.DATA_ID_ALL),l=0;l<k.length;l++){if(m=k[l],m.b4w_reflective){b:{m=m.constraints;for(q=0;q<m.length;q++)if(p=m[q],"LOCKED_TRACK"==p.type&&"REFLECTION PLANE"==p.name){q=p.target;break b}q=null}q&&(m=q.location,q=q.d.quat,p=new Float32Array(4),
ma.Iy(m,q,ma.AXIS_Y,p),B.push(p))}}else B=!1;e.px=B;B={};k=b.world.b4w_bloom_settings;B.blur=k.blur;B.Vu=k.edge_lum;B.key=k.key;e.At=B;B={};k=b.world.b4w_motion_blur_settings;B.nj=k.motion_blur_decay_threshold;B.oj=k.motion_blur_factor;e.Ow=B;B={};k=b.world.b4w_color_correction_settings;B.brightness=k.brightness;B.contrast=k.contrast;B.exposure=k.exposure;B.saturation=k.saturation;e.Lt=B;B={};k=b.world.b4w_god_rays_settings;B.tw=k.intensity;B.lg=k.max_ray_length;B.Dg=k.steps_per_pass;e.iw=B;B={};
k=b.world;B.wh=k.b4w_glow_color;B.Yi=k.b4w_glow_factor;e.fw=B;e.Yf=Y.Yf&&(0<g.dof_distance||g.Te);a:{if(Y.ya)for(k=B=!1,l=H(b,"MESH",a.DATA_ID_ALL),m=0;m<l.length;m++){p=l[m];r=p.data.materials;for(q=0;q<r.length;q++)r[q].b4w_terrain&&(B=!0);p=p.particle_systems;for(q=0;q<p.length;q++)r=p[q].settings,"HAIR"==r.type&&r.b4w_dynamic_grass&&(k=!0);if(B&&k){B=!0;break a}}B=!1}e.ya=B;e.ng=Y.ng&&b.b4w_enable_motion_blur;e.Uf=Y.Uf&&b.b4w_enable_color_correction;e.antialiasing=Y.antialiasing&&b.b4w_enable_antialiasing;
e.Pf=Y.Pf&&b.b4w_enable_bloom&&e.Ed;e.Ff=Y.Ff&&b.b4w_enable_ssao;B={};k=b.world.b4w_ssao_settings;B.radius_increase=k.radius_increase;B.ow=k.hemisphere;B.Bt=k.blur_depth;B.xn=k.blur_discard_value;B.influence=k.influence;B.dist_factor=k.dist_factor;B.Ax=k.samples;e.ry=B;e.hg=Y.hg&&b.b4w_enable_god_rays&&e.Ed;e.qg=Y.qg&&b.b4w_render_refractions;e.glow=Y.glow?e.Ik:!1;e.Na=ea.su(d,e,g)}else e.Na=ea.tu(g,e);e.Bf=[];e.sj=!1;e.Nl=!1;Pa.push(b)};a.Jk=f;a.ml=function(a){return a.d.Na};a.rv=function(a){J.K(a,
function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=Q.co(c.Qh);break;case "SSAO":d=Q.Au(c);break;case "SSAO_BLUR":d=Q.Bu(c);Q.bi(d,1/c.h.width,1/c.h.height);break;case "DEPTH_PACK":d=Q.ju();break;case "REFRACT":case "SCREEN":d=Q.co("NONE");break;case "GOD_RAYS":ea.eb(a,c,"WIREFRAME")||ea.eb(a,c,"MAIN_BLEND")||ea.eb(a,c,"GOD_RAYS");d=Q.mu(c.bq|0,(c.hb&&c.xe)|0,c.Dg);break;case "GOD_RAYS_COMBINE":ea.eb(a,c,"WIREFRAME")||ea.eb(a,c,"MAIN_BLEND");ea.eb(a,c,"GOD_RAYS");d=Q.nu();break;case "MOTION_BLUR":d=
Q.ru(c.nj);break;case "DOF":d=Q.ku();Q.Ef(d,c.h.dof_power);for(var e=ea.eb(a,c,"POSTPROCESSING"),f=ea.eb(a,e,"POSTPROCESSING"),g=[e,f],h=0;h<g.length;h++){var B=g[h].l;(e=B[0].k)&&Q.Ef(e,c.h.dof_power)}break;case "GLOW":g=ea.eb(a,c,"POSTPROCESSING");h=ea.eb(a,g,"POSTPROCESSING");e=ea.eb(a,h,"POSTPROCESSING");f=ea.eb(a,e,"POSTPROCESSING");d=Q.lu();g=[h,g];for(h=0;h<g.length;h++)B=g[h].l,(B=B[0].k)&&Q.Ef(B,c.yn);g=[f,e];for(h=0;h<g.length;h++)B=g[h].l,(B=B[0].k)&&Q.Ef(B,c.xo*c.Yi);break;case "COMPOSITING":d=
Q.hu();break;case "ANTIALIASING":d=Q.du();break;case "LANCZOS":d=Q.ou(c.hB);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=Q.yu(c.type);break;case "ANAGLYPH":d=Q.cu();break;case "SKY":d=Q.xu();Q.bi(d,1/c.h.width,1/c.h.height);break;case "LUMINANCE":d=Q.pu();break;case "AVERAGE_LUMINANCE":d=Q.eu();break;case "LUMINANCE_TRUNCED":d=Q.qu();break;case "BLOOM_BLUR":d=Q.fu(c.Qh);Q.bi(d,1/c.h.width,1/c.h.height);break;case "BLOOM":d=
ea.eb(a,c,"BLOOM_BLUR");g=[ea.eb(a,d,"BLOOM_BLUR"),d];for(h=0;h<g.length;h++)B=g[h].l,(B=B[0].k)&&Q.Ef(B,c.bloom_blur);d=Q.gu();break;case "VELOCITY":d=Q.Eu()}d&&(e={R:!0,Va:na.Mi("NONE"),k:d},v(d),c.l.push(e),k(a,c,d),m(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.Na,d=b.d;!ea.Ma(c,"SHADOW_CAST")&&d.sb&&(d.sb=!1);for(var d=G(a,Ia),f=0;f<d.length;f++){var g=d[f],h=b,B=c,l=a;switch(g.type){case "MAIN_OPAQUE":e(g,h,B,"OPAQUE",l);break;case "MAIN_BLEND":e(g,h,B,"BLEND",l);
break;case "MAIN_XRAY":e(g,h,B,"XRAY",l);break;case "MAIN_REFLECT":B=h.d;h=h.P;for(l=0;l<h.length;l++){var q=h[l],r=u(q);if(!("MAIN"!=r.type&&"NODES"!=r.type&&"PARTICLES"!=r.type||y(g,r)||r.sa)&&r.Wb){var J=r.Xa;W.J(J,"DISABLE_FOG",0);W.J(J,"WATER_EFFECTS",0);"special_skydome.glslf"==W.No(J)&&W.J(J,"REFLECTION_PASS",1);W.J(J,"SHADOW_SRC","SHADOW_SRC_NONE");W.J(J,"TEXTURE_NORM",0);Q.tb(r);J={R:!0,Va:B,k:r};v(r);g.l.push(J);"MAIN"==r.type&&(q.wb||(q.wb=[]),q.wb.push(r))}}break;case "DEPTH":q=h.d;h=
h.P;for(r=0;r<h.length;r++){var z=h[r];if("DEPTH"==z.type&&!y(g,z)&&!z.Nb){if(ea.nw(B,g,"SHADOW_CAST"))if(z.sb){switch(Y.me){case "DEPTH":var J="SHADOW_SRC_DEPTH",n="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}z=Q.Dm(z,J,n);Q.rk(z,l.d.yc);ea.Po(B,g);t(B,g,J)}else z=Q.Dm(z,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else z=Q.Dm(z,"SHADOW_SRC_NONE","SHADOW_DST_NONE");z.ya&&(J=ea.Ma(B,"GRASS_MAP"))&&s(z,J,q);Q.tb(z);J={R:!0,Va:q,k:z};v(z);g.l.push(J);k(B,g,z);m(z)}}break;case "SHADOW_CAST":q=
!1;r=h.d;h=h.P;for(J=0;J<h.length;J++)if(z=h[J],z.Mb||z.sb)if(q=!0,"DEPTH"==z.type&&!y(g,z)&&z.Mb){switch(Y.me){case "DEPTH":n="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}z=Q.wu(z,n);z.ya&&(n=ea.Ma(B,"GRASS_MAP"))&&s(z,n,r);Q.U(z,"SHADOW_TEX_RES",W.u(l.d.yc.csm_resolution));Q.tb(z);n={R:!0,Va:r,k:z};v(z);g.l.push(n)}q&&C(g,ea.Ma(B,"MAIN_OPAQUE"),g.l,l,!0);break;case "COLOR_PICKING":A(g,h);break;case "COLOR_PICKING_XRAY":A(g,h);break;case "GRASS_MAP":B=h.d;h=h.P;for(l=0;l<h.length;l++)q=
h[l],"GRASS_MAP"!=q.type||y(g,q)||(Q.tb(q),r={R:!0,Va:B,k:q},v(q),g.l.push(r),q=g.h,n=B.Ia,r=g.Ib[0],J=g.Ib[1],z=g.Ib[2],0==r&&0==J?(r=n.min_y,J=n.max_y):(r=Math.min(r,n.min_y),J=Math.max(J,n.max_y)),n=1E-4*(J-r),g.Ib[0]=r-n,g.Ib[1]=J+n,F.Bq(q,z/2,-J,-r,z/2),F.tg(q));break;case "GLOW_MASK":B=h.d;h=h.P;for(l=0;l<h.length;l++)q=h[l],"COLOR_ID"!=q.type||y(g,q)||(r=u(q),Q.U(r,"USE_GLOW",1),Q.tb(r),h.push(r),J={R:!0,Va:B,k:r},v(r),g.l.push(J),q.wb||(q.wb=[]),q.wb.push(r));break;case "WIREFRAME":for(l=
h.d,h=h.P,q=0;q<h.length;q++)r=h[q],"WIREFRAME"!=r.type||y(g,r)||(r.ya&&(J=ea.Ma(B,"GRASS_MAP"))&&s(r,J,l),Q.tb(r),J={R:!0,Va:l,k:r},v(r),g.l.push(J),k(B,g,r),m(r))}}break;case "LAMP":b.Ha.index=a.d.Lp++;c=G(a,za);for(d=0;d<c.length;d++)c[d].tf++;p(b,a)}};a.NA=y;a.fm=function(a){a.d.sj=!0};a.Nv=function(a,b){for(var c=a.d.yc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=F.Gu(c,b,e);return d};a.hide_object=function(a){a.d.xh=!0};a.show_object=function(a){a.d.xh=!1};a.tx=function(a,b){for(var c=
b.d,d=G(a,Ia),e=0;e<d.length;e++)for(var f=d[e].l,g=f.length-1;0<=g;g--){var h=f[g];h.Va==c&&(h.k&&z.Qn(h.k.bb),f.splice(g,1))}};a.check_object=function(a,b){return b.ab[a.type]&&-1<b.ab[a.type].indexOf(a)?!0:!1};a.gy=function(a){var b=a.ab.LAMP;if(b.length==a.d.Lp){for(var c=[],d=0;d<b.length;d++)c[b[d].Ha.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].Ha,g=b[c[e]].Ha;if(g.Ng&&g.Pg&&(!f.Ng||!f.Pg)||!f.Ng&&(g.Ng||!f.Pg&&g.Pg))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].Ha.index=
d,p(b[c[d]],a)}};a.Zj=p;a.cleanup=function(){for(var a=0;a<Pa.length;a++){var b=Pa[a];J.K(b.d.Na,function(a,b){if("SINK"!=b.type){var c=b.h;B.ux(c.Xd,c.cb,c.hc,c.width,c.height);for(var c=b.l,d=0;d<c.length;d++){var e=c[d].k;e&&Q.Vt(e)}}});b.d.Na=[];b.d.Bf=[]}Ea=null;Pa.length=0;ib.length=0;ya[0]=0;ya[1]=0;ya[2]=0};a.Cp=function(a,b,c){a=F.bv(a,a.Ea,a.La,null,!0);var d=aa.vv(a);a=na.Mi("DYNAMIC");a.Ia=a.Eb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.kb=a.tc=ia.zt();var e=
a.kb.oa;a.Me=a.Le=ia.Mk([e,0,0],[0,e,0],[0,0,e],a.kb.t);c=Q.vu(d,c);b.l.push({R:!0,Va:a,k:c})};a.na=H;a.Vv=function(a){return[a.frame_start,a.frame_end]};a.Fq=function(a,b){Jb=a;cb=b;Ea&&M(Ea,a,b,!1)};a.bi=q;a.yy=G;a.ia=D;a.get_environment_colors=function(a){a=G(a,za)[0];var b=a.ic,c=a.pc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Vd,d,e]};a.set_environment_colors=function(a,b,c,d){a=G(a,za);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Vd=b);c&&f.ic.set(c);
d&&f.pc.set(d);f.va=!0}};a.get_sky_params=function(a){if(a=D(a,"SKY")){var b={};b.color=Array(3);K.copy(a.wg,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=
a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,c){for(var d=G(a,["SKY"]),e=0;e<d.length;e++){var f=d[e];"number"==typeof c.procedural_skydome&&(f.procedural_skydome=c.procedural_skydome);"number"==typeof c.use_as_environment_lighting&&(f.use_as_environment_lighting=c.use_as_environment_lighting);"object"==typeof c.color&&f.wg.set(c.color);"number"==typeof c.rayleigh_brightness&&(f.rayleigh_brightness=c.rayleigh_brightness);"number"==
typeof c.mie_brightness&&(f.mie_brightness=c.mie_brightness);"number"==typeof c.spot_brightness&&(f.spot_brightness=c.spot_brightness);"number"==typeof c.scatter_strength&&(f.scatter_strength=c.scatter_strength);"number"==typeof c.rayleigh_strength&&(f.rayleigh_strength=c.rayleigh_strength);"number"==typeof c.mie_strength&&(f.mie_strength=c.mie_strength);"number"==typeof c.rayleigh_collection_power&&(f.rayleigh_collection_power=c.rayleigh_collection_power);"number"==typeof c.mie_collection_power&&
(f.mie_collection_power=c.mie_collection_power);"number"==typeof c.mie_distribution&&(f.mie_distribution=c.mie_distribution);f.va=!0;f.rj=!0;I(b(),f);B.Zf(f)}};a.get_fog_color_density=function(a,b){var c=b||[],d=G(a,Yb)[0].Fb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=G(a,Yb),d=0;d<c.length;d++){var e=c[d];e.Fb.set(b);e.va=!0}};a.get_ssao_params=function(a){var b=D(a,"SSAO");a=D(a,"SSAO_BLUR");if(!b)return null;var c=b.l[0].k,d={};d.ssao_quality=
Q.fb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.xn=a.ssao_blur_discard_value;d.radius_increase=b.Ag;d.influence=b.zg;d.dist_factor=b.yg;d.ssao_only=b.ssao_only;d.ssao_white=Q.fb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=D(a,"SSAO"),d=D(a,"SSAO_BLUR");if(!c)return ba.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.l[0].k;Q.U(e,"SSAO_QUALITY",b.ssao_quality);Q.tb(e,!0)}"number"==typeof b.ssao_hemisphere&&
(e=c.l[0].k,Q.U(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),Q.tb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.l[0].k,Q.U(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),Q.tb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Ag&&(c.Ag=b.Ag);"number"==typeof b.zg&&(c.zg=b.zg);"number"==typeof b.yg&&(c.yg=b.yg);if("number"==typeof b.ssao_only){c=D(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.l.length;f++)e=c.l[f].k,Q.U(e,"SSAO_ONLY",
b.ssao_only),Q.tb(e,!0)}"number"==typeof b.ssao_white&&(e=c.l[0].k,Q.U(e,"SSAO_WHITE",b.ssao_white),Q.tb(e,!0));c.va=!0;d.va=!0};a.get_dof_params=function(a){a=D(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=a.h.dof_power;return b};a.set_dof_params=V;a.get_god_rays_params=function(a){var b=G(a,["GOD_RAYS"]);a=D(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].lg;c.god_rays_intensity=
a.god_rays_intensity;c.god_rays_steps=Q.fb(b[0].l[0].k,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=G(a,["GOD_RAYS"]),d=D(a,"GOD_RAYS_COMBINE");if(!c||!d)return ba.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].lg=e,c[f].Ej=e/c[f].Dg/(f+1),c[f].va=!0;if("number"==typeof b.god_rays_steps)for(var g=
W.u(b.god_rays_steps,1),e=c[0].lg,f=0;f<c.length;f++){c[f].Dg=g;c[f].Ej=e/g/(f+1);c[f].va=!0;var h=c[f].l[0].k;Q.U(h,"STEPS_PER_PASS",g);Q.tb(h,!0)}d.va=!0};a.get_bloom_params=function(a){var b=D(a,["LUMINANCE_TRUNCED"]);a=D(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=D(a,"LUMINANCE_TRUNCED"),d=D(a,"BLOOM");if(!c||!d)return ba.error("Bloom is not enabled on scene"),0;
"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.va=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.va=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.Na,c=ea.eb(e,d,"BLOOM_BLUR"),e=ea.eb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].l[0].k;f&&(Q.Ef(f,b.bloom_blur),q(c[e],1/d.h.width,1/d.h.height))}};a.get_wind_params=function(){var a=ya,b=K.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};
a.set_wind_params=function(b,c){for(var d=H(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return ba.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(wa=[0,c.wind_dir/180*Math.PI,-Math.PI/2],ma.euler_to_quat(wa,xa),d.quat.set(xa),ca(g));"number"==typeof c.wind_strength&&(d.el=c.wind_strength,ca(g));N(b)};a.Fx=function(a){a.d.Nl=!0};a.get_water_surface_level=O;a.get_water_mat_params=function(a,b){var c=
D(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.ze,b.waves_length=c.Kf,c.zc)){b.water_fog_density=c.zc[3];var d=b.water_fog_color=[];d[0]=c.zc[0];d[1]=c.zc[1];d[2]=c.zc[2]}};a.set_water_params=function(a,b){var c=D(a,"MAIN_OPAQUE");if(!c||!c.Ba)return ba.error("set_water_params() - no water parameters on this scene"),null;c=c.Ba;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&
(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&
(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.$f=b.water_dynamic);for(var d=G(a,bb),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Fb&&(f.zc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Fb&&f.zc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.ze=b.waves_height);"number"==typeof b.waves_length&&(f.Kf=b.waves_length);f.va=!0}};a.get_shore_dist=function(a,b){var c=
D(Ea,"MAIN_OPAQUE");if(!c.dk)return 100;var d=c.mg,e=c.ye,f=(a[0]-c.ne[0])/c.oe[0],g=(c.ne[1]+a[2])/c.oe[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*ma.Ko(Ea.d.im,c.vg,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var e=b().camera.d,f=0;f<Pa.length;f++){var g=Pa[f],h=g.d.Na;if(g.d.Ba)var k=e.e[1]-O(e.e[0],e.e[2]);for(var m=g.d.Qg,l=0;l<m.length;l++){var q=m[l].d.Sa,p=m[l].d.fl+m[l].d.pb;if(q){var r=m[l].d,ea=Math.round(q.currentTime*r.qh),t=r.pb/r.qh;if(ea<r.pb-
(Y.ef?5:0)||m[l].d.hi&&ea>p)q.currentTime=t;!m[l].d.hi&&ea>p&&q.pause();2<=q.readyState&&Da.az(r)}}J.K(h,function(b,c){-1<ab.indexOf(c.type)&&(c.time=a);-1<bb.indexOf(c.type)&&g.d.Ba&&(c.Ck=k)})}if(Y.deferred_rendering)for(f=0;f<ib.length;f++)X(ib[f],a);for(f=0;f<Pa.length;f++)if(g=Pa[f],l=g.d,e=l.Bf,l.sj&&(d(g),l.sj=!1),l.Nl&&(P(g),l.Nl=!1),e.length){g.b4w_enable_motion_blur&&R(l.Na,c);if(Y.deferred_rendering&&l.glow){for(var h=D(g,"GLOW_MASK").l,v=0,l=0;l<h.length;l++)v+=h[l].k.gg;J.K(g.d.Na,function(a,
b){"GLOW"===b.type&&(b.Xk=v)})}h=null;for(l=0;l<e.length;l++)"GLOW_MASK"==e[l].type&&(h=l);for(l=0;l<e.length;l++)m=e[l],fa.Yl(m),null!==h&&U(m,e[h]),B.Zf(m)}Y.show_hud_debug_info&&ja.by(Pa,c)};a.kl=function(a){var b=[];J.K(a.d.Na,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.Qs={zm:0,Yo:b,Nh:c,rq:d};-1==ib.indexOf(a)&&ib.push(a)};a.clear_glow_anim=function(a){if(a.P)for(var b=0;b<a.P.length;b++){var c=a.P[b];"COLOR_ID"==c.type&&(c.gg=0)}a=ib.indexOf(a);-1!=a&&ib.splice(a,
1)};a.cA=function(){ib=[]};a.get_cam_water_depth=function(){var a=D(Ea,"MAIN_BLEND"),b=Ea;return a||b.d.Ba?a.Ck:null};a.get_object_data_id=function(a){return a.d.jd};a.mr=N;a.Yx=function(a,b){switch(b){case "WM_NONE":a.R=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_mode=S.Xm[b];a.R=!0}a.sa="WM_TRANSPARENT_WIREFRAME"==b;a.va=!0};a.Xx=function(a,b){for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_edge_color=
b,a.va=!0};a.fn=function(a,b){for(var c=0;c<b.length;c++)a.ab.ALL.push(b[c]),a.ab.MESH.push(b[c])};a.lr=ca;a.pick_object=function(d,e){if(!c())return ba.error("No active scene"),null;var f=b(),g=D(f,"COLOR_PICKING");if(g){fa.Yl(g);B.Zf(g);var h=D(f,"COLOR_PICKING_XRAY");h?(fa.Yl(h),B.Zf(h),g=h.h):g=g.h;e=g.height-e;g=B.nx(g.Xd,d,e);f=H(f,"MESH",a.DATA_ID_ALL);for(h=0;h<f.length;h++){var k=f[h].Zm;if(k&&5>Math.abs(255*k[0]-g[0])&&5>Math.abs(255*k[1]-g[1])&&5>Math.abs(255*k[2]-g[2]))return f[h]}}else ba.error("Color picking is not available");
return null};a.dw=function(){return ya};a.Wv=function(b){var c=[];b=H(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.Mc&&c.push(e)}return c}};b4w.module.__physics=function(a,n){function b(a,c){for(var d=a.Hd,e=0;e<d.length;e++)d[e].d.ak&&c.push(d[e]),b(d[e],c)}function c(a,b){if(R)switch(a){case x.Lr:I.log(b);break;case x.Ir:I.error(b);break;case x.Jr:H.fbmsg.apply(this,b.slice(1));break;case x.Pr:var c=g(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,h=b.angvel,c=c.j;c.Qk=b.time;G.ai(d,1,e,c.Rk);O.copy(f,c.zp);O.copy(h,c.hn)}break;case x.Nr:(d=g(b.chassis_hull_body_id))&&G.ai(b.trans,1,b.quat,d.f.Sh[b.prop_ind]);break;case x.Kr:if(c=
g(b[1]))d=b[4],c=c.sc.Ci[b[2]],q.set_translation(c,b[3]),q.set_rotation(c,d),q.v(c);break;case x.Qr:if(c=g(b[1]))c.f.speed=b[2];break;case x.Gr:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),h=R.j.l,k=0;k<h.length;k++)for(var m=h[k].gb,l=0;l<m.Ec.length;l++){for(var p=m.Ec[l],r=p.xj,t=!1,v=0;v<r.length;v++){var s=r[v];if(s[0]===d&&s[1]===c){p.eq[v]=e;t=!0;break}}if(t){r=p.eq;for(v=t=0;v<r.length;v++)t=t||r[v];p.callback(t,f)}}break;case x.Hr:if(c=g(b[1]))c=c.j,c.Ki&&c.Ki(b[2]);
break;case x.Or:if(c=g(b.body_id))for(c=c.j,e=b.from,f=b.to,h=b.local,k=b.body_id_b_hit,m=b.cur_result,l=0;l<c.ie.length;l++)if(r=c.ie[l],D.Ji(r.G,e)&&D.Ji(r.V,f)&&r.local==h){for(d in r.zd)r.zd[d]=1;-1!=k&&(r.zd[k]=m);for(var p=r.Pb,v=r.callback,r=r.zd,t=!1,s=1,z=0;z<R.j.l.length;z++){var n=R.j.l[z].gb;if(("ANY"==p||n.id==p)&&n.F in r&&1!==r[n.F]){t=!0;s=r[n.F];break}}v(t,s)}break;case x.Mr:console.log("Physics message ping: ",performance.now()-b[1]);break;default:I.error("Wrong message: "+a)}}function g(a){return N[a]||
null}function f(){ca.body++;return ca.body}function l(a){return{F:a,Hl:0,ej:!1,pe:!0,eB:!1,is_character:!1,xw:!1,Li:null,id:"",eA:{},Ec:[],Ki:null,ie:[],Qk:0,Rk:new Float32Array([0,0,0,1,0,0,0,1]),zp:new Float32Array(3),hn:new Float32Array(3),Gi:new Float32Array(3),Fi:new Float32Array(4)}}function h(a,b){switch(a){case "BOX":var c=b.Eb;break;case "CYLINDER":c=b.wk;break;case "CONE":c=b.vk;break;case "SPHERE":c=b.tc;break;case "CAPSULE":c=b.uk}return c}function k(a){if(!a)return null;var b={};"number"===
typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.t&&(b.center=a.t);"number"===typeof a.oa&&(b.radius=a.oa);"number"===typeof a.height&&(b.height=a.height);return b}function e(a,b,c,d){var e=a.d.e,f=b.d.H,g=new Float32Array(16);T.invert(f,g);f=new Float32Array(3);O.transformMat4(e,
g,f);switch(b.f.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Eb;x.m(x.Sr,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:x.m(x.Rr,c,f,a.GB)}}function r(a){return a.j&&a.j.Li?!0:!1}function v(a,b,c,d,e,f,g,h,k,m){var l;ca.Yn++;l=ca.Yn.toString(16);x.m(x.Zr,l,a,h,b.j.F,c,d,e.j.F,f,g,k,m);b.j.Li=l}function m(a){var b=a.j;if(b&&(0===b.Hl||!0===b.ej||!1===b.pe||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.j.Gi[0]||a.d.e[1]!=a.j.Gi[1]||a.d.e[2]!=a.j.Gi[2]||
a.d.quat[0]!=a.j.Fi[0]||a.d.quat[1]!=a.j.Fi[1]||a.d.quat[2]!=a.j.Fi[2])){a.j.Gi.set(a.d.e);a.j.Fi.set(a.d.quat);var b=a.j,c=x.Qo(x.Lf);c.msg_id=x.Lf;c.body_id=a.j.F;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=ia,U.identity(ia)):c.quat=a.d.quat;x.m(x.Lf,c)}a=a.Hd;for(b=0;b<a.length;b++)m(a[b])}function t(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;O.transformQuat(e,a,e)}function s(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.j.l.length;e++){var f=
b.j.l[e];if("ANY"==a||f.gb.id==a)f=f.gb.F,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function y(a,b){x.m(x.Ac,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=D.ln(e.G)+D.ln(e.V)+String(e.local);c[f]=c[f]||{G:e.G,V:e.V,local:e.local,zn:[]};var g=c[f].zn,h;for(h in e.zd)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].G,e=c[f].V,h=c[f].local,g=c[f].zn,x.m(x.Vm,a,d,e,h,g)}else x.m(x.Vm,a,null,null,!1,null)}function d(a,b){if(b.Cg){var c=a.j.F,d=b.bg*b.Eo,e=b.dh*b.Bn,f=-b.Bg*b.tm*2*Math.PI/
b.Uq;b.op&&(f*=-1);switch(b.type){case 10:x.m(x.Ac,c);x.m(x.Gs,c,d,e,f);break;case 20:x.m(x.Ac,c),x.m(x.Fs,c,d,e,f)}}}function C(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function A(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function u(a){return a.b4w_character?!0:!1}function w(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}n("__camera");var p=n("__config");n("__constraints");var I=n("__print"),H=n("__debug"),x=n("__ipc");
n("__renderer");var M=n("__scenes"),q=n("__transform"),G=n("__tsr"),D=n("__util"),V=n("__version"),O=n("vec3"),U=n("quat"),T=n("mat4"),L=p.gb,P=p.n,R=null,X=[],N=[],ca={yr:0,body:0,Yn:0,shape:0},Q=new Float32Array(3),ia=new Float32Array(4),F=new Float32Array(4),ga=new Float32Array(16),S=new Float32Array(8),z=new Float32Array(8);a.rw=function(a){if(L.enabled){var b=L.Mg+V.timestamp();I.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+L.de);b=new Worker(b);x.init(b,c);x.m(x.ps,a,L.de)}};a.nn=function(a){var b;
ca.yr++;b=ca.yr;x.m(x.ds,b);a.j={};a.j.sz=b;a.j.l=[]};a.cleanup=function(){if(L.enabled){x.m(x.ks);R=null;X.length=0;N.length=0;for(var a in ca)ca[a]=0}};a.append_object=function(a,c){R=c;x.m(x.us,c.j.sz);var g=a.d;if(!g)throw"No object render: "+a.name;if(a.parent&&g.ak)return null;var m=[];g.ak&&b(a,m);for(var p=a.P||[],q=0;q<p.length;q++){var B=p[q],ea;if(ea="PHYSICS"==B.type){var t;a:{for(var s=c.j.l,z=0;z<s.length;z++){var n=s[z].k;if(n&&n.id==B.id){t=!0;break a}}t=!1}ea=!t}if(ea)if(B.$b.D)if(B.xe&&
c.d.Ba){var y=B;x.m(x.cs);var S=R,G=M.ia(S,"MAIN_OPAQUE");if(G.Ba&&y.nz){var H={};H.dst_noise_scale0=y.dst_noise_scale0;H.dst_noise_scale1=y.dst_noise_scale1;H.dst_noise_freq0=y.dst_noise_freq0;H.dst_noise_freq1=y.dst_noise_freq1;H.dir_min_shore_fac=y.dir_min_shore_fac;H.dir_freq=y.dir_freq;H.dir_noise_scale=y.dir_noise_scale;H.dir_noise_freq=y.dir_noise_freq;H.dir_min_noise_fac=y.dir_min_noise_fac;H.dst_min_fac=y.dst_min_fac;H.waves_hor_fac=y.waves_hor_fac;var Na=G.ze,V=G.Kf,L=G.ye;G.dk?x.m(x.Um,
H,G.oe[0],G.oe[1],G.ne[0],G.ne[1],G.mg,Na,V,L,G.vg,S.d.im):x.m(x.Um,H,0,0,0,0,0,Na,V,L,0,null)}}else{var P;if(B.dz){var Q=a,ca=B,ia=f(),Pa=ca.$b;x.m(x.as,ia,Pa.r[0].a_position,Pa.Y||null,Q.d.e,ca.Tn,ca.Un);var ib=l(ia);ib.ej=!0;P=ib}else{var Jb=a,cb=B,Za=f(),sb=cb.$b;x.m(x.bs,Za,sb.r[0].a_position,sb.Y||null,Jb.d.e,cb.th,cb.nh,cb.Tn,cb.Un);P=l(Za)}var wa=P;wa.id=B.Pb;var Ca={k:B,gb:wa};c.j.l.push(Ca)}else I.error("Object "+a.name+" has collision material with no assigned vertices")}if(C(a)||A(a)||
u(a)||w(a)||a.b4w_collision){var Xa=a,xa=g.gq,sa=Xa.d,Ja=Xa.game,Zb=f();if("CAMERA"==Xa.type)var $a=Ja.use_collision_bounds?Ja.collision_bounds_type:"BOX",tb=h($a,sa),ya=sa.th,Kb=sa.nh,ya=.5,Kb=0;else"EMPTY"==Xa.type?($a="EMPTY",tb=null,Kb=ya=0):($a=Ja.use_collision_bounds?Ja.collision_bounds_type:"BOX",tb=h($a,sa),ya=sa.th,Kb=sa.nh);var Lb=sa.e,bd=sa.quat,Sc=Ja.use_ghost,cd=Ja.use_sleep,Tc=Ja.mass,uc=Ja.velocity_min,mb=Ja.velocity_max,Ya=Ja.damping,yb=Ja.rotation_damping,dc=Ja.collision_group,Mb=
Ja.collision_mask,Ub=sa.tc.oa,Vb=k(tb),lc=Xa.b4w_correct_bounding_offset,va;var Nb=$a;if(m.length){var db=[],ra={};ra.quat=new Float32Array([0,0,0,1]);ra.trans=new Float32Array(3);ra.worker_bounding=Vb;ra.bounding_type=Nb;db.push(ra);T.invert(sa.H,ga);U.invert(sa.quat,F);for(var zb=0;zb<m.length;zb++){var da={},Ua=m[zb],eb=Ua.game.collision_bounds_type,la=new Float32Array(4),Ka=new Float32Array(3);O.transformMat4(Ua.d.e,ga,Ka);U.multiply(F,Ua.d.quat,la);da.trans=Ka;da.quat=la;da.bounding_type=eb;
da.worker_bounding=k(h(eb,Ua.d));db.push(da)}va=db}else va=[];x.m(x.Vr,Zb,Lb,bd,xa,Sc,cd,Tc,uc,mb,Ya,yb,dc,Mb,$a,Vb,Ub,ya,Kb,va,lc);X.push(Xa);N[Zb]=Xa;var fb=l(Zb);fb.type=xa;fb.Hl=Tc;fb.ej=Sc;wa=fb;a.j=wa;Ca={k:null,gb:wa};c.j.l.push(Ca)}if(C(a)||A(a)){var ua=a,Va=ua.j.F;C(ua)?(ua.f.type=10,x.m(x.Wr,Va,ua.f.By,ua.f.Dy,ua.f.Cy,ua.f.qz,ua.f.Nw)):A(ua)&&(ua.f.type=20,x.m(x.Ur,Va,ua.f.bl,ua.f.Jm,ua.f.Km));if(ua.f.Af){var oa=ua.f.Af;switch(ua.f.type){case 10:e(oa[1],ua,Va,!0);e(oa[0],ua,Va,!0);e(oa[3],
ua,Va,!1);e(oa[2],ua,Va,!1);break;case 20:for(var La=0;La<oa.length;La++)e(oa[La],ua,Va,!1)}}ua.j.id=ua.b4w_vehicle_settings.name;d(a,a.f)}else if(u(a)){var Ab=a.d,ec=a.j,$b=Ab.Eb.max_y-Ab.Eb.min_y,ac=ec.F,ub=a.b4w_character_settings,Bb=ub.walk_speed,mc=ub.run_speed,Cb=ub.step_height,vb=ub.jump_strength,nc=ub.waterline,Ob=D.Ru(a);x.m(x.Xr,ac,Ob,$b,Bb,mc,Cb,vb,nc);ec.is_character=!0}else if(w(a)){var Ma=a,bc=Ma.j.F;x.m(x.$r,bc,Ma.sc.bl,Ma.sc.Jm,Ma.sc.Km);if(Ma.sc.Ci)for(var oc=Ma.sc.Ci,Qa=0;Qa<oc.length;Qa++){var nb=
oc[Qa],Db=nb.d.e,pc=Ma.d.H,Fa=new Float32Array(16);T.invert(pc,Fa);var Oa=new Float32Array(3);O.transformMat4(Db,Fa,Oa);x.m(x.Tr,bc,Oa,nb.Ct)}Ma.j.xw=!0}else a.b4w_collision&&(wa.id=a.b4w_collision_id);for(q=0;q<X.length;q++)if(a=X[q],a.j){var E=a;if(!r(E))for(var ka=0;ka<E.constraints.length;ka++){var Ba=E.constraints[ka],qa=Ba.target,Wb=Ba.pivot_type;if("RIGID_BODY_JOINT"==Ba.type&&qa.j){var Z=new Float32Array([Ba.pivot_x,Ba.pivot_y,Ba.pivot_z]),jb,kb=new Float32Array([Ba.axis_x,Ba.axis_y,Ba.axis_z]);
jb=D.euler_to_quat(kb,new Float32Array(4));var Pb=T.fromRotationTranslation(jb,Z,new Float32Array(16)),ob=T.multiply(E.d.H,Pb,new Float32Array(16)),Qb=T.invert(qa.d.H,new Float32Array(16)),wb=T.multiply(Qb,ob,Qb),Eb=D.of(wb),Rb=D.matrix_to_quat(wb),Aa=Ba,Ga={};Ga.use_limit_x=Aa.use_limit_x;Ga.use_limit_y=Aa.use_limit_y;Ga.use_limit_z=Aa.use_limit_z;Ga.use_angular_limit_x=Aa.use_angular_limit_x;Ga.use_angular_limit_y=Aa.use_angular_limit_y;Ga.use_angular_limit_z=Aa.use_angular_limit_z;Ga.limit_max_x=
Aa.limit_max_x;Ga.limit_min_x=Aa.limit_min_x;Ga.limit_max_y=Aa.limit_max_y;Ga.limit_min_y=Aa.limit_min_y;Ga.limit_max_z=Aa.limit_max_z;Ga.limit_min_z=Aa.limit_min_z;Ga.limit_angle_max_x=Aa.limit_angle_max_x;Ga.limit_angle_min_x=Aa.limit_angle_min_x;Ga.limit_angle_max_y=Aa.limit_angle_max_y;Ga.limit_angle_min_y=Aa.limit_angle_min_y;Ga.limit_angle_max_z=Aa.limit_angle_max_z;Ga.limit_angle_min_z=Aa.limit_angle_min_z;v(Wb,E,Z,jb,qa,Eb,Rb,Ga,null,null)}}}};a.hv=g;a.update=function(){for(var a=0;a<X.length;a++){var b=
X[a],c=b.j;if(c.pe&&c.Qk){var d=performance.now()/1E3-c.Qk,d=Math.min(d,10/60);P.Uw&&(d=0);var e=S;G.sw(c.Rk,d,c.zp,c.hn,S);q.set_translation(b,G.Wo(e));q.set_rotation(b,G.Ro(e));q.v(b);m(b);if(b.f)for(var c=b,d=c.f.Af,e=c.d.Vc,f=S,g=0;g<d.length;g++){var h=d[g];G.multiply(e,c.f.Sh[g],f);q.Dq(h,f);q.v(h)}b.f&&b.f.Cg&&(c=b.f,d=c.Cg)&&(e=b.f.Vq,h=ga,f=b.d.e,g=b.d.quat,D.Bm(b.f.Wq,g,f,h),D.of(h,d.d.e),D.matrix_to_quat(h,d.d.quat),h=ia,D.Cm(e,g,f,h),e=F,U.setAxisAngle(h,-c.Bg*c.tm*2*Math.PI,e),U.multiply(e,
d.d.quat,d.d.quat),q.v(d));b.f&&b.f.qm&&(c=b.f,d=c.qm)&&(f=b.f.Oq,e=ga,g=b.d.e,h=b.d.quat,D.Bm(b.f.Pq,h,g,e),D.of(e,d.d.e),D.matrix_to_quat(e,d.d.quat),e=ia,D.Cm(f,h,g,e),f=F,g=Math.abs(c.speed)*c.Nq,g>c.Jl&&(g=c.Jl),U.setAxisAngle(e,-g,f),U.multiply(f,d.d.quat,d.d.quat),q.v(d));b.f&&b.f.wm&&(c=b.f,d=c.wm)&&(e=b.f.br,h=ga,f=b.d.e,g=b.d.quat,D.Bm(b.f.cr,g,f,h),D.of(h,d.d.e),D.matrix_to_quat(h,d.d.quat),b=ia,D.Cm(e,g,f,b),e=F,U.setAxisAngle(b,-Math.abs(c.bg)*c.no,e),U.multiply(e,d.d.quat,d.d.quat),
q.v(d))}}if(a=R)a=M.ia(a,"MAIN_OPAQUE"),a.Ba&&0<a.Ba.waves_height&&(b=O.length(a.mi),x.m(x.Es,a.time*b))};a.Bv=function(){return R};a.pause=function(){L.enabled&&x.m(x.qs)};a.resume=function(){L.enabled&&x.m(x.ts)};a.enable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(!a.pe){var b=a.F;a.pe=!0;x.m(x.os,b)}};a.disable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(a.pe){var b=a.F;a.pe=!1;x.m(x.ns,b)}};a.has_physics=function(a){return a.j?!0:!1};a.has_dynamic_physics=
function(a){return(a=a.j)&&a.pe&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Hl&&0==a.ej?!0:!1};a.has_simulated_physics=function(a){return(a=a.j)&&a.pe?!0:!1};a.set_gravity=function(a,b){x.m(x.Ds,a.j.F,b)};a.lw=r;a.apply_constraint=v;a.clear_constraint=function(a){a=a.j;x.m(x.ss,a.Li);a.Li=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=G.Vf(c,1,d,S);f=G.Vf(f,1,g,z);G.invert(c,c);G.multiply(f,c,c);q.aw(e,f);G.multiply(f,c,c);q.Dq(b,c);q.v(b);a.set_transform(b,b.d.e,b.d.quat)};a.set_transform=
function(a,b,c){G.ai(a.d.e,1,a.d.quat,a.j.Rk);var d=x.Qo(x.Lf);d.msg_id=x.Lf;d.body_id=a.j.F;d.trans=b;d.quat=c;x.m(x.Ac,a.j.F);x.m(x.Lf,d)};a.sync_transform=m;a.apply_velocity=function(a,b,c,d){t(a,b,c,d,Q);a=a.j.F;x.m(x.Ac,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(Q[0]),f=Math.abs(Q[1]),g=Math.abs(Q[2]);Q[0]=e?Q[0]/e*Math.max(e,b):0;Q[1]=f?Q[1]/f*Math.max(f,c):0;Q[2]=g?Q[2]/g*Math.max(g,d):0;x.m(x.Wm,a,Q[0],Q[1],Q[2])};a.apply_velocity_world=function(a,b,c,d){a=a.j.F;x.m(x.Ac,
a);x.m(x.Wm,a,b,c,d)};a.apply_force=function(a,b,c,d){t(a,b,c,d,Q);a=a.j.F;x.m(x.Ac,a);x.m(x.es,a,Q[0],Q[1],Q[2])};a.apply_torque=function(a,b,c,d){t(a,b,c,d,Q);a=a.j.F;x.m(x.Ac,a);x.m(x.gs,a,Q[0],Q[1],Q[2])};a.set_character_move_dir=function(a,b,c){a=a.j.F;x.m(x.Ac,a);x.m(x.xs,a,b,c)};a.set_character_move_type=function(a,b){x.m(x.ys,a.j.F,b)};a.set_character_walk_velocity=function(a,b){x.m(x.Cs,a.j.F,b)};a.set_character_run_velocity=function(a,b){x.m(x.As,a.j.F,b)};a.set_character_fly_velocity=function(a,
b){x.m(x.vs,a.j.F,b)};a.character_jump=function(a){x.m(x.hs,a.j.F)};a.character_rotation_inc=function(a,b,c){x.m(x.js,a.j.F,b,c)};a.set_character_rotation=function(a,b,c){x.m(x.zs,a.j.F,b,c)};a.set_character_rotation_h=function(a,b){x.m(x.ws,a.j.F,b)};a.set_character_rotation_v=function(a,b){x.m(x.Bs,a.j.F,b)};a.aA=function(){return!1};a.$z=function(){return!1};a.check_collision=function(){I.error("check_collision() deprecated");return!1};a.Zz=function(){I.error("check_collision_any() deprecated");
return!1};a.check_ray_hit=function(){I.error("check_ray_hit() deprecated");return!1};a.LB=function(){I.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.j,f=e.F;b=b||"ANY";for(var g=0;g<e.Ec.length;g++){var h=e.Ec[g];if(h.Pb==b&&h.callback==c)return}g=[];a=a.j.F;h=[];s(b,R,h,null);for(var k=0;k<h.length;k++){var m=h[k];a<m?g.push([a,m]):a>m&&g.push([m,a])}h={Pb:b,callback:c,xj:g,eq:new Uint8Array(g.length),Ml:d||!1};e.Ec.push(h);x.m(x.Ac,f);x.m(x.Yr,g,d)};
a.remove_collision_test=function(a,b,c){a=a.j;b=b||"ANY";for(var d=0;d<a.Ec.length;d++){var e=a.Ec[d];if(e.Pb==b&&e.callback==c){a.Ec.splice(d,1);d--;for(var e=e.xj,f=R.j.l,g=0;g<f.length;g++)for(var h=f[g].gb,k=0;k<h.Ec.length;k++)for(var m=h.Ec[k],l=0;l<m.xj.length;l++)for(var q=m.xj[l],p=0;p<e.length;p++){var r=e[p];q[0]===r[0]&&q[1]===r[1]&&(e.splice(p,1),p--)}e.length&&x.m(x.rs,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.j;c?(x.m(x.fs,c.F),c.Ki=b):I.error("Object "+a.name+" has no physics")};
a.clear_collision_impulse_test=function(a){var b=a.j;b?(x.m(x.ls,b.F),b.Ki=null):I.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.j;if(g){a=g.F;b=b||"ANY";c={G:new Float32Array(c),V:new Float32Array(d),local:e,callback:f,Pb:b,zd:{}};s(b,R,null,c.zd);delete c.zd[a];for(var h in c.zd)c.zd[h]=1;g.ie.push(c);y(a,g.ie)}else I.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.j){a=b.F;for(var f=0;f<b.ie.length;f++){var g=
b.ie[f];D.Ji(g.G,c)&&D.Ji(g.V,d)&&g.local==e&&(b.ie.splice(f,1),f--)}y(a,b.ie)}else I.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.f;c.bg=b;d(a,c)};a.vehicle_steer=function(a,b){var c=a.f;c.Bg=b;d(a,c)};a.vehicle_brake=function(a,b){var c=a.f;c.dh=b;d(a,c)};a.is_vehicle_chassis=C;a.is_vehicle_hull=A;a.vw=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==
a?!0:!1};a.uw=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.yw=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.tp=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.sp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.up=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.f.speed};a.rz=
function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=u;a.dB=w;a.IA=function(){return 0};a.Lu=function(){x.m(x.ms)};a.sx=function(a){var b=X.indexOf(a);-1!=b?(X.splice(b,1),a=N.indexOf(a),-1!=a&&N.splice(a,1)):I.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,n){function b(a,b){for(var c=Q(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}cb[b.id]=null;Za[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=na.Xo(a));d=a.width;a=a.height;W.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(sb)&&c&&W.warn("B4W Warning: image",b,"is not from app root.")}function g(a,b,c,d,e,f){d=b.q;if(!d)throw"Nothing requested";ba.enqueue([[d,ba.AT_JSON,
d]],function(d,f,g,h){if(d){W.log("%cLOAD METADATA","color: #616",h);f=d.b4w_format_version;if(Number(f)<bb.Fp)throw"Incompatible file version: "+f+". Required: "+bb.Fp;for(var B in d)a[B]=d[B];(d=a.binaries[0].binfile)?b.vn=d:(aa.lm(b,"load_binaries"),aa.lm(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)W.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)W.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}},null,function(a){f(b,c,a)})}function f(a,b,c,d,e,f){d=X(b.q)+b.vn;if(!d)throw"Binary data is missing";ba.enqueue([[d,ba.AT_ARRAYBUFFER,d]],function(d,f,g,h){d&&(W.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function l(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,B=a.meshes;a=a.actions;for(var k=za.Pt(),m=["indices"],l=["normal","tangent"],p=["color","group"],q=["position","texcoord","texcoord2"],r=0;r<B.length;r++)for(var t=B[r].submeshes,
ea=0;ea<t.length;ea++)for(var v in t[ea]){var s=t[ea][v][1];if(-1!=m.indexOf(v)){var z=4*t[ea][v][0]+f["int"],n=t[ea],w=v,y=d;if(k)var ba=new Uint32Array(y,z,s);else for(var ba=new Uint32Array(s),y=new DataView(y),J=0;J<s;J++)ba[J]=y.getUint32(z+4*J,!0);n[w]=ba}else if(-1!=q.indexOf(v))z=4*t[ea][v][0]+f["float"],t[ea][v]=h(d,z,s,k);else if(-1!=l.indexOf(v)){z=2*t[ea][v][0]+f["short"];n=t[ea];w=v;y=d;ba=new Float32Array(s);y=new DataView(y);for(J=0;J<s;J++)ba[J]=y.getInt16(z+2*J,!0)/32767;n[w]=ba}else if(-1!=
p.indexOf(v)){z=2*t[ea][v][0]+f.ushort;n=t[ea];w=v;y=d;ba=new Float32Array(s);y=new DataView(y);for(J=0;J<s;J++)ba[J]=y.getUint16(z+2*J,!0)/65535;n[w]=ba}}for(v=0;v<g.length;v++)for(B=g[v].particle_systems,m=0;m<B.length;m++)l=B[m],l.transforms=h(d,4*l.transforms[0]+f["float"],l.transforms[1],k);for(g=0;g<a.length;g++){v=a[g];var B=v.fcurves,l=v.frame_range,m=l[0],l=l[1],p=S.Gv(m,l),q=null,t=r=!1,u;for(u in B)r|=-1<u.indexOf("rotation_euler"),t|=-1<u.indexOf("rotation_quaternion");for(u in B)if(r&&
t&&-1<u.indexOf("rotation_euler"))delete B[u];else{var ea=B[u],D;for(D in ea)s=ea[D],z=h(d,f["float"]+4*s.bin_data_pos[0],s.bin_data_pos[1],k),n=new Float32Array(p),null===q&&(q=new Int8Array(p)),S.qt(s,z,n,q,m,l),s.Ob=n;-1<u.indexOf("rotation_euler")&&S.gv(B,u)}v.Ns=q}e(b,c)}function h(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function k(a,b,c,d,e){var f=a.cameras,g=a.groups,h=a.materials,B=a.meshes,
k=a.node_groups,m=a.objects,l=a.particles,q=a.scenes,p=a.speakers,r=a.textures,v=a.worlds;k||(W.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),k=a.node_groups=[]);for(var z="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),n={},w=0;w<z.length;w++)for(var y=a[z[w]],ba=0;ba<y.length;ba++){var J=y[ba];n[J.uuid]=J}for(var u=0;u<q.length;u++){for(var D=q[u],aa=D.objects,G=
0;G<aa.length;G++)s(aa,G,n);D.camera&&s(D,"camera",n);D.world&&s(D,"world",n)}for(u=0;u<g.length;u++)for(var A=g[u].objects,G=0;G<A.length;G++)s(A,G,n);for(u=0;u<m.length;u++){var fa=m[u];fa.dupli_group&&s(fa,"dupli_group",n);fa.parent&&s(fa,"parent",n);if(fa.animation_data){var C=fa.animation_data;C.action&&s(C,"action",n);if(C.nla_tracks)for(G=0;G<C.nla_tracks.length;G++)for(var Y=C.nla_tracks[G],I=0;I<Y.strips.length;I++)Y.strips[I].action&&s(Y.strips[I],"action",n)}switch(fa.type){case "MESH":if(!fa.data)throw"mesh not found for object "+
fa.name;s(fa,"data",n);for(var H=fa.modifiers,G=0;G<H.length;G++){var ma=H[G];"ARMATURE"==ma.type?s(ma,"object",n):"CURVE"==ma.type&&s(ma,"object",n)}var O=fa.particle_systems;if(O)for(G=0;G<O.length;G++)s(O[G],"settings",n);break;case "ARMATURE":s(fa,"data",n);for(var F=fa.pose.bones,V=fa.data.bones,G=0;G<F.length;G++){var ja=F[G];ja.bone=V[ja.bone];for(var T=ja.parent_recursive,I=0;I<T.length;I++)T[I]=F[T[I]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":s(fa,"data",n)}var L=fa.constraints;
if(L)for(G=0;G<L.length;G++){var ta=L[G];ta.target&&s(ta,"target",n)}var U=fa.lod_levels;if(U)for(G=0;G<U.length;G++){var P=U[G];P.object&&s(P,"object",n)}}for(u=0;u<B.length;u++)for(var N=B[u].materials,G=0;G<N.length;G++)s(N,G,n);for(u=0;u<h.length;u++){for(var Ra=h[u],Ia=Ra.texture_slots,G=0;G<Ia.length;G++)s(Ia[G],"texture",n);var R=Ra.node_tree;R&&t(R,n)}for(u=0;u<k.length;u++)(R=k[u].node_tree)&&t(R,n);for(u=0;u<r.length;u++){var na=r[u],X=na.type;"IMAGE"!=X&&"ENVIRONMENT_MAP"!=X||s(na,"image",
n)}for(u=0;u<f.length;u++){var ca=f[u];ca.dof_object&&s(ca,"dof_object",n)}for(u=0;u<p.length;u++){var Za=p[u];Za.sound&&s(Za,"sound",n);if(Za.animation_data&&(C=Za.animation_data,C.action&&s(C,"action",n),C.nla_tracks))for(G=0;G<C.nla_tracks.length;G++)for(Y=C.nla_tracks[G],I=0;I<Y.strips.length;I++)Y.strips[I].action&&s(Y.strips[I],"action",n)}for(u=0;u<l.length;u++){for(var E=l[u],Ia=E.texture_slots,G=0;G<Ia.length;G++)s(Ia[G],"texture",n);E.dupli_group&&s(E,"dupli_group",n);E.dupli_object&&s(E,
"dupli_object",n)}for(u=0;u<v.length;u++)if(Ia=v[u].texture_slots)for(G=0;G<Ia.length;G++)s(Ia[G],"texture",n);Da.Ot(a);wa=0===b.id;Ca||(Ca=a.scenes[0]);for(var ga=a.textures,cb=wa?a.scenes[0].b4w_anisotropic_filtering:Ca.b4w_anisotropic_filtering,Ea=0;Ea<ga.length;Ea++)wa||"SCENE"!=ga[Ea].b4w_source_type||(ga[Ea].b4w_source_id=""),Na.Cu(ga[Ea],cb,a.scenes);for(var Pa={},Z=a.objects,Jb=0;Jb<Z.length;Jb++){var kb=Z[Jb];if("MESH"===kb.type&&!kb.particle_systems.length)for(var Pb=kb.data,ob=Pb.name,
Qb=Pb.submeshes,wb=Pb.materials,Eb=0;Eb<Qb.length;Eb++)0!==Qb[Eb].base_length||Pa[ob]||(wb[Eb]?W.warn('B4W Warning: material "'+wb[Eb].name+'" is not assigned to any face (object "'+kb.name+'").'):W.warn('B4W Warning: Mesh "'+Pb.name+'" has no faces (object "'+kb.name+'").'),Pa[ob]=!0)}for(var Rb=a.meshes,Aa=0;Aa<Rb.length;Aa++){var xa=Rb[Aa];xa.materials.length||xa.uv_textures.length&&W.warn('B4W Warning: mesh "'+xa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var sb=a.meshes,Xa=za.keysearch("name","DEFAULT",a.materials),sa=0;sa<sb.length;sa++){var Ja=sb[sa];0==Ja.materials.length&&Ja.materials.push(Xa)}for(var ya=a.actions,$a=b.id,tb=0;tb<ya.length;tb++){var pb=ya[tb];pb.Ps=$a;S.$s(pb)}for(var Gb=a.scenes,qb=0;qb<Gb.length;qb++){for(var gc=Gb[qb],wc=K.Jk(gc,"ALL"),xc=[],xb=0;xb<wc.length;xb++)for(var Hb=wc[xb].particle_systems,Ib=0;Ib<Hb.length;Ib++){var gb=Hb[Ib].settings;if("HAIR"==gb.type)if("OBJECT"==gb.render_type)ea.Em(gb.dupli_object,!0);else if("GROUP"==
gb.render_type){for(var Sb=gb.dupli_group,yc=K.Jk(gc,"EMPTY"),hb=0;hb<yc.length;hb++)yc[hb].dupli_group==Sb&&xc.push(yc[hb]);for(hb=0;hb<Sb.objects.length;hb++)ea.Em(Sb.objects[hb],!0)}else W.warn("B4W Warning: render type",gb.render_type,"not supported for particle systems ("+gb.name+").")}for(xb=0;xb<xc.length;xb++)M(xc[xb],[gc])}ia(a,b.id);for(var zc=a.scenes,Uc=0;Uc<zc.length;Uc++){for(var ld=zc[Uc],hc=[],qc=[],Gc=zc[Uc].objects,rb=0;rb<Gc.length;rb++){var Ac=Gc[rb];x(Gc,Ac,hc,qc);var Vc=Ac.dupli_group;
if(Vc)for(var rc=Vc.objects,Hc=0;Hc<rc.length;Hc++)x(rc,rc[Hc],hc,qc)}for(rb=0;rb<qc.length;rb++)M(qc[rb],[ld]);for(rb=0;rb<hc.length;rb++)za.nt(hc[rb][0],hc[rb][1])}ia(a,b.id);for(var Sa=Q(a,b.id),Ea=0;Ea<Sa.length;Ea++){var sc=Sa[Ea];!wa&&sc.parent&&-1<Zb.indexOf(sc.parent.type)&&(sc.parent="");ea.Em(sc,!1);sc.d.jd=b.id}for(var Ic=0;Ic<Sa.length;Ic++){var tc=Sa[Ic];if("MESH"==tc.type){var Wc=S.get_first_armature_object(tc);if(Wc){var Bc=Wc.d;if(Bc.Jd){var Jc=tc.d.gc,Xc=[],Kc;for(Kc in Jc){var kd=
Jc[Kc];Xc.push(4*kd.mh,4*kd.An)}Bc.Ep.push(Xc)}Bc.Mj.push(tc.d)}}}for(var Yc=-1,cc=0;cc<Sa.length;cc++){var jc=Sa[cc],Tb=jc.d;if(za.uc(jc)&&Tb.Bh){var Lc=Tb.max_bones;Lc>Yc&&(Yc=Lc)}}for(cc=0;cc<Sa.length;cc++)if(jc=Sa[cc],Tb=jc.d,za.uc(jc)&&Tb.Bh){Tb.max_bones=Yc;var Cc=jc,Zc=Tb.max_bones,ed=bb.max_bones,Mc=Cc.d;Zc>2*ed?za.ea('B4W Error: too many bones for "'+Cc.name+'"'):Zc>ed?(W.warn('B4W Warning: too many bones for "'+Cc.name+'" / '+Zc+" bones (max "+ed+"). Blending between frames will be disabled."),
Mc.sh=!1):Mc.sh=!0;Mc.sh=Mc.sh&&!ib.Fo}for(var $c=0;$c<Sa.length;$c++){var ic=Sa[$c];if(za.uc(ic)){var pd=ic.lod_levels.length;if(pd)for(var dd=ic,Dc=0;Dc<pd;Dc++){var Nc=ic.lod_levels[Dc].object;if(!Nc){dd.d.kj=!0;dd.d.ce=ic.lod_levels[Dc].distance;break}Nc.d.nf=ic.d.nf;dd.d.ce=ic.lod_levels[Dc].distance;Nc.d.Fh=ic.lod_levels[Dc].distance;if(ic.lod_levels[Dc+1])Nc.d.ce=ic.lod_levels[Dc+1].distance;else{Nc.d.kj=!0;Nc.d.ce=1E4;break}dd.d.kj=!1;dd=Nc}}}for(var md=0;md<Sa.length;md++){var ha=Sa[md];
if(ha.b4w_vehicle){var Ta=ha.b4w_vehicle_settings;if("CHASSIS"==Ta.part){ha.f={};ha.f.Eo=Ta.force_max;ha.f.Bn=Ta.brake_max;ha.f.By=Ta.suspension_compression;ha.f.Dy=Ta.suspension_stiffness;ha.f.Cy=Ta.suspension_damping;ha.f.qz=Ta.wheel_friction;ha.f.vB=Ta.roll_influence;ha.f.Nw=Ta.max_suspension_travel_cm;ha.f.bg=0;ha.f.dh=1;ha.f.Bg=0;ha.f.speed=0;ha.f.Af=[];ha.f.Sh=[];ha.f.Cg=null;for(var qd=ha.Db?ha.Db.dupli_group.objects:Sa,Oc=0;Oc<qd.length;Oc++){var Ha=qd[Oc];if(Ha.b4w_vehicle){var Wa=Ha.b4w_vehicle_settings;
if(pa.vw(Ha)&&Ta.name==Wa.name){var rd=pa.rz(Ha.b4w_vehicle_settings.part);ha.f.Af[rd]=Ha;ha.f.Sh[rd]=new Float32Array(8)}else if(pa.tp(Ha)&&Ta.name==Wa.name){ha.f.Cg=Ha;ha.f.tm=Wa.steering_max;ha.f.Uq=Wa.steering_ratio;ha.f.op=Wa.inverse_control;var lb=ab.invert(ha.d.H,new Float32Array(16)),fd=ab.multiply(lb,Ha.d.H,lb);ha.f.Wq=fd;var Pc=new Float32Array([1,0,0,0]);Yb.transformMat4(Pc,fd,Pc);ha.f.Vq=Pc}else if(pa.sp(Ha)&&Ta.name==Wa.name){ha.f.qm=Ha;ha.f.Nq=Wa.speed_ratio;ha.f.Jl=Wa.max_speed_angle;
var lb=ab.invert(ha.d.H,new Float32Array(16)),gd=ab.multiply(lb,Ha.d.H,lb);ha.f.Pq=gd;var Qc=new Float32Array([1,0,0,0]);Yb.transformMat4(Qc,gd,Qc);ha.f.Oq=Qc}else if(pa.up(Ha)&&Ta.name==Wa.name){ha.f.wm=Ha;ha.f.no=Wa.delta_tach_angle;var lb=ab.invert(ha.d.H,new Float32Array(16)),hd=ab.multiply(lb,Ha.d.H,lb);ha.f.cr=hd;var Rc=new Float32Array([1,0,0,0]);Yb.transformMat4(Rc,hd,Rc);ha.f.br=Rc}}}if(4!=ha.f.Af.length)throw"Not enough wheels for chassis "+ha.name;}else if("HULL"==Ta.part){ha.f={};ha.f.Af=
[];ha.f.Sh=[];ha.f.Eo=Ta.force_max;ha.f.Bn=Ta.brake_max;ha.f.bl=Ta.floating_factor;ha.f.Jm=Ta.water_lin_damp;ha.f.Km=Ta.water_rot_damp;ha.f.bg=0;ha.f.dh=1;ha.f.Bg=0;ha.f.speed=0;ha.f.Cg=null;for(var sd=ha.Db?ha.Db.dupli_group.objects:Sa,Oc=0;Oc<sd.length;Oc++)Ha=sd[Oc],Ha.b4w_vehicle&&(Wa=Ha.b4w_vehicle_settings,pa.uw(Ha)&&Ta.name==Wa.name?(ha.f.Af.push(Ha),ha.f.Sh.push(new Float32Array(8))):pa.tp(Ha)&&Ta.name==Wa.name?(ha.f.Cg=Ha,ha.f.tm=Wa.steering_max,ha.f.Uq=Wa.steering_ratio,ha.f.op=Wa.inverse_control,
lb=ab.invert(ha.d.H,new Float32Array(16)),fd=ab.multiply(lb,Ha.d.H,lb),ha.f.Wq=fd,Pc=new Float32Array([1,0,0,0]),Yb.transformMat4(Pc,fd,Pc),ha.f.Vq=Pc):pa.sp(Ha)&&Ta.name==Wa.name?(ha.f.qm=Ha,ha.f.Nq=Wa.speed_ratio,ha.f.Jl=Wa.max_speed_angle,lb=ab.invert(ha.d.H,new Float32Array(16)),gd=ab.multiply(lb,Ha.d.H,lb),ha.f.Pq=gd,Qc=new Float32Array([1,0,0,0]),Yb.transformMat4(Qc,gd,Qc),ha.f.Oq=Qc):pa.up(Ha)&&Ta.name==Wa.name&&(ha.f.wm=Ha,ha.f.no=Wa.delta_tach_angle,lb=ab.invert(ha.d.H,new Float32Array(16)),
hd=ab.multiply(lb,Ha.d.H,lb),ha.f.cr=hd,Rc=new Float32Array([1,0,0,0]),Yb.transformMat4(Rc,hd,Rc),ha.f.br=Rc))}}}for(var nd=0;nd<Sa.length;nd++){var kc=Sa[nd];if(kc.b4w_floating){var id=kc.b4w_floating_settings;if("MAIN_BODY"==id.part){kc.sc={};kc.sc.bl=id.floating_factor;kc.sc.Jm=id.water_lin_damp;kc.sc.Km=id.water_rot_damp;kc.sc.Ci=[];for(var td=kc.Db?kc.Db.dupli_group.objects:Sa,od=0;od<td.length;od++){var ad=td[od];if(ad.b4w_floating){var ud=ad.b4w_floating_settings;pa.yw(ad)&&id.name==ud.name&&
(kc.sc.Ci.push(ad),ad.Ct=ad.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function e(a,b,c,d,e){!wa&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],W.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==ib.wa&&wa&&(ib.wa=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(wa&&!f.camera)throw"Scene check failed: No camera";for(var g=K.Jk(f,"MESH"),h=0;h<g.length;h++){var B=g[h],k=Da.ot(B);k&&(a.meshes.push(k),B.data=k)}for(var h=
Q(a,b.id),B=a.meshes,k=B.slice(0),m=0;m<h.length;m++){var l=h[m];"MESH"==l.type&&(l=k.indexOf(l.data),-1<l&&k.splice(l,1))}for(m=0;m<k.length;m++)B.splice(B.indexOf(k[m]),1);wa?(K.et(f,a.textures),f.d.Qg.length&&(b.sl=!0),Pa.enabled&&f.b4w_enable_physics&&pa.nn(f),f.b4w_enable_audio&&Y.on(f),h=K.ml(f),B=f.b4w_batch_grid_size):(K.kt(f,Ca,a.textures),Pa.enabled&&f.b4w_enable_physics&&!Ca.j&&pa.nn(Ca),f.b4w_enable_audio&&!Ca.g&&Y.on(Ca),h=K.ml(Ca),B=Ca.b4w_batch_grid_size);g=z.xv(h,B,g,f.world,Ca.d.Al);
wa?(K.fn(f,g),K.rv(h)):K.fn(Ca,g)}d=a.materials;if(Ea.Tk&&bb.nr)for(a=0;a<d.length;a++){f=d[a];B=f.texture_slots;for(g=0;g<B.length;g++)if(k=B[g],m=k.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)h=m.image,h.ec||(-1<h.filepath.indexOf(".dds")?h.ec=!0:(h.ec=!m.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=h.source,h.ec&&(h.filepath+=".dds")));if(g=f.node_tree)for(B=g.nodes,g=0;g<B.length;g++)h=B[g],"TEXTURE"==h.type&&((k=h.texture)?(h=k.image,
h.ec||(h.ec=k.d.ui&&!k.b4w_disable_compression&&"MOVIE"!=h.source,h.ec&&(h.filepath+=".dds"))):W.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.ec=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function r(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},B={},k=0;k<d.length;k++){var m=d[k];f[m.uuid]=m;h[m.uuid]=m}for(k=0;k<a.length;k++)m=a[k],g[m.uuid]=m,B[m.uuid]=m;v(a,null,B,h);for(var l in h)l in f||d.push(h[l]);
for(l in B)l in g||a.push(B[l]);e(b,c)}function v(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var q=za.Pe(l[g]);q.name+="_CLONE";h.constraints.push(q)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=za.Pe(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=
h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=za.nl(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=za.Pe(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,m(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=za.Pe(l),k.name=za.Wj(l.name+"_CLONE"),k.uuid=B.hp("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,v(k.objects,h.name,c,d));if(b)for(f=
0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(W.warn("B4W Warning: Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&
b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var p in e)Xa[p]=e[p]}function m(a){a.uuid=B.hp("Object"+a.name)}function t(a,b){for(var c=a.nodes,e=0;e<c.length;e++){var f=c[e];"MATERIAL"!=f.type&&"MATERIAL_EXT"!=f.type||!f.material||s(f,"material",b);"TEXTURE"==f.type&&f.texture&&s(f,"texture",b);"LAMP"==f.type&&f.lamp&&(f.lamp.uuid in Xa&&(f.lamp.uuid=Xa[f.lamp.uuid]),b[f.lamp.uuid]||(f.lamp=null));"GROUP"==f.type&&f.node_group&&s(f,"node_group",b)}f=a.links;for(e=0;e<f.length;e++){var g=
f[e];y(g,"from_node",c);y(g,"to_node",c);d(g,"from_socket",g.from_node.outputs);d(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&s(c,"action",b),c.nla_tracks)for(e=0;e<c.nla_tracks.length;e++)for(f=c.nla_tracks[e],g=0;g<f.strips.length;g++)f.strips[g].action&&s(f.strips[g],"action",b)}function s(a,b,c){(c=c[a[b].uuid])||W.error("Dangling link found:",b,a);a[b]=c}function y(a,b,c){c=za.keysearch("name",a[b].name,c);a[b]=c}function d(a,b,c){c=za.keysearch("identifier",a[b].identifier,
c);a[b]=c}function C(a,b,d,e,f,g){if(!bb.do_not_load_resources){for(var h=X(b.q),k=a.images,B={},m=[],l=0;l<k.length;l++){var q=k[l],p=q.uuid;if("FILE"===q.source||"MOVIE"===q.source){var r=A(q,a.textures);if(!r.length)W.warn("B4W Warning: image ",q.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=ca(h+q.filepath);if("FILE"===q.source){var t=q.ec?ba.AT_ARRAYBUFFER:ba.AT_IMAGE_ELEMENT;if(Ea.Kl&&bb.bk){var ea=ba.Oj(r);"dds"==ea[1]?(r=ba.Oj(ea[0]),r=r[0]+".min50."+r[1]+".dds"):r=ea[0]+".min50."+
ea[1]}}else"MOVIE"===q.source&&(ea=ba.Oj(r),t=Y.detect_video_container(ea[1]),""!=t&&(r=ea[0]+"."+t),t=ba.gk);m.push([p,t,r,q.name]);B[p]=q}}}m.length?(e.ip=0,ba.enqueue(m,function(f,h,k,l){if(f){if(k==ba.gk){k=f.videoWidth;var q=f.videoHeight;W.log("%cLOAD VIDEO "+k+"x"+q,"color: #"+(2048<k||2048<q?"a00":1024<k||1024<q?"aa0":"0a0"),l);-1==l.indexOf(sb)&&W.warn("B4W Warning: video",l,"is not from app root.")}else c(f,l,!0);h=B[h];l=A(h,a.textures);for(k=0;k<l.length;k++)q=l[k],Na.$j(q.d,f,h.ec,q.image.filepath)}f=
++e.ip/m.length;g(b,d,f)},function(){W.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function A(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function u(a,b,c,d,e,f){if(!bb.do_not_load_resources){a=Q(a,b.id);for(var g=X(b.q),h=[],k={},B=0;B<a.length;B++){var m=a[B];if(w(m)){var l=m.data.sound,q=l.uuid;"BACKGROUND_MUSIC"==Y.ol(m)?(q=za.qv(),b.rl=!0):"NONE"!=Y.ol(m)&&bb.lp&&(b.ul=!0);if(!(q in k)){k[q]=[];l=ca(g+l.filepath);switch(Y.Lq(m)){case Y.fk:var p=
ba.AT_AUDIOBUFFER;break;case Y.Nm:p=ba.AT_AUDIO_ELEMENT}var l=ba.Oj(l),r=Y.detect_audio_container(l[1]);if(r!=l[1]){if(J.pp()){aa.lm(b,"load_speakers");return}l=l[0]+".lossconv."+r}else l=l[0]+"."+r;h.push([q,p,l])}k[q].push(m)}}h.length?ba.enqueue(h,function(a,e,g,B){if(a)for(W.log("%cLOAD SOUND","color: #0aa",B),-1==B.indexOf(sb)&&W.warn("B4W Warning: sound",B,"is not from app root."),e=k[e],g=0;g<e.length;g++)Y.Zy(e[g],a);a=++d.iy/h.length;f(b,c,a)},function(){W.log("%cLOADED ALL SOUNDS","color: #0aa");
e(b,c)}):e(b,c)}}function w(a){return Y.be(a)&&Y.Lq(a)!=Y.Om?!0:!1}function p(a,b){for(var c=K.na(a,"SPEAKER",K.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];Y.be(e)&&(Y.is_cyclic(e)||b)&&Y.play_def(e)}}function I(a){a=a.d.Qg;for(var b=0;b<a.length;b++)a[b].d.Sa&&a[b].use_auto_refresh&&a[b].d.Sa.play()}function H(a,b,c,d,e){ta.start();W.log("%cSTART NLA","color: #0a0");e(b,c)}function x(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=
g.object;if(h){var k=za.gh(h);k.name=b.name+"_LOD_"+String(f+1);m(k);k.lod_levels=[];c.push([a,k]);d.push(h);g.object=k}}}function M(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function q(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=wa?f.b4w_enable_physics:Ca.b4w_enable_physics||f.b4w_enable_physics;wa||(f=Ca);for(var h=0;h<$a.length;h++)for(var k=
K.na(f,$a[h],K.DATA_ID_ALL),B=0;B<k.length;B++){var m=k[B];m.d.jd==b.id&&Pa.enabled&&g&&(pa.append_object(m,f),b.Bp&&pa.has_physics(m)&&pa.disable_simulation(m))}}e(b,c)}function G(a,b,d,e,f){var g={};e=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var B=h[k];if(B.d.Ba&&(B=B.d.Ba.Lj)&&"FILE"===B.source){var m=B.uuid,l=ca(X(b.q)+B.filepath);e.push([m,B.ec?ba.AT_ARRAYBUFFER:ba.AT_IMAGE_ELEMENT,l,B.name]);g[m]=B}}e.length?ba.enqueue(e,function(b,d,e,f){if(b){c(b,f,!0);d=g[d];f=A(d,a.textures);for(e=
0;e<f.length;e++){var k=f[e];Na.$j(k.d,b,d.ec,k.image.filepath)}for(e=0;e<h.length;e++)if(f=h[e],f.d.Ba.Lj===d){var B=b,m=d,l=document.createElement("canvas"),k=m.size[0],m=m.size[1];l.width=k;l.height=m;l=l.getContext("2d");l.drawImage(B,0,0);B=l.getImageData(0,0,k,m).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var k=k*m,m=new Float32Array(k),q=0;q<k;q++)m[q]=l[1]*B[4*q+2]+l[2]*B[4*q+3];f.d.im=m}}},function(){f(b,d)}):f(b,d)}function D(a,b,d,e,f){if(bb.antialiasing&&
bb.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var k=K.ia(e,g[h]);k&&a.push(k)}if(a.length){e=[];h=ba.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,J.zb.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",h,J.zb.smaa_area_texture_path,"smaa_area_texture"]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.Z;for(h=0;h<a.length;h++)if(g=a[h],
"u_search_tex"==g.V)var B=g.pa;else if("u_area_tex"==g.V)var m=g.pa;break}e.length?ba.enqueue(e,function(a,b,d,e){a&&(c(a,e,!1),b="SEARCH_TEXTURE"==b?B:m,b.source="IMAGE",b.sn=!0,Na.$j(b,a,-1!=e.indexOf(".dds")?1:0,e),Na.Jj(b,Na.s,Na.s))},function(){f(b,d)}):f(b,d)}else f(b,d)}else f(b,d)}function V(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];wa||(e=Ca);for(var f=K.na(e,"ALL",K.DATA_ID_ALL),g=0;g<f.length;g++){var h=f[g];h.d.jd==b.id&&(b.Bp&&K.hide_object(h),d.gn.push({Dx:e,obj:h}))}}}
function O(a,b,c,d,e,f){a=d.gn;var g=d.Np;a.length?(e=a[g].obj,g=a[g].Dx,K.append_object(g,e),-1!=tb.indexOf(e.type)&&g.b4w_enable_audio&&Y.append_object(e,g),d=++d.Np/a.length):d=1;f(b,c,d)}function U(a,b,c,d,e){if(wa){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];K.gy(f);K.hx(f);f.b4w_use_nla&&ta.Xy(f,f.b4w_nla_cyclic)}K.set_active(a.scenes[0])}else K.mr(Ca);a=Q(a,b.id);ea.Wy(a);e(b,c)}function T(a,b,c,d,e){if(wa)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||I(a.scenes[d]),p(a.scenes[d]);
else a.scenes[0].b4w_use_nla||I(Ca),p(Ca);e(b,c)}function L(a,b,c,d,e){bb.ef&&(b.sl||b.rl||b.ul)?xa||P(a,e,b,c):e(b,c)}function P(a,b,c,d){var e=ya.canvas.parentElement;Ja=e.style.zIndex;e.style.zIndex="999";xa=document.createElement("div");xa.style.position="relative";xa.style.height="88px";xa.style.width="88px";var f=Math.round(ya.canvas.offsetWidth/2-44);xa.style.top=Math.round(ya.canvas.offsetHeight/2-44).toString()+"px";xa.style.left=f.toString()+"px";xa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
sa=document.createElement("div");sa.style.position="relative";sa.style.height=ya.canvas.offsetHeight.toString()+"px";sa.style.width=ya.canvas.offsetWidth.toString()+"px";sa.style.background="rgba(0, 0, 0, 0.5)";sa.style.zIndex="999";e.appendChild(sa);sa.appendChild(xa);xa.addEventListener("click",function(){c.sl&&(Na.play(),Na.pause());if(c.rl){if(wa)for(var e=0;e<a.scenes.length;e++)p(a.scenes[e],!0);else p(Ca,!0);Y.pause()}c.ul&&Y.dx();R();b(c,d)},!1)}function R(){if(xa){var a=ya.canvas.parentElement;
a.style.zIndex=Ja;sa.removeChild(xa);a.removeChild(sa);xa=sa=null;Ja=0}}function X(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function N(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function ca(a){var b=a.split("://",2);
return 1<b.length?(b[1]=N(b[1]),b.join("://")):N(a)}function Q(a,b){Za[b]||ia(a,b);return Za[b]}function ia(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)F(c[e].objects,0,d);Za[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)Za[b].push(g[h])}function F(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=ga(f);d[g]=d[g]||[];(wa||-1==Zb.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&F(f.objects,b+1,c)}}function ga(a){return(a=
a.parent||S.get_first_armature_object(a))?1+ga(a):0}var S=n("__animation"),z=n("__batch"),J=n("__config"),ja=n("__controls"),na=n("__dds"),fa=n("__extensions");n("__lights");var aa=n("__loader"),ba=n("__assets"),B=n("__md5"),ea=n("__objects"),pa=n("__physics"),W=n("__print"),Da=n("__reformer"),ma=n("__renderer"),K=n("__scenes"),ta=n("__nla"),Y=n("__sfx"),Ra=n("__shaders"),Na=n("__textures"),Ia=n("__nodemat"),za=n("__util"),Yb=n("vec4"),ab=n("mat4"),bb=J.n,Ea=J.Md,Pa=J.gb,ib=J.Ld,Jb=J.Bd,cb=null,Za=
null,sb="",wa=!1,Ca=null,Xa={},xa=null,sa=null,Ja=0,Zb=["LAMP","CAMERA"],$a=["MESH","CAMERA","EMPTY"],tb=["SPEAKER"],ya=null;a.is_primary_loaded=function(a){return aa.is_primary_loaded(a)};a.update=function(){aa.Yy(cb)};a.Xb=function(a){ya=a};a.Vy=function(a,b){if(xa){sa.style.height=b.toString()+"px";sa.style.width=a.toString()+"px";var c=Math.round(a/2-44);xa.style.top=Math.round(b/2-44).toString()+"px";xa.style.left=c.toString()+"px"}};a.load=function(a,c,d,h,B){var m={load_main:{Fa:aa.Be,Ta:!1,
C:[],Ua:!1,ib:500,rb:!1,Ja:g},duplicate_objects:{Fa:aa.Bc,Ta:!1,C:["load_main"],Ua:!1,ib:50,rb:!1,Ja:r},load_binaries:{Fa:aa.Be,Ta:!1,C:["load_main"],Ua:!1,ib:500,rb:!1,Ja:f},prepare_bindata:{Fa:aa.Bc,Ta:!1,C:["duplicate_objects","load_binaries"],Ua:!1,ib:0,rb:!1,Ja:l},prepare_root_datablocks:{Fa:aa.Bc,Ta:!1,C:["duplicate_objects","prepare_bindata"],Ua:!1,ib:150,rb:!1,Ja:k},prepare_root_scenes:{Fa:aa.Bc,Ta:!1,C:["prepare_root_datablocks"],Ua:!1,ib:350,rb:!1,Ja:e},load_smaa_textures:{Fa:aa.Be,Ta:!0,
C:["prepare_root_scenes"],Ua:!1,ib:10,rb:!0,Ja:D},load_shoremap:{Fa:aa.Be,Ta:!0,C:["prepare_root_scenes"],Ua:!1,ib:10,rb:!0,Ja:G},load_textures:{Fa:aa.Be,Ta:!0,C:["prepare_root_scenes"],Ua:!0,ib:500,rb:!1,Ja:C,Oe:{ip:0}},add_physics_objects:{Fa:aa.Bc,Ta:!1,C:["load_shoremap"],Ua:!1,ib:20,rb:!1,Ja:q},add_objects:{Fa:aa.Bc,Ta:!1,C:["add_physics_objects"],Ua:!1,ib:800,rb:!1,Ja:V,Rf:O,fh:U,Oe:{gn:[],Np:0}},load_speakers:{Fa:aa.Be,Ta:!0,C:["add_objects"],Ua:!0,ib:30,rb:!1,Ja:u,Oe:{iy:0}},mobile_media_start:{Fa:aa.Bc,
Ta:!bb.ef,C:["load_textures","load_speakers"],Ua:!0,ib:5,rb:!1,Ja:L,Rf:L},synchronize_media:{Fa:aa.Bc,Ta:!0,C:["mobile_media_start"],Ua:!0,ib:70,rb:!1,Ja:T},start_nla:{Fa:aa.Bc,Ta:!0,C:["mobile_media_start"],Ua:!1,ib:5,rb:!1,Ja:H}},p=aa.Uo();p||(p=aa.uu(),cb=[],Za=[],Xa={});cb[p.Uc.length]={};return aa.Du(m,a,c,d,b,h||Jb.qn,bb.do_not_load_resources,B)};a.unload=function(a){var b=aa.Uo();if(!b||!b.Uc.length||a&&!aa.Fy(b.Uc[a]))W.error("Unable to unload data!");else{if(0==a)W.log("%cUNLOAD ALL","color: #00a"),
S.cleanup(),Y.cleanup(),ta.cleanup(),K.cleanup(),aa.cleanup(),pa.cleanup(),ea.cleanup(),za.cleanup(),ma.cleanup(),Ia.cleanup(),Ra.cleanup(),ja.cleanup(),fa.cleanup(),ba.cleanup(),Na.cleanup(),Za=null,Xa={},wa=!1,cb=Ca=null;else{W.log("%cUNLOAD DATA "+a,"color: #00a");S.rx(a);for(var b=K.Ui(),c=0;c<b.length;c++)for(var d=b[c],e=K.na(d,"ALL",K.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.jd==a){var h=d,k=g;S.is_animated(k)&&S.remove(k);K.clear_glow_anim(k);pa.has_physics(k)&&(pa.disable_simulation(k),
pa.sx(k));ja.check_sensor_manifold(k)&&ja.remove_sensor_manifold(k);K.tx(h,k);Y.be(k)&&Y.jy(k);e.splice(f,1);h=K.na(d,g.type,K.DATA_ID_ALL);g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}R()}};a.set_debug_resources_root=function(a){sb=a}};b4w.module.__batch=function(a,n){function b(a){a={type:a,id:0,am:0,uf:"",S:[],ac:[],vc:[],Pl:[],fd:[],Gf:null,Ra:{},Yb:null,Xa:null,pn:[],Lc:null,bb:null,gc:null,wb:null,ko:!1,num_vertices:0,num_triangles:0,hj:0,ij:0,gg:0,Zi:0,pl:0,Ib:new Float32Array(3),Vn:new Float32Array(3),Gc:new Float32Array(16),sa:!1,Wn:!1,N:!1,oc:!1,ma:!1,ck:!1,md:!1,Mb:!1,Nb:!1,sb:!1,Wb:!1,Lb:!1,wc:!1,ya:!1,mq:!1,ld:P.Vg,Gd:P.ad,Ig:0,ym:new Float32Array(2),p:new Float32Array(2),Zo:!1,cp:0,$o:0,dp:0,ep:0,bp:new Float32Array(3),
ap:new Float32Array(3),af:!1,Dc:0,Ud:0,Se:1,Uh:0,Mq:0,Nj:1,Mh:0,Re:0,Fe:1,Kp:0,Ll:0,vf:0,qq:0,kd:Array(2),sf:Array(4),Pd:new Float32Array(2),nc:new Float32Array(3),Sc:new Float32Array(3),Cd:new Float32Array(3),ob:new Float32Array(4),pd:new Float32Array(4),jg:null,zl:null,xl:null,wl:null,yl:null,xe:!1,water_dynamic:!1,Lm:!1,vr:!1,wr:0,xr:0,ur:0,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Do:new Float32Array(2),Co:new Float32Array(2),cl:new Float32Array(2),shallow_water_col:new Float32Array(3),
shore_water_col:new Float32Array(3),rf:null,$l:!1,Xp:0,Tp:0,Tl:0,Wp:0,Zp:0,Yp:0,Up:0,Vp:0,Ul:0,Qp:0,Pp:0,aq:0,Sp:0,wj:new Float32Array(3),$p:new Float32Array(8),Rp:new Float32Array(16)};a.ob[3]=1;a.Wn=!0;a.N=!0;a.Ig=1;return a}function c(a,b,c){for(var d=[],e=0;e<a.length;e++){var g=a[e],h=g.d,k=l(g.data.b4w_bounding_box),m=g.data.b4w_bounding_cylinder_radius,q=g.data.b4w_bounding_sphere_radius,p=g.data.b4w_bounding_sphere_center,r=g.data.b4w_bounding_ellipsoid_axes,t=g.data.b4w_bounding_ellipsoid_center;
if(h.dd){var q=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),m=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),v=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),v=Math.sqrt(q*q+m*m+v*v),q=Math.sqrt(q*q+m*m);k.max_x=k.max_y=k.max_z=v;k.min_x=k.min_y=k.min_z=-v;m=q;q=v;p[0]=p[1]=p[2]=0;r[0]=r[1]=r[2]=v;t[0]=t[1]=t[2]=0}h.Eb=k;v=O.yk(k,h.H);h.Ia=v;var v=h,s=m;v.wk=O.bo(s,k);v.uk=O.$n(m,k);v.vk=O.ao(s,k);p=O.Nk(q,p);h.tc=p;p=O.Ak(p,h.H);h.kb=p;r=O.Mk([r[0],0,0],[0,r[1],0],[0,0,r[2]],t);h.Le=r;r=O.zk(r,h.Vc);
h.Me=r;d=d.concat(f(g,h,b,c))}return d}function g(a,b,c,d){for(var e=[],g=[],h={},k=0;k<a.length;k++){var m=a[k],q=m.d,p=l(m.data.b4w_bounding_box),r=O.yk(p,q.H),t=O.Nk(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),v=O.Ak(t,q.H),s=m.data.b4w_bounding_ellipsoid_axes,s=O.Mk([s[0],0,0],[0,s[1],0],[0,0,s[2]],m.data.b4w_bounding_ellipsoid_center),z=O.zk(s,q.Vc);q.Eb=p;q.Ia=r;q.tc=t;q.kb=v;q.Le=s;q.Me=z;p={};p.Mb=q.Mb;p.Nb=q.Nb;p.sb=q.sb;p.Mc=q.Mc;p.vj=q.vj;p.Xi=q.Xi;p.Wb=q.Wb;p.Lb=
q.Lb;p.wc=q.wc;p.Ne=q.Ne;p.Xc=q.Xc;p.ud=q.ud;p.yb=q.yb;p.dd=q.dd;p.bh=q.bh;p.ya=q.ya;p.Xf=q.Xf;p.Pi=q.Pi;p.md=q.md;r=q.kb.t;p.jw=0==c?[0,0]:[Math.floor(r[0]/c),Math.floor(r[2]/c)];p.ce=q.ce;p.Fh=q.Fh;p.nf=q.nf;q=JSON.stringify(p);h[q]=h[q]||[];h[q].push(m)}for(var n in h){p=JSON.parse(n);c=h[n];var m=N.Mi("STATIC"),w;for(w in p)m[w]=p[w];m.jd=a[0].d.jd;m.Yc=0;m.Ae=0;m.Rd=0;m.Qd=0;m.Nd=0;m.xh=!1;for(k=0;k<c.length;k++)q=c[k],0==k?(m.Ia=J.ta(q.d.Ia),m.kb=J.ta(q.d.kb),m.Le=J.ta(q.d.Le),m.Me=J.ta(q.d.Me)):
(O.uo(m.Ia,q.d.Ia),O.Zu(m.kb,q.d.kb));m.Eb=J.ta(m.Ia);m.tc=J.ta(m.kb);g.push({Gb:m,wd:c})}for(a=0;a<g.length;a++)for(h=g[a].Gb,k=g[a].wd,n=0;n<k.length;n++){w=k[n];c=f(w,h,b,d);m=H(w.d)||H(h);q={};h.Xc&&(q.au_center_pos=[m[0],m[1],m[2]],q.au_wind_bending_amp=[w.d.Yc],q.au_wind_bending_freq=[w.b4w_wind_bending_freq],q.au_detail_bending_amp=[w.b4w_detail_bending_amp],q.au_detail_bending_freq=[w.b4w_detail_bending_freq],q.au_branch_bending_amp=[w.b4w_branch_bending_amp]);for(p=0;p<c.length;p++)v=c[p].Gb,
r=c[p].$b,t=c[p].k,v.fj?v.dd?P.vy(r,m):P.Yq(r,m):("COLOR_ID"==t.type?(v=c[p].Gb=w.d,v.type="DYNAMIC",t.uf=w.uuid,A(t,v),x(t,J.eh(v,0))):r=P.Yq(r,m),P.uy(r,q));e=e.concat(c)}return e}function f(a,c,d,e){var f=[];if(a.b4w_do_not_render)return f;for(var g=h(d,c),m=J.eh(c,0),l=a.data,q=l.materials,p=0;p<g.length;p++)for(var r=g[p],t=0;t<q.length;t++){var v=q[t];if(("LENS_FLARES"!=v.name||0!=e)&&!P.fp(l,t)){var s=b(r);if(k(s,v,!0)){s.ld=l.ld||P.Vg;"COLOR_ID"===r&&s.Vn.set(a.Zm);A(s,c);for(var z=s,n=a.particle_systems,
u=0;u<n.length;u++){var y=n[u].settings.b4w_vcol_from_name,ba=n[u].settings.b4w_vcol_to_name;""!==y&&""!==ba&&(z.Ra[y]={Ye:!1,src:[{name:y,kc:7}]})}"DYNAMIC"==c.type&&(s.uf=a.uuid);x(s,m);z=P.Ao(l,t,s.fd,s.gc,s.Ra,s.Gf);"LENS_FLARES"==v.name&&(z=ca.gx(z));f.push({k:s,$b:z,Sb:[v.name],Gb:c,xc:[a]})}}}g=a.particle_systems;if(0<g.length&&f.length){e=!0;for(p=0;p<g.length;p++)if(g[p].settings.use_render_emitter){e=!1;break}p=f[0].k;g=f[0].$b;l=[];q=a.particle_systems;r=a.data;for(t=0;t<q.length;t++)if(v=
q[t],s=v.settings,s.count)if("EMITTER"==s.type){if("DYNAMIC"==c.type){z=b("PARTICLES");n=r.materials;u=v.settings.material-1;u>=n.length&&(T.warn('B4W Warning: Wrong material used for rendering particle system "'+v.name+'"'),u=0);n=n[u];"HALO"===v.settings.render_type&&(z.af=!0);k(z,n);A(z,c);u=z;switch(v.settings.b4w_billboard_align){case "VIEW":w(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":w(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":w(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");
break;case "ZX":w(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}w(u,"BILLBOARD",0);z.md=!0;z.uf=a.name+"_"+s.uuid;x(z,m);z.Lc=v;s=ca.uv(z,r,v,a.d.Vc);ca.Mx(z,v,n);l.push({k:z,$b:s,Sb:[n.name],Gb:c,xc:[a]})}}else if("HAIR"==s.type){z=J.cj(v.seed);s.b4w_dynamic_grass&&(c.Xf=!0);if(v.transforms.length)var S=v.transforms;else for(var n=P.jl(g,s.count,!1,z),S=new Float32Array(4*n.length),D=0;D<n.length;D++)u=.75+.5*J.lc(z),S[4*D]=n[D][0],S[4*D+1]=n[D][1],S[4*
D+2]=n[D][2],S[4*D+3]=u;n=F.Ma(d,"GRASS_MAP")?!0:!1;if("OBJECT"==s.render_type)u=[h(d,s.dupli_object.d)],v=I(a,c,p,g,[s.dupli_object],u,[S],s,v,n,z,!1),l=l.concat(v);else if("GROUP"==s.render_type){y=s.dupli_group.objects;ba=!1;u=[];for(D=0;D<y.length;D++){var G=h(d,s.dupli_group.objects[D].d);u.push(G)}if(s.use_whole_group){ba=S;S=y;D={};for(G=0;G<ba.length;G+=4)for(var aa=0;aa<S.length;aa++){var fa=ja.create();ja.scale(S[aa].d.e,S[aa].d.scale,fa);var C=ja.clone([ba[G],ba[G+1],ba[G+2]]);ja.add(C,
fa,C);D[aa]||(D[aa]=new Float32Array(ba.length));D[aa][G]=C[0];D[aa][G+1]=C[1];D[aa][G+2]=C[2];D[aa][G+3]=ba[G+3]}S=D;ba=!0}else if(s.use_group_count){for(var C=y,H=s.dupli_weights,D=z,G={},aa=[],fa=0;fa<C.length;fa++)for(var O=C[fa],O=O.origin_name||O.name,V=0;V<H.length;V++){var L=H[V];O==L.name.split(": ")[0]&&aa.push(L)}H.length!=aa.length&&T.error("B4W Error: dupli weights match failed");for(fa=0;fa<S.length;fa+=4){var U,H=aa;U=[0];for(C=0;C<H.length;C++)U[C+1]=U[C]+H[C].count;H=U[U.length-1]*
J.lc(D);for(C=O=0;C<U.length;C++)if(H>=U[C]&&H<U[C+1]){O=C;break}U=O;G[U]=G[U]||[];G[U].push(S[fa],S[fa+1],S[fa+2],S[fa+3])}for(U in G)G[U]=new Float32Array(G[U]);S=G}else{D=z;G=y.length;aa={};for(fa=0;fa<S.length;fa+=4){var M=Math.floor(G*J.lc(D));aa[M]=aa[M]||[];aa[M].push(S[fa],S[fa+1],S[fa+2],S[fa+3])}for(M in aa)aa[M]=new Float32Array(aa[M]);S=aa}v=I(a,c,p,g,y,u,S,s,v,n,z,ba);l=l.concat(v)}"INSTANCE"==s.b4w_wind_bend_inheritance&&(a.d.Yc=0)}else throw"Unknown particle settings type";a=l;f=e?
a:f.concat(a)}return f}function l(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function h(a,b){var c=["MAIN","NODES"];b.Mc&&(F.Ma(a,"COLOR_PICKING")||F.Ma(a,"GLOW_MASK"))&&c.push("COLOR_ID");F.Ma(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(F.Ma(a,"DEPTH")||F.Ma(a,"SHADOW_CAST"))&&c.push("DEPTH");F.Ma(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Nb||b.Lb){var d=null;b.Nb&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Lb)var e=["COLOR_ID",
"PHYSICS","DEPTH","WIREFRAME"],d=null!==d?J.rt(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function k(a,b,c){var f,g;switch(a.type){case "MAIN":if(b.b4w_collision||b.use_nodes)a=!1;else{for(var h=0;4>h;h++)a.sf[h]=new Float32Array([0,0]);r(a,b);h=b.game_settings.alpha_blend;a.oc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.vf=b.offset_z;a.Sc.set([1,1,1]);var k=b.texture_slots;na.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);
switch(b.name){case "LENS_FLARES":q(a,"special_lens_flares.glslv","special_lens_flares.glslf");u(a,"a_position");u(a,"a_texcoord");var l=c?[1,1,1,0]:null,l=v(k[0],l);G(a,l);break;default:q(a,"main.glslv","main.glslf");var p=m("use_map_color_diffuse",k),z=m("use_map_color_spec",k),n=m("use_map_normal",k),ba=m("use_map_mirror",k),J=m("use_stencil",k),h=p[0],z=z[0],n=n[0],ba=ba[0],p=p[1],k=J[0]&&m("use_rgb_to_intensity",k)[0];if(h){switch(h.blend_type){case "MIX":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");
break;case "MULTIPLY":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l="IMAGE"==h.texture.d.source&&c?[a.ob[0],a.ob[1],a.ob[2],1]:"ENVIRONMENT_MAP"==h.texture.d.source&&c?[.8,.8,.8,1]:null;l=v(h,l);G(a,l,"u_colormap0");a.Re=h.diffuse_color_factor;a.Fe=h.use_map_alpha?h.alpha_factor:0;a.Pd.set(h.texture.b4w_uv_velocity_trans);a.Sc.set(h.scale)}J=h&&h==z;z&&(J||(l=c?[.5,.5,.5,1]:null,l=v(z,l),G(a,l,"u_specmap0")),a.Mq=z.specular_color_factor);if(n){u(a,"a_normal");u(a,"a_tangent");l=c?[.5,
.5,1,1]:null;l=v(n,l);G(a,l,"u_normalmap0");a.Kp=n.normal_factor;var S=n.texture;a.sf[0].set(S.b4w_uv_velocity_trans);if(S.b4w_use_map_parallax&&aa.Lh){var l=ga.u(S.b4w_parallax_steps),D=ga.u(S.b4w_parallax_lod_dist);w(a,"PARALLAX",1);w(a,"PARALLAX_STEPS",l);w(a,"PARALLAX_LOD_DIST",D);a.Mh=S.b4w_parallax_scale}}ba&&(l=c?[0,0,.5,1]:null,l=v(ba,l),G(a,l,"u_mirrormap"),a.Ll=ba.mirror_factor);if(S=h&&p&&k?1:0)l=c?[.8,.8,.8,1]:null,l=v(p,l),G(a,l,"u_colormap1"),l=c?[.5,.5,.5,1]:null,l=v(k,l),G(a,l,"u_stencil0");
(c=h||z||n)&&a.Sc.set(c.scale);w(a,"TEXTURE_SPEC",void 0==z?0:1);w(a,"TEXTURE_MIRROR",void 0==ba?0:1);w(a,"ALPHA_AS_SPEC",J?1:0);w(a,"TEXTURE_STENCIL_ALPHA_MASK",S);u(a,"a_position");u(a,"a_normal");(h||z||n)&&u(a,"a_texcoord");if(b.b4w_water){a.xe=!0;a.Lm=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;q(a,"special_water.glslv","special_water.glslf");u(a,"a_position");u(a,"a_texcoord");u(a,"a_normal");u(a,"a_tangent");aa.ek?(u(a,"a_polyindex"),a.N=!0,a.wireframe_edge_color=
[0,0,0],w(a,"DEBUG_WIREFRAME",1)):w(a,"DEBUG_WIREFRAME",0);J=m("use_map_normal",c);ba=m("use_map_mirror",c)[0];J.length&&(S=v(J[0]),G(a,S,"u_normalmap0"));w(a,"NUM_NORMALMAPS",J.length);a.rf=Array(J.length);for(S=0;S<J.length;S++)a.sf[S].set(J[S].texture.b4w_uv_velocity_trans),a.rf[S]=new Float32Array(2),a.rf[S].set([J[S].scale[0],J[S].scale[1]]);ba?(w(a,"TEXTURE_MIRROR",1),J=v(ba),G(a,J,"u_mirrormap"),a.Ll=ba.mirror_factor):w(a,"TEXTURE_MIRROR",0);ba=null;for(S=0;S<c.length;S++)if(f=c[S],!0===f.texture.b4w_water_foam){ba=
f;break}ba&&aa.cg?(w(a,"FOAM",1),J=v(ba),G(a,J,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Do.set(ba.texture.b4w_foam_uv_freq),a.Co.set(ba.texture.b4w_foam_uv_magnitude),a.cl[0]=ba.scale[0],a.cl[1]=ba.scale[1]):w(a,"FOAM",0);for(S=0;S<c.length;S++)if(f=c[S],!0===f.texture.b4w_shore_dist_map){g=f;break}g&&aa.nk?(g=v(g),G(a,g,"u_shore_dist_map"),w(a,"SHORE_PARAMS",1),g=f.texture.b4w_shore_boundings,w(a,"MAX_SHORE_DIST",ga.u(f.texture.b4w_max_shore_dist)),w(a,"SHORE_MAP_SIZE_X",ga.u(g[0]-g[1])),w(a,
"SHORE_MAP_SIZE_Y",ga.u(g[2]-g[3])),w(a,"SHORE_MAP_CENTER_X",ga.u((g[0]+g[1])/2)),w(a,"SHORE_MAP_CENTER_Y",ga.u((g[2]+g[3])/2))):w(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&aa.deferred_rendering?(w(a,"GENERATED_MESH",1),a.vr=!0,a.wr=b.b4w_water_num_cascads,a.xr=b.b4w_water_subdivs,a.ur=b.b4w_water_detailed_dist):w(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){f=ga.u(b.b4w_water_dst_noise_scale0);g=ga.u(b.b4w_water_dst_noise_scale1);c=ga.u(b.b4w_water_dst_noise_freq0);var ba=ga.u(b.b4w_water_dst_noise_freq1),
J=ga.u(b.b4w_water_dir_min_shore_fac),S=ga.u(b.b4w_water_dir_freq),l=ga.u(b.b4w_water_dir_noise_scale),D=ga.u(b.b4w_water_dir_noise_freq),x=ga.u(b.b4w_water_dir_min_noise_fac),fa=ga.u(b.b4w_water_dst_min_fac),A=ga.u(b.b4w_water_waves_hor_fac);w(a,"DST_NOISE_SCALE_0",f);w(a,"DST_NOISE_SCALE_1",g);w(a,"DST_NOISE_FREQ_0",c);w(a,"DST_NOISE_FREQ_1",ba);w(a,"DIR_MIN_SHR_FAC",J);w(a,"DIR_FREQ",S);w(a,"DIR_NOISE_SCALE",l);w(a,"DIR_NOISE_FREQ",D);w(a,"DIR_MIN_NOISE_FAC",x);w(a,"DST_MIN_FAC",fa);w(a,"WAVES_HOR_FAC",
A)}s(a,b);y(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;w(a,"ABSORB",ga.u(b.b4w_water_absorb_factor));w(a,"SSS_STRENGTH",ga.u(b.b4w_water_sss_strength));w(a,"SSS_WIDTH",ga.u(b.b4w_water_sss_width));f=a.Xa;g=a.fd;a.Xa=f;a.fd=g}"HALO"===b.type&&(f=b.halo,q(a,"halo.glslv","halo.glslf"),w(a,"NUM_RINGS",f.ring_count),w(a,"NUM_LINES",f.line_count),w(a,
"NUM_STARS",f.star_tip_count),w(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.fd=["a_position"],a.cp=f.size,a.$o=f.hardness/20,a.bp.set(f.b4w_halo_rings_color),a.ap.set(f.b4w_halo_lines_color),a.dp=1/b.b4w_halo_stars_blend_height,a.ep=b.b4w_halo_stars_min_height,a.Zo=!0);w(a,"TEXCOORD",0);w(a,"NORMAL_TEXCOORD",0);h&&e(a,h,"TEXTURE_COLOR0_CO");p&&e(a,p,"TEXTURE_COLOR1_CO");k&&e(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");z&&e(a,z,"TEXTURE_SPEC_CO");n&&e(a,n,"TEXTURE_NORM_CO");w(a,"SHADELESS",b.use_shadeless?
1:0);a.ck=b.use_shadeless}h=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===h?0:1);w(a,"ALPHA_CLIP","CLIP"===h?1:0);w(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(w(a,"VERTEX_COLOR",1),u(a,"a_color")):w(a,"VERTEX_COLOR",0);a.Dc=b.ambient;a.Se=b.diffuse_intensity;a.Ud=b.emit;a.Cd.set(b.specular_color);a.Nj=b.specular_alpha;s(a,b);y(a,b);b.b4w_wettable?w(a,"WETTABLE",1):w(a,"WETTABLE",0);t(a,b);aa.$e?w(a,"UNROLL_LOOPS",1):w(a,"UNROLL_LOOPS",0);a.$l=b.b4w_refractive;
a.qq=b.b4w_refr_bump;a=!0}break;case "NODES":a=d(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(r(a,b),a.sa)a=!1;else{q(a,"depth.glslv","depth.glslf");u(a,"a_position");u(a,"a_normal");h=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===h?0:1);a.Sc.set([1,1,1]);if((b=m("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Sc.set(b.scale);w(a,"TEXTURE_COLOR",1);u(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==
b.texture.d.source)h=v(b),G(a,h,"u_colormap0"),a.Pd.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(h=v(b),G(a,h,"u_colormap0"),a.Pd.set(b.texture.b4w_uv_velocity_trans))}else w(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.dz=b.b4w_use_ghost,a.Pb=b.b4w_collision_id,a.Tn=b.b4w_collision_group,a.Un=b.b4w_collision_mask,a.th=b.physics.friction,a.nh=b.physics.elasticity,a=!0):b.b4w_water?(a.xe=!0,a.nz=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,
a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||
b.b4w_collision||"HALO"===b.type)a=!1;else{r(a,b);a.Gd=P.ad;a.N=!0;a.sa=!1;h=b.game_settings.alpha_blend;a.oc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;q(a,"color_id.glslv","color_id.glslf");u(a,"a_position");h=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===h?0:1);a.Sc.set([1,1,1]);if((b=m("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Sc.set(b.scale);w(a,"TEXTURE_COLOR",1);u(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=v(b),G(a,h,"u_colormap0"),
a.Pd.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(h=v(b),G(a,h,"u_colormap0"),a.Pd.set(b.texture.b4w_uv_velocity_trans))}else w(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(r(a,b),a.sa=!1,a.Gd=P.ad,a.N=!0,q(a,"grass_map.glslv","grass_map.glslf"),u(a,"a_position"),h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Ra.a_grass_size={Ye:!0,src:[]},h?(a.Ra.a_grass_size.src.push({name:h,kc:4}),w(a,
"DYNAMIC_GRASS_SIZE",1)):w(a,"DYNAMIC_GRASS_SIZE",0),a.Ra.a_grass_color={Ye:!0,src:[]},b?(a.Ra.a_grass_color.src.push({name:b,kc:7}),w(a,"DYNAMIC_GRASS_COLOR",1)):w(a,"DYNAMIC_GRASS_COLOR",0),aa.$e?w(a,"UNROLL_LOOPS",1):w(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(q(a,"wireframe.glslv","wireframe.glslf"),u(a,"a_position"),u(a,"a_normal"),u(a,"a_polyindex"),a.N=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],
aa.$e?w(a,"UNROLL_LOOPS",1):w(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":h=b.texture_slots;if(a.af)q(a,"particles_color.glslv","particles_color.glslf");else if(q(a,"particles_texture.glslv","particles_texture.glslf"),h=m("use_map_color_diffuse",h)[0]){w(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":w(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Re=h.diffuse_color_factor;a.Fe=h.use_map_alpha?h.alpha_factor:
0;h=v(h);G(a,h)}na.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Dc=b.ambient;a.Se=b.diffuse_intensity;a.Ud=b.emit;a.Cd.set(b.specular_color);a.Nj=b.specular_alpha;u(a,"a_position");u(a,"a_normal");h=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===h?0:1);w(a,"ALPHA_CLIP","CLIP"===h?1:0);w(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);s(a,b);y(a,b);r(a,b);h=b.game_settings.alpha_blend;a.oc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.vf=b.offset_z;aa.$e?w(a,"UNROLL_LOOPS",
1):w(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+a.type;}return a}function e(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":w(a,c,"TEXTURE_COORDS_UV_ORCO");w(a,"TEXCOORD",1);break;case "NORMAL":w(a,c,"TEXTURE_COORDS_NORMAL");w(a,"NORMAL_TEXCOORD",1);break;default:w(a,c,0)}}function r(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.sa=!0;a.Gd=P.Ym;a.N=!0;break;case "ALPHA":a.sa=!0;a.Gd=P.ad;a.N=!0;break;case "CLIP":a.sa=!1;a.Gd=P.ad;a.N=!0;break;
case "ADD":a.sa=!0;a.Gd=P.ad;a.N=!1;break;case "OPAQUE":a.sa=!1;a.Gd=P.ad;a.N=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.ma=c.use_backface_culling}function v(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&S.$j(d,b,c.ec,c.filepath);return d}function m(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function t(a,b){var c=b.raytrace_transparency;a.pd[0]=c.fresnel;a.pd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Uh=c.reflect_factor;
a.pd[2]=c.fresnel;a.pd[3]=1-c.fresnel_factor/5}function s(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":w(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":w(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":w(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:T.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.nc[0]=
b.specular_intensity;a.nc[1]=c;a.nc[2]=d}function y(a,b){switch(b.diffuse_shader){case "LAMBERT":w(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.kd[0]=0;a.kd[1]=0;break;case "OREN_NAYAR":w(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.kd[0]=b.roughness;a.kd[1]=0;break;case "FRESNEL":w(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.kd[0]=b.diffuse_fresnel;a.kd[1]=b.diffuse_fresnel_factor;break;default:T.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.kd[0]=0,a.kd[1]=
0}}function d(a,b){if(!b.use_nodes)return!1;var c=X.Wt(b.node_tree,b.uuid,!1);if(!c)return T.error('Failed to create node graph for material "'+b.name+'", disable nodes'),C(a,b),!0;q(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===d?0:1);w(a,"ALPHA_CLIP","CLIP"===d?1:0);w(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);u(a,"a_position");r(a,b);a.vf=b.offset_z;d=b.game_settings.alpha_blend;a.oc=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;na.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ob);a.Ud=b.emit;a.Dc=b.ambient;t(a,b);b.b4w_wettable?w(a,"WETTABLE",1):w(a,"WETTABLE",0);a.Pl=X.Xt(c);var e=!1;R.K(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var f=d.data.name,g=d.data.value;a.Gf||(a.Gf={});a.Gf[g]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=d.data.name;a.Ra[f]={Ye:!0,src:[{name:d.data.value}]};g=0;if("GEOMETRY_VC"==d.type)g=7;else for(var h=0;h<d.Pa.length;h++){var k="RGB".indexOf(d.Pa[h].identifier);
-1<k&&(g|=1<<2-k)}a.Ra[f].src[0].kc=g;break;case "GEOMETRY_NO":u(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":f=d.data.value;u(a,"a_normal");w(a,"DIFFUSE_SHADER","DIFFUSE_"+f.diffuse_shader);w(a,"SPECULAR_SHADER","SPECULAR_"+f.specular_shader);w(a,"SHADELESS_MAT",f.use_shadeless?1:0);a.ck=f.use_shadeless;a.Nj=f.specular_alpha;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":f=d.data.name;g=d.data.value;!1!==g.d.ui&&
(g.d.ui="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);G(a,g.d,f);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "PARALLAX":w(a,"CALC_TBN_SPACE",1);u(a,"a_normal");u(a,"a_tangent");f=d.data.name;(g=d.data.value)?(g.d.ui=!1,G(a,g.d,f)):T.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.jg=d.data);break;case "REFRACTION":a.$l=!0}});e||(a.ck=!0);aa.$e?w(a,"UNROLL_LOOPS",1):w(a,"UNROLL_LOOPS",0);return!0}function C(a,
b){q(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;w(a,"ALPHA","OPAQUE"===c?0:1);w(a,"ALPHA_CLIP","CLIP"===c?1:0);w(a,"SHADELESS",1);u(a,"a_position");u(a,"a_normal");na.set(1,0,1,1,a.ob);w(a,"VERTEX_COLOR",0);a.vf=b.offset_z;r(a,b)}function A(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.fj?w(a,"AU_QUALIFIER","attribute"):w(a,"AU_QUALIFIER","uniform"),w(a,"STATIC_BATCH",0)):(w(a,"AU_QUALIFIER","attribute"),w(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(L.Yv()?w(a,"WIREFRAME_QUALITY",
1):w(a,"WIREFRAME_QUALITY",0),a.Uk?(w(a,"DEBUG_SPHERE",1),a.ko?w(a,"DEBUG_SPHERE_DYNAMIC",1):w(a,"DEBUG_SPHERE_DYNAMIC",0)):w(a,"DEBUG_SPHERE",0),w(a,"ALPHA",1));b.Xc?(""!==b.ud?(a.Ra.a_bending_col_main={Ye:!0,src:[{name:b.ud,kc:4}]},u(a,"a_bending_col_main"),""!==b.yb.yp&&""!==b.yb.xp&&""!==b.yb.Op?(a.Ra.a_bending_col_detail={Ye:!0,src:[{name:b.yb.yp,kc:4},{name:b.yb.xp,kc:2},{name:b.yb.Op,kc:1}]},u(a,"a_bending_col_detail"),u(a,"a_normal"),w(a,"DETAIL_BEND",1)):w(a,"DETAIL_BEND",0),w(a,"MAIN_BEND_COL",
1)):w(a,"MAIN_BEND_COL",0),w(a,"WIND_BEND",1)):w(a,"WIND_BEND",0);b.Ai?w(a,"BEND_CENTER_ONLY",1):w(a,"BEND_CENTER_ONLY",0);b.dd?w(a,"BILLBOARD",1):w(a,"BILLBOARD",0);b.dd&&b.fj?w(a,"HAIR_BILLBOARD",1):w(a,"HAIR_BILLBOARD",0);b.xk?w(a,"BILLBOARD_SPHERICAL",1):w(a,"BILLBOARD_SPHERICAL",0);switch(b.bh){case "RANDOM":w(a,"BILLBOARD_RANDOM",1);w(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":w(a,"BILLBOARD_RANDOM",0);w(a,"BILLBOARD_JITTERED",1);break;default:w(a,"BILLBOARD_RANDOM",0),w(a,"BILLBOARD_JITTERED",
0)}b.ya&&aa.nk?w(a,"DYNAMIC_GRASS",1):w(a,"DYNAMIC_GRASS",0);a.ya=b.ya;a.md=b.md;a.Mb=b.Mb;a.Nb=b.Nb;a.sb=b.sb&&!a.ck&&!(a.sa&&aa.oo);a.Wb=b.Wb;a.Lb=b.Lb;a.wc=b.wc;b.Bh?(u(a,"a_influence"),w(a,"SKINNED",1),b.sh?w(a,"FRAMES_BLENDING",1):w(a,"FRAMES_BLENDING",0),w(a,"MAX_BONES",b.max_bones)):(w(a,"SKINNED",0),w(a,"FRAMES_BLENDING",0));b.ji?(w(a,"VERTEX_ANIM",1),aa.sr?w(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):w(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):w(a,"VERTEX_ANIM",0);if(b.Bh&&b.ji)throw"Skinning and vertex animation are mutually exlusive";
b.Pi?w(a,"DISABLE_FOG",1):w(a,"DISABLE_FOG",0);b.gc&&(a.gc=b.gc);if(b.pf&&"NODES"==a.type){for(var c=a.Pl,d=b.Gh,e=0;e<c.length;e++){var f=c[e];switch(f.id){case "ANIM_VALUE":for(var g=f.yj[1],h=0;h<d.length;h+=2)if(d[h]==g){f.yj[0]=d[h+1];break}}}w(a,"NUM_ANIM_VALUES",b.pf.length)}}}function u(a,b){var c=a.fd;-1==c.indexOf(b)&&c.push(b)}function w(a,b,c){ga.J(a.Xa,b,c)}function p(a,b){if("PHYSICS"==a.type)a.$b=b;else{var c=a.Gd,d=a.ld;a.Zo&&(b=P.cv(b));a.vr&&(b=Q.yv(a.wr,a.xr,a.ur));c=P.xy(b,c,d,
a.Ra);a.md||c.bj||(c.Zd=null,c.Wc=null);a.bb=c;c=b.r.length;a.num_vertices=b.D*c;a:switch(a.ld){case P.Vg:case P.pi:case P.Pm:d=!0;break a;default:d=!1}d?P.zw(b)?a.num_triangles=b.Y.length/3*c:a.num_triangles=b.D/3*c:a.num_triangles=0}}function I(a,c,d,e,f,g,h,m,l,q,p,r){var v=[],t=m.b4w_dynamic_grass;if(!q&&t)return v;for(var s="INSTANCE"==m.b4w_wind_bend_inheritance,n="INSTANCE"==m.b4w_shadow_inheritance,w="INSTANCE"==m.b4w_reflection_inheritance,u=[],ba=[],S=0;S<f.length;S++){var y=f[S],D=J.gh(c);
D.dd=m.b4w_hair_billboard;D.bh=m.b4w_hair_billboard_type;D.xk="SPHERICAL"==m.b4w_hair_billboard_geometry;D.ya=t;D.fj=!0;D.pf=y.d.pf;D.Gh=y.d.Gh;s?(D.Xc=y.d.Xc,D.ni=y.d.ni,D.Ae=y.d.Ae,D.Rd=y.d.Rd,D.ud=y.d.ud,D.Qd=y.d.Qd,D.Nd=y.d.Nd,D.Yc=y.d.Yc,D.yb=y.d.yb,D.Ai=!1):(D.Xc=a.d.Xc,D.ni=a.d.ni,D.Ae=a.d.Ae,D.Rd=a.d.Rd,D.ud=a.d.ud,D.Qd=a.d.Qd,D.Nd=a.d.Nd,D.Yc=a.d.Yc,D.yb=a.d.yb,D.Ai=!0);n?(D.Mb=y.d.Mb,D.Nb=y.d.Nb,D.sb=y.d.sb):(D.Mb=a.d.Mb,D.Nb=a.d.Nb,D.sb=a.d.sb);w?(D.Wb=y.d.Wb,D.Lb=y.d.Lb,D.wc=y.d.wc):(D.Wb=
a.d.Wb,D.Lb=a.d.Lb,D.wc=a.d.wc);u.push(D);var G=h[S];G||(G=new Float32Array);r&&J.cj(l.seed,p);for(var aa=new Float32Array(3),C=new Float32Array([0,0,0,1]),I=[],H=0;H<G.length;H+=4){aa[0]=G[H];aa[1]=G[H+1];aa[2]=G[H+2];var O=G[H+3];if(m.b4w_initial_rand_rotation){switch(m.b4w_rotation_type){case "XYZ":var F=new Float32Array([J.lc(p),J.lc(p),J.lc(p)]);ja.normalize(F,F);break;case "Z":F=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+m.b4w_rotation_type;}fa.setAxisAngle(F,
m.b4w_rand_rotation_strength*(2*Math.PI*J.lc(p)-Math.PI),C)}var V=z.Vf(aa,O,C);I.push(V)}ba.push(I)}for(var L={},S=0;S<f.length;S++){var U=g[S],D=u[S],M=J.eh(D,0),I=ba[S];if(I.length)for(var N=f[S].data,Q=N.materials,H=0;H<Q.length;H++)if(!P.fp(N,H))for(var R=0;R<U.length;R++){var X=U[R];if("COLOR_ID"!==X){var ca=b(X),ga=Q[H];if(k(ca,ga,!0)){ca.ld=N.ld||P.Vg;A(ca,D);ca.uf=m.uuid;"JITTERED"==m.b4w_hair_billboard_type&&(ca.hj=m.b4w_hair_billboard_jitter_amp,ca.ij=m.b4w_hair_billboard_jitter_freq);t&&
(ca.Zi=m.b4w_dynamic_grass_scale_threshold);s||(delete ca.Ra.a_bending_col_main,delete ca.Ra.a_bending_col_detail);x(ca,M);var ia=P.Ao(N,H,ca.fd,ca.gc,ca.Ra,ca.Gf),mb=[];if(D.Xc||D.ya||D.dd)mb.au_wind_bending_amp=[D.Yc],mb.au_wind_bending_freq=[D.Ae],mb.au_detail_bending_freq=[D.Rd],mb.au_detail_bending_amp=[D.Qd],mb.au_branch_bending_amp=[D.Nd];var Ya=P.Iw(ia,mb,I),yb=Ya,dc=I;yb.A.au_center_pos=new Float32Array(3*yb.D);for(var Mb=dc.length,Ub=yb.D/Mb,Vb=0;Vb<Mb;Vb++)for(var lc=dc[Vb],va=3*Ub*Vb,
Nb=0;Nb<Ub;Nb++)yb.A.au_center_pos[va+3*Nb]=lc[0],yb.A.au_center_pos[va+3*Nb+1]=lc[1],yb.A.au_center_pos[va+3*Nb+2]=lc[2];Ya=yb;if(D.Ai){var db=Ya,ra=a.d.H;db.A.a_emitter_center=new Float32Array(3*db.D);var zb=na.fromValues(0,0,0,1);na.transformMat4(zb,ra,zb);for(var da=0;da<db.D;da++)db.A.a_emitter_center[3*da]=zb[0],db.A.a_emitter_center[3*da+1]=zb[1],db.A.a_emitter_center[3*da+2]=zb[2];Ya=db}var Ua=m.b4w_vcol_from_name,eb=m.b4w_vcol_to_name,la=ca,Ka=d,fb=!s,ua=N,Va=[];if(""!==Ua&&""!==eb){var oa,
La=eb,Ab=la.Ra,ec=[],$b=void 0;for($b in Ab)for(var ac=Ab[$b].src,ub=0,Bb=0;Bb<ac.length;Bb++){var mc=ac[Bb].kc;La==ac[Bb].name&&ec.push($b,mc,ub);ub+=J.Cf(mc)}oa=ec;if(0<oa.length)for(var Cb=0;Cb<oa.length;Cb+=3)Va.push({oh:Ua,Si:7,zj:oa[Cb],Aj:oa[Cb+1],Qi:oa[Cb+2]});else P.kw(la.fd,"a_color")&&eb==ua.active_vcol_name&&Va.push({oh:Ua,Si:7,zj:"a_color",Aj:7,Qi:0})}fb&&("a_bending_col_main"in Ka.Ra&&Va.push({oh:"a_bending_col_main",Si:4,zj:"a_bending_col_main",Aj:4,Qi:0}),"a_bending_col_detail"in Ka.Ra&&
Va.push({oh:"a_bending_col_detail",Si:7,zj:"a_bending_col_detail",Aj:7,Qi:0}));for(var vb=Ya,nc=I,Ob=e,Ma=Va,bc=ca.Ra,oc=!1,Qa=0;Qa<Ma.length;Qa++){var nb=Ma[Qa].oh,Db=Ob.A[nb];if(Db&&0<Db.length){oc=!0;break}}if(oc){var pc,Fa=a.d.Eb,Oa=Ob.r[0].a_position,E=nc,ka=L,Ba=new Float32Array(3),qa=new Float32Array(3),Wb=new Uint32Array(E.length);if(!("verts_indices"in ka)){ka.ed=new Float32Array(3);ka.cd=new Float32Array(3);ka.Hm=new Uint32Array(Oa.length/3);ka.Ih=new Uint32Array(Oa.length/3);ka.ed[0]=(Fa.max_x-
Fa.min_x)/20;ka.ed[1]=(Fa.max_y-Fa.min_y)/20;ka.ed[2]=(Fa.max_z-Fa.min_z)/20;ka.cd[0]=Fa.min_x;ka.cd[1]=Fa.min_y;ka.cd[2]=Fa.min_z;for(var Z=0;Z<Oa.length/3;Z++){var jb=J.trunc((Oa[3*Z]-ka.cd[0])/ka.ed[0]),kb=J.trunc((Oa[3*Z+1]-ka.cd[1])/ka.ed[1]),Pb=J.trunc((Oa[3*Z+2]-ka.cd[2])/ka.ed[2]),jb=J.clamp(jb,0,19),kb=J.clamp(kb,0,19),Pb=J.clamp(Pb,0,19);ka.Hm[Z]=Z;ka.Ih[Z]=Pb*Math.pow(20,2)+20*kb+jb}P.hy(ka.Ih,ka.Hm,!0);ka.If=new Uint32Array(Math.pow(20,3));for(Z=0;Z<ka.Ih.length;Z++)ka.If[ka.Ih[Z]]++;
delete ka.Ih;for(Z=1;Z<ka.If.length;Z++)ka.If[Z]+=ka.If[Z-1]}for(var ob=0;ob<E.length;ob++){Ba[0]=E[ob][0];Ba[1]=E[ob][1];Ba[2]=E[ob][2];for(var Qb=1E10,wb=-1,Eb=J.trunc((Ba[0]-ka.cd[0])/ka.ed[0]),Rb=J.trunc((Ba[1]-ka.cd[1])/ka.ed[1]),Aa=J.trunc((Ba[2]-ka.cd[2])/ka.ed[2]),Eb=J.clamp(Eb,0,19),Rb=J.clamp(Rb,0,19),Aa=J.clamp(Aa,0,19),Ga=Aa*Math.pow(20,2)+20*Rb+Eb,Ec=ka.If[Ga],Fb=0==Ga?0:ka.If[Ga-1];Fb<Ec;Fb++){var vc=ka.Hm[Fb];qa[0]=Oa[3*vc];qa[1]=Oa[3*vc+1];qa[2]=Oa[3*vc+2];ja.sub(qa,Ba,qa);var Fc=
ja.sqrLen(qa);Fc<=Qb&&(Qb=Fc,wb=vc)}if(-1==wb)for(Fb=0;Fb<Oa.length/3;Fb++)qa[0]=Oa[3*Fb],qa[1]=Oa[3*Fb+1],qa[2]=Oa[3*Fb+2],ja.sub(qa,Ba,qa),Fc=ja.sqrLen(qa),Fc<=Qb&&(Qb=Fc,wb=Fb);Wb[ob]=wb}pc=Wb;for(var jd=vb.D/nc.length,Qa=0;Qa<Ma.length;Qa++){var Xb=Ma[Qa].zj,fc=Ma[Qa].Aj,nb=Ma[Qa].oh,pb=Ma[Qa].Si,Db=Ob.A[nb];switch(Xb){case "a_bending_col_main":var Gb=1;break;case "a_bending_col_detail":Gb=3;break;case "a_color":Gb=3;break;default:for(var qb=Gb=0;qb<bc[Xb].src.length;qb++)Gb+=J.Cf(bc[Xb].src[qb].kc)}if(Db&&
0<Db.length){var gc=J.Cf(pb),wc=J.Cf(fc),xc=pb&fc,xb=J.vq(xc);xc!=fc&&T.error("Wrong color extraction from "+nb+" to "+Xb+".");if("a_bending_col_main"==Xb||"a_bending_col_detail"==Xb)vb.A[Xb]=new Float32Array(vb.D*wc);for(qb=0;qb<nc.length;qb++){var Hb=pc[qb],Ib=Hb*gc,gb=qb*jd*Gb;if(-1!=Hb)for(var Sb=0;Sb<jd;Sb++)for(var yc=Sb*Gb,hb=0;hb<xb.length;hb++)xb[hb]&&(vb.A[Xb][gb+yc+(Ma[Qa].Qi+J.Yh(fc,hb))]=Db[Ib+J.Yh(pb,hb)])}}else vb.A[Xb]=new Float32Array(0)}}Ya=vb;v.push({k:ca,$b:Ya,Sb:[ga.name],Gb:D,
xc:[a]})}}}}return v}function H(a){return z.Vf(a.e,a.scale,a.quat)}function x(a,b){for(var c=null,d=null,e=null,f=0;f<a.S.length;f++){var g=a.S[f].tj;g&&(c||(c={}),c[f]=g,a.S[f].tj=null);if(g=a.S[f].Qf)d||(d={}),d[f]=g,a.S[f].Qf=null;if(g=a.S[f].Sa)e||(e={}),e[f]=g,a.S[f].Sa=null}a.id=0;a.am=b;a.id=J.eh(a,b);if(c)for(f in c)a.S[f].tj=c[f];if(d)for(var h in d)a.S[h].Qf=d[h];if(e)for(h in e)a.S[h].Sa=e[h]}function M(a,c,d,e,f){var g=b("WIREFRAME");q(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=
0;g.Uk=!0;g.N=!0;g.uf=d;f&&(g.ko=!0);A(g,c);x(g,J.eh(c,0));e?(c=Q.Jo(1,a.t),P.Cx(c,[a.Ie[0],a.Je[1],a.Ke[2]],a.t)):c=Q.Jo(a.oa,a.t);P.vm(c,1,!0);c.A.a_polyindex=P.zo(c);p(g,c);return g}function q(a,b,c){a.Xa={ii:b,rh:c,Sd:[]};ga.Lx(a.Xa)}function G(a,b,c){1==a.S.length&&0==a.ac.length&&a.ac.push("default0");c=c||"default"+String(a.S.length);-1==a.ac.indexOf(c)&&(a.S.push(b),a.ac.push(c))}function D(a){if(!a.Xa)throw"No shaders info for batch "+a.name;a.Yb=ga.Kv(a.Xa,a.Pl);ia.ut(a.Yb);ia.mn(a)}function V(a,
b,c){var d=a.Xa;ga.J(d,"SHADOW_SRC",b);ga.J(d,"SHADOW_DST",c);return a}var O=n("__boundings"),U=n("__config"),T=n("__print"),L=n("__extensions"),P=n("__geometry"),R=n("__graph"),X=n("__nodemat"),N=n("__objects"),ca=n("__particles"),Q=n("__primitives");n("__reformer");var ia=n("__renderer"),F=n("__scenegraph");n("__scenes");var ga=n("__shaders"),S=n("__textures"),z=n("__tsr"),J=n("__util"),ja=n("vec3"),na=n("vec4"),fa=n("quat"),aa=U.n,ba=["MAIN","NODES"];a.UA=b;a.xv=function(a,d,e,f,h){for(var k=[],
m=[],l=0;l<e.length;l++){var r=e[l];switch(r.d.type){case "DYNAMIC":k.push(r);break;case "STATIC":m.push(r)}}e=[];e=e.concat(c(k,a,h));a=e=e.concat(g(m,a,d,h));l=[];r=[];d={};for(e=0;e<a.length;e++){k=a[e].k;m=a[e].Gb;h=null;if(k.id in d){var t=d[k.id],s=r[t].Gb;J.Xq(k,r[t].k)&&J.Xq(m,s)&&(h=r[t]);if(!h){do k.id++;while(d[k.id])}}h||(h={k:k,Gb:a[e].Gb,xc:[],Zq:[],Sb:[]},d[k.id]=r.length,r.push(h));h.xc=h.xc.concat(a[e].xc);a[e].$b&&a[e].$b.D&&h.Zq.push(a[e].$b);if(h.Sb.length)for(k=0;k<a[e].Sb.length;k++)m=
a[e].Sb[k],-1==h.Sb.indexOf(m)&&h.Sb.push(m);else h.Sb=a[e].Sb}for(e=0;e<r.length;e++){a=r[e].Zq;if(0==a.length)a=J.mb(J.Wj("%empty"));else if(1==a.length)a=a[0];else{d=[];for(k=0;k<a.length;k++)P.Aw(a[k])||d.push(k);if(d.length<a.length)for(k=0;k<d.length;k++)P.vm(a[d[k]]);a=P.wy(a)}l.push({k:r[e].k,Gb:r[e].Gb,$b:a,Sb:r[e].Sb,xc:r[e].xc})}e=l;for(l=0;l<e.length;l++)p(e[l].k,e[l].$b),e[l].k.vc=e[l].Sb;a=[];for(l=0;l<e.length;l++)if(d=e[l].k,"STATIC"==e[l].Gb.type)r=J.kp(J.Wj("%meta")),r.d=e[l].Gb,
r.P=[d],a.push(r);else for(h=[],k=0;k<e[l].xc.length;k++)if(r=e[l].xc[k],-1==h.indexOf(r.name)){for(m=0;m<r.P.length;m++)if(r.P[m]==d)throw"Batch already exist in object";r.P.push(d);h.push(r.name)}if(aa.wireframe_debug){for(l=0;l<e.length;l++)d=e[l].Gb,"DYNAMIC"==d.type&&(r=e[l].xc[0],-1<ba.indexOf(e[l].k.type)&&(d=M(d.Le,d,r.name,!0,!0),r.P.push(d)));for(l=0;l<a.length;l++)r=a[l],d=r.d,-1<ba.indexOf(r.P[0].type)&&(d=M(d.tc,d,r.name,!1),r.P.push(d))}r=null;if(f.texture_slots)for(l=0;l<f.texture_slots.length;l++)if(f.texture_slots[l].texture.b4w_use_as_skydome){r=
v(f.texture_slots[l],null);break}if(f.b4w_sky_settings.procedural_skydome||r)d=b("MAIN"),q(d,"special_skydome.glslv","special_skydome.glslf"),f.b4w_sky_settings.procedural_skydome?d.mq=!0:G(d,r,"u_sky"),f.b4w_sky_settings.reflexible&&(d.Wb=!0,f.b4w_sky_settings.reflexible_only&&(d.Lb=!0)),u(d,"a_position"),d.vf=99999,f=Q.wv(),p(d,f),r=J.kp(J.Wj("%meta")),r.d=N.Mi("DYNAMIC"),r.d.Xf=!0,r.d.Eb=O.Zc(),r.d.tc=O.oi(),r.d.Ia=O.Zc(),r.d.kb=O.oi(),r.P=[d],a.push(r);return a};a.oz=function(a,b,c){if(b)b=c*
(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.wt=l;a.Hv=v;a.rk=function(a,b){w(a,"CSM_SECTION0",0);w(a,"CSM_SECTION1",0);w(a,"CSM_SECTION2",0);w(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)w(a,"CSM_SECTION"+String(c),1);w(a,"SHADOW_TEX_RES",ga.u(b.csm_resolution));w(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);w(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.U=w;a.fb=function(a,
b){return ga.Qv(a.Xa,b)};a.wi=G;a.wx=function(a,b,c){c=a.ac.indexOf(c);-1<c&&(a.S[c]=b)};a.vu=function(a,c){var d=b("MAIN");d.sa=!0;na.set(c[0],c[1],c[2],.5,d.ob);d.ld=P.pi;p(d,a);q(d,"main.glslv","main.glslf");w(d,"SHADELESS",1);D(d);return d};a.tb=D;a.Mt=function(a){return a.Yb.Oh.length?a.Yb.Wl.u_cube_fog?!0:!1:!1};a.wu=function(a,c){var d=b("DEPTH");d.ma=a.ma;d.Sc.set(a.Sc);d.ya=a.ya;d.bb=a.bb;d.id=a.id;d.am=a.am;a.S.length&&(d.S[0]=a.S[0],d.ac[0]=a.ac[0]);d.Pd.set(a.Pd);d.fd=a.fd;d.hj=a.hj;d.ij=
a.ij;d.Zi=a.Zi;d.num_triangles=a.num_triangles;d.num_vertices=a.num_vertices;d.uf=a.uf;for(var e=0;e<a.vc.length;e++)d.vc.push(a.vc[e]);d.Lc=a.Lc;a.wb||(a.wb=[]);a.wb.push(d);q(d,"depth.glslv","depth.glslf");ga.qw(d.Xa,a.Xa);return d=V(d,"SHADOW_SRC_NONE",c)};a.Dm=V;a.ju=function(){var a=b("DEPTH_PACK");a.ma=!0;a.N=!1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");D(a);return a};a.co=function(a){var c=b("POSTPROCESSING");q(c,"postprocessing/postprocessing.glslv",
"postprocessing/postprocessing.glslf");switch(a){case "NONE":w(c,"POST_EFFECT","POST_EFFECT_NONE");c.p[0]=1;c.p[1]=1;break;case "GRAYSCALE":w(c,"POST_EFFECT","POST_EFFECT_GRAYSCALE");c.p[0]=1;c.p[1]=1;break;case "X_BLUR":w(c,"POST_EFFECT","POST_EFFECT_X_BLUR");c.p[0]=1;c.p[1]=0;break;case "Y_BLUR":w(c,"POST_EFFECT","POST_EFFECT_Y_BLUR");c.p[0]=0;c.p[1]=1;break;case "X_EXTEND":w(c,"POST_EFFECT","POST_EFFECT_X_EXTEND");c.p[0]=1;c.p[1]=0;break;case "Y_EXTEND":w(c,"POST_EFFECT","POST_EFFECT_Y_EXTEND");
c.p[0]=0;c.p[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}c.ma=!0;c.N=!1;a=Q.Ca();p(c,a);D(c);return c};a.gA=function(){var a=b("EDGE");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");D(a);return a};a.Au=function(a){var c=b("SSAO");c.N=!1;c.ma=!0;c.p[0]=1;c.p[1]=1;var d=Q.Ca();p(c,d);q(c,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");w(c,"SSAO_QUALITY","SSAO_QUALITY_"+a.Sq);w(c,"SSAO_HEMISPHERE",
a.ssao_hemisphere?1:0);a={texture:S.Av(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=v(a,d);G(c,a,"u_ssao_special_tex");D(c);return c};a.Bu=function(a){var c=b("SSAO_BLUR");c.N=!1;c.ma=!0;c.p[0]=1;c.p[1]=1;var d=Q.Ca();p(c,d);q(c,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");
w(c,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);D(c);return c};a.ku=function(){var a=b("DOF");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");w(a,"DEPTH_RGBA",1);D(a);return a};a.lu=function(){var a=b("GLOW");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");D(a);return a};a.mu=function(a,c,d){var e=b("GOD_RAYS");e.N=!1;e.ma=!0;e.p[0]=1;e.p[1]=1;var f=Q.Ca();
p(e,f);q(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");w(e,"DEPTH_RGBA",a);w(e,"WATER_EFFECTS",c);w(e,"STEPS_PER_PASS",ga.u(d,1));D(e);return e};a.nu=function(){var a=b("GOD_RAYS_COM");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");D(a);return a};a.xu=function(){var a=b("SKY");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.sv();p(a,c);q(a,"procedural_skydome.glslv","procedural_skydome.glslf");w(a,
"NUM_LIGHTS",1);w(a,"WATER_EFFECTS",1);D(a);return a};a.du=function(){var a=b("ANTIALIASING");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;a.Ig=1/aa.resolution_factor;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");w(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");D(a);return a};a.yu=function(a){var c=b("SMAA"),d=Q.Ca();p(c,d);q(c,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");w(c,"AA_METHOD","AA_METHOD_SMAA_HIGH");w(c,"SMAA_PASS",a);w(c,"SMAA_PREDICATION",
0);w(c,"SMAA_REPROJECTION",0);D(c);c.N=!1;c.ma=!0;c.p[0]=1;c.p[1]=1;c.Ig=1/aa.resolution_factor;return c};a.ou=function(a){var c=b("LANCZOS");c.N=!1;c.ma=!0;c.Ig=1/aa.resolution_factor;"LANCZOS_X"==a?(c.p[0]=1,c.p[1]=0):"LANCZOS_Y"==a&&(c.p[0]=0,c.p[1]=1);a=Q.Ca();p(c,a);q(c,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");D(c);return c};a.hu=function(){var a=b("COMPOSITING");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");
D(a);return a};a.ru=function(a){var c=b("MOTION_BLUR");c.ma=!0;c.N=!1;var d=Q.Ca();p(c,d);q(c,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");w(c,"BLUR_DECAY_THRESHOLD",ga.u(a));D(c);return c};a.cu=function(){var a=b("ANAGLYPH");a.ma=!0;a.N=!1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");D(a);return a};a.pu=function(){var a=b("LUMINANCE");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance.glslf");D(a);return a};a.eu=function(){var a=b("LUMINANCE");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");D(a);return a};a.qu=function(){var a=b("LUMINANCE_X_BLUR");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");D(a);return a};a.fu=function(a){var c=b("POSTPROCESSING");switch(a){case "X_BLUR":c.p[0]=
1;c.p[1]=0;break;case "Y_BLUR":c.p[0]=0;c.p[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}c.ma=!0;c.N=!1;a=Q.Ca();p(c,a);q(c,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");D(c);return c};a.gu=function(){var a=b("BLOOM");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");D(a);return a};a.Eu=function(){var a=b("VELOCITY");a.N=!1;a.ma=!0;a.p[0]=1;a.p[1]=1;var c=Q.Ca();
p(a,c);q(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");D(a);return a};a.bi=function(a,b,c){var d=a.Ig;a.ym[0]=b*a.p[0]*d;a.ym[1]=c*a.p[1]*d};a.Ef=function(a,b){a.Ig=b};a.T=function(a,b,c){a=a.P;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<f.vc.indexOf(b)&&(c&&f.type==c||!c)){if(f.wb)return f;d=null===d?f:d}}return d};a.Vt=function(a){for(var b=a.S,c=0;c<b.length;c++)S.Qu(b[c].Ga);P.Qn(a.bb)}};b4w.module.__nodemat=function(a,n){function b(a,b,e){if(b in J)return J[b];for(var f=N.create(),m=a.nodes,q=a.links,p=a.animation_data,z=0;z<m.length;z++)if(!d(f,m[z],0,p))return J[b]=null;if(e&&-1==s(a,f,"GROUP_OUTPUT","group"))return null;z=V(f);if(!O(f,q,z))return null;if(e)return f;for(z=0;z<q.length;z++){e=q[z];for(var m=h(e.from_node,f),p=h(e.to_node,f),n=0;n<m.length;n++)for(var w=0;w<p.length;w++){for(var u=m[n],y=p[w],D=N.Da(f,u),S=N.Da(f,y),G=f,x=S,S=[],fa=e.from_socket.identifier,A=e.to_socket.identifier,
C=D.Pa,D=0;D<C.length;D++)if(C[D].identifier==fa){S.push(D);break}x=x.C;for(D=0;D<x.length;D++)if(x[D].identifier==A){S.push(D);break}2==S.length&&N.He(G,u,y,S)}}l(f);a=s(a,f,"OUTPUT","material");if(-1==a)return J[b]=null;k(f);f=N.ty(f,a,N.Br);g(f);r(f);v(f);t(f);return c(f)?J[b]=f:(X.error("Material has normalmap node but no material node"),J[b]=null)}function c(a){var b=!1,c=!1;N.K(a,function(a,d){if("MATERIAL"==d.type||"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&!c?
!1:!0}function g(a){N.K(a,function(b,c){for(var d=c.C,e=c.Pa,g=0;g<d.length;g++)f(a,d[g],b,g,1);for(g=0;g<e.length;g++)f(a,e[g],b,g,0)})}function f(a,b,c,d,e){if(b.td){var f=!0;N.ue(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.td=!1)}}function l(a){var b=[];N.K(a,function(c,d){switch(d.type){case "TRANSLUCENCY":N.ue(a,function(a,e,f){a==c&&"Translucency"==d.Pa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)N.He(a,b[c],b[c+1],b[c+2])}function h(a,
b){var c=[];N.K(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function k(a){var b=[];N.K(a,function(a,c){"PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],f=b[c+1];if("PARALLAX"==f.type){var g=e(a,d);if(-1!=g){var h=N.Vi(a,g,0);N.rg(a,g,d,-1);-1!=h&&N.rg(a,h,g,-1);d=N.Da(a,g);f.data=d.data;f.B[0]=d.B[0];N.sg(a,g)}f.C.splice(1,1)}else if("REROUTE"==f.type){for(var f=N.Vi(a,d,0),k=N.pg(a,d),g=[],h=[],m=[],l=0;l<k;l++){var q=
N.fg(a,d,l),p=h.indexOf(q);-1!=p?m[p]+=1:(h.push(q),m.push(1),g.push(d,q))}if(-1!=f)for(k=N.eg(a,f,d,0)[0],l=0;l<h.length;l++)for(q=0;q<m[l];q++)p=N.eg(a,d,h[l],q)[1],N.He(a,f,h[l],[k,p]);for(l=0;l<g.length;l+=2)N.rg(a,g[l],g[l+1],-1)}}}function e(a,b){for(var c=a.ua,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function r(a){var b=[];N.K(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=
c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(m(f,k.ra)){g=[];h=N.pg(a,e);for(p=0;p<h;p++){var l=N.fg(a,e,p),q=N.eg(a,e,l,0);g.push(e,l,q);N.He(a,k.id,l,q)}for(var p=0;p<g.length;p+=3)N.rg(a,g[p],g[p+1],0);N.sg(a,e);g=!1;break}}g&&(k={id:e,ra:f},c.push(k))}}function v(a){var b=[];N.K(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,
h=0;h<c.length;h++){var k=c[h];if(!(3<=k.pj.length)&&m(f,k.ra)){for(var h=[],l=N.jp(a,e),g={},q=0;q<l;q++){var p=N.Vi(a,e,q);p in g||(g[p]=0);var r=N.eg(a,p,e,g[p]++);h.push(p,e,r)}for(var l=[],g=N.pg(a,e),v={},q=0;q<g;q++)p=N.fg(a,e,q),p in v||(v[p]=0),r=N.eg(a,e,p,v[p]++),l.push(e,p,r);for(var g=h.concat(l),q=0;q<g.length;q+=3)N.rg(a,g[q],g[q+1],0);N.sg(a,e);q={ra:f,Wu:h,Xu:l};k.pj.push(q);g=!1;break}}g&&(k={id:e,ra:f,pj:[]},c.push(k))}for(d=0;d<c.length;d++){k=c[d];e=k.pj.length;l=k.ra.C.length;
g=k.ra.Pa.length;for(h=0;h<e;h++){r=k.pj[h];q=r.ra;f=r.Wu;v=r.Xu;k.ra.C=k.ra.C.concat(q.C);k.ra.Pa=k.ra.Pa.concat(q.Pa);for(q=0;q<k.ra.C.length;q++)k.ra.C[q].identifier+=Q.trunc(q/l)+1;for(q=0;q<k.ra.Pa.length;q++)k.ra.Pa[q].identifier+=Q.trunc(q/g)+1;for(q=0;q<f.length;q+=3)p=f[q],r=f[q+2],r[1]+=(h+1)*l,N.He(a,p,k.id,r);for(q=0;q<v.length;q+=3)p=v[q+1],r=v[q+2],r[0]+=(h+1)*g,N.He(a,k.id,p,r)}switch(e){case 1:k.ra.type+="2";break;case 2:k.ra.type+="3";break;case 3:k.ra.type+="4"}N.sg(a,k.id);N.qk(a,
k.id,k.ra)}}function m(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function t(a){var b=[];N.K(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],m=N.pg(a,d),l=0;l<
m;l++){var q=N.fg(a,d,l);if("SEPRGB"!=N.Da(a,q).type){f=!1;break}g.push(d,q);for(var p={},r=N.pg(a,q),f=0;f<r;f++){var v=N.fg(a,q,f);v in p||(p[v]=0);var t=N.eg(a,q,v,p[v]++);g.push(q,v);k[t[0]].push(d,v,t)}h.push(q);f=!0}if(f){for(l=d=m=0;l<k.length;l++)k[l].length&&(m++,d|=1<<2-l);if(m){e.type+=m;e.Pa=[];for(l=0;l<k.length;l++)if(k[l].length)for(e.Pa.push({nb:0,identifier:"RGB"[l],td:!0,name:"RGB"[l]}),f=0;f<k[l].length;f+=3)k[l][f+2][0]=Q.Yh(d,l);for(l=0;l<g.length;l+=2)N.rg(a,g[l],g[l+1],0);for(l=
0;l<h.length;l++)N.sg(a,h[l]);for(l=0;l<k.length;l++)for(f=0;f<k[l].length;f+=3)N.He(a,k[l][f],k[l][f+1],k[l][f+2])}}}}function s(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var g=a[f];g.type==c&&(e=g)}return e?h(e,b)[0]:(X.error('No "'+c+'" node in node '+d),-1)}function y(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function d(a,c,e,f){var g=c.name,h=c.type,k=[],m=[],l=[],r=[],v=null;switch(h){case "CAMERA":m=[];l=M(c);break;case "COMBRGB":case "COMBHSV":m=x(c);l=M(c);break;case "GEOMETRY":a:{for(var h=
c.outputs,t=0;t<h.length;t++)if(h[t].is_linked){h=!0;break a}h=!1}if(!h)return!0;h=u(c,e);if(!h)return X.error("Geometry output is not supported"),!1;switch(h){case "GEOMETRY_UV":if(!c.uv_layer)return X.error('Missing uv layer in node "',c.name,'"'),!1;v=A("param_GEOMETRY_UV_a");t=A("param_GEOMETRY_UV_v");k.push(q(v));k.push(q(t));l.push(p(c,"UV"));r.push(q(t));v={name:v,value:c.uv_layer};break;case "GEOMETRY_VC":if(!c.color_layer)return X.error("Missing vertex color layer in node ",c.name),!1;v=
A("param_GEOMETRY_VC_a");t=A("param_GEOMETRY_VC_v");k.push(q(v));k.push(q(t));l.push(p(c,"Vertex Color"));r.push(q(t));v={name:v,value:c.color_layer};break;case "GEOMETRY_NO":l.push(p(c,"Normal"));break;case "GEOMETRY_FB":l.push(p(c,"Front/Back"));break;case "GEOMETRY_VW":l.push(p(c,"View"));break;case "GEOMETRY_GL":l.push(p(c,"Global"))}break;case "GROUP":t=c.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(t){case "LINEAR_TO_SRGB":h="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":case "VECTOR_VIEW":h=
"VECTOR_VIEW";break;case "SRGB_TO_LINEAR":h="SRGB_TO_LINEAR";break;case "REFLECT":h="REFLECT";break;case "REFRACTION":h="REFRACTION";break;case "PARALLAX":h="PARALLAX";if(!c.inputs[1].is_linked)return X.error('Missing texture in node "',c.name,'"'),!1;var s=A("temp_texture");r.push(q(s));break;case "CLAMP":h="CLAMP";break;case "TRANSLUCENCY":h="TRANSLUCENCY";break;case "TIME":h="TIME";break;case "SMOOTHSTEP":h="SMOOTHSTEP";break;default:l=c.node_group.node_tree;m={};for(s in l)if("links"==s||"nodes"==
s)for(m[s]=[],v=0;v<l[s].length;v++){m[s][v]={};for(var z in l[s][v])if("links"==s){m[s][v][z]={};for(var n in l[s][v][z])m[s][v][z][n]=C(l[s][v][z][n])}else m[s][v][z]=C(l[s][v][z])}else m[s]=C(l[s]);if("REPLACE"==t||"LEVELS_OF_QUALITY"==t)l=y("Group input","GROUP_INPUT",[],c.inputs),v=y("Group output","GROUP_OUTPUT",c.outputs,[]),s=null,s="REPLACE"==t||"LEVELS_OF_QUALITY"==t&&(fa.quality==ia.P_LOW||fa.dl)?{from_node:l,from_socket:l.outputs[1],to_node:v,to_socket:v.inputs[0]}:{from_node:l,from_socket:l.outputs[0],
to_node:v,to_socket:v.inputs[0]},m.nodes=[l,v],m.links=[s];l=c.name;v=m.nodes;s=m.links;for(z=0;z<v.length;z++)v[z].name=D(v[z].type,l,v[z].name);for(z=0;z<s.length;z++)s[z].from_node.name=D(s[z].from_node.type,l,s[z].from_node.name),s[z].to_node.name=D(s[z].to_node.type,l,s[z].to_node.name);v={Vw:b(m,c.node_group.uuid,!0),Ww:m.links}}m=x(c);l=M(c);"TRANSLUCENCY"==t&&(t=H("TranslucencyParams","TranslucencyParams",[0,0,0,0]),t.td=l[0].td,l.push(t));break;case "LAMP":v=c.lamp;if(!v)return X.error("There is no lamp in node: "+
c.name),!1;l.push(p(c,"Color"));l.push(p(c,"Light Vector"));l.push(p(c,"Distance"));l.push(p(c,"Visibility Factor"));v.uuid in ja?r.push(q(A("param_LAMP_lamp_index"),ja[v.uuid],1)):(ja[v.uuid]=na,r.push(q(A("param_LAMP_lamp_index"),na++,1)));v=ja;break;case "NORMAL":m=x(c);l=M(c);t=p(c,"Normal");r.push(q(A("param_NORMAL_Normal"),t.nb,3));break;case "MAPPING":m.push(w(c,"Vector"));l.push(p(c,"Vector"));if(0!=F.length(c.translation)||0!=F.length(c.rotation)||c.use_max||c.use_min){var h="MAPPING_HEAVY",
J=c.rotation,t=ga.create(),s=Math.cos(J[0]);z=Math.cos(J[1]);n=Math.cos(J[2]);var G=Math.sin(J[0]),I=Math.sin(J[1]),J=Math.sin(J[2]),O=s*n,V=s*J,T=G*n,L=G*J;t[0]=z*n;t[1]=z*J;t[2]=-I;t[3]=I*T-V;t[4]=I*L+O;t[5]=z*G;t[6]=I*O+L;t[7]=I*V-T;t[8]=z*s;s=c.scale;z=new Float32Array([s[0],0,0,0,s[1],0,0,0,s[2]]);s=ga.create();ga.multiply(t,z,s);t=c.translation;s=Q.Kw(s,S.create());s[12]=t[0];s[13]=t[1];s[14]=t[2];r.push(q(A("param_MAPPING_HEAVY_trs_matrix"),s,16));r.push(q(A("param_MAPPING_HEAVY_use_min"),
~~c.use_min,1));r.push(q(A("param_MAPPING_HEAVY_use_max"),~~c.use_max,1));r.push(q(A("param_MAPPING_LIGHT_min_clip"),c.min,3));r.push(q(A("param_MAPPING_LIGHT_max_clip"),c.max,3))}else h="MAPPING_LIGHT",r.push(q(A("param_MAPPING_LIGHT_scale"),c.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":v=c.material;if(!v)return X.error("Emtpy material slot in node: "+c.name),!1;s=w(c,"Color");s.nb.splice(3);m.push(s);(s=w(c,"Alpha"))?m.push(s):m.push(H("Alpha","Alpha",1));s=w(c,"Spec");s.nb.splice(3);m.push(s);
t=w(c,"Normal");t.nb.splice(3);m.push(t);l.push(p(c,"Color"));l.push(p(c,"Alpha"));l.push(p(c,"Normal"));"MATERIAL_EXT"==h&&((s=w(c,"Emit"))?m.push(s):m.push(H("Emit","Emit",0)),s=w(c,"Translucency"),s.nb=0,s.name="Translucency",s.identifier="Translucency",s?m.push(s):m.push(H(s.name,s.identifier,s.nb)),s=w(c,"Translucency"),s.nb=[0,0,0,0],s.name="TranslucencyParams",s.identifier="TranslucencyParams",s?m.push(s):m.push(H(s.name,s.identifier,s.nb)),(s=w(c,"Ray Mirror"))?m.push(s):m.push(H("Ray Mirror",
"Ray Mirror",0)),(s=w(c,"SpecTra"))?m.push(s):m.push(H("SpecTra","SpecTra",0)),l.push(p(c,"Diffuse")),l.push(p(c,"Spec")));z=0;switch(v.specular_shader){case "COOKTORR":case "PHONG":s=v.specular_hardness;break;case "WARDISO":s=v.specular_slope;break;case "TOON":s=v.specular_toon_size;z=v.specular_toon_smooth;break;default:X.error("B4W Error: unsupported specular shader: "+v.specular_shader+' (material "'+v.name+'")'),s=v.specular_hardness}switch(v.diffuse_shader){case "LAMBERT":G=n=0;break;case "OREN_NAYAR":n=
v.roughness;G=0;break;case "FRESNEL":n=v.diffuse_fresnel;G=v.diffuse_fresnel_factor;break;default:X.error("B4W Error: unsupported diffuse shader: "+v.diffuse_shader+' (material "'+v.name+'")'),G=n=0}r.push(q(A("param_MATERIAL_diffuse"),[c.use_diffuse?1:0,n,G],3));r.push(q(A("param_MATERIAL_spec"),[c.use_specular?1:0,v.specular_intensity,s,z],4));r.push(q(A("param_MATERIAL_norm"),t.td?1:0,1));v={name:c.name,value:v};break;case "MATH":switch(c.operation){case "ADD":h="MATH_ADD";break;case "SUBTRACT":h=
"MATH_SUBTRACT";break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;case "ROUND":h="MATH_ROUND";
break;case "LESS_THAN":h="MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return X.error("Unsupported MATH operation: "+c.operation),!1}m=x(c);l=M(c);break;case "MIX_RGB":switch(c.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h="MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";break;case "DIVIDE":h=
"MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h="MIX_RGB_LINEAR_LIGHT";
break;default:return X.error("Unsupported MIX_RGB blend type: "+c.blend_type),!1}m=x(c);l=M(c);break;case "OUTPUT":m=x(c);l=[];break;case "RGB":t=p(c,"Color");l.push(t);r.push(q(A("param_RGB_Color"),t.nb,3));break;case "SEPRGB":case "SEPHSV":m=x(c);l=M(c);break;case "TEXTURE":if(!c.texture)return X.error("No texture attached to node: "+c.name),!1;a:{h=c.outputs;v=!1;for(t=0;t<h.length;t++)if(s=h[t],s.is_linked)switch(s.identifier){case "Color":h="ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":
"TEXTURE_COLOR";break a;case "Normal":h="TEXTURE_NORMAL";break a;case "Value":v=!0;break;default:throw"Unknown texture output";}h=v?"ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}m.push(w(c,"Vector"));if("TEXTURE_COLOR"==h||"TEXTURE_ENVIRONMENT"==h)l.push(p(c,"Color")),l.push(p(c,"Value"));"TEXTURE_NORMAL"==h&&(l.push(p(c,"Normal")),l.push(p(c,"Value")));s=A("param_TEXTURE_texture");r.push(q(s));v={name:s,value:c.texture};break;case "VALUE":a:if(f){if(h=f.action)for(t in I=
h.d.B,I)if(I=t.match(/"(.*?)"/)[1],I==c.name){s=h.name+"_"+t;break a}s=f.nla_tracks;for(z=0;z<s.length;z++)for(n=s[z].strips,G=0;G<s[z].strips.length;G++)for(t in h=n[G].action,I=h.d.B,I)if(I=t.match(/"(.*?)"/)[1],I==c.name){s=h.name+"_"+t;break a}s=void 0}else s=null;t=p(c,"Value");s?(h="ANIM_VALUE",z={name:A("param_ANIM_VALUE_Value"),value:"0"},r.push(z),z={name:"-1",value:s},r.push(z)):(h="VALUE",r.push(q(A("param_value_value"),t.nb,1)));l.push(t);break;case "VECT_MATH":switch(c.operation){case "ADD":h=
"VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return X.error("Unsupported VECT_MATH operation: "+c.operation),!1}m=x(c);l=M(c);break;default:m=x(c),l=M(c)}g={name:g,type:h,li:k,C:m,Pa:l,B:r,data:v};N.qk(a,N.Io(a),g);if(g="GEOMETRY"==c.type)a:{g=c.outputs;for(r=k=0;r<g.length;r++)if(g[r].is_linked&&
k++>e){g=!0;break a}g=!1}return g&&!d(a,c,++e,f)?!1:!0}function C(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?Q.gh(a):a}function A(a){z[a]||(z[a]=0);var b=a+z[a],b=b.replace(/ /g,"_").replace(/\//g,"_");z[a]++;return b}function u(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";
case "Global":return"GEOMETRY_GL";default:return null}}}function w(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return I(e)}return null}function p(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return I(e)}return null}function I(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=Q.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,td:d,nb:a}}function H(a,b,c){return{name:a,identifier:b,td:!1,nb:c}}function x(a){for(var b=[],
c=0;c<a.inputs.length;c++){var d=I(a.inputs[c]);d.nb.length&&d.nb.splice(3);b.push(d)}return b}function M(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=I(a.outputs[c]);b.push(d)}return b}function q(a,b,c){b=null===b||void 0===b?null:ca.u(b,c);if(fa.hm&&b){c=["param_MAPPING_HEAVY_trs_matrix","param_MAPPING_LIGHT_min_clip","param_MAPPING_LIGHT_max_clip","param_MAPPING_HEAVY_use_min","param_MAPPING_HEAVY_use_max"];for(var d=!1,e=0;e<c.length;e++)if(0<=a.indexOf(c[e])){d=!0;break}d&&(b=G(b))}return{name:a,
value:b}}function G(a){a=a.replace(/(,)/g,"$1 ");a=a.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3");a=a.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3");return a=a.replace(/\s+/g,"")}function D(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function V(a){var b=[];N.K(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function O(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Vw,f=c[d].data.Ww;if(!e)return!1;N.K(e,function(b,
c){N.qk(a,N.Io(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);R(c[d],b,a)}return!0}function U(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function T(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=
0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function L(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function P(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,k=0;k<c.C.length;k++)if(f.from_socket.identifier==c.C[k].identifier){g=c.C[k].nb;break}for(var k=f,m=b,l=g,q=h(k.to_node,m),p=0;p<q.length;p++)for(var r=N.Da(m,q[p]),v=0;v<r.C.length;v++)if(r.C[v].identifier==k.to_socket.identifier){r.C[v].nb=l;break}f=a.indexOf(f);-1!=
f&&a.splice(f,1)}}function R(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var m=b[k];U(m.from_node,d,m,e,g,h);U(m.to_node,d,m,f,g,h)}f=T(b,f,g);e=T(b,h,e);L(b,f);P(b,c,a,f);if(e.length){var l;N.K(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(l=b)});P(b,c,l,e)}}var X=n("__print"),N=n("__graph"),ca=n("__shaders"),Q=n("__util"),ia=n("__config"),F=n("vec3"),ga=n("mat3"),S=n("mat4"),z={},J={},ja={},na=0,fa=ia.n;a.Wt=b;a.Xt=function(a){var b=[],c={};z={};var d=N.er(a);
N.K(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],m=[],l=0;l<d.C.length;l++){var q=d.C[l];if(q.td)e.push(null),f.push(null);else{e.push(A("in_"+d.type+"_"+q.identifier));var p=ca.u(q.nb,0);fa.hm&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==q.identifier||"Color2"==q.identifier||"Fac"==q.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==q.identifier||"Value_001"==q.identifier))&&(p=G(p));f.push(p)}}for(l=0;l<d.Pa.length;l++)q=d.Pa[l],q.td?g.push(null):g.push(A("out_"+d.type+"_"+q.identifier));
for(l=0;l<d.B.length;l++)q=d.B[l],h.push(q.name),k.push(q.value);for(l=0;l<d.li.length;l++)m.push(d.li[l].name);e={id:d.type,C:e,mp:f,Pa:g,B:h,yj:k,li:m};b.push(e);c[a]=e});N.ue(d,function(a,b,e){var f=N.Da(d,a);N.Da(d,b);var g=f.Pa[e[0]];a=c[a].Pa;b=c[b].C;f=a[e[0]]||A("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in J)delete J[a];for(var b in ja)delete ja[b];na=0}};b4w.module.__animation=function(a,n){function b(a,b){var c=a.w[b];c&&c.al&&c.ph&&(c.ph=!1,c.al(a))}function c(a,b,c){c=a.w[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.Qb=d;c.bd=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.rr=d}function g(a,b,c){a=a.w[c];a.type=50;a.bd=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Lc=b}function f(a){return a.replace(/_B4W_BAKED$/,"")}function l(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:N.ea("Wrong animation behavior")}}function h(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&b.push(d.action))}return b}function k(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function e(a,
b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function r(a,c,d){C(a,c,d);b(a,d);a.d.Jd&&(w(a,c),u(a,c))}function v(a,b,c){var e=b.frame_range,f=b.d,g=a.w[c];g.bd=b.name;g.cn=e;g.Ys=f.cx;g.Ws=f.yt;g.start=e[0];g.length=e[1]-e[0];g.Qb=e[0];e=N.Ze(f.Di);if(N.df(a)&&e){g.type=10;var h=m(a,b);h||(h=p(a,b,y(a)),a.Zg.push(b,h));g.e=h.e;g.la=h.la;var g=a.d,h=g.Mj,k=a.w[c],f=k.jm,l;a:{l=g.Iq;for(var q=0;q<l.length;q+=2)if(b==l[q]){l=l[q+1];break a}l=null}if(l)k.jm=l;else{for(k=0;k<h.length;k++)l=
p(a,b,h[k].gc),f.push(l);g.Iq.push(b,f)}g.Jd&&(b=g.Vj,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),t(a))}else if(P.be(a)&&(f.B.volume||f.B.pitch))g.volume=f.B.volume||null,g.pitch=f.B.pitch||null,g.type=40;else if("MESH"==a.type&&d(b)){g.type=70;f=m(a,b);if(!f){f=[];k=[];l=b.d;q=a.d.Gh;for(h in l.B)for(var r=b.name+"_"+h,v=0;v<q.length;v+=2)if(r==q[v]){f.push(q[v+1]);k.push(l.B[h]);break}f={fz:f,gz:k};a.Zg.push(b,f)}g.Ip=f.fz;g.Jp=f.gz}else if(h=f.B.tsr){g.type=20;f=m(a,b);if(!f){f=b.d.Mp;
k=[];l=[];for(q=0;q<f;q++)k.push(h.subarray(8*q,8*q+4)),l.push(h.subarray(8*q+4,8*q+8));f={e:k,la:l};a.Zg.push(b,f)}g.e=f.e;g.la=f.la;O.ig(a)&&O.$y(a,g.e,g.la)}else T.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),g.type=60;N.df(a)&&!e&&s(a,c)}function m(a,b){for(var c=a.Zg,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function t(a){var b=a.d.Vj;if(-1!=b[0]&&-1!=b[1]){var c=a.w;a=c[b[1]].Qb;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Qb;d=Math.floor(a);
b.Qb=d+e}}function s(a,b){var c=a.d.Vj,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.w;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function y(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={An:d,mh:d,Xl:N.nl(a,"name",e),tr:-1}}return c}function d(a){a=a.d;for(var b in a.B)if(-1!=b.indexOf("nodes"))return!0;return!1}function C(a,b,c){if((c=a.w[c])&&(c.play||0==b)){var d=a.d,e=c.Qb,f=c.start,g=c.length,e=e+c.speed*b*
Q.wa,h=c.type,k=c.speed;if(0<=k&&e>=f+g||0>k&&e<f)switch(c.ph=!0,c.behavior){case 10:e=0<=k?(e-f)%g+f:f+g-1E-6;break;case 20:e=0<=k?f:f+g-1E-6;c.play=!1;break;case 30:e=0<=k?f+g-1E-6:f,c.play=!1}c.Qb=e;switch(h){case 10:if(!d.Jd){e=A(c,e,ia);b=e[0];f=e[1];e=e[2];d.Vb=c.la[b];d.Ub=c.la[f];d.dc=c.e[b];d.cc=c.e[f];d.We=e;d=d.Mj;c=c.jm;for(g=0;g<d.length;g++)h=d[g],k=c[g],h.Vb=k.la[b],h.Ub=k.la[f],h.dc=k.e[b],h.cc=k.e[f],h.We=e;R.v(a)}break;case 20:h=e=A(c,e,ia);(d=F)||(d=new Float32Array(4));var f=h[0],
g=h[1],h=h[2],k=c.e,l=k[f][1],m=k[f][2],q=k[g][1],p=k[g][2];d[0]=(1-h)*k[f][0]+h*k[g][0];d[1]=(1-h)*l+h*q;d[2]=(1-h)*m+h*p;f=e;(g=S)||(g=new Float32Array(4));h=c.la;ca.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];h=c.e;e=(1-g)*h[e[0]][3]+g*h[e[1]][3];c.Am&&(g=ga,R.get_translation(a,g),N.smooth_v(d,g,b,c.Am,d));c.Zl&&(g=z,R.get_rotation(a,g),N.Kq(f,g,b,c.Zl,f));R.set_translation(a,d);R.set_rotation(a,f);R.set_scale(a,e);R.v(a);U.sync_transform(a);break;case 30:(a=ia)||(a=Array(3));
f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=b-=1,f=1);c=c.rr;a[0]=b+c;a[1]=e+c;a[2]=f;e=ia;d.Fm=e[0];d.qr=e[2];break;case 40:e=A(c,e,ia);b=e[0];d=e[1];e=e[2];c.volume&&P.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&P.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:O.Tx(c.Lc,e/Q.wa);break;case 70:e=A(c,e,ia);b=e[0];d=e[1];e=e[2];f=c.Jp;c=c.Ip;for(g=0;g<c.length;g++)h=f[g],a.d.pf[c[g]]=(1-e)*h[b]+e*h[d];break;case 60:break;
default:throw"Unknown animation type:"+h;}}}function A(a,b,c){c||(c=Array(3));var d=a.cn[0],e=a.cn[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Ys;e=Math.floor(b);a=a.Ws[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function u(a,b){var c=a.d,d=c.Id,e=c.Vj,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.w[f];if(g.play||0==b)var h=A(g,g.Qb,ia),k=h[0],l=h[1],h=h[2],m=g.la[k],q=g.la[l],k=g.e[k],l=g.e[l];else d=1}else d=1;e=a.w[e];if(e.play||0==b)var h=A(e,e.Qb,ia),p=h[0],r=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;
f=e.la[p];g=e.la[r];p=e.e[p];e=e.e[r];if(1==d)c.Vb.set(f),c.Ub.set(g),c.dc.set(p),c.cc.set(e);else if(0==d)c.Vb.set(m),c.Ub.set(q),c.dc.set(k),c.cc.set(l);else{for(r=0;r<m.length;r+=4){for(var v=S,s=z,t=0;4>t;t++)v[t]=m[r+t],s[t]=f[r+t];ca.slerp(v,s,d,v);for(t=0;4>t;t++)c.Vb[r+t]=v[t];for(t=0;4>t;t++)v[t]=q[r+t],s[t]=g[r+t];ca.slerp(v,s,d,v);for(t=0;4>t;t++)c.Ub[r+t]=v[t]}N.wn(k,p,d,c.dc);N.wn(l,e,d,c.cc)}d=c.Mj;m=c.Ep;for(r=0;r<d.length;r++){q=d[r];k=m[r];for(l=0;l<k.length;l+=2)for(p=k[l],f=k[l+
1],g=0;4>g;g++)q.Vb[p+g]=c.Vb[f+g],q.Ub[p+g]=c.Ub[f+g],q.dc[p+g]=c.dc[f+g],q.cc[p+g]=c.cc[f+g];q.We=h}}}function w(a,b){var c=a.d,d=c.Id,e=c.pk;if(0!=e){var d=c.ok-d,f=e*b;N.sign(d)==N.sign(e)&&Math.abs(f)<Math.abs(d)?c.Id+=f:(c.Id=c.ok,c.pk=0)}}function p(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.Mp,h=0;h<g;h++){for(var k=0;k<d.length;k++){var l=d[k],m=X.create(),q=b.d.Di[l.name];q&&X.copy(q.subarray(8*h,8*h+8),m);l.an=m;l.ti=!1}k=I(a,c);e.push(k.e);f.push(k.la)}return{e:e,la:f}}function I(a,
b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],l=k.mh,m=e[k.Xl],k=f,q=g,p=m.Os,r=p[p.length-1],v=r.lk;r.ti||X.identity(v);for(r=p.length-1;0<=r;r--){var m=p[r],t=m.lk;if(m.ti)v=t;else{var s=m.bn,z=m.an;X.invert(s,J);X.multiply(z,J,J);X.multiply(s,J,J);X.multiply(v,J,t);v=t;m.ti=!0}}m=m.lk;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];q[0]=m[4];q[1]=m[5];q[2]=m[6];q[3]=m[7];ca.normalize(q,q);for(k=0;4>k;k++)q=4*l+k,c[q]=f[k],d[q]=g[k]}c=new Float32Array(c);
d=new Float32Array(d);return{e:c,la:d}}function H(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=x(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?H(a,h,c,d,e,f,g):H(h,b,c,d,e,f,g)}function x(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function M(a,b){a.w||(a.w=[null,null,null,null,null,null,null,null]);a.w[b]={type:null,bd:null,la:null,e:null,jm:[],play:!1,behavior:20,Qb:0,start:0,length:0,Am:0,Zl:0,ph:!1,rr:null,speed:1,volume:null,pitch:null,Jp:[],Ip:[]};a.Zg=a.Zg||[];-1==ja.indexOf(a)&&ja.push(a)}
function q(a,b){R.v(a);U.sync_transform(a);r(a,0,b)}function G(a,b,d){d=d||0;if(N.uc(a)){var e=N.keysearch("name",b,a.data.b4w_vertex_anim);if(e)return M(a,d),c(a,e,d),q(a,d),1;if((e=N.keysearch("name",b,a.particle_systems))&&"EMITTER"==e.settings.type)return M(a,d),g(a,e,d),q(a,d),1}if(e=N.keysearch("name",b,na)||N.keysearch("name",b+"_B4W_BAKED",na)){if(!N.Ze(e.fcurves))return T.error('No fcurves in action "'+e.name+'"'),0;M(a,d);v(a,e,d);q(a,d);return 1}T.error('Unsupported object: "',a.name,'" or animation name: "',
b,'"');return 0}function D(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var V=n("__config"),O=n("__particles"),U=n("__physics"),T=n("__print"),L=n("__scenes"),P=n("__sfx"),R=n("__transform"),X=n("__tsr"),N=n("__util");n("mat4");var ca=n("quat");n("vec4");var Q=V.Ld;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=
40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ia=Array(3),F=new Float32Array(3),ga=new Float32Array(3),S=new Float32Array(4),z=new Float32Array(4),J=new Float32Array(8);new Float32Array(16);var ja=[],na=[];a.frame_to_sec=function(a){return a/Q.wa};a.update=function(a){for(var c=0;c<ja.length;c++){for(var d=
ja[c],e=0;8>e;e++)C(d,a,e);d.d.Jd&&(w(d,a),u(d,a))}for(c=0;c<ja.length;c++)for(d=ja[c],e=0;8>e&&d.w;e++)b(d,e)};a.Cv=function(){return na};a.Ov=function(a,b){var c=a.w[b];return c&&c.bd?f(c.bd):null};a.get_anim_names=function(a){var b=[];if(N.uc(a)&&a.d.ji)for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var e,c=[];for(e=0;e<na.length;e++){var g=na[e],k=g.d;N.Ze(g.d.Di)?"ARMATURE"==a.type&&c.push(g):k.B.volume||k.B.pitch?P.be(a)&&c.push(g):d(g)||c.push(g)}"MESH"==
a.type&&(c=c.concat(h(a)));e=c;for(c=0;c<e.length;c++)b.push(f(e[c].name));if(O.ig(a)&&O.aj(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.sy=f;a.get_anim_type=function(a,b){var c=a.w[b];return c?c.type:null};a.apply_def=function(a){var b=0,d;d=[];var e=a.animation_data;if(e&&e.action){var f=N.Ze(e.action.d.Di);"ARMATURE"!=a.type&&f||d.push(e.action)}P.be(a)&&a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);"MESH"==
a.type&&(d=d.concat(h(a)));for(e=0;e<d.length;e++)f=d[e],N.Ze(f.fcurves)?(M(a,b),v(a,f,b),q(a,b),a.w[b].behavior=l(a.b4w_anim_behavior),b++):T.error('No fcurves in action "'+f.name+'"');f=a.particle_systems;for(e=0;e<f.length;e++){var k=f[e],m=k.settings;"EMITTER"==m.type&&(M(a,b),g(a,k,b),q(a,b),a.w[b].behavior=l(a.b4w_anim_behavior),m.b4w_cyclic&&(a.w[b].behavior=10),b++)}N.uc(a)&&a.d.ji?(M(a,b),c(a,a.data.b4w_vertex_anim[0],b),q(a,b),a.w[b].behavior=l(a.b4w_anim_behavior)):d.length||O.aj(a)||(M(a,
0),d=a.w[0],d.type=60,d.bd=a.name+"_STATIC",e=L.Vv(L.get_active()),d.start=e[0],d.length=e[1]-e[0]+1,q(a,b))};a.get_first_armature_object=k;a.play=function(a,b,c){e(a.w,c,function(a){a.play=!0;a.al=b?b:null;a.ph=!1});a.d.Jd&&t(a)};a.stop=function(a,b){e(a.w,b,function(a){a.play=!1;a.al=null;a.ph=!1})};a.is_play=function(a,b){var c=a.w[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.w;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Qb=b,r(a,0,c))}else if(e=d[c])e.Qb=b,r(a,0,c)};
a.get_current_frame_float=function(a,b){var c=a.w[b];return c&&c.Qb?c.Qb:0};a.is_cyclic=function(a,b){var c=a.w[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){e(a.w,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.w[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){e(a.w,d,function(a){a.Am=b||0;a.Zl=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.w[c]=null;else a.w[b]=null;a.d.Jd&&s(a,b)};a.update_object_animation=r;a.dj=function(a){if("ARMATURE"==
a.type||k(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||O.ig(a)&&O.aj(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||D(a)?!0:!1};a.is_animated=function(a){return a.w?!0:!1};a.Et=y;a.Dn=I;a.$s=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);ca.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?
3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else-1<c.indexOf("location")?(c="tsr",h=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",h=g):-1<c.indexOf("scale")?(c="tsr",h=g):h=0;if(!a[c]){b=a;var k=c;if("object"==typeof h&&h.length)for(var m=h.length,l=new Float32Array(e*m),q=0;q<e;q++)for(var p=0;p<m;p++)l[q*m+p]=h[p];else if("number"==typeof h)for(l=new Float32Array(e),q=0;q<e;q++)l[q]=h;else throw"Wrong storage default value";b[k]=l}return a[c]}a.d={};
var e=a.d;e.cx=1/Q.Xe;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=X.create(),h=a.fcurves,k={},m={},l=0,q;for(q in h){var p=h[q],r;for(r in p){var v=p[r].Ob;l||(l=v.length);for(var t=d(k,m,q,l),s=t.length/l,z=c(q,r|0),n=0;n<l;n++)t[n*s+z]=v[n]}}for(var w in k)"tsr"==w&&b(k[w],l);for(var D in m)b(m[D],l);e.B=k;e.Di=m;e.yt=a.Ns;e.Mp=l;na.push(a)};a.Gv=function(a,b){return(b-a)*Q.Xe+1};a.qt=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),m=new Float32Array(2),l=new Float32Array(2),q=new Float32Array(2),
p=b[1],r=b[2],v=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var t=0,s=0,z=null;e<=f;e++)if(e<p)for(var n=0;n<Q.Xe;n++)c[t++]=r;else if(e>v)for(n=0;n<Q.Xe;n++)c[t++]=a;else{var w=b[s],D=3;0===w&&(D+=2);0===z&&(D+=2);var u=2===w?0:1;if(b[s+1]==b[s+D+1])z=w,s+=D;else{n=0;e==b[s+1]&&(u&&(d[t]=1),c[t]=b[s+2],t++,n++);if(e==v)for(;n<Q.Xe;n++)c[t++]=a;else for(k[0]=b[s+1],k[1]=b[s+2],0!==w?(m[0]=0,m[1]=0):0===z?(m[0]=b[s+5],m[1]=b[s+6]):(m[0]=b[s+3],m[1]=b[s+4]),0!==w?(l[0]=0,l[1]=0):(l[0]=b[s+
D+3],l[1]=b[s+D+4]),q[0]=b[s+D+1],q[1]=b[s+D+2];n<Q.Xe;n++){var y=e+n/Q.Xe;switch(w){case 0:g=k;h=m;var S=l,J=q,G=[],A=[],C=void 0,I=void 0,O=void 0,C=void 0;G[0]=g[0]-h[0];G[1]=g[1]-h[1];A[0]=J[0]-S[0];A[1]=J[1]-S[1];O=J[0]-g[0];C=Math.abs(G[0]);I=Math.abs(A[0]);0!=C+I&&C+I>O&&(C=O/(C+I),h[0]=g[0]-C*G[0],h[1]=g[1]-C*G[1],S[0]=J[0]-C*A[0],S[1]=J[1]-C*A[1]);u&&(d[t]=1);c[t]=x(H(0,1,y,k[0],m[0],l[0],q[0]),k[1],m[1],l[1],q[1]);t++;break;case 1:h=k[0];S=k[1];g=J=(q[1]-S)/(q[0]-h);h=S-J*h;u&&(d[t]=1);
c[t]=g*y+h;t++;break;case 2:u&&(d[t]=1);c[t]=b[s+2];t++;break;default:throw"Unknown keyframe intepolation mode: "+w;}}e+1==b[s+D+1]&&(z=w,s+=D)}}};a.uA=function(a){for(var b=0;b<a.length;b++)if(a[b].Lz)return a[b];return!1};a.apply=G;a.get_slot_num_by_anim=function(a,b){for(var c=a.w,d=0;d<c.length;d++){var e=c[d];if(e&&f(e.bd)==f(b))return d}return-1};a.Ev=function(a,b){var c=a.w[b];return c&&c.bd?f(c.bd):null};a.remove=function(a){a.w=null;a=ja.indexOf(a);-1!=a&&ja.splice(a,1)};a.rx=function(a){for(var b=
na.length-1;0<=b;b--)na[b].Ps==a&&na.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.w)return G(a,b,0)?0:-1;for(var c=0;c<a.w.length;c++)if(!a.w[c])return G(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.pk=(b-a.d.Id)/c;a.d.ok=b};a.set_speed=function(a,b,c){e(a.w,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.w[b].speed};a.get_anim_start_frame=function(a,b){return a.w[b].start};a.get_anim_length=function(a,b){return a.w[b].length};a.ql=D;a.cleanup=function(){ja.length=
0;na.length=0};a.gv=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Ob.length,e=S,f=F,g=Boolean(c[0]);g||(c[0]={Ob:new Float32Array(d)});var h=Boolean(c[1]);h||(c[1]={Ob:new Float32Array(d)});var k=Boolean(c[2]);k||(c[2]={Ob:new Float32Array(d)});c[3]={Ob:new Float32Array(d)};for(var m=0;m<d;m++)f[0]=g?c[0].Ob[m]:0,f[1]=h?c[1].Ob[m]:0,f[2]=k?c[2].Ob[m]:0,N.euler_to_quat(f,e),c[0].Ob[m]=e[3],c[1].Ob[m]=e[0],c[2].Ob[m]=e[1],c[3].Ob[m]=e[2];d=b.replace("euler","quaternion");a[d]=c;delete a[b]}};b4w.module.__transform=function(a,n){function b(a){var d=a.d;f.Ry(a,u);g.Py(a);"CAMERA"==a.type&&g.Ut(a);var m=d.e,t=d.scale,s=d.quat;r.ai(m,t,s,d.Vc);var n=d.H;y.identity(n);y.fromQuat(s,n);"CAMERA"!=a.type&&v.Bx(n,t,n);n[12]=m[0];n[13]=m[1];n[14]=m[2];y.invert(n,d.np);a.w&&h.aj(a)&&h.Sy(a);d.Eb&&d.Ia&&(c.yk(d.Eb,n,d.Ia),c.Ak(d.tc,n,d.kb),c.zk(d.Le,d.Vc,d.Me),d.Mb&&k.fm(k.get_active()));switch(a.type){case "SPEAKER":e.ky(a,u);break;case "CAMERA":g.jr(a);k.W()&&e.Fw(k.get_active(),m,s,u);break;case "LAMP":l.Uy(a);
k.W()&&k.Zj(a,k.get_active());break;case "EMPTY":a.field&&k.lr(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!k.W()||(d=k.get_active(),k.fm(d),k.Fx(d));a=a.Hd;for(d=0;d<a.length;d++)b(a[d])}var c=n("__boundings"),g=n("__camera"),f=n("__constraints"),l=n("__lights"),h=n("__particles"),k=n("__scenes"),e=n("__sfx"),r=n("__tsr"),v=n("__util"),m=n("vec3"),t=n("quat"),s=n("mat3"),y=n("mat4"),d=new Float32Array(3),C=new Float32Array(4),A=new Float32Array(9),u=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){u=
a};a.set_translation=function(a,b){f.rd(a)==f.$c?r.Ux(b,f.qd(a)):a.d.e.set(b)};a.get_translation=function(a,b){f.rd(a)==f.$c?m.copy(r.Wo(f.qd(a)),b):m.copy(a.d.e,b)};a.set_rotation=function(a,b){f.rd(a)==f.$c?r.gm(b,f.qd(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){f.rd(a)==f.$c?t.copy(r.Ro(f.qd(a)),b):t.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(f.rd(a)==f.$c){var c=v.euler_to_quat(b,C);r.gm(c,f.qd(a))}else v.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){f.rd(a)==f.$c?r.set_scale(b,
f.qd(a)):a.d.scale=b};a.get_scale=function(a){return f.rd(a)==f.$c?r.get_scale(f.qd(a)):a.d.scale};a.aw=function(a,b){if(f.rd(a)==f.$c)r.copy(f.qd(a),b);else{var c=a.d;r.ai(c.e,c.scale,c.quat,b)}};a.Dq=function(a,b){if(f.rd(a)==f.$c)r.copy(b,f.qd(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),
b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,m.copy(b.kb.t,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,m.transformMat4(c,b.H,c));return c};a.move_local=function(a,b,c,e){a=a.d;d[0]=b;d[1]=c;d[2]=e;b=s.fromMat4(a.H,A);m.transformMat3(d,b,d);m.add(a.e,d,a.e)};a.v=b;a.distance=function(a,b){return m.dist(a.d.e,b.d.e)};a.$w=function(a,b){return m.dist(a.d.e,
b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Ia.max_x,min_x:a.d.Ia.min_x,max_y:a.d.Ia.max_y,min_y:a.d.Ia.min_y,max_z:a.d.Ia.max_z,min_z:a.d.Ia.min_z}}};b4w.module.__tsr=function(a,n){function b(a,b,c,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=b;f[4]=c[0];f[5]=c[1];f[6]=c[2];f[7]=c[3]}function c(a,b,c){var f=b[0],g=b[1],h=b[2],k=b[3],d=b[4],l=b[5],n=b[6];b=b[7];var u=a[0]*k,w=a[1]*k,p=a[2]*k;a=b*u+l*p-n*w;var k=b*w+n*u-d*p,I=b*p+d*w-l*u,u=-d*u-l*w-n*p;c[0]=a*b+u*-d+k*-n-I*-l;c[1]=k*b+u*-l+I*-d-a*-n;c[2]=I*b+u*-n+a*-l-k*-d;c[0]+=f;c[1]+=g;c[2]+=h;return c}var g=n("__util"),f=n("vec3"),l=n("quat");n("mat4");var h=new Float32Array(3),k=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.Vf=function(a,c,f,g){g||(g=new Float32Array(8));b(a,c,f,g);return g};a.ai=b;a.Ux=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Vx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.gm=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Wo=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.Ro=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var f=a[0],g=a[1],h=a[2];k[0]=a[4];k[1]=a[5];k[2]=a[6];k[3]=a[7];l.invert(k,k);var n=k[0],d=k[1],C=k[2],A=k[3],f=f*c,g=g*c,u=h*c,h=A*f+d*u-C*g,w=A*g+C*f-n*u,p=A*u+n*g-d*f,f=-n*f-d*g-C*u;b[0]=-(h*A+f*-n+w*-C-p*-d);b[1]=-(w*A+f*-d+p*-n-h*-C);b[2]=-(p*A+f*-C+h*-d-w*-n);b[3]=c;b[4]=n;b[5]=d;b[6]=C;b[7]=A;return b};a.Go=function(a,c){var f=g.of(a,h),l=g.mj(a),t=g.matrix_to_quat(a,
k);b(f,l,t,c);return c};a.multiply=function(a,b,f){c(b,a,f);f[3]=a[3]*b[3];var g=a[4],h=a[5],k=a[6];a=a[7];var l=b[4],d=b[5],n=b[6];b=b[7];f[4]=g*b+a*l+h*n-k*d;f[5]=h*b+a*d+k*l-g*n;f[6]=k*b+a*n+g*d-h*l;f[7]=a*b-g*l-h*d-k*n;return f};a.ei=c;a.Kg=function(a,b,c,f){f||(f=0);var g=a.length,h=b[0],k=b[1],d=b[2],l=b[3],n=b[4],u=b[5],w=b[6];b=b[7];for(var p=0;p<g;p+=3){var I=a[p]*l,H=a[p+1]*l,x=a[p+2]*l,M=b*I+u*x-w*H,q=b*H+w*I-n*x,G=b*x+n*H-u*I,I=-n*I-u*H-w*x;c[f+p]=M*b+I*-n+q*-w-G*-u;c[f+p+1]=q*b+I*-u+
G*-n-M*-w;c[f+p+2]=G*b+I*-w+M*-u-q*-n;c[f+p]+=h;c[f+p+1]+=k;c[f+p+2]+=d}};a.Uj=function(a,b,c,f){f||(f=0);var g=a.length,h=b[3],k=b[4],d=b[5],l=b[6];b=b[7];for(var n=0;n<g;n+=3){var u=a[n]*h,w=a[n+1]*h,p=a[n+2]*h,I=b*u+d*p-l*w,H=b*w+l*u-k*p,x=b*p+k*w-d*u,u=-k*u-d*w-l*p;c[f+n]=I*b+u*-k+H*-l-x*-d;c[f+n+1]=H*b+u*-d+x*-k-I*-l;c[f+n+2]=x*b+u*-l+I*-d-H*-k}};a.Tj=function(a,b,c){var f=b[3],g=b[4],h=b[5],k=b[6];b=b[7];var d=a[0]*f,l=a[1]*f,n=a[2]*f;a=b*d+h*n-k*l;var f=b*l+k*d-g*n,u=b*n+g*l-h*d,d=-g*d-h*l-
k*n;c[0]=a*b+d*-g+f*-k-u*-h;c[1]=f*b+d*-h+u*-g-a*-k;c[2]=u*b+d*-k+a*-h-f*-g};a.fr=function(a,b,c,f){f||(f=0);var g=a.length,h=b[3],k=b[4],d=b[5],l=b[6];b=b[7];for(var n=0;n<g;n+=4){var u=a[n]*h,w=a[n+1]*h,p=a[n+2]*h,I=b*u+d*p-l*w,H=b*w+l*u-k*p,x=b*p+k*w-d*u,u=-k*u-d*w-l*p;c[f+n]=I*b+u*-k+H*-l-x*-d;c[f+n+1]=H*b+u*-d+x*-k-I*-l;c[f+n+2]=x*b+u*-l+I*-d-H*-k;c[f+n+3]=a[n+3]}};a.translate=function(a,b,c){var f=a[3],g=a[4],h=a[5],k=a[6],d=a[7],l=b[0]*f,n=b[1]*f,u=b[2]*f;b=d*l+h*u-k*n;var f=d*n+k*l-g*u,w=
d*u+g*n-h*l,l=-g*l-h*n-k*u;c[0]=a[0]+b*d+l*-g+f*-k-w*-h;c[1]=a[1]+f*d+l*-h+w*-g-b*-k;c[2]=a[2]+w*d+l*-k+b*-h-f*-g;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.XA=function(a,b,c,g){g||(g=new Float32Array(8));f.lerp(a.subarray(0,3),b.subarray(0,3),c,g.subarray(0,3));var h=a[3];g[3]=h+c*(b[3]-h);l.slerp(a.subarray(4),b.subarray(4),c,g.subarray(4));return g};a.sA=function(a,b,c,f){f||(f=new Float32Array(8));var g=a.subarray(0,3),h=b.subarray(0,3),k=f.subarray(0,3);k[0]=h[0]*(c+1)-g[0]*
c;k[1]=h[1]*(c+1)-g[1]*c;k[2]=h[2]*(c+1)-g[2]*c;f[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);g=f.subarray(4);g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;l.normalize(g,g);return f};a.sw=function(a,b,c,f,g){var h=a.subarray(0,3),k=g.subarray(0,3);k[0]=h[0]+b*c[0];k[1]=h[1]+b*c[1];k[2]=h[2]+b*c[2];g[3]=a[3];a=a.subarray(4);g=g.subarray(4);c=f[0];h=f[1];f=f[2];var k=a[0],d=a[1],n=a[2],A=a[3];g[0]=.5*(c*A+h*n-f*d);g[1]=.5*(h*A+f*k-c*n);g[2]=.5*
(f*A+c*d-h*k);g[3]=.5*(-c*k-h*d-f*n);g[0]=a[0]+g[0]*b;g[1]=a[1]+g[1]*b;g[2]=a[2]+g[2]*b;g[3]=a[3]+g[3]*b;l.normalize(g,g)}};b4w.module.__util=function(a,n){function b(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function c(a,b){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:c(a[e],b);return d}function g(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function f(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return h(a,
c);case "string":return k(a,c);case "boolean":return h(a|0,c);case "function":case "undefined":return h(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=h(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var e in a)c=l(a[e],c)}else c=h(0,c)}return c}function h(a,b){var c=b;O[0]=a;c=(c<<5)-c+U[0];c&=c;c=(c<<5)-c+U[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function e(a){return(34*a+1)*a%289}function r(a){return a-Math.floor(a)}function v(a){return m((34*a+5)*a)}function m(a){return a-289*Math.floor(a/289)}function t(a){return a-7*Math.floor(a/7)}function s(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!y(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!y(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function y(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return s(a,b);default:return!0}}var d=n("__print"),C=n("vec3"),A=n("vec4"),u=n("quat"),w=n("mat3"),p=n("mat4"),I=0,H={},x=new Float32Array(3),M=new Float32Array(3),q=new Float32Array(4),G=new Float32Array(4),
D=new Float32Array(9),V=new Float32Array(16),O=new Float64Array(1),U=new Uint32Array(O.buffer),T=new Float32Array([0,0,0]),L=new Float32Array([0,0,0,1]),P=new Float32Array([0,0,0,1,0,0,0,1]),R=new Float32Array([1,0,0]),X=new Float32Array([0,1,0]),N=new Float32Array([0,0,1]),ca=new Float32Array([-1,0,0]),Q=new Float32Array([0,-1,0]),ia=new Float32Array([0,0,-1]),F=Math.floor(44488.07041494893);a.Ms=T;a.Hs=L;a.Iz=P;a.AXIS_X=R;a.AXIS_Y=X;a.AXIS_Z=N;a.AXIS_MX=ca;a.AXIS_MY=Q;a.AXIS_MZ=ia;a.keyfind=b;a.jv=
function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Ky=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Pt=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.rt=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.gB=function(a,b,c){for(var d=c.length,
e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.fB=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.nl=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.nt=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.bA=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;
return!0};a.tB=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.rB=function(a,c){var e=b("name",c,a);1<e.length&&d.error("obj_by_name(): name resolution ambiguity");return e};a.sB=function(a,c){var e=b("name",c,a),f=e.length;1<f&&d.error("obj_by_name(): name resolution ambiguity");if(0>=f)return[];for(var g=[],h=0;h<f;h++){var k=e[h];if("EMPTY"==k.type&&k.dupli_group)for(var k=k.dupli_group.objects,l=0;l<k.length;l++)g.push(k[l])}return e=e.concat(g)};a.Hy=
function(a,b,c,d){d||(d=new Float32Array(16));p.identity(d);d[12]=a;d[13]=b;d[14]=c};var ga=1;a.mx=function(){ga=(69069*ga+5)%Math.pow(2,32);return Math.round(ga/65536)%32768/32767};a.qy=function(a){ga=a};a.lc=function(a){var b=a[0]%F*48271-3399*Math.floor(a[0]/F);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.cj=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/
2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));C.transformQuat(b,a,c);return c};
a.oA=function(a,b,c){c||(c=new Float32Array(4));a=C.normalize(a,x);var d=C.dot(b,a);a=C.cross(b,a,M);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.Iy=function(a,b,c,d){d||(d=new Float32Array(4));C.transformQuat(c,b,d);d[3]=-C.dot(a,d)};a.Ru=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":x[0]=0;x[1]=-1;x[2]=0;C.transformQuat(x,b,x);M[0]=0;M[1]=0;M[2]=-1;break;case "MESH":x[0]=0;x[1]=0;x[2]=1;C.transformQuat(x,b,x);M[0]=
0;M[1]=0;M[2]=1;break;case "EMPTY":x[0]=0,x[1]=1,x[2]=0,C.transformQuat(x,b,x),M[0]=0,M[1]=1,M[2]=0}x[1]=0;C.normalize(x,x);a=C.dot(x,M);return Math.acos(a)*(0<-x[0]*M[2]?-1:1)};a.wn=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.KB=function(){I++;return I.toString(16)};a.Wj=function(a){H[a]||(H[a]=0);var b=a+H[a];H[a]++;return b};a.hd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.mb=function(a){var b=
{a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,D:0,Y:null,r:[],A:b}};a.kp=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};a.Pe=function(a){return JSON.parse(JSON.stringify(a))};a.dA=function(a,b){var d=[],e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return c(a,d)};a.ta=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?
new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ta(b[d]):b[d];return c};a.gh=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.uc=function(a){return"MESH"===a.type?!0:!1};a.qp=function(a){return"MESH"===
a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.ww=function(a){return"EMPTY"===a.type?!0:!1};a.df=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));w.fromMat4(a,D);var c=D[0],d=D[3],e=D[6],f=D[1],g=D[4],h=D[7],k=D[2],l=D[5],m=D[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+m*m)||1;D[0]/=c;D[3]/=c;D[6]/=c;D[1]/=f;D[4]/=f;D[7]/=f;D[2]/=k;D[5]/=k;D[8]/=k;u.fromMat3(D,b);return b};a.of=function(a,b){b||(b=new Float32Array(3));
b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.mj=function(a){q[0]=.577350269189626;q[1]=.577350269189626;q[2]=.577350269189626;q[3]=0;A.transformMat4(q,a,q);return A.length(q)};a.yo=function(a,b){var c=b.left,d=b.right,e=b.top,f=b.bottom,h=b.Ea,k=b.La;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];
h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];g(c);g(d);g(e);g(f);g(h);g(k)};a.ly=function(a,b,c){return c<-f(a,b.left)||c<-f(a,b.right)||c<-f(a,b.top)||c<-f(a,b.bottom)||c<-f(a,b.Ea)||c<-f(a,b.La)?!0:!1};a.Yu=function(a,b,c,d,e){g=C.dot(c,b.La);h=C.dot(d,b.La);k=C.dot(e,b.La);g=Math.sqrt(g*g+h*h+k*k);if(g<-f(a,b.Ea)||g<-f(a,b.La))return!0;var g=C.dot(c,b.left),h=C.dot(d,b.left),k=C.dot(e,b.left);if(Math.sqrt(g*g+h*
h+k*k)<-f(a,b.left))return!0;g=C.dot(c,b.right);h=C.dot(d,b.right);k=C.dot(e,b.right);if(Math.sqrt(g*g+h*h+k*k)<-f(a,b.right))return!0;g=C.dot(c,b.top);h=C.dot(d,b.top);k=C.dot(e,b.top);if(Math.sqrt(g*g+h*h+k*k)<-f(a,b.top))return!0;g=C.dot(c,b.bottom);h=C.dot(d,b.bottom);k=C.dot(e,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-f(a,b.bottom)?!0:!1};a.he=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*
k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.jz=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.Ey=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.hz=function(a,b,c){c||(c=new Float32Array(3));q[0]=a[0];q[1]=a[1];q[2]=a[2];
q[3]=0;A.transformMat4(q,b,q);c[0]=q[0];c[1]=q[1];c[2]=q[2]};a.vA=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.iz=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Bi=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Bi(b,
c,d,f-1):b[f]<c?a.Bi(b,c,f+1,e):f};a.Od=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Ji=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.Bx=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Bm=function(a,b,c,d){d||(d=new Float32Array(16));b=p.fromRotationTranslation(b,c,V);p.multiply(b,a,d)};a.ei=function(a,b,c,d,e){e||(e=new Float32Array(3));b=p.fromRotationTranslation(c,
d,V);C.transformMat4(a,b,e);return e};a.Cm=function(a,b,c,d){d||(d=new Float32Array(4));b=p.fromRotationTranslation(b,c,V);A.transformMat4(a,b,d)};a.YA=function(a,b,c,d,e){e||(e=new Float32Array(3));b=p.fromRotationTranslation(c,d,V);p.invert(b,b);C.transformMat4(a,b,e);return e};a.HB=function(a,b,c){c||(c=new Float32Array(16));p.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.pB=function(b,c,d){a.of(b,c);c[3]=a.mj(b);a.matrix_to_quat(b,d)};a.ln=function(a){for(var b=[],
c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.xq=function(a,b,c,d){d||(d=new Float32Array(3));C.subtract(b,a,x);C.transformQuat(x,c,x);C.subtract(b,x,d)};a.tv=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);p.lookAt(a,[-1,0,0],[0,-1,0],b);p.scale(b,[-1,1,1],b);p.scale(b,[-1,1,-1],c);p.lookAt(a,[0,0,-1],[0,-1,0],d);p.scale(d,[-1,1,1],d);p.scale(d,[-1,1,
-1],e);p.lookAt(a,[0,-1,0],[0,0,-1],g);p.scale(g,[1,1,-1],g);p.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.eh=function(a,b){return l(a,b)};a.hash_code=l;a.RA=k;a.oB=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,q,p,r,s,t,v;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];q=a[6];p=a[7];r=a[8];s=a[9];t=a[10];v=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=
k;c[4]=l;c[5]=m;c[6]=q;c[7]=p;c[8]=r;c[9]=s;c[10]=t;c[11]=v;c[12]=f*d+l*e+r*b+a[12];c[13]=g*d+m*e+s*b+a[13];c[14]=h*d+q*e+t*b+a[14];c[15]=k*d+p*e+v*b+a[15];return c};a.Kw=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):
(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.lx=function(a){return a*Math.PI/180};a.lA=function(a){return 180*a/Math.PI};a.nm=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),f=.211324865405187*c+.211324865405187*d,b=a[0]-c+f;a=a[1]-d+f;var g=b>a?1:0,h=1-g,f=b+.211324865405187-g,k=a+.211324865405187-h,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,q=e(e(d)+c),h=e(e(d+
h)+c+g),p=e(e(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(f*f+k*k),0),g=Math.max(.5-(l*l+m*m),0),s=2*r(.024390243902439*q)-1,t=2*r(.024390243902439*h)-1,v=2*r(.024390243902439*p)-1,q=Math.abs(s)-.5,h=Math.abs(t)-.5,p=Math.abs(v)-.5,s=s-Math.floor(s+.5),t=t-Math.floor(t+.5),v=v-Math.floor(v+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(s*s+q*q)),d=d*d*d*d*(1.79284291400159-.85373472095314*(t*t+h*h)),g=g*g*g*g*(1.79284291400159-.85373472095314*(v*v+p*p));return 130*(c*(s*b+q*a)+d*(t*f+h*
k)+g*(v*l+p*m))};a.In=function(a){var b=1/7,c=b/2,d=m(Math.floor(a[0])),e=m(Math.floor(a[1])),f=r(a[0]);a=r(a[1]);var g=f-.5,h=f-1.5,f=a-.5;a-=1.5;var k=v(d),l=v(d+1),q=k,d=l,k=v(k+e),l=v(l+e),q=v(q+e+1),d=v(d+e+1),e=g+.7*(t(k)*b+c),p=h+.7*(t(l)*b+c),g=g+.7*(t(q)*b+c),h=h+.7*(t(d)*b+c),k=f+.7*(t(Math.floor(k*b))*b+c),f=f+.7*(t(Math.floor(l*b))*b+c),q=a+.7*(t(Math.floor(q*b))*b+c),b=a+.7*(t(Math.floor(d*b))*b+c);return Math.min(e*e+k*k,p*p+f*f,g*g+q*q,h*h+b*b)};a.quat_project=function(a,b,c,d,e){e||
(e=new Float32Array(4));a=C.transformQuat(b,a,x);b=c[0];var f=c[1];c=c[2];D[0]=f*f+c*c;D[1]=-f*b;D[2]=-c*b;D[3]=-b*f;D[4]=b*b+c*c;D[5]=-c*f;D[6]=-b*c;D[7]=-f*c;D[8]=b*b+f*f;C.transformMat3(a,D,a);C.normalize(a,a);u.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=q,d=G,c=u.setAxisAngle([0,1,0],Math.PI,u.create()),d=u.setAxisAngle([1,0,0],Math.PI/2,u.create());u.multiply(c,d,c);u.multiply(a,c,b);return b};a.cleanup=function(){I=0;H={}};a.clamp=function(a,
b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Kq=function(a,b,c,d,e){e||(e=new Float32Array(a.length));u.slerp(a,b,Math.exp(-c/d),e)};a.ZA=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof
ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=w.fromQuat(a,D);M[0]=0;M[1]=1;M[2]=0;x[0]=c[3];x[1]=c[4];x[2]=c[5];var d=C.cross(M,x,x);C.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);M[0]=c[0];M[1]=c[1];M[2]=c[2];C.normalize(M,M);u.rotationTo(M,d,G);u.multiply(G,a,a)};a.Ko=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+
1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.Cf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.vq=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Yh=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.qv=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Ze=function(a){var b=0,c;
for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];C.normalize(c,c)};a.IB=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,q=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*q;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f;return c};a.ea=function(a){a&&d.error.apply(d,
arguments);throw"panic: see above for possible error messages";};a.Ge=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.ll=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Xq=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=s(e,f)}if(!d)return!1}return!0};a.kx=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.pv=function(a){a+=1;132651<a&&d.error("Color ID pool depleted");
var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){q.set(a);q[3]=b;G.set(d);G[3]=0;a=A.dot(q,G);if(0==a)return null;G.set(c);G[3]=1;a=-A.dot(q,G)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.fA=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.zq=function(a,b,c){var d=C.dot(a,b);-.9999999>d?(C.cross(R,a,x),1E-6>C.length(x)&&C.cross(X,a,x),C.normalize(x,x),u.setAxisAngle(x,Math.PI,c)):(C.cross(a,
b,x),c.set(x),c[3]=1+d,u.normalize(c,c));return c}};b4w.module.__sfx=function(a,n){function b(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;m.warn("B4W warning: deprecated WebAudio implementation");return null}m.warn("B4W warning: WebAudio is not supported");return null}function c(a,b,c){var e=a.g;if("NONE"!=e.behavior){c||(c=0);var g=e.loop,k=e.pitch;if(e.src&&(g||0<=c)){e.tk=Math.floor(5E4*Math.random());b=p.currentTime+b;e.Zb=b;e.state=20;var m=a.g;if(!m.Kb){var s=a.d.e,v=a.d.quat;if(y.qj){var n=p.createBiquadFilter();
n.type="peaking"}else n=null;var u=p.createGain();switch(m.behavior){case "POSITIONAL":var w=p.createPanner();w.panningModel=w.EQUALPOWER;w.distanceModel=w.INVERSE_DISTANCE;w.setPosition(s[0],s[1],s[2]);m.Bl.set(s);var x=d;t.quat_to_dir(v,t.AXIS_MY,x);w.setOrientation(x[0],x[1],x[2]);m.direction.set(x);w.refDistance=m.dist_ref;w.maxDistance=m.dist_max;w.rolloffFactor=m.attenuation;w.coneInnerAngle=m.Zt;w.coneOuterAngle=m.$t;w.coneOuterGain=m.au;x=p.createGain();x.gain.value=r(m);n?(w.connect(n),n.connect(x)):
w.connect(x);x.connect(u);m.Kb=w;if(m.Sg){var A=p.createGain();u.connect(A);A.connect(p?I.g.Kb:null)}else A=null,u.connect(p?I.g.Kb:null);break;case "BACKGROUND_SOUND":w=null;x=p.createGain();x.gain.value=r(m);n?(m.Kb=n,n.connect(x)):m.Kb=x;x.connect(u);m.Sg?(A=p.createGain(),u.connect(A),A.connect(p?I.g.Kb:null)):(A=null,u.connect(p?I.g.Kb:null));break;case "BACKGROUND_MUSIC":A=w=null,x=p.createGain(),x.gain.value=r(m),n?(m.Kb=n,n.connect(x)):m.Kb=x,x.connect(u),u.connect(p?I.g.Kb:null)}m.Kh=w;m.Jc=
n;m.dg=x;m.Ve=u;m.oq=A}if("POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior)a=p.createBufferSource(),a.buffer=e.src,a.playbackRate.value=k,g?(e.Ya&&e.Ya.disconnect(),a.loop=!0,a.start(b),e.duration=0):(g=a.buffer?a.buffer.duration:0,c>g?(g=b+c+e.nd,a.loop=!0,a.start(b),a.stop(g),e.duration=c):(a.loop=!1,a.start(b),e.duration=g)),a.connect(e.Kb),e.Ya=a,f(e),l(e);else if("BACKGROUND_MUSIC"==e.behavior){window.clearTimeout(e.un);c=a.g;if(g=c.src)g.volume=1,g.loop=c.cyclic,c.Ya=c.Ya||p.createMediaElementSource(g),
c.Ya.connect(c.Kb),20==c.state&&g.play();e.duration=1E6}h(e,b)}}}function g(a){var b=a.g,d=b.duration,b=b.delay+b.Pu*Math.random();c(a,b,d)}function f(a){a.Sg&&a.oq.gain.cancelScheduledValues(a.Zb);a.Ph&&a.Ya.playbackRate.cancelScheduledValues(a.Zb);a.ki=a.Zb}function l(a){if(a.Sg||a.Ph){var b=a.oq,c=a.Ya,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Zb;x[0]=a.tk;for(var f=0;5>f;){var g=a.pitch+a.Ph*t.lc(x);if(e>=a.ki){if(a.Sg){var h=1-t.clamp(a.Sg,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Ph&&
c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.ki=e-.001}}}function h(a,b){if(a.$k||a.nd){var c=a.Ve;c.gain.cancelScheduledValues(b);a.$k?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.$k)):c.gain.setValueAtTime(1,b);a.nd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.nd))}}function k(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.g;if(20==a.state||40==a.state){var b=a.Ve,c=p.currentTime;a.nd&&(b.gain.setValueAtTime(b.gain.value,
c),b.gain.linearRampToValueAtTime(0,c+a.nd));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.un=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.nd))}else b=a.Ya,a.duration<b.buffer.duration?a.nd&&20==a.state?b.stop(c+a.nd):20==a.state&&(b.stop(0),b.disconnect()):b.disconnect(),a.Zb=0,a.Vl=0,a.Bk=0;a.state=30}}function e(a){return!a.g||20!=a.g.state&&40!=a.g.state&&30!=a.g.state?!1:!0}function r(a){return a.muted?0:a.volume}var v=n("__config"),m=n("__print"),t=n("__util"),
s=n("vec3"),y=v.Bd;a.Om=10;a.fk=20;a.Nm=30;var d=new Float32Array(3),C=new Float32Array(3),A=new Float32Array(3),u=[],w=[],p=null,I=null,H=[],x=[1],M=null;a.init=function(){var a=document.createElement("audio"),c=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(u.push("ogg"),u.push("ogv")),""!=a.canPlayType("audio/mpeg")&&u.push("mp3"),""!=a.canPlayType("audio/mp4")&&(u.push("mp4"),u.push("m4v")),""!=a.canPlayType("audio/webm")&&u.push("webm"));c.canPlayType&&(""!=
c.canPlayType("video/ogg")&&w.push("ogv"),""!=c.canPlayType("video/mp4")&&w.push("m4v"),""!=c.canPlayType("video/webm")&&w.push("webm"));(p=y.pz?b():null)&&m.log("%cINIT WEBAUDIO: "+p.sampleRate+"Hz","color: #00a")};a.on=function(a){var b={lf:new Float32Array(3),Ap:new Float32Array(3),kg:new Float32Array(3)};a.g=b;if(p){var c=p.createGain(),d=p.createGain();b.dg=c;b.Ve=d;c.connect(d);d.connect(p.destination);if(a.b4w_enable_dynamic_compressor){var d=p.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;
d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.hh=d;b.Kb=d}else b.hh=null,b.Kb=c;c=p.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Ue=0}};a.Kx=function(a){I=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<u.indexOf(a)?a:"ogg"==a&&-1<u.indexOf("mp4")?"mp4":"mp3"==a&&-1<u.indexOf("ogg")?"ogg":"mp4"==a&&-1<u.indexOf("ogg")?"ogg":"ogv"==
a&&-1<u.indexOf("m4v")?"m4v":"webm"==a&&-1<u.indexOf("m4v")?"m4v":"m4v"==a&&-1<u.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<w.indexOf(a)?a:"ogv"==a&&-1<w.indexOf("m4v")?"m4v":"webm"==a&&-1<w.indexOf("m4v")?"m4v":"m4v"==a&&-1<w.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.g={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.g.behavior=p?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.g,d;p?(window.MediaElementAudioSourceNode?d=!0:(m.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.g.behavior="NONE");a.g.Su=b.b4w_disable_doppler;a.g.muted=b.muted;a.g.volume=b.volume;a.g.pitch=b.pitch;a.g.attenuation=b.attenuation;a.g.dist_ref=b.distance_reference;a.g.dist_max=b.distance_max||1E4;a.g.Zt=b.cone_angle_inner;a.g.$t=
b.cone_angle_outer;a.g.au=b.cone_volume_outer;a.g.cyclic=b.b4w_cyclic_play;a.g.loop=b.b4w_loop;a.g.delay=b.b4w_delay;a.g.Pu=b.b4w_delay_random;a.g.Sg=b.b4w_volume_random;a.g.Ph=b.b4w_pitch_random;a.g.$k=b.b4w_fade_in;a.g.nd=b.b4w_fade_out;a.g.Zb=0;a.g.Vl=0;a.g.Bk=0;a.g.duration=0;a.g.ki=0;a.g.tk=1;a.g.src=null;a.g.state=10;a.g.Bl=new Float32Array(3);a.g.direction=new Float32Array(3);a.g.pm=new Float32Array(3);a.g.un=null;a.g.Ue=0;H.push(a)};a.Lq=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";
switch(b.g.behavior){case "POSITIONAL":return a.fk;case "BACKGROUND_SOUND":return a.fk;case "BACKGROUND_MUSIC":return a.Nm;case "NONE":return a.Om;default:throw"Wrong speaker behavior";}};a.Zy=function(a,b){var c=a.g;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.dx=function(){var a=p.createBufferSource();a.buffer=p.createBuffer(1,22050,22050);a.connect(p.destination);a.start(0)};a.Mu=
function(a,b,c){p?p.decodeAudioData(a,b,c):c()};a.jy=function(a){k(a);delete a.g;H.splice(H.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<H.length;a++){var b=H[a].g;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Ya&&b.Ya.disconnect()}I&&I.g&&(a=I.g,a.lf[0]=0,a.lf[1]=0,a.lf[2]=0,a.kg[0]=0,a.kg[1]=0,a.kg[2]=0);I=null;H.splice(0);M=null};a.update=function(a){if(p&&0!=H.length){for(var b=0;b<H.length;b++){var c=H[b],d=c.g,e=p.currentTime;!d.loop&&d.cyclic&&20==d.state&&d.duration&&p&&d.Zb+
d.duration<e&&g(c);20==d.state&&3>d.ki-e&&l(d)}M&&(-1==M.xa||a>M.en+M.qo[M.xa])&&(b=M,-1<b.xa&&k(b.re[b.xa]),-1==b.xa&&b.random?c=Math.round(Math.random()*(b.re.length-1)):b.random?(c=1+Math.round(Math.random()*(b.re.length-2)),c=(b.xa+c)%b.re.length):c=(b.xa+1)%b.re.length,g(b.re[c]),b.xa=c,b.en=a)}};a.play=c;a.play_def=g;a.stop=k;a.is_play=function(a){return 20==a.g.state};a.playrate=function(a,b){var c=a.g;c.pitch=b;!e(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Ya.playbackRate.value=
b,f(c),l(c))};a.LA=function(a){return a.g.pitch};a.cyclic=function(a,b){a.g.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.g.cyclic};a.Fw=function(a,b,c,e){if(p&&a.g){var f=d;f[0]=0;f[1]=-1;f[2]=0;s.transformQuat(f,c,f);C[0]=0;C[1]=0;C[2]=-1;s.transformQuat(C,c,C);c=p.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],C[0],C[1],C[2]);a.g.Ap.set(f);e&&(A[0]=(b[0]-a.g.lf[0])/e,A[1]=(b[1]-a.g.lf[1])/e,A[2]=(b[2]-a.g.lf[2])/e,t.smooth_v(A,a.g.kg,e,.3,A),c.setVelocity(A[0],A[1],
A[2]),a.g.kg.set(A));a.g.lf.set(b)}};a.listener_reset_speed=function(a,b){if(p&&I.g){var c=d;b?c.set(b):c.set(I.g.Ap);s.scale(c,a,c);p.listener.setVelocity(c[0],c[1],c[2]);I.g.kg.set(c)}};a.ky=function(a,b){var c=a.g;if(e(a)&&"POSITIONAL"==c.behavior){var f=a.d.e,g=c.Kh;g.setPosition(f[0],f[1],f[2]);var h=d;t.quat_to_dir(a.d.quat,t.AXIS_MY,h);g.setOrientation(h[0],h[1],h[2]);h=c.Bl;!c.Su&&b&&(C[0]=(f[0]-h[0])/b,C[1]=(f[1]-h[1])/b,C[2]=(f[2]-h[2])/b,t.smooth_v(C,c.pm,b,.3,C),g.setVelocity(C[0],C[1],
C[2]),c.pm.set(C));h.set(f)}};a.speaker_reset_speed=function(a,b,c){var f=a.g;if(e(a)&&"POSITIONAL"==f.behavior){var g=d;c?g.set(c):g.set(f.direction);s.scale(g,b,g);f.Kh.setVelocity(g[0],g[1],g[2]);f.pm.set(g);f.Bl.set(a.d.e)}};a.be=function(a){return a.g?!0:!1};a.ol=function(a){return a.g.behavior};a.check_active_speakers=function(){for(var a=0;a<H.length;a++)if(e(H[a]))return!0;return!1};a.Qx=function(a){var b=I.g;b&&(b.volume=a,p&&(b.dg.gain.value=r(b)))};a.Tv=function(){var a=I.g;return a?a.volume:
0};a.set_volume=function(a,b){var c=a.g;c.volume=b;e(a)&&(c.dg.gain.value=r(c))};a.get_volume=function(a){return a.g.volume};a.mute=function(a,b){a.g.muted=Boolean(b);e(a)&&(a.g.dg.gain.value=r(a.g))};a.is_muted=function(a){return a.g.muted};a.Tw=function(a){var b=I.g;b&&(b.muted=Boolean(a),p&&(b.dg.gain.value=r(b)))};a.Bw=function(){var a=I.g;return a?a.muted:!1};a.get_speaker_objects=function(){return H};a.pause=function(){for(var a=0;a<H.length;a++){var b=H[a].g;if(20==b.state){if("BACKGROUND_MUSIC"==
b.behavior){var c=b.src;c&&c.pause()}else{var d=p.currentTime;b.Vl=d;if(d>b.Zb){c=b;x[0]=c.tk;for(var e=c.Ya.buffer.duration,g=c.Zb,h=void 0;g<d;)h=c.pitch+c.Ph*t.lc(x),g+=e/h;c=(e/h-(g-d))*h}else c=0;b.Bk=c;b.Ya.stop(0);b.Ya.disconnect();f(b)}b.state=40}}};a.resume=function(){for(var a=0;a<H.length;a++){var b=H[a],c=b.g;if(40==c.state){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b.g,d=p.createBufferSource();d.loop=b.Ya.loop;d.buffer=b.Ya.buffer;d.playbackRate.value=b.Ya.playbackRate.value;
b.Kh?d.connect(b.Kh):d.connect(b.dg);b.Ya=d;b=p.currentTime;c.Zb+=b-c.Vl;c.ki=b;c.Ya.start(c.Zb,c.Bk);l(c);h(c,c.Zb)}c.state=20}}};a.set_compressor_params=function(a,b){if(a.g&&a.g.hh){var c=a.g.hh;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.g||!a.g.hh)return null;a=a.g.hh;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.duck=function(a,b,c){if(e(a)){a=a.g;var d=a.Ve,f=p.currentTime;d.gain.setValueAtTime(d.gain.value,f);d.gain.linearRampToValueAtTime(b,f+c);a.Ue=c}};a.unduck=function(a){if(e(a)){a=a.g;var b=a.Ve,c=p.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ue);a.Ue=0}};a.Uu=function(a,b){if(p){var c=I.g,d=c.Ve,e=p.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Ue=b}};a.Ly=function(){if(p){var a=I.g,b=a.Ve,c=p.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Ue);a.Ue=0}};a.apply_playlist=function(a,b,c){M={xa:-1,en:0,random:c,re:[],qo:[]};for(c=0;c<a.length;c++){var d=a[c];k(d);M.re.push(d);d=d.g;d=(d=d.src)?d.duration:0;M.qo.push(d+b)}};a.clear_playlist=function(){if(M)for(var a=M.re,b=0;b<a.length;b++)k(a[b]);M=null};a.get_positional_params=function(a){return(a=a.g)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.g;
if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Kh;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.g;c&&c.Jc&&(c.Jc.frequency.value=b.freq,c.Jc.Q.value=b.Q,c.Jc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.g)&&a.Jc?{freq:a.Jc.frequency.value,Q:a.Jc.Q.value,gain:a.Jc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.g;if(!a||
!a.Jc)return null;a.Jc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new n(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new n(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,f){var l=new n(3);l[0]=a;l[1]=b;l[2]=f;return l};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,f,l){l[0]=a;l[1]=b;l[2]=f;return l};a.add=function(a,b,f){f[0]=a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];return f};
a.subtract=function(a,b,f){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];return f};a.sub=a.subtract;a.multiply=function(a,b,f){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];return f};a.mul=a.multiply;a.divide=function(a,b,f){f[0]=a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];return f};a.div=a.divide;a.min=function(a,b,f){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);return f};a.max=function(a,b,f){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);return f};
a.scale=function(a,b,f){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;return f};a.scaleAndAdd=function(a,b,f,l){l[0]=a[0]+b[0]*f;l[1]=a[1]+b[1]*f;l[2]=a[2]+b[2]*f;return l};a.distance=function(a,b){var f=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2];return Math.sqrt(f*f+l*l+h*h)};a.dist=a.distance;a.squaredDistance=function(a,b){var f=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2];return f*f+l*l+h*h};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],f=a[1];a=a[2];return Math.sqrt(b*b+f*f+a*a)};a.len=a.length;a.squaredLength=
function(a){var b=a[0],f=a[1];a=a[2];return b*b+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var f=a[0],l=a[1],h=a[2],f=f*f+l*l+h*h;0<f&&(f=1/Math.sqrt(f),b[0]=a[0]*f,b[1]=a[1]*f,b[2]=a[2]*f);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,f){var l=a[0],h=a[1];a=a[2];var k=b[0],e=b[1];b=b[2];f[0]=h*b-a*e;f[1]=
a*k-l*b;f[2]=l*e-h*k;return f};a.lerp=function(a,b,f,l){var h=a[0],k=a[1];a=a[2];l[0]=h+f*(b[0]-h);l[1]=k+f*(b[1]-k);l[2]=a+f*(b[2]-a);return l};a.random=function(a,g){a=a||1;var f=2*b()*Math.PI,l=2*b()-1,h=Math.sqrt(1-l*l)*a;g[0]=Math.cos(f)*h;g[1]=Math.sin(f)*h;g[2]=l*a;return g};a.transformMat4=function(a,b,f){var l=a[0],h=a[1];a=a[2];var k=b[3]*l+b[7]*h+b[11]*a+b[15],k=k||1;f[0]=(b[0]*l+b[4]*h+b[8]*a+b[12])/k;f[1]=(b[1]*l+b[5]*h+b[9]*a+b[13])/k;f[2]=(b[2]*l+b[6]*h+b[10]*a+b[14])/k;return f};a.transformMat3=
function(a,b,f){var l=a[0],h=a[1];a=a[2];f[0]=l*b[0]+h*b[3]+a*b[6];f[1]=l*b[1]+h*b[4]+a*b[7];f[2]=l*b[2]+h*b[5]+a*b[8];return f};a.transformQuat=function(a,b,f){var l=a[0],h=a[1],k=a[2];a=b[0];var e=b[1],r=b[2];b=b[3];var v=b*l+e*k-r*h,m=b*h+r*l-a*k,t=b*k+a*h-e*l,l=-a*l-e*h-r*k;f[0]=v*b+l*-a+m*-r-t*-e;f[1]=m*b+l*-e+t*-a-v*-r;f[2]=t*b+l*-r+v*-e-m*-a;return f};a.rotateX=function(a,b,f,l){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[0];k[1]=h[1]*Math.cos(f)-h[2]*Math.sin(f);k[2]=
h[1]*Math.sin(f)+h[2]*Math.cos(f);l[0]=k[0]+b[0];l[1]=k[1]+b[1];l[2]=k[2]+b[2];return l};a.rotateY=function(a,b,f,l){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[2]*Math.sin(f)+h[0]*Math.cos(f);k[1]=h[1];k[2]=h[2]*Math.cos(f)-h[0]*Math.sin(f);l[0]=k[0]+b[0];l[1]=k[1]+b[1];l[2]=k[2]+b[2];return l};a.rotateZ=function(a,b,f,l){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[0]*Math.cos(f)-h[1]*Math.sin(f);k[1]=h[0]*Math.sin(f)+h[1]*Math.cos(f);k[2]=h[2];l[0]=k[0]+
b[0];l[1]=k[1]+b[1];l[2]=k[2]+b[2];return l};a.forEach=function(){var b=a.create();return function(a,f,l,h,k,e){f||(f=3);l||(l=0);for(h=h?Math.min(h*f+l,a.length):a.length;l<h;l+=f)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],k(b,e,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new n(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new n(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,f,l){var h=new n(4);h[0]=a;h[1]=b;h[2]=f;h[3]=l;return h};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,f,l,h){h[0]=a;h[1]=b;h[2]=f;h[3]=l;return h};a.add=function(a,b,f){f[0]=
a[0]+b[0];f[1]=a[1]+b[1];f[2]=a[2]+b[2];f[3]=a[3]+b[3];return f};a.subtract=function(a,b,f){f[0]=a[0]-b[0];f[1]=a[1]-b[1];f[2]=a[2]-b[2];f[3]=a[3]-b[3];return f};a.sub=a.subtract;a.multiply=function(a,b,f){f[0]=a[0]*b[0];f[1]=a[1]*b[1];f[2]=a[2]*b[2];f[3]=a[3]*b[3];return f};a.mul=a.multiply;a.divide=function(a,b,f){f[0]=a[0]/b[0];f[1]=a[1]/b[1];f[2]=a[2]/b[2];f[3]=a[3]/b[3];return f};a.div=a.divide;a.min=function(a,b,f){f[0]=Math.min(a[0],b[0]);f[1]=Math.min(a[1],b[1]);f[2]=Math.min(a[2],b[2]);f[3]=
Math.min(a[3],b[3]);return f};a.max=function(a,b,f){f[0]=Math.max(a[0],b[0]);f[1]=Math.max(a[1],b[1]);f[2]=Math.max(a[2],b[2]);f[3]=Math.max(a[3],b[3]);return f};a.scale=function(a,b,f){f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;return f};a.scaleAndAdd=function(a,b,f,l){l[0]=a[0]+b[0]*f;l[1]=a[1]+b[1]*f;l[2]=a[2]+b[2]*f;l[3]=a[3]+b[3]*f;return l};a.distance=function(a,b){var f=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2],k=b[3]-a[3];return Math.sqrt(f*f+l*l+h*h+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,b){var f=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2],k=b[3]-a[3];return f*f+l*l+h*h+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],f=a[1],l=a[2];a=a[3];return Math.sqrt(b*b+f*f+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],f=a[1],l=a[2];a=a[3];return b*b+f*f+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var f=a[0],l=a[1],h=a[2],k=a[3],f=f*f+l*l+h*h+k*k;0<f&&(f=1/Math.sqrt(f),b[0]=a[0]*f,b[1]=a[1]*f,b[2]=a[2]*f,b[3]=a[3]*f);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,f,l){var h=a[0],k=a[1],e=a[2];a=a[3];l[0]=h+f*(b[0]-h);l[1]=k+f*(b[1]-k);l[2]=e+f*(b[2]-e);l[3]=a+f*(b[3]-a);return l};a.random=function(c,g){c=c||1;g[0]=b();g[1]=b();g[2]=b();g[3]=b();a.normalize(g,g);a.scale(g,c,g);return g};a.transformMat4=function(a,b,f){var l=a[0],
h=a[1],k=a[2];a=a[3];f[0]=b[0]*l+b[4]*h+b[8]*k+b[12]*a;f[1]=b[1]*l+b[5]*h+b[9]*k+b[13]*a;f[2]=b[2]*l+b[6]*h+b[10]*k+b[14]*a;f[3]=b[3]*l+b[7]*h+b[11]*k+b[15]*a;return f};a.transformQuat=function(a,b,f){var l=a[0],h=a[1],k=a[2];a=b[0];var e=b[1],r=b[2];b=b[3];var v=b*l+e*k-r*h,m=b*h+r*l-a*k,t=b*k+a*h-e*l,l=-a*l-e*h-r*k;f[0]=v*b+l*-a+m*-r-t*-e;f[1]=m*b+l*-e+t*-a-v*-r;f[2]=t*b+l*-r+v*-e-m*-a;return f};a.forEach=function(){var b=a.create();return function(a,f,l,h,k,e){f||(f=4);l||(l=0);for(h=h?Math.min(h*
f+l,a.length):a.length;l<h;l+=f)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],k(b,e,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,n){var b=n("vec3"),c=n("vec4"),g=n("mat3"),f="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new f(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var c=b.create(),f=b.fromValues(1,0,0),g=b.fromValues(0,1,0);return function(e,r,v){var m=b.dot(e,r);if(-.9999999>m)return b.cross(f,e,c),1E-6>b.length(c)&&b.cross(g,e,c),b.normalize(c,c),a.setAxisAngle(c,Math.PI,v),v;if(.9999999<m)return v[0]=0,v[1]=0,v[2]=0,v[3]=1,v;b.cross(e,
r,c);v[0]=c[0];v[1]=c[1];v[2]=c[2];v[3]=1+m;return a.normalize(v,v)}}();a.setAxes=function(){var b=g.create();return function(c,f,e,g){b[0]=f[0];b[3]=f[1];b[6]=f[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,g),g)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var e=Math.sin(b);c[0]=e*a[0];c[1]=e*a[1];c[2]=e*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var e=a[0],f=a[1],g=a[2];a=a[3];var m=b[0],t=b[1],s=b[2];b=b[3];c[0]=e*b+a*m+f*s-g*t;c[1]=f*b+a*t+g*m-e*s;c[2]=g*b+a*s+e*t-f*m;c[3]=a*b-e*m-f*t-g*s;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var e=a[0],f=a[1],g=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=e*b+a*m;c[1]=f*b+g*m;c[2]=g*b-f*m;c[3]=a*b-e*m;return c};a.rotateY=function(a,b,c){b*=.5;var e=a[0],f=a[1],g=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=e*
b-g*m;c[1]=f*b+a*m;c[2]=g*b+e*m;c[3]=a*b-f*m;return c};a.rotateZ=function(a,b,c){b*=.5;var e=a[0],f=a[1],g=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=e*b+f*m;c[1]=f*b-e*m;c[2]=g*b+a*m;c[3]=a*b-g*m;return c};a.calculateW=function(a,b){var c=a[0],e=a[1],f=a[2];b[0]=c;b[1]=e;b[2]=f;b[3]=-Math.sqrt(Math.abs(1-c*c-e*e-f*f));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,e){var f=a[0],g=a[1],m=a[2];a=a[3];var t=b[0],s=b[1],n=b[2];b=b[3];var d,C,A;C=f*t+g*s+m*n+a*b;0>C&&(C=-C,t=-t,s=-s,
n=-n,b=-b);1E-6<1-C?(d=Math.acos(C),A=Math.sin(d),C=Math.sin((1-c)*d)/A,c=Math.sin(c*d)/A):C=1-c;e[0]=C*f+c*t;e[1]=C*g+c*s;e[2]=C*m+c*n;e[3]=C*a+c*b;return e};a.invert=function(a,b){var c=a[0],e=a[1],f=a[2],g=a[3],m=c*c+e*e+f*f+g*g,m=m?1/m:0;b[0]=-c*m;b[1]=-e*m;b[2]=-f*m;b[3]=g*m;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var e=0;a[4]>a[0]&&(e=1);a[8]>a[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3,c=Math.sqrt(a[3*e+e]-a[3*f+f]-a[3*g+g]+1);b[e]=.5*c;c=.5/c;b[3]=(a[3*f+g]-a[3*g+f])*c;b[f]=(a[3*f+e]+a[3*e+f])*c;b[g]=(a[3*g+e]+a[3*e+g])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new n(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new n(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var g=a[1],f=a[2],l=a[5];c[1]=a[3];c[2]=a[6];c[3]=g;c[5]=a[7];c[6]=f;c[7]=l}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=a[4],e=a[5],r=a[6],n=a[7],m=a[8],t=m*k-e*n,s=-m*h+e*r,y=
n*h-k*r,d=g*t+f*s+l*y;if(!d)return null;d=1/d;c[0]=t*d;c[1]=(-m*f+l*n)*d;c[2]=(e*f-l*k)*d;c[3]=s*d;c[4]=(m*g-l*r)*d;c[5]=(-e*g+l*h)*d;c[6]=y*d;c[7]=(-n*g+f*r)*d;c[8]=(k*g-f*h)*d;return c};a.adjoint=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=a[4],e=a[5],r=a[6],n=a[7],m=a[8];c[0]=k*m-e*n;c[1]=l*n-f*m;c[2]=f*e-l*k;c[3]=e*r-h*m;c[4]=g*m-l*r;c[5]=l*h-g*e;c[6]=h*n-k*r;c[7]=f*r-g*n;c[8]=g*k-f*h;return c};a.determinant=function(a){var c=a[3],g=a[4],f=a[5],l=a[6],h=a[7],k=a[8];return a[0]*(k*g-f*h)+a[1]*
(-k*c+f*l)+a[2]*(h*c-g*l)};a.multiply=function(a,c,g){var f=a[0],l=a[1],h=a[2],k=a[3],e=a[4],r=a[5],n=a[6],m=a[7];a=a[8];var t=c[0],s=c[1],y=c[2],d=c[3],C=c[4],A=c[5],u=c[6],w=c[7];c=c[8];g[0]=t*f+s*k+y*n;g[1]=t*l+s*e+y*m;g[2]=t*h+s*r+y*a;g[3]=d*f+C*k+A*n;g[4]=d*l+C*e+A*m;g[5]=d*h+C*r+A*a;g[6]=u*f+w*k+c*n;g[7]=u*l+w*e+c*m;g[8]=u*h+w*r+c*a;return g};a.mul=a.multiply;a.translate=function(a,c,g){var f=a[0],l=a[1],h=a[2],k=a[3],e=a[4],r=a[5],n=a[6],m=a[7];a=a[8];var t=c[0];c=c[1];g[0]=f;g[1]=l;g[2]=h;
g[3]=k;g[4]=e;g[5]=r;g[6]=t*f+c*k+n;g[7]=t*l+c*e+m;g[8]=t*h+c*r+a;return g};a.rotate=function(a,c,g){var f=a[0],l=a[1],h=a[2],k=a[3],e=a[4],r=a[5],n=a[6],m=a[7];a=a[8];var t=Math.sin(c);c=Math.cos(c);g[0]=c*f+t*k;g[1]=c*l+t*e;g[2]=c*h+t*r;g[3]=c*k-t*f;g[4]=c*e-t*l;g[5]=c*r-t*h;g[6]=n;g[7]=m;g[8]=a;return g};a.scale=function(a,c,g){var f=c[0];c=c[1];g[0]=f*a[0];g[1]=f*a[1];g[2]=f*a[2];g[3]=c*a[3];g[4]=c*a[4];g[5]=c*a[5];g[6]=a[6];g[7]=a[7];g[8]=a[8];return g};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=g+g,e=f+f,r=l+l,g=g*k,n=f*k,f=f*e,m=l*k,t=l*e,l=l*r,k=h*k,e=h*e,h=h*r;c[0]=1-f-l;c[3]=n-h;c[6]=m+e;c[1]=n+h;c[4]=1-g-l;c[7]=t-k;c[2]=m-e;c[5]=t+k;c[8]=1-g-f;return c};a.normalFromMat4=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=a[4],e=a[5],r=a[6],n=a[7],m=a[8],t=a[9],s=a[10],y=a[11],d=a[12],C=a[13],A=a[14],u=a[15],w=g*e-f*k,p=g*r-l*k,I=g*n-h*k,H=f*r-l*e,x=f*n-
h*e,M=l*n-h*r,q=m*C-t*d,G=m*A-s*d,m=m*u-y*d,D=t*A-s*C,t=t*u-y*C,s=s*u-y*A,y=w*s-p*t+I*D+H*m-x*G+M*q;if(!y)return null;y=1/y;c[0]=(e*s-r*t+n*D)*y;c[1]=(r*m-k*s-n*G)*y;c[2]=(k*t-e*m+n*q)*y;c[3]=(l*t-f*s-h*D)*y;c[4]=(g*s-l*m+h*G)*y;c[5]=(f*m-g*t-h*q)*y;c[6]=(C*M-A*x+u*H)*y;c[7]=(A*I-d*M-u*p)*y;c[8]=(d*x-C*I+u*w)*y;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.nv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new n(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new n(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var g=a[1],f=a[2],l=a[3],h=a[6],k=a[7],e=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=g;c[6]=a[9];c[7]=a[13];c[8]=f;c[9]=h;c[11]=a[14];c[12]=l;c[13]=k;
c[14]=e}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=a[4],e=a[5],r=a[6],n=a[7],m=a[8],t=a[9],s=a[10],y=a[11],d=a[12],C=a[13],A=a[14],u=a[15],w=g*e-f*k,p=g*r-l*k,I=g*n-h*k,H=f*r-l*e,x=f*n-h*e,M=l*n-h*r,q=m*C-t*d,G=m*A-s*d,D=m*u-y*d,V=t*A-s*C,O=t*u-y*C,U=s*u-y*A,T=w*U-p*O+I*V+H*D-x*G+M*q;if(!T)return null;
T=1/T;c[0]=(e*U-r*O+n*V)*T;c[1]=(l*O-f*U-h*V)*T;c[2]=(C*M-A*x+u*H)*T;c[3]=(s*x-t*M-y*H)*T;c[4]=(r*D-k*U-n*G)*T;c[5]=(g*U-l*D+h*G)*T;c[6]=(A*I-d*M-u*p)*T;c[7]=(m*M-s*I+y*p)*T;c[8]=(k*O-e*D+n*q)*T;c[9]=(f*D-g*O-h*q)*T;c[10]=(d*x-C*I+u*w)*T;c[11]=(t*I-m*x-y*w)*T;c[12]=(e*G-k*V-r*q)*T;c[13]=(g*V-f*G+l*q)*T;c[14]=(C*p-d*H-A*w)*T;c[15]=(m*H-t*p+s*w)*T;return c};a.adjoint=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=a[4],e=a[5],r=a[6],n=a[7],m=a[8],t=a[9],s=a[10],y=a[11],d=a[12],C=a[13],A=a[14],u=a[15];
c[0]=e*(s*u-y*A)-t*(r*u-n*A)+C*(r*y-n*s);c[1]=-(f*(s*u-y*A)-t*(l*u-h*A)+C*(l*y-h*s));c[2]=f*(r*u-n*A)-e*(l*u-h*A)+C*(l*n-h*r);c[3]=-(f*(r*y-n*s)-e*(l*y-h*s)+t*(l*n-h*r));c[4]=-(k*(s*u-y*A)-m*(r*u-n*A)+d*(r*y-n*s));c[5]=g*(s*u-y*A)-m*(l*u-h*A)+d*(l*y-h*s);c[6]=-(g*(r*u-n*A)-k*(l*u-h*A)+d*(l*n-h*r));c[7]=g*(r*y-n*s)-k*(l*y-h*s)+m*(l*n-h*r);c[8]=k*(t*u-y*C)-m*(e*u-n*C)+d*(e*y-n*t);c[9]=-(g*(t*u-y*C)-m*(f*u-h*C)+d*(f*y-h*t));c[10]=g*(e*u-n*C)-k*(f*u-h*C)+d*(f*n-h*e);c[11]=-(g*(e*y-n*t)-k*(f*y-h*t)+m*
(f*n-h*e));c[12]=-(k*(t*A-s*C)-m*(e*A-r*C)+d*(e*s-r*t));c[13]=g*(t*A-s*C)-m*(f*A-l*C)+d*(f*s-l*t);c[14]=-(g*(e*A-r*C)-k*(f*A-l*C)+d*(f*r-l*e));c[15]=g*(e*s-r*t)-k*(f*s-l*t)+m*(f*r-l*e);return c};a.determinant=function(a){var c=a[0],g=a[1],f=a[2],l=a[3],h=a[4],k=a[5],e=a[6],r=a[7],n=a[8],m=a[9],t=a[10],s=a[11],y=a[12],d=a[13],C=a[14];a=a[15];return(c*k-g*h)*(t*a-s*C)-(c*e-f*h)*(m*a-s*d)+(c*r-l*h)*(m*C-t*d)+(g*e-f*k)*(n*a-s*y)-(g*r-l*k)*(n*C-t*y)+(f*r-l*e)*(n*d-m*y)};a.multiply=function(a,c,g){var f=
a[0],l=a[1],h=a[2],k=a[3],e=a[4],r=a[5],n=a[6],m=a[7],t=a[8],s=a[9],y=a[10],d=a[11],C=a[12],A=a[13],u=a[14];a=a[15];var w=c[0],p=c[1],I=c[2],H=c[3];g[0]=w*f+p*e+I*t+H*C;g[1]=w*l+p*r+I*s+H*A;g[2]=w*h+p*n+I*y+H*u;g[3]=w*k+p*m+I*d+H*a;w=c[4];p=c[5];I=c[6];H=c[7];g[4]=w*f+p*e+I*t+H*C;g[5]=w*l+p*r+I*s+H*A;g[6]=w*h+p*n+I*y+H*u;g[7]=w*k+p*m+I*d+H*a;w=c[8];p=c[9];I=c[10];H=c[11];g[8]=w*f+p*e+I*t+H*C;g[9]=w*l+p*r+I*s+H*A;g[10]=w*h+p*n+I*y+H*u;g[11]=w*k+p*m+I*d+H*a;w=c[12];p=c[13];I=c[14];H=c[15];g[12]=w*f+
p*e+I*t+H*C;g[13]=w*l+p*r+I*s+H*A;g[14]=w*h+p*n+I*y+H*u;g[15]=w*k+p*m+I*d+H*a;return g};a.mul=a.multiply;a.translate=function(a,c,g){var f=c[0],l=c[1];c=c[2];var h,k,e,r,n,m,t,s,y,d,C,A;a===g?(g[12]=a[0]*f+a[4]*l+a[8]*c+a[12],g[13]=a[1]*f+a[5]*l+a[9]*c+a[13],g[14]=a[2]*f+a[6]*l+a[10]*c+a[14],g[15]=a[3]*f+a[7]*l+a[11]*c+a[15]):(h=a[0],k=a[1],e=a[2],r=a[3],n=a[4],m=a[5],t=a[6],s=a[7],y=a[8],d=a[9],C=a[10],A=a[11],g[0]=h,g[1]=k,g[2]=e,g[3]=r,g[4]=n,g[5]=m,g[6]=t,g[7]=s,g[8]=y,g[9]=d,g[10]=C,g[11]=A,
g[12]=h*f+n*l+y*c+a[12],g[13]=k*f+m*l+d*c+a[13],g[14]=e*f+t*l+C*c+a[14],g[15]=r*f+s*l+A*c+a[15]);return g};a.scale=function(a,c,g){var f=c[0],l=c[1];c=c[2];g[0]=a[0]*f;g[1]=a[1]*f;g[2]=a[2]*f;g[3]=a[3]*f;g[4]=a[4]*l;g[5]=a[5]*l;g[6]=a[6]*l;g[7]=a[7]*l;g[8]=a[8]*c;g[9]=a[9]*c;g[10]=a[10]*c;g[11]=a[11]*c;g[12]=a[12];g[13]=a[13];g[14]=a[14];g[15]=a[15];return g};a.rotate=function(a,c,g,f){var l=g[0],h=g[1];g=g[2];var k=Math.sqrt(l*l+h*h+g*g),e,r,n,m,t,s,y,d,C,A,u,w,p,I,H,x,M,q,G,D;if(1E-7>Math.abs(k))return null;
k=1/k;l*=k;h*=k;g*=k;e=Math.sin(c);r=Math.cos(c);n=1-r;c=a[0];k=a[1];m=a[2];t=a[3];s=a[4];y=a[5];d=a[6];C=a[7];A=a[8];u=a[9];w=a[10];p=a[11];I=l*l*n+r;H=h*l*n+g*e;x=g*l*n-h*e;M=l*h*n-g*e;q=h*h*n+r;G=g*h*n+l*e;D=l*g*n+h*e;l=h*g*n-l*e;h=g*g*n+r;f[0]=c*I+s*H+A*x;f[1]=k*I+y*H+u*x;f[2]=m*I+d*H+w*x;f[3]=t*I+C*H+p*x;f[4]=c*M+s*q+A*G;f[5]=k*M+y*q+u*G;f[6]=m*M+d*q+w*G;f[7]=t*M+C*q+p*G;f[8]=c*D+s*l+A*h;f[9]=k*D+y*l+u*h;f[10]=m*D+d*l+w*h;f[11]=t*D+C*l+p*h;a!==f&&(f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);
return f};a.rotateX=function(a,c,g){var f=Math.sin(c);c=Math.cos(c);var l=a[4],h=a[5],k=a[6],e=a[7],r=a[8],n=a[9],m=a[10],t=a[11];a!==g&&(g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[4]=l*c+r*f;g[5]=h*c+n*f;g[6]=k*c+m*f;g[7]=e*c+t*f;g[8]=r*c-l*f;g[9]=n*c-h*f;g[10]=m*c-k*f;g[11]=t*c-e*f;return g};a.rotateY=function(a,c,g){var f=Math.sin(c);c=Math.cos(c);var l=a[0],h=a[1],k=a[2],e=a[3],r=a[8],n=a[9],m=a[10],t=a[11];a!==g&&(g[4]=a[4],g[5]=a[5],g[6]=a[6],
g[7]=a[7],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=l*c-r*f;g[1]=h*c-n*f;g[2]=k*c-m*f;g[3]=e*c-t*f;g[8]=l*f+r*c;g[9]=h*f+n*c;g[10]=k*f+m*c;g[11]=e*f+t*c;return g};a.rotateZ=function(a,c,g){var f=Math.sin(c);c=Math.cos(c);var l=a[0],h=a[1],k=a[2],e=a[3],r=a[4],n=a[5],m=a[6],t=a[7];a!==g&&(g[8]=a[8],g[9]=a[9],g[10]=a[10],g[11]=a[11],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=l*c+r*f;g[1]=h*c+n*f;g[2]=k*c+m*f;g[3]=e*c+t*f;g[4]=r*c-l*f;g[5]=n*c-h*f;g[6]=m*c-k*f;g[7]=t*c-e*f;return g};
a.fromRotationTranslation=function(a,c,g){var f=a[0],l=a[1],h=a[2],k=a[3],e=f+f,r=l+l,n=h+h;a=f*e;var m=f*r,f=f*n,t=l*r,l=l*n,h=h*n,e=k*e,r=k*r,k=k*n;g[0]=1-(t+h);g[1]=m+k;g[2]=f-r;g[3]=0;g[4]=m-k;g[5]=1-(a+h);g[6]=l+e;g[7]=0;g[8]=f+r;g[9]=l-e;g[10]=1-(a+t);g[11]=0;g[12]=c[0];g[13]=c[1];g[14]=c[2];g[15]=1;return g};a.fromQuat=function(a,c){var g=a[0],f=a[1],l=a[2],h=a[3],k=g+g,e=f+f,r=l+l,g=g*k,n=f*k,f=f*e,m=l*k,t=l*e,l=l*r,k=h*k,e=h*e,h=h*r;c[0]=1-f-l;c[1]=n+h;c[2]=m-e;c[3]=0;c[4]=n-h;c[5]=1-g-l;
c[6]=t+k;c[7]=0;c[8]=m+e;c[9]=t-k;c[10]=1-g-f;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,g,f,l,h,k){var e=1/(c-a),r=1/(f-g),n=1/(l-h);k[0]=2*l*e;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*l*r;k[6]=0;k[7]=0;k[8]=(c+a)*e;k[9]=(f+g)*r;k[10]=(h+l)*n;k[11]=-1;k[12]=0;k[13]=0;k[14]=h*l*2*n;k[15]=0;return k};a.perspective=function(a,c,g,f,l){a=1/Math.tan(a/2);var h=1/(g-f);l[0]=a/c;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(f+g)*h;l[11]=-1;l[12]=0;l[13]=0;
l[14]=2*f*g*h;l[15]=0;return l};a.ortho=function(a,c,g,f,l,h,k){var e=1/(a-c),r=1/(g-f),n=1/(l-h);k[0]=-2*e;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*r;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*n;k[11]=0;k[12]=(a+c)*e;k[13]=(f+g)*r;k[14]=(h+l)*n;k[15]=1;return k};a.lookAt=function(b,c,g,f){var l,h,k,e,r,n,m,t,s=b[0],y=b[1];b=b[2];k=g[0];e=g[1];h=g[2];m=c[0];g=c[1];l=c[2];if(1E-7>Math.abs(s-m)&&1E-7>Math.abs(y-g)&&1E-7>Math.abs(b-l))return a.identity(f);c=s-m;g=y-g;m=b-l;t=1/Math.sqrt(c*c+g*g+m*m);c*=t;g*=t;m*=
t;l=e*m-h*g;h=h*c-k*m;k=k*g-e*c;(t=Math.sqrt(l*l+h*h+k*k))?(t=1/t,l*=t,h*=t,k*=t):k=h=l=0;e=g*k-m*h;r=m*l-c*k;n=c*h-g*l;(t=Math.sqrt(e*e+r*r+n*n))?(t=1/t,e*=t,r*=t,n*=t):n=r=e=0;f[0]=l;f[1]=e;f[2]=c;f[3]=0;f[4]=h;f[5]=r;f[6]=g;f[7]=0;f[8]=k;f[9]=n;f[10]=m;f[11]=0;f[12]=-(l*s+h*y+k*b);f[13]=-(e*s+r*y+n*b);f[14]=-(c*s+g*y+m*b);f[15]=1;return f};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.nv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.fq=function(){function a(b,c,g,f,l,h){this.message=b;this.offset=f;this.Eh=l;this.Tf=h;this.name="SyntaxError"}(function(a,c){function g(){this.constructor=a}g.prototype=c.prototype;a.prototype=new g})(a,Error);return{SyntaxError:a,parse:function(b){function c(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function g(a){if(ka!==a){ka>a&&(ka=0,Ba={Eh:1,Tf:1,$h:!1});var c=Ba,d,e;for(d=
ka;d<a;d++)e=b.charAt(d),"\n"===e?(c.$h||c.Eh++,c.Tf=1,c.$h=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(c.Eh++,c.Tf=1,c.$h=!0):(c.Tf++,c.$h=!1);ka=a}return Ba}function f(a){E<qa||(E>qa&&(qa=E,Wb=[]),Wb.push(a))}function l(){var a,c,d;a=E;c=N();c!==F?(c=h(),c!==F?(d=N(),d!==F?(Z++,10===b.charCodeAt(E)?(d=oc,E++):(d=F,0===Z&&f(Qa)),d===F&&(b.substr(E,2)===nb?(d=nb,E+=2):(d=F,0===Z&&f(Db)),d===F&&(13===b.charCodeAt(E)?(d=pc,E++):(d=F,0===Z&&f(Fa)))),Z--,d===F&&0===Z&&f(bc),d===F&&(d=J),d!==F?a=c:(E=a,
a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z);return a}function h(){var a,c,d,e,g,h,m,l;a=E;c=k();if(c!==F){d=[];e=E;g=N();g!==F?(44===b.charCodeAt(E)?(h=ja,E++):(h=F,0===Z&&f(na)),h!==F?(m=N(),m!==F?(l=k(),l!==F?e=g=[g,h,m,l]:(E=e,e=z)):(E=e,e=z)):(E=e,e=z)):(E=e,e=z);for(;e!==F;)d.push(e),e=E,g=N(),g!==F?(44===b.charCodeAt(E)?(h=ja,E++):(h=F,0===Z&&f(na)),h!==F?(m=N(),m!==F?(l=k(),l!==F?e=g=[g,h,m,l]:(E=e,e=z)):(E=e,e=z)):(E=e,e=z)):(E=e,e=z);d!==F?a=c=0==d.length?c:d[d.length-1]:(E=a,a=z)}else E=a,a=z;
return a}function k(){var a,c,d,g;a=E;c=e();c!==F?(d=N(),d!==F?(63===b.charCodeAt(E)?(d=fa,E++):(d=F,0===Z&&f(aa)),d!==F?(d=N(),d!==F?(d=h(),d!==F?(g=N(),g!==F?(58===b.charCodeAt(E)?(g=ba,E++):(g=F,0===Z&&f(B)),g!==F?(g=N(),g!==F?(g=h(),g!==F?a=c?d:g:(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z);a===F&&(a=e());return a}function e(){var a,b,c,d,e,f,g,h;a=E;b=r();if(b!==F){c=[];d=E;e=N();e!==F?(f=X(),f!==F?(g=N(),g!==F?(h=r(),h!==F?d=e=[e,f,g,h]:(E=
d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=X(),f!==F?(g=N(),g!==F?(h=r(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else E=a,a=z}else E=a,a=z;return a}function r(){var a,b,c,d,e,f,g,h;a=E;b=v();if(b!==F){c=[];d=E;e=N();e!==F?(f=R(),f!==F?(g=N(),g!==F?(h=v(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=R(),f!==F?(g=N(),g!==F?(h=v(),h!==
F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else E=a,a=z}else E=a,a=z;return a}function v(){var a,b,c,d,e,f,g,h;a=E;b=m();if(b!==F){c=[];d=E;e=N();e!==F?(f=P(),f!==F?(g=N(),g!==F?(h=m(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=P(),f!==F?(g=N(),g!==F?(h=m(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else E=
a,a=z}else E=a,a=z;return a}function m(){var a,b,c,d,e,f,g,h;a=E;b=t();if(b!==F){c=[];d=E;e=N();e!==F?(f=L(),f!==F?(g=N(),g!==F?(h=t(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=L(),f!==F?(g=N(),g!==F?(h=t(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else E=a,a=z}else E=a,a=z;return a}function t(){var a,b,c,d,e,f,g,h;a=E;b=s();if(b!==F){c=[];d=E;e=N();e!==F?(f=T(),f!==F?
(g=N(),g!==F?(h=s(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=T(),f!==F?(g=N(),g!==F?(h=s(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else E=a,a=z}else E=a,a=z;return a}function s(){var a,b,c,d,e,f,g,h;a=E;b=y();if(b!==F){c=[];d=E;e=N();e!==F?(f=U(),f!==F?(g=N(),g!==F?(h=y(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),
e!==F?(f=U(),f!==F?(g=N(),g!==F?(h=y(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else E=a,a=z}else E=a,a=z;return a}function y(){var a,b,c,e,f,g,h,k;a=E;b=d();if(b!==F){c=[];e=E;f=N();f!==F?(g=O(),g!==F?(h=N(),h!==F?(k=d(),k!==F?e=f=[f,g,h,k]:(E=e,e=z)):(E=e,e=z)):(E=e,e=z)):(E=e,e=z);for(;e!==F;)c.push(e),e=E,f=N(),f!==F?(g=O(),g!==F?(h=N(),h!==F?(k=d(),k!==F?e=f=[f,g,h,k]:
(E=e,e=z)):(E=e,e=z)):(E=e,e=z)):(E=e,e=z);if(c!==F)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else E=a,a=z}else E=a,a=z;return a}function d(){var a,b,c,d,e,f,g,h;a=E;b=C();if(b!==F){c=[];d=E;e=N();e!==F?(f=V(),f!==F?(g=N(),g!==F?(h=C(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=V(),f!==F?(g=N(),g!==F?(h=C(),h!==F?d=e=[e,f,g,h]:(E=d,
d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else E=a,a=z}else E=a,a=z;return a}function C(){var a,b,c,d,e,f,g,h;a=E;b=A();if(b!==F){c=[];d=E;e=N();e!==F?(f=D(),f!==F?(g=N(),g!==F?(h=A(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=D(),f!==F?(g=N(),g!==F?(h=A(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<
c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else E=a,a=z}else E=a,a=z;return a}function A(){var a,b,c,d,e,f,g,h;a=E;b=u();if(b!==F){c=[];d=E;e=N();e!==F?(f=G(),f!==F?(g=N(),g!==F?(h=u(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);for(;d!==F;)c.push(d),d=E,e=N(),e!==F?(f=G(),f!==F?(g=N(),g!==F?(h=u(),h!==F?d=e=[e,f,g,h]:(E=d,d=z)):(E=d,d=z)):(E=d,d=z)):(E=d,d=z);if(c!==F)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else E=a,a=z}else E=a,a=z;return a}function u(){var a,d,e;a=E;b.substr(E,7)===ea?(d=ea,E+=7):(d=F,0===Z&&f(pa));d!==F?(e=N(),e!==F?(e=p(),e!==F?a=e:(E=a,a=z)):(E=a,a=z)):(E=a,a=z);if(a===F){a=E;d=w();if(d!==F)if(e=N(),e!==F)if(b.substr(E,2)===xa?(e=xa,E+=2):(e=F,0===Z&&f(sa)),e===F&&(b.substr(E,2)===Ja?(e=Ja,E+=2):(e=F,0===Z&&f(Zb))),e!==F){a:{a=d;switch(e){case "++":d=++a;break a;case "--":d=--a;break a}d=void 0}a=d}else E=a,a=z;else E=a,a=z;else E=
a,a=z;a===F&&(a=w());a===F&&(a=E,b.substr(E,2)===xa?(d=xa,E+=2):(d=F,0===Z&&f(sa)),d===F&&(b.substr(E,2)===Ja?(d=Ja,E+=2):(d=F,0===Z&&f(Zb)),d===F&&(43===b.charCodeAt(E)?(d=$a,E++):(d=F,0===Z&&f(tb)),d===F&&(45===b.charCodeAt(E)?(d=ya,E++):(d=F,0===Z&&f(Kb)),d===F&&(126===b.charCodeAt(E)?(d=Lb,E++):(d=F,0===Z&&f(bd)),d===F&&(33===b.charCodeAt(E)?(d=Sc,E++):(d=F,0===Z&&f(cd))))))),d!==F?(e=N(),e!==F?(e=u(),e!==F?a=d=c(d,e):(E=a,a=z)):(E=a,a=z)):(E=a,a=z))}return a}function w(){var a,c,d;Z++;var e;
a=E;48===b.charCodeAt(E)?(c=Ra,E++):(c=F,0===Z&&f(Na));if(c!==F)if(bb.test(b.charAt(E))?(c=b.charAt(E),E++):(c=F,0===Z&&f(Ea)),c!==F){c=E;d=[];e=H();if(e!==F)for(;e!==F;)d.push(e),e=H();else d=z;d!==F&&(d=b.substring(c,E));c=d;c!==F?a=c=parseInt("0x"+c):(E=a,a=z)}else E=a,a=z;else E=a,a=z;if(a===F){a=E;48===b.charCodeAt(E)?(c=Ra,E++):(c=F,0===Z&&f(Na));if(c===F)if(c=E,Yb.test(b.charAt(E))?(d=b.charAt(E),E++):(d=F,0===Z&&f(ab)),d!==F){var g;e=[];g=I();if(g!==F)for(;g!==F;)e.push(g),g=I();else e=z;
e===F&&(e=J);e!==F?c=d=[d,e]:(E=c,c=z)}else E=c,c=z;c!==F&&(c=b.substring(a,E));a=c;a!==F&&(a=parseInt(a))}Z--;a===F&&0===Z&&f(Y);a===F&&(c=x(),c!==F&&(c=0),a=c,a===F&&(a=E,40===b.charCodeAt(E)?(c=W,E++):(c=F,0===Z&&f(Da)),c!==F?(c=N(),c!==F?(c=h(),c!==F?(d=N(),d!==F?(41===b.charCodeAt(E)?(d=ma,E++):(d=F,0===Z&&f(K)),d!==F?a=c:(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)));return a}function p(){var a,c,d,e,g;c=x();c!==F&&(c=0);a=c;if(a===F){c=[];e=d=E;Z++;40===b.charCodeAt(E)?(g=W,E++):(g=
F,0===Z&&f(Da));g===F&&(41===b.charCodeAt(E)?(g=ma,E++):(g=F,0===Z&&f(K)));Z--;g===F?e=ta:(E=e,e=z);e!==F?(g=Q(),g!==F?d=e=[e,g]:(E=d,d=z)):(E=d,d=z);if(d!==F)for(;d!==F;)c.push(d),e=d=E,Z++,40===b.charCodeAt(E)?(g=W,E++):(g=F,0===Z&&f(Da)),g===F&&(41===b.charCodeAt(E)?(g=ma,E++):(g=F,0===Z&&f(K))),Z--,g===F?e=ta:(E=e,e=z),e!==F?(g=Q(),g!==F?d=e=[e,g]:(E=d,d=z)):(E=d,d=z);else c=z;c!==F&&(c=1);a=c;a===F&&(a=E,40===b.charCodeAt(E)?(c=W,E++):(c=F,0===Z&&f(Da)),c!==F?(d=N(),d!==F?(e=p(),e!==F?(g=N(),
g!==F?(41===b.charCodeAt(E)?(c=ma,E++):(c=F,0===Z&&f(K)),c!==F?a=e:(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z)):(E=a,a=z))}return a}function I(){var a;Ia.test(b.charAt(E))?(a=b.charAt(E),E++):(a=F,0===Z&&f(za));return a}function H(){var a;Pa.test(b.charAt(E))?(a=b.charAt(E),E++):(a=F,0===Z&&f(ib));return a}function x(){var a,c;Z++;c=a=E;Z++;var d,e,g,h;d=E;b.substr(E,7)===ea?(e=ea,E+=7):(e=F,0===Z&&f(pa));e!==F?(g=E,Z++,h=q(),Z--,h===F?g=ta:(E=g,g=z),g!==F?d=e=[e,g]:(E=d,d=z)):(E=d,d=z);Z--;d===F?
c=ta:(E=c,c=z);if(c!==F){Z++;c=E;d=M();if(d!==F){e=[];for(g=q();g!==F;)e.push(g),g=q();e!==F?c=d+=e.join(""):(E=c,c=z)}else E=c,c=z;Z--;c===F&&0===Z&&f(Jb);c!==F?a=c:(E=a,a=z)}else E=a,a=z;Z--;a===F&&0===Z&&f(Jb);return a}function M(){var a;Ca.test(b.charAt(E))?(a=b.charAt(E),E++):(a=F,0===Z&&f(Xa));a===F&&(36===b.charCodeAt(E)?(a=cb,E++):(a=F,0===Z&&f(Za)),a===F&&(95===b.charCodeAt(E)?(a=sb,E++):(a=F,0===Z&&f(wa))));return a}function q(){var a;a=M();a===F&&(a=I());return a}function G(){var a,c,d,
e;a=E;42===b.charCodeAt(E)?(c=Tc,E++):(c=F,0===Z&&f(uc));c===F&&(47===b.charCodeAt(E)?(c=mb,E++):(c=F,0===Z&&f(Ya)),c===F&&(37===b.charCodeAt(E)?(c=yb,E++):(c=F,0===Z&&f(dc))));c!==F?(d=E,Z++,61===b.charCodeAt(E)?(e=Mb,E++):(e=F,0===Z&&f(Ub)),Z--,e===F?d=ta:(E=d,d=z),d!==F?a=c:(E=a,a=z)):(E=a,a=z);return a}function D(){var a,c,d;a=E;43===b.charCodeAt(E)?(c=$a,E++):(c=F,0===Z&&f(tb));c!==F?(c=E,Z++,43===b.charCodeAt(E)?(d=$a,E++):(d=F,0===Z&&f(tb)),d===F&&(61===b.charCodeAt(E)?(d=Mb,E++):(d=F,0===
Z&&f(Ub))),Z--,d===F?c=ta:(E=c,c=z),c!==F?a="+":(E=a,a=z)):(E=a,a=z);a===F&&(a=E,45===b.charCodeAt(E)?(c=ya,E++):(c=F,0===Z&&f(Kb)),c!==F?(c=E,Z++,45===b.charCodeAt(E)?(d=ya,E++):(d=F,0===Z&&f(Kb)),d===F&&(61===b.charCodeAt(E)?(d=Mb,E++):(d=F,0===Z&&f(Ub))),Z--,d===F?c=ta:(E=c,c=z),c!==F?a="-":(E=a,a=z)):(E=a,a=z));return a}function V(){var a;b.substr(E,2)===Vb?(a=Vb,E+=2):(a=F,0===Z&&f(lc));a===F&&(b.substr(E,2)===va?(a=va,E+=2):(a=F,0===Z&&f(Nb)));return a}function O(){var a;b.substr(E,2)===db?
(a=db,E+=2):(a=F,0===Z&&f(ra));a===F&&(b.substr(E,2)===zb?(a=zb,E+=2):(a=F,0===Z&&f(da)),a===F&&(60===b.charCodeAt(E)?(a=Ua,E++):(a=F,0===Z&&f(eb)),a===F&&(62===b.charCodeAt(E)?(a=la,E++):(a=F,0===Z&&f(Ka)))));return a}function U(){var a;b.substr(E,2)===fb?(a=fb,E+=2):(a=F,0===Z&&f(ua));a===F&&(b.substr(E,2)===Va?(a=Va,E+=2):(a=F,0===Z&&f(oa)));return a}function T(){var a,c,d;a=E;38===b.charCodeAt(E)?(c=La,E++):(c=F,0===Z&&f(Ab));c!==F?(c=E,Z++,38===b.charCodeAt(E)?(d=La,E++):(d=F,0===Z&&f(Ab)),Z--,
d===F?c=ta:(E=c,c=z),c!==F?a="&":(E=a,a=z)):(E=a,a=z);return a}function L(){var a,c,d;a=E;94===b.charCodeAt(E)?(c=ec,E++):(c=F,0===Z&&f($b));c!==F?(c=E,Z++,94===b.charCodeAt(E)?(d=ec,E++):(d=F,0===Z&&f($b)),Z--,d===F?c=ta:(E=c,c=z),c!==F?a="^":(E=a,a=z)):(E=a,a=z);return a}function P(){var a,c,d;a=E;124===b.charCodeAt(E)?(c=ac,E++):(c=F,0===Z&&f(ub));c!==F?(c=E,Z++,124===b.charCodeAt(E)?(d=ac,E++):(d=F,0===Z&&f(ub)),Z--,d===F?c=ta:(E=c,c=z),c!==F?a="|":(E=a,a=z)):(E=a,a=z);return a}function R(){var a;
b.substr(E,2)===Bb?(a=Bb,E+=2):(a=F,0===Z&&f(mc));a!==F&&(a="&&");return a}function X(){var a;b.substr(E,2)===Cb?(a=Cb,E+=2):(a=F,0===Z&&f(vb));a!==F&&(a="||");return a}function N(){var a,b;a=[];for(b=ca();b!==F;)a.push(b),b=ca();return a}function ca(){var a;Z++;Ob.test(b.charAt(E))?(a=b.charAt(E),E++):(a=F,0===Z&&f(Ma));Z--;a===F&&0===Z&&f(nc);return a}function Q(){var a;b.length>E?(a=b.charAt(E),E++):(a=F,0===Z&&f(Oa));return a}var ia=1<arguments.length?arguments[1]:{},F={},ga={start:l},S=l,z=F,
J=null,ja=",",na={type:"literal",value:",",description:'","'},fa="?",aa={type:"literal",value:"?",description:'"?"'},ba=":",B={type:"literal",value:":",description:'":"'},ea="defined",pa={type:"literal",value:"defined",description:'"defined"'},W="(",Da={type:"literal",value:"(",description:'"("'},ma=")",K={type:"literal",value:")",description:'")"'},ta=void 0,Y={type:"other",description:"number"},Ra="0",Na={type:"literal",value:"0",description:'"0"'},Ia=/^[0-9]/,za={type:"class",value:"[0-9]",description:"[0-9]"},
Yb=/^[1-9]/,ab={type:"class",value:"[1-9]",description:"[1-9]"},bb=/^[xX]/,Ea={type:"class",value:"[xX]",description:"[xX]"},Pa=/^[0-9a-fA-F]/,ib={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Jb={type:"other",description:"identifier"},cb="$",Za={type:"literal",value:"$",description:'"$"'},sb="_",wa={type:"literal",value:"_",description:'"_"'},Ca=/^[a-zA-Z]/,Xa={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},xa="++",sa={type:"literal",value:"++",description:'"++"'},Ja="--",Zb=
{type:"literal",value:"--",description:'"--"'},$a="+",tb={type:"literal",value:"+",description:'"+"'},ya="-",Kb={type:"literal",value:"-",description:'"-"'},Lb="~",bd={type:"literal",value:"~",description:'"~"'},Sc="!",cd={type:"literal",value:"!",description:'"!"'},Tc="*",uc={type:"literal",value:"*",description:'"*"'},mb="/",Ya={type:"literal",value:"/",description:'"/"'},yb="%",dc={type:"literal",value:"%",description:'"%"'},Mb="=",Ub={type:"literal",value:"=",description:'"="'},Vb="<<",lc={type:"literal",
value:"<<",description:'"<<"'},va=">>",Nb={type:"literal",value:">>",description:'">>"'},db="<=",ra={type:"literal",value:"<=",description:'"<="'},zb=">=",da={type:"literal",value:">=",description:'">="'},Ua="<",eb={type:"literal",value:"<",description:'"<"'},la=">",Ka={type:"literal",value:">",description:'">"'},fb="==",ua={type:"literal",value:"==",description:'"=="'},Va="!=",oa={type:"literal",value:"!=",description:'"!="'},La="&",Ab={type:"literal",value:"&",description:'"&"'},ec="^",$b={type:"literal",
value:"^",description:'"^"'},ac="|",ub={type:"literal",value:"|",description:'"|"'},Bb="&&",mc={type:"literal",value:"&&",description:'"&&"'},Cb="||",vb={type:"literal",value:"||",description:'"||"'},nc={type:"other",description:"whitespace"},Ob=/^[\t\x0B\f ]/,Ma={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},bc={type:"other",description:"end of line"},oc="\n",Qa={type:"literal",value:"\n",description:'"\\n"'},nb="\r\n",Db={type:"literal",value:"\r\n",description:'"\\r\\n"'},pc=
"\r",Fa={type:"literal",value:"\r",description:'"\\r"'},Oa={type:"any",description:"any character"},E=0,ka=0,Ba={Eh:1,Tf:1,$h:!1},qa=0,Wb=[],Z=0,jb;if("startRule"in ia){if(!(ia.Tq in ga))throw Error("Can't start parsing from rule \""+ia.Tq+'".');S=ga[ia.Tq]}jb=S();if(jb!==F&&E===b.length)return jb;jb!==F&&E<b.length&&f({type:"end",description:"end of input"});throw function(c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<
a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=g(e),m=e<b.length?b.charAt(e):null;null!==d&&f(d);return new a(null!==c?c:h(d,m),0,0,e,k.Eh,k.Tf)}(null,Wb,qa);}}}()};b4w.module.__md5=function(a){function n(a,k){var e=a[0],l=a[1],n=a[2],m=a[3],e=c(e,l,n,m,k[0],7,-680876936),m=c(m,e,l,n,k[1],12,-389564586),n=c(n,m,e,l,k[2],17,606105819),l=c(l,n,m,e,k[3],22,-1044525330),e=c(e,l,n,m,k[4],7,-176418897),m=c(m,e,l,n,k[5],12,1200080426),n=c(n,m,e,l,k[6],17,-1473231341),l=c(l,n,m,e,k[7],22,-45705983),e=c(e,l,n,m,k[8],7,1770035416),m=c(m,e,l,n,k[9],12,-1958414417),n=c(n,m,e,l,k[10],17,-42063),l=c(l,n,m,e,k[11],22,-1990404162),e=c(e,l,n,m,k[12],7,1804603682),m=c(m,e,l,n,
k[13],12,-40341101),n=c(n,m,e,l,k[14],17,-1502002290),l=c(l,n,m,e,k[15],22,1236535329),e=g(e,l,n,m,k[1],5,-165796510),m=g(m,e,l,n,k[6],9,-1069501632),n=g(n,m,e,l,k[11],14,643717713),l=g(l,n,m,e,k[0],20,-373897302),e=g(e,l,n,m,k[5],5,-701558691),m=g(m,e,l,n,k[10],9,38016083),n=g(n,m,e,l,k[15],14,-660478335),l=g(l,n,m,e,k[4],20,-405537848),e=g(e,l,n,m,k[9],5,568446438),m=g(m,e,l,n,k[14],9,-1019803690),n=g(n,m,e,l,k[3],14,-187363961),l=g(l,n,m,e,k[8],20,1163531501),e=g(e,l,n,m,k[13],5,-1444681467),m=
g(m,e,l,n,k[2],9,-51403784),n=g(n,m,e,l,k[7],14,1735328473),l=g(l,n,m,e,k[12],20,-1926607734),e=b(l^n^m,e,l,k[5],4,-378558),m=b(e^l^n,m,e,k[8],11,-2022574463),n=b(m^e^l,n,m,k[11],16,1839030562),l=b(n^m^e,l,n,k[14],23,-35309556),e=b(l^n^m,e,l,k[1],4,-1530992060),m=b(e^l^n,m,e,k[4],11,1272893353),n=b(m^e^l,n,m,k[7],16,-155497632),l=b(n^m^e,l,n,k[10],23,-1094730640),e=b(l^n^m,e,l,k[13],4,681279174),m=b(e^l^n,m,e,k[0],11,-358537222),n=b(m^e^l,n,m,k[3],16,-722521979),l=b(n^m^e,l,n,k[6],23,76029189),e=
b(l^n^m,e,l,k[9],4,-640364487),m=b(e^l^n,m,e,k[12],11,-421815835),n=b(m^e^l,n,m,k[15],16,530742520),l=b(n^m^e,l,n,k[2],23,-995338651),e=f(e,l,n,m,k[0],6,-198630844),m=f(m,e,l,n,k[7],10,1126891415),n=f(n,m,e,l,k[14],15,-1416354905),l=f(l,n,m,e,k[5],21,-57434055),e=f(e,l,n,m,k[12],6,1700485571),m=f(m,e,l,n,k[3],10,-1894986606),n=f(n,m,e,l,k[10],15,-1051523),l=f(l,n,m,e,k[1],21,-2054922799),e=f(e,l,n,m,k[8],6,1873313359),m=f(m,e,l,n,k[15],10,-30611744),n=f(n,m,e,l,k[6],15,-1560198380),l=f(l,n,m,e,k[13],
21,1309151649),e=f(e,l,n,m,k[4],6,-145523070),m=f(m,e,l,n,k[11],10,-1120210379),n=f(n,m,e,l,k[2],15,718787259),l=f(l,n,m,e,k[9],21,-343485551);a[0]=e+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=n+a[2]&4294967295;a[3]=m+a[3]&4294967295}function b(a,b,c,f,g,l){b=(b+a&4294967295)+(f+l&4294967295)&4294967295;return(b<<g|b>>>32-g)+c&4294967295}function c(a,c,e,f,g,l,n){return b(c&e|~c&f,a,c,g,l,n)}function g(a,c,e,f,g,l,n){return b(c&f|e&~f,a,c,g,l,n)}function f(a,c,e,f,g,l,n){return b(e^(c|~f),a,c,g,
l,n)}var l="0123456789abcdef".split("");a.hp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var f;for(f=64;f<=b.length;f+=64){for(var g=b.substring(f-64,f),m=[],t=void 0,t=0;64>t;t+=4)m[t>>2]=g.charCodeAt(t)+(g.charCodeAt(t+1)<<8)+(g.charCodeAt(t+2)<<16)+(g.charCodeAt(t+3)<<24);n(a,m)}b=b.substring(f-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(f=0;f<b.length;f++)g[f>>2]|=b.charCodeAt(f)<<(f%4<<3);g[f>>2]|=128<<(f%4<<3);if(55<f)for(n(a,g),f=0;16>f;f++)g[f]=0;g[14]=8*
c;n(a,g);for(b=0;b<a.length;b++){c=a[b];f="";for(g=0;4>g;g++)f+=l[c>>8*g+4&15]+l[c>>8*g&15];a[b]=f}return a.join("")}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 ce = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ce = mix ( ce , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cf = vec3 ( 0.0 ) ; vec3 cg = vec3 ( 0.0 ) ; vec3 ch = vec3 ( 0.0 ) ; bm ( ce , cf , cg , ch ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ci","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cj = ( u_model_matrix * vec4 ( ci , 1.0 ) ) . xyz ; mat4 ck = _ ( u_camera_eye , cj , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cl = ( u_model_matrix * vec4 ( ci , 1.0 ) ) . xyz ; ck = ck * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cl ) ;".split(" ")}]}}]},{type:"textline",b:"c cm = ag ( ce - ci , ci , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ck ) ; cm . b = cj ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c cm = ag ( ce , ci , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cn","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cd ( cm . a , cm . b , cn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cm . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cy",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float fj = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float fj = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( fj < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cl ( cy ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fd ( cE . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",
b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",
";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cy",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 gm = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gm = mix ( gm , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gn = vec3 ( 0.0 ) ; vec3 go = vec3 ( 0.0 ) ; vec3 gp = vec3 ( 0.0 ) ; bm ( gm , gn , go , gp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||",
"BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gq","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gq = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c gr = fY ( gm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gq , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gs = ( u_model_matrix * vec4 ( gq , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gt","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gt","=","u_view_matrix",
";"]}]}}]},{type:"textline",b:"mat4 gu = _ ( u_camera_eye , gs , gt ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gv = ( u_model_matrix * vec4 ( gq , 1.0 ) ) . xyz ; gu = gu * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gv ) ;".split(" ")}]}}]},{type:"textline",b:"c gr = ag ( gm - gq , gq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gu ) ; gr . b = gs ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"c gr = ag ( gm , gq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gw","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gw = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cd ( gr . a , gr . b , gw ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 gx = u_view_matrix * vec4 ( gr . a , 1.0 ) ; vec4 gy = u_proj_matrix * gx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gy . xy += u_subpixel_jitter * gy . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"textline",b:"gh ( gr . a ) ; cE = gx ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cy = - gx . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 gz = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gA = SHADOW_TEX_RES / 2.0 ; gz = floor ( gz * gA + 0.5 ) / gA - gz ; gy . xy += gz ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","gy",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gm",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gm",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gm , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gm ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4",
"u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gm",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gm",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")",
"{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gn = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 go = _ ( u_camera_eye , gn , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"go = go * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c gp = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , go ) ; gp . b = gn ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c gp = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gq = u_proj_matrix * u_view_matrix * vec4 ( gp . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gm = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["gm","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gm","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","gq",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gu ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gv ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gw = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gw = NUM_LINES ;".split(" ")}]}}]},{type:"textline",
b:"float gy ( float gx ) { return gx - floor ( gx * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gH ( inout float gz , in float gA [ gw ] , in float gB ) { for ( int gC = 0 ; gC < NUM_RINGS ; gC ++ ) { float gD = 40.0 * gA [ gC ] ; float gE = 300.0 * ( gy ( gD ) - 0.005 ) ; float gF = gD ; float gG = abs ( gF * ( u_halo_size * gE - gB ) ) ; gz += 1.0 - min ( gG , 1.0 ) ; } }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gQ ( inout float gI , in float gJ [ gw ] , in float gK ) { for ( int gL = 0 ; gL < NUM_LINES ; gL ++ ) { float gM = gJ [ gL ] ; float gN = gM ; float gO = 1000.0 * ( gy ( gM ) - 0.005 ) ; float gP = 20.0 * abs ( gN * a . x + gO * a . y ) ; gI += 1.0 - min ( gP , 1.0 ) ; } gI *= gK ; }".split(" ")}]}}]},{type:"textline",b:"void gX ( inout float gR , in vec2 gS ) { float gT , gU ; gU = atan ( gS . y , gS . x ) ; gU *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float gV = cos ( gU ) ; float gW = sin ( gU ) ; gU = ( gV * gS . x + gW * gS . y ) * ( gV * gS . y - gW * gS . x ) ; gT = abs ( gU ) ; if ( gT < 1.0 ) { gT = ( 0.01 * u_halo_size ) / ( gT ) ; gR *= sqrt ( min ( gT , 1.0 ) ) ; } } void main ( ) { float gY = ( a . x * a . x + a . y * a . y ) ; float gZ = sqrt ( gY ) ; gY = max ( 1.0 - gY , 0.0 ) ; gY = pow ( gY , u_halo_hardness ) ; float g_ = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float ha [ gw ] ; for ( int hb = 0 ; hb < gw ; hb ++ ) { ha [ hb ] = fract ( gv / ( float ( hb ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hc = 0.0 ; gH ( hc , ha , gZ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hd = 0.0 ; gQ ( hd , ha , gY ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gX ( gY , a ) ;".split(" ")}]}}]},{type:"textline",b:"gY *= g_ ; vec3 he = u_diffuse_color . rgb * gY ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hc *= gY ; he += u_halo_rings_color * hc ; gY += hc ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hd *= g_ ; he += u_halo_lines_color * hd ; gY += hd ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gY *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hf = u_halo_stars_blend * ( gu . y - u_halo_stars_height ) ; gY *= clamp ( hf , 0.0 , 1.0 ) ; gY *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gq ( he ) ; gt ( he , gY ) ; gl_FragColor = vec4 ( he , gY ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gv ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gu",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gw = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gv = fract ( gw . x + gw . y + gw . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gx = y ( gw , u_view_matrix ) ; mat4 gy = u_view_matrix ; gy [ 3 ] [ 0 ] = 0.0 ; gy [ 3 ] [ 1 ] = 0.0 ; gy [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gx = y ( gw , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gz = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gA = gx * gz ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gB = u_proj_matrix * gy * gA ; gB . z = 0.99999 * gB . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gu","=","gA",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gB = u_proj_matrix * u_view_matrix * gA ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gB",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gw = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gw , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_factor ; uniform vec2 u_normalmap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ; varying vec3 kr ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ks",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kt",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void",
"main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float lf = kq . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lg","=","a",";"]}]}}]},{type:"textline",b:["vec3","lh","=","kr",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lh = lh ; else lh = - lh ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 li = cross ( lh , ks . xyz ) * ks . w ; mat3 lj = mat3 ( ks . xyz , li , lh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lk = length ( cE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"vec2 ll = normalize ( u_view_matrix_frag * vec4 ( kr , 0.0 ) ) . st ; ll = ll * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lk < PARALLAX_LOD_DIST ) { float lm = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lk ) , 0.0 , 1.0 ) ; float ln = u_parallax_scale * lm ; vec3 lo = normalize ( kp * lj ) ; float lp = 1.0 / PARALLAX_STEPS ; vec2 lq = lo . xy * ln / ( PARALLAX_STEPS * lo . z ) ; float lr = 1.0 ; float ls ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["vec2","lt","=","ll",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lt","=","lg",";"]}]}}]},{type:"textline",b:"ls = texture2D ( u_normalmap0 , lt + u_time * u_normalmap0_uv_velocity ) . a ; for ( float lu = 1.0 ; lu <= PARALLAX_STEPS ; lu ++ ) { if ( ls < lr ) { lr -= lp ; lt -= lq ; ls = texture2D ( u_normalmap0 , lt ) . a ; } } vec2 lv = lt + lq ; float lw = texture2D ( u_normalmap0 , lv ) . a - ( lr + lp ) ; float lx = ls - lr ; float ly = lx / ( lx - lw ) ; lt = ly * lv + ( 1.0 - ly ) * lt ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lg += lt - ll ;".split(" ")}]}}]},{type:"textline",b:["ll","=","lt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"ll += lt - lg ;".split(" ")}]}}]},{type:"textline",b:["lg","=","lt",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lz",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lz = texture2D ( u_normalmap0 , ll ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lz = texture2D ( u_normalmap0 , lg + u_time * u_normalmap0_uv_velocity ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lA = lz . rgb - 0.5 ; lA = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lA , u_normal_factor ) ; vec3 lB = lj * lA ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lB","=","lh",";"]}]}}]},{type:"textline",b:"lB = normalize ( lB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"ll = normalize ( u_view_matrix_frag * vec4 ( lB , 0.0 ) ) . st ; ll = ll * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lC = normalize ( kp ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lD = kt ; go ( lD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lE = vec4 ( lD , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lE","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lF","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lG = texture2D ( u_colormap0 , ll ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lG = texture2D ( u_colormap0 , lg + u_time * u_colormap0_uv_velocity ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"go ( lG . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:["vec4","lH",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_colormap1 , ll ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_colormap1 , lg ) ;".split(" ")}]}}]},{type:"textline",b:"go ( lH . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lI = texture2D ( u_stencil0 , ll ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lI = texture2D ( u_stencil0 , lg ) ;".split(" ")}]}}]},{type:"textline",b:"lG = mix ( lG , lH , lI . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lE . rgb = mix ( lE . rgb , lG . rgb , u_diffuse_color_factor ) ; float lJ = u_alpha_factor * lG . a ; lJ += ( 1.0 - step ( 0.0 , lJ ) ) ; lE . a = mix ( lJ , 1.0 , u_diffuse_color . a ) ; lF = lG . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lE . rgb *= mix ( vec3 ( 1.0 ) , lG . rgb , u_diffuse_color_factor ) ; lE . a = lG . a ; lF = lG . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lK = u_diffuse_intensity * lE . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","lL","=","lK",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lM = 0.5 * lB . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lN = u_environment_energy * textureCube ( u_sky_texture , lB ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lN = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lM ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lO = u_ambient * lN ; float lP = fi ( lK ) ; vec3 lQ = u_emit * lE . rgb ; vec3 lR = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 lS = vec3 ( lF ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lS = texture2D ( u_specmap0 , ll ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lS = texture2D ( u_specmap0 , lg ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"go ( lS . rgb ) ; lR = mix ( lR , lS , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float lT = u_specular_params [ 0 ] ; vec2 lU = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lV = lT * lR ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hm lW = jO ( lQ , lO , lK ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm lW = jJ ( lQ , lO , lK , lV , kq , lB , lC , lU , u_diffuse_params , lP , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 lL = lW . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","lX","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lX","=","0.0",";"]}]}}]},{type:"textline",b:"kR ( lL , lC , lB , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lX ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lL += lW . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lL = max ( lL - sqrt ( 0.01 * - min ( lf , 0.0 ) ) , 0.5 * lL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"ko ( lL , lf , u_time , lP , lB , u_sun_direction , u_sun_intensity , u_sun_quaternion , kq , lk ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float lY = lE . a ; if ( lY <= 0.5 ) discard ; lY = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lY = lE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lY += lW . a . a * lV . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","lY","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lL = mix ( le ( cD , lB . xz * u_refr_bump ) , lL , lY ) ; lY = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lZ = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 l_ = gI ( u_cube_fog , lC ) ; vec4 ma = vec4 ( l_ , u_fog_color_density . a ) ; go ( ma . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 ma = u_fog_color_density ; ma . rgb *= lZ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"ha ( lL , lk , lC , u_cam_water_depth , u_underwater_fog_color_density , ma , lf , lZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gB ( lL , lk , ma ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"lL = vec3 ( dK . a ) ;".split(" ")}]}}]},{type:"textline",b:["gq","(","lL",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gt ( lL , lY ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lL , lY ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ; varying vec3 kr ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ks",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kt",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lf = a_position ; vec3 lg = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lh = vec3 ( a_tangent ) ; vec3 li = a_tangent [ 3 ] * cross ( lg , lh ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lj = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lk = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 ll = lj - u_camera_eye ; vec3 li = cross ( ll , lk ) ; vec3 lh = cross ( lk , li ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lh = vec3 ( 0.0 ) ; vec3 li = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lf = mix ( lf , a_position_next , u_va_frame_factor ) ; lg = mix ( lg , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lm = vec3 ( a_tangent ) ; vec3 ln = a_tangent_next [ 3 ] * cross ( a_normal_next , lm ) ; lh = mix ( lh , lm , u_va_frame_factor ) ; li = mix ( li , ln , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bm ( lf , lh , li , lg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lo","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lo = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c lp = fY ( lf , lh , li , lg , lo , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lq = ( u_model_matrix * vec4 ( lo , 1.0 ) ) . xyz ; mat4 lr = _ ( u_camera_eye , lq , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ls = ( u_model_matrix * vec4 ( lo , 1.0 ) ) . xyz ; lr = lr * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ls ) ;".split(" ")}]}}]},
{type:"textline",b:"c lp = ag ( lf - lo , lo , lh , li , lg , lr ) ; lp . b = lq ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c lp = ag ( lf , lo , lh , li , lg , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lt = ( dot ( cross ( lp . e , lp . c ) , lp . d ) < 0.0 ) ? - 1.0 : 1.0 ; ks = vec4 ( lp . c , lt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"textline",b:"cd ( lp . a , lp . b , lg ) ;".split(" ")}]}}]},{type:"textline",b:"kq = lp . a ; kr = lp . e ; kp = u_camera_eye - lp . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kt = lp . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",
a:[{type:"textline",b:["kt","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lu = u_view_matrix * vec4 ( lp . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cE","=","lu",";"]}]}}]},{type:"textline",b:"vec4 lv = u_proj_matrix * lu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lv . xy += u_subpixel_jitter * lv . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gh","(","lv",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gh ( lp . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lw = lv . x ; float lx = lv . y ; float ly = lv . w ; cD . x = ( lw + ly ) / 2.0 ; cD . y = ( lx + ly ) / 2.0 ; cD . z = ly ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ku = - lu . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","lv",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kq ; varying vec4 cE ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","ks",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lf = vec3 ( UNITY_VALUE_NODES ) ; vec3 lg = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"},{type:"textline",b:"vec3 lk ( in vec3 lh , in float li ) { vec3 lj = lg ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lj = le ( cD , lh . xz * li ) ;".split(" ")}]}}]},{type:"textline",b:["return","lj",";","}"]}]}}]},{type:"textline",b:"vec3 ln ( float ll , vec3 lm ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lm ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , ll ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lu ( vec3 lo ) { vec4 lp = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lq = mix ( vec4 ( lo . bg , lp . wz ) , vec4 ( lo . gb , lp . xy ) , step ( lo . b , lo . g ) ) ; vec4 lr = mix ( vec4 ( lq . xyw , lo . r ) , vec4 ( lo . r , lq . yzx ) , step ( lq . x , lo . r ) ) ; float ls = lr . x - min ( lr . w , lr . y ) ; float lt = 1.0e-10 ; return vec3 ( abs ( lr . z + ( lr . w - lr . y ) / ( 6.0 * ls + lt ) ) , ls / ( lr . x + lt ) , lr . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 ly ( vec3 lv ) { vec4 lw = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lx = abs ( fract ( vec3 ( lv . r , lv . r , lv . r ) + lw . xyz ) * 6.0 - lw . www ) ; return lv . b * mix ( lw . xxx , clamp ( lx - lw . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lv . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lA ( vec2 lz ) { return vec3 ( lz * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lC ( vec3 lB ) { return vec2 ( lB . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"textline",b:"void lH ( inout vec3 lD , vec3 lE , vec3 lF , float lG ) {".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kR ( lD , lE , lF , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lG ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kR ( lD , lE , lF , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lG ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} hm lV ( vec3 lI , vec3 lJ , vec3 lK , vec3 lL , vec3 lM , vec3 lN , vec3 lO , vec2 lP , vec2 lQ , float lR , float lS , vec4 lT ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS_MAT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"return jJ ( lI , lJ , lK , lL , lM , lN , lO , lP , lQ , lR , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , lS , lT ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return jO ( lI , lJ , lK ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm lU ; lU . a = vec4 ( lK , ZERO_VALUE_NODES ) ; lU . b = lg ; return lU ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"mL",qualifier:["vec3"]},{type:"node_out",name:"mM",qualifier:["float"]},{type:"node_out",name:"mN",qualifier:["float"]},{type:"textline",b:"mL = normalize ( mB . xyz ) ; mM = abs ( mB . z ) ; mN = length ( mB . xyz ) ;".split(" ")}]}},
{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"mO",qualifier:["float"]},{type:"node_in",name:"mP",qualifier:["float"]},{type:"node_in",name:"mQ",qualifier:["float"]},{type:"node_out",name:"mR",qualifier:["vec3"]},{type:"textline",b:"mR = vec3 ( mO , mP , mQ ) ;".split(" ")}]}},{type:"node",name:"COMBHSV",group:{type:"group",a:[{type:"node_in",name:"mS",qualifier:["float"]},{type:"node_in",name:"mT",qualifier:["float"]},{type:"node_in",name:"mU",qualifier:["float"]},{type:"node_out",
name:"mV",qualifier:["vec3"]},{type:"textline",b:"mV = ly ( vec3 ( mS , mT , mU ) ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"lW",qualifier:["varying","vec2"]},{type:"node_out",name:"mW",qualifier:["vec3"]},{type:"textline",b:"mW = lA ( lW ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"lX",qualifier:["varying","vec3"]},{type:"node_out",name:"mX",qualifier:["vec3"]},{type:"textline",b:["mX",
"=","lX",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"lY",qualifier:["varying","float"]},{type:"node_out",name:"mY",qualifier:["float"]},{type:"textline",b:["mY","=","lY",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"lZ",qualifier:["varying","vec2"]},{type:"node_out",name:"mZ",qualifier:["float"]},{type:"node_out",name:"m_",qualifier:["float"]},{type:"textline",b:"mZ = lZ [ 0 ] ; m_ = lZ [ 1 ] ;".split(" ")}]}},
{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"l_",qualifier:["varying","vec3"]},{type:"node_out",name:"na",qualifier:["float"]},{type:"node_out",name:"nb",qualifier:["float"]},{type:"node_out",name:"nc",qualifier:["float"]},{type:"textline",b:"na = l_ [ 0 ] ; nb = l_ [ 1 ] ; nc = l_ [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"nd",qualifier:["vec3"]},{type:"textline",b:["nd","=","mx",";"]}]}},{type:"node",
name:"GEOMETRY_FB",group:{type:"group",a:[{type:"node_out",name:"ne",qualifier:["float"]},{type:"textline",b:"ne = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"nf",qualifier:["vec3"]},{type:"textline",b:["nf","=","mz",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"ng",qualifier:["vec3"]},{type:"textline",b:"ng = vec3 ( mA . r , - mA . b , mA . g ) ;".split(" ")}]}},
{type:"node",name:"HUE_SAT",group:{type:"group",a:[{type:"node_in",name:"nh",qualifier:["float"]},{type:"node_in",name:"ni",qualifier:["float"]},{type:"node_in",name:"nj",qualifier:["float"]},{type:"node_in",name:"nk",qualifier:["float"]},{type:"node_in",name:"nl",qualifier:["vec3"]},{type:"node_out",name:"nm",qualifier:["vec3"]},{type:"textline",b:"{ vec3 nn = lu ( nl ) ; nn [ 0 ] += ( nh - 0.5 ) ; if ( nn [ 0 ] > UNITY_VALUE_NODES ) nn [ 0 ] -= UNITY_VALUE_NODES ; else if ( nn [ 0 ] < ZERO_VALUE_NODES ) nn [ 0 ] += UNITY_VALUE_NODES ; nn *= vec3 ( UNITY_VALUE_NODES , ni , nj ) ; nn = mix ( lf , mix ( lg , nn , step ( lg , nn ) ) , step ( nn , lf ) ) ; nm = mix ( nl , ly ( nn ) , nk ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"no",qualifier:["float"]},{type:"node_in",name:"np",qualifier:["vec3"]},{type:"node_out",name:"nq",qualifier:["vec3"]},{type:"textline",b:"nq = mix ( np , lf - np , no ) ;".split(" ")}]}},{type:"node",name:"LAMP",group:{type:"group",a:[{type:"node_param",name:"ma",qualifier:["const","float"]},{type:"node_out",name:"nr",qualifier:["vec3"]},{type:"node_out",name:"ns",qualifier:["vec3"]},{type:"node_out",name:"nt",qualifier:["float"]},
{type:"node_out",name:"nu",qualifier:["float"]},{type:"textline",b:"{ const int nv = int ( ma ) ; vec4 nw = u_lamp_light_factors [ nv ] ; vec3 nx = u_lamp_light_directions [ nv ] ; vec3 ny = u_lamp_light_positions [ nv ] ; float nz = nw . z ; nr = u_lamp_light_color_intensities [ nv ] ; if ( nz != - UNITY_VALUE_NODES ) { ns = ny - kq ; nt = length ( ns ) ; ns = normalize ( ns ) ; nu = nz / ( nz + nt * nt ) ; float nA = nw . x ; float nB = nw . y ; if ( nA > - UNITY_VALUE_NODES ) { float nC = dot ( ns , nx ) ; nC *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nC - nA ) / nB ) ; nu *= nC ; } } else { ns = nx ; nt = length ( ny - kq ) ; nu = UNITY_VALUE_NODES ; } }".split(" ")}]}},
{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"mb",qualifier:["vec3"]},{type:"node_in",name:"nD",qualifier:["vec3"]},{type:"node_out",name:"nE",qualifier:["vec3"]},{type:"node_out",name:"nF",qualifier:["float"]},{type:"textline",b:"nE = mb ; nF = - dot ( nD , mb ) ;".split(" ")}]}},{type:"node",name:"VECTOR_VIEW",group:{type:"group",a:[{type:"node_in",name:"nG",qualifier:["vec3"]},{type:"node_out",name:"nH",qualifier:["vec3"]},{type:"textline",b:"nH = - ( u_view_matrix_frag * vec4 ( nG , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]}},
{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"mc",qualifier:["vec3"]},{type:"node_in",name:"nI",qualifier:["vec3"]},{type:"node_out",name:"nJ",qualifier:["vec3"]},{type:"textline",b:"nJ = nI * mc ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"md",qualifier:["mat4"]},{type:"node_param",name:"me",qualifier:["float"]},{type:"node_param",name:"mf",qualifier:["float"]},{type:"node_param",name:"mg",qualifier:["vec3"]},
{type:"node_param",name:"mh",qualifier:["vec3"]},{type:"node_in",name:"nK",qualifier:["vec3"]},{type:"node_out",name:"nL",qualifier:["vec3"]},{type:"textline",b:"nL = ( md * vec4 ( nK , UNITY_VALUE_NODES ) ) . xyz ; if ( me == UNITY_VALUE_NODES ) nL = max ( nL , mg ) ; if ( mf == UNITY_VALUE_NODES ) nL = min ( nL , mh ) ;".split(" ")}]}},{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"nM",qualifier:["float"]},{type:"node_in",name:"nN",qualifier:["float"]},{type:"node_out",
name:"nO",qualifier:["float"]},{type:"textline",b:"nO = nM + nN ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"nP",qualifier:["float"]},{type:"node_in",name:"nQ",qualifier:["float"]},{type:"node_out",name:"nR",qualifier:["float"]},{type:"textline",b:"nR = nP - nQ ;".split(" ")}]}},{type:"node",name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"nS",qualifier:["float"]},{type:"node_in",name:"nT",qualifier:["float"]},{type:"node_out",name:"nU",
qualifier:["float"]},{type:"textline",b:"nU = nS * nT ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"nV",qualifier:["float"]},{type:"node_in",name:"nW",qualifier:["float"]},{type:"node_out",name:"nX",qualifier:["float"]},{type:"textline",b:"nX = ( nW != ZERO_VALUE_NODES ) ? nV / nW : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"nY",qualifier:["float"]},{type:"node_in",name:"nZ",qualifier:["float"]},
{type:"node_out",name:"n_",qualifier:["float"]},{type:"textline",b:"n_ = sin ( nY ) ; nZ ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"oa",qualifier:["float"]},{type:"node_in",name:"ob",qualifier:["float"]},{type:"node_out",name:"oc",qualifier:["float"]},{type:"textline",b:"oc = cos ( oa ) ; ob ;".split(" ")}]}},{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"od",qualifier:["float"]},{type:"node_in",name:"oe",qualifier:["float"]},
{type:"node_out",name:"of",qualifier:["float"]},{type:"textline",b:"of = tan ( od ) ; oe ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"og",qualifier:["float"]},{type:"node_in",name:"oh",qualifier:["float"]},{type:"node_out",name:"oi",qualifier:["float"]},{type:"textline",b:"oi = ( og <= UNITY_VALUE_NODES && og >= - UNITY_VALUE_NODES ) ? asin ( og ) : ZERO_VALUE_NODES ; oh ;".split(" ")}]}},{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",
name:"oj",qualifier:["float"]},{type:"node_in",name:"ok",qualifier:["float"]},{type:"node_out",name:"ol",qualifier:["float"]},{type:"textline",b:"ol = ( oj <= UNITY_VALUE_NODES && oj >= - UNITY_VALUE_NODES ) ? acos ( oj ) : ZERO_VALUE_NODES ; ok ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"om",qualifier:["float"]},{type:"node_in",name:"on",qualifier:["float"]},{type:"node_out",name:"oo",qualifier:["float"]},{type:"textline",b:"oo = atan ( om ) ; on ;".split(" ")}]}},
{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"op",qualifier:["float"]},{type:"node_in",name:"oq",qualifier:["float"]},{type:"node_out",name:"or",qualifier:["float"]},{type:"textline",b:"if ( op < ZERO_VALUE_NODES || op == ZERO_VALUE_NODES && oq == ZERO_VALUE_NODES ) or = ZERO_VALUE_NODES ; else or = pow ( op , oq ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",a:[{type:"node_in",name:"os",qualifier:["float"]},{type:"node_in",name:"ot",qualifier:["float"]},
{type:"node_out",name:"ou",qualifier:["float"]},{type:"textline",b:"ou = ( os > ZERO_VALUE_NODES && ot > ZERO_VALUE_NODES ) ? log2 ( os ) / log2 ( ot ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"ov",qualifier:["float"]},{type:"node_in",name:"ow",qualifier:["float"]},{type:"node_out",name:"ox",qualifier:["float"]},{type:"textline",b:"ox = min ( ov , ow ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",
name:"oy",qualifier:["float"]},{type:"node_in",name:"oz",qualifier:["float"]},{type:"node_out",name:"oA",qualifier:["float"]},{type:"textline",b:"oA = max ( oy , oz ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"oB",qualifier:["float"]},{type:"node_in",name:"oC",qualifier:["float"]},{type:"node_out",name:"oD",qualifier:["float"]},{type:"textline",b:"oD = floor ( oB + 0.5 ) ; oC ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",
a:[{type:"node_in",name:"oE",qualifier:["float"]},{type:"node_in",name:"oF",qualifier:["float"]},{type:"node_out",name:"oG",qualifier:["float"]},{type:"textline",b:"oG = ( oE < oF ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"oH",qualifier:["float"]},{type:"node_in",name:"oI",qualifier:["float"]},{type:"node_out",name:"oJ",qualifier:["float"]},{type:"textline",b:"oJ = ( oH > oI ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},
{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"oK",qualifier:["float"]},{type:"node_in",name:"oL",qualifier:["float"]},{type:"node_out",name:"oM",qualifier:["float"]},{type:"textline",b:"oM = abs ( oL ) > 0.000001 ? mod ( oK , oL ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_ABSOLUTE",group:{type:"group",a:[{type:"node_in",name:"oN",qualifier:["float"]},{type:"node_in",name:"oO",qualifier:["float"]},{type:"node_out",name:"oP",qualifier:["float"]},{type:"textline",
b:"oP = abs ( oN ) ; oO ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"oQ",qualifier:["float"]},{type:"node_in",name:"oR",qualifier:["vec3"]},{type:"node_in",name:"oS",qualifier:["vec3"]},{type:"node_out",name:"oT",qualifier:["vec3"]},{type:"textline",b:"{ float oU = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oT = mix ( oR , oS , oU ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"oV",qualifier:["float"]},
{type:"node_in",name:"oW",qualifier:["vec3"]},{type:"node_in",name:"oX",qualifier:["vec3"]},{type:"node_out",name:"oY",qualifier:["vec3"]},{type:"textline",b:"{ float oZ = clamp ( oV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oY = mix ( oW , oW + oX , oZ ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"o_",qualifier:["float"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",
qualifier:["vec3"]},{type:"textline",b:"{ float pd = clamp ( o_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pc = mix ( pa , pa * pb , pd ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"pe",qualifier:["float"]},{type:"node_in",name:"pf",qualifier:["vec3"]},{type:"node_in",name:"pg",qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["vec3"]},{type:"textline",b:"{ float pi = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ph = mix ( pf , pf - pg , pi ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"pj",qualifier:["float"]},{type:"node_in",name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_out",name:"pm",qualifier:["vec3"]},{type:"textline",b:"{ float pn = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float po = UNITY_VALUE_NODES - pn ; pm = lf - ( vec3 ( po ) + pn * ( lf - pl ) ) * ( lf - pk ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",
a:[{type:"node_in",name:"pp",qualifier:["float"]},{type:"node_in",name:"pq",qualifier:["vec3"]},{type:"node_in",name:"pr",qualifier:["vec3"]},{type:"node_out",name:"ps",qualifier:["vec3"]},{type:"textline",b:"{ float pt = clamp ( pp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pu = UNITY_VALUE_NODES - pt ; pr += step ( pr , lg ) ; ps = pu * pq + pt * pq / pr ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",group:{type:"group",a:[{type:"node_in",name:"pv",qualifier:["float"]},{type:"node_in",
name:"pw",qualifier:["vec3"]},{type:"node_in",name:"px",qualifier:["vec3"]},{type:"node_out",name:"py",qualifier:["vec3"]},{type:"textline",b:"{ float pz = clamp ( pv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; py = mix ( pw , abs ( pw - px ) , pz ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"pA",qualifier:["float"]},{type:"node_in",name:"pB",qualifier:["vec3"]},{type:"node_in",name:"pC",qualifier:["vec3"]},{type:"node_out",name:"pD",qualifier:["vec3"]},
{type:"textline",b:"{ float pE = clamp ( pA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pD = min ( pB . rgb , pC . rgb * pE ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"pF",qualifier:["float"]},{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"textline",b:"{ float pJ = clamp ( pF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pI = max ( pG . rgb , pH . rgb * pJ ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"pK",qualifier:["float"]},{type:"node_in",name:"pL",qualifier:["vec3"]},{type:"node_in",name:"pM",qualifier:["vec3"]},{type:"node_out",name:"pN",qualifier:["vec3"]},{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pP = UNITY_VALUE_NODES - pO ; vec3 pQ = vec3 ( pP ) ; pN = mix ( pL * ( pQ + 2.0 * pO * pM ) , lf - ( pQ + 2.0 * pO * ( lf - pM ) ) * ( lf - pL ) , step ( 0.5 , pL ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"pR",qualifier:["float"]},{type:"node_in",name:"pS",qualifier:["vec3"]},{type:"node_in",name:"pT",qualifier:["vec3"]},{type:"node_out",name:"pU",qualifier:["vec3"]},{type:"textline",b:"{ float pV = clamp ( pR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pW = lf - pV * pT ; vec3 pX = pS / ( pW + step ( pW , lg ) ) ; pU = ( lf - step ( pS , lg ) ) * mix ( mix ( lf , pX , step ( pX , lf ) ) , lf , step ( pW , lg ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"pY",qualifier:["float"]},{type:"node_in",name:"pZ",qualifier:["vec3"]},{type:"node_in",name:"p_",qualifier:["vec3"]},{type:"node_out",name:"qa",qualifier:["vec3"]},{type:"textline",b:"{ float qb = clamp ( pY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qc = lf - qb * ( lf - p_ ) ; vec3 qd = lf - ( lf - pZ ) / ( qc + step ( qc , lg ) ) ; qa = mix ( mix ( lg , mix ( lf , qd , step ( qd , lf ) ) , step ( ZERO_VALUE_NODES , qd ) ) , lg , step ( qc , lg ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"qe",qualifier:["float"]},{type:"node_in",name:"qf",qualifier:["vec3"]},{type:"node_in",name:"qg",qualifier:["vec3"]},{type:"node_out",name:"qh",qualifier:["vec3"]},{type:"textline",b:"{ float qi = clamp ( qe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qj , qk , ql ; qh = qf ; qk = lu ( qg ) ; if ( qk . y != ZERO_VALUE_NODES ) { qj = lu ( qh ) ; qj . x = qk . x ; ql = ly ( qj ) ; qh = mix ( qh , ql , qi ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SATURATION",group:{type:"group",a:[{type:"node_in",name:"qm",qualifier:["float"]},{type:"node_in",name:"qn",qualifier:["vec3"]},{type:"node_in",name:"qo",qualifier:["vec3"]},{type:"node_out",name:"qp",qualifier:["vec3"]},{type:"textline",b:"{ float qq = clamp ( qm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qr = UNITY_VALUE_NODES - qq ; qp = qn ; vec3 qs , qt ; qs = lu ( qp ) ; if ( qs . y != ZERO_VALUE_NODES ) { qt = lu ( qo ) ; qs . y = qr * qs . y + qq * qt . y ; qp = ly ( qs ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",name:"qu",qualifier:["float"]},{type:"node_in",name:"qv",qualifier:["vec3"]},{type:"node_in",name:"qw",qualifier:["vec3"]},{type:"node_out",name:"qx",qualifier:["vec3"]},{type:"textline",b:"{ float qy = clamp ( qu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qz = UNITY_VALUE_NODES - qy ; vec3 qA , qB ; qA = lu ( qv ) ; qB = lu ( qw ) ; qA . z = qz * qA . z + qy * qB . z ; qx = ly ( qA ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",
group:{type:"group",a:[{type:"node_in",name:"qC",qualifier:["float"]},{type:"node_in",name:"qD",qualifier:["vec3"]},{type:"node_in",name:"qE",qualifier:["vec3"]},{type:"node_out",name:"qF",qualifier:["vec3"]},{type:"textline",b:"{ float qG = clamp ( qC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qH , qI , qJ ; qF = qD ; qI = lu ( qE ) ; if ( qI . y != ZERO_VALUE_NODES ) { qH = lu ( qF ) ; qH . x = qI . x ; qH . y = qI . y ; qJ = ly ( qH ) ; qF = mix ( qF , qJ , qG ) ; } }".split(" ")}]}},{type:"node",
name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"qK",qualifier:["float"]},{type:"node_in",name:"qL",qualifier:["vec3"]},{type:"node_in",name:"qM",qualifier:["vec3"]},{type:"node_out",name:"qN",qualifier:["vec3"]},{type:"textline",b:"{ float qO = clamp ( qK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qP = UNITY_VALUE_NODES - qO ; vec3 qQ = qM + qL - qM * qL ; qN = qL * ( vec3 ( qP ) + vec3 ( qO ) * ( ( lf - qL ) * qM + qQ ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",
group:{type:"group",a:[{type:"node_in",name:"qR",qualifier:["float"]},{type:"node_in",name:"qS",qualifier:["vec3"]},{type:"node_in",name:"qT",qualifier:["vec3"]},{type:"node_out",name:"qU",qualifier:["vec3"]},{type:"textline",b:"{ float qV = clamp ( qR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qU = clamp ( qS + qV * ( 2.0 * qT - lf ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; }".split(" ")}]}},{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"qW",qualifier:["vec3"]},{type:"node_in",
name:"qX",qualifier:["float"]},{type:"textline",b:"mF = qW ; mK = qX ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"mi",qualifier:["const","vec3"]},{type:"node_param",name:"mj",qualifier:["const","vec4"]},{type:"node_param",name:"mk",qualifier:["const","float"]},{type:"node_in",name:"qY",qualifier:["vec3"]},{type:"node_in",name:"qZ",qualifier:["float"]},{type:"node_in",name:"q_",qualifier:["vec3"]},{type:"node_in",name:"ra",qualifier:["vec3"]},{type:"node_out",
name:"rb",qualifier:["vec3"]},{type:"node_out",name:"rc",qualifier:["float"]},{type:"node_out",name:"rd",qualifier:["vec3"]},{type:"textline",b:"{ qY = clamp ( qY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qZ = clamp ( qZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; q_ = clamp ( q_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 re = qY ; float rf = mi [ 0 ] ; vec2 rg = vec2 ( mi [ 1 ] , mi [ 2 ] ) ; vec3 rh = mC * qY ; vec3 ri = mj [ 1 ] * q_ ; float rj = mj [ 0 ] ; vec2 rk = vec2 ( mj [ 2 ] , mj [ 3 ] ) ; float rl = fi ( re ) ; vec3 rm ; if ( mk == UNITY_VALUE_NODES ) rm = normalize ( ra ) ; else rm = mx ; float rn = 0.5 * rm . y + 0.5 ; vec3 ro = mE * u_environment_energy * ln ( rn , rm ) ; hm rp = lV ( rh , ro , re , ri , mA , rm , mz , rk , rg , rl , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ; rb = ( rf == UNITY_VALUE_NODES ) ? rp . a . rgb : lg ; rc = qZ ; rd = rm ; if ( rj == UNITY_VALUE_NODES ) { rc += rp . a . a * ri . r * mD ; rc = clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rb += rp . b ; mG = rp . b ; } else { mG = lg ; } mH = rm ; mJ = rl ; }".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"ml",qualifier:["const","vec3"]},{type:"node_param",name:"mm",qualifier:["const","vec4"]},{type:"node_param",name:"mn",qualifier:["const","float"]},{type:"node_in",name:"rq",qualifier:["vec3"]},{type:"node_in",name:"rr",qualifier:["float"]},{type:"node_in",name:"rs",qualifier:["vec3"]},{type:"node_in",name:"rt",qualifier:["vec3"]},{type:"node_in",name:"ru",qualifier:["float"]},{type:"node_in",name:"rv",qualifier:["float"]},
{type:"node_in",name:"rw",qualifier:["vec4"]},{type:"node_in",name:"rx",qualifier:["float"]},{type:"node_in",name:"ry",qualifier:["float"]},{type:"node_out",name:"rz",qualifier:["vec3"]},{type:"node_out",name:"rA",qualifier:["float"]},{type:"node_out",name:"rB",qualifier:["vec3"]},{type:"node_out",name:"rC",qualifier:["vec3"]},{type:"node_out",name:"rD",qualifier:["vec3"]},{type:"textline",b:"{ rq = clamp ( rq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rr = clamp ( rr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rs = clamp ( rs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rE = rq ; float rF = ml [ 0 ] ; vec2 rG = vec2 ( ml [ 1 ] , ml [ 2 ] ) ; vec3 rH = ru * rq ; vec3 rI = mm [ 1 ] * rs ; float rJ = mm [ 0 ] ; vec2 rK = vec2 ( mm [ 2 ] , mm [ 3 ] ) ; float rL = fi ( rE ) ; vec3 rM ; if ( mn == UNITY_VALUE_NODES ) rM = normalize ( rt ) ; else rM = mx ; float rN = 0.5 * rM . y + 0.5 ; vec3 rO = mE * u_environment_energy * ln ( rN , rM ) ; hm rP = lV ( rH , rO , rE , rI , mA , rM , mz , rK , rG , rL , rv , rw ) ; rz = ( rF == UNITY_VALUE_NODES ) ? rP . a . rgb : lg ; rA = rr ; rB = rM ; rC = rP . a . rgb ; rD = rP . b ; lH ( rz , mz , rB , rx ) ; if ( rJ == UNITY_VALUE_NODES ) { rz += rP . b ; rA += rP . a . a * rI . r * ry ; rA = clamp ( rA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = rP . b ; } else { mG = lg ; } mH = rM ; mJ = rL ; }".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"mo",qualifier:["vec3"]},{type:"node_out",name:"rQ",qualifier:["vec3"]},{type:"textline",b:["rQ","=","mo",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"rR",qualifier:["vec3"]},{type:"node_out",name:"rS",qualifier:["float"]},{type:"textline",b:"rS = rR . r * 0.35 + rR . g * 0.45 + rR . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"rT",qualifier:["vec3"]},
{type:"node_out",name:"rU",qualifier:["float"]},{type:"node_out",name:"rV",qualifier:["float"]},{type:"node_out",name:"rW",qualifier:["float"]},{type:"textline",b:"rU = rT . r ; rV = rT . g ; rW = rT . b ;".split(" ")}]}},{type:"node",name:"SEPHSV",group:{type:"group",a:[{type:"node_in",name:"rX",qualifier:["vec3"]},{type:"node_out",name:"rY",qualifier:["float"]},{type:"node_out",name:"rZ",qualifier:["float"]},{type:"node_out",name:"r_",qualifier:["float"]},{type:"textline",b:"{ vec3 sa = lu ( rX ) ; rY = sa . r ; rZ = sa . g ; r_ = sa . b ; }".split(" ")}]}},
{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"sb",qualifier:["float"]},{type:"node_in",name:"sc",qualifier:["float"]},{type:"node_in",name:"sd",qualifier:["float"]},{type:"node_out",name:"se",qualifier:["float"]},{type:"textline",b:"se = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( sb - sd ) * sc ) ) ) ;".split(" ")}]}},{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"sf",qualifier:["vec3"]},{type:"node_out",name:"sg",
qualifier:["vec3"]},{type:"textline",b:"sg = max ( lg , sf ) ; sg = pow ( sg , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"sh",qualifier:["vec3"]},{type:"node_out",name:"si",qualifier:["vec3"]},{type:"textline",b:"si = max ( lg , sh ) ; si = pow ( si , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"sj",qualifier:["vec3"]},{type:"node_out",name:"sk",qualifier:["vec3"]},{type:"node_out",name:"sl",qualifier:["float"]},{type:"textline",b:"{ vec4 sm = texture2D ( node_TEXTURE_COLOR_var_texture , lC ( sj ) ) ; sk = sm . xyz ; go ( sk ) ; sl = sm . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sn",qualifier:["vec3"]},
{type:"node_out",name:"so",qualifier:["vec3"]},{type:"node_out",name:"sp",qualifier:["float"]},{type:"textline",b:"{ vec4 sq = texture2D ( node_TEXTURE_NORMAL_var_texture , lC ( sn ) ) ; mI = sq . xyz - 0.5 ; so = normalize ( mw * mI ) ; sp = sq . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",name:"sr",qualifier:["vec3"]},{type:"node_out",name:"ss",
qualifier:["vec3"]},{type:"node_out",name:"st",qualifier:["float"]},{type:"textline",b:"{ vec4 su = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , sr ) ; ss = su . xyz ; go ( ss ) ; st = su . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sv",qualifier:["vec3"]},{type:"node_in",name:"sw",qualifier:["vec3"]},{type:"node_out",name:"sx",qualifier:["vec3"]},
{type:"node_out",name:"sy",qualifier:["float"]},{type:"node_out",name:"sz",qualifier:["vec3"]},{type:"node_out",name:"sA",qualifier:["float"]},{type:"textline",b:"{ vec4 sB = texture2D ( node_TEXTURE_COLOR2_var_texture , lC ( sv ) ) ; sx = sB . xyz ; go ( sx ) ; sy = sB . w ; sB = texture2D ( node_TEXTURE_COLOR2_var_texture , lC ( sw ) ) ; sz = sB . xyz ; go ( sz ) ; sA = sB . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",
qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sC",qualifier:["vec3"]},{type:"node_in",name:"sD",qualifier:["vec3"]},{type:"node_out",name:"sE",qualifier:["vec3"]},{type:"node_out",name:"sF",qualifier:["float"]},{type:"node_out",name:"sG",qualifier:["vec3"]},{type:"node_out",name:"sH",qualifier:["float"]},{type:"textline",b:"{ vec4 sI = texture2D ( node_TEXTURE_NORMAL2_var_texture , lC ( sC ) ) ; mI = sI . xyz - 0.5 ; sE = normalize ( mw * mI ) ; sF = sI . w ; sI = texture2D ( node_TEXTURE_NORMAL2_var_texture , lC ( sD ) ) ; mI = sI . xyz - 0.5 ; sG = normalize ( mw * mI ) ; sH = sI . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sJ",qualifier:["vec3"]},{type:"node_in",name:"sK",qualifier:["vec3"]},{type:"node_in",name:"sL",qualifier:["vec3"]},{type:"node_out",name:"sM",qualifier:["vec3"]},{type:"node_out",name:"sN",qualifier:["float"]},{type:"node_out",name:"sO",qualifier:["vec3"]},{type:"node_out",name:"sP",qualifier:["float"]},{type:"node_out",name:"sQ",
qualifier:["vec3"]},{type:"node_out",name:"sR",qualifier:["float"]},{type:"textline",b:"{ vec4 sS = texture2D ( node_TEXTURE_COLOR3_var_texture , lC ( sJ ) ) ; sM = sS . xyz ; go ( sM ) ; sN = sS . w ; sS = texture2D ( node_TEXTURE_COLOR3_var_texture , lC ( sK ) ) ; sO = sS . xyz ; go ( sO ) ; sP = sS . w ; sS = texture2D ( node_TEXTURE_COLOR3_var_texture , lC ( sL ) ) ; sQ = sS . xyz ; go ( sQ ) ; sR = sS . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR4",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sT",qualifier:["vec3"]},{type:"node_in",name:"sU",qualifier:["vec3"]},{type:"node_in",name:"sV",qualifier:["vec3"]},{type:"node_in",name:"sW",qualifier:["vec3"]},{type:"node_out",name:"sX",qualifier:["vec3"]},{type:"node_out",name:"sY",qualifier:["float"]},{type:"node_out",name:"sZ",qualifier:["vec3"]},{type:"node_out",name:"s_",qualifier:["float"]},{type:"node_out",name:"ta",qualifier:["vec3"]},{type:"node_out",
name:"tb",qualifier:["float"]},{type:"node_out",name:"tc",qualifier:["vec3"]},{type:"node_out",name:"td",qualifier:["float"]},{type:"textline",b:"{ vec4 te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sT ) ) ; sX = te . xyz ; go ( sX ) ; sY = te . w ; te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sU ) ) ; sZ = te . xyz ; go ( sZ ) ; s_ = te . w ; te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sV ) ) ; ta = te . xyz ; go ( ta ) ; tb = te . w ; te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sW ) ) ; tc = te . xyz ; go ( tc ) ; td = te . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tf",qualifier:["vec3"]},{type:"node_in",name:"tg",qualifier:["vec3"]},{type:"node_in",name:"th",qualifier:["vec3"]},{type:"node_out",name:"ti",qualifier:["vec3"]},{type:"node_out",name:"tj",qualifier:["float"]},{type:"node_out",name:"tk",qualifier:["vec3"]},{type:"node_out",name:"tl",qualifier:["float"]},{type:"node_out",name:"tm",
qualifier:["vec3"]},{type:"node_out",name:"tn",qualifier:["float"]},{type:"textline",b:"{ vec4 to = texture2D ( node_TEXTURE_NORMAL3_var_texture , lC ( tf ) ) ; mI = to . xyz - 0.5 ; ti = normalize ( mw * mI ) ; tj = to . w ; to = texture2D ( node_TEXTURE_NORMAL3_var_texture , lC ( tg ) ) ; mI = to . xyz - 0.5 ; tk = normalize ( mw * mI ) ; tl = to . w ; to = texture2D ( node_TEXTURE_NORMAL3_var_texture , lC ( th ) ) ; mI = to . xyz - 0.5 ; tm = normalize ( mw * mI ) ; tn = to . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL4",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tp",qualifier:["vec3"]},{type:"node_in",name:"tq",qualifier:["vec3"]},{type:"node_in",name:"tr",qualifier:["vec3"]},{type:"node_in",name:"ts",qualifier:["vec3"]},{type:"node_out",name:"tt",qualifier:["vec3"]},{type:"node_out",name:"tu",qualifier:["float"]},{type:"node_out",name:"tv",qualifier:["vec3"]},{type:"node_out",name:"tw",
qualifier:["float"]},{type:"node_out",name:"tx",qualifier:["vec3"]},{type:"node_out",name:"ty",qualifier:["float"]},{type:"node_out",name:"tz",qualifier:["vec3"]},{type:"node_out",name:"tA",qualifier:["float"]},{type:"textline",b:"{ vec4 tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( tp ) ) ; mI = tB . xyz - 0.5 ; tt = normalize ( mw * mI ) ; tu = tB . w ; tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( tq ) ) ; mI = tB . xyz - 0.5 ; tv = normalize ( mw * mI ) ; tw = tB . w ; tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( tr ) ) ; mI = tB . xyz - 0.5 ; tx = normalize ( mw * mI ) ; ty = tB . w ; tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( ts ) ) ; mI = tB . xyz - 0.5 ; tz = normalize ( mw * mI ) ; tA = tB . w ; }".split(" ")}]}},
{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"mp",qualifier:["const","float"]},{type:"node_out",name:"tC",qualifier:["float"]},{type:"textline",b:["tC","=","mp",";"]}]}},{type:"node",name:"ANIM_VALUE",group:{type:"group",a:[{type:"node_param",name:"mq",qualifier:["const","int"]},{type:"node_out",name:"tD",qualifier:["float"]},{type:"textline",b:"tD = u_anim_values [ mq ] ;".split(" ")}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"tE",
qualifier:["vec3"]},{type:"node_in",name:"tF",qualifier:["vec3"]},{type:"node_out",name:"tG",qualifier:["vec3"]},{type:"node_out",name:"tH",qualifier:["float"]},{type:"textline",b:"tG = tE + tF ; tH = ( abs ( tG [ 0 ] ) + abs ( tG [ 1 ] ) + abs ( tG [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"tI",qualifier:["vec3"]},{type:"node_in",name:"tJ",qualifier:["vec3"]},{type:"node_out",name:"tK",qualifier:["vec3"]},{type:"node_out",
name:"tL",qualifier:["float"]},{type:"textline",b:"tK = tI - tJ ; tL = ( abs ( tK [ 0 ] ) + abs ( tK [ 1 ] ) + abs ( tK [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"tM",qualifier:["vec3"]},{type:"node_in",name:"tN",qualifier:["vec3"]},{type:"node_out",name:"tO",qualifier:["vec3"]},{type:"node_out",name:"tP",qualifier:["float"]},{type:"textline",b:"tO = tM + tN ; tP = length ( tO ) ; tO = normalize ( tO ) ;".split(" ")}]}},{type:"node",
name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"tQ",qualifier:["vec3"]},{type:"node_in",name:"tR",qualifier:["vec3"]},{type:"node_out",name:"tS",qualifier:["vec3"]},{type:"node_out",name:"tT",qualifier:["float"]},{type:"textline",b:"tS = lg ; tT = dot ( tQ , tR ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"tU",qualifier:["vec3"]},{type:"node_in",name:"tV",qualifier:["vec3"]},{type:"node_out",name:"tW",qualifier:["vec3"]},
{type:"node_out",name:"tX",qualifier:["float"]},{type:"textline",b:"tW = cross ( tU , tV ) ; tX = length ( tW ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"tY",qualifier:["vec3"]},{type:"node_in",name:"tZ",qualifier:["vec3"]},{type:"node_out",name:"t_",qualifier:["vec3"]},{type:"node_out",name:"ua",qualifier:["float"]},{type:"textline",b:"t_ = normalize ( tY ) ; ua = length ( tY ) ; tZ ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",
a:[{type:"node_in",name:"ub",qualifier:["vec3"]},{type:"node_in",name:"uc",qualifier:["vec3"]},{type:"node_out",name:"ud",qualifier:["vec3"]},{type:"textline",b:"ud = reflect ( - ub , uc ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"ue",qualifier:["vec3"]},{type:"node_in",name:"uf",qualifier:["float"]},{type:"node_in",name:"ug",qualifier:["const","float"]},{type:"node_in",
name:"uh",qualifier:["const","float"]},{type:"node_out",name:"ui",qualifier:["vec3"]},{type:"textline",b:"{ float uj = length ( mB ) ; if ( uj < uh ) { vec2 uk = lC ( ue ) ; float ul = clamp ( 0.5 * ( uh - uj ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float um = uf * ul ; vec3 un = normalize ( mz * mw ) ; float uo = UNITY_VALUE_NODES / ug ; vec2 up = un . xy * um / ( ug * un . z ) ; float uq = UNITY_VALUE_NODES ; float ur = texture2D ( node_PARALLAX_var_texture , uk ) . a ; for ( float us = 1.0 ; us <= ug ; us ++ ) { if ( ur < uq ) { uq -= uo ; uk -= up ; ur = texture2D ( node_PARALLAX_var_texture , uk ) . a ; } } vec2 ut = uk + up ; float uu = texture2D ( node_PARALLAX_var_texture , ut ) . a - ( uq + uo ) ; float uv = ur - uq ; float uw = uv / ( uv - uu ) ; uk = uw * ut + ( UNITY_VALUE_NODES - uw ) * uk ; ui = lA ( uk ) ; } else ui = ue ; }".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"ux",qualifier:["vec3"]},{type:"node_out",name:"uy",qualifier:["vec3"]},{type:"textline",b:"uy = clamp ( ux , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}},{type:"node",name:"REFRACTION",group:{type:"group",a:[{type:"node_in",name:"uz",qualifier:["vec3"]},{type:"node_in",name:"uA",qualifier:["float"]},{type:"node_out",name:"uB",qualifier:["vec3"]},{type:"textline",b:"uB = lk ( uz , uA ) ;".split(" ")}]}},{type:"node",
name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"uC",qualifier:["float"]},{type:"node_in",name:"uD",qualifier:["float"]},{type:"node_in",name:"uE",qualifier:["float"]},{type:"node_in",name:"uF",qualifier:["float"]},{type:"node_in",name:"uG",qualifier:["float"]},{type:"node_out",name:"uH",qualifier:["float"]},{type:"node_out",name:"uI",qualifier:["vec4"]},{type:"textline",b:"uH = uC ; uI = vec4 ( uD , uE , uF , uG ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",
name:"uJ",qualifier:["float"]},{type:"textline",b:["uJ","=","u_time",";"]}]}},{type:"node",name:"SMOOTHSTEP",group:{type:"group",a:[{type:"node_in",name:"uK",qualifier:["float"]},{type:"node_in",name:"uL",qualifier:["float"]},{type:"node_in",name:"uM",qualifier:["float"]},{type:"node_out",name:"uN",qualifier:["float"]},{type:"textline",b:"uN = smoothstep ( uL , uM , uK ) ;".split(" ")}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["vec3","mr","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float ms = kq . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mt","=","kr",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",
a:[{type:"textline",b:"if ( gl_FrontFacing ) mt = mt ; else mt = - mt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mu = cross ( mt , ks . xyz ) * ks . w ; mat3 mv = mat3 ( ks . xyz , mu , mt ) ; mat3 mw = mv ;".split(" ")}]}}]},{type:"textline",b:"vec3 mx = normalize ( mt ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 my = u_camera_eye_frag - kq ; vec3 mz = normalize ( my ) ; vec3 mA = kq ; vec4 mB = cE ; float mC = u_emit ; float mD = u_specular_alpha ; float mE = u_ambient ; vec3 mF ; vec3 mG ; vec3 mH ; vec3 mI ; float mJ ; float mK ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 uO = mF ; float uP = mK ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uO = max ( uO - sqrt ( 0.01 * - min ( ms , ZERO_VALUE_NODES ) ) , 0.5 * uO ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"ko ( uO , ms , u_time , mJ , mH , u_sun_direction , mr , u_sun_quaternion , kq , length ( cE ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float uQ = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uR = gI ( u_cube_fog , mz ) ; vec4 uS = vec4 ( uR , u_fog_color_density . a ) ; go ( uS . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 uS = u_fog_color_density ; uS . rgb *= uQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ha ( uO , length ( cE ) , mz , u_cam_water_depth , u_underwater_fog_color_density , uS , ms , uQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gB ( uO , length ( cE ) , uS ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( uP < 0.5 ) discard ; uP = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uT = texture2DProj ( u_shadow_mask , cD ) . rg ; float uU = uT . g ; uO = vec3 ( uU ) ;".split(" ")}]}}]},{type:"textline",b:["gq","(","uO",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",
b:"gt ( uO , uP ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uO , uP ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",
";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kq ; varying vec4 cE ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ks",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"lW",qualifier:["varying","vec2"]},{type:"textline",b:["lW","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ma",qualifier:["varying","vec3"]},{type:"textline",b:["ma","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"mb",qualifier:["varying","float"]},{type:"textline",b:["mb","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"mc",qualifier:["varying","vec2"]},{type:"textline",b:["mc","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",
a:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"md",qualifier:["varying","vec3"]},{type:"textline",b:["md","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 me = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3",
"mf","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( a_tangent ) ; vec3 mh = a_tangent [ 3 ] * cross ( mf , mg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ; vec3 mh = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mf = vec3 ( 0.0 ) ; vec3 mg = vec3 ( 0.0 ) ; vec3 mh = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"me = mix ( me , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mi = vec3 ( a_tangent ) ; vec3 mj = a_tangent_next [ 3 ] * cross ( a_normal_next , mi ) ; mg = mix ( mg , mi , u_va_frame_factor ) ; mh = mix ( mh , mj , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bm ( me , mg , mh , mf ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","mk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ml = ( u_model_matrix * vec4 ( mk , 1.0 ) ) . xyz ; mat4 mm = _ ( u_camera_eye , ml , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mn = ( u_model_matrix * vec4 ( mk , 1.0 ) ) . xyz ; mm = mm * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mn ) ;".split(" ")}]}}]},{type:"textline",b:"c mo = ag ( me - mk , mk , mg , mh , mf , mm ) ; mo . b = ml ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c mo = ag ( me , mk , mg , mh , mf , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( mo . a , mo . b , mf ) ;".split(" ")}]}}]},{type:"textline",b:"kq = mo . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"kr = mo . e ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mp = ( dot ( cross ( mo . e , mo . c ) , mo . d ) < 0.0 ) ? - 1.0 : 1.0 ; ks = vec4 ( mo . c , mp ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"cE = u_view_matrix * vec4 ( mo . a , 1.0 ) ; vec4 mq = u_proj_matrix * cE ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mq . xy += u_subpixel_jitter * mq . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gh","(","mq",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gh ( mo . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mr = mq . x ; float ms = mq . y ; float mt = mq . w ; cD . x = ( mr + mt ) / 2.0 ; cD . y = ( ms + mt ) / 2.0 ; cD . z = mt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ku = - cE . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},
{type:"textline",b:["gl_Position","=","mq",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float me ; varying vec3 kt ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"textline",b:"void main ( ) { float mf = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mg = smoothstep ( u_p_alpha_start , u_p_alpha_end , mf ) ; float mh = u_diffuse_color . a * me * ( 1.0 - clamp ( mg , 0.0 , 1.0 ) ) ; vec3 mi = kt * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:"gB ( mi , length ( cE ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gq","(","mi",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gt ( mi , mh ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mi , mh ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float me ; varying vec3 kt ; varying vec3 cE ;".split(" ")},{type:"include",file:"particles.glslv"},
{type:"textline",b:"void main ( ) { mf mX ; mX = mW ( ) ; vec4 mY = u_view_matrix * vec4 ( mX . b , 1.0 ) ; gl_Position = u_proj_matrix * mY ; me = mX . c ; kt = mX . d ; cE = mY . xyz ; float mZ = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mX . a * mZ ; }".split(" ")}]};a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float me ; varying vec3 kt ; varying vec2 a ; varying vec3 kp ; varying vec3 kq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lf = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lg = texture2D ( u_sampler , a ) ; go ( lg . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lf . rgb = mix ( lf . rgb , lg . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lf . rgb *= mix ( vec3 ( 1.0 ) , lg . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lf . a = lg . a ;".split(" ")}]}}]},{type:"textline",b:"lf . rgb *= kt ; vec3 lh = u_diffuse_intensity * lf . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 li = u_emit * lf . rgb ; vec3 lj = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lk = u_environment_energy * textureCube ( u_sky_texture , lj ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ll = 0.5 ; vec3 lk = u_environment_energy * mix ( u_horizon_color , u_zenith_color , ll ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lm = u_ambient * lk ; float ln = u_specular_params [ 0 ] ; vec2 lo = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lp = ln * u_specular_color ; vec3 lq = normalize ( kp ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hm lr = jJ ( li , lm , lh , lp , kq , lj , lq , lo , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm lr = jO ( li , lm , lh ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ls = lr . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","ls","=","lh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gB ( ls , length ( cE ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lt = lf . a * me ; gq ( ls ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gt ( ls , lt ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ls , lt ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ; varying float me ; varying vec3 kt ; varying vec2 a ; varying vec3 kp ; varying vec3 kq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lh ( vec2 lf , vec2 lg ) { return ( atan ( lg . y , lg . x ) - atan ( lf . y , lf . x ) ) ; } void main ( ) { mf li ; li = mW ( ) ; float lj ; mat4 lk ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { lj = li . e ; lk = y ( li . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { lj = li . e ; lk = j ( ) ; lk [ 3 ] = vec4 ( li . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { lj = li . e ; lk = n ( radians ( 90.0 ) ) ; lk [ 3 ] = vec4 ( li . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { lj = lh ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + li . e ; lk = l ( radians ( - 90.0 ) ) ; lk [ 3 ] = vec4 ( li . b , 1.0 ) ; } vec4 ll = vec4 ( a_p_bb_vertex * 2.0 * li . a * u_p_size , 0.0 , 1.0 ) ; vec4 lm = lk * p ( lj ) * ll ; vec4 ln = u_view_matrix * lm ; vec4 lo = u_proj_matrix * ln ; gl_Position = lo ; me = li . c ; kt = li . d ; a = a_p_bb_vertex + 0.5 ; kq = lm . xyz ; kp = u_camera_eye - lm . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cE","=","ln",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mX ; const float mY = 0.99 ; const float mZ = 1.8 ; const int m_ = 8 ; float nj ( vec3 na , vec3 nb ) { float nc = dot ( nb , nb ) ; float nd = 2.0 * dot ( nb , na ) ; float ne = dot ( na , na ) - 1.0 ; float nf = nd * nd - 4.0 * nc * ne ; float ng = sqrt ( nf ) ; float nh = ( - nd - ng ) / 2.0 ; float ni = ne / nh ; return ni ; } float nq ( float nk , float nl ) { float nm = 3.0 * ( 1.0 - nl * nl ) ; float nn = 2.0 * ( 2.0 + nl * nl ) ; float no = 1.0 + nk * nk ; float np = pow ( 1.0 + nl * nl - 2.0 * nl * nk , 1.5 ) ; np = max ( np , 0.00001 ) ; return ( nm / nn ) * ( no / np ) ; } float ny ( vec3 nr , vec3 ns , float nt ) { float nu = dot ( ns , - nr ) ; if ( nu < 0.0 ) { return 1.0 ; } vec3 nv = nr + nu * ns ; if ( length ( nv ) < nt ) { return 0.0 ; } else if ( length ( nv ) >= nt ) { vec3 nw = normalize ( nv ) * nt - nr ; float nx = acos ( dot ( normalize ( nw ) , ns ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nx * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nC ( float nz , vec3 nA , float nB ) { return nA - nA * pow ( u_sky_color , vec3 ( nB / nz ) ) ; } void main ( ) { vec3 nD = normalize ( mX ) ; vec3 nE = u_sun_direction ; float nF = dot ( nD , nE ) ; float nG = nq ( nF , - 0.01 ) * u_rayleigh_brightness * nE . y ; float nH = nq ( nF - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nE . y ) ; float nI = smoothstep ( 0.0 , 100.0 , nq ( nF , 0.9995 ) ) * u_spot_brightness ; vec3 nJ = vec3 ( 0.0 , mY , 0.0 ) ; float nK = nj ( nJ , nD ) ; float nL = nK / float ( m_ ) ; float nM = ny ( nJ , nD , mY - 0.3 ) ; vec3 nN = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nO = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nP = 0 ; nP < m_ ; nP ++ ) { float nQ = nL * float ( nP ) ; vec3 nR = nJ + nD * nQ ; float nS = ny ( nR , nE , mY - 0.2 ) ; float nT = nj ( nR , nE ) ; vec3 nU = nC ( nT , vec3 ( mZ ) , u_scatter_strength ) * nS ; nN += nC ( sqrt ( nQ ) , u_sky_color * nU , u_rayleigh_strength ) ; nO += nC ( nQ , nU , u_mie_strength ) ; } nN = nN * nM * pow ( nK , u_rayleigh_collection_power ) / float ( m_ ) ; nO = ( nO * nM * pow ( nK , u_mie_collection_power ) ) / float ( m_ ) ; vec3 nV = vec3 ( nI * nO + nH * nO + nG * nN ) ; gq ( nV ) ; gl_FragColor = vec4 ( nV , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mX ; void main ( ) { vec4 lf = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lg = u_cube_view_matrix * lf ; mX = lg . xyz ; gl_Position = lf ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_sampler , a ) ; gq ( lf . rgb ) ; gt ( lf . rgb , lf . a ) ; gl_FragColor = lf ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lf = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lg = u_proj_matrix * u_view_matrix * vec4 ( lf , 0.0 ) ; lg . x /= lg . w ; lg . y /= lg . w ; lg += 99999.0 * step ( lg . z , 0.0 ) ; lg += 100.0 * ( step ( 1.0 , abs ( lg . x ) ) + step ( 1.0 , abs ( lg . y ) ) ) ; lg . x = - a_lf_dist * lg . x ; lg . y = - a_lf_dist * lg . y ; float lh = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 li = vec2 ( a_lf_bb_vertex . x / lh , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float lj = 1.9 ; li *= ( 1.0 + lj * length ( lg . xy ) ) ; } gl_Position = vec4 ( lg . xy + li , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mX ; void main ( ) { vec3 lf = textureCube ( u_sky , mX ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"go ( lf . rgb ) ; float lg = u_camera_eye_frag . y - WATER_LEVEL ; lg = min ( - lg * 0.03 , 0.8 ) ; float lh = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 li = normalize ( mX ) ; vec3 lj = vec3 ( 0.0 ) ; vec4 lk = u_underwater_fog_color_density ; lk . rgb = mix ( lk . rgb , lj , min ( - li . y + lg , 1.0 ) ) * lh ; float ll = clamp ( sign ( li . y - 0.05 * lg ) , 0.0 , 1.0 ) ; lf = mix ( lk . rgb , lf , ll ) ; gq ( lf . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lf , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mX ; void main ( ) { vec4 lf = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lg = u_sky_vp_inverse * lf ; mX = lg . xyz ; gl_Position = lf ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap0_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap1_uv_velocity ; uniform vec2 u_normalmap1_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap2_uv_velocity ; uniform vec2 u_normalmap2_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap3_uv_velocity ; uniform vec2 u_normalmap3_scale ;".split(" ")}]}}]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",
b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],
group:{type:"group",a:[{type:"textline",b:"const float lf = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],
group:{type:"group",a:[{type:"textline",b:"varying vec3 ks ; varying vec3 mY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","na",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 np ( in vec2 nb , in vec3 nc , in vec3 nd , in vec3 ne , out float nf ) { vec3 ng = reflect ( - nd , nc ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nh = nb . xy + nc . xz * REFL_BUMP / ku ; nf = u_reflect_factor ; vec3 ni ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ni = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ni = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",
b:"float nj = dot ( nd , nc ) ; nf *= max ( 1.0 - 1.0 / nj , 1.0 ) ; } else { ni = texture2D ( u_reflectmap , nh ) . rgb ; go ( ni ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nf = u_mirror_factor ; vec3 ni = ne * textureCube ( u_mirrormap , ng ) . rgb ; go ( ni ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nf = u_reflect_factor ; vec3 ni = ne * vec3 ( 0.3 , 0.5 , 1.0 ) ; go ( ni ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 nk = normalize ( ng + nd ) ; float nl = 1.0 - dot ( nd , nk ) ; float nm = u_fresnel_params [ 3 ] ; float nn = u_fresnel_params [ 2 ] ; float no = nm + ( 1.0 - nm ) * pow ( nl , nn ) ; nf = min ( nf * no , 1.0 ) ; return ni ; } void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nq = mat3 ( ks , mY , kr ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 nr = normalize ( kr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nq = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nr = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float ns = kq . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 nt = vec2 ( mZ . x , - mZ . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 nt = vec2 ( kq . x , - kq . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","nt","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",
a:[{type:"textline",b:"vec3 nu = vec3 ( 0.0 ) ; vec3 nv = texture2D ( u_normalmap0 , nt * u_normalmap0_scale + u_normalmap0_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nw = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",
a:[{type:"textline",b:"nv = texture2D ( u_normalmap0 , nt * u_normalmap1_scale + u_normalmap1_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nv = texture2D ( u_normalmap0 , nt * u_normalmap2_scale + u_normalmap2_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nv = texture2D ( u_normalmap0 , nt * u_normalmap3_scale + u_normalmap3_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nx = nq * nw ; if ( ! f ( nx , vec3 ( 0.0 ) ) ) nx = normalize ( nx ) ; vec3 ny = mix ( nr , nx , 0.2 ) ; ny = normalize ( ny ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"nr = mix ( nr , normalize ( nq * nu ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nr = mix ( nr , normalize ( nq * nu ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nr = normalize ( nr ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nz = normalize ( kp ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nA = cD . xy / cD . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float nB = ku * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nC = u_diffuse_color . a ; vec4 nD = texture2DProj ( u_scene_depth , cD ) ; float nE = cp ( nD ) ; float nF = max ( nE - ku , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nG = nA + nr . xz * u_refr_bump / ku ; float nH = kX ( nE , nG , nA ) ; float nI = max ( nH - ku , 0.0 ) ; float nJ = u_view_max_depth / ABSORB * nI ; float nK ; if ( u_cam_water_depth < 0.0 ) nK = 0.0 ; else nK = min ( nC * nJ , 1.0 ) ; float nL = u_view_max_depth / ABSORB * nF ; nC = min ( 15.0 * nC * u_view_max_depth * nF , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nL = u_view_max_depth / ABSORB * nF ; if ( u_cam_water_depth > 0.0 ) nC = min ( nC * nL , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nC *= min ( 5.0 * nB , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nC = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nK = 1.0 - nC ; vec2 nG = nA + nr . xz * REFR_BUMP / ku ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nM = texture2D ( u_refractmap , nG ) . rgb ; go ( nM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nN = pow ( min ( m_ . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nO = mix ( u_shallow_water_col , u_diffuse_color . rgb , nN ) ; nN = pow ( min ( m_ . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nO = mix ( u_shore_water_col , nO , nN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nO = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nP = max ( 1.0 - u_view_max_depth * nF , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nP = 1.0 - nC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nQ = max ( ns / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nR = normalize ( vec3 ( m_ . r , 0.0 , m_ . g ) ) ; vec3 nS = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nR , 0.8 ) ) ; float nT = max ( 2.5 * dot ( ny , nS ) - 0.7 , 0.0 ) ; nP += nT * ( 1.0 - m_ . b ) ; nQ *= ( 1.0 - 0.95 * pow ( m_ . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"nP += nQ ; nP = min ( u_foam_factor * nP , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 nU = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nt * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nV = u_specular_params [ 0 ] ; vec2 nW = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nX = nV * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nY = u_environment_energy * textureCube ( u_sky_texture , nr ) . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vec3 nY = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nZ = u_ambient * nY ; vec3 n_ = nZ + u_sun_intensity ; float oa ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 ob = np ( nA , nr , nz , n_ , oa ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ob = np ( vec2 ( 0.0 ) , nr , nz , n_ , oa ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 oc = u_diffuse_intensity * nO ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hm od = jJ ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , oc , nX , kq , nr , nz , nW , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm od = jO ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , oc ) ;".split(" ")}]}}]},
{type:"textline",b:"oc = od . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float oe = max ( dot ( u_sun_direction , - kr ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nz , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; oe = clamp ( SSS_STRENGTH * oe , 0.0 , 1.0 ) ; oc = mix ( oc , u_shallow_water_col , oe ) ; oc = mix ( oc , u_shore_water_col , oe ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"oc = mix ( nM , oc , nK ) ;".split(" ")}]}}]},{type:"textline",b:"oc = mix ( oc , ob , oa ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float of = mix ( nU . g , nU . r , max ( 4.0 * ( nP - 0.75 ) , 0.0 ) ) ; of = mix ( nU . b , of , max ( 2.0 * nP - 1.0 , 0.0 ) ) ; of = mix ( 0.0 , of , nP ) ; oc = mix ( oc , n_ , of ) ;".split(" ")}]}}]},{type:"textline",b:"oc += od . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 og = gI ( u_cube_fog , nz ) ; vec4 oh = vec4 ( og , u_fog_color_density . a ) ; go ( oh . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","oh","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { hj ( oc , nB , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gB ( oc , nB , oh ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gB ( oc , nB , oh ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gq","(","oc",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nC = max ( nC , od . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nC","+=","of",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gt ( oc , nC ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oi = fwidth ( na ) ; vec3 oj = smoothstep ( vec3 ( 0.0 ) , oi * lf , na ) ; float ok = min ( min ( oj . x , oj . y ) , oj . z ) ; ok = clamp ( ok , 0.0 , 1.0 ) ; oc = mix ( u_wireframe_edge_color , oc , ok ) ; nC = mix ( 1.0 , nC , ok ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( oc , nC ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ks ; varying vec3 mY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","na",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 ll ( in vec2 lf ) { vec2 lg = 0.5 + vec2 ( ( lf . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lf . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lh = texture2D ( u_shore_dist_map , lg ) ; const vec2 li = vec2 ( 1.0 / 255.0 , 1.0 ) ; float lj = dot ( lh . ba , li ) ; vec2 lk = normalize ( lh . rg * 2.0 - 1.0 ) ; return vec3 ( lk , lj ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lC ( inout vec3 lm , in float ln , in vec3 lo ) { float lp = dD ( DST_NOISE_SCALE_0 * ( lm . xz + DST_NOISE_FREQ_0 * ln ) ) * dD ( DST_NOISE_SCALE_1 * ( lm . zx - DST_NOISE_FREQ_1 * ln ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lq = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lr = lo . b ; float ls = sqrt ( lr ) ; float lt = max ( lr , DIR_MIN_SHR_FAC ) * sin ( ls / lq + DIR_FREQ * ln ) ; float lu = max ( dD ( DIR_NOISE_SCALE * ( lm . xz + DIR_NOISE_FREQ * ln ) ) , DIR_MIN_NOISE_FAC ) ; lt *= lu ; float lv = WAVES_HEIGHT * mix ( lt , lp , max ( ls , DST_MIN_FAC ) ) ; vec2 lw = lo . rg ; float lx = WAVES_HOR_FAC * lt * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lr ) , 0.0 ) ; vec2 ly = lx * lw ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lv = WAVES_HEIGHT * lp ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lz = 2.0 * ( lm . xz - 0.1 * ln ) ; vec2 lA = 1.3 * ( lm . zx + 0.03 * ln ) ; float lB = cY ( 0.5 * lz ) . x + cY ( 0.5 * lA ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lm . xz += ly ; lB *= lr ;".split(" ")}]}}]},{type:"textline",
b:"lv += SMALL_WAVES_FAC * lB ;".split(" ")}]}}]},{type:"textline",b:"lm . y += lv ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) na = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) na = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) na = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","lD","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float lE = abs ( lD . y ) ; vec2 lF = u_camera_eye . xz - mod ( u_camera_eye . xz , lE ) ; lD . y = WATER_LEVEL ; lD . xz += lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"c lG = ag ( lD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mZ = lG . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"m_ = ll ( lG . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float lH = length ( u_wind ) ; float lI = u_time ; lI *= lH ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"lJ","=","lE",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lJ","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 lK = lG . a + vec3 ( lJ , 0.0 , 0.0 ) ; vec3 lL = lG . a + vec3 ( 0.0 , 0.0 , lJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 lM = ll ( lK . xz ) ; vec3 lN = ll ( lL . xz ) ; lC ( lK , lI , lM ) ; lC ( lL , lI , lN ) ; lC ( lG . a , lI , m_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lC ( lK , lI , vec3 ( 0.0 ) ) ; lC ( lL , lI , vec3 ( 0.0 ) ) ; lC ( lG . a , lI , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { lG . a . y = WATER_LEVEL - 1.0 ; lK . y = lG . a . y ; lL . y = lG . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 lO = normalize ( lK - lG . a ) ; vec3 lP = normalize ( lL - lG . a ) ; kr = normalize ( cross ( lP , lO ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"ks = lP ; mY = cross ( kr , ks ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lQ = dot ( kr , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lR = clamp ( 0.8 - lQ , 0.0 , 1.0 ) ; kr = mix ( kr , vec3 ( 0.0 , 1.0 , 0.0 ) , lR ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kq = lG . a ; kp = u_camera_eye - lG . a ; vec4 lS = u_view_matrix * vec4 ( lG . a , 1.0 ) ; vec4 lT = u_proj_matrix * lS ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float lU = lT . x ; float lV = lT . y ; float nb = lT . w ; cD . x = ( lU + nb ) / 2.0 ; cD . y = ( lV + nb ) / 2.0 ; cD . z = nb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"ku = - lS . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","lT",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 na ; const float lf = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lg = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lg = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lh = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 li = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lj = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lk = vec3 ( 0.0 ) ; float ll = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lm = sign ( na - vec3 ( 0.02 * lf ) ) ; if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) { lk = lg ; ll = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lm = sign ( na - vec3 ( 0.02 * lf ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) lk = u_wireframe_edge_color ; else lk = lj ; ll = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) ll = 1.0 ; else ll = 0.0 ; lk = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) lk = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lk = lh ; else lk = li ; ll = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 ln = fwidth ( na ) ; vec3 lo = smoothstep ( vec3 ( 0.0 ) , ln * lf , na ) ; float lp = min ( min ( lo . x , lo . y ) , lo . z ) ; lp = clamp ( lp , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lk = vec3 ( mix ( u_wireframe_edge_color , lj , lp ) ) ; ll = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lk = u_wireframe_edge_color ; ll = mix ( 1.0 , 0.0 , lp ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lk = mix ( u_wireframe_edge_color , lh , lp ) ; else lk = mix ( u_wireframe_edge_color , li , lp ) ; ll = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gq","(","lk",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gt ( lk , ll ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lk , ll ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","na",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) na = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) na = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) na = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lf = a_position ; vec3 lg = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"c lh = ag ( lf , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lf = mix ( lf , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 li = vec3 ( 0.0 ) ; vec3 lj = vec3 ( 0.0 ) ; bm ( lf , li , lj , lg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c lh = fY ( lf , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lk , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ll = ( u_model_matrix * vec4 ( lk , 1.0 ) ) . xyz ; mat4 lm = _ ( u_camera_eye , ll , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ln = ( u_model_matrix * vec4 ( lk , 1.0 ) ) . xyz ; lm = lm * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ln ) ;".split(" ")}]}}]},{type:"textline",b:"c lh = ag ( lf - lk , lk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lm ) ; lh . b = ll ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c lh = ag ( lf , lk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( lh . a , lh . b , lg ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lo = u_view_matrix * vec4 ( lh . a , 1.0 ) ; gl_Position = u_proj_matrix * lo ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_sampler_left , a ) ; vec4 lg = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lf [ 0 ] , lg [ 1 ] , lg [ 2 ] , lf [ 3 ] + lg [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",
b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 li ( float lf , float lg ) { vec2 lh = a + vec2 ( lf , lg ) * u_texel_size ; return texture2D ( u_color , lh ) ; } float lm ( vec4 lj ) { vec3 lk = vec3 ( 0.299 , 0.587 , 0.114 ) ; float ll = dot ( lj . rgb , lk ) ; return ll ; } vec4 lF ( ) { vec4 ln = li ( - 1.0 , - 1.0 ) ; vec4 lo = li ( 1.0 , - 1.0 ) ; vec4 lp = li ( - 1.0 , 1.0 ) ; vec4 lq = li ( 1.0 , 1.0 ) ; vec4 lr = li ( 0.0 , 0.0 ) ; float ls = lm ( ln ) ; float lt = lm ( lo ) ; float lu = lm ( lp ) ; float lv = lm ( lq ) ; float lw = lm ( lr ) ; float lx = min ( lw , min ( min ( ls , lt ) , min ( lu , lv ) ) ) ; float ly = max ( lw , max ( max ( ls , lt ) , max ( lu , lv ) ) ) ; vec2 lz ; lz . x = - ( ( ls + lt ) - ( lu + lv ) ) ; lz . y = ( ( ls + lu ) - ( lt + lv ) ) ; float lA = max ( ( ls + lt + lu + lv ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lB = 1.0 / ( min ( abs ( lz . x ) , abs ( lz . y ) ) + lA ) ; lz = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lz * lB ) ) * u_texel_size ; vec4 lC = 0.5 * ( texture2D ( u_color , a + lz * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lz * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 lD = lC * 0.5 + 0.25 * ( texture2D ( u_color , a + lz * - 0.5 ) + texture2D ( u_color , a + lz * 0.5 ) ) ; float lE = lm ( lD ) ; if ( ( lE < lx ) || ( lE > ly ) ) return lC ; else return lD ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 ow ( ) { vec2 lG ; lG . x = a . x ; lG . y = a . y ; vec4 lH = texture2D ( u_color , lG ) ; vec4 lI = li ( 0.0 , 1.0 ) ; vec4 lJ = li ( 1.0 , 0.0 ) ; vec4 lK = li ( 0.0 , - 1.0 ) ; vec4 lL = li ( - 1.0 , 0.0 ) ; float lM = lm ( lI ) ; float lN = lm ( lJ ) ; float lO = lm ( lK ) ; float lP = lm ( lL ) ; float lQ = lm ( lH ) ; float lR = max ( lM , lQ ) ; float lS = min ( lM , lQ ) ; float lT = max ( lN , lR ) ; float lU = min ( lN , lS ) ; float lV = max ( lO , lP ) ; float nb = min ( lO , lP ) ; float nc = max ( lV , lT ) ; float nd = min ( nb , lU ) ; float ne = nc * FXAA_QUALITY_EDGE_THRESHOLD ; float nf = nc - nd ; float ng = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , ne ) ; bool nh = nf < ng ; if ( nh ) return lH ; vec4 ni = li ( - 1.0 , - 1.0 ) ; vec4 nj = li ( 1.0 , 1.0 ) ; vec4 nk = li ( 1.0 , - 1.0 ) ; vec4 nl = li ( - 1.0 , 1.0 ) ; float nm = lm ( ni ) ; float nn = lm ( nj ) ; float no = lm ( nk ) ; float np = lm ( nl ) ; float nq = lO + lM ; float nr = lP + lN ; float ns = 1.0 / nf ; float nt = nq + nr ; float nu = ( - 2.0 * lQ ) + nq ; float nv = ( - 2.0 * lQ ) + nr ; float nw = no + nn ; float nx = nm + no ; float ny = ( - 2.0 * lN ) + nw ; float nz = ( - 2.0 * lO ) + nx ; float nA = nm + np ; float nB = np + nn ; float nC = ( abs ( nu ) * 2.0 ) + abs ( ny ) ; float nD = ( abs ( nv ) * 2.0 ) + abs ( nz ) ; float nE = ( - 2.0 * lP ) + nA ; float nF = ( - 2.0 * lM ) + nB ; float nG = abs ( nE ) + nC ; float nH = abs ( nF ) + nD ; float nI = nA + nw ; float nJ = u_texel_size . x ; bool nK = nG >= nH ; float nL = nt * 2.0 + nI ; if ( ! nK ) lO = lP ; if ( ! nK ) lM = lN ; if ( nK ) nJ = u_texel_size . y ; float nM = ( nL * ( 1.0 / 12.0 ) ) - lQ ; float nN = lO - lQ ; float nO = lM - lQ ; float nP = lO + lQ ; float nQ = lM + lQ ; bool nR = abs ( nN ) >= abs ( nO ) ; float nS = max ( abs ( nN ) , abs ( nO ) ) ; if ( nR ) nJ = - nJ ; float nT = clamp ( abs ( nM ) * ns , 0.0 , 1.0 ) ; vec2 nU ; nU . x = lG . x ; nU . y = lG . y ; vec2 nV ; nV . x = ( ! nK ) ? 0.0 : u_texel_size . x ; nV . y = ( nK ) ? 0.0 : u_texel_size . y ; if ( ! nK ) nU . x += nJ * 0.5 ; if ( nK ) nU . y += nJ * 0.5 ; vec2 nW ; nW . x = nU . x - nV . x ; nW . y = nU . y - nV . y ; vec2 nX ; nX . x = nU . x + nV . x ; nX . y = nU . y + nV . y ; float nY = ( ( - 2.0 ) * nT ) + 3.0 ; float nZ = lm ( texture2D ( u_color , nW ) ) ; float n_ = nT * nT ; float oa = lm ( texture2D ( u_color , nX ) ) ; if ( ! nR ) nP = nQ ; float ob = nS * 1.0 / 4.0 ; float oc = lQ - nP * 0.5 ; float od = nY * n_ ; bool oe = oc < 0.0 ; nZ -= nP * 0.5 ; oa -= nP * 0.5 ; bool of = abs ( nZ ) >= ob ; bool og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 1.5 ; if ( ! of ) nW . y -= nV . y * 1.5 ; bool oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 1.5 ; if ( ! og ) nX . y += nV . y * 1.5 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 2.0 ; if ( ! of ) nW . y -= nV . y * 2.0 ; oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 2.0 ; if ( ! og ) nX . y += nV . y * 2.0 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 2.0 ; if ( ! of ) nW . y -= nV . y * 2.0 ; oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 2.0 ; if ( ! og ) nX . y += nV . y * 2.0 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 4.0 ; if ( ! of ) nW . y -= nV . y * 4.0 ; oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 4.0 ; if ( ! og ) nX . y += nV . y * 4.0 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 2.0 ; if ( ! of ) nW . y -= nV . y * 2.0 ; if ( ! og ) nX . x += nV . x * 2.0 ; if ( ! og ) nX . y += nV . y * 2.0 ; } } } } float oi = lG . x - nW . x ; float oj = nX . x - lG . x ; if ( ! nK ) oi = lG . y - nW . y ; if ( ! nK ) oj = nX . y - lG . y ; bool ok = ( nZ < 0.0 ) != oe ; float ol = ( oj + oi ) ; bool om = ( oa < 0.0 ) != oe ; float on = 1.0 / ol ; bool oo = oi < oj ; float op = min ( oi , oj ) ; bool oq = oo ? ok : om ; float or = od * od ; float os = ( op * ( - on ) ) + 0.5 ; float ot = or * FXAA_QUALITY_SUBPIX ; float ou = oq ? os : 0.0 ; float ov = max ( ou , ot ) ; if ( ! nK ) lG . x += ov * nJ ; if ( nK ) lG . y += ov * nJ ; return texture2D ( u_color , lG ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lF ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ow ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lf = vec2 ( 0.0 , 0.0 ) ; vec2 lg = u_texel_size ; vec4 lh = texture2D ( u_color , a ) ; gl_FragColor = lh * 0.0875447373698 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0858112354248 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0808139781061 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0731235112908 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0635705267419 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0530985673112 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0426125984122 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0328565115809 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lh , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_main , a ) ; vec4 lg = texture2D ( u_bloom , a ) ; vec4 lh = lf ; lh += lg ; gl_FragColor = vec4 ( lh . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_color , a ) ; vec3 lg = lf . rgb ; if ( u_brightness < 0.0 ) lg = lg * ( 1.0 + u_brightness ) ; else lg = lg + ( ( 1.0 - lg ) * u_brightness ) ; lg = ( lg - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lg *= u_exposure ; vec3 lh = vec3 ( 0.299 , 0.587 , 0.114 ) ; float li = dot ( lg , lh ) ; lg = mix ( vec3 ( li ) , lg , u_saturation ) ; gl_FragColor = vec4 ( lg , lf . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cl ( clamp ( ni ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nj = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float nk = ni ( u_depth , a , u_camera_range ) ; nk *= u_view_max_depth ; float nl ; if ( nk < u_dof_dist ) nl = ( u_dof_dist - nk ) / u_dof_front ; else nl = ( nk - u_dof_dist ) / u_dof_rear ; nl = clamp ( nl , 0.0 , 1.0 ) ; vec4 nm = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nj , nm , nl ) ; } else gl_FragColor = nj ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lk ( float lf , float lg , float lh ) { vec2 li = a + vec2 ( lf , lg ) * u_texel_size ; vec4 lj = texture2D ( u_sampler , li ) * lh ; return cp ( lj ) ; } void main ( ) { float ll = ( lk ( - 1.0 , - 1.0 , - 1.0 ) + lk ( 0.0 , - 1.0 , - 1.0 ) + lk ( 1.0 , - 1.0 , - 1.0 ) + lk ( - 1.0 , 0.0 , - 1.0 ) + lk ( 0.0 , 0.0 , 8.0 ) + lk ( 1.0 , 0.0 , - 1.0 ) + lk ( - 1.0 , 1.0 , - 1.0 ) + lk ( 0.0 , 1.0 , - 1.0 ) + lk ( 1.0 , 1.0 , - 1.0 ) ) ; ll *= 1000.0 ; gl_FragColor = vec4 ( ll , ll , ll , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_glow_src , a ) ; gl_FragColor = lf ; if ( u_draw_glow != 0.0 ) { vec4 lg = texture2D ( u_glow_mask , a ) ; vec4 lh = texture2D ( u_glow_mask_blurred , a ) ; float li = lh . a - lg . a ; if ( li != 0.0 ) { float lj = smoothstep ( 0.0 , 1.0 , lh . a ) ; if ( lg . a == 0.0 ) { vec3 lk = u_glow_color ; gq ( lk ) ; vec4 ll = vec4 ( clamp ( lk , 0.0 , 1.0 ) , lj ) ; gl_FragColor = mix ( lf , ll , lj ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nj ; varying vec2 nk ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nl ; void main ( ) { vec2 nm = ( nl . xy - a ) ; float nn = length ( nm ) ; vec2 no = u_radial_blur_step * nm / nn ; float np = nn / u_radial_blur_step ; no *= min ( np , STEPS_PER_PASS ) / STEPS_PER_PASS ; np = max ( np , STEPS_PER_PASS ) ; vec2 nq = a ; float nr = 0.0 ; for ( float ns = 0.0 ; ns < STEPS_PER_PASS ; ns += 1.0 ) { if ( ns <= np ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float nt = ni ( u_input , nq , u_camera_range ) ; nr += max ( ( 1.0 - pow ( nn , 0.3 ) ) * step ( 0.9 , nt ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nu = texture2D ( u_input , nq ) ; nr += cp ( nu ) ;".split(" ")}]}}]},{type:"textline",b:"} nq += no ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nv = a + nk ; float nw = cY ( vec2 ( 2.5 * ( nv . x ) , 2.5 * ( nv . y ) + 1.0 * u_time ) ) . x + 0.75 * cY ( vec2 ( 5.0 * ( nv . x ) - 0.66 * u_time , 5.0 * ( nv . y ) + 0.66 * u_time ) ) . x + 0.5 * dD ( vec2 ( 7.5 * ( nv . x ) + 0.33 * u_time , 7.5 * ( nv . y ) - 0.33 * u_time ) ) ; nw *= clamp ( 1.2 - sqrt ( 0.2 * nn ) , 0.0 , 1.0 ) * nj ; nr = max ( nw , nr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cl ( nr / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nj ; varying vec2 nk ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nl ; void lm ( in vec4 lf , in vec3 lg , out vec3 lh ) { float li = lf . w * lg . x + lf . y * lg . z - lf . z * lg . y ; float lj = lf . w * lg . y + lf . z * lg . x - lf . x * lg . z ; float lk = lf . w * lg . z + lf . x * lg . y - lf . y * lg . x ; float ll = - lf . x * lg . x - lf . y * lg . y - lf . z * lg . z ; lh . x = li * lf . w - ll * lf . x - lj * lf . z + lk * lf . y ; lh . y = lj * lf . w - ll * lf . y - lk * lf . x + li * lf . z ; lh . z = lk * lf . w - ll * lf . z - li * lf . y + lj * lf . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 ln = normalize ( u_sun_direction ) ; nl = u_proj_matrix * u_view_matrix * vec4 ( ln , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nj = 1.0 ; vec3 lo = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lp ; lm ( u_camera_quat , lo , lp ) ; lp = normalize ( lp ) ; float lq = dot ( lp , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lr = atan ( lp . x , lp . z ) ; nk = vec2 ( - lr , acos ( lq ) ) ; } else { nj = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nl . x /= nl . w ; nl . y /= nl . w ; nl . x = 0.5 * ( nl . x + 1.0 ) ; nl . y = 0.5 * ( nl . y + 1.0 ) ; nl += 99999.0 * step ( nl . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_main , a ) ; vec3 lg = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; go ( lf . rgb ) ; float lh = cp ( texture2D ( u_god_rays , a ) ) ; vec3 li = lf . rgb + u_god_rays_intensity * vec3 ( lh ) * lg ; gq ( li ) ; gl_FragColor . rgb = li ; gl_FragColor . a = lf . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_color , a ) * 0.38026 ; lf += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lf += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lf += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lf += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lf += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lf += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lf += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lf += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lf ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_input , a ) ; float lg = dot ( lf . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lg ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lf ; float lg = 0.0 ; for ( float lh = 0.025 ; lh < 1.0 ; lh += 0.05 ) for ( float li = 0.025 ; li < 1.0 ; li += 0.05 ) { lf = max ( texture2D ( u_input , vec2 ( lh , li ) ) . r , 0.01 ) ; lg += log ( lf ) ; } float lj = exp ( lg / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( lj ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nm ; void main ( ) { float nn = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float no = texture2D ( u_luminance , a ) . r ; vec4 np = texture2D ( u_main , a ) ; float nq = no / nn ; float nr = u_bloom_edge_lum ; gl_FragColor = np * max ( nq - nr , 0.0 ) * nm ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nm ; const vec3 lf = vec3 ( 0.0 , 1.0 , 0.0 ) ; void ln ( in vec4 lg , in vec3 lh , out vec3 li ) { float lj = lg . w * lh . x + lg . y * lh . z - lg . z * lh . y ; float lk = lg . w * lh . y + lg . z * lh . x - lg . x * lh . z ; float ll = lg . w * lh . z + lg . x * lh . y - lg . y * lh . x ; float lm = - lg . x * lh . x - lg . y * lh . y - lg . z * lh . z ; li . x = lj * lg . w - lm * lg . x - lk * lg . z + ll * lg . y ; li . y = lk * lg . w - lm * lg . y - ll * lg . x + lj * lg . z ; li . z = ll * lg . w - lm * lg . z - lj * lg . y + lk * lg . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lo ; ln ( u_camera_quat , lf , lo ) ; nm = dot ( - lo , u_sun_direction ) * u_bloom_key ; nm *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_mb_tex_curr , a ) ; vec4 lg = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lf - lg ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lf + u_motion_blur_exp * lg ; } else { gl_FragColor = lf ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lf = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lf . r + lf . g + lf . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lg = vec2 ( 0.0 , 0.0 ) ; vec2 lh = u_texel_size ; vec4 li ; li = texture2D ( u_color , a ) ; gl_FragColor = li * 0.2270270270 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.1945945946 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.1945945946 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.1216216216 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.1216216216 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.0540540541 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.0540540541 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.0162162162 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lh = u_texel_size ; vec4 li = texture2D ( u_color , a ) ; gl_FragColor = li ; if ( li . a == 0.0 ) { li = texture2D ( u_color , a + lh ) ; if ( li . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , li . a ) ; else { li = texture2D ( u_color , a - lh ) ; if ( li . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , li . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nn",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 no ; varying vec4 np ; varying vec4 nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nx ( vec2 ns , sampler2D nt ) { float nu = texture2D ( nt , ns ) . r ; float nv = texture2D ( nt , no . xy ) . r ; float nw = texture2D ( nt , no . zw ) . r ; return vec3 ( nu , nv , nw ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nD ( vec2 ny , sampler2D nz ) { vec3 nA = nx ( ny , nz ) ; vec2 nB = abs ( nA . xx - nA . yz ) ; vec2 nC = step ( SMAA_PREDICATION_THRESHOLD , nB ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nC ) ; }".split(" ")}]}}]},{type:"textline",b:"void nH ( bvec2 nE , inout vec2 nF , vec2 nG ) { if ( nE . x ) nF . x = nG . x ; if ( nE . y ) nF . y = nG . y ; } void nH ( bvec4 nI , inout vec4 nJ , vec4 nK ) { nH ( nI . xy , nJ . xy , nK . xy ) ; nH ( nI . zw , nJ . zw , nK . zw ) ; } vec2 nM ( vec2 nL ) { return sign ( nL ) * floor ( abs ( nL ) + .5 ) ; } vec4 nM ( vec4 nN ) { return sign ( nN ) * floor ( abs ( nN ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 od ( vec2 nO , sampler2D nP".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nQ"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nR = nD ( nO , nQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nR = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nS = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nT = dot ( texture2D ( nP , nO ) . rgb , nS ) ; float nU = dot ( texture2D ( nP , no . xy ) . rgb , nS ) ; float nV = dot ( texture2D ( nP , no . zw ) . rgb , nS ) ; vec4 nW ; nW . xy = abs ( nT - vec2 ( nU , nV ) ) ; vec2 nX = step ( nR , nW . xy ) ; if ( dot ( nX , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nY = dot ( texture2D ( nP , np . xy ) . rgb , nS ) ; float nZ = dot ( texture2D ( nP , np . zw ) . rgb , nS ) ; nW . zw = abs ( nT - vec2 ( nY , nZ ) ) ; vec2 n_ = max ( nW . xy , nW . zw ) ; float oa = dot ( texture2D ( nP , nq . xy ) . rgb , nS ) ; float ob = dot ( texture2D ( nP , nq . zw ) . rgb , nS ) ; nW . zw = abs ( vec2 ( nU , nV ) - vec2 ( oa , ob ) ) ; n_ = max ( n_ . xy , nW . zw ) ; float oc = max ( n_ . x , n_ . y ) ; nX . xy *= step ( oc , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nW . xy ) ; return nX ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 of ( vec2 oe ) { oe . r = oe . r * abs ( 5.0 * oe . r - 5.0 * 0.75 ) ; return nM ( oe ) ; } vec4 of ( vec4 og ) { og . rb = og . rb * abs ( 5.0 * og . rb - 5.0 * 0.75 ) ; return nM ( og ) ; } vec2 oo ( sampler2D oh , vec2 oi , vec2 oj , out vec2 ok ) { vec4 ol = vec4 ( oi , - 1.0 , 1.0 ) ; vec3 om = vec3 ( u_texel_size , 1.0 ) ; for ( int on = 0 ; on < SMAA_MAX_SEARCH_STEPS_DIAG ; on ++ ) { if ( ol . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ol . w > 0.9 ) { ol . xyz += om * vec3 ( oj , 1.0 ) ; ok = texture2D ( oh , ol . xy , 0.0 ) . rg ; ol . w = dot ( ok , vec2 ( 0.5 , 0.5 ) ) ; } } return ol . zw ; } vec2 ow ( sampler2D op , vec2 oq , vec2 or , out vec2 os ) { vec4 ot = vec4 ( oq , - 1.0 , 1.0 ) ; ot . x += 0.25 * u_texel_size . x ; vec3 ou = vec3 ( u_texel_size , 1.0 ) ; for ( int ov = 0 ; ov < SMAA_MAX_SEARCH_STEPS_DIAG ; ov ++ ) { if ( ot . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ot . w > 0.9 ) { ot . xyz = ou * vec3 ( or , 1.0 ) + ot . xyz ; os = texture2D ( op , ot . xy , 0.0 ) . rg ; os = of ( os ) ; ot . w = dot ( os , vec2 ( 0.5 , 0.5 ) ) ; } } return ot . zw ; } vec2 oC ( sampler2D ox , vec2 oy , vec2 oz , float oA ) { vec2 oB = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * oz + oy ; oB = SMAA_AREATEX_PIXEL_SIZE * oB + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oB . x += 0.5 ; oB . y += SMAA_AREATEX_SUBTEX_SIZE * oA ; return texture2D ( ox , oB , 0.0 ) . rg ; } vec2 oR ( sampler2D oD , sampler2D oE , vec2 oF , vec2 oG , vec4 oH ) { vec2 oI = vec2 ( 0.0 , 0.0 ) ; vec4 oJ ; vec2 oK ; if ( oG . r > 0.0 ) { oJ . xz = oo ( oD , oF , vec2 ( - 1.0 , 1.0 ) , oK ) ; oJ . x += float ( oK . y > 0.9 ) ; } else oJ . xz = vec2 ( 0.0 , 0.0 ) ; oJ . yw = oo ( oD , oF , vec2 ( 1.0 , - 1.0 ) , oK ) ; if ( oJ . x + oJ . y > 2.0 ) { vec4 oL = vec4 ( - oJ . x + 0.25 , oJ . x , oJ . y , - oJ . y - 0.25 ) * u_texel_size . xyxy + oF . xyxy ; vec4 oM ; oM . xy = texture2D ( oD , oL . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oM . zw = texture2D ( oD , oL . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oM . yxwz = of ( oM . xyzw ) ; vec2 oN = vec2 ( 2.0 , 2.0 ) * oM . xz + oM . yw ; nH ( bvec2 ( step ( 0.9 , oJ . zw ) ) , oN , vec2 ( 0.0 , 0.0 ) ) ; oI += oC ( oE , oJ . xy , oN , oH . z ) ; } oJ . xz = ow ( oD , oF , vec2 ( - 1 , - 1 ) , oK ) ; if ( texture2D ( oD , oF + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oJ . yw = ow ( oD , oF , vec2 ( 1 , 1 ) , oK ) ; oJ . y += float ( oK . y > 0.9 ) ; } else oJ . yw = vec2 ( 0.0 , 0.0 ) ; if ( oJ . x + oJ . y > 2.0 ) { vec4 oO = vec4 ( - oJ . x , - oJ . x , oJ . y , oJ . y ) * u_texel_size . xyxy + oF . xyxy ; vec4 oP ; oP . x = texture2D ( oD , oO . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oP . y = texture2D ( oD , oO . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oP . zw = texture2D ( oD , oO . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oQ = vec2 ( 2.0 , 2.0 ) * oP . xz + oP . yw ; nH ( bvec2 ( step ( 0.9 , oJ . zw ) ) , oQ , vec2 ( 0 , 0 ) ) ; oI += oC ( oE , oJ . xy , oQ , oH . w ) . gr ; } return oI ; }".split(" ")}]}}]},
{type:"textline",b:"float oX ( sampler2D oS , vec2 oT , float oU ) { vec2 oV = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oW = SMAA_SEARCHTEX_SIZE * vec2 ( oU , 1.0 ) ; oV += vec2 ( - 1.0 , 1.0 ) ; oW += vec2 ( 0.5 , - 0.5 ) ; oV *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oW *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oS , oV * oT + oW , 0.0 ) . r ; } float pe ( sampler2D oY , sampler2D oZ , vec2 o_ , float pa ) { vec2 pb = vec2 ( 0.0 , 1.0 ) ; for ( int pc = 0 ; pc < SMAA_MAX_SEARCH_STEPS ; pc ++ ) { if ( o_ . x > pa && pb . g > 0.8281 && pb . r == 0.0 ) { pb = texture2D ( oY , o_ , 0.0 ) . rg ; o_ = - vec2 ( 2.0 , 0.0 ) * u_texel_size + o_ ; } } float pd = - ( 255.0 / 127.0 ) * oX ( oZ , pb , 0.0 ) + 3.25 ; return u_texel_size . x * pd + o_ . x ; } float pm ( sampler2D pf , sampler2D pg , vec2 ph , float pi ) { vec2 pj = vec2 ( 0.0 , 1.0 ) ; for ( int pk = 0 ; pk < SMAA_MAX_SEARCH_STEPS ; pk ++ ) { if ( ph . x < pi && pj . g > 0.8281 && pj . r == 0.0 ) { pj = texture2D ( pf , ph , 0.0 ) . rg ; ph = vec2 ( 2.0 , 0.0 ) * u_texel_size + ph ; } } float pl = - ( 255.0 / 127.0 ) * oX ( pg , pj , 0.5 ) + 3.25 ; return - u_texel_size . x * pl + ph . x ; } float pu ( sampler2D pn , sampler2D po , vec2 pp , float pq ) { vec2 pr = vec2 ( 1.0 , 0.0 ) ; for ( int ps = 0 ; ps < SMAA_MAX_SEARCH_STEPS ; ps ++ ) { if ( pp . y > pq && pr . r > 0.8281 && pr . g == 0.0 ) { pr = texture2D ( pn , pp , 0.0 ) . rg ; pp = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pp ; } } float pt = - ( 255.0 / 127.0 ) * oX ( po , pr . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pt + pp . y ; } float pC ( sampler2D pv , sampler2D pw , vec2 px , float py ) { vec2 pz = vec2 ( 1.0 , 0.0 ) ; for ( int pA = 0 ; pA < SMAA_MAX_SEARCH_STEPS ; pA ++ ) { if ( px . y < py && pz . r > 0.8281 && pz . g == 0.0 ) { pz = texture2D ( pv , px , 0.0 ) . rg ; px = vec2 ( 0.0 , 2.0 ) * u_texel_size + px ; } } float pB = - ( 255.0 / 127.0 ) * oX ( pw , pz . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pB + px . y ; } vec2 pJ ( sampler2D pD , vec2 pE , float pF , float pG , float pH ) { vec2 pI = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nM ( 4.0 * vec2 ( pF , pG ) ) + pE ; pI = SMAA_AREATEX_PIXEL_SIZE * pI + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pI . y = SMAA_AREATEX_SUBTEX_SIZE * pH + pI . y ; return texture2D ( pD , pI , 0.0 ) . rg ; } void pR ( sampler2D pK , inout vec2 pL , vec4 pM , vec2 pN ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pO = step ( pN . xy , pN . yx ) ; vec2 pP = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pO ; pP /= pO . x + pO . y ; vec2 pQ = vec2 ( 1.0 , 1.0 ) ; pQ . x -= pP . x * texture2D ( pK , pM . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pQ . x -= pP . y * texture2D ( pK , pM . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pQ . y -= pP . x * texture2D ( pK , pM . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pQ . y -= pP . y * texture2D ( pK , pM . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pL *= clamp ( pQ , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pZ ( sampler2D pS , inout vec2 pT , vec4 pU , vec2 pV ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pW = step ( pV . xy , pV . yx ) ; vec2 pX = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pW ; pX /= pW . x + pW . y ; vec2 pY = vec2 ( 1.0 , 1.0 ) ; pY . x -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pY . x -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pY . y -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pY . y -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pT *= clamp ( pY , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qr ( vec2 p_ , vec2 qa , sampler2D qb , sampler2D qc , sampler2D qd , vec4 qe ) { vec4 qf = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qg = texture2D ( qb , p_ ) . rg ; if ( qg . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qf . rg = oR ( qb , qc , p_ , qg , qe ) ; if ( qf . r == - qf . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qh ; vec3 qi ; qi . x = pe ( qb , qd , no . xy , nq . x ) ; qi . y = np . y ; qh . x = qi . x ; float qj = texture2D ( qb , qi . xy , 0.0 ) . r ; qi . z = pm ( qb , qd , no . zw , nq . y ) ; qh . y = qi . z ; qh = abs ( nM ( qh / u_texel_size . xx - qa . xx ) ) ; vec2 qk = sqrt ( qh ) ; float ql = texture2D ( qb , qi . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qf . rg = pJ ( qc , qk , qj , ql , qe . y ) ; qi . y = p_ . y ; pR ( qb , qf . rg , qi . xyzy , qh ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qg . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qg . r > 0.0 ) { vec2 qm ; vec3 qn ; qn . y = pu ( qb , qd , np . xy , nq . z ) ; qn . x = no . x ; qm . x = qn . y ; float qo = texture2D ( qb , qn . xy , 0.0 ) . g ; qn . z = pC ( qb , qd , np . zw , nq . w ) ; qm . y = qn . z ; qm = abs ( nM ( qm / u_texel_size . yy - qa . yy ) ) ; vec2 qp = sqrt ( qm ) ; float qq = texture2D ( qb , qn . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qf . ba = pJ ( qc , qp , qo , qq , qe . x ) ; qn . x = p_ . x ; pZ ( qb , qf . ba , qn . xyxz , qm ) ; } return qf ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qI ( vec2 qs , sampler2D qt , sampler2D qu".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qv"]}]}}]},{type:"textline",b:") { vec4 qw ; qw . x = texture2D ( qu , nn . xy ) . a ; qw . y = texture2D ( qu , nn . zw ) . g ; qw . wz = texture2D ( qu , qs ) . xz ; if ( dot ( qw , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qx = texture2D ( qt , qs , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qy = texture2D ( qv , a ) ; vec2 qz = 2.0 * cx ( qy ) - 1.0 ; qx . a = sqrt ( 2.0 * length ( qz ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qx ; } else { bool qA = max ( qw . x , qw . z ) > max ( qw . y , qw . w ) ; vec4 qB = vec4 ( 0.0 , qw . y , 0.0 , qw . w ) ; vec2 qC = qw . yw ; nH ( bvec4 ( qA , qA , qA , qA ) , qB , vec4 ( qw . x , 0.0 , qw . z , 0.0 ) ) ; nH ( bvec2 ( qA , qA ) , qC , qw . xz ) ; qC /= dot ( qC , vec2 ( 1.0 , 1.0 ) ) ; vec4 qD = qB * vec4 ( u_texel_size , - u_texel_size ) + qs . xyxy ; vec4 qE = qC . x * texture2D ( qt , qD . xy , 0.0 ) ; qE += qC . y * texture2D ( qt , qD . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qF = texture2D ( qv , qD . xy ) ; vec2 qG = 2.0 * cx ( qF ) - 1.0 ; vec2 qH = qC . x * qG ; qF = texture2D ( qv , qD . zw ) ; qG = 2.0 * cx ( qF ) - 1.0 ; qH += qC . y * qG ; qE . a = sqrt ( 2.0 * length ( qH ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qE",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qU ( vec2 qJ , sampler2D qK , sampler2D qL".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qM"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qN = texture2D ( qM , a ) ; vec2 qO ; qO = 2.0 * cx ( qN ) - 1.0 ; vec4 qP = texture2D ( qK , qJ ) ; vec4 qQ = texture2D ( qL , qJ - qO ) ; float qR = abs ( qP . a * qP . a - qQ . a * qQ . a ) / 2.0 ; float qS = 0.5 * clamp ( 1.0 - sqrt ( qR ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qT = mix ( qP , qQ , qS ) ; qT . a = 1.0 ; return qT ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qP = texture2D ( qK , qJ ) ; vec4 qQ = texture2D ( qL , qJ ) ; return mix ( qP , qQ , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = vec4 ( od ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = qr ( a , nr , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = qI ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = vec4 ( qU ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qV = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qV",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nn",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 no ; varying vec4 np ; varying vec4 nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lg ( vec2 lf ) { no = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lf . xyxy ; np = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lf . xyxy ; nq = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lf . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void lj ( vec2 lh , out vec2 li ) { li = lh / u_texel_size ; no = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lh . xyxy ; np = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lh . xyxy ; nq = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( no . xz , np . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void ll ( vec2 lk ) { nn = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lk . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lg","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"lj ( a , nr ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["ll","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float nt ( in vec2 ns ) { return ni ( u_depth , ns , u_camera_range ) ; } void main ( ) { float nu = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nu , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nv = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float nw = nt ( a ) ; float nx = nw * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float ny = 8.0 ; const int nz = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float ny = 16.0 ; const int nz = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float ny = 24.0 ; const int nz = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float ny = 32.0 ; const int nz = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nA = u_ssao_radius_increase * 0.001 ; const float nB = 1.0 + 2.4 / ny ; float nC = 0.0 ; for ( int nD = 0 ; nD < nz ; nD ++ ) for ( int nE = - 1 ; nE <= 1 ; nE += 2 ) for ( int nF = - 1 ; nF <= 1 ; nF += 2 ) for ( int nG = - 1 ; nG <= 1 ; nG += 2 ) { vec3 nH = reflect ( normalize ( vec3 ( nE , nF , nG ) ) , nv ) * ( nA *= nB ) ; vec3 nI = vec3 ( a , nx ) ; nI += vec3 ( nH . xy , nH . z * nx * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nI . z -= 1.4 * ( nI . z - nx ) * step ( nx , nI . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nJ = nt ( nI . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nK = clamp ( ( nx - nJ ) / nJ , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nC += mix ( 1.0 , nK , step ( nJ , nI . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"nC += mix ( step ( nI . z , nJ ) , 0.5 , nK ) ;".split(" ")}]}}]},{type:"textline",b:"} nC = nC / ny ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nC = clamp ( nC * nC + 0.6 * nC , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nC = clamp ( nC * nC + nC , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nL = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nw ) ; nC = mix ( 1.0 , nC , nL ) ; gl_FragColor = vec4 ( nu , nC , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float nt ( in vec2 ns ) { return ni ( u_depth , ns , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nu = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nv = nt ( a ) ; float nw = 0.0 ; float nx = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 ny = vec2 ( - 2.0 ) ; for ( int nz = 0 ; nz < 4 ; ++ nz ) { for ( int nA = 0 ; nA < 4 ; ++ nA ) { vec2 nB = ( ny + vec2 ( float ( nz ) , float ( nA ) ) ) * u_texel_size ; float nC = texture2D ( u_ssao_mask , a + nB ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nD = nt ( a + nB ) ; float nE = 1.0 - clamp ( abs ( nD - nv ) * nx , 0.0 , 1.0 ) ; nu += nC * nE ; nw += nE ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nu","+=","nC",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nu / nw , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nu / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lf = texture2D ( u_depth , a ) . x ; vec4 lg = vec4 ( a * 2.0 - 1.0 , 2.0 * lf - 1.0 , 1.0 ) ; vec4 lh = u_view_proj_inverse * lg ; vec4 li = lh / lh . w ; vec4 lj = u_view_proj_prev * li ; lj /= lj . w ; vec2 lk = ( lg . xy - lj . xy ) / 4.0 + 0.5 ; lk = clamp ( lk , 0.0 , 1.0 ) ; gl_FragColor = cl ( lk ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } mat4 j ( ) { return mat4 ( 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } mat4 l ( float k ) { return mat4 ( 1.0 , b , b , b , b , cos ( k ) , sin ( k ) , b , b , - sin ( k ) , cos ( k ) , b , b , b , b , 1.0 ) ; } mat4 n ( float m ) { return mat4 ( cos ( m ) , b , - sin ( m ) , b , b , 1.0 , b , b , sin ( m ) , b , cos ( m ) , b , b , b , b , 1.0 ) ; } mat4 p ( float o ) { return mat4 ( cos ( o ) , sin ( o ) , b , b , - sin ( o ) , cos ( o ) , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } c r ( in c q ) { return c ( q . a , q . b , normalize ( q . c ) , normalize ( q . d ) , normalize ( q . e ) , q . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 s = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 y ( vec3 t , mat4 u ) { vec3 v = vec3 ( u [ 0 ] [ 0 ] , u [ 1 ] [ 0 ] , u [ 2 ] [ 0 ] ) ; vec3 w = vec3 ( u [ 0 ] [ 1 ] , u [ 1 ] [ 1 ] , u [ 2 ] [ 1 ] ) ; vec3 x = vec3 ( u [ 0 ] [ 2 ] , u [ 1 ] [ 2 ] , u [ 2 ] [ 2 ] ) ; w = cross ( x , v ) ; return mat4 ( vec4 ( v , 0.0 ) , vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( t , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 E ( vec3 z , vec3 A ) { vec3 B = z - A ; B . y = 0.0 ; B = normalize ( B ) ; vec3 C = normalize ( cross ( s , B ) ) ; vec3 D = normalize ( cross ( B , C ) ) ; return mat4 ( vec4 ( C , 0.0 ) , vec4 ( D , 0.0 ) , vec4 ( B , 0.0 ) , vec4 ( A , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 P ( in vec3 F , float G , float H , float I , vec3 J ) { float L = fract ( length ( J ) / 0.17 ) ; float M = I + L / 10.0 ; float N = L ; if ( I != 0.0 ) N /= I ; F *= 1.0 + 0.5 * sin ( G ) ; float O = length ( F ) * H * sin ( 2.0 * 3.14 * G * M + N ) ; return p ( O ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 _ ( in vec3 Q , in vec3 R , in mat4 S ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 T = y ( R , S ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float U = fract ( ( R . x * 1.43 + R . y * 0.123 + R . z * 6.1 ) ) ; float V = 2.0 * M_PI * U ; vec3 W = normalize ( vec3 ( S [ 0 ] [ 2 ] , 0.0 , S [ 2 ] [ 2 ] ) ) ; float X = acos ( W [ 2 ] ) ; if ( W [ 0 ] < 0.0 ) X = 2.0 * M_PI - X ; float Y = X - V ; if ( Y < 0.0 ) Y = 2.0 * M_PI + Y ; float Z = V ; if ( Y <= MAX_BILLBOARD_ANGLE ) Z += Y ; else if ( Y <= M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Y <= M_PI + MAX_BILLBOARD_ANGLE ) Z += Y - M_PI ; else if ( Y <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else Z += Y - 2.0 * M_PI ; mat4 T = n ( Z ) ; T [ 3 ] = vec4 ( R , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T = E ( Q , R ) ;".split(" ")}]}}]},{type:"textline",b:"return T ; } c ag ( in vec3 aa , in vec3 ab , in vec3 ac , in vec3 ad , in vec3 ae , in mat4 af ) { aa = ( af * vec4 ( aa , 1.0 ) ) . xyz ; ab = ( af * vec4 ( ab , 1.0 ) ) . xyz ; ac = ( af * vec4 ( ac , 0.0 ) ) . xyz ; ad = ( af * vec4 ( ad , 0.0 ) ) . xyz ; ae = ( af * vec4 ( ae , 0.0 ) ) . xyz ; return r ( c ( aa , ab , ac , ad , ae , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 aj ( vec2 ah , vec3 ai ) { return ( ah + 0.5 ) * ai . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 as ( in vec4 ak , in vec4 al , in float am ) { float an = ak [ 0 ] * al [ 0 ] + ak [ 1 ] * al [ 1 ] + ak [ 2 ] * al [ 2 ] + ak [ 3 ] * al [ 3 ] ; if ( an < 0.0 ) { al *= - 1.0 ; an = - an ; } if ( abs ( an ) >= 1.0 ) return ak ; float ao = acos ( an ) ; float ap = sqrt ( 1.0 - an * an ) ; if ( abs ( ap ) < 0.001 ) return vec4 ( ak * 0.5 + al * 0.5 ) ; float aq = sin ( ( 1.0 - am ) * ao ) / ap ; float ar = sin ( am * ao ) / ap ; return ak * aq + al * ar ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aH ( in vec3 at , in vec4 au , in vec4 av , in vec4 aw , in vec4 ax , in float ay ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az = as ( au , av , ay ) ; vec4 aA = mix ( aw , ax , ay ) ; vec3 aB = i ( az , at ) ; vec3 aC = aB * aA . w + aA . xyz ; return aC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aD = i ( au , at ) ; vec3 aE = i ( av , at ) ; vec3 aF = aD * aw . w + aw . xyz ; vec3 aG = aE * ax . w + ax . xyz ; return mix ( aF , aG , ay ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aQ ( in vec3 aI , in vec4 aJ , in vec4 aK , in float aL ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aM = as ( aJ , aK , aL ) ; vec3 aN = i ( aM , aI ) ; return aN ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aO = i ( aJ , aI ) ; vec3 aP = i ( aK , aI ) ; return mix ( aO , aP , aL ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aH ( in vec3 aR , in vec4 aS , in vec4 aT ) { vec3 aU = i ( aS , aR ) ; vec3 aV = aU * aT . w + aT . xyz ; return aV ; } vec3 aQ ( in vec3 aW , in vec4 aX ) { vec3 aY = i ( aX , aW ) ; return aY ; }".split(" ")}]}}]},{type:"textline",b:"void bm ( inout vec3 aZ , inout vec3 a_ , inout vec3 ba , inout vec3 bb ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bc","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bd = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 be = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bh = a_influence ; for ( int bi = 0 ; bi < 4 ; bi ++ ) { int bj = int ( bh [ bi ] ) ; float bk = fract ( bh [ bi ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bd += bk * aH ( aZ , u_quatsb [ bj ] , u_quatsa [ bj ] , u_transb [ bj ] , u_transa [ bj ] , bc ) ; be += bk * aQ ( a_ , u_quatsb [ bj ] , u_quatsa [ bj ] , bc ) ; bf += bk * aQ ( ba , u_quatsb [ bj ] , u_quatsa [ bj ] , bc ) ; bg += bk * aQ ( bb , u_quatsb [ bj ] , u_quatsa [ bj ] , bc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bd += bk * aH ( aZ , u_quatsb [ bj ] , u_transb [ bj ] ) ; be += bk * aQ ( a_ , u_quatsb [ bj ] ) ; bf += bk * aQ ( ba , u_quatsb [ bj ] ) ; bg += bk * aQ ( bb , u_quatsb [ bj ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} aZ = bd ; a_ = be ; ba = bf ; bb = bg ; } if ( ! ( a_influence . y > 0.0 ) ) { int bl = int ( a_influence [ 0 ] - 1.0 ) ; if ( bl > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bl ] , u_quatsa [ bl ] , u_transb [ bl ] , u_transa [ bl ] , bc ) ; a_ = aQ ( a_ , u_quatsb [ bl ] , u_quatsa [ bl ] , bc ) ; ba = aQ ( ba , u_quatsb [ bl ] , u_quatsa [ bl ] , bc ) ; bb = aQ ( bb , u_quatsb [ bl ] , u_quatsa [ bl ] , bc ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bl ] , u_transb [ bl ] ) ; a_ = aQ ( a_ , u_quatsb [ bl ] ) ; ba = aQ ( ba , u_quatsb [ bl ] ) ; bb = aQ ( bb , u_quatsb [ bl ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bA ( inout vec3 bn , in vec3 bo , in float bp , in float bq , in float br , in vec3 bs , in float bt ) { float bu = length ( bo ) ; float bv = bq * ( 1.0 + 0.1 * fract ( bu ) ) ; float bw = bp * bt * ( 1.0 + sin ( 2.0 * 3.14 * br * bv + bu ) ) ; float bx = ( bn . y - bo . y ) * abs ( bw ) ; bx += 1.0 ; bx *= bx ; bx = bx * bx - bx ; vec3 by = bn ; by . xz += bs . xz * bx * sign ( bw ) ; float bz = length ( bn - bo ) ; bn = bo + normalize ( by - bo ) * bz ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bC ( vec4 bB ) { return bB * bB * ( 3.0 - 2.0 * bB ) ; } vec4 bE ( vec4 bD ) { return abs ( fract ( bD + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bG ( vec4 bF ) { return bC ( bE ( bF ) ) ; } void bX ( inout vec3 bH , in float bI , in vec3 bJ , in vec3 bK , in vec3 bL , in float bM , in float bN , in float bO , in vec3 bP ) { float bQ ; float bR ; float bS ; vec2 bT ; vec4 bU ; vec2 bV ; vec3 bW ; bQ = dot ( bL , vec3 ( 1.0 ) ) ; bR = bQ + bP . g ; bS = dot ( bH , vec3 ( bP . g ) ) ; bT = ( bI + vec2 ( bS , bR ) ) ; bU = ( ( fract ( ( bT . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bK ) * bM ; bU = bG ( bU ) ; bV = bU . xz + bU . yw ; bV . y = 0.5 - bV . y ; bW = bV . xyx * bP . rbr * vec3 ( bN * bJ . x , bO , bN * bJ . z ) ; bH += bW ; }".split(" ")}]}}]},
{type:"textline",b:"void cd ( inout vec3 bY , inout vec3 bZ , in vec3 b_ ) { vec3 ca = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 cb = bZ ; vec3 cc = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cb = bY ; vec3 cc = bZ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bX ( cb , u_time , b_ , ca , cc , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bA ( cb , cc , au_wind_bending_amp , au_wind_bending_freq , u_time , ca , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bA ( cb , cc , au_wind_bending_amp , au_wind_bending_freq , u_time , ca , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bY += cb - bZ ; bZ = cb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bY = cb ; bZ = cc ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float ce = 255.0 ; float cf = 0.0 ; float cg = 1.0 ; vec4 cl ( const in float ch ) { vec4 ci = vec4 ( ce * ce * ce , ce * ce , ce , cg ) ; vec4 cj = vec4 ( cf , cg / ce , cg / ce , cg / ce ) ; vec4 ck = fract ( ch * ci ) ; ck -= ck . xxyz * cj ; return ck ; } float cp ( const in vec4 cm ) { float cn ; vec4 co = vec4 ( cg / ( ce * ce * ce ) , cg / ( ce * ce ) , cg / ce , cg ) ; cn = dot ( cm , co ) ; return cn ; } vec4 cl ( const in vec2 cq ) { vec2 cr = vec2 ( ce , cg ) ; vec2 cs = vec2 ( cf , cg / ce ) ; vec4 ct = fract ( cq . xxyy * cr . xyxy ) ; ct -= ct . xxzz * cs . xyxy ; if ( cq . r == cg ) ct . rg = vec2 ( cf , cg ) ; if ( cq . g == cg ) ct . ba = vec2 ( cf , cg ) ; return ct ; } vec2 cx ( const in vec4 cu ) { vec2 cv ; vec2 cw = vec2 ( cg / ce , cg ) ; cv . r = dot ( cu . rg , cw ) ; cv . g = dot ( cu . ba , cw ) ; return cv ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"vec4 cG ( vec4 cF ) { return cF - floor ( cF * ( 1.0 / 289.0 ) ) * 289.0 ; } vec3 cG ( vec3 cH ) { return cH - floor ( cH * ( 1.0 / 289.0 ) ) * 289.0 ; } vec2 cG ( vec2 cI ) { return cI - floor ( cI * ( 1.0 / 289.0 ) ) * 289.0 ; } vec4 cK ( vec4 cJ ) { return cJ - floor ( cJ * ( 1.0 / 7.0 ) ) * 7.0 ; } vec4 cM ( vec4 cL ) { return cG ( ( 34.0 * cL + 5.0 ) * cL ) ; }".split(" ")},{type:"define",name:"K",b:["0.142857142857"]},{type:"define",
name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 cY ( vec2 cN ) { vec2 cO = cG ( floor ( cN ) ) ; vec2 cP = fract ( cN ) ; vec4 cQ = cP . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 cR = cP . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 cS = cM ( cO . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; cS = cM ( cS + cO . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 cT = cK ( cS ) * K + K2 ; vec4 cU = cK ( floor ( cS * K ) ) * K + K2 ; vec4 cV = cQ + JITTER * cT ; vec4 cW = cR + JITTER * cU ; vec4 cX = cV * cV + cW * cW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cX . xy = min ( cX . xy , cX . zw ) ; cX . x = min ( cX . x , cX . y ) ; return cX . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cX . xy = ( cX . x < cX . y ) ? cX . xy : cX . yx ; cX . xz = ( cX . x < cX . z ) ? cX . xz : cX . zx ; cX . xw = ( cX . x < cX . w ) ? cX . xw : cX . wx ; cX . y = min ( cX . y , cX . z ) ; cX . y = min ( cX . y , cX . w ) ; return sqrt ( cX . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dm ( vec2 cZ , float c_ ) { vec2 da = cG ( floor ( cZ ) ) ; vec2 db = fract ( cZ ) ; vec4 dc = db . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dd = db . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 de = cM ( da . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; de = cM ( de + da . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 df = cK ( de ) * K + K2 ; vec4 dg = cK ( floor ( de * K ) ) * K + K2 ; vec4 dh = dc + JITTER * df ; vec4 di = dd + JITTER * dg ; vec4 dj = dh * dh + di * di ; dh += c_ ; di += c_ ; vec4 dk = dh * dh + di * di ; dh += c_ ; di += c_ ; vec4 dl = dh * dh + di * di ; dj . xy = min ( dj . xy , dj . zw ) ; dj . x = min ( dj . x , dj . y ) ; dk . xy = min ( dk . xy , dk . zw ) ; dk . x = min ( dk . x , dk . y ) ; dl . xy = min ( dl . xy , dl . zw ) ; dl . x = min ( dl . x , dl . y ) ; return mat3 ( dj . xx , 0.0 , dk . xx , 0.0 , dl . xx , 0.0 ) ; } vec3 dp ( vec3 dn ) { return cG ( ( ( dn * 34.0 ) + 1.0 ) * dn ) ; } float dD ( vec2 dq ) { const vec4 dr = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 ds = floor ( dq + dot ( dq , dr . yy ) ) ; vec2 dt = dq - ds + dot ( ds , dr . xx ) ; vec2 du ; du = ( dt . x > dt . y ) ? vec2 ( 1.0 , 0.0 ) : vec2 ( 0.0 , 1.0 ) ; vec4 dv = dt . xyxy + dr . xxzz ; dv . xy -= du ; ds = cG ( ds ) ; vec3 dw = dp ( dp ( ds . y + vec3 ( 0.0 , du . y , 1.0 ) ) + ds . x + vec3 ( 0.0 , du . x , 1.0 ) ) ; vec3 dx = max ( 0.5 - vec3 ( dot ( dt , dt ) , dot ( dv . xy , dv . xy ) , dot ( dv . zw , dv . zw ) ) , 0.0 ) ; dx = dx * dx ; dx = dx * dx ; vec3 dy = 2.0 * fract ( dw * dr . www ) - 1.0 ; vec3 dz = abs ( dy ) - 0.5 ; vec3 dA = floor ( dy + 0.5 ) ; vec3 dB = dy - dA ; dx *= 1.79284291400159 - 0.85373472095314 * ( dB * dB + dz * dz ) ; vec3 dC ; dC . x = dB . x * dt . x + dz . x * dt . y ; dC . yz = dB . yz * dv . xz + dz . yz * dv . yw ; return 130.0 * dot ( dx , dC ) ; } vec2 dJ ( vec2 dE ) { float dF = dot ( dE , vec2 ( 12.9898 , 78.233 ) ) ; float dG = dot ( dE , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dH = fract ( sin ( dF ) * 43758.5453 ) * 2.0 - 1.0 ; float dI = fract ( sin ( dG ) * 43758.5453 ) * 2.0 - 1.0 ; return vec2 ( dH , dI ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dL = 0.1 ; const float dM = 0.1 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dN = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dO = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dP = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"textline",b:"float eb ( vec3 dQ , sampler2D dR , float dS ) { float dT ; dQ . z = clamp ( dQ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dT = 0.0 ; float dU = dJ ( dQ . xy ) . x * M_PI ; float dV = cos ( dU ) ; float dW = sin ( dU ) ; mat2 dX = mat2 ( dV , dW , - dW , dV ) ; vec2 dY , dZ ; for ( int d_ = 0 ; d_ < 4 ; d_ ++ ) for ( int ea = 0 ; ea < 4 ; ea ++ ) { dZ . x = dO [ d_ ] [ ea ] ; dZ . y = dP [ d_ ] [ ea ] ; dZ = dX * dZ ; dY = dQ . xy + dZ * dS / SHADOW_TEX_RES ; dT += step ( dQ . z , texture2D ( dR , dY ) . r ) ; } dT /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dT","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dT , 0.0 , 1.0 ) ; } float et ( vec3 ec , sampler2D ed , vec3 ee , sampler2D ef , float eg , float eh , float ei ) { float ej , ek ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ; ee . z = clamp ( ee . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"ej = 0.0 ; ek = 0.0 ; float el = dJ ( ec . xy ) . x * M_PI ; float em = cos ( el ) ; float en = sin ( el ) ; mat2 eo = mat2 ( em , en , - en , em ) ; vec2 ep , eq ; for ( int er = 0 ; er < 4 ; er ++ ) for ( int es = 0 ; es < 4 ; es ++ ) { eq . x = dO [ er ] [ es ] ; eq . y = dP [ er ] [ es ] ; eq = eo * eq ; ep = ec . xy + eq * eg / SHADOW_TEX_RES ; ej += step ( ec . z , texture2D ( ed , ep ) . r ) ; ep = ee . xy + eq * eh / SHADOW_TEX_RES ; ek += step ( ee . z , texture2D ( ef , ep ) . r ) ; } ej = mix ( ej , ek , ei ) ; ej /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ej","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ej , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool ew ( vec2 eu , float ev ) { return all ( lessThanEqual ( eu , vec2 ( 1.0 + ev ) ) ) && all ( greaterThanEqual ( eu , vec2 ( 0.0 - ev ) ) ) ; } float eA ( vec2 ex ) { float ey = min ( ex . x , ex . y ) ; float ez = min ( 1.0 - ex . x , 1.0 - ex . y ) ; return min ( ey , ez ) ; } float eD ( float eB , float eC ) { if ( eC >= 0.0 && eC <= dM ) eB = ( eB - 1.0 ) / dM * eC + 1.0 ; return eB ; } float eP ( vec3 eE , vec3 eF , sampler2D eG , sampler2D eH , float eI , float eJ , float eK , float eL ) { float eM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eN = eA ( eE . xy ) ; if ( - eL > eK && eN >= 0.0 && eN <= dL && ew ( eF . xy , 0.0 ) ) { float eO = 1.0 - eN / dL ; eM = et ( eE , eG , eF , eH , eI , eJ , eO ) ; } else".split(" ")}]}}]},{type:"textline",b:"eM = eb ( eE , eG , eI ) ; return eM ; } float eX ( vec3 eQ , sampler2D eR , float eS , float eT , float eU ) { float eV = eb ( eQ , eR , eS ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eU > eT ) { float eW = eA ( eQ . xy ) ; eV = eD ( eV , eW ) ; }".split(" ")}]}}]},{type:"textline",b:"return eV ; } float fd ( float eY ) { float eZ = 1.0 ; vec3 e_ = cz . xyz / cz . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fa = cA . xyz / cA . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fb = cB . xyz / cB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fc = cC . xyz / cC . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ew ( e_ . xy , 0.0 ) ) { eZ = eP ( e_ , fa , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eY ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( ew ( e_ . xy , dN ) ) { eZ = eX ( e_ , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eY ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ew ( fa . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eZ = eP ( fa , fb , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eY ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eZ = eX ( fa , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eY ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ew ( fb . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eZ = eP ( fb , fc , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eY ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eZ = eX ( fb , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eY ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ew ( fc . xy , 0.0 ) ) eZ = eX ( fc , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eY ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eZ",";","}"]}]}}]}]}}]},{type:"textline",b:"float fi ( inout vec3 fe ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 ff = texture2DProj ( u_shadow_mask , cD ) . rg ; vec3 fg = vec3 ( ff . r ) ; float fh = ff . g ; dK = vec4 ( fg , fh ) ; fe *= dK . a ; return dK . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fd ( cE . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fn ( vec3 fj , float fk , vec2 fl ) { vec2 fm = vec2 ( ( fj . x - fl . x ) / fk , - ( fj . z - fl . y ) / fk ) ; return fract ( fm ) ; } vec2 fr ( vec2 fo , float fp , vec2 fq ) { return vec2 ( fo . x * fp , - fo . y * fp ) + fq ; } c fs ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c fY ( vec3 ft , vec3 fu , vec3 fv , vec3 fw , vec3 fx , sampler2D fy , sampler2D fz , vec3 fA , float fB , vec3 fC , vec4 fD , mat4 fE ) { vec3 fF = i ( fD , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fG = - fF . x ; float fH = - fF . z ; vec2 fI = vec2 ( fC . x + fB * ( - 1.0 - fG ) / 2.0 , fC . z + fB * ( 1.0 - fH ) / 2.0 ) ; vec2 fJ = fn ( fx , fB , fI ) ; float fK = fB / 2.0 ; vec2 fL = abs ( fr ( fJ - vec2 ( 0.5 ) , fB , vec2 ( 0.0 ) ) ) ; float fM = fK * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fL ) > fM ) return fs ( ) ; float fN = fB / fA . z ; vec2 fO = ( fJ - vec2 ( 0.5 ) ) * fN + vec2 ( 0.5 ) ; vec3 fP = fF * ( fB / fA . z - 1.0 ) / 2.0 ; fO . x += fP . x ; fO . y -= fP . z ; vec4 fQ = texture2D ( fz , fO ) ; float fR = fQ . r ; if ( fR < u_scale_threshold ) return fs ( ) ; float fS = fA . y - fA . x ; float fT = fA . y - texture2D ( fy , fO ) . r * fS ; vec2 fU = ft . xz - fx . xz ; fx . xz = fr ( fJ , fB , fI ) ; fx . y = fT ; ft . xz = fx . xz + fU ; ft . y *= fR ; ft . y += fT ; vec3 fV = fQ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"ft -= fx ; mat4 fW = _ ( fC , fx , fE ) ; c fX = ag ( ft , fx , fu , fv , fw , fW ) ; fX . b = fx ; fX . f = fV ; return r ( fX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return r ( c ( ft , fx , fu , fv , fw , fV ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gd ( mat4 fZ , vec4 f_ ) { vec2 ga = ( fZ * u_v_light_matrix [ 3 ] ) . xy ; float gb = SHADOW_TEX_RES / 2.0 ; ga = floor ( ga * gb + 0.5 ) / gb - ga ; vec4 gc = fZ * f_ ; gc . xy += ga ; gc = u_b_light_matrix * gc ; return gc ; } void gh ( vec3 ge ) { vec3 gf = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gg = u_v_light_matrix * vec4 ( ge + u_normal_offset * gf , 1.0 ) ; cz = gd ( u_p_light_matrix0 , gg ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cA = gd ( u_p_light_matrix1 , gg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cB = gd ( u_p_light_matrix2 , gg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cC = gd ( u_p_light_matrix3 , gg ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gh ( vec4 gi ) { float gj = gi . x ; float gk = gi . y ; float gl = gi . w ; cD . x = ( gj + gl ) / 2.0 ; cD . y = ( gk + gl ) / 2.0 ; cD . z = gl ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void go ( inout vec3 gn ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gn = max ( vec3 ( 0.0 ) , gn ) ; gn = pow ( gn , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gq ( inout vec3 gp ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gp = max ( vec3 ( 0.0 ) , gp ) ; gp = pow ( gp , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gt ( inout vec3 gr , in float gs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gr = gr * gs ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gB ( inout vec3 gw , in float gx , in vec4 gy ) { float gz = gy . w * gx ; float gA = exp ( - gz * gz ) ; gA = clamp ( gA , 0.0 , 1.0 ) ; gw = mix ( gy . rgb , gw , gA ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gI ( in mat4 gC , in vec3 gD ) { vec3 gE = mix ( gC [ 0 ] . rgb , gC [ 1 ] . rgb , max ( sign ( gD . x ) , 0.0 ) ) ; vec3 gF = mix ( gC [ 2 ] . rgb , gC [ 3 ] . rgb , max ( sign ( gD . z ) , 0.0 ) ) ; vec3 gG = vec3 ( gC [ 0 ] . a , gC [ 1 ] . a , gC [ 2 ] . a ) ; vec3 gH = mix ( gE , gF , abs ( gD . z ) ) ; gH = mix ( gH , gG , abs ( gD . y ) ) ; return gH ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gK ( inout float gJ ) { gJ -= 0.5 ; gJ = 4.0 * ( gJ * gJ * gJ ) + 0.5 ; } void ha ( inout vec3 gL , in float gM , in vec3 gN , in float gO , in vec4 gP , in vec4 gQ , in float gR , in float gS ) { float gT = gQ . w * gM ; float gU = exp ( - gT * gT ) ; gU = clamp ( gU , 0.0 , 1.0 ) ; float gV = max ( gN . y , 0.0 ) ; gM = max ( gM - max ( gO / gV , 0.0 ) , 0.0 ) ; float gW = gP . w * gM ; float gX = 1.0 - gW ; gX = max ( gX , 0.0 ) ; gK ( gX ) ; gX += max ( gR - 0.5 , 0.0 ) ; if ( gX < gU ) { vec3 gY = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 gZ = gP . rgb ; gO = clamp ( - gO * 0.03 , 0.0 , 0.8 ) ; vec3 g_ = mix ( gZ , gY , min ( gV , 1.0 ) ) ; g_ = mix ( g_ , vec3 ( 0.0 ) , gO ) * gS ; gL = mix ( g_ , gL , gX ) ; } if ( gX >= gU ) { gL = mix ( gQ . rgb , gL , gU ) ; } } void hj ( inout vec3 hb , in float hc , in float hd , in vec4 he , in float hf ) { float hg = he . w * hc ; float hh = 1.0 - hg ; hh = clamp ( hh , 0.0 , 1.0 ) ; gK ( hh ) ; hd = clamp ( - hd * 0.03 , 0.0 , 0.8 ) ; vec3 hi = mix ( he . rgb , vec3 ( 0.0 ) , hd ) * hf ; hb = mix ( hi , hb , hh ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hk = 0.0 ; float hl = 1.0 ; struct hm { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hu ( vec3 hn , vec3 ho , vec3 hp , vec4 hq , float hr ) { vec3 hs = normalize ( hn + ho ) ; float ht = hq [ 0 ] * max ( dot ( hp , hs ) , hk ) + hq [ 1 ] ; return pow ( ht , hr ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hF ( vec3 hv , vec3 hw , vec3 hx , float hy ) { vec3 hz = normalize ( hv + hw ) ; float hA = max ( dot ( hx , hz ) , 0.001 ) ; float hB = max ( dot ( hx , hw ) , 0.01 ) ; float hC = max ( dot ( hx , hv ) , 0.01 ) ; float hD = tan ( acos ( hA ) ) ; float hE = max ( hy , 0.001 ) ; return hC * ( hl / ( 4.0 * M_PI * hE * hE ) ) * ( exp ( - ( hD * hD ) / ( hE * hE ) ) / ( sqrt ( hB * hC ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hN ( vec3 hG , vec3 hH , vec3 hI , float hJ , float hK ) { vec3 hL = normalize ( hG + hH ) ; float hM = acos ( dot ( hL , hI ) ) ; if ( hM < hJ ) return hl ; else if ( hM >= hJ + hK || hK == hk ) return hk ; else return hl - ( hM - hJ ) / hK ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void ih ( float hO , vec3 hP , vec3 hQ , vec3 hR , float hS , inout float hT ) { if ( hS > hk ) { float hU = max ( dot ( hP , hR ) , hk ) ; float hV = hS * hS ; float hW = hl - 0.5 * ( hV / ( hV + 0.33 ) ) ; vec3 hX = hQ - hO * hP ; vec3 hY = hR - hU * hP ; if ( length ( hX ) == hk || length ( hY ) == hk || abs ( hO ) > hl || abs ( hU ) > hl ) hT = hT * hW ; else { float hZ = acos ( hO ) ; float h_ = acos ( hU ) ; vec3 ia = normalize ( hX ) ; vec3 ib = normalize ( hY ) ; float ic , id ; ic = max ( hZ , h_ ) ; id = min ( hZ , h_ ) ; id *= 0.95 ; float ie = max ( dot ( ia , ib ) , hk ) ; float ig = 0.45 * ( hV / ( hV + 0.09 ) ) ; hT = hT * ( hW + ( ig * ie * sin ( ic ) * tan ( id ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void ip ( vec3 ii , vec3 ij , float ik , float il , out float im ) { float io ; if ( ik == hk ) { im = hl ; } else { io = hl + abs ( dot ( ij , ii ) ) ; io = il + ( hl - il ) * pow ( io , ik ) ; im = clamp ( io , hk , hl ) ; } }".split(" ")}]}}]},{type:"textline",b:"void iX ( inout hm iq , vec3 ir , vec3 is , vec3 it , vec3 iu , vec3 iv , vec2 iw , vec2 ix , float iy , vec3 iz , vec3 iA , vec3 iB , vec4 iC , vec4 iD , float iE , vec4 iF ) { if ( iC . w + iD . w == hk ) return ; vec3 iG = vec3 ( hk ) ; vec3 iH = iB * iy ; float iI = iD . z ; if ( iI != - hl ) { iG = iz - it ; float iJ = length ( iG ) ; iH *= iI / ( iI + iJ * iJ ) ; iG = normalize ( iG ) ; float iK = iD . x ; float iL = iD . y ; if ( iK > - hl ) { float iM = dot ( iG , iA ) ; iM *= smoothstep ( hk , hl , ( iM - iK ) / iL ) ; iH *= iM ; } } else iG = iA ; float iN = hk ; if ( iC . w != hk ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ip ( iu , iG , ix [ 0 ] , ix [ 1 ] , iN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iO = max ( dot ( iu , iG ) , hk ) ; iN = iC [ 0 ] * iO + iC [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ih ( iO , iu , iG , iv , ix [ 0 ] , iN ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iP = hk ; if ( iD . w != hk ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iP = hu ( iG , iv , iu , iC , iw [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iP = hF ( iG , iv , iu , iw [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iP = hN ( iG , iv , iu , iw [ 0 ] , iw [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iP","=","hk",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iG , iu ) * dot ( iv , iu ) < hk ) { float iQ = iF . x ; float iR = iF . y ; float iS = iF . z ; float iT = iF . w ; float iU = clamp ( abs ( dot ( iG , iu ) ) , hk , hl ) ; float iV = clamp ( dot ( iv , - iG ) , hk , hl ) ; float iW = pow ( iV , iR ) ; iq . a += iE * vec4 ( iH * iU * pow ( ir , vec3 ( iQ ) ) , hl ) ; iq . a += iS * mix ( vec4 ( ir , hl ) , vec4 ( hl ) , iT ) * iE * vec4 ( iH * iU * vec3 ( iW ) , hl ) ; } else { iq . b += iH * is * iP ; iq . a += vec4 ( iH * ir * iN , iP ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iq . b += iH * is * iP ; iq . a += vec4 ( iH * ir * iN , iP ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hm jJ ( vec3 iY , vec3 iZ , vec3 i_ , vec3 ja , vec3 jb , vec3 jc , vec3 jd , vec2 je , vec2 jf , float jg , vec3 jh [ NUM_LIGHTS ] , vec3 ji [ NUM_LIGHTS ] , vec3 jj [ NUM_LIGHTS ] , vec4 jk [ NUM_LIGHTS ] , vec4 jl [ NUM_LIGHTS ] , float jm , vec4 jn ) { hm jo ; jo . a = vec4 ( iY + i_ * iZ , hk ) ; jo . b = vec3 ( hk ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 0 ] , ji [ 0 ] , jj [ 0 ] , jk [ 0 ] , jl [ 0 ] , jm , jn ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 1 ] , ji [ 1 ] , jj [ 1 ] , jk [ 1 ] , jl [ 1 ] , jm , jn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",
">","2"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 2 ] , ji [ 2 ] , jj [ 2 ] , jk [ 2 ] , jl [ 2 ] , jm , jn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 3 ] , ji [ 3 ] , jj [ 3 ] , jk [ 3 ] , jl [ 3 ] , jm , jn ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jp = 0 ; jp < NUM_LIGHTS ; jp ++ ) { vec4 jq = jk [ jp ] ; vec4 jr = jl [ jp ] ; if ( jq . w + jr . w != hk ) { vec3 js = vec3 ( hk ) ; vec3 jt = jj [ jp ] ; jt *= jg ; float ju = jr . z ; if ( ju != - hl ) { js = jh [ jp ] - jb ; float jv = length ( js ) ; jt *= ju / ( ju + jv * jv ) ; js = normalize ( js ) ; float jw = jr . x ; float jx = jr . y ; if ( jw > - hl ) { float jy = dot ( js , ji [ jp ] ) ; jy *= smoothstep ( hk , hl , ( jy - jw ) / jx ) ; jt *= jy ; } } else js = ji [ jp ] ; float jz = hk ; if ( jq . w != hk ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ip ( jc , js , jf [ 0 ] , jf [ 1 ] , jz ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jA = max ( dot ( jc , js ) , hk ) ; jz = jq [ 0 ] * jA + jq [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ih ( jA , jc , js , jd , jf [ 0 ] , jz ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jB = hk ; if ( jr . w != hk ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jB = hu ( js , jd , jc , jq , je [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jB = hF ( js , jd , jc , je [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jB = hN ( js , jd , jc , je [ 0 ] , je [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( js , jc ) * dot ( jd , jc ) < hk ) { float jC = jn . x ; float jD = jn . y ; float jE = jn . z ; float jF = jn . w ; float jG = clamp ( abs ( dot ( js , jc ) ) , hk , hl ) ; float jH = clamp ( dot ( jd , - js ) , hk , hl ) ; float jI = pow ( jH , jD ) ; jo . a += jm * vec4 ( jt * jG * pow ( i_ , vec3 ( jC ) ) , hl ) ; jo . a += jE * mix ( vec4 ( i_ , hl ) , vec4 ( hl ) , jF ) * jm * vec4 ( jt * jG * vec3 ( jI ) , hl ) ; } else { jo . b += jt * ja * jB ; jo . a += vec4 ( jt * i_ * jz , jB ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"jo . b += jt * ja * jB ; jo . a += vec4 ( jt * i_ * jz , jB ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","jo",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm jO ( vec3 jK , vec3 jL , vec3 jM ) { hm jN ; jN . a = vec4 ( jK + jM * jL , hk ) ; jN . b = vec3 ( hk ) ; return jN ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void ko ( inout vec3 jP , float jQ , float jR , float jS , vec3 jT , vec3 jU , vec3 jV , vec4 jW , vec3 jX , float jY ) { if ( jY > CAUSTICS_VIEW_DISTANCE ) return ; vec4 jZ = jW ; vec3 j_ = jX + jT ; j_ . xz = 10.0 * sin ( 0.1 * j_ . xz ) ; vec3 ka = j_ + 2.0 * cross ( - jZ . xyz , cross ( - jZ . xyz , j_ ) + jZ . w * j_ ) ; vec2 kb = ka . xz ; vec3 kc = jU ; float kd = max ( dot ( jT , kc ) , 0.0 ) ; float ke = 0.025 ; kb . s += 0.5 * sin ( dot ( jX + jR , vec3 ( 1.0 ) ) ) ; kb . t += 0.7 * ( - sin ( dot ( jX - jR , vec3 ( - 0.7 ) ) ) ) ; kb . st += 0.23 * cos ( 4.0 * jQ - CAUST_SPEED . x * jR ) ; kb . st += 3.0 * sin ( jQ - 0.3 * CAUST_SPEED . y * jR ) ; float kf = CAUST_SCALE * ( 1.0 + max ( 0.1 * jQ , 0.0 ) ) ; mat3 kg = dm ( ( kb / kf ) , ke ) ; float kh = ( kg * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float ki = ( kg * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float kj = ( kg * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kk = CAUST_BRIGHT * vec3 ( kh , ki , kj ) ; float kl = jS * kd ; float km = max ( sign ( jQ ) , 0.0 ) ; kl = min ( kl + 0.5 * sign ( - jT . y ) * km , 1.0 ) ; kl *= 1.0 - km * ( 0.1 * jQ ) ; kk *= kl ; kk *= kk ; float kn = min ( - jQ + 10.0 , 1.0 ) ; jP += max ( ( 2.0 * jV * kk ) * kn , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kC ( in vec3 kv , in vec3 kw , in float kx , in float ky ) { vec3 kz = normalize ( kw + kv ) ; float kA = 1.0 - dot ( kv , kz ) ; float kB = ky + ( 1.0 - ky ) * pow ( kA , kx ) ; return kB ; } void kR ( inout vec3 kD , in vec3 kE , in vec3 kF , in float kG , in float kH , in float kI ) { vec3 kJ = reflect ( - kE , kF ) ; float kK = 1.0 ; if ( kG != 0.0 ) kK = kC ( kE , kJ , kG , kH ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kL = u_refl_plane . xyz * dot ( kF , u_refl_plane . xyz ) ; vec3 kM = kF - kL ; vec2 kN = ( u_view_matrix_frag * vec4 ( kM , 0.0 ) ) . xy ; vec2 kO = cD . xy / cD . z ; kO += kN * REFL_BUMP ; vec3 kP = texture2D ( u_reflectmap , kO ) . rgb ; go ( kP . rgb ) ; kD = mix ( kD , kP , kI * kK ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 kQ = textureCube ( u_mirrormap , kJ ) . xyz ; go ( kQ . rgb ) ; kD = mix ( kD , kQ , u_mirror_factor * kK ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kX ( in float kS , inout vec2 kT , in vec2 kU ) { vec4 kV = texture2D ( u_scene_depth , kT ) ; float kW = cp ( kV ) ; if ( kW < ku ) { kT = kU ; return kS ; } else { return kW ; } return kS ; } vec3 le ( in vec3 kY , in vec2 kZ ) { vec2 k_ = kY . xy / kY . z ; vec2 la = k_ + kZ ; vec4 lb = texture2DProj ( u_scene_depth , kY ) ; float lc = cp ( lb ) ; kX ( lc , la , k_ ) ; vec3 ld = texture2D ( u_refractmap , la ) . rgb ; go ( ld ) ; return ld ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mf { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mm ( inout float mg , float mh , vec2 mi , vec2 mj ) { float mk = mj . x - mi . x ; float ml = ( mh - mi . x ) / mk ; mg = mix ( mg , mj . y , clamp ( ml , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mt ( inout vec3 mn , float mo , vec4 mp , vec4 mq ) { float mr = mq . x - mp . x ; float ms = ( mo - mp . x ) / mr ; mn = mix ( mn , mq . yzw , clamp ( ms , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mA ( float mu , float mv , vec2 mw [ SIZE_RAMP_LENGTH ] ) { float mx = mu / mv ; float my = mw [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mm ( my , mx , mw [ 0 ] , mw [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mm ( my , mx , mw [ 1 ] , mw [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mm ( my , mx , mw [ 2 ] , mw [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mz = 1 ; mz < SIZE_RAMP_LENGTH ; mz ++ ) mm ( my , mx , mw [ mz - 1 ] , mw [ mz ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","my",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mH ( float mB , float mC , vec4 mD [ COLOR_RAMP_LENGTH ] ) { float mE = mB / mC ; vec3 mF = mD [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mt ( mF , mE , mD [ 0 ] , mD [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mt ( mF , mE , mD [ 1 ] , mD [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mt ( mF , mE , mD [ 2 ] , mD [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mG = 1 ; mG < COLOR_RAMP_LENGTH ; mG ++ ) mt ( mF , mE , mD [ mG - 1 ] , mD [ mG ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mF",";","}"]}]}}]},{type:"textline",b:"float mQ ( float mI , float mJ , float mK , float mL ) { float mM = max ( 0.01 , min ( mJ , mK ) ) ; float mN = max ( 0.01 , min ( mJ , mL ) ) ; float mO = mJ - mN ; float mP = clamp ( mI / mM , 0.0 , 1.0 ) - step ( mO , mI ) * ( mI - mO ) / mN ; return mP ; } mf mW ( ) { mf mR ; float mS ; if ( u_p_cyclic == 1 ) { mS = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mS < 0.0 ) mS += u_p_length ; } if ( u_p_cyclic != 1 ) { mS = u_p_time - a_p_delay ; } if ( mS < 0.0 || mS >= a_p_lifetime ) { mR . a = 0.0001 ; mR . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mS < 0.0 || mS >= a_p_lifetime ) ) { vec3 mT = a_position ; vec3 mU = a_normal ; mT += u_p_nfactor * mS * mU ; mT += a_p_vels . xyz * mS ; mT . y -= u_p_gravity * mS * mS / 2.0 ; float mV = max ( u_p_mass , EPSILON ) ; mT += ( u_p_wind / mV ) * mS * mS / 2.0 ; mR . b = mT ; mR . e = a_p_vels . w * mS ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mR . a = mA ( mS , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mR . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mR . d = mH ( mS , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mR . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mR . c = mQ ( mS , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mR ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float ni ( in sampler2D nb , in vec2 nc , in vec2 nd ) { float ne = texture2D ( nb , nc ) . r ; float nf = nd . x ; float ng = nd . y ; float nh = 2.0 * nf / ( nf + ng - ( 2.0 * ne - 1.0 ) * ( ng - nf ) ) ; return nh ; }".split(" ")}]}};b4w.module.animation=function(a,n){var b=n("__animation"),c=n("__constraints");n("__physics");var g=n("__print"),f=n("__util");a.SLOT_0=b.SLOT_0;a.SLOT_1=b.SLOT_1;a.SLOT_2=b.SLOT_2;a.SLOT_3=b.SLOT_3;a.SLOT_4=b.SLOT_4;a.SLOT_5=b.SLOT_5;a.SLOT_6=b.SLOT_6;a.SLOT_7=b.SLOT_7;a.SLOT_ALL=b.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=b.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=b.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=b.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=b.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
b.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=b.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=b.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=b.AB_CYCLIC;a.AB_FINISH_RESET=b.AB_FINISH_RESET;a.AB_FINISH_STOP=b.AB_FINISH_STOP;var l=new Float32Array(4);a.is_animated=function(a){return b.is_animated(a)};a.get_actions=function(){for(var a=[],c=b.Cv(),e=0;e<c.length;e++)a.push(b.sy(c[e].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return b.dj(a)?
b.get_anim_names(a):[]};a.get_current_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.Ov(a,c)};a.apply=function(a,c,e){if(e>b.SLOT_7)g.error("Can't apply animation to slot "+e+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{e=e||b.SLOT_0;if(b.is_animated(a)){var f=b.get_slot_num_by_anim(a,c);if(-1!=f&&f!=e){g.error('Animation "'+c+'" is already applied to object "'+a.name+'" (slot "'+f+'").');return}}b.apply(a,c,e)}};a.remove=function(a){b.remove(a)};
a.remove_slot_animation=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.remove_slot_animation(a,c))};a.apply_def=function(a){b.apply_def(a)};a.play=function(a,c,e){b.is_animated(a)?(e=e||b.SLOT_0,b.play(a,c,e),b.update_object_animation(a,0,e)):g.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.stop(a,c))};a.is_play=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_play(a,c)};a.set_current_frame_float=function(b,c,e){a.set_frame(b,
c,e)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,c,e){b.is_animated(a)&&(e=e||b.SLOT_0,b.set_current_frame_float(a,c,e),b.update_object_animation(a,0,e))};a.get_frame=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_current_frame_float(a,c)};a.set_speed=function(a,c,e){b.is_animated(a)&&(e=e||b.SLOT_0,b.set_speed(a,c||1,e))};a.get_speed=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_speed(a,c)};a.get_frame_range=
function(a,c){if(b.is_animated(a)){c=c||b.SLOT_0;var e=a.w[c];if(e)return[e.start,e.start+e.length]}return null};a.get_anim_start_frame=function(a,c){return b.is_animated(a)?(c=c||b.SLOT_0,b.get_anim_start_frame(a,c)):-1};a.get_anim_length=function(a,c){return b.is_animated(a)?(c=c||b.SLOT_0,b.get_anim_length(a,c)):-1};a.cyclic=function(c,f,e){a.set_behavior(c,f?b.AB_CYCLIC:b.AB_FINISH_RESET,e)};a.is_cyclic=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_cyclic(a,c)};a.set_behavior=
function(a,c,e){b.is_animated(a)&&(e=e||b.SLOT_0,b.set_behavior(a,c,e))};a.get_behavior=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.get_behavior(a,c)};a.apply_smoothing=function(a,c,e,f){f=f||b.SLOT_0;b.is_animated(a)&&b.apply_smoothing(a,c,e,f)};a.update_object_animation=function(a,c,e){b.is_animated(a)&&(e=e||b.SLOT_0,b.update_object_animation(a,c||0,e))};a.frame_to_sec=function(a){return b.frame_to_sec(a)};a.get_bone_translation=function(a,b,e){if(!f.df(a))return null;
e||(e=new Float32Array(3));c.Iv(a,b,!1,l,null);e[0]=l[0];e[1]=l[1];e[2]=l[2];return e};a.get_first_armature_object=function(a){return f.uc(a)?b.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,c){return b.is_animated(a)&&c?b.get_slot_num_by_anim(a,c):null};a.get_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.Ev(a,c)};a.get_anim_type=function(a,c){return b.is_animated(a)?b.get_anim_type(a,c):null};a.apply_to_first_empty_slot=function(a,c){return b.apply_to_first_empty_slot(a,
c)};a.get_skel_mix_factor=function(a){return a.d.Id};a.set_skel_mix_factor=function(a,c,e){f.df(a)?(c=Math.min(Math.max(c,0),1),a.d.Id!=c&&b.set_skel_mix_factor(a,c,e||0)):g.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,n){var b=n("__assets");a.AT_ARRAYBUFFER=b.AT_ARRAYBUFFER;a.AT_JSON=b.AT_JSON;a.AT_TEXT=b.AT_TEXT;a.AT_AUDIOBUFFER=b.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=b.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=b.AT_AUDIO_ELEMENT;a.enqueue=function(a,g,f){b.enqueue(a,g,f)}};b4w.module.camera=function(a,n){function b(a,b){c.jc(a)?(r.copy(b,a.d.Wa),k.v(a),f.sync_transform(a)):l.error("set_pivot(): Wrong object or camera move style")}var c=n("__camera"),g=n("__config"),f=n("__physics"),l=n("__print"),h=n("__constraints"),k=n("__transform"),e=n("__util"),r=n("vec3"),v=n("vec4"),m=n("quat"),t=n("mat3"),s=n("mat4"),y=g.controls,d=new Float32Array(3),C=new Float32Array(3),A=new Float32Array(4),u=new Float32Array(4),w=new Float32Array(9);a.MS_STATIC=c.MS_STATIC;a.MS_ANIMATION=
c.MS_ANIMATION;a.MS_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.is_camera=function(a){return c.is_camera(a)};a.set_move_style=function(a,b){a.d.da=b};a.get_move_style=function(a){return c.is_camera(a)?c.get_move_style(a):(l.error("Wrong object"),null)};a.change_eye_target_dist=function(){l.error("change_eye_target_dist() deprecated")};a.change_trans_speed=function(a,b){var c=a.d,d=c.Sj[0],d=d*
(1+b*y.Jt);c.Sj=[d,d,d]};a.get_trans_speed=function(a){return c.is_camera(a)?a.d.Sj[0]:(l.error("Wrong object"),0)};a.set_look_at=function(a,b,d,e){var g=a.d;c.ev(b,d,e,g.e,g.quat);k.v(a);f.sync_transform(a)};a.get_eye=function(a){return a.d.e};a.set_pivot=b;a.get_pivot=function(a,b){if(c.jc(a))return b||(b=new Float32Array(3)),r.copy(a.d.Wa,b),b;l.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,b,g){if(c.jc(a)){var h=a.d;d[0]=0;d[1]=1;d[2]=0;m.setAxisAngle(d,b,
A);e.xq(h.e,h.Wa,A,h.e);d[0]=1;d[1]=0;d[2]=0;r.transformQuat(d,h.quat,d);m.setAxisAngle(d,g,A);e.xq(h.e,h.Wa,A,h.e);k.v(a);f.sync_transform(a)}else l.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,b,e){if(c.jc(a)){var g=a.d;if(g.or){var h=t.fromMat4(g.H,w),m=r.subtract(g.e,g.Wa,C);d[0]=b;d[1]=0;d[2]=e;r.scale(d,r.len(m),d);r.transformMat3(d,h,d);r.add(g.Wa,d,g.Wa);r.add(g.e,d,g.e);k.v(a);f.sync_transform(a)}}else l.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,
b){if(c.Rb(a)){var d=a.d;if(d.Ab&&d.so&&b){var g=m.setAxisAngle(e.AXIS_Y,b,A);m.normalize(g,g);m.multiply(g,d.quat,d.quat);k.v(a);f.sync_transform(a)}}else l.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return c.Rb(a)?c.Oo(a):(l.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,b){if(c.Rb(a)){var g=a.d;if(g.Ab){var h=e.quat_to_dir(g.quat,e.AXIS_X,d),n=c.Oo(a)-b,h=m.setAxisAngle(h,n,A),g=m.multiply(h,g.quat,A);
k.set_rotation(a,g);k.v(a);f.sync_transform(a)}else l.warn("set_hover_cam_angle(): undefined without distance limits")}else l.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){if(c.Rb(a))return a.d.Oa?(b||(b=new Float32Array(2)),b[0]=a.d.Oa.Qa,b[1]=a.d.Oa.Ka):l.warn("get_hover_angle_limits(): camera hasn't angle limits"),b;l.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,b){if(c.Rb(a)||c.jc(a))return a.d.Ab?
(b||(b=new Float32Array(2)),b[0]=a.d.Wf,b[1]=a.d.Hc):l.warn("get_cam_dist_limits(): camera hasn't distance limits"),b;l.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,b){if(c.Rb(a)){var d=a.d;d.Ab?r.copy(b,d.Yd):k.set_translation(a,b);k.v(a);f.sync_transform(a)}else l.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,b){if(!c.Rb(a))return l.error("get_hover_cam_pivot(): wrong object"),null;b||(b=new Float32Array(3));r.copy(a.d.Yd,b);
return b};a.is_use_distance_limits=function(a){return c.jc(a)||c.Rb(a)?a.d.Ab:(l.error("is_use_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,b,d,e){if(c.jc(a)||c.vl(a)){var g=a.d;g.Aa={Ka:b,Qa:d};e==k.SPACE_LOCAL&&c.kz(a);c.Gm(a)}else if(c.Rb(a)){if(b>d){l.error("apply_vertical_limits(): wrong horizontal limits");return}g=a.d;g.Aa={Ka:-d,Qa:-b}}else{l.error("apply_vertical_limits(): wrong object");return}k.v(a);f.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.Aa=
null;(c.jc(a)||c.vl(a))&&c.Gm(a)};a.apply_horizontal_limits=function(a,b,d,e){if(c.jc(a)||c.vl(a)){var g=a.d;g.qb={left:b,right:d};e==k.SPACE_LOCAL&&c.pw(a);c.Gm(a)}else if(c.Rb(a)){if(b>d){l.error("apply_horizontal_limits(): wrong horizontal limits");return}g=a.d;g.qb={left:b,right:d}}else{l.error("apply_horizontal_limits(): wrong object");return}k.v(a);f.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.qb=null};a.apply_hover_angle_limits=function(a,b,d){c.Rb(a)?b>d?l.error("apply_horizontal_limits(): wrong horizontal limits"):
(a.d.Oa={Ka:b,Qa:d},k.v(a),f.sync_transform(a)):l.error("apply_horizontal_limits(): wrong object")};a.clear_hover_angle_limits=function(a){a.d.Oa=null};a.apply_distance_limits=function(a,b,d){if(c.jc(a)||c.Rb(a))if(b>d)l.error("apply_distance_limits(): wrong distance limits");else{var e=a.d;e.Ab=!0;e.Hc=b;e.Wf=d;k.v(a);f.sync_transform(a)}else l.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){c.jc(a)||c.Rb(a)?a.d.Ab=!1:l.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(a,b,d){m.identity(a.d.quat);c.dm(a,Math.PI/2);c.wq(a,b);c.dm(a,-d);k.v(a);f.sync_transform(a)};a.is_look_up=function(a){e.quat_to_dir(a.d.quat,e.AXIS_MY,d);return 0<=d[1]?!0:!1};a.rotate=function(a,b,d){c.wq(a,b);c.dm(a,-d);k.v(a);f.sync_transform(a)};a.get_angles=function(a,b){b||(b=new Float32Array(2));c.get_angles(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a.d.M,e=0;e<d.length;e++){var f=d[e];f.type!=c.ub&&f.type!=c.Cb||c.Sx(f,b,f.Rc)}};a.get_stereo_distance=
function(a){a=a.d.M;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.ub||d.type==c.Cb)return d.di}return 0};a.is_underwater=function(a){return a.d.ir};a.translate_view=function(a,b,e,f){a=a.d.M;for(var g=0;g<a.length;g++){var h=a[g];h.hb||c.tg(h,h.jb);var k=d;k[0]=-b;k[1]=-e;k[2]=0;s.translate(h.ka,k,h.ka);s.rotateZ(h.ka,f,h.ka);s.multiply(h.ka,h.fa,h.Jf);c.Gt(h);c.Ft(h)}};a.correct_up=function(a,b){b||(b=e.AXIS_Y);h.correct_up(a,b)};a.zoom_object=function(a,e){if(c.jc(a)){k.get_object_center(e,
!1,d);b(a,d);k.v(a);var g=k.get_object_size(e),h=c.Dv(a)/2,g=g/Math.sin(h),h=k.$w(a,d);k.move_local(a,0,g-h,0);k.v(a);f.sync_transform(a)}else l.error("zoom_object(): wrong object")};a.calc_ray=function(a,b,d,e){e||(e=new Float32Array(3));var f=a.d.M[0];switch(f.type){case c.rc:case c.Ce:case c.ub:case c.Cb:var g=Math.tan(f.od*Math.PI/360);u[0]=(2*b/f.width-1)*g*f.jb;u[1]=-1;u[2]=(2*d/f.height-1)*g;u[3]=0;v.transformMat4(u,a.d.H,u);e[0]=u[0];e[1]=u[1];e[2]=u[2];r.normalize(e,e);return e;default:return l.error("Non-compatible camera"),
e}};a.project_point=function(a,b,e){e||(e=new Float32Array(2));var f=a.d.M[0];switch(f.type){case c.rc:case c.Ce:case c.ub:case c.Cb:return k.get_translation(a,d),r.subtract(b,d,d),u.set(d),u[3]=0,v.transformMat4(u,f.Jf,u),a=-u[1]/u[3],e[0]=(u[0]/u[3]+1)/2*f.width|0,e[1]=(a+1)/2*f.height|0,e;default:return l.error("Non-compatible camera"),e}}};b4w.module.config=function(a,n){var b=n("__config");a.P_LOW=b.P_LOW;a.P_HIGH=b.P_HIGH;a.P_ULTRA=b.P_ULTRA;a.P_CUSTOM=b.P_CUSTOM;a.set=b.set;a.get=b.get;a.reset=b.reset};b4w.module.controls=function(a,n){var b=n("__controls");n("__print");a.CT_CONTINUOUS=b.CT_CONTINUOUS;a.CT_TRIGGER=b.CT_TRIGGER;a.CT_SHOT=b.CT_SHOT;a.CT_LEVEL=b.CT_LEVEL;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=
74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=
221;a.KEY_SINGLE_QUOTE=222;a.create_custom_sensor=b.create_custom_sensor;a.create_keyboard_sensor=b.create_keyboard_sensor;a.create_collision_sensor=b.create_collision_sensor;a.create_collision_impulse_sensor=b.create_collision_impulse_sensor;a.create_ray_sensor=b.create_ray_sensor;a.create_mouse_click_sensor=b.create_mouse_click_sensor;a.create_mouse_wheel_sensor=b.create_mouse_wheel_sensor;a.create_mouse_move_sensor=b.create_mouse_move_sensor;a.create_touch_move_sensor=b.create_touch_move_sensor;
a.create_touch_zoom_sensor=b.create_touch_zoom_sensor;a.create_motion_sensor=b.create_motion_sensor;a.create_vertical_velocity_sensor=b.create_vertical_velocity_sensor;a.create_timer_sensor=b.create_timer_sensor;a.reset_timer_sensor=b.reset_timer_sensor;a.create_elapsed_sensor=b.create_elapsed_sensor;a.create_timeline_sensor=b.create_timeline_sensor;a.create_selection_sensor=function(a,g){return b.create_selection_sensor(a,g||!1)};a.set_custom_sensor=function(a,g){b.Ix(a,g)};a.get_custom_sensor=function(a){return a.value};
a.get_sensor_value=b.get_sensor_value;a.get_sensor_payload=b.get_sensor_payload;a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,g,f){a.Fl=g.slice(0);a.El=Array(g.length);a.lj=f||b.Vk};a.remove_sensor_lock=function(a){a.Fl=null;a.El=null;a.lj=null};a.create_sensor_manifold=function(a,g,f,l,h,k,e){h=h||b.Vk;b.create_sensor_manifold(a,g,f,l,h,k,void 0===e?null:e)};a.create_kb_sensor_manifold=
function(a,g,f,l,h,k){l=b.create_keyboard_sensor(l);b.create_sensor_manifold(a,g,f,[l],b.Vk,h,void 0===k?null:k)};a.check_sensor_manifolds=function(a){return b.check_sensor_manifold(a,null)};a.check_sensor_manifold=b.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=b.remove_sensor_manifold;a.reset=b.reset;a.register_keyboard_events=b.register_keyboard_events;a.register_mouse_events=b.register_mouse_events;a.register_wheel_events=
b.register_wheel_events;a.register_touch_events=b.register_touch_events;a.unregister_keyboard_events=b.unregister_keyboard_events;a.unregister_mouse_events=b.unregister_mouse_events;a.unregister_wheel_events=b.unregister_wheel_events;a.unregister_touch_events=b.unregister_touch_events};b4w.module.constraints=function(a,n){var b=n("__constraints"),c=n("__physics"),g=n("__transform");a.append_stiff=function(a,l,h,k){l instanceof Array&&2==l.length?b.jn(a,l[0],l[1],h,k):b.kn(a,l,h,k);g.v(a);c.sync_transform(a)};a.append_semi_stiff=function(a,l,h,k){b.ht(a,l,h,k);g.v(a);c.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,h,k,e,n,v,m){b.gt(a,l,h,k,e,n,v,m);g.v(a);c.sync_transform(a)};a.append_semi_soft_cam=function(a,l,h,k){if(!k||0>k)k=.25;b.ft(a,l,h,k);g.v(a);c.sync_transform(a)};
a.append_stiff_trans=function(a,l,h){b.it(a,l,h);g.v(a);c.sync_transform(a)};a.append_copy_trans=function(a,l,h){b.bt(a,l,h);g.v(a);c.sync_transform(a)};a.append_stiff_trans_rot=function(a,l,h,k){b.jt(a,l,h,k);g.v(a);c.sync_transform(a)};a.append_track=function(a,l){3==l.length?b.mt(a,l):b.lt(a,l);g.v(a);c.sync_transform(a)};a.append_follow=function(a,l,h,k){3==l.length?b.dt(a,l,h,k):b.ct(a,l,h,k);g.v(a);c.sync_transform(a)};a.remove=function(a){a.$a&&b.remove(a)}};b4w.module.data=function(a,n){var b=n("__data");n("__print");var c=n("__util");a.load=b.load;a.unload=function(a){b.unload(a|0)};a.set_debug_resources_root=b.set_debug_resources_root;a.is_primary_loaded=b.is_primary_loaded;a.load_and_add_new=b.load;a.get_bpy_world=function(){c.ea("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,n){n("__batch");var b=n("__print"),c=n("__controls"),g=n("__debug"),f=n("__physics"),l=n("__scenegraph"),h=n("__scenes"),k=n("__sfx"),e=n("__textures"),r=n("__util"),v=n("vec3");a.physics_worker=function(){f.Lu()};a.physics_id=function(a){b.log("O",f.hv(a));for(var c=f.Bv().j.l,e=0;e<c.length;e++){var g=c[e];g.gb.F==a&&b.log("B",g)}};a.visible_objects=function(){for(var a=h.get_active(),c=h.na(a,"MESH",h.DATA_ID_ALL),a=h.ia(a,"MAIN_OPAQUE").l,e=0;e<c.length;e++){var f=
c[e],d=f.d;if("DYNAMIC"==d.type)for(var g=0;g<a.length;g++){var k=a[g];if(k.R&&k.Va==d){b.log(f.name,f);break}}}};a.object_info=function(a){for(var c=h.get_active(),e=h.na(c,"MESH",h.DATA_ID_ALL),f=0;f<e.length;f++){var d=e[f];if(d.name==a){b.log("Object",d);for(var g=h.kl(c),k=0;k<g.length;k++){for(var l=g[k],n=l.l,p=[],r=0;r<n.length;r++)n[r].Va==d.d&&p.push(n[r]);b.log("Subscene "+l.type,p)}}}};a.objects_stat=function(){var a=h.get_active();console.log("Armatures: "+h.na(a,"ARMATURE",h.DATA_ID_ALL).length);
console.log("Cameras: "+h.na(a,"CAMERA",h.DATA_ID_ALL).length);console.log("Curves: "+h.na(a,"CURVE",h.DATA_ID_ALL).length);console.log("Empties: "+h.na(a,"EMPTY",h.DATA_ID_ALL).length);console.log("Lamps: "+h.na(a,"LAMP",h.DATA_ID_ALL).length);console.log("Meshes: "+h.na(a,"MESH",h.DATA_ID_ALL).length);console.log("Speakers: "+h.na(a,"SPEAKER",h.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=h.get_active(),b=[h.ia(b,"MAIN_OPAQUE"),h.ia(b,"MAIN_BLEND")],c=0;c<b.length;c++){var e=b[c];
if(e)for(var e=e.l,d=0;d<e.length;d++){var f=e[d].k;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=h.get_active(),b=[h.ia(b,"MAIN_OPAQUE"),h.ia(b,"MAIN_BLEND")],c=0;c<b.length;c++){var e=b[c];if(e)for(var e=e.l,d=0;d<e.length;d++){var f=e[d].k;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=h.get_active(),a=[h.ia(a,"MAIN_OPAQUE"),h.ia(a,"MAIN_BLEND")];return a[0].l.length+a[1].l.length};a.geometry_stats=function(){for(var a=h.get_active(),b=h.kl(a),
a={},c=0;c<b.length;c++){var e=b[c];if("SINK"!=e.type&&"WIREFRAME"!=e.type)for(var d=e.l,f=0;f<d.length;f++){var g=d[f].k,k=d[f].Va;g&&("COLOR_PICKING"!=e.type&&"GLOW_MASK"!=e.type||k.vj)&&(a[g.id]=g)}}var d=e=c=b=0,l;for(l in a)g=a[l],g=g.bb,g.Oi&&(e++,d+=g.Oi/1048576),b++,c+=g.lo/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:e,ibo_memory:d}};a.num_textures=function(){for(var a=[],b=0,c=h.get_active(),c=[h.ia(c,"MAIN_OPAQUE"),h.ia(c,"MAIN_BLEND")],e=0;e<c.length;e++){var d=c[e];if(d)for(var d=
d.l,f=0;f<d.length;f++){var g=d[f].k;if(g)for(var g=g.S,k=0;k<g.length;k++){var l=g[k];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var n=l.Ga;-1===a.indexOf(n)&&(a.push(n),l=l.width*l.height*4/1048576/l.Kk,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=h.get_active(),c=h.kl(c),f=0;f<c.length;f++){var d=c[f];if("SINK"!=d.type){var g=d.h,k=[g.cb,g.hc];k.push.apply(k,d.Tc);for(d=0;d<k.length;d++){var l=k[d];e.Ch(l)&&-1==a.indexOf(l)&&
(a.push(l),b+=g.width*g.height*e.$v(l))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=h.get_active();(a=h.ia(a,"MAIN_OPAQUE"))&&h.Cp(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=h.get_active(),b=h.ia(a,"MAIN_OPAQUE"),a=h.yy(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var e=a[c],d;switch(c){case 0:d=[1,0,0];break;case 1:d=[0,1,0];break;case 2:d=[0,0,1];break;default:d=[1,0,1]}h.Cp(e.h,b,d)}};a.scenegraph_to_dot=function(){var a=h.get_active();
b.log(l.Iu(h.ml(a)))};a.controls_info=c.debug;a.object_distance=function(a,b){return v.dist(a.d.e,b.d.e)};a.msg=g.msg;a.fbmsg=g.fbmsg;a.print_telemetry=g.print_telemetry;a.plot_telemetry=g.plot_telemetry;a.fbres=function(a,b){function c(){g.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),e=new Float32Array([0,1,0]),d=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,
-1,0]),h=new Float32Array([0,0,-1]);if(!r.Od(a,r.Ms))throw"Wrong VEC3_IDENT";if(!r.Od(b,r.Hs))throw"Wrong QUAT4_IDENT";if(!r.Od(c,r.AXIS_X))throw"Wrong AXIS_X";if(!r.Od(e,r.AXIS_Y))throw"Wrong AXIS_Y";if(!r.Od(d,r.AXIS_Z))throw"Wrong AXIS_Z";if(!r.Od(f,r.AXIS_MX))throw"Wrong AXIS_MX";if(!r.Od(g,r.AXIS_MY))throw"Wrong AXIS_MY";if(!r.Od(h,r.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=k.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==k.ol(c)&&k.mute(c,!0)}};
a.check_finite=function(a){g.check_finite(a)};a.set_debug_params=function(a){var b=h.get_active();if(b=h.ia(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&h.Yx(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&h.Xx(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return b.Rv()};a.get_warning_quantity=function(){return b.cw()};a.clear_errors_warnings=function(){return b.clear_errors_warnings()}};b4w.module.geometry=function(a,n){function b(a){return a&&a.d&&a.d.md?!0:!1}var c=n("__batch"),g=n("__geometry"),f=n("__print"),l=n("__renderer");a.extract_vertex_array=function(a,k,e){if(!b(a))return f.error("Wrong object:",a.name),null;if(a=c.T(a,k,"MAIN")||c.T(a,k,"NODES")){if((k=a.bb)&&k.Jb&&k.Jb[e])return g.$u(k,e);f.error("Attribute not found:"+e);return null}f.error("Wrong material:",k);return null};a.extract_index_array=function(a,g){if(!b(a))return f.error("Wrong object:",a.name),null;var e=
c.T(a,g,"MAIN")||c.T(a,g,"NODES");if(e){if((e=e.bb)&&e.Jb)return e.Zd;f.error("Buffer data not found");return null}f.error("Wrong material:",g);return null};a.update_vertex_array=function(a,k,e,l){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))for(var m=0;m<n.length;m++){var t=c.T(a,k,n[m]);t&&(t=t.bb)&&t.Jb&&t.Jb[e]&&g.Xj(t,e,0,l)}else f.error("Wrong object:",a.name)};a.override_geometry=function(a,k,e,n,v){var m=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))if(e instanceof Uint16Array||e instanceof
Uint32Array)if(n instanceof Float32Array)for(var t=0;t<m.length;t++){var s=c.T(a,k,m[t]);if(s){var y=s.bb;if(y){g.Oy(y,s.ld,e);var d=0,C;for(C in y.Jb)var A=y.Jb[C],d=d+n.length/3*A.Kc;y.Wc=new Float32Array(d);var d=y.Wc,u=0;for(C in y.Jb)switch(A=y.Jb[C],C){case "a_position":d.set(n,u);A.offset=u;A.length=n.length;u+=A.length;break;case "a_normal":var w;v&&(w=g.En(e,n,n));var p=g.Cn(e,n,w);d.set(p,u);A.offset=u;A.length=n.length;u+=A.length;break;case "a_tangent":A.offset=u;A.length=n.length/3*A.Kc;
for(var I=new Float32Array(A.length),p=0;p<I.length;p+=4)I[p]=1,I[p+3]=1;d.set(I,u);u+=A.length;break;default:A.offset=u,A.length=n.length/3*A.Kc,p=new Float32Array(A.length),d.set(p,u),u+=A.length}g.Ty(y);l.mn(s);if(s.wb)for(p=0;p<s.wb.length;p++)(A=s.wb[p])&&A.bb&&(A.bb=y)}}}else f.error("Wrong positions_array type");else f.error("Wrong ibo_array type");else f.error("Wrong object:",a.name)}};b4w.module.hud=function(a,n){var b=n("__hud");n("__print");a.draw_mixer_strip=b.draw_mixer_strip;a.plot_array=b.plot_array};b4w.module.lights=function(a,n){function b(a){for(var b=f.get_active(),n=f.na(b,"LAMP",f.DATA_ID_ALL),r=0;r<n.length;r++){var d=n[r];if("SUN"==d.Ha.type){var v=d;break}}if(!v)return c.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(n=(90-a.vert_position)/180*Math.PI,r=v.d,l.set_rotation_euler(v,[n,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),h.quat_to_dir(r.quat,h.AXIS_Y,a),r=k.length(r.e),k.copy(a,e),k.scale(e,r,e),l.set_translation(v,
e),l.v(v),a=v.Ha,a.ro&&(d=v.data.energy,r=b.world.light_settings.environment_energy,n=Math.cos(Math.abs(n)),d*=Math.max(Math.min(3*n,1),0),n=Math.max(n,.1)*r,g.Cq(a,d),f.set_environment_colors(b,n,null,null)),f.Zj(v,b))}var c=n("__print"),g=n("__lights"),f=n("__scenes"),l=n("__transform"),h=n("__util"),k=n("vec3"),e=new Float32Array(3),r,v=60;a.get_lamps=function(a){var b=f.get_active(),b=f.na(b,"LAMP",f.DATA_ID_ALL);if(!a)return b;for(var c=[],e=0;e<b.length;e++){var d=b[e];d.Ha.type===a&&c.push(d)}return c};
a.get_sun_params=function(){for(var a=f.get_active(),a=f.na(a,"LAMP",f.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var e=a[c];if("SUN"==e.Ha.type){b=e;break}}return b?(b=b.Ha.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=b;a.set_day_time=function(a){for(var e=f.get_active(),e=f.na(e,"LAMP",f.DATA_ID_ALL),g=0;g<e.length;g++){var h=e[g];if("SUN"==h.Ha.type){var d=
h;break}}if(!d)return c.error("There is no sun on the scene"),null;d=-Math.cos(a/12*Math.PI)*v;e={};e.hor_position=12>a?15*a:15*(a-24);e.vert_position=d;b(e)};a.set_date=function(a){(r=a.getDate())?1582==r&&10==a.mB&&4<a.Hu&&15>a.Hu&&c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){v=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var b=f.get_active();if(!b)return c.error("No active scene"),
!1;for(var b=f.na(b,"LAMP",f.DATA_ID_ALL),e=0;e<b.length;e++){var g=b[e];if(g.name===a){var d=g.Ha;break}}return d?{light_color:d.color,light_energy:d.ag}:!1};a.set_light_params=function(a,b){var e=f.get_active();if(!e)return c.error("No active scene"),!1;for(var h=f.na(e,"LAMP",f.DATA_ID_ALL),d=0;d<h.length;d++){var k=h[d];if(k.name===a){var l=k.Ha;break}}if(!l)return c.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof b.light_energy&&(g.Cq(l,b.light_energy),f.Zj(k,e));"object"==
typeof b.light_color&&(g.Px(l,b.light_color),f.Zj(k,e))};a.get_lights_names=function(){var a=f.get_active();if(!a)return c.error("No active scene"),!1;for(var b=[],a=f.na(a,"LAMP",f.DATA_ID_ALL),e=0;e<a.length;e++)b.push(a[e].Ha.name);return b}};b4w.module.material=function(a,n){function b(a,b){for(var c=a.P,e=0;e<c.length;e++){var d=c[e];if(-1<d.vc.indexOf(b))return"MAIN"==d.type}return!1}function c(a,b){var c=f.T(a,b,"MAIN");return Boolean(c&&c.nc[0])}function g(a,b){var c=f.T(a,b,"MAIN");return Boolean(c&&c.nc[1])}var f=n("__batch"),l=n("__config"),h=n("__print"),k=n("__shaders"),e=n("__util");n("vec4");var r=l.n,v="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){h.error("max_bones() deprecated, return default value");
return r.max_bones};a.set_max_bones=function(){h.error("set_max_bones() deprecated")};a.set_batch_param=function(){h.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,g){if(e.qp(c)&&e.qp(a)){for(var d=["MAIN","DEPTH","COLOR_ID"],k=!1,l=0;l<d.length;l++){var n=d[l],r=f.T(a,b,n),p=f.T(c,g,n);if(r&&p)for(k=!0,"MAIN"==n&&(p.ob.set(r.ob),p.Se=r.Se,p.Cd.set(r.Cd),p.nc.set(r.nc),p.Ud=r.Ud,p.Dc=r.Dc,p.Dc=r.Dc,p.Re=r.Re,p.Fe=r.Fe),n=0;n<p.ac.length;n++){var I=p.ac[n];if(-1!==v.indexOf(I)){var H=
r.ac.indexOf(I);if(-1!==H&&(p.S[n]=r.S[H],p.wb))for(n=0;n<p.wb.length;n++){var x=p.wb[n],M=x.ac.indexOf(I);-1!==M&&(x.S[M]=r.S[H])}}}}k||h.error("Wrong objects for inheriting material!")}else h.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,c){(a=f.T(a,b,"MAIN"))?a.ob.set(c):h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=
f.T(a,b,"MAIN");if(c){var e=Array(4);e[0]=c.ob[0];e[1]=c.ob[1];e[2]=c.ob[2];e[3]=c.ob[3];return e}h.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){(a=f.T(a,b,"MAIN"))?a.Se=c:h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=f.T(a,b,"MAIN");if(c)return c.Se;h.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){(a=f.T(a,b,"MAIN"))?a.Cd.set(c):h.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var c=f.T(a,b,"MAIN");if(c){var e=Array(3);e[0]=c.Cd[0];e[1]=c.Cd[1];e[2]=c.Cd[2];return e}h.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,e){c(a,b)||h.error('Property "specular_intensity" is missing!');f.T(a,b,"MAIN").nc[0]=e};a.get_specular_intensity=function(a,b){c(a,b)||h.error('Property "specular_intensity" is missing!');return f.T(a,b,"MAIN").nc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,b,
c){g(a,b)||h.error('Property "specular_hardness" is missing!');f.T(a,b,"MAIN").nc[1]=c};a.get_specular_hardness=function(a,b){g(a,b)||h.error('Property "specular_hardness" is missing!');return f.T(a,b,"MAIN").nc[1]};a.check_specular_hardness=g;a.set_emit_factor=function(a,b,c){(a=f.T(a,b,"MAIN"))?a.Ud=c:h.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=f.T(a,b,"MAIN");if(c)return c.Ud;h.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,c){(a=f.T(a,b,"MAIN"))?a.Dc=c:h.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=f.T(a,b,"MAIN");if(c)return c.Dc;h.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){(a=f.T(a,b,"MAIN"))?a.Re=c:h.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=f.T(a,b,"MAIN");if(c)return c.Re;h.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var c=f.T(a,b,"MAIN");c?c.Fe=alpha_factor:h.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=f.T(a,b,"MAIN");if(c)return c.Fe;h.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,c){if(!a||!c)return h.error("B4W Error: missing arguments in get_material_params"),null;if(!b(a,c))return null;var e=f.T(a,c,"MAIN");if(!e)return null;var g={};"MAIN"==e.type&&(g.Uh=e.Uh,g.yA=e.pd[2],g.zA=5*(1-e.pd[3]),g.Mh=e.Mh,g.uB=f.fb(e,
"PARALLAX_STEPS")[1]);return g};a.get_water_material_params=function(a,c){if(!a||!c)return h.error("B4W Error: missing arguments in get_water_material_params"),null;if(!b(a,c))return null;var e=f.T(a,c,"MAIN");if(!e||!e.xe)return null;if(!e)return h.warn("B4W Warning: material not found"),null;var g={};if("MAIN"==e.type){if(r.ug){var d=g.shallow_water_col=Array(3);d[0]=e.shallow_water_col[0];d[1]=e.shallow_water_col[1];d[2]=e.shallow_water_col[2];d=g.shore_water_col=Array(3);d[0]=e.shore_water_col[0];
d[1]=e.shore_water_col[1];d[2]=e.shore_water_col[2];g.shallow_water_col_fac=e.shallow_water_col_fac;g.shore_water_col_fac=e.shore_water_col_fac}g.foam_factor=e.foam_factor;g.absorb_factor=f.fb(e,"ABSORB")[1];g.sss_strength=f.fb(e,"SSS_STRENGTH")[1];g.sss_width=f.fb(e,"SSS_WIDTH")[1];g.dst_noise_scale0=f.fb(e,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=f.fb(e,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=f.fb(e,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=f.fb(e,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=f.fb(e,
"DIR_MIN_SHR_FAC")[1];g.dir_freq=f.fb(e,"DIR_FREQ")[1];g.dir_noise_scale=f.fb(e,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=f.fb(e,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=f.fb(e,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=f.fb(e,"DST_MIN_FAC")[1];g.waves_hor_fac=f.fb(e,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,c,e){if(a&&c&&e){if(!b(a,c))return h.warn("B4W Warning: setting material params is not possible"),null;a=f.T(a,c,"MAIN");a?"MAIN"==a.type&&("number"==typeof e.material_reflectivity&&
(a.Uh=e.material_reflectivity),"number"==typeof e.material_fresnel&&(a.pd[2]=e.material_fresnel),"number"==typeof e.material_fresnel_factor&&(a.pd[3]=1-e.material_fresnel_factor/5),"number"==typeof e.material_parallax_scale&&(a.Mh=e.material_parallax_scale),"number"==typeof e.material_parallax_steps&&(e=k.u(parseFloat(e.material_parallax_steps)),f.U(a,"PARALLAX_STEPS",e),f.tb(a,!0))):h.warn("B4W Warning: material not found")}else h.error("B4W Error: missing arguments in set_material_params")};a.set_water_material_params=
function(a,c,e){if(!a||!c||!e)return h.error("B4W Error: missing arguments in set_water_material_params"),null;if(!b(a,c))return h.warn("B4W Warning: setting water material params is not possible"),null;a=f.T(a,c,"MAIN");if(!a)return h.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(r.ug&&("object"==typeof e.shallow_water_col&&a.shallow_water_col.set(e.shallow_water_col),"number"==typeof e.shallow_water_col_fac&&(a.shallow_water_col_fac=e.shallow_water_col_fac),"object"==typeof e.shore_water_col&&
a.shore_water_col.set(e.shore_water_col),"number"==typeof e.shore_water_col_fac&&(a.shore_water_col_fac=e.shore_water_col_fac)),r.shore_smoothing&&a.Lm&&("boolean"==typeof e.shore_smoothing&&(e.shore_smoothing?f.U(a,"SHORE_SMOOTHING",1):f.U(a,"SHORE_SMOOTHING",0)),"number"==typeof e.absorb_factor&&(c=k.u(parseFloat(e.absorb_factor)),f.U(a,"ABSORB",c))),"number"==typeof e.foam_factor&&r.cg&&(a.foam_factor=e.foam_factor),r.water_dynamic&&a.water_dynamic&&("boolean"==typeof e.water_dynamic&&(e.water_dynamic?
f.U(a,"DYNAMIC",1):f.U(a,"DYNAMIC",0)),"number"==typeof e.waves_height&&(c=k.u(parseFloat(e.waves_height)),f.U(a,"WAVES_HEIGHT",c)),"number"==typeof e.waves_length&&(c=k.u(parseFloat(e.waves_length)),f.U(a,"WAVES_LENGTH",c)),"number"==typeof e.sss_strength&&(c=k.u(parseFloat(e.sss_strength)),f.U(a,"SSS_STRENGTH",c)),"number"==typeof e.sss_width&&(c=k.u(parseFloat(e.sss_width)),f.U(a,"SSS_WIDTH",c)),"number"==typeof e.dst_noise_scale0&&(c=k.u(parseFloat(e.dst_noise_scale0)),f.U(a,"DST_NOISE_SCALE_0",
c)),"number"==typeof e.dst_noise_scale1&&(c=k.u(parseFloat(e.dst_noise_scale1)),f.U(a,"DST_NOISE_SCALE_1",c)),"number"==typeof e.dst_noise_freq0&&(c=k.u(parseFloat(e.dst_noise_freq0)),f.U(a,"DST_NOISE_FREQ_0",c)),"number"==typeof e.dst_noise_freq1&&(c=k.u(parseFloat(e.dst_noise_freq1)),f.U(a,"DST_NOISE_FREQ_1",c)),"number"==typeof e.dir_min_shore_fac&&(c=k.u(parseFloat(e.dir_min_shore_fac)),f.U(a,"DIR_MIN_SHR_FAC",c)),"number"==typeof e.dir_freq&&(c=k.u(parseFloat(e.dir_freq)),f.U(a,"DIR_FREQ",c)),
"number"==typeof e.dir_noise_scale&&(c=k.u(parseFloat(e.dir_noise_scale)),f.U(a,"DIR_NOISE_SCALE",c)),"number"==typeof e.dir_noise_freq&&(c=k.u(parseFloat(e.dir_noise_freq)),f.U(a,"DIR_NOISE_FREQ",c)),"number"==typeof e.dir_min_noise_fac&&(c=k.u(parseFloat(e.dir_min_noise_fac)),f.U(a,"DIR_MIN_NOISE_FAC",c)),"number"==typeof e.dst_min_fac&&(c=k.u(parseFloat(e.dst_min_fac)),f.U(a,"DST_MIN_FAC",c)),"number"==typeof e.waves_hor_fac&&(e=k.u(parseFloat(e.waves_hor_fac)),f.U(a,"WAVES_HOR_FAC",e))),f.tb(a,
!0));return!0}};b4w.module.particles=function(a,n){var b=n("__particles"),c=n("__print");a.set_size=function(a,f,l){b.ig(a)?b.set_size(a,f,l):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,f,l){b.ig(a)?b.set_normal_factor(a,f,l):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,f,l){b.ig(a)?(l=Math.min(l,1),l=Math.max(l,0),b.set_factor(a,f,l)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,n){var b=n("__print"),c=n("__physics"),g=n("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,g){c.has_physics(a)?c.set_gravity(a,g):b.error("No physics for object "+a.name)};a.set_damping=function(a,g,h){c.has_physics(a)?c.m("set_damping",a.j.F,g,h):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var g=a.game;c.m("set_damping",a.j.F,g.damping,g.rotation_damping)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,g,h){c.has_physics(a)?c.set_transform.apply(this,
arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,g,h,k){c.has_physics(a)?c.apply_force.apply(this,
arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,g,h,k){c.has_physics(a)?c.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,g.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,l,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");
l=g.clamp(l,0,1);var k=a.f.bg;-1==h||1==h?k=Math.max(-1,Math.min(k+h*l,1)):0==h&&0<=k?(k-=l,k=Math.max(0,k)):0==h&&0>k?(k+=l,k=Math.min(0,k)):b.error("Wrong steering direction");c.vehicle_throttle(a,g.clamp(k,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,g.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||b.error("Wrong object");l=g.clamp(l,0,1);var k=a.f.Bg;-1==h||1==h?k=Math.max(-1,Math.min(k+h*l,1)):0==h&&0<=k?(k-=l,k=Math.max(0,k)):0==h&&0>k?(k+=l,k=Math.min(0,k)):b.error("Wrong steering direction");c.vehicle_steer(a,g.clamp(k,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,g.clamp(l,0,1))):b.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,l){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=g.clamp(l,-1,1);var h=a.f.dh;c.vehicle_brake(a,g.clamp(h+h*l,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.bg;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Bg;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.dh;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,g,h){c.has_physics(a)?c.set_character_move_dir(a,g,h):b.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,g){c.has_physics(a)?c.set_character_move_type(a,g):b.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){b.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,g){c.has_physics(a)?c.set_character_walk_velocity(a,g):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,g){c.has_physics(a)?c.set_character_run_velocity(a,g):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,g){c.has_physics(a)?c.set_character_fly_velocity(a,g):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,g,h){c.has_physics(a)?c.character_rotation_inc(a,g,h):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,g){c.has_physics(a)?c.set_character_rotation_quat(a,g):b.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,g,h){c.has_physics(a)?c.set_character_rotation(a,g,h):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,g){c.has_physics(a)?c.set_character_rotation_v(a,g):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,g){c.has_physics(a)?c.set_character_rotation_h(a,g):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,g,h,k){c.has_physics(a)?c.append_collision_test(a,g,h,k):b.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,g){c.has_physics(a)?c.remove_collision_test(a,g):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,g){c.has_physics(a)?c.apply_collision_impulse_test(a,g):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,g,h,k,e,n){c.has_physics(a)?c.append_ray_test(a,g,h,k,e,n):b.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,g,h,k,e){c.has_physics(a)?c.remove_ray_test(a,g,h,k,e):b.error("No physics for object "+a.name)};a.apply_constraint=function(a,g,h,k,e,n,v,m,t,s){c.has_physics(g)&&c.has_physics(e)?c.apply_constraint(a,g,h,k,e,n,v,m,t,s):b.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.lw(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,g,h,k,e,n){c.has_physics(a)&&c.has_physics(k)?c.pull_to_constraint_pivot(a,
g,h,k,e,n):b.error("Wrong objects")}};b4w.module.scenes=function(a,n){var b=n("__batch"),c=n("__camera"),g=n("__graph"),f=n("__print"),l=n("__physics"),h=n("__scenes"),k=n("__util");a.DATA_ID_ALL=h.DATA_ID_ALL;a.set_active=function(a){var b=h.Ui();h.set_active(k.keysearch("name",a,b))};a.get_active=function(){return h.W()?h.get_active().name:""};a.get_scenes=function(){for(var a=h.Ui(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(h.W())return h.get_active().camera;f.error("No active scene");return!1};
a.get_object_by_name=function(a,b){return h.Wi(h.hk,a,b)};a.get_object_by_dupli_name=function(a,b,c){return h.Wi(h.Rm,a,b,c)};a.get_object_by_dupli_name_list=function(a,b){return h.Wi(h.Sm,a,b)};a.get_object_by_empty_name=function(b,c,g){f.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,g)};a.get_object_data_id=function(a){return h.get_object_data_id(a)};a.pick_object=h.pick_object;a.set_glow_intensity=function(a,b){for(var c=
0;c<a.P.length;c++){var f=a.P[c];"COLOR_ID"==f.type&&(f.gg=b)}};a.apply_glow_anim=function(a,b,c,f){a.d&&a.d.Mc&&h.apply_glow_anim(a,b,c,f)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Mc){var b=a.d.Xi;h.apply_glow_anim(a,b.ew,b.gw,b.hw)}};a.clear_glow_anim=function(a){a.d&&a.d.Mc&&h.clear_glow_anim(a)};a.set_glow_color=function(a){var b=h.get_active();if(b=h.ia(b,"GLOW"))b.wh.set(a),b.va=!0};a.get_shadow_params=function(){if(!h.W())return f.error("No active scene"),!1;var a=h.get_active(),b=h.ia(a,
"SHADOW_CAST");if(!b)return null;var c=a.d.yc,g=h.ia(a,"MAIN_OPAQUE"),k=h.ia(a,"DEPTH"),l={};l.csm_resolution=c.csm_resolution;l.self_shadow_polygon_offset=b.self_shadow_polygon_offset;k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.b4w_enable_csm=c.b4w_enable_csm;l.csm_num=c.csm_num;l.csm_first_cascade_border=c.csm_first_cascade_border;l.first_cascade_blur_radius=c.first_cascade_blur_radius;l.csm_last_cascade_border=c.csm_last_cascade_border;l.last_cascade_blur_radius=c.last_cascade_blur_radius;
l.fade_last_cascade=c.fade_last_cascade;l.blend_between_cascades=c.blend_between_cascades;c.b4w_enable_csm?(l.csm_borders=h.Nv(a,g.h),l.blur_radii=new Float32Array(c.csm_num),l.blur_radii.set(g.h.Bj.subarray(0,c.csm_num))):(l.csm_borders=null,l.blur_radii=null);return l};a.set_shadow_params=function(a){if(!h.W())return f.error("No active scene"),!1;var k=h.get_active();"number"==typeof a.self_shadow_polygon_offset&&g.K(k.d.Na,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var l=h.ia(k,"DEPTH");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var m=h.ia(k,"MAIN_BLEND");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius),m.va=!0);m=k.d.yc;"number"==typeof a.csm_first_cascade_border&&(m.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(m.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(m.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(m.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var n=l.l,s=0;s<n.length;s++){var y=n[s];y.Va.sb&&(y=y.k,b.rk(y,m),b.tb(y))}l.va=!0}l=k.camera.d.M;for(s=0;s<l.length;s++)c.Yj(l[s],m);h.fm(k)};a.get_environment_colors=
function(){if(!h.W())return f.error("No active scene"),!1;var a=h.get_active();return h.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!h.W())return f.error("No active scene"),!1;var g=h.get_active();h.set_environment_colors(g,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();return h.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!h.W())return f.error("No active scene"),!1;var b=
h.get_active();h.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!h.W())return f.error("No active scene"),!1;var a=h.get_active();return h.get_ssao_params(a)};a.set_ssao_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!h.W())return f.error("No active scene"),null;var a=h.get_active(),a=h.ia(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;
b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!h.W())return f.error("No active scene"),null;var b=h.get_active(),b=h.ia(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.va=!0};a.get_sky_params=function(){if(!h.W())return f.error("No active scene"),
!1;var a=h.get_active();return h.get_sky_params(a)};a.set_sky_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_sky_params(b,a)};a.get_dof_params=function(){if(!h.W())return f.error("No active scene"),!1;var a=h.get_active();return h.ia(a,"DOF")?h.get_dof_params(a):null};a.set_dof_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!h.W())return f.error("No active scene"),
!1;var a=h.get_active();return h.ia(a,"GOD_RAYS")?h.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!h.W())return f.error("No active scene"),!1;var a=h.get_active();return h.ia(a,"BLOOM")?h.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_bloom_params(b,a)};a.get_wind_params=
function(){return h.get_wind_params()};a.set_wind_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_wind_params(b,a)};a.get_water_surface_level=h.get_water_surface_level;a.set_water_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!h.W())return f.error("No active scene"),!1;var b=h.get_active();h.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!h.W())return f.error("No active scene"),!1;var a=h.get_active();h.mr(a)};a.hide_object=function(a){h.hide_object(a)};a.show_object=function(a){h.show_object(a)};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return h.W()?h.check_object(a,h.get_active()):(f.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=h.get_active();a||(a="ALL");b||0===b||(b=h.DATA_ID_ALL);return h.na(c,a,b)};a.get_appended_objs=function(b,c){f.warn("get_appended_objs() deprecated, use get_all_objects() instead");
return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(f.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(f.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Db};a.get_object_children=function(a){return a.Hd.slice(0)};a.get_first_character=function(){for(var a=h.na(h.get_active(),"MESH",h.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||
0===b||(b=1);return h.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return h.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.append_object=function(){k.ea('Method "append_object" is deprecated')};a.add_object=function(){k.ea('Method "add_object" is deprecated')};a.remove_object=function(){k.ea('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){k.ea("get_screen_scenes() deprecated")};a.set_light_pos=function(){k.ea("set_light_pos() deprecated, use lights module instead")};
a.set_light_direction=function(){k.ea("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){k.ea("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){k.ea("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){k.ea("remove_all() deprecated, use lights module instead")};a.check_collision=function(){k.ea("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){k.ea("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,n){var b=n("__scenes"),c=n("__sfx");a.play=function(a,b,l){c.play(a,b,l)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,b,l,h){c.cyclic(a,b);h&&c.playrate(a,h);c.play(a,0,l)};a.speaker_stop=function(a){c.stop(a)};a.stop=function(a){c.stop(a)};a.speaker_playback_rate=function(a,b){c.playrate(a,b)};a.playrate=function(a,b){c.playrate(a,b)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};
a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,l){c.speaker_reset_speed(a,b,l)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.Tv()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.Qx(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.Tw(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.Bw()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};
a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=function(a){c.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(b.get_active())};a.duck=function(a,b,l){a&&"object"===typeof a?c.duck(a,b,l):c.Uu(b,l)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.Ly()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;
a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response};b4w.module.shaders=function(a,n){function b(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var e=a[c];if(-1!=e.search(new RegExp(/^[A-Z.]+ /))){var f=e.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function g(a){for(var b=k.Ui(),c=0;c<b.length;c++)for(var e=k.na(b[c],"MESH",k.DATA_ID_ALL),f=0;f<e.length;f++){var g=e[f];if(g.P)for(var d=0;d<g.P.length;d++){var h=g.P[d];if(h.Yb==a&&h.vc.length)return h.vc}}return null}function f(a){a.sort(function(a,b){return b.hl.ALU_OPS-a.hl.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],e=c.hl,f=c.mz,h=g(c.Fu),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";l.groupCollapsed("FRAG --\x3e",
"ALU",e.ALU_OPS,"TEX",e.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,h);l.groupCollapsed("directives");for(var h=c.Xa.Sd,d=0;d<h.length;d++){var k=h[d];l.log(k[0],k[1])}l.groupEnd();l.groupCollapsed("vert src");l.log(c.lz);l.groupEnd();l.groupCollapsed("vert stats");for(var n in f)"ALU_OPS"!=n&&"TEX_OPS"!=n&&l.log(n,f[n]);l.groupEnd();l.groupCollapsed("frag src");l.log(c.ov);l.groupEnd();l.groupCollapsed("frag stats");for(n in e)"ALU_OPS"!=n&&"TEX_OPS"!=n&&l.log(n,e[n]);l.groupEnd();
l.groupEnd()}}n("__config");var l=n("__print"),h=n("__extensions"),k=n("__scenes"),e=n("__shaders");n("__util");a.report_repeatful_compilation=function(){var a=e.Ju(),b=0,c;for(c in a){var f=a[c],g=f.count;1<g&&l.log(g-1,f.BB,f.SA);b+=g-1}l.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var g=e.Lv(),k=0,n;for(n in g)a&&-1===n.indexOf(a)||k++;var k="of "+k+" analyzing...",s={};for(n in g)if(!a||-1!==n.indexOf(a)){var y=g[n],d;var C=y.Im;d=y.Ho;var A=h.Lo();if(A){C=A.getTranslatedShaderSource(C);
d=A.getTranslatedShaderSource(d);var A=c("/nvidia_vert",C),u=b(A),w=c("/nvidia_frag",d),p=b(w);d={lz:C,MB:A,mz:u,ov:d,xA:w,hl:p}}else l.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),d=void 0;A=y.Xa;C=A.ii+" + "+A.rh;d.Fu=y;d.Xa=A;y=s[C]=s[C]||[];y.push(d);l.log(k)}for(C in s)l.group("%c"+C,"color: #800"),y=s[C],f(y),l.groupEnd()}};b4w.module.textures=function(a,n){var b=n("__textures"),c=n("__print");a.get_canvas_texture_context=function(a){var f=b.Jv(a);if(f)return f;c.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){b.Qy(a)||c.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){b.play_video(a)||c.error('Texture with name "'+a+'" not found!')};a.stop_video=function(a){b.stop_video(a)||c.error('Texture with name "'+a+'" not found!')}};b4w.module.transform=function(a,n){var b=n("__print"),c=n("__physics"),g=n("__transform"),f=n("__util"),l=new Float32Array(3),h=new Float32Array(4);a.SPACE_LOCAL=g.SPACE_LOCAL;a.SPACE_WORLD=g.SPACE_WORLD;a.set_translation=function(a,b,f,h){l[0]=b;l[1]=f;l[2]=h;g.set_translation(a,l);g.v(a);c.sync_transform(a)};a.set_translation_v=function(a,b){g.set_translation(a,b);g.v(a);c.sync_transform(a)};a.set_translation_rel=function(a,b,h,n,m){l[0]=b;l[1]=h;l[2]=n;f.ei(l,1,m.d.quat,m.d.e,l);g.set_translation(a,
l);g.v(a);c.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));g.get_translation(a,b);return b};a.set_rotation=function(a,b,f,l,m){h[0]=b;h[1]=f;h[2]=l;h[3]=m;g.set_rotation(a,h);g.v(a);c.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){g.set_rotation(a,b);g.v(a);c.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));g.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,b,f,h){l[0]=b;l[1]=f;l[2]=h;g.set_rotation_euler(a,l);g.v(a);c.sync_transform(a)};a.set_rotation_euler_v=function(a,b){g.set_rotation_euler(a,b);g.v(a);c.sync_transform(a)};a.set_scale=function(a,b){g.set_scale(a,b);g.v(a)};a.get_scale=function(a){return g.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return b.error("Wrong object: "+a.name),!1;g.set_translation(a,[0,0,0]);g.set_rotation(a,[0,0,0,1]);g.set_scale(a,1);g.v(a);c.sync_transform(a)};
a.get_object_size=function(a){return f.uc(a)?g.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,h){return f.uc(a)?g.get_object_center(a,c,h):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,f,h){g.move_local(a,b,f,h);g.v(a);c.sync_transform(a)};a.get_object_bounding_box=function(a){return g.get_object_bounding_box(a)}};b4w.module.util=function(a,n){var b=n("__print"),c=n("__util"),g=n("vec3");n("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));return c.euler_to_quat(a,b)};a.quat_to_euler=
function(a,b){b||(b=new Float32Array(3));return c.quat_to_euler(a,b)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,l,h,k,e){return 0!=g.dot(h,k)?(b.error("Wrong in-plane direction"),null):c.quat_project(a,l,h,k,e)};a.hash_code=c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;
a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect};"object"==typeof module&&module.Zk&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,n){var b=n("__version");a.version=b.version;a.type=b.type;a.date=b.date};"object"==typeof module&&module.Zk&&b4w.module.version(exports);b4w.module.main=function(a,n){function b(){}function c(){}function g(){}function f(){ca=0;window.performance||(d.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();d.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function l(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();d.error("B4W Error: WebGL context lost");k()},!1);w.Xb(b);var e=w.So();
e&&d.log("%cRENDERER INFO:","color: #00a",b.getParameter(e.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(e.UNMASKED_RENDERER_WEBGL));q.Xb(b);p.Xb(b);O.Xb(b);V.Xb(b);u.Xb(b);A.Xb(b);G.Fq(a.width,a.height);D.init();c=m();r()}function h(){b=function(){}}function k(){e()||(ia=performance.now()/1E3,D.pause(),M.pause(),O.pause())}function e(){return F<ia}function r(){z(r);var a=performance.now()/1E3;Q||(Q=a);var b=a-Q;b<1/R.de||(e()||(F>Q&&(b-=F-Math.max(ia,Q)),ca+=b,u.update(),x.update(),A.update(),v(ca,
b),c(b)),Q=a)}function v(a,c){A.is_primary_loaded()&&(I.reset(),U.update(c),H.update(a,c),D.update(a,c),t.update(c),A.is_primary_loaded()&&(M.update(a,c),A.is_primary_loaded()&&(b(c,a),A.is_primary_loaded()&&(C.update(a,c),A.is_primary_loaded()&&(G.update(a,c),ga&&(ga(X.toDataURL()),ga=null))))))}function m(){var a=60,b=0,c=0,d=R.lv,e=R.kv;return function(f){a=T.smooth(1/f,a,f,d);b=T.smooth(0,b,f,d);c=(c+1)%e;0==c&&g(Math.round(a),Math.round(b))}}var t=n("__animation"),s=n("__compat"),y=n("__config"),
d=n("__print"),C=n("__controls"),A=n("__data"),u=n("__debug"),w=n("__extensions"),p=n("__geometry"),I=n("__hud"),H=n("__nla"),x=n("__assets"),M=n("__physics"),q=n("__renderer"),G=n("__scenes"),D=n("__sfx"),V=n("__shaders"),O=n("__textures"),U=n("__transform"),T=n("__util"),L=n("__version"),P=y.context,R=y.n,X=null,N=null,ca=0,Q=0,ia=0,F=0,ga=null,S=["webgl","experimental-webgl"],z=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/R.de)}}();a.init=function(a,b){y.Rx();d.Wx(R.console_verbose);var c=L.version()+" "+L.type()+" ("+L.date()+")";d.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=f();X=a;var e;e=null;for(var g=0;g<S.length;g++){var h=S[g];try{e=a.getContext(h,P)}catch(k){}if(e)break}if(!e)return null;l(X,e);y.pt();s.Ox(e);d.log("%cSET PRECISION:","color: #00a",R.precision);
b?(I.init(b),N=b):(y.n.show_hud_debug_info=!1,y.Bd.qj=!1);M.rw(c);return e};a.set_check_gl_errors=function(a){u.set_check_gl_errors(a)};a.resize=function(a,b){X.style.width=a+"px";X.style.height=b+"px";N&&(N.style.width=a+"px",N.style.height=b+"px");X.width=a*R.Hi;X.height=b*R.Hi;N&&(N.width=a,N.height=b);I.Lg();G.Fq(a*R.Hi,b*R.Hi);q.clear();v(ca,0);A.Vy(X.width,X.height)};a.set_fps_callback=function(a){g=a};a.clear_fps_callback=function(){g=function(){}};a.set_on_before_render_callback=function(a){b=
a};a.set_render_callback=function(a){b=a};a.clear_on_before_render_callback=function(){h()};a.clear_render_callback=function(){h()};a.global_timeline=function(){return ca};a.redraw=function(){v(ca,0)};a.pause=k;a.resume=function(){e()&&(F=performance.now()/1E3,D.resume(),M.resume(),O.play())};a.is_paused=e;a.reset=function(){A.unload();N=X=null;F=ia=Q=ca=0;g=function(){};c=function(){};b=function(){}};a.canvas_data_url=function(a){ga=a};a.get_canvas_elem=function(){return X};a.set_texture_quality=
function(){T.ea("set_texture_quality() deprecated")};a.set_shaders_dir=function(){T.ea("set_shaders_dir() deprecated")}};b4w.module.app=function(a,n){function b(){var a=m.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=m.is_paused(),m.pause()):a||m.resume()},!1)}function c(a,b){var c=String(a);b&&(c+="/"+String(b));p.innerHTML=c}function g(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function f(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=
document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}n("animation");var l=n("camera"),h=n("config"),
k=n("constraints"),e=n("controls"),r=n("data"),v=n("debug"),m=n("main"),t=n("physics"),s=n("print"),y=n("scenes"),d=n("transform"),C=n("util"),A=n("vec3");n("quat");var u=null,w=null,p=null,I=new Float32Array(2),H=new Float32Array(3),x=new Float32Array(3),M=new Float32Array(4);new Float32Array(4);a.init=function(a){function d(){var a;a=l;var e=H,g=t,h=document.createElement("canvas");h.style.cssText="position: absolute;left:0px; top:0px;";if(ga){var q=document.createElement("canvas");q.style.cssText=
"z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else q=null;m.init(h,q)?(w=h,e=document.getElementById(a),e||(s.error('Warning: canvas container "'+a+'" not found, appending to body'),e=document.body),e.appendChild(h),q&&e.appendChild(q),a=e):(e&&f("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",g),a=null);a?(u=a,m.set_check_gl_errors(n),I&&((a=v)?(x&&(document.getElementById(x).style.display="block"),p=document.getElementById(a)):
(p=document.createElement("div"),p.innerHTML=0,p.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(p)),m.set_fps_callback(c)),C&&b(),k(w,!0)):k(w,!1)}function g(a){a.keyCode==e.KEY_P&&(m.is_paused()?m.resume():m.pause())}function k(){}a=a||{};var l=null,n=!1,t=null,v=null,x=null,y=!0,A=!1,
C=!0,H=!0,I=!1,M=!1,F;for(F in a)switch(F){case "canvas_container_id":l=a.canvas_container_id;break;case "callback":k=a.callback;break;case "do_not_use_onload":break;case "gl_debug":n=a.gl_debug;break;case "show_hud_debug_info":M=a.show_hud_debug_info;break;case "sfx_mix_mode":A=a.sfx_mix_mode;break;case "show_fps":I=a.show_fps;break;case "fps_wrapper_id":x=a.fps_wrapper_id;break;case "fps_elem_id":v=a.fps_elem_id;break;case "error_purge_elements":t=a.error_purge_elements;break;case "report_init_failure":H=
a.report_init_failure;break;case "pause_invisible":C=a.pause_invisible;break;case "key_pause_enabled":y=a.key_pause_enabled;break;default:h.set(F,a[F])}y&&document.addEventListener("keydown",g,!1);h.set("show_hud_debug_info",M);h.set("sfx_mix_mode",A);var ga=M||A||null;"complete"==document.readyState?window.setTimeout(d,0):window.addEventListener("load",d,!1);window.addEventListener("unload",function(){r.cleanup()},!1)};a.get_canvas_container=function(){return u};a.set_onclick=function(a,b){var c=
g(a);c.addEventListener("mouseup",function(){b(c.value)},!1)};a.set_onchange=function(a,b){var c=g(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=g(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=function(a,b,c,f){function g(a,c,d,f){1==d&&(d=.005*b,a=e.get_sensor_value(a,c,0),Y+="X"==f?-a*d:0,Ra+="Y"==f?-a*d:0)}function h(a,c,d,f){if(1==d){d=e.get_sensor_value(a,c,1);var g=
.003*b,k=.001*b;if(1===e.get_sensor_payload(a,c,0))Da+="X"==f?-d*g:0,ma+="Y"==f?-d*g:0;else if(2===e.get_sensor_payload(a,c,0)||3===e.get_sensor_payload(a,c,0))K+="X"==f?-d*k:0,ta+="Y"==f?-d*k:0}}function m(a){return a[0]&&(a[1]||a[2])}function n(c,f,g){if(!ia||!e.get_sensor_value(c,"CAMERA_COLLISION",1)){if(1==g){g=e.get_sensor_value(c,f,0);var h=l.get_trans_speed(c);switch(f){case "FORWARD":v?S[0]=1:w?Math.abs(l.get_hover_cam_angle(c))>Math.PI/4?r(c,C.AXIS_MZ,.1*a*h*g):r(c,C.AXIS_MY,.1*a*h*g):d.move_local(c,
0,-a*h*g,0);break;case "BACKWARD":v?S[0]=-1:w?Math.abs(l.get_hover_cam_angle(c))>=Math.PI/4?r(c,C.AXIS_Z,.1*a*h*g):r(c,C.AXIS_Y,.1*a*h*g):d.move_local(c,0,a*h*g,0);break;case "UP":w?p(c,.3*-a*h*g):v||d.move_local(c,0,0,-a*h*g);break;case "DOWN":w?p(c,.3*a*h*g):v||d.move_local(c,0,0,a*h*g);break;case "LEFT":v?S[1]=1:w?r(c,C.AXIS_MX,.1*a*h*g):d.move_local(c,-a*h*g,0,0);break;case "RIGHT":v?S[1]=-1:w?r(c,C.AXIS_X,.1*a*h*g):d.move_local(c,a*h*g,0,0);break;case "ROT_LEFT":u?l.rotate_pivot(c,2*-b*g,0):
l.rotate(c,2*b*g,0);break;case "ROT_RIGHT":u?l.rotate_pivot(c,2*b*g,0):l.rotate(c,2*-b*g,0);break;case "ROT_UP":u?l.rotate_pivot(c,0,2*-b*g):l.rotate(c,0,2*-b*g);break;case "ROT_DOWN":u?l.rotate_pivot(c,0,2*b*g):l.rotate(c,0,2*b*g)}}else switch(f){case "FORWARD":case "BACKWARD":v&&(S[0]=0);break;case "LEFT":case "RIGHT":v&&(S[1]=0)}v&&(t.set_character_move_dir(v,S[0],S[1]),l.get_angles(c,I),I[0]+=Math.PI,I[1]*=-1,t.set_character_rotation(v,I[0],I[1]))}}function p(a,b){if(l.is_use_distance_limits(a)){var c=
l.get_hover_angle_limits(a,I);if(c[0]-c[1]){var e=l.get_hover_cam_angle(a),c=(e-c[1])/(c[0]-c[1]),f=l.get_cam_dist_limits(a),c=Math.max(c,2/f[0]);l.set_hover_cam_angle(a,e-c*b)}}else e=d.get_translation(a,H),c=A.scale(C.AXIS_Y,-b,x),A.add(e,c,e),l.translate_hover_cam_v(a,e)}function r(a,b,c){if(l.is_use_distance_limits(a))var e=d.get_translation(a,H),f=l.get_hover_cam_pivot(a,x),e=A.subtract(e,f,H),e=Math.max(A.len(e),1);else e=10;f=d.get_rotation_quat(a,M);b=C.quat_to_dir(f,b,H);b[1]=0;A.normalize(b,
b);A.scale(b,e*c,b);l.is_use_distance_limits(a)?(f=l.get_hover_cam_pivot(a,x),A.add(f,b,f),l.translate_hover_cam_v(a,f)):(e=d.get_translation(a,x),A.add(e,b,e),l.translate_hover_cam_v(a,e))}a||(a=1);b||(b=1);c||(c=1);var s=y.get_active_camera(),u=!1,v=null,w=!1;switch(l.get_move_style(s)){case l.MS_TARGET_CONTROLS:u=!f;break;case l.MS_EYE_CONTROLS:v=y.get_first_character();break;case l.MS_STATIC:return;case l.MS_HOVER_CONTROLS:w=!0}f=e.create_elapsed_sensor();if(t.has_simulated_physics(s)){var ia=
e.create_collision_sensor(s,null,!0);e.create_sensor_manifold(s,"CAMERA_COLLISION",e.CT_CONTINUOUS,[f,ia],null,function(a,b,c){1==c&&(b=e.get_sensor_payload(a,b,1),c=d.get_translation(a,H),A.sub(c,b,x),A.normalize(x,x),A.scale(x,.01,x),A.add(c,x,c),d.set_translation_v(a,c))})}if(v){var F=d.get_translation(s),ga=d.get_rotation(s),ga=C.cam_quat_to_mesh_quat(ga);F[1]-=.5;t.set_transform(v,F,ga);k.append_stiff_trans(s,v,[0,.5,0]);var S=new Float32Array(2),z=!0;t.set_character_move_type(v,t.CM_FLY);e.create_kb_sensor_manifold(s,
"TOGGLE_CHAR_MOVE_TYPE",e.CT_SHOT,e.KEY_C,function(){z=!z;t.set_character_move_type(v,z?t.CM_FLY:t.CM_WALK)})}var F=e.create_keyboard_sensor(e.KEY_W),ga=e.create_keyboard_sensor(e.KEY_S),J=e.create_keyboard_sensor(e.KEY_A),ja=e.create_keyboard_sensor(e.KEY_D),na=e.create_keyboard_sensor(e.KEY_R),fa=e.create_keyboard_sensor(e.KEY_F),aa=e.create_keyboard_sensor(e.KEY_UP),ba=e.create_keyboard_sensor(e.KEY_DOWN),B=e.create_keyboard_sensor(e.KEY_LEFT),ea=e.create_keyboard_sensor(e.KEY_RIGHT);w||(e.create_sensor_manifold(s,
"FORWARD",e.CT_CONTINUOUS,[f,F],null,n),e.create_sensor_manifold(s,"BACKWARD",e.CT_CONTINUOUS,[f,ga],null,n));u?(e.create_sensor_manifold(s,"ROT_UP",e.CT_CONTINUOUS,[f,aa,na],m,n),e.create_sensor_manifold(s,"ROT_DOWN",e.CT_CONTINUOUS,[f,ba,fa],m,n),e.create_sensor_manifold(s,"ROT_LEFT",e.CT_CONTINUOUS,[f,B,J],m,n),e.create_sensor_manifold(s,"ROT_RIGHT",e.CT_CONTINUOUS,[f,ea,ja],m,n)):w?(e.create_sensor_manifold(s,"LEFT",e.CT_CONTINUOUS,[f,B,J],m,n),e.create_sensor_manifold(s,"RIGHT",e.CT_CONTINUOUS,
[f,ea,ja],m,n),e.create_sensor_manifold(s,"FORWARD",e.CT_CONTINUOUS,[f,aa,F],m,n),e.create_sensor_manifold(s,"BACKWARD",e.CT_CONTINUOUS,[f,ba,ga],m,n),e.create_sensor_manifold(s,"UP",e.CT_CONTINUOUS,[f,fa],m,n),e.create_sensor_manifold(s,"DOWN",e.CT_CONTINUOUS,[f,na],m,n)):(e.create_sensor_manifold(s,"UP",e.CT_CONTINUOUS,[f,na],m,n),e.create_sensor_manifold(s,"DOWN",e.CT_CONTINUOUS,[f,fa],m,n),e.create_sensor_manifold(s,"LEFT",e.CT_CONTINUOUS,[f,J],m,n),e.create_sensor_manifold(s,"RIGHT",e.CT_CONTINUOUS,
[f,ja],m,n),e.create_sensor_manifold(s,"ROT_UP",e.CT_CONTINUOUS,[f,aa],m,n),e.create_sensor_manifold(s,"ROT_DOWN",e.CT_CONTINUOUS,[f,ba],m,n),e.create_sensor_manifold(s,"ROT_LEFT",e.CT_CONTINUOUS,[f,B],m,n),e.create_sensor_manifold(s,"ROT_RIGHT",e.CT_CONTINUOUS,[f,ea],m,n));var pa=0,F=e.create_mouse_wheel_sensor();e.create_sensor_manifold(s,"MOUSE_WHEEL",e.CT_LEVEL,[F],null,function(b,f,g){1==g&&(f=e.get_sensor_value(b,f,0),u?(g=l.get_eye(b),l.get_pivot(b,H),b=A.dist(H,g),b=-f*b*.1*a,pa+=b):w?(d.get_translation(b,
H),b=.1*-f*a,pa+=b):(b=f*c,f=y.get_active_camera(),l.change_trans_speed(f,b)))});var W=0,F=e.create_touch_zoom_sensor();e.create_sensor_manifold(s,"TOUCH_ZOOM",e.CT_LEVEL,[F],null,function(b,c,f){1==f&&(c=e.get_sensor_value(b,c,0),u?(f=l.get_eye(b),l.get_pivot(b,H),b=A.dist(H,f),b=-c*b*.005*a,W+=b):w&&(d.get_translation(b,H),b=.005*-c*a,W+=b))});e.create_sensor_manifold(s,"ZOOM_INTERPOL",e.CT_CONTINUOUS,[f],null,function(a,b,c){1==c&&(.001<Math.abs(pa)||.001<Math.abs(W))&&(u||w)&&(c=e.get_sensor_value(a,
b,0),b=C.smooth(pa,0,c,.1),pa-=b,c=C.smooth(W,0,c,.15),W-=c,ia&&e.get_sensor_value(a,"CAMERA_COLLISION",1)||(w?p(a,.5*-(b+c)):d.move_local(a,0,b+c,0)))});var Da=0,ma=0,K=0,ta=0,F=e.create_mouse_move_sensor("X"),ga=e.create_mouse_move_sensor("Y"),J=e.create_mouse_click_sensor();e.create_sensor_manifold(s,"MOUSE_X",e.CT_LEVEL,[J,F],null,h,"X");e.create_sensor_manifold(s,"MOUSE_Y",e.CT_LEVEL,[J,ga],null,h,"Y");var Y=0,Ra=0,F=e.create_touch_move_sensor("X"),ga=e.create_touch_move_sensor("Y");e.create_sensor_manifold(s,
"TOUCH_X",e.CT_LEVEL,[F],null,g,"X");e.create_sensor_manifold(s,"TOUCH_Y",e.CT_LEVEL,[ga],null,g,"Y");e.create_sensor_manifold(s,"ROT_TRANS_INTERPOL",e.CT_CONTINUOUS,[f],null,function(a,b,c){if(1==c&&(.001<Math.abs(Da)||.001<Math.abs(ma)||.001<Math.abs(Y)||.001<Math.abs(Ra)||.001<Math.abs(K)||.001<Math.abs(ta))){var d=e.get_sensor_value(a,b,0);b=C.smooth(Da,0,d,.08);c=C.smooth(ma,0,d,.08);Da-=b;ma-=c;var f=C.smooth(Y,0,d,.12),g=C.smooth(Ra,0,d,.12);Y-=f;Ra-=g;var h=C.smooth(K,0,d,.08),d=C.smooth(ta,
0,d,.08);K-=h;ta-=d;u?(l.rotate_pivot(a,b+f,c+g),l.move_pivot(a,h,d)):w?(b+f&&r(a,C.AXIS_X,.2*(b+f)),c+g&&(Math.abs(l.get_hover_cam_angle(a))>Math.PI/4?r(a,C.AXIS_Z,.2*(c+g)):r(a,C.AXIS_Y,.2*(c+g))),l.rotate_hover_cam(a,h-d)):(l.rotate(a,.5*(b+f),.5*-(c+g)),v&&(l.get_angles(a,I),I[0]+=Math.PI,I[1]*=-1,t.set_character_rotation(v,I[0],I[1])))}});e.create_kb_sensor_manifold(s,"DEC_STEREO_DIST",e.CT_SHOT,e.KEY_LEFT_SQ_BRACKET,function(a){var b=l.get_stereo_distance(a);l.set_stereo_distance(a,.9*b)});
e.create_kb_sensor_manifold(s,"INC_STEREO_DIST",e.CT_SHOT,e.KEY_RIGHT_SQ_BRACKET,function(a){var b=l.get_stereo_distance(a);l.set_stereo_distance(a,1.1*b)})};a.disable_camera_controls=function(){for(var a=y.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_object_controls=function(a){function b(a){return a[0]&&
(a[1]||a[2])}function c(a,b,g){if(1==g)switch(g=e.get_sensor_value(a,b,0),b){case "FORWARD":f?t.vehicle_throttle(a,1):d.move_local(a,0,0,1*g);break;case "BACKWARD":f?t.vehicle_throttle(a,-1):d.move_local(a,0,0,-1*g);break;case "LEFT":f?t.vehicle_steer(a,-1):d.move_local(a,1*g,0,0);break;case "RIGHT":f?t.vehicle_steer(a,1):d.move_local(a,-1*g,0,0)}else switch(b){case "FORWARD":case "BACKWARD":f&&t.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":f&&t.vehicle_steer(a,0)}}var f=t.is_vehicle_chassis(a)||
t.is_vehicle_hull(a),g=e.create_elapsed_sensor(),h=e.create_keyboard_sensor(e.KEY_W),k=e.create_keyboard_sensor(e.KEY_S),l=e.create_keyboard_sensor(e.KEY_A),m=e.create_keyboard_sensor(e.KEY_D),n=e.create_keyboard_sensor(e.KEY_UP),p=e.create_keyboard_sensor(e.KEY_DOWN),r=e.create_keyboard_sensor(e.KEY_LEFT),s=e.create_keyboard_sensor(e.KEY_RIGHT);e.create_sensor_manifold(a,"FORWARD",e.CT_CONTINUOUS,[g,h,n],b,c);e.create_sensor_manifold(a,"BACKWARD",e.CT_CONTINUOUS,[g,k,p],b,c);e.create_sensor_manifold(a,
"LEFT",e.CT_CONTINUOUS,[g,l,r],b,c);e.create_sensor_manifold(a,"RIGHT",e.CT_CONTINUOUS,[g,m,s],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){e.register_keyboard_events(document,!1);e.register_mouse_events(a,!0);e.register_wheel_events(a,!0);e.register_touch_events(a,!0)};a.disable_controls=function(a){e.unregister_keyboard_events(document);e.unregister_mouse_events(a);e.unregister_wheel_events(a);
e.unregister_touch_events(a)};a.enable_debug_controls=function(){e.create_kb_sensor_manifold(null,"CAMERA_SHOT",e.CT_SHOT,e.KEY_K,function(){v.make_camera_frustum_shot()});e.create_kb_sensor_manifold(null,"LIGHT_SHOT",e.CT_SHOT,e.KEY_L,function(){v.make_light_frustum_shot()});e.create_kb_sensor_manifold(null,"TELEMETRY",e.CT_SHOT,e.KEY_T,function(){v.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.OB===a||document.mozFullScreenElement===
a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",
d,!1);a.Hj=a.Hj||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.Hj==a.webkitRequestFullScreen?a.Hj(Element.ALLOW_KEYBOARD_INPUT):a.Hj()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||
window.document.PB?!0:!1};a.report_app_error=f;a.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=1<d.length?d[1]:""}return b}};b4w.module.camera_anim=function(a,n){var b=n("camera"),c=n("controls"),g=n("scenes"),f=n("transform"),l=n("util"),h=new Float32Array(3),k=new Float32Array(3),e=new Float32Array(3),r=new Float32Array(4),v=n("vec3"),m=n("quat");a.track_to_target=function(a,g,n,d,C,A,u,w){if(a&&g){if(l.is_vector(g))var p=g;else p=e,f.get_object_center(g,!1,p);g=n||1;n=d||2;var I=C||1;C=A||1;k[0]=0;k[1]=-1;k[2]=0;var H=f.get_rotation_quat(a);A=l.quat_to_dir(H,k);d=b.get_angles(a);var x=f.get_translation(a);v.subtract(p,
x,h);v.normalize(h,h);var M=m.rotationTo(A,h,m.create());m.multiply(M,H,r);l.correct_cam_quat_up(r,!1);v.subtract(p,x,k);var q=v.length(k)*(1-1/n),p=Math.asin(h[1]);n=Math.acos(-h[2]/Math.abs(Math.cos(p)));0<h[0]&&(n=2*Math.PI-n);var G=n-d[0],D=p-d[1];e[0]=0;e[1]=0;e[2]=-1;n=f.get_rotation_quat(a);0>l.quat_to_dir(n,e)[1]?(D=0<A[1]?p-Math.PI+d[1]:p+Math.PI+d[1],G=0<G?-Math.PI+G:Math.PI+G):Math.abs(G)>Math.PI&&(G=0<G?G-2*Math.PI:G+2*Math.PI);var D=-D,V=0,p=c.create_elapsed_sensor();A=Math.abs(G/g);
g=Math.abs(D/g);var O=A>g?A:g,U=O+I,T=U+C,L=T+I,P=G,R=D,X=q;c.create_sensor_manifold(a,"TRACK_TO_TARGET",c.CT_CONTINUOUS,[p],null,function(a,d,e){if(e)if(e=c.get_sensor_value(a,d,0),V+=e,V<O){var g=G/O*e;e*=D/O;d=V/O;d=6*d*(1-d);g*=d;e*=d;P-=g;R-=e;b.rotate(a,g,e)}else V<U?(P&&(b.rotate(a,P,R),P=0,w&&w()),d=(V-O)/I,e=-q*e/I,X-=g,f.move_local(a,0,6*e*d*(1-d),0)):V<T?X&&(f.move_local(a,0,X,0),X=0):V<L?(d=(V-T)/I,e=q*e/I,e=6*e*d*(1-d),f.move_local(a,0,e,0)):(f.set_translation_v(a,x),c.remove_sensor_manifold(a,
d),u&&u())})}};a.auto_rotate=function(a,e){function f(d,e,g){if(1==g)switch(e=c.get_sensor_value(d,e,0),k){case b.MS_TARGET_CONTROLS:b.rotate_pivot(d,e*a,0);break;case b.MS_EYE_CONTROLS:b.rotate(d,e*a,0);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_cam(d,e*a)}}function d(){c.remove_sensor_manifold(h,"AUTO_ROTATE");c.remove_sensor_manifold(h,"DISABLE_AUTO_ROTATE");e()}e=e||function(){};var h=g.get_active_camera(),k=b.get_move_style(h);if(k==b.MS_STATIC)throw"wrong camera type";if(c.check_sensor_manifold(h,
"AUTO_ROTATE"))d();else{var l=c.create_mouse_move_sensor("X"),m=c.create_mouse_move_sensor("Y"),n=c.create_mouse_click_sensor(),r=c.create_elapsed_sensor();c.create_sensor_manifold(h,"DISABLE_AUTO_ROTATE",c.CT_LEVEL,[l,m,n],function(a){return a[0]&&a[2]||a[1]&&a[2]},d);c.create_sensor_manifold(h,"AUTO_ROTATE",c.CT_CONTINUOUS,[r],function(a){return a[0]},f)}}};b4w.module.mixer=function(a,n){function b(){C=d.length=0;A=c();u=new Float32Array(A.length);w=new Float32Array(A.length);var a=s.get_speakers();if(a.length){d.push(g());for(var b=0;b<a.length;b++)d.push(l(a[b]));d.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/99;return a}
function g(){var a=f("MASTER");a.B.push(["VOLUME",s.get_volume(null),0,1,50,!1]);var b=s.get_compressor_params();b&&(a.B.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.B.push(["KNEE",b.knee,0,40,40,!1]),a.B.push(["RATIO",b.ratio,1,20,20,!1]),a.B.push(["ATTACK",b.attack,0,1,1E3,!1]),a.B.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=s.is_muted(null)?1:0;a.mc=-1;return a}function f(a){return{id:a,B:[],Ee:0,mute:-1,mc:-1,ha:null}}function l(a){var b=f(t.get_object_name(a));b.mute=s.is_muted(a)?1:0;
b.mc=0;b.ha=a;return b}function h(a){if(a.ha){a.B.length=0;a.B.push(["VOLUME",s.get_volume(a.ha),0,1,50,!1]);var b=s.get_positional_params(a.ha);b&&(a.B.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.B.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.B.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=s.get_filter_params(a.ha))a.B.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.B.push(["EQ_Q",b.Q,0,10,100,!1]),a.B.push(["EQ_GAIN",b.gain,-70,30,100,!1]);y.clamp(a.Ee,0,a.B.length-1)}}function k(a){for(var b=
0;b<d.length;b++){var c=d[b];if(c!=a&&1==c.mc)return!0}return!1}function e(a){for(var b=0;b<d.length;b++){var c=d[b];c!=a&&0==c.mute&&0==c.mc&&s.mute(c.ha,!1)}}function r(){if(0==d.length)return[0,-1];var a=8*Math.floor(C/8),b=a+7,a=y.clamp(a,0,d.length-1),b=y.clamp(b,0,d.length-1);return[a,b]}var v=n("controls");n("debug");var m=n("hud"),t=n("scenes"),s=n("sfx"),y=n("util"),d=[],C=0,A=null,u=null,w=null;a.enable_mixer_controls=function(){function a(b,c,e){if(1==e){var f=Boolean(v.get_sensor_value(b,
c,2))?-1:1,g=d[C];if(g)switch(e=g.B[g.Ee],e[1]=e[5]?e[1]*Math.pow(e[3]/e[2],f/e[4]):e[1]+(e[3]-e[2])/e[4]*f,e[1]=y.clamp(e[1],e[2],e[3]),e[0]){case "VOLUME":"MASTER"!=g.id?s.set_volume(g.ha,e[1]):s.set_volume(null,e[1]);break;case "DIST_REF":f=s.get_positional_params(g.ha);f.dist_ref=e[1];s.set_positional_params(g.ha,f);break;case "ATTENUATION":f=s.get_positional_params(g.ha);f.attenuation=e[1];s.set_positional_params(g.ha,f);break;case "DIST_MAX":f=s.get_positional_params(g.ha);f.dist_max=e[1];s.set_positional_params(g.ha,
f);break;case "EQ_FREQ":f=s.get_filter_params(g.ha);f.freq=e[1];s.set_filter_params(g.ha,f);break;case "EQ_Q":f=s.get_filter_params(g.ha);f.Q=e[1];s.set_filter_params(g.ha,f);break;case "EQ_GAIN":f=s.get_filter_params(g.ha);f.gain=e[1];s.set_filter_params(g.ha,f);break;case "THRESHOLD":g=s.get_compressor_params();g.threshold=e[1];s.set_compressor_params(g);break;case "KNEE":g=s.get_compressor_params();g.knee=e[1];s.set_compressor_params(g);break;case "RATIO":g=s.get_compressor_params();g.ratio=e[1];
s.set_compressor_params(g);break;case "ATTACK":g=s.get_compressor_params();g.attack=e[1];s.set_compressor_params(g);break;case "RELEASE":g=s.get_compressor_params();g.release=e[1];s.set_compressor_params(g);break;default:throw"Unknown strip param";}"INC_DEC"==c?v.reset_timer_sensor(b,c,6,.3):v.reset_timer_sensor(b,c,6,0)}else v.reset_timer_sensor(b,c,6,10)}function c(a,b,e){if(1==e){e=Boolean(v.get_sensor_value(a,b,0))?-1:1;if(d.length){1==e&&C<d.length-1?C++:-1==e&&0<C&&C--;e=r();for(var f=e[0];f<=
e[1];f++)h(d[f])}"SWITCH_STRIP"==b?v.reset_timer_sensor(a,b,5,.3):v.reset_timer_sensor(a,b,5,0)}else v.reset_timer_sensor(a,b,5,10)}b();var f=v.create_keyboard_sensor(v.KEY_LEFT_SQ_BRACKET),g=v.create_keyboard_sensor(v.KEY_RIGHT_SQ_BRACKET),l=v.create_keyboard_sensor(v.KEY_SEMI_COLON),n=v.create_keyboard_sensor(v.KEY_SINGLE_QUOTE),t=v.create_keyboard_sensor(v.KEY_SHIFT),D=v.create_timer_sensor(.15),V=v.create_timer_sensor(.05),f=[f,g,l,n,t,D,V];v.create_sensor_manifold(null,"SWITCH_STRIP",v.CT_TRIGGER,
f,function(a){return(a[0]||a[1])&&!a[4]},c);v.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",v.CT_SHOT,f,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},c);v.create_sensor_manifold(null,"SWITCH_PARAM",v.CT_SHOT,f,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(v.get_sensor_value(a,b,0))?-1:1,e=d[C];e&&(1==c&&e.Ee<e.B.length-1?e.Ee++:-1==c&&0<e.Ee&&e.Ee--)});v.create_sensor_manifold(null,"INC_DEC",v.CT_TRIGGER,f,function(a){return(a[2]||a[3])&&!a[4]},a);v.create_sensor_manifold(null,
"INC_DEC_HOLD",v.CT_SHOT,f,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);v.create_sensor_manifold(null,"MUTE_SOLO",v.CT_SHOT,f,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(v.get_sensor_value(a,b,2))){var c=d[C];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,s.mute(c.ha,!0),1==c.mc&&(c.mc=0,k(c)||e(c))):(c.mute=0,k(c)||s.mute(c.ha,!1)):0==c.mute?(c.mute=1,s.mute(null,!0)):(c.mute=0,s.mute(null,!1)))}else if((c=d[C])&&0<=c.mc)if(0==c.mc){c.mc=1;s.mute(c.ha,!1);1==c.mute&&(c.mute=
0);for(var f=0;f<d.length;f++){var g=d[f];g!=c&&0==g.mute&&0==g.mc&&s.mute(g.ha,!0)}}else c.mc=0,k(c)?s.mute(c.ha,!0):e(c)});f=v.create_elapsed_sensor();v.create_sensor_manifold(null,"MIXER_DRAW",v.CT_CONTINUOUS,[f],null,function(){if(d[C])for(var a=r(),b=a[0];b<=a[1];b++){var c=d[b];m.draw_mixer_strip(c.id,b==C,b%8,c.B,c.Ee,c.mute,c.mc);if(c.ha&&s.get_filter_params(c.ha)){s.get_filter_freq_response(c.ha,A,u,w);for(c=0;c<u.length;c++)u[c]=20*Math.log(u[c])/Math.LN10;m.plot_array("EQ",b%8,u,20,2E4,
-10,10)}}});f=v.create_timer_sensor(1);v.create_sensor_manifold(null,"MIXER_UPDATE",v.CT_TRIGGER,[f],null,function(){for(var a=r(),b=a[0];b<=a[1];b++)h(d[b])})}};b4w.module.npc_ai=function(a,n){function b(a,b){var c=b.destination,d=C;y.get_translation(b.empty,d);var f=A;y.get_translation(b.collider,f);var g=0;b.Ug?g=b.Ug:b.Fd&&(g=b.Fd,b.type==x&&(g*=.5),b.type==q&&(g*=a));switch(b.type){case x:if(b.random&&b.je){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var l=I,d=u,n=b.speed,t=b.rot_speed;y.get_rotation_quat(b.collider,l);k.transformQuat(m.AXIS_Z,l,d);d[1]=0;k.normalize(d,d);l=.5*n/Math.sin(t/2);n=k.dist(c,f);n<2*l&&k.scaleAndAdd(c,
d,2*l-n,c);b.je=!1}c[1]=f[1];g&&(c[1]+=g);break;case M:case q:b.random&&b.je&&(b.type==q?(b.speed=Math.random()+.1,l=b.Lw-b.Rw):l=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=f[1]+(Math.random()*l-.5*l),c[2]=10*Math.random()-5+d[2],b.je=!1),g&&(c[1]=f[1]+g)}var c=C,d=A,n=u,f=H,s=b.rig,l=b.collider,g=b.destination,v=b.speed,ca=b.actions,Q=r.get_current_action(s);if(!r.is_play(s)||!ca.yh||-1==ca.yh.indexOf(Q)){y.get_translation(l,c);var t=g[0]-c[0],ia=g[2]-c[2],t=Math.sqrt(t*t+ia*ia);
if(t>2*v*a)b.state=20,m.xz_direction(g,c,n),ca=b.rig,r.is_animated(ca)&&(s=b.speed,v=r.get_current_frame_float(ca),ca=r.get_anim_length(ca),s*=ca/24*(1-v/ca),.9>t/s&&k.scaleAndAdd(g,n,s-t,g)),t=I,s=w,y.get_rotation_quat(b.collider,t),k.transformQuat(m.AXIS_Z,t,d),s[0]=d[0],s[1]=0,s[2]=d[2],k.normalize(s,s),v=k.dot(s,n),ca=a/(Math.abs(Math.acos(v))/Math.PI)*b.rot_speed*b.em,e.rotationTo(s,n,f),e.rotationTo(m.AXIS_Z,s,t),1<=Math.abs(v)?e.copy(t,f):(e.multiply(f,t,f),e.slerp(t,f,Math.min(ca,1),f)),n=
a,b.type!=M&&(n=Math.max(n,1/60),t=p,s=I,e.setAxisAngle(m.AXIS_X,-Math.asin(d[1]),s),e.setAxisAngle(m.AXIS_X,-Math.atan(b.Fd/(b.speed*n)),t),e.slerp(s,t,n,t),e.multiply(f,t,f)),y.set_rotation_quat_v(l,f),d=u,l=w,m.quat_to_dir(f,m.AXIS_Z,d),k.scale(d,b.speed*a,l),k.add(l,c,l),l[1]=b.type!=x?(g[1]-c[1])*a*.1+c[1]:g[1],y.set_translation_v(b.collider,l);else if(b.type==x)ca.move?Q&&-1!=ca.move.indexOf(Q)&&r.is_play(s)?b.state=20:(b.state=10,b.je=!0):(b.state=10,b.je=!0);else if(b.type==q||b.type==M)b.je=
!0;if(h(b)&&(c=b.rig,!r.is_play(c))){f=null;switch(b.state){case 10:f=b.actions;f=f.yh?m.random_from_array(f.yh):null;break;case 20:f=r.get_current_action(b.rig),d=g=b.actions,d.vd&&-1==d.vd.indexOf(f)&&d.move&&-1!=d.move.indexOf(f)&&.33<Math.random()?(g=b.actions,f=g.vd[g.move.indexOf(f)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(f)||!d.vd&&!d.ee||!d.ee&&!f||d.vd&&-1!=d.vd.indexOf(f)||d.ee&&-1!=d.ee.indexOf(f))?(g=b.actions,g.vd?(d=g.vd.indexOf(f),-1!=d?(f=d+1,f=f<g.move.length?f:0,f=g.move[f]):
f=-1!=g.move.indexOf(f)?f:m.random_from_array(g.move)):f=m.random_from_array(g.move)):(d=b.actions,f=d.ee&&-1==d.ee.indexOf(f)&&d.move&&-1==d.move.indexOf(f)?m.random_from_array(g.ee):null))}f&&(r.apply(c,f),r.cyclic(c,!1),r.set_current_frame_float(c,0),r.play(c))}}}function c(a,b,c,d){if(d)if(1==c)switch(d.type){case M:a:{for(c=0;3>c;c++){var e=v.get_sensor_payload(a,b,c);if(e){b=e;break a}}b=void 0}a=100*b;d.Fd=a<d.min_height?10:a>d.max_height?-10:0;break;case x:a=v.get_sensor_payload(a,b,0);d.Fd=
d.iq==a?0:1-100*a;d.iq=a;break;case q:a=v.get_sensor_payload(a,b,0),"CLOSE_GROUND"==b?(d.Fd=100*a-1,d.Fd=.1>d.Fd?.05:0):"CLOSE_WATER"==b&&(d.Ug=100*a,d.Ug=d.Ug<d.Rw?-.02:d.Ug>d.Lw?.02:0)}else d.Fd=0}function g(){for(var a=0;a<d.length;a++){var b=d[a];f(b);l(b);b.rig&&r.get_current_action(b.rig)&&r.play(b.rig)}}function f(a){var b=[0,0,0],d=a.collider;switch(a.type){case M:var e=v.create_ray_sensor(d,b,[0,-100,0],!1,"TERRAIN"),f=v.create_ray_sensor(d,b,[0,-100,0],!1,"STONE"),b=v.create_ray_sensor(d,
b,[0,-100,0],!1,"WATER"),e=[e,f,b];v.create_sensor_manifold(d,"CLOSE_GROUND",v.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},c,a);break;case x:e=v.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN");e=[e];v.create_sensor_manifold(d,"CLOSE_GROUND",v.CT_CONTINUOUS,e,null,c,a);break;case q:e=v.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN"),b=v.create_ray_sensor(d,[0,0,0],[0,100,0],!1,"WATER"),e=[e],v.create_sensor_manifold(d,"CLOSE_WATER",v.CT_CONTINUOUS,[b],null,c,a),v.create_sensor_manifold(d,
"CLOSE_GROUND",v.CT_CONTINUOUS,e,null,c,a)}}function l(a){function b(c,d,e){1==e?(y.get_translation(a.empty,a.destination),a.em=4):a.em=1}var c=a.collider;if(a.type==x){var d=v.create_collision_sensor(c,"CONSTRUCTION",!1);v.create_sensor_manifold(c,"CONSTRUCTION_COLL",v.CT_CONTINUOUS,[d],null,b)}}function h(a){var b=a.rig;if(!r.is_play(b))return!0;b=r.get_current_action(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.yh)return!1;if(-1==c.yh.indexOf(b))break;break;case 20:if(!c.move||
-1!=c.move.indexOf(b)||c.ee&&-1!=c.ee.indexOf(b)||c.vd&&-1!=c.vd.indexOf(b))return!1;break;default:return!1}return!0}var k=n("vec3"),e=n("quat"),r=n("animation"),v=n("controls"),m=n("util"),t=n("scenes"),s=n("main"),y=n("transform"),d=[];new Float32Array(9);var C=new Float32Array(3),A=new Float32Array(3),u=new Float32Array(3),w=new Float32Array(3),p=new Float32Array(4),I=new Float32Array(4),H=new Float32Array(4),x=a.NT_WALKING=10,M=a.NT_FLYING=20,q=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=
new Float32Array(3);a.start=[];a.ended=[];a.Ti=[];a.Fd=null;a.iq=null;a.Ug=null;a.je=!0;a.em=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Ti[b]=!1;d.push(a)};a.enable_animation=function(){if(d.length){g();var a=v.create_elapsed_sensor();v.create_sensor_manifold(d[0].collider,"ELAPSED",v.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,c,e){if(1==e)for(a=v.get_sensor_value(a,c,0),c=0;c<d.length;c++){e=d[c];var f=a;if(t.is_visible(e.obj))if(e.random)b(f,e);else{for(var g=
s.global_timeline(),h=0;h<e.path.length;h++)if(!e.ended[h]){e.Ti[h]||(e.Ti[h]=!0,e.destination[0]=e.path[h][0],e.destination[1]=e.path[h][1],e.destination[2]=e.path[h][2],e.start[h]=g+e.delay[h]);if(g<e.start[h])break;b(f,e);e.ended[h]=e.je;break}a:{for(f=0;f<e.path.length;f++)if(0==e.ended[f]){f=!1;break a}f=!0}if(f)for(f=0;f<e.path.length;f++)e.Ti[f]=!1,e.ended[f]=!1}}})}};a.disable_animation=function(){if(!(0>=d.length))for(var a=0;a<d.length;a++){var b=d[a];v.check_sensor_manifolds(b.collider)&&
v.remove_sensor_manifolds(b.collider);r.is_play(b.rig)&&r.stop(b.rig)}}};b4w.module.pointerlock=function(a,n){function b(){var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document)}function c(a){a.removeEventListener("mousedown",f,!1);a.removeEventListener("mouseup",l,!1);a.removeEventListener("mousemove",g,!1)}function g(a){A()&&(d[0]+=2*(a.clientX-s),d[1]+=2*(a.clientY-y),s=a.clientX,y=a.clientY);a.preventDefault()}function f(a){s=a.clientX;y=a.clientY;a.currentTarget.addEventListener("mousemove",
g,!1);a.preventDefault()}function l(a){a.currentTarget.removeEventListener("mousemove",g,!1);a.preventDefault()}function h(a,b){if(.01<Math.abs(d[0])||.01<Math.abs(d[1])){var c=e.get_sensor_value(a,b,0),f=t.smooth(d[0],0,c,.1),g=t.smooth(d[1],0,c,.1),c=m.get_first_character(),h=m.get_active_camera();k.rotate(h,4E-4*-f,4E-4*g);d[0]-=f;d[1]-=g;c&&(f=C,k.get_angles(h,f),f[0]+=Math.PI,f[1]*=-1,r.set_character_rotation(c,f[0],f[1]))}}var k=n("camera"),e=n("controls"),r=n("physics"),v=n("print"),m=n("scenes"),
t=n("util"),s=0,y=0,d=new Float32Array(2),C=new Float32Array(2),A=null;a.request_pointerlock=function(a,b,f,g,k){function l(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",g,!1);var d=m.get_active_camera();if(!e.check_sensor_manifold(d,"SMOOTH_PL")){var k=e.create_elapsed_sensor();e.create_sensor_manifold(d,"SMOOTH_PL",e.CT_CONTINUOUS,[k],null,h)}b()}else a.removeEventListener("mousemove",g,!1),document.removeEventListener("pointerlockchange",
l,!1),document.removeEventListener("webkitpointerlockchange",l,!1),document.removeEventListener("mozpointerlockchange",l,!1),f()}b=b||function(){};f=f||function(){};k=k||function(){return!0};g=g||function(a){if(k()){var b=a.movementY||a.webkitMovementY||a.mozMovementY||0;d[0]+=a.movementX||a.webkitMovementX||a.mozMovementX||0;d[1]+=b}};document.addEventListener("pointerlockchange",l,!1);document.addEventListener("webkitpointerlockchange",l,!1);document.addEventListener("mozpointerlockchange",l,!1);
var n=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof n?n.apply(a):v.error("Pointer lock is not available")};a.exit_pointerlock=b;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,c){b();A=c||function(){return!0};a.addEventListener("mousedown",f,!1);a.addEventListener("mouseup",l,!1);var d=m.get_active_camera();if(!e.check_sensor_manifold(d,
"SMOOTH_DRAG")){var g=e.create_elapsed_sensor();e.create_sensor_manifold(d,"SMOOTH_DRAG",e.CT_CONTINUOUS,[g],null,h)}};a.exit_mouse_drag=c};b4w.module.preloader=function(a){var n,b,c,g,f,l,h,k,e=null;a.create_simple_preloader=function(a){var h=null,k=null,l="#bf9221",s="#000",y;for(y in a)switch(y){case "canvas_container_id":h=a.canvas_container_id;break;case "background_container_id":k=a.background_container_id;break;case "bg_color":s=a.bg_color;break;case "bar_color":l=a.bar_color}a=document.createElement("div");y=document.createElement("div");var d=document.createElement("div"),C=document.createElement("div"),k=document.getElementById(k);
e=document.getElementById(h);a.style.cssText="         z-index: 4;        background-color: "+s+";        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";y.style.cssText="         position: absolute;        left: 50%;        top: 82%;        width: 400px;        height: 20px;        margin-left: -200px;        margin-top: -10px;        border-style:solid;        border-width:2px;        border-color: "+l+";        border-radius: 6px;    ";d.style.cssText=
"         position: absolute;        left: 0px;        top: 1px;        width: 0px;        height: 18px;        background-color: "+l+";        border-radius: 4px;    ";C.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 100%;        height: 100%;        margin-left: -200px;        margin-top: -10px;        text-align: center;        font-size: 17px;        color: #ffffff;        font-family: Verdana;    ";y.appendChild(d);y.appendChild(C);a.appendChild(y);
document.body.appendChild(a);n="SIMPLE";b=a;c=d;g=C;f=k};a.create_rotation_preloader=function(a){var c=null,h=null,k="rgba(0,0,0,0)",s="",y="",d;for(d in a)switch(d){case "canvas_container_id":c=a.canvas_container_id;break;case "background_container_id":h=a.background_container_id;break;case "frame_bg_color":k=a.frame_bg_color;break;case "frame_class":s=a.frame_class;break;case "anim_elem_class":y=a.anim_elem_class}a=document.createElement("div");d=document.createElement("div");var C=document.createElement("div"),
A=document.createElement("div"),h=document.getElementById(h);e=document.getElementById(c);a.style.cssText="         z-index: 4;        background-color: rgba(0,0,0,0);        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";d.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 117px;        height: 117px;        margin-left: -58px;        margin-top: -58px;        background-color: "+k+";    ";C.style.cssText=
"         position: absolute;        left: 0px;        top: 0px;        width: 100%;        height: 100%;        background-position: center;        background-repeat: no-repeat;    ";A.style.cssText="         position: absolute;        width: 100%;        height: 100%;        text-align: center;        margin-top: 38px;        font-size: 36px;        color: #ffffff;        font-family: Arial;        font-weight: bold;    ";C.className=y;d.appendChild(C);d.className=s;d.appendChild(A);a.appendChild(d);
document.body.appendChild(a);n="ROTATION";b=a;l=C;g=A;f=h};a.create_advanced_preloader=function(a){var l=a.preloader_width,l=l/(l-a.img_width),m=document.getElementById(a.preloader_bar_id),t=document.getElementById(a.fill_band_id),s=document.getElementById(a.preloader_caption_id),y=document.getElementById(a.preloader_container_id),d=document.getElementById(a.background_container_id);e=document.getElementById(a.canvas_container_id);n="ADVANCED";c=m;h=t;k=l;g=s;b=y;f=d};a.update_preloader=function(a){g.innerHTML=
a+"%";"SIMPLE"==n&&(c.style.width=a+"%");"ADVANCED"==n&&(c.style.width=a/k+"%",h.style.width=100-a+"%");"ROTATION"==n&&(l.style.transform="rotate("+a+"deg)");100==a&&(b.style.zIndex=0,e.style.zIndex=1,f&&(f.style.zIndex=0))}};b4w.module.storage=function(a,n){function b(a){f=a;try{l=window.localStorage}catch(b){g.warn("Applying chrome localStorage bug workaround"),l=null}l||(g.warn("localStorage is not available, initializing temporary storage"),l={})}function c(){return l[f]?JSON.parse(l[f]):{}}var g=n("__print"),f="",l=null;a.init=b;a.set=function(a,b){var e=c();e[a]=String(b);l[f]=JSON.stringify(e)};a.cleanup=function(){delete l[f]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){g.log(c())};b("b4w")};
